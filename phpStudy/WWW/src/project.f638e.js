require=function r(s,o,c){function l(t,e){if(!o[t]){if(!s[t]){var a="function"==typeof require&&require;if(!e&&a)
return a(t,!0);if(h)
return h(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}
var i=o[t]={exports:{}};s[t][0].call(i.exports,function(e){return l(s[t][1][e]||e)},i,i.exports,r,s,o,c)}
return o[t].exports}
for(var h="function"==typeof require&&require,e=0;e<c.length;e++)
l(c[e]);return l}
({ActivityAwardDoubleContent:[function(e,t,a){"use strict";cc._RF.push(t,"4a6405opWZKjK/MLnl+z6DE","ActivityAwardDoubleContent"),cc.Class({extends:cc.Component,properties:{lab_double_module:cc.Label},changeData:function(e,t){var a=(this._netData=e).sub_activities,n=e.nComplete,i=2*n,r=2*n+1,s=[];if(null!=a[i]){var o=this.getModuleNameById(a[i].nSubCount);s.push(o)}
if(null!=a[r]){var c=this.getModuleNameById(a[r].nSubCount);s.push(c)}
var l=s.join(",");this.lab_double_module.string=l},getModuleNameById:function(e){var t="";switch(e){case 1:t="Phó bản ( Bình thường, Tinh anh )";break;case 2:t=" Quá quan trảm tướng ";break;case 3:t=" Đấu Trường ";break;case 4:t=" hoạt động phó bản ( anh hùng lịch lãm, sử thi chiến dịch )";break;case 5:t=" bí mật căn cứ ";break;case 6:t=" quặng tràng "}
return t},start:function(){}}),cc._RF.pop()},{}],ActivityBattleManager:[function(h,e,t){"use strict";cc._RF.push(e,"1cb473Ie1lL+pQZMTwAYcMK","ActivityBattleManager");var a=h("BattleUtil"),D=h("BattleDataManager"),I=h("BattleBufferMgr"),b=h("PlayerBufferMgr"),P=h("HeroBufferMgr"),d=h("ActivityBufferMgr"),n=h("MyProtocols"),_=h("BattleManager"),i=function(){};i.prototype.changeData=function(e,t,a){this.actType=e,this.actId=t,this.missionId=a},i.prototype.init=function(e,t){var a=this.actType,n=this.actId,i=this.missionId,r=DonotDestroyManager.GameData.Activities.battles[a][n],s={side:"left"};s.name=b.getNickName(),s.level=b.getUserLevel();var o=3+n;1==a&&(o=1);var c=I.getFormationData(o);s.formation=c.formationId,s.forward=c.forward,s.flip=c.flip;for(var l=D.create(s),h=Object.keys(c),d=0;d<h.length;++d){var _=h[d];if("formationId"!==_&&"forward"!==_&&"fid"!==_&&"flip"!==_){var u=c[_];if(0!=u)
null!=(v=P.getHeroByUid(u))&&(delete v.hpPerc,delete v.atkPerc,l.addCardWithPosition(v,_))}}
this.leftData=l;var m={side:"right"};m.name=r.name;var p=r.diffs[i];m.level=p.level,m.formation=p.mobs.formation,m.forward=p.mobs.forward,m.flip=p.mobs.flip;var f=D.create(m);f.isMobHero=!0,f.stars=p.stars;var g=Object.keys(p.mobs);for(d=0;d<g.length;++d){var y=g[d];if("formation"!==y&&"forward"!==y&&"flip"!==y&&"battleground"!==y){var v={},M=p.mobs[y],S=p.attrs[M.mob_type-1];if(v.hero={},v.hero.id=M.mob_id,M.skill_enable){v.hero.skill_enable=[];for(var C=0;C<M.skill_enable.length;++C)
v.hero.skill_enable.push(M.skill_enable[C])}
v.hero.level=S.level,v.hero.grade=S.card_grade,S.add_attrs.rates&&(v.hero.rates_maxhp=S.add_attrs.rates.maxhp,v.hero.rates_atk=S.add_attrs.rates.atk,v.hero.rates_def=S.add_attrs.rates.def),S.add_attrs.statics&&(v.hero.static_maxhp=S.add_attrs.statics.maxhp,v.hero.static_atk=S.add_attrs.statics.atk,v.hero.static_def=S.add_attrs.statics.def),v.unit_num=S.unit_num,v.unit_grade=S.unit_grade,v.unit_level=S.unit_level,f.addHeroWithPosition(v,M.position)}}
this.rightData=f,this.leftData.fightVal=e,this.rightData.fightVal=t,this.background=p.mobs.battleground},i.prototype.enterBattlefield=function(){var e={background:this.background,teamAiCfg:DonotDestroyManager.GameData.TeamSkillsAI[6][this.actType][this.actId][this.missionId],type:5},t=this;a.createBattlefield(this.leftData,this.rightData,e,function(){t.onSuccess()},function(e){t.onFailure()}),a.enterRealScene()},i.prototype.onSuccess=function(){var e=_.getFightTime(),t=_.getOurHPPercent(),a=_.getOurHeroDeadNum();n.send_C2SActivitiesBattlePass(DonotDestroyManager._gameSocket,this.actType+1,this.actId+1,this.missionId,e,t,a)},i.prototype.onSuccessCb=function(e){var t=null;t=1==e.module_id?MyPersistDataManager._playerData.activityView1:MyPersistDataManager._playerData.activityView2;var a=d.JudgeType(t.info,e.activity_type);if(t.attack_count=e.attack_count,null!=a)
a.boxAwardCanGet[e.level_index]=e.boxAwardCanGet,a.star[e.level_index]<e.star&&(a.star[e.level_index]=e.star);else{var n={};n.activity_type=e.activity_type,n.boxAwardCanGet=[],n.star=[];for(var i=0;i<5;++i)
n.boxAwardCanGet.push(!1),n.star.push(0);n.boxAwardCanGet[e.level_index]=e.boxAwardCanGet,n.star[e.level_index]=e.star,t.info.push(n)}
var r=h("BattleSceneMgr");if(_.btlWin){var s=cc.instantiate(r.getInstance()._raw_assets["Prefab/ui/battle/battleWinPanel"]);cc.Canvas.instance.node.addChild(s);var o=s.getComponent("BattleWinMgr"),c=d.getMissionCfg(e.module_id,e.activity_type,e.level_index+1);o.ChangeData(e),o.setStatistics(this.leftData,this.rightData,_.statistics),o.setStarCfg(c),o.sequencePlay()}else{var l=cc.instantiate(r.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(l),l.getComponent("BattleFailMgr").initUi(0,{staticData:_.statistics})}},i.prototype.onFailure=function(){var e=h("BattleSceneMgr"),t=cc.instantiate(e.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(t),t.getComponent("BattleFailMgr").initUi(0,{staticData:_.statistics})},e.exports=new i,cc._RF.pop()},{ActivityBufferMgr:"ActivityBufferMgr",BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleUtil:"BattleUtil",HeroBufferMgr:"HeroBufferMgr",MyProtocols:"MyProtocols",PlayerBufferMgr:"PlayerBufferMgr"}],ActivityBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"c6bc9HX0YVCR59JxApwjiyo","ActivityBufferMgr");var n=function(){};n.prototype.changeData=function(e,t,a,n){this.actType=e,this.actId=t,this.missionId=a,this.jsonInfo=DonotDestroyManager.GameData.Activities.battles[this.actType][this.actId].diffs[this.missionId],this.diffScript=n},n.prototype.getRetObj=function(e){if(0==e)
var t=MyPersistDataManager._playerData.activityView1;else if(1==e)
t=MyPersistDataManager._playerData.activityView2;return t},n.prototype.getMissionCfg=function(e,t,a){return DonotDestroyManager.GameData.Activities.battles[e-1][t-1].diffs[a-1]},n.prototype.getActivityTimes=function(e,t){if(0==e)
var a=MyPersistDataManager._playerData.activityView1;else if(1==e)
a=MyPersistDataManager._playerData.activityView2;var n=(new Date).getDay();return DonotDestroyManager.GameData.Activities.daily_free_times[e][n]-a.attack_count},n.prototype.getBuyTimes=function(e){if(0==e)
var t=MyPersistDataManager._playerData.activityView1;else if(1==e)
t=MyPersistDataManager._playerData.activityView2;var a=DonotDestroyManager.GameData.Activities.activities_purchase,n=a.times[e],i=a.money_cost[0]+t.buy_count*a.money_cost[1];return{buyTimes:n[MyPersistDataManager._playerData.vip_level]-t.buy_count,cost:i}},n.prototype.missionUnlock=function(e,t,a,n){var i=DonotDestroyManager.GameData.Activities.battles[e][t].diffs[a];this.diffScript[a]._unlock||n>=i.level_limit&&(this.diffScript[a].PlayUnlockEffect(),this.diffScript[a]._unlock=!0)},n.prototype.JudgeType=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].activity_type==t)
return e[a];return null},n.prototype.judgeHeroGroup=function(){if(null==this.actType||null==this.actId)
return 5;var e=DonotDestroyManager.GameData.Activities.battles[this.actType][this.actId].group;return 1==e[0]&&1==e[1]&&1==e[2]&&1==e[3]?5:1==e[0]?1:1==e[1]?2:1==e[2]?3:1==e[3]?4:void 0},t.exports=new n,cc._RF.pop()},{}],ActivityCZJJDetail:[function(e,t,a){"use strict";cc._RF.push(t,"d3f318rI1hOmJbCf6xum5qG","ActivityCZJJDetail");var o=e("TestActivityLayer"),X=e("MyProtocols"),n=e("MyEventDispatcher"),i=e("MyUIEvent"),$=(e("ShaderUtil"),e("SoundUtil")),ee=e("i18n");cc.Class({extends:cc.Component,properties:{m_pItemBoxPrefab:cc.Prefab,itemBoxRootNode:cc.Node,lab_btnBuy:cc.Label,btn_buy:cc.Button,_netData:null,_actId:-1},onLoad:function(){this.ActivityProgressUpdate_cb_func=this.ActivityProgressUpdate_cb.bind(this),n.addListener(i.ActivityProgressUpdate,this.ActivityProgressUpdate_cb_func)},onDestroy:function(){n.removeListener(i.ActivityProgressUpdate,this.ActivityProgressUpdate_cb_func)},ActivityProgressUpdate_cb:function(e){if(e.activeIdType==this._actId){var t=e.progress;if(this.lab_btnBuy.string=-1==t?" cấu mua ":" lĩnh thủ ",null!=this.itemBoxRootNode&&t<this.itemBoxRootNode.children.length)
this.itemBoxRootNode.children[t].getComponent("ItemBox").SetSelect(!0,0)}},GetRewardDynamicChange:function(e){null!=this.itemBoxRootNode&&e<this.itemBoxRootNode.children.length&&this.itemBoxRootNode.children[e].getComponent("ItemBox").SetSelect(!0,1);var t=this._netData.nComplete,a=this._netData.sub_activities;-1<t&&t<a.length&&2==a[t].nState&&(this.lab_btnBuy.string=" đã lĩnh ")},changeData:function(e,t){this._actId=t;for(var a=(this._netData=e).sub_activities,n=e.nComplete,i=0;i<a.length;i++){var r=a[i];this.CreateItemBox(r.reward[0].nID,r.reward[0].nNum,i,r.nState,n)}
-1==n?this.lab_btnBuy.string=" cấu mua ":n<a.length?this.lab_btnBuy.string=" lĩnh thủ ":this.lab_btnBuy.string=" tục cấu ",-1<n&&n<a.length&&2==a[n].nState&&(this.lab_btnBuy.string=" đã lĩnh ")},CreateItemBox:function(e,t,a,n,i){o.getInstance();var r=null;null==r&&(r=cc.instantiate(this.m_pItemBoxPrefab)),this.itemBoxRootNode.addChild(r);var s=r.getComponent("ItemBox");s.ChangeItemInfo(e,t,!0,null,!0),a==i&&s.SetSelect(!0,0),2==n&&s.SetSelect(!0,1)},BuyClickHander:function(e,t){if($.playBtnOpenEffect(),-1<this._netData.nComplete&&this._netData.nComplete<this._netData.sub_activities.length)
X.send_C2SActivitiesGetAward(DonotDestroyManager._gameSocket,this._actId,0);else{if(cc.log(" gửi đi dự tiền trả tin tức ，czjj"),null!=window.open_platform){var a=" trưởng thành quỹ ";switch(window.open_platform){case 1:X.send_C2SQunheiPayPre(DonotDestroyManager._gameSocket,1e3,a);break;case 2:X.send_C2SWanBaGetBalance(DonotDestroyManager._gameSocket,window.OPEN_DATA.appid,window.OPEN_DATA.openid,window.OPEN_DATA.openkey,window.OPEN_DATA.pf,window.OPEN_DATA.platform,1e3,a);break;case 3:X.send_C2SZMPayCheck(DonotDestroyManager._gameSocket,1e3,a);break;case 4:var n=window.THREE33.gameId;window.THREE33.uid;X.send_C2S333PayPre(DonotDestroyManager._gameSocket,n,a,1e3);break;case 5:X.send_C2SChongChongPayPre(DonotDestroyManager._gameSocket,1e3,a);break;case 6:X.send_C2S4399PayPre(DonotDestroyManager._gameSocket,1e3,a)}}
if(2==DonotDestroyManager.jsbChannel){var i=DonotDestroyManager.GameData.Charge.activityProducts[1e3],r=100*i.rmb,s=i.name,o="1000_"+MyPersistDataManager._playerData.server_id,c=ee.t("pay_yijie_callback_url");window.webkit.messageHandlers.pay.postMessage({unitPrice:r,itemName:s,count:1,callBackInfo:o,callBackUrl:c})}else{if(3==DonotDestroyManager.jsbChannel){var l=DonotDestroyManager.GameData.Charge.activityProducts[1e3].product_id;return void(cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("LejiIAPApi","BuyProduct:",l))}
if(4==DonotDestroyManager.jsbChannel){var h=DonotDestroyManager.GameData.Charge.activityProducts[1e3],d=100*h.rmb,_=h.name,u=h.product_id,m="1000_"+MyPersistDataManager._playerData.server_id+"_"+MyPersistDataManager._playerData.account_id;return void(cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("ShYunbeeOpenApi","neigou:and1:and2:and3:",d,_,u,m))}
if(5==DonotDestroyManager.jsbChannel){var p=DonotDestroyManager.GameData.Charge.activityProducts[1e3],f=p.rmb,g=p.name,y=p.product_id;if(cc.sys.os===cc.sys.OS_IOS){var v=Math.random().toString(36).substr(2),M=MyPersistDataManager._playerData.server_id+"",S="S#"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(S=DonotDestroyManager._gameServerInfo.server_name);var C=MyPersistDataManager._playerData.server_id+"_1000",D=MyPersistDataManager._playerData.id+"",I=MyPersistDataManager._playerData.name+"";jsb.reflection.callStaticMethod("BjLiuyeOpenApi","neigou:and1:and2:and3:and4:and5:and6:and7:and8:",v,M,S,y,C,f+"",D,I,g)}
return}
if(6==DonotDestroyManager.jsbChannel||7==DonotDestroyManager.jsbChannel){var b=DonotDestroyManager.GameData.Charge.activityProducts[1e3],P=100*b.rmb,L=b.name,B=b.product_id,w="1000_"+MyPersistDataManager._playerData.server_id,E=ee.t("pay_xingteng_callback_url");jsb.reflection.callStaticMethod("CfXingTengOpenApi","zfu:and1:and2:and3:and4:and5:",P,L,1,w,E,B)}else if(8==DonotDestroyManager.jsbChannel){var k=DonotDestroyManager.GameData.Charge.activityProducts[1e3],T=MyPersistDataManager._playerData.account_id.substr(3),A=k.product_id,R=MyPersistDataManager._playerData.id+"",F=MyPersistDataManager._playerData.name,x=MyPersistDataManager._playerData.level+"",U=MyPersistDataManager._playerData.server_id+"",N="S"+MyPersistDataManager._playerData.server_id,G=MyPersistDataManager._playerData.gameMoney+"",H=MyPersistDataManager._playerData.vip_level+"",O=MyPersistDataManager._playerData.money+"",q=MyPersistDataManager._playerData.fight+"";jsb.reflection.callStaticMethod("GzPingPingOpenApi","zfu:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:and11:",T,A,1e3,R,F,x,U,N,G,H,O,q)}else if(9==DonotDestroyManager.jsbChannel){var j=DonotDestroyManager.GameData.Charge.activityProducts[1e3],V=j.rmb,z=j.name,W=j.product_id,J="1000_"+MyPersistDataManager._playerData.server_id;jsb.reflection.callStaticMethod("MxsgDouWanOpenApi","fufee:and1:and2:and3:",V,z,W,J)}else if(11==DonotDestroyManager.jsbChannel){var Z=DonotDestroyManager.GameData.Charge.activityProducts[1e3],Y="S"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(Y=DonotDestroyManager._gameServerInfo.server_name),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","pay","(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V",MyPersistDataManager._playerData.money,Z.rmb,1e3.toString(),Z.name,Z.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),Y,MyPersistDataManager._playerData.vip_level.toString()):jsb.reflection.callStaticMethod("SDKHandler","pay:and1:and2:and3:and4:and5:and6:and7:and8:",MyPersistDataManager._playerData.server_id.toString(),Y,1e3.toString(),Z.name,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),Z.rmb.toString(),1e3.toString())}else if(12==DonotDestroyManager.jsbChannel){var K=DonotDestroyManager.GameData.Charge.activityProducts[1e3],Q="S"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(Q=DonotDestroyManager._gameServerInfo.server_name),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","pay","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;IILjava/lang/String;Ljava/lang/String;)V",MyPersistDataManager._playerData.server_id.toString(),Q,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.money.toString(),K.name,1,K.rmb,1e3.toString(),"1000_"+MyPersistDataManager._playerData.server_id):jsb.reflection.callStaticMethod("QuickSDKHandler","charge:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:and11:",1e3.toString(),K.rmb,"1000_"+MyPersistDataManager._playerData.server_id,Q,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.money.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.level.toString(),K.name,1)}}}},reuseItemBox:function(){}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",ShaderUtil:"ShaderUtil",SoundUtil:"SoundUtil",TestActivityLayer:"TestActivityLayer",i18n:"i18n"}],ActivityDBCZItem:[function(e,t,a){"use strict";cc._RF.push(t,"9995d4ueNRCuaUsoPRN2PYR","ActivityDBCZItem");e("StagesConfigMgr"),e("EliteStagesConfigMgr");var i=e("TestActivityLayer"),n=e("MyProtocols"),r=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pName:cc.Label,lab_extraMsg:cc.RichText,m_pItemContent:cc.Node,m_pProgress:cc.Label,lab_btnName:cc.Label,m_pItemBoxPrefab:cc.Prefab,m_pItemEffect:cc.Prefab,m_pGetMask:cc.Node,m_pGetBtn:cc.Button,_actId:-1,_itemScript:[],_pjson:null,_levelIndex:0,_progress:0,_canGet:!1,_retInfo:null},onLoad:function(){this.m_pGetMask.active=!1},changeData:function(e,t,a){this._pjson=e,this._levelIndex=t,this._actId=a,this.CreateName(e),this.ClearItemBox(),this.CreateRewardItems(e),this.SetProgress();var n=new cc.Component.EventHandler;n.target=this.node,n.component="ActivityDBCZItem",n.handler="GetReward_OnClick",n.customEventData="",this.m_pGetBtn.clickEvents[0]=n},GetRewardDynamicChange:function(e){this._pjson=e,this.CreateName(e),this.SetProgress()},CreateName:function(e){var t=DonotDestroyManager.GameData.ActivityDynamic[this._actId];this.m_pName.string=cc.js.formatStr(t.level_des,e.nSubCount),null!=window.open_platform&&2==window.open_platform&&cc.sys.os==cc.sys.OS_IOS&&(this.m_pName.string=cc.js.formatStr(t.level_des_wanba_ios,10*e.nSubCount));var a="";a=0<e.nComplete?" khả lĩnh số lần :<color=#00ff00>%d</c>":" khả lĩnh số lần :<color=#ff0000>%d</c>",this.lab_extraMsg.string=cc.js.formatStr(a,e.nComplete)},SetProgress:function(){this.m_pProgress.node.active=!1,this.JudgeDynamic()},JudgeDynamic:function(){this.m_pGetBtn.node.active=!0,0<this._pjson.nComplete?this.lab_btnName.string=" lĩnh thủ ":this.lab_btnName.string=" khiêu chuyển "},CreateRewardItems:function(e){var t;if(this._itemScript=[],0==this._itemScript.length){t=e.reward.length;for(var a=0;a<t;++a)
this.CreateItemBox(e.reward[a].nID,e.reward[a].nNum)}},CreateItemBox:function(e,t){var a=i.getInstance().myPool.get();null==a&&(a=cc.instantiate(this.m_pItemBoxPrefab)),this.m_pItemContent.addChild(a);var n=a.getComponent("ItemBox");n.ChangeItemInfo(e,t,!0,null,!0),null!=n._itemjsoninfo.tier&&0<n._itemjsoninfo.tier&&(n._tiereffect=cc.instantiate(this.m_pItemEffect),a.addChild(n._tiereffect)),this._itemScript.push(n)},ClearItemBox:function(){for(var e=this.m_pItemContent.children.concat(),t=0;t<e.length;++t)
i.getInstance().myPool.put(e[t]);e=[]},GetReward_OnClick:function(e,t){r.playBtnOpenEffect(),cc.log(" gửi đi dự tiền trả tin tức ,index=%d",this._levelIndex),0<this._pjson.nComplete?n.send_C2SActivitiesGetAward(DonotDestroyManager._gameSocket,this._actId,this._levelIndex):MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1})}}),cc._RF.pop()},{EliteStagesConfigMgr:"EliteStagesConfigMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",StagesConfigMgr:"StagesConfigMgr",TestActivityLayer:"TestActivityLayer"}],ActivityHeroLiBaoItem:[function(e,t,a){"use strict";cc._RF.push(t,"34cadFjchZL06es8VYGtvbT","ActivityHeroLiBaoItem");e("StagesConfigMgr"),e("EliteStagesConfigMgr");var i=e("TestActivityLayer"),le=e("MyProtocols"),he=e("SoundUtil"),de=e("i18n");cc.Class({extends:cc.Component,properties:{m_pName:cc.Label,lab_extraMsg:cc.RichText,m_pItemContent:cc.Node,m_pProgress:cc.Label,lab_btnName:cc.Label,m_pItemBoxPrefab:cc.Prefab,m_pItemEffect:cc.Prefab,m_pGetMask:cc.Node,m_pGetBtn:cc.Button,_activityState:0,_actId:-1,_itemScript:[],_pjson:null,_levelIndex:0,_progress:0,_canGet:!1,_index:0,_retInfo:null},onLoad:function(){},changeData:function(e,t,a){this.lab_btnName.string=" cấu mua ",this._activityState=0,this._pjson=e,this._levelIndex=t,this._actId=a,this.CreateName(e),this.ClearItemBox(),this.CreateRewardItems(e),this.SetProgress();var n=new cc.Component.EventHandler;n.target=this.node,n.component="ActivityHeroLiBaoItem",n.handler="GetReward_OnClick",n.customEventData="",this.m_pGetBtn.clickEvents[0]=n},GetRewardDynamicChange:function(e){this._pjson=e,this.CreateName(e),this.SetProgress()},CreateName:function(e){var t=DonotDestroyManager.GameData.ActivityDynamic[this._actId];this.m_pName.string=cc.js.formatStr(t.level_des,e.price),null!=window.open_platform&&2==window.open_platform&&cc.sys.os==cc.sys.OS_IOS&&(this.m_pName.string=cc.js.formatStr(t.level_des_wanba_ios,10*e.price)),this.lab_extraMsg.string=cc.js.formatStr(" tổng cộng giá trị <color=#0fff00>%d%</c> đạo cụ, khả mua số lần ：<color=#0fff00>%d</c>",e.favor_rate,e.buy_count)},SetProgress:function(){this.m_pProgress.node.active=!1,this.JudgeDynamic()},JudgeDynamic:function(){0<this._pjson.buy_count?(this.m_pGetBtn.node.active=!0,this.m_pGetMask.active=!1):(this.m_pGetBtn.node.active=!1,this.m_pGetMask.active=!0)},CreateRewardItems:function(e){var t;if(this._itemScript=[],0==this._itemScript.length){t=e.reward.length;for(var a=0;a<t;++a)
this.CreateItemBox(e.reward[a].nID,e.reward[a].nNum)}},CreateItemBox:function(e,t){var a=i.getInstance().myPool.get();null==a&&(a=cc.instantiate(this.m_pItemBoxPrefab)),this.m_pItemContent.addChild(a);var n=a.getComponent("ItemBox");n.ChangeItemInfo(e,t,!0,null,!0),null!=n._itemjsoninfo.tier&&0<n._itemjsoninfo.tier&&(n._tiereffect=cc.instantiate(this.m_pItemEffect),a.addChild(n._tiereffect)),this._itemScript.push(n)},ClearItemBox:function(){for(var e=this.m_pItemContent.children.concat(),t=0;t<e.length;++t)
i.getInstance().myPool.put(e[t]);e=[]},GetReward_OnClick:function(e,t){he.playBtnOpenEffect();var a=this._pjson.recharge_id;if(cc.log(" gửi đi dự tiền trả tin tức ,rechargeId=%d",a),null!=window.open_platform){var n=" anh hùng lễ bao ";switch(window.open_platform){case 1:le.send_C2SQunheiPayPre(DonotDestroyManager._gameSocket,a,n);break;case 2:le.send_C2SWanBaGetBalance(DonotDestroyManager._gameSocket,window.OPEN_DATA.appid,window.OPEN_DATA.openid,window.OPEN_DATA.openkey,window.OPEN_DATA.pf,window.OPEN_DATA.platform,a,n);break;case 3:le.send_C2SZMPayCheck(DonotDestroyManager._gameSocket,a,n);break;case 4:var i=window.THREE33.gameId;window.THREE33.uid;le.send_C2S333PayPre(DonotDestroyManager._gameSocket,i,n,a);break;case 5:le.send_C2SChongChongPayPre(DonotDestroyManager._gameSocket,a,n);break;case 6:le.send_C2S4399PayPre(DonotDestroyManager._gameSocket,a,n)}}
if(2==DonotDestroyManager.jsbChannel){var r=a,s=DonotDestroyManager.GameData.Charge.activityProducts[r],o=100*s.rmb,c=s.name,l=r+"_"+MyPersistDataManager._playerData.server_id,h=de.t("pay_yijie_callback_url");window.webkit.messageHandlers.pay.postMessage({unitPrice:o,itemName:c,count:1,callBackInfo:l,callBackUrl:h})}else{if(3==DonotDestroyManager.jsbChannel){var d=a,_=DonotDestroyManager.GameData.Charge.activityProducts[d].product_id;return void(cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("LejiIAPApi","BuyProduct:",_))}
if(4==DonotDestroyManager.jsbChannel){var u=a,m=DonotDestroyManager.GameData.Charge.activityProducts[u],p=100*m.rmb,f=m.name,g=m.product_id,y=u+"_"+MyPersistDataManager._playerData.server_id+"_"+MyPersistDataManager._playerData.account_id;return void(cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("ShYunbeeOpenApi","neigou:and1:and2:and3:",p,f,g,y))}
if(5==DonotDestroyManager.jsbChannel){var v=a,M=DonotDestroyManager.GameData.Charge.activityProducts[v],S=M.rmb,C=M.name,D=M.product_id;if(cc.sys.os===cc.sys.OS_IOS){var I=Math.random().toString(36).substr(2),b=MyPersistDataManager._playerData.server_id+"",P="S#"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(P=DonotDestroyManager._gameServerInfo.server_name);var L=MyPersistDataManager._playerData.server_id+"_"+v,B=MyPersistDataManager._playerData.id+"",w=MyPersistDataManager._playerData.name+"";jsb.reflection.callStaticMethod("BjLiuyeOpenApi","neigou:and1:and2:and3:and4:and5:and6:and7:and8:",I,b,P,D,L,S+"",B,w,C)}
return}
if(6==DonotDestroyManager.jsbChannel||7==DonotDestroyManager.jsbChannel){var E=a,k=DonotDestroyManager.GameData.Charge.activityProducts[E],T=100*k.rmb,A=k.name,R=k.product_id,F=E+"_"+MyPersistDataManager._playerData.server_id,x=de.t("pay_xingteng_callback_url");jsb.reflection.callStaticMethod("CfXingTengOpenApi","zfu:and1:and2:and3:and4:and5:",T,A,1,F,x,R)}else if(8==DonotDestroyManager.jsbChannel){var U=a,N=DonotDestroyManager.GameData.Charge.activityProducts[U],G=MyPersistDataManager._playerData.account_id.substr(3),H=N.product_id,O=U,q=MyPersistDataManager._playerData.id+"",j=MyPersistDataManager._playerData.name,V=MyPersistDataManager._playerData.level+"",z=MyPersistDataManager._playerData.server_id+"",W="S"+MyPersistDataManager._playerData.server_id,J=MyPersistDataManager._playerData.gameMoney+"",Z=MyPersistDataManager._playerData.vip_level+"",Y=MyPersistDataManager._playerData.money+"",K=MyPersistDataManager._playerData.fight+"";jsb.reflection.callStaticMethod("GzPingPingOpenApi","zfu:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:and11:",G,H,O,q,j,V,z,W,J,Z,Y,K)}else if(9==DonotDestroyManager.jsbChannel){var Q=a,X=DonotDestroyManager.GameData.Charge.activityProducts[Q],$=X.rmb,ee=X.name,te=X.product_id,ae=Q+"_"+MyPersistDataManager._playerData.server_id;jsb.reflection.callStaticMethod("MxsgDouWanOpenApi","fufee:and1:and2:and3:",$,ee,te,ae)}else if(11==DonotDestroyManager.jsbChannel){var ne=a,ie=DonotDestroyManager.GameData.Charge.activityProducts[ne],re="S"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(re=DonotDestroyManager._gameServerInfo.server_name),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","pay","(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V",MyPersistDataManager._playerData.money,ie.rmb,ne.toString(),ie.name,ie.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),re,MyPersistDataManager._playerData.vip_level.toString()):jsb.reflection.callStaticMethod("SDKHandler","pay:and1:and2:and3:and4:and5:and6:and7:and8:",MyPersistDataManager._playerData.server_id.toString(),re,ne.toString(),ie.name,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),ie.rmb.toString(),ne.toString())}else if(12==DonotDestroyManager.jsbChannel){var se=a,oe=DonotDestroyManager.GameData.Charge.activityProducts[se],ce="S"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(ce=DonotDestroyManager._gameServerInfo.server_name),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","pay","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;IILjava/lang/String;Ljava/lang/String;)V",MyPersistDataManager._playerData.server_id.toString(),ce,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.money.toString(),oe.name,1,oe.rmb,se.toString(),se+"_"+MyPersistDataManager._playerData.server_id):jsb.reflection.callStaticMethod("QuickSDKHandler","charge:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:and11:",se.toString(),oe.rmb,se+"_"+MyPersistDataManager._playerData.server_id,ce,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.money.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.level.toString(),oe.name,1)}}}}),cc._RF.pop()},{EliteStagesConfigMgr:"EliteStagesConfigMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",StagesConfigMgr:"StagesConfigMgr",TestActivityLayer:"TestActivityLayer",i18n:"i18n"}],ActivityItemCell:[function(e,t,a){"use strict";cc._RF.push(t,"309c045qdhFCKimDr+7/9dE","ActivityItemCell");var n=e("UnLockCfgMgr"),i=e("MyProtocols"),r=e("SoundUtil"),s=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pIcon:cc.Sprite,m_pSelectIcon:cc.Sprite,m_pLockContent:cc.Node,m_pLockdes:cc.Label,m_pIconSpr:[cc.SpriteFrame],_index:-1,_UNLOCK_IDS:[]},onLoad:function(){},ChangeData:function(e){this._index=e,this._UNLOCK_IDS=[15,12,26,25],this.Init()},Init:function(){this.m_pIcon.spriteFrame=this.m_pIconSpr[this._index],this.m_pLockContent.active=!1,n.isUnLock(this._UNLOCK_IDS[this._index])||(this.m_pLockContent.active=!0,this.m_pLockdes.string=n.getUnLockDes(this._UNLOCK_IDS[this._index]))},OnClickHandler:function(e){r.playBtnOpenEffect(),this.toScene()},toScene:function(){var e=this._UNLOCK_IDS[this._index],t=this;0==this._index?n.isUnlockCallBack(e,function(){t.m_pSelectIcon.node.active=!0,i.send_C2SArenaView(DonotDestroyManager._gameSocket,s.isFirstArean())}):1==this._index?n.isUnlockCallBack(e,function(){t.m_pSelectIcon.node.active=!0,i.send_C2STreasureAvoidRobTime(DonotDestroyManager._gameSocket)}):2==this._index?n.isUnlockCallBack(e,function(){t.m_pSelectIcon.node.active=!0,MyUiManager.Open(MyUiManager.PanelInfo.EpicBattleLayer,"")}):3==this._index&&n.isUnlockCallBack(e,function(){t.m_pSelectIcon.node.active=!0,MyUiManager.Open(MyUiManager.PanelInfo.WeeklyBattleLayer,"")})}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",UnLockCfgMgr:"UnLockCfgMgr"}],ActivityLayer:[function(e,t,a){"use strict";cc._RF.push(t,"d3d8aWL61tNVbvHr+TbhSLS","ActivityLayer");var n=e("NetEvent"),i=e("MyEventDispatcher"),r=e("ArenaBufferMgr"),s=e("SoundUtil"),o=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pActivityCell:cc.Node,m_pLeftArrow:cc.Node,m_pRightArrow:cc.Node,m_pContent:cc.Node,m_pScrollView:cc.ScrollView,mCloseBtn:cc.Node,_itemlist:[]},onLoad:function(){this.S2CArenaView_cb_func=this.S2CArenaView_cb.bind(this),i.addListener(n.S2CArenaView,this.S2CArenaView_cb_func),this.S2CTreasureAvoidRobTime_cb_func=this.S2CTreasureAvoidRobTime_cb.bind(this),i.addListener(n.S2CTreasureAvoidRobTime,this.S2CTreasureAvoidRobTime_cb_func),this.m_pScrollView.node.on("scroll-ended",this.Scroll2RightCb,this)},Scroll2RightCb:function(){this.node.activeInHierarchy&&this.showGuide()},setParams:function(e){this.closeCb=e.closeCb,this.Init()},Init:function(){this.CreateActivityCell(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},S2CTreasureAvoidRobTime_cb:function(e){cc.log(" đoạt bảo miễn chiến thời gian tin tức ===="+e.timeStamp),MyUiManager.Open(MyUiManager.PanelInfo.SnatchMainLayer,e)},S2CArenaView_cb:function(e){cc.log(" tiếp thu Đấu Trường liệt biểu tin tức "),r.initBuffer(e),MyUiManager.Open(MyUiManager.PanelInfo.AreanMainLayer,e)},CreateActivityCell:function(){for(var e=0;e<4;++e){var t=cc.instantiate(this.m_pActivityCell);t.active=!0,this.m_pContent.addChild(t),t.getComponent("ActivityItemCell").ChangeData(e),this._itemlist.push(t)}},Arrow_OnClickHandler:function(e,t){s.playBtnOpenEffect();var a=parseInt(t);this.m_pScrollView.scrollToPercentHorizontal(a,.5,!0)},Back_OnClickHandler:function(e){s.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},onDestroy:function(){i.removeListener(n.S2CArenaView,this.S2CArenaView_cb_func),i.removeListener(n.S2CTreasureAvoidRobTime,this.S2CTreasureAvoidRobTime_cb_func)},showGuide:function(){var t=this;o.showGuide("ActivityLayer",function(e){return 1==e?t._itemlist[1]:2==e?t.mCloseBtn:3==e?t._itemlist[0]:4==e?t._itemlist[2]:5==e?t._itemlist[3]:6==e?t.m_pRightArrow:void 0})}}),cc._RF.pop()},{ArenaBufferMgr:"ArenaBufferMgr",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],ActivityQCJJItem:[function(e,t,a){"use strict";cc._RF.push(t,"a248fng25FEN7MxBKWpznnV","ActivityQCJJItem");e("StagesConfigMgr"),e("EliteStagesConfigMgr");var i=e("TestActivityLayer"),ce=e("MyProtocols"),le=e("SoundUtil"),he=e("i18n");cc.Class({extends:cc.Component,properties:{m_pName:cc.Label,lab_extraMsg:cc.RichText,m_pItemContent:cc.Node,m_pProgress:cc.Label,lab_btnName:cc.Label,m_pItemBoxPrefab:cc.Prefab,m_pItemEffect:cc.Prefab,m_pGetMask:cc.Node,m_pGetBtn:cc.Button,_activityState:0,_actId:-1,_itemScript:[],_pjson:null,_levelIndex:0,_progress:0,_canGet:!1,_index:0,_retInfo:null},onLoad:function(){},changeData:function(e,t,a){this.lab_btnName.string=" cấu mua ",this._activityState=0,this._pjson=e,this._levelIndex=t,this._actId=a,this.CreateName(e),this.ClearItemBox(),this.CreateRewardItems(e),this.SetProgress();var n=new cc.Component.EventHandler;n.target=this.node,n.component="ActivityQCJJItem",n.handler="GetReward_OnClick",n.customEventData="",this.m_pGetBtn.clickEvents[0]=n},GetRewardDynamicChange:function(e){this._pjson=e,this.SetProgress()},GetRewardChange:function(e,t,a,n){this._pjson=e,this._levelIndex=t,this._progress=a,this._canGet=n,this.SetProgress()},CreateName:function(e){var t=DonotDestroyManager.GameData.ActivityDynamic[this._actId];this.m_pName.string=cc.js.formatStr(t.level_des,e.price),null!=window.open_platform&&2==window.open_platform&&cc.sys.os==cc.sys.OS_IOS&&(this.m_pName.string=cc.js.formatStr(t.level_des_wanba_ios,10*e.price)),this.lab_extraMsg.string=cc.js.formatStr(" giá trị <color=#0fff00>%d</c> vàng đạo cụ, thêm vào <color=#0fff00>%d</c> vàng ",e.favor_rate,e.extra_diamond)},SetProgress:function(){this.m_pProgress.node.active=!1,this.JudgeDynamic()},JudgeDynamic:function(){0<this._pjson.buy_count?(this.m_pGetBtn.node.active=!0,this.m_pGetMask.active=!1):(this.m_pGetBtn.node.active=!1,this.m_pGetMask.active=!0)},CreateRewardItems:function(e){var t;if(this._itemScript=[],0==this._itemScript.length){0!=e.extra_diamond&&this.CreateItemBox(1451,e.extra_diamond),t=e.reward.length;for(var a=0;a<t;++a)
this.CreateItemBox(e.reward[a].nID,e.reward[a].nNum)}},CreateItemBox:function(e,t){var a=i.getInstance().myPool.get();null==a&&(a=cc.instantiate(this.m_pItemBoxPrefab)),this.m_pItemContent.addChild(a);var n=a.getComponent("ItemBox");n.ChangeItemInfo(e,t,!0,null,!0),null!=n._itemjsoninfo.tier&&0<n._itemjsoninfo.tier&&(n._tiereffect=cc.instantiate(this.m_pItemEffect),a.addChild(n._tiereffect)),this._itemScript.push(n)},ClearItemBox:function(){for(var e=this.m_pItemContent.children.concat(),t=0;t<e.length;++t)
i.getInstance().myPool.put(e[t]);e=[]},GetReward_OnClick:function(e,t){if(le.playBtnOpenEffect(),cc.log(" gửi đi dự tiền trả tin tức ,index=%d",this._levelIndex),null!=window.open_platform){var a=" thanh xuân quỹ ";switch(window.open_platform){case 1:ce.send_C2SQunheiPayPre(DonotDestroyManager._gameSocket,this._levelIndex+300,a);break;case 2:ce.send_C2SWanBaGetBalance(DonotDestroyManager._gameSocket,window.OPEN_DATA.appid,window.OPEN_DATA.openid,window.OPEN_DATA.openkey,window.OPEN_DATA.pf,window.OPEN_DATA.platform,this._levelIndex+300,a);break;case 3:ce.send_C2SZMPayCheck(DonotDestroyManager._gameSocket,this._levelIndex+300,a);break;case 4:var n=window.THREE33.gameId;window.THREE33.uid;ce.send_C2S333PayPre(DonotDestroyManager._gameSocket,n,a,this._levelIndex+300);break;case 5:ce.send_C2SChongChongPayPre(DonotDestroyManager._gameSocket,this._levelIndex+300,a);break;case 6:ce.send_C2S4399PayPre(DonotDestroyManager._gameSocket,this._levelIndex+300,a)}}
if(2==DonotDestroyManager.jsbChannel){var i=this._levelIndex+300,r=DonotDestroyManager.GameData.Charge.activityProducts[i],s=100*r.rmb,o=r.name,c=i+"_"+MyPersistDataManager._playerData.server_id,l=he.t("pay_yijie_callback_url");window.webkit.messageHandlers.pay.postMessage({unitPrice:s,itemName:o,count:1,callBackInfo:c,callBackUrl:l})}else{if(3==DonotDestroyManager.jsbChannel){var h=this._levelIndex+300,d=DonotDestroyManager.GameData.Charge.activityProducts[h].product_id;return void(cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("LejiIAPApi","BuyProduct:",d))}
if(4==DonotDestroyManager.jsbChannel){var _=this._levelIndex+300,u=DonotDestroyManager.GameData.Charge.activityProducts[_],m=100*u.rmb,p=u.name,f=u.product_id,g=_+"_"+MyPersistDataManager._playerData.server_id+"_"+MyPersistDataManager._playerData.account_id;return void(cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("ShYunbeeOpenApi","neigou:and1:and2:and3:",m,p,f,g))}
if(5==DonotDestroyManager.jsbChannel){var y=this._levelIndex+300,v=DonotDestroyManager.GameData.Charge.activityProducts[y],M=v.rmb,S=v.name,C=v.product_id;if(cc.sys.os===cc.sys.OS_IOS){var D=Math.random().toString(36).substr(2),I=MyPersistDataManager._playerData.server_id+"",b="S#"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(b=DonotDestroyManager._gameServerInfo.server_name);var P=MyPersistDataManager._playerData.server_id+"_"+y,L=MyPersistDataManager._playerData.id+"",B=MyPersistDataManager._playerData.name+"";jsb.reflection.callStaticMethod("BjLiuyeOpenApi","neigou:and1:and2:and3:and4:and5:and6:and7:and8:",D,I,b,C,P,M+"",L,B,S)}
return}
if(6==DonotDestroyManager.jsbChannel||7==DonotDestroyManager.jsbChannel){var w=this._levelIndex+300,E=DonotDestroyManager.GameData.Charge.activityProducts[w],k=100*E.rmb,T=E.name,A=E.product_id,R=w+"_"+MyPersistDataManager._playerData.server_id,F=he.t("pay_xingteng_callback_url");jsb.reflection.callStaticMethod("CfXingTengOpenApi","zfu:and1:and2:and3:and4:and5:",k,T,1,R,F,A)}else if(8==DonotDestroyManager.jsbChannel){var x=this._levelIndex+300,U=DonotDestroyManager.GameData.Charge.activityProducts[x],N=MyPersistDataManager._playerData.account_id.substr(3),G=U.product_id,H=x,O=MyPersistDataManager._playerData.id+"",q=MyPersistDataManager._playerData.name,j=MyPersistDataManager._playerData.level+"",V=MyPersistDataManager._playerData.server_id+"",z="S"+MyPersistDataManager._playerData.server_id,W=MyPersistDataManager._playerData.gameMoney+"",J=MyPersistDataManager._playerData.vip_level+"",Z=MyPersistDataManager._playerData.money+"",Y=MyPersistDataManager._playerData.fight+"";jsb.reflection.callStaticMethod("GzPingPingOpenApi","zfu:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:and11:",N,G,H,O,q,j,V,z,W,J,Z,Y)}else if(9==DonotDestroyManager.jsbChannel){var K=this._levelIndex+300,Q=DonotDestroyManager.GameData.Charge.activityProducts[K],X=Q.rmb,$=Q.name,ee=Q.product_id,te=K+"_"+MyPersistDataManager._playerData.server_id;jsb.reflection.callStaticMethod("MxsgDouWanOpenApi","fufee:and1:and2:and3:",X,$,ee,te)}else if(11==DonotDestroyManager.jsbChannel){var ae=this._levelIndex+300,ne=DonotDestroyManager.GameData.Charge.activityProducts[ae],ie="S"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(ie=DonotDestroyManager._gameServerInfo.server_name),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","pay","(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V",MyPersistDataManager._playerData.money,ne.rmb,ae.toString(),ne.name,ne.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),ie,MyPersistDataManager._playerData.vip_level.toString()):jsb.reflection.callStaticMethod("SDKHandler","pay:and1:and2:and3:and4:and5:and6:and7:and8:",MyPersistDataManager._playerData.server_id.toString(),ie,ae.toString(),ne.name,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),ne.rmb.toString(),ae.toString())}else if(12==DonotDestroyManager.jsbChannel){var re=this._levelIndex+300,se=DonotDestroyManager.GameData.Charge.activityProducts[re],oe="S"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(oe=DonotDestroyManager._gameServerInfo.server_name),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","pay","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;IILjava/lang/String;Ljava/lang/String;)V",MyPersistDataManager._playerData.server_id.toString(),oe,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.money.toString(),se.name,1,se.rmb,re.toString(),re+"_"+MyPersistDataManager._playerData.server_id):jsb.reflection.callStaticMethod("QuickSDKHandler","charge:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:and11:",re.toString(),se.rmb,re+"_"+MyPersistDataManager._playerData.server_id,oe,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.money.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.level.toString(),se.name,1)}}}}),cc._RF.pop()},{EliteStagesConfigMgr:"EliteStagesConfigMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",StagesConfigMgr:"StagesConfigMgr",TestActivityLayer:"TestActivityLayer",i18n:"i18n"}],ActivityQiZhenYiBaoPanel:[function(e,t,a){"use strict";cc._RF.push(t,"59b39i/aHhAbYUKeEcXUAJ9","ActivityQiZhenYiBaoPanel");var r=e("SoundUtil"),n=e("MyEventDispatcher"),i=e("NetEvent"),s=e("MyProtocols"),o=e("GameUtils");e("i18n");cc.Class({extends:cc.Component,properties:{lab_my_count:cc.Label,lab_left_count:cc.Label,lab_1_cost_gold:cc.Label,lab_win_value:cc.Label,lab_cd_time:cc.Label,pre_itembox:cc.Prefab,pre_player_item:cc.Prefab,m_pRewardPanel:cc.Prefab,node_big_award_parent:cc.Node,node_1_award_parent:cc.Node,node_player_join_parent:cc.Node,node_history_win_parent:cc.Node,_sum_dt:0},onLoad:function(){this.S2CQiZhenYiBaoJoin_cb_func=this.S2CQiZhenYiBaoJoin_cb.bind(this),n.addListener(i.S2CQiZhenYiBaoJoin,this.S2CQiZhenYiBaoJoin_cb_func),this.PushQiZhenYiBaoKaiJiang_cb_func=this.PushQiZhenYiBaoKaiJiang_cb.bind(this),n.addListener(i.PushQiZhenYiBaoKaiJiang,this.PushQiZhenYiBaoKaiJiang_cb_func)},onDestroy:function(){n.removeListener(i.S2CQiZhenYiBaoJoin,this.S2CQiZhenYiBaoJoin_cb_func),n.removeListener(i.PushQiZhenYiBaoKaiJiang,this.PushQiZhenYiBaoKaiJiang_cb_func)},PushQiZhenYiBaoKaiJiang_cb:function(e){if(e.award_player.player_id==MyPersistDataManager._playerData.id){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=[this._netData.big_award],t.getComponent("GetRewardPanel")._closeCb=null}
e.award_player.count=this._netData.history_players.length+1,this._netData.history_players.push(e.award_player),this._netData.my_count=0,this._netData.players=[],this.refreshDynamicUI()},S2CQiZhenYiBaoJoin_cb:function(e){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=this._netData.fixed_award,t.getComponent("GetRewardPanel")._closeCb=null,r.playGainGoodsEffectNew(),this._netData.my_count++;for(var a=!1,n=0;n<this._netData.players.length;n++){var i=this._netData.players[n];if(i.player_id==MyPersistDataManager._playerData.id){i.count++,a=!0;break}}
a||this._netData.players.push({player_id:MyPersistDataManager._playerData.id,player_name:MyPersistDataManager._playerData.name,count:1}),this.refreshDynamicUI()},start:function(){this.refreshDynamicUI(),this.lab_1_cost_gold.string=this._netData.cost_diamond+" vàng / thứ ",this.lab_win_value.string=" giải thưởng lớn giá trị ："+this._netData.big_award_value;for(var e=0;e<this._netData.fixed_award.length;e++){var t=this._netData.fixed_award[e],a=cc.instantiate(this.pre_itembox);a.scale=.85,this.node_1_award_parent.addChild(a),a.getComponent("ItemBox").ChangeItemInfo(t.nID,t.nNum,!0,null,!0)}
var n=cc.instantiate(this.pre_itembox);this.node_big_award_parent.addChild(n),n.getComponent("ItemBox").ChangeItemInfo(this._netData.big_award.nID,this._netData.big_award.nNum,!0,null,!0);var i=o.formatDate(this._netData.end_cd_time);this.lab_cd_time.string=" đổ thời trước ："+i},refreshDynamicUI:function(){this.lab_my_count.string=" ta đã tham dự ："+this._netData.my_count+" lần";for(var e=0,t=0;t<this._netData.players.length;t++){e+=this._netData.players[t].count}
this.lab_left_count.string=" còn nhu "+(this._netData.player_count_kaijiang-e)+" thứ tham dự liền mở thưởng ！\n số lần càng nhiều, trúng thưởng xác suất càng cao ！",this._netData.players.sort(function(e,t){return t.count-e.count}),0==this._netData.players.length&&this.node_player_join_parent.destroyAllChildren();for(var a=0;a<this._netData.players.length;a++){var n=this._netData.players[a],i=this.node_player_join_parent.children[a];null==i&&(i=cc.instantiate(this.pre_player_item),this.node_player_join_parent.addChild(i)),i.getComponent(cc.Label).string=n.player_name+" "+n.count+" lần"}
for(var r=0;r<this._netData.history_players.length;r++){var s=this._netData.history_players[r],o=this.node_history_win_parent.children[r];null==o&&(o=cc.instantiate(this.pre_player_item),this.node_history_win_parent.addChild(o)),o.getComponent(cc.Label).string=s.count+"."+s.player_name}},setParams:function(e){this._netData=e.info,this.closeCb=e.closeCb},clickHanlder_join:function(e,t){s.send_C2SQiZhenYiBaoJoin(DonotDestroyManager._gameSocket)},Back_onClickHandler:function(){r.playBtnCloseEffect(),MyUiManager.Back()},update:function(e){if(this._sum_dt+=e,1<=this._sum_dt){this._netData.end_cd_time--;var t=o.formatDate(this._netData.end_cd_time);this.lab_cd_time.string=" đổ thời trước ："+t,this._sum_dt=0}}}),cc._RF.pop()},{GameUtils:"GameUtils",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],ActivityZPCJDetail:[function(e,t,a){"use strict";cc._RF.push(t,"825c2LwM79KcqQ4kwlzTLeh","ActivityZPCJDetail");var n=e("TestActivityLayer"),i=e("MyProtocols"),r=e("MyEventDispatcher"),s=e("MyUIEvent"),o=e("SoundUtil"),c=[[-180,120],[0,120],[180,120],[180,0],[180,-120],[0,-120],[-180,-120],[-180,0]];cc.Class({extends:cc.Component,properties:{m_pItemBoxPrefab:cc.Prefab,itemBoxRootNode:cc.Node,labLeftFreeCount:cc.Label,labJinKuaiCost:cc.Label,nodeFreeCount:cc.Node,nodePayCost:cc.Node,btnDoLottery:cc.Button,_netData:null,_actId:-1,_delayTime:.1,_selectedBoxIdx:0,_selectSpriteNode:cc.Node,_loopCount:0,_isLoterrying:!1,_gainItems:null},onLoad:function(){this.ActivityProgressUpdate_cb_func=this.ActivityProgressUpdate_cb.bind(this),r.addListener(s.ActivityProgressUpdate,this.ActivityProgressUpdate_cb_func)},onDestroy:function(){r.removeListener(s.ActivityProgressUpdate,this.ActivityProgressUpdate_cb_func)},ActivityProgressUpdate_cb:function(e){if(e.activeIdType==this._actId){var t=e.progress;if(this.lab_btnBuy.string=-1==t?" cấu mua ":" lĩnh thủ ",null!=this.itemBoxRootNode&&t<this.itemBoxRootNode.length)
this.itemBoxRootNode[t].SetSelect(!0,0)}},GetRewardDynamicChange:function(e,t){this._gainItems=t,this.doLottery(e)},changeData:function(e,t){this._actId=t;(this._netData=e).nComplete;for(var a=e.lottery_wheel_config,n=0;n<a.reward.length;n++){var i=a.reward[n];this.CreateItemBox(i.nID,i.nNum,n)}
this.refreshView()},refreshView:function(){0<this._netData.lottery_wheel_config.my_free_count?(this.nodeFreeCount.active=!0,this.nodePayCost.active=!1):(this.nodeFreeCount.active=!1,this.nodePayCost.active=!0),this.labLeftFreeCount.string=this._netData.lottery_wheel_config.my_free_count,this.labJinKuaiCost.string="x"+this._netData.lottery_wheel_config.pay_price},CreateItemBox:function(e,t,a){var n=cc.instantiate(this.m_pItemBoxPrefab);n.setPosition(c[a][0],c[a][1]),this.itemBoxRootNode.addChild(n),n.getComponent("ItemBox").ChangeItemInfo(e,t,!0,null,!0)},doLotteryClickHander:function(e,t){if(o.playBtnOpenEffect(),1!=this._isLoterrying)
if(this._netData.lottery_wheel_config.my_free_count<=0&&this._netData.lottery_wheel_config.my_pay_count<=0)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," hôm nay trừu thưởng số lần đã muốn dùng hoàn ！");else{if(this._netData.lottery_wheel_config.my_free_count<=0&&MyPersistDataManager._playerData.money<this._netData.lottery_wheel_config.pay_price){var a=this;return this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),void this._alert_layer.getComponent("AlertLayerManager").initContent("Không đủ Vàng, bấm đến giao diện nạp",function(){a._alert_layer.removeFromParent(),a._alert_layer.destroy(),a._alert_layer=null,MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1})})}
i.send_C2SActivitiesGetAward(DonotDestroyManager._gameSocket,this._actId,0)}
else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," đang ở mở thưởng trung, thỉnh sau đó thử lại ！")},doLottery:function(e){this._targetIdx=e,this._loopCount=0,this._delayTime=.08,this._isLoterrying=!0;var t=this.itemBoxRootNode.children[0].getComponent("ItemBox").m_pSelectSprFrame[0];null==this._selectSpriteNode&&(this._selectSpriteNode=new cc.Node,this._selectSpriteNode.addComponent(cc.Sprite).spriteFrame=t);this._selectedBoxIdx=0,this._selectSpriteNode.parent=this.itemBoxRootNode.children[this._selectedBoxIdx],this._selectSpriteNode.setPosition(0,0),this.node.runAction(cc.sequence(cc.delayTime(this._delayTime),cc.callFunc(function(){this.loopLottery()},this)))},loopLottery:function(){this._delayTime*=1.1,this._selectedBoxIdx++,8<=this._selectedBoxIdx&&(this._selectedBoxIdx=0,this._loopCount++),this._selectSpriteNode.parent=this.itemBoxRootNode.children[this._selectedBoxIdx],this._selectSpriteNode.setPosition(0,0),2<=this._loopCount&&this._targetIdx<=this._selectedBoxIdx?this.node.runAction(cc.sequence(cc.delayTime(.7),cc.callFunc(function(){this._isLoterrying=!1,this.refreshView();for(var e=[],t=0;t<this._gainItems.length;++t)
e.push({itemId:this._gainItems[t].nID,cnt:this._gainItems[t].nNum});var a=cc.instantiate(n.getInstance().m_pRewardPanel);cc.Canvas.instance.node.addChild(a),a.getComponent("GetRewardPanel")._itemlist=e},this))):this.node.runAction(cc.sequence(cc.delayTime(this._delayTime),cc.callFunc(function(){this.loopLottery()},this)))},reuseItemBox:function(){}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil",TestActivityLayer:"TestActivityLayer"}],AdditionCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"21e3bhWZu9K5L7QsRX1Lgp/","AdditionCfgMgr"),t.exports={getAdditionById:function(e){return DonotDestroyManager.GameData.Additions[e]}},cc._RF.pop()},{}],AlertLayerManager:[function(e,t,a){"use strict";cc._RF.push(t,"83c3b+TWoVCwYqDGYgU/x8v","AlertLayerManager");var n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{lbl_tips_text:cc.Label,m_pLeftBtn:cc.Node,m_pRightBtn:cc.Node,m_pLeftBtnvalue:cc.Label,m_pRightBtnvalue:cc.Label,_callbackFunc:null,_RcallbackFunc:null,_maskClickClose:!0},onLoad:function(){},initContent:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:" xác định ";this.lbl_tips_text.string=e,this._callbackFunc=t,this._maskClickClose=a,this.SetBtnInfo(n)},InitTwoBtnContent:function(e,t,a){var n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:" xác định ",r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"Hủy";this.lbl_tips_text.string=e,this._maskClickClose=n,this._callbackFunc=t,this._RcallbackFunc=a,this.SetBtnInfo(i,r)},SetBtnInfo:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(this.m_pLeftBtnvalue.string=e,this.m_pLeftBtn.active=!0,this.m_pLeftBtnvalue.node.active=!0,null==t)
return this.m_pRightBtn.active=!1,this.m_pRightBtnvalue.node.active=!1,this.m_pLeftBtn.setPosition(0,-97),void this.m_pLeftBtnvalue.node.setPosition(0,-97);this.m_pRightBtnvalue.string=t,this.m_pRightBtn.active=!0,this.m_pRightBtnvalue.node.active=!0,this.m_pLeftBtn.setPosition(-110,-97),this.m_pLeftBtnvalue.node.setPosition(-110,-97),this.m_pRightBtn.setPosition(110,-97),this.m_pRightBtnvalue.node.setPosition(110,-97)},doBtnClick:function(e){n.playBtnOpenEffect(),null!=this._callbackFunc&&this._callbackFunc()},doRbtnClick:function(e){n.playBtnCloseEffect(),null!=this._RcallbackFunc&&this._RcallbackFunc()},Mack_OnClickHandler:function(){n.playBtnCloseEffect(),1==this._maskClickClose&&(this.node.removeFromParent(),this.node.destroy())}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],AnnounceLayer:[function(e,t,a){"use strict";cc._RF.push(t,"5afaerp6RtG3JZVZsJq+P1W","AnnounceLayer");var n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{ann_content:cc.Label},start:function(){},initContent:function(e){this.ann_content.string=e},closeHandler:function(e){n.playBtnCloseEffect(),this.node.destroy()}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],AreanBattleManager:[function(e,t,a){"use strict";cc._RF.push(t,"10544p06eJOP4hPYKmawwFK","AreanBattleManager");e("TeamDataUtil");var _=e("BattleDataManager"),n=e("BattleUtil"),u=e("HeroConfigMgr"),i=e("MyProtocols"),r=e("ArenaBufferMgr"),d=e("PlayerBufferMgr"),m=e("HeroBufferMgr"),p=e("BattleBufferMgr"),s=function(){};s.prototype.init=function(e,t,a){var n=DonotDestroyManager.GameData.StageMobs;this.leftData=this.getLeftData(),this.rightData=this.getRightData(e),this.leftData.fightVal=t,this.rightData.fightVal=a,this.background=n[101].battleground,this.mEmenyData=e},s.prototype.enterBattlefield=function(){var e=DonotDestroyManager.GameData.TeamSkillsAI,t={background:this.background,teamAiCfg:e[4],type:4},a=this;n.createBattlefield(this.leftData,this.rightData,t,function(){a.onSuccess()},function(){a.onFailure()}),n.enterRealScene()},s.prototype.onSuccess=function(){var e=r.getRightIndex(),t=this.randkey-MyPersistDataManager._playerData.id;i.send_C2SArenaBattleCalculate(DonotDestroyManager._gameSocket,e,1,t)},s.prototype.onFailure=function(){var e=r.getRightIndex(),t=this.randkey-MyPersistDataManager._playerData.id;i.send_C2SArenaBattleCalculate(DonotDestroyManager._gameSocket,e,0,t)},s.prototype.getLeftData=function(){var e={side:"left"};e.name=d.getNickName(),e.level=d.getUserLevel();var t=p.getFormationData(2);e.formation=t.formationId,e.forward=t.forward,e.flip=t.flip;for(var a=_.create(e),n=Object.keys(t),i=0;i<n.length;++i){var r=n[i];if("fid"!=r&&"formationId"!=r&&"forward"!=r&&"flip"!=r&&"0"!=r){var s=t[r],o=m.getHeroByUid(s);o&&(delete o.hpPerc,delete o.atkPerc,a.addCardWithPosition(o,r))}}
for(var c=0;c<a.teams.length;c++){var l=a.teams[c],h=m.getExtraPropAttr(l.hero.heroId);l.hero.extraAttr=cc.clone(h)}
return a},s.prototype.getRightData=function(n){var e={side:"right"};e.name=n.base_info.nickname,e.level=n.base_info.level,e.fightVal=n.base_info.fight,e.formation=n.formation.formationId,e.forward=n.formation.forward,e.flip=n.formation.flip;for(var t=_.create(e),a=n.formation,i=[a.a,a.b,a.c,a.d,a.e,a.f,a.g,a.h,a.i,a.j],r=function(e){for(var t=Object.keys(n.formation),a=0;a<t.length;++a){if("fid"!=t[a]&&"formationId"!=t[a]&&"forward"!=t[a]&&"flip"!=t[a])
if(e==n.formation[t[a]])
return t[a]}},s=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a]},o=DonotDestroyManager.GameData.Common,c=0;c<i.length;++c){var l=i[c];if(!o.FIGHT_CONTROL_ENEMY[3]&&0!=l){var h=s(n.cards,l);if(null!=h){var d={hero:{}};d.hero.id=h.template_id,d.hero.heroId=h.template_id,d.hero.level=h.level,d.hero.grade=h.grade,d.unit_level=h.unitLevel,d.unit_grade=h.unitGrade,d.unit_num=u.getHeroUnitNum(d.hero.grade,d.hero.id),t.addHeroWithPosition(d,r(d.hero.id))}}}
return t},t.exports=new s,cc._RF.pop()},{ArenaBufferMgr:"ArenaBufferMgr",BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",BattleUtil:"BattleUtil",HeroBufferMgr:"HeroBufferMgr",HeroConfigMgr:"HeroConfigMgr",MyProtocols:"MyProtocols",PlayerBufferMgr:"PlayerBufferMgr",TeamDataUtil:"TeamDataUtil"}],AreanBreakUp:[function(e,t,a){"use strict";cc._RF.push(t,"91cb3JjAN5LBYC3FlAR2Qep","AreanBreakUp");var i=e("SoundUtil");cc.Class({extends:cc.Component,properties:{ske_pLevelUp:sp.Skeleton,m_pMaxRank:cc.Label,m_pCurRank:cc.Label,m_pRankChange:cc.Label,m_pMoney:cc.Label,m_pmaxRankTitle:cc.Node,m_pcurRankTitle:cc.Node,m_pArrow:cc.Node,m_pLinetext:cc.Node,m_pGoldicon:cc.Node,m_pTipLab:cc.Node,_rankinfo:null},onLoad:function(){},ChangeData:function(e){this._rankinfo=e.info,this._cb=e.cb,this.Init()},Init:function(){this.m_pMaxRank.string=this._rankinfo.maxRank,this.m_pCurRank.string=this._rankinfo.new_rank;var e="( "+(this._rankinfo.maxRank-this._rankinfo.new_rank)+")";this.m_pRankChange.string=e,this.m_pMoney.string="+"+this._rankinfo.rankImproveMoney,this.ShowAction()},ShowAction:function(){var a=this,n=this.node.getChildByName("root");n.opacity=0,this.m_pMaxRank.node.opacity=0,this.m_pCurRank.node.opacity=0,this.m_pRankChange.node.opacity=0,this.m_pcurRankTitle.opacity=0,this.m_pmaxRankTitle.opacity=0,this.m_pArrow.opacity=0,this.m_pLinetext.opacity=0,this.m_pMoney.node.opacity=0,this.m_pGoldicon.opacity=0,this.m_pTipLab.opacity=0,i.playLevelUpEffect(),this.ShowRankUp(function(){var t=0;n.runAction(cc.fadeIn(.2)),t=.2,a.m_pmaxRankTitle.runAction(cc.sequence(cc.delayTime(t),cc.fadeIn(.15))),a.m_pcurRankTitle.runAction(cc.sequence(cc.delayTime(t),cc.fadeIn(.15))),t+=.05,a.m_pMaxRank.node.runAction(cc.sequence(cc.delayTime(t),cc.fadeIn(.13),cc.callFunc(function(){a.runtext("maxRank",a.m_pMaxRank,a._rankinfo.maxRank)}))),t+=.16,a.m_pCurRank.node.runAction(cc.sequence(cc.delayTime(t),cc.fadeIn(.13),cc.callFunc(function(){a.runtext("curRank",a.m_pCurRank,a._rankinfo.new_rank)}))),t+=.3,a.m_pArrow.runAction(cc.sequence(cc.delayTime(t),cc.fadeIn(.1),cc.callFunc(function(){a.m_pArrow.runAction(cc.repeatForever(cc.sequence(cc.moveBy(.3,cc.p(0,-5)),cc.moveBy(.3,cc.p(0,5)))))}))),a.m_pRankChange.node.runAction(cc.sequence(cc.delayTime(t),cc.fadeIn(.1))),t+=.3;var e=function(e){e.runAction(cc.sequence(cc.delayTime(t),cc.fadeIn(.15)))};e(a.m_pLinetext),e(a.m_pMoney.node),e(a.m_pGoldicon),e(a.m_pTipLab)})},runtext:function(e,t,a,n){var i=Math.ceil(a/15);t.string=i;var r=1,s=this;this[e+"_intervalId"]=setInterval(function(){if(r<a)
return a<(r+=i)&&(r=a),void(t.string=r);clearInterval(s[e+"_intervalId"]),t.node.stopAllActions(),n&&n()},30)},ShowRankUp:function(t){this.ske_pLevelUp.setAnimation(0,"RankUp",!1),this.ske_pLevelUp.setCompleteListener(function(e){t()})},Mask_OnClickHandler:function(e){i.playBtnCloseEffect(),this.node.destroy()},onDestroy:function(){clearInterval(this._intervalId),this._cb&&this._cb()}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],AreanMainLayer:[function(e,t,a){"use strict";cc._RF.push(t,"b7f0eES6ARDv6aN5WY3k7Ft","AreanMainLayer");var n=e("NetEvent"),i=e("MyEventDispatcher"),r=e("MyProtocols"),s=e("BattleBufferMgr"),o=e("ArenaBufferMgr"),c=e("TimeUtil"),l=e("SoundUtil"),h=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pArenaReprotLayer:cc.Node,m_pRankItem:cc.Node,m_pContent:cc.Node,m_pRankContent:cc.Node,m_pLuckRankLayer:cc.Prefab,m_pFormationLayer:cc.Prefab,m_pLevel:cc.Label,m_pName:cc.Label,m_pFight:cc.Label,m_pCurRank:cc.Label,m_pShengwang:cc.Label,m_pStamina:cc.Label,m_pTime:cc.Label,m_pTimeTitle:cc.Label,m_pTitle:cc.Sprite,m_pBtnXypm:cc.Button,m_pScrollView:cc.ScrollView,m_pBtnRefresh:cc.Node,mCloseBtn:cc.Node,m_pTabMenuNormalList:[cc.Sprite],m_pMenuSprList:[cc.SpriteFrame],m_pTitleSpr:[cc.SpriteFrame],shopItemPrefab:cc.Prefab,itemContentNode:cc.Node,exchangeNode:cc.ScrollView,honorNum:cc.Label,m_pRewardPanel:cc.Prefab,_curSelectTabMenuIndex:-1,_lastSelectTabMunuIndex:-1,_defaultindex:-1,_arenainfo:null,_rankitemlist:[],_TimeSec:-1,_counttime:0,_isTimeRunning:!1,_itemList:[],_jjcList:[],_arenaCount:[],_formatSlot:0},onLoad:function(){this.S2CArenaEnemyDetail_cb_func=this.S2CArenaEnemyDetail_cb.bind(this),i.addListener(n.S2CArenaEnemyDetail,this.S2CArenaEnemyDetail_cb_func),this.S2CArenaFormation_cb_func=this.S2CArenaFormation_cb.bind(this),i.addListener(n.S2CArenaFormation,this.S2CArenaFormation_cb_func),this.S2CLuckyRankInfo_cb_func=this.S2CLuckyRankInfo_cb.bind(this),i.addListener(n.S2CLuckyRankInfo,this.S2CLuckyRankInfo_cb_func),this.S2CArenaPlayerDetail_cb_func=this.S2CArenaPlayerDetail_cb.bind(this),i.addListener(n.S2CArenaPlayerDetail,this.S2CArenaPlayerDetail_cb_func),this.S2CArenaBattleRecord_cb_func=this.S2CArenaBattleRecord_cb.bind(this),i.addListener(n.S2CArenaBattleRecord,this.S2CArenaBattleRecord_cb_func),this.S2CArenaRefreshEnemy_cb_func=this.S2CArenaRefreshEnemy_cb.bind(this),i.addListener(n.S2CArenaRefreshEnemy,this.S2CArenaRefreshEnemy_cb_func),this.S2CArenaTopRankView_cb_func=this.S2CArenaTopRankView_cb.bind(this),i.addListener(n.S2CArenaTopRankView,this.S2CArenaTopRankView_cb_func),this.ArenaExchangeList_auth_cb_func=this.ArenaExchangeList_auth_cb.bind(this),i.addListener(n.S2CArenaExchangeList,this.ArenaExchangeList_auth_cb_func),this.ArenaExchange_auth_cb_func=this.ArenaExchange_auth_cb.bind(this),i.addListener(n.S2CArenaExchange,this.ArenaExchange_auth_cb_func)},onDestroy:function(){i.removeListener(n.S2CArenaEnemyDetail,this.S2CArenaEnemyDetail_cb_func),i.removeListener(n.S2CArenaFormation,this.S2CArenaFormation_cb_func),i.removeListener(n.S2CLuckyRankInfo,this.S2CLuckyRankInfo_cb_func),i.removeListener(n.S2CArenaPlayerDetail,this.S2CArenaPlayerDetail_cb_func),i.removeListener(n.S2CArenaBattleRecord,this.S2CArenaBattleRecord_cb_func),i.removeListener(n.S2CArenaRefreshEnemy,this.S2CArenaRefreshEnemy_cb_func),i.removeListener(n.S2CArenaTopRankView,this.S2CArenaTopRankView_cb_func),i.removeListener(n.S2CArenaExchangeList,this.ArenaExchangeList_auth_cb_func),i.removeListener(n.S2CArenaExchange,this.ArenaExchange_auth_cb_func)},setParams:function(e){this._arenainfo=o.mArenainfo,o.mOriRank=this._arenainfo.my_rank,h.isFirstArean()||this.PushSelfInfo(),this._defaultindex=0,this.Init(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},PushSelfInfo:function(){var e={};e.sexId=MyPersistDataManager._playerData.sex,e.playerId=MyPersistDataManager._playerData.id,e.level=MyPersistDataManager._playerData.level,e.rank=this._arenainfo.my_rank,e.fight=MyPersistDataManager._playerData.fight,e.nickname=MyPersistDataManager._playerData.name;for(var t=0;t<this._arenainfo.enemys.length&&this._arenainfo.enemys[t].playerId!=MyPersistDataManager._playerData.id;++t){if(this._arenainfo.enemys[t].rank>this._arenainfo.my_rank){this._arenainfo.enemys.splice(t,0,e);break}
if(t==this._arenainfo.enemys.length-1){this._arenainfo.enemys.push(e);break}}},Init:function(){null==MyPersistDataManager._playerData.pvpformation&&r.send_C2SArenaFormation(DonotDestroyManager._gameSocket),this.SetSelectTabMenu(this._defaultindex),this.TabMenuRegisterClickEvent(),this.showTime(),4<this._arenainfo.enemys.length&&this.m_pScrollView.scrollToPercentVertical(.4,.2)},InitLeftData:function(){this.m_pLevel.string="LV."+MyPersistDataManager._playerData.level,this.m_pName.string=MyPersistDataManager._playerData.name,this.m_pFight.string=MyPersistDataManager._playerData.fight,this.m_pCurRank.string=this._arenainfo.my_rank,this.m_pShengwang.string=MyPersistDataManager._playerData.honor,this.m_pStamina.string=MyPersistDataManager._playerData.stamina},S2CArenaTopRankView_cb:function(e){cc.log(" bài danh tiền 10 liệt biểu tiếp thu "),o.mArenainfo.top_ranks=e.top_ranks,this.m_pRankContent.active=!0,this.m_pBtnXypm.node.active=!0,this.InitLeftData(),this.CreateRankItem(this._arenainfo.top_ranks,1)},S2CArenaRefreshEnemy_cb:function(e){cc.log(" nảy sinh cái mới địch quân liệt biểu tin tức tiếp thu "),o.mArenainfo.enemys=e.enemys,this.PushSelfInfo(),this.CreateRankItem(this._arenainfo.enemys,0)},S2CArenaBattleRecord_cb:function(e){cc.log(" Đấu Trường chiến báo tin tức tiếp thu "),this.m_pArenaReprotLayer.active=!0,this.m_pArenaReprotLayer.getComponent("ArenaReportLayer").ChangeData(e)},S2CArenaPlayerDetail_cb:function(e){cc.log(" ngoạn gia anh hùng đội hình tin tức tiếp thu ");var t=cc.instantiate(this.m_pFormationLayer);cc.Canvas.instance.node.addChild(t),t.getComponent("ArmyFormationLayer").ChangeData(e)},S2CLuckyRankInfo_cb:function(e){cc.log(" tiếp thu may mắn bài danh tin tức ");var t=cc.instantiate(this.m_pLuckRankLayer);cc.Canvas.instance.node.addChild(t),t.getComponent("LuckRankLayer").ChangeData(e)},S2CArenaFormation_cb:function(e){cc.log(" tiếp thu pvp đội hình tin tức "),MyPersistDataManager._playerData.pvpformation=e.formation,null!=e.formation&&s.setFormationData(2,e.formation)},S2CArenaEnemyDetail_cb:function(e){cc.log(" chiến đấu tin tức tiếp thu "),o.setRightHero(e),this.OpenFormationLayer(e)},ArenaExchangeList_auth_cb:function(e){cc.log(" Đấu Trường liệt biểu "),MyPersistDataManager._playerData.arenaShopInfo=e,this.ReadArenaShopInfo(MyPersistDataManager._playerData.arenaShopInfo),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},ArenaExchange_auth_cb:function(e){cc.log(" Đấu Trường mua ");var t=[];t.push({itemId:e.rewards.item_template_id,cnt:e.rewards.item_count});var a=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(a),a.getComponent("GetRewardPanel")._itemlist=t;var n=this.rewardPanelClose.bind(this);a.getComponent("GetRewardPanel")._closeCb=n;for(var i=0;i<this._itemList.length;++i)
this._itemList[i].JjcJudgeCost();this.honorNum.string=MyPersistDataManager._playerData.honor;var r=e.slot_index;8==this._formatSlot&&r--;var s=DonotDestroyManager.GameData.Arena.exchange;if(0!=e.slot_index)
this._arenaCount[r]+=e.buy_count,MyPersistDataManager._playerData.arenaShopInfo.buy_count[e.slot_index]=this._arenaCount[r];else if(1011<this._jjcList[e.slot_index][0]&&this._jjcList[e.slot_index][0]<1017){if(!(3<=this._formatSlot&&this._formatSlot<8))
return this._jjcList.splice(e.slot_index,1),this._arenaCount.splice(e.slot_index,1),this._itemList[e.slot_index].node.removeFromParent(),this._itemList[e.slot_index].node.destroy(),void this._itemList.splice(e.slot_index,1);this._formatSlot=MyPersistDataManager._playerData.formationSlots;var o=1e4+this._formatSlot-2;this._jjcList[e.slot_index]=s[o]}
var c=this._jjcList[r],l=c[3]-this._arenaCount[r];l<0&&(l=0),this._itemList[r].ChangeData(c[0],c[1],l,c[2],e.slot_index)},rewardPanelClose:function(){this.showGuide()},ReadArenaShopInfo:function(e){this._arenaCount=e.buy_count;var t=DonotDestroyManager.GameData.Arena.exchange;this._formatSlot=MyPersistDataManager._playerData.formationSlots;var a=1e4+this._formatSlot-2;3<=this._formatSlot&&this._formatSlot<8&&this._jjcList.push(t[a]);for(var n=1;n<e.buy_count.length;++n)
this._jjcList.push(t[n]);this.ArenaItemsShow({items:this._jjcList,buy_count:this._arenaCount})},ArenaItemsShow:function(e){this.exchangeNode.node.active=!0,this.honorNum.string=MyPersistDataManager._playerData.honor,this.exchangeNode.scrollToLeft();var t=e.items;if(0==this._itemList.length)
for(var a=0;a<t.length;++a){var n=cc.instantiate(this.shopItemPrefab),i=n.getComponent("ShopItem");i.m_pItemSellMask.active=!1,i.m_pBuyBtn.enabled=!0;var r=a;8==this._formatSlot&&r++;var s=t[a][3]-e.buy_count[r];s<0&&(s=0),i._itemState=2,i.ChangeData(t[a][0],t[a][1],s,t[a][2],r),this._itemList.push(i),this.itemContentNode.addChild(n)}},TabMenuRegisterClickEvent:function(){for(var e=0;e<this.m_pTabMenuNormalList.length;++e){var t=new cc.Component.EventHandler;t.target=this.node,t.component="AreanMainLayer",t.handler="BtnClickHandler",t.customEventData=e.toString(),this.m_pTabMenuNormalList[e].getComponent(cc.Button).clickEvents[0]=t}},BtnClickHandler:function(e,t){cc.log(" điểm đánh nhãn :"+t),l.playBtnOpenEffect();var a=parseInt(t);this.SetSelectTabMenu(a),this._curSelectTabMenuIndex=a},SetSelectTabMenu:function(e){if(this._curSelectTabMenuIndex!=e){switch(-1!=this._lastSelectTabMunuIndex&&(this.m_pTabMenuNormalList[this._lastSelectTabMunuIndex].spriteFrame=this.m_pMenuSprList[0]),this._curSelectTabMenuIndex=e,this.m_pTabMenuNormalList[this._curSelectTabMenuIndex].spriteFrame=this.m_pMenuSprList[1],this._lastSelectTabMunuIndex=this._curSelectTabMenuIndex,this.m_pTitle.spriteFrame=this.m_pTitleSpr[e],this.m_pArenaReprotLayer.active=!1,this.m_pRankContent.active=!1,this.m_pBtnRefresh.active=!1,this.exchangeNode.node.active=!1,e){case 0:this.m_pScrollView.stopAutoScroll(),this.m_pRankContent.active=!0,this.m_pBtnRefresh.active=!0,this.m_pBtnXypm.node.active=!1,this.InitLeftData(),this.CreateRankItem(this._arenainfo.enemys,e);break;case 1:this.m_pScrollView.stopAutoScroll(),r.send_C2SArenaTopRankView(DonotDestroyManager._gameSocket);break;case 2:null==MyPersistDataManager._playerData.arenaShopInfo?r.send_C2SArenaExchangeList(DonotDestroyManager._gameSocket):(0==this._jjcList.length?this.ReadArenaShopInfo(MyPersistDataManager._playerData.arenaShopInfo):this.ArenaItemsShow({items:this._jjcList,buy_count:this._arenaCount}),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this))));break;case 3:r.send_C2SArenaBattleRecord(DonotDestroyManager._gameSocket)}}},showTime:function(){var e=(new Date).getTime(),t=(new Date).getHours();if(22<=t)
return this.m_pTimeTitle.string=" thưởng cho đã phát đưa đến hòm thư ",this.m_pTime.node.active=!1,void(this._isTimeRunning=!1);this._isTimeRunning=!0;var a=(new Date).getFullYear(),n=(new Date).getMonth(),i=(new Date).getDate(),r=new Date;r.setFullYear(a,n,i,t),r.setHours(22,0,0,0);var s=r.getTime();this._TimeSec=Math.floor((s-e)/1e3),this.m_pTime.string=c.secondToTime(this._TimeSec)},OpenFormationLayer:function(e){var t={name:e.base_info.nickname+"LV."+e.base_info.level,fight:e.base_info.fight,formation:e.formation.formationId,flip:e.formation.flip,forward:e.formation.forward,Teams:this.GetEnemyTeams(e),id:0};MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:t,panelinfo:{fid:2},battletype:4})},GetEnemyTeams:function(e){var t=[],a=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a].level;return 0};if(0<e.formation.a){var n=a(e.cards,e.formation.a);t.push({id:e.formation.a,level:n,position:"a"})}
if(0<e.formation.b){n=a(e.cards,e.formation.b);t.push({id:e.formation.b,level:n,position:"b"})}
if(0<e.formation.c){n=a(e.cards,e.formation.c);t.push({id:e.formation.c,level:n,position:"c"})}
if(0<e.formation.d){n=a(e.cards,e.formation.d);t.push({id:e.formation.d,level:n,position:"d"})}
if(0<e.formation.e){n=a(e.cards,e.formation.e);t.push({id:e.formation.e,level:n,position:"e"})}
if(0<e.formation.f){n=a(e.cards,e.formation.f);t.push({id:e.formation.f,level:n,position:"f"})}
if(0<e.formation.g){n=a(e.cards,e.formation.g);t.push({id:e.formation.g,level:n,position:"g"})}
if(0<e.formation.h){n=a(e.cards,e.formation.h);t.push({id:e.formation.h,level:n,position:"h"})}
if(0<e.formation.i){n=a(e.cards,e.formation.i);t.push({id:e.formation.i,level:n,position:"i"})}
if(0<e.formation.j){n=a(e.cards,e.formation.j);t.push({id:e.formation.j,level:n,position:"j"})}
return t},CreateRankItem:function(e,t){for(var a=0;a<e.length;++a){var n=null;if(a<this._rankitemlist.length)
n=this._rankitemlist[a];else{var i=cc.instantiate(this.m_pRankItem);this.m_pContent.addChild(i),n=i.getComponent("ArenaRankItem"),this._rankitemlist.push(n)}
n.node.active=!0;var r=a;e[a].rank>this._arenainfo.my_rank&&(r-=1),n.ChangeData({info:e[a],type:t,index:r})}
for(a=e.length;a<this._rankitemlist.length;++a)
this._rankitemlist[a].node.active=!1},Refresh_OnClickHandler:function(e){l.playBtnOpenEffect(),r.send_C2SArenaRefreshEnemy(DonotDestroyManager._gameSocket)},Lucky_OnClickHandler:function(e){l.playBtnOpenEffect(),r.send_C2SLuckyRankInfo(DonotDestroyManager._gameSocket)},Back_OnClickHandler:function(e){l.playBtnCloseEffect(),MyUiManager.Back()},update:function(e){this._isTimeRunning&&(this._counttime+=e,1<=this._counttime&&(this._counttime-=1,this._TimeSec--,this._TimeSec<=-10?(this._isTimeRunning=!1,this.m_pTimeTitle.string=" thưởng cho đã phát đưa đến hòm thư ",this.m_pTime.node.active=!1):this.m_pTime.string=c.secondToTime(this._TimeSec)))},showGuide:function(){var t=this;h.showGuide("AreanMainLayer",function(e){return 1==e?0:2==e?t.m_pTabMenuNormalList[2].node:3==e?t._rankitemlist[0].mBtnFight:4==e?t.mCloseBtn:5==e?t._itemList[0].m_pBuyBtn.node:void 0})}}),cc._RF.pop()},{ArenaBufferMgr:"ArenaBufferMgr",BattleBufferMgr:"BattleBufferMgr",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",TimeUtil:"TimeUtil"}],AreanRankUp:[function(e,t,a){"use strict";cc._RF.push(t,"baffdNDC85H06sPSFHaxp85","AreanRankUp");var n=e("ArenaBufferMgr"),i=e("GameUtils"),r="normal";cc.Class({extends:cc.Component,properties:{m_pDownCell:cc.Node,m_pUpCell:cc.Node,m_pBreakUp:cc.Prefab,m_pDownIcon:cc.Sprite,m_pUpIcon:cc.Sprite,m_pDownFight:cc.Label,m_pUpFight:cc.Label,m_pDownName:cc.Label,m_pUpName:cc.Label,m_pDownRank:cc.Label,m_pUpRank:cc.Label,m_pRankUp:cc.Prefab,m_pRankLeft:cc.Prefab,m_pRankRight:cc.Prefab,m_pHeadIconList:[cc.SpriteFrame],m_pBgList:[cc.SpriteFrame],m_pNamebglist:[cc.SpriteFrame],_mRankUpAni:null,_rankinfo:null,_frameeventani_cb:null},onLoad:function(){},ChangeData:function(e){this._rankinfo=e,this.Init()},Init:function(){this.InitData()},InitData:function(){this.m_pDownCell.opacity=0,this.m_pUpCell.opacity=0,this.m_pDownCell.setCascadeOpacityEnabled(!0),this.m_pUpCell.setCascadeOpacityEnabled(!0),this.node.setLocalZOrder(9902);var e=n.getRightHero();this.m_pUpIcon.spriteFrame=this.m_pHeadIconList[MyPersistDataManager._playerData.sex-1],this.m_pDownIcon.spriteFrame=this.m_pHeadIconList[e.base_info.sexId-1],this.m_pUpName.string=MyPersistDataManager._playerData.name,this.m_pDownName.string=e.base_info.nickname,this.m_pUpFight.string=MyPersistDataManager._playerData.fight,this.m_pDownFight.string=e.base_info.fight,this.m_pUpRank.string=n.mArenainfo.my_rank,this.m_pDownRank.string=n.mOriRank,this.CreateRankUp()},CreateRankUp:function(){this._mRankUpAni=cc.instantiate(this.m_pRankUp),this.node.addChild(this._mRankUpAni),this._mRankUpAni.setPosition(0,0);var e=this._mRankUpAni.getComponent(dragonBones.ArmatureDisplay);e.armature().animation.fadeIn("action1",-1,1,0,r),this._frameeventani_cb=this.frameeventani.bind(this),e.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameeventani_cb,this)},completeani:function(e){},frameeventani:function(e){if(cc.log("event.detail.name"+e.detail.name),"playother"==e.detail.name&&(this.CreateRankLeft(),this.CreateRankRight(),this.runUpAction(this.m_pUpCell,"IN"),this.runDownAction(this.m_pDownCell,"IN")),"shakescreen"==e.detail.name&&(cc.log("shakescreen==========="),this.playShakeScreen(this.node)),"complete"==e.detail.name){var a=this,t=function(){var e=a._mRankUpAni.getComponent(dragonBones.ArmatureDisplay),t=e.armature();e.removeEventListener(dragonBones.EventObject.FRAME_EVENT,a._frameeventani_cb,a),t.animation.fadeIn("action2",-1,1,0,r),a.runUpAction(a.m_pUpCell,"OUT"),a.runDownAction(a.m_pDownCell,"OUT")};if(this._rankinfo.maxRank>this._rankinfo.new_rank){var n=cc.instantiate(this.m_pBreakUp);this.node.addChild(n),n.getComponent("AreanBreakUp").ChangeData({info:this._rankinfo,cb:t})}else
i.callInNextTick(function(){t()})}},playShakeScreen:function(e){e.stopAllActions();var t=cc.sequence(cc.scaleTo(.05,1.05),cc.scaleTo(.06,.96),cc.scaleTo(.083,1.04),cc.scaleTo(.1,.97),cc.scaleTo(.11,1.03),cc.scaleTo(.13,.99),cc.scaleTo(.15,1.01),cc.scaleTo(.13,1));e.runAction(t)},CreateRankLeft:function(){var e=cc.instantiate(this.m_pRankLeft);this.m_pUpCell.addChild(e,100),e.setPosition(-5,-20),e.getComponent(dragonBones.ArmatureDisplay).armature().animation.fadeIn("action1",-1,1,0,r)},CreateRankRight:function(){var e=cc.instantiate(this.m_pRankRight);this.m_pDownCell.addChild(e,100),e.setPosition(5,-20),e.getComponent(dragonBones.ArmatureDisplay).armature().animation.fadeIn("action1",-1,1,0,r)},runUpAction:function(e,t){if(e.stopAllActions(),"IN"==t){e.opacity=0;var a=cc.spawn(cc.fadeIn(.1),cc.moveBy(.16,cc.p(0,250))),n=cc.moveBy(.33,cc.p(0,-5)),i=cc.moveBy(1.38,cc.p(0,-10));e.runAction(cc.sequence(a,n,i))}
if("OUT"==t){a=cc.fadeOut(.4);e.runAction(a)}},runDownAction:function(e,t){if(e.stopAllActions(),"IN"==t){e.opacity=0;var a=cc.spawn(cc.fadeIn(.1),cc.moveBy(.16,cc.p(0,-250))),n=cc.moveBy(.33,cc.p(0,5)),i=cc.moveBy(1.38,cc.p(0,10));e.runAction(cc.sequence(a,n,i))}
if("OUT"==t){var r=this;a=cc.fadeOut(.4);e.runAction(cc.sequence(a,cc.callFunc(function(){r._mRankUpAni.runAction(cc.fadeOut(.5)),r.node.destroy()})))}}}),cc._RF.pop()},{ArenaBufferMgr:"ArenaBufferMgr",GameUtils:"GameUtils"}],AreanWinPanel:[function(e,t,a){"use strict";function _(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
cc._RF.push(t,"6291eonQMpEiILHXEEJ/jfU","AreanWinPanel");e("GameUtils");var n=e("SoundUtil"),i=e("GuideBufferMgr"),r=e("MarqueeBufferMgr");cc.Class({extends:cc.Component,properties:{m_pwinpre:cc.Prefab,m_pItemBox:cc.Prefab,m_povallight:cc.Prefab,m_pRankup:cc.Prefab,m_pHonor:cc.Label,m_pExp:cc.Label,m_pMoney:cc.Label,m_pStamina:cc.Label,m_pcardicon2:cc.SpriteFrame,m_pLight:cc.Sprite,m_pmGainBox:cc.Node,m_pmGoldLine:cc.Node,m_pmLigthTab:[cc.Sprite],m_pmRewardTab:[cc.Node],m_pmRewardIcon:[cc.Sprite],m_pmLigthIconTab:[cc.Sprite],m_pmLigthSelectTab:[cc.Sprite],_recvdata:null,_rewardinfo:null,_mGetCardFinish:!1,_iscanclick:!1},onLoad:function(){},ChangeData:function(e){this._recvdata=e.info,this.setStatistics(e.leftinfo,e.rightinfo,e.staticData),this.Init()},Init:function(){this.InitData(),this.CreateWinarmature()},InitData:function(){this._iscanclick=!1,this._mGetCardFinish=!1,this._mIsTranCardIng=!1,this._mRewardOpenState=[!1,!1,!1];for(var e=this._recvdata.gain,t=0;t<e.length;++t){var a=e[t];1455==a.item_template_id?this.m_pHonor.string="+"+a.item_count:1450==a.item_template_id?this.m_pMoney.string="+"+a.item_count:1452==a.item_template_id?this.m_pExp.string="+"+a.item_count:this._rewardinfo=a}
this.m_pStamina.string="-"+DonotDestroyManager.GameData.Arena.stamina_cost},CreateWinarmature:function(){var t=this,e=cc.instantiate(this.m_pwinpre);this.node.addChild(e),e.setPosition(0,-50);var a=e.getComponent(sp.Skeleton);a.setAnimation(0,"action2",!1),a.setCompleteListener(function(e){t.playUIAni()})},playUIAni:function(){cc.log(" truyền phát tin thưởng cho động họa ");var n=this,e=cc.callFunc(function(){n.m_pmGainBox.active=!0,n.m_pmGainBox.opacity=0,n.m_pmGainBox.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){n.m_pmGoldLine.active=!0,n.m_pmGoldLine.opacity=0,n.m_pmGoldLine.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){for(var e=0;e<n.m_pmRewardTab.length;++e){n.m_pmRewardTab[e].active=!0,n.m_pmRewardTab[e].opacity=0,n.m_pmRewardTab[e].setScale(.95);var t=cc.spawn(cc.delayTime(.15*e),cc.scaleTo(.15,1.1),cc.fadeIn(.15),cc.delayTime(.15)),a=cc.spawn(cc.delayTime(.15*e),cc.scaleTo(.15,1));n.m_pmRewardTab[e].runAction(cc.sequence(t,a))}
n._iscanclick=!0,n.showGuide(n.m_pmRewardTab[1])}))),n.setCloseListener()})))});this.node.runAction(cc.sequence(cc.delayTime(.35),e))},setCloseListener:function(){for(var e=0;e<3;++e)
this.m_pmRewardTab[e].active=!1;this.playUnOpenCardsAni(1)},playUnOpenCardsAni:function(e){var t=this;this.runLigthAction(this.m_pmLigthTab[e].node,1,function(){2==e?e=0:e+=1,t.playUnOpenCardsAni(e)})},runLigthAction:function(e,t,a){e.active=!0;var n=this,i=cc.spawn(cc.fadeIn(.2),cc.scaleTo(.2,1.2)),r=cc.spawn(cc.fadeOut(.2),cc.scaleTo(.2,1.2)),s=cc.spawn(cc.fadeIn(.1),cc.scaleTo(.1,1.1)),o=cc.spawn(cc.fadeOut(.4),cc.scaleTo(.4,1.6)),c=cc.delayTime(.1);if(1==t&&e.runAction(cc.sequence(i,c,r,cc.callFunc(a))),2==t){var l=cc.callFunc(function(){var e=cc.sequence(cc.fadeOut(.3),cc.removeSelf(!0));n.m_pmLigthIconTab[n._mSelectId].node.runAction(e),n.m_pmLigthSelectTab[n._mSelectId].node.runAction(cc.fadeIn(.1))});e.runAction(cc.sequence(l,s,o,cc.callFunc(a)))}},runTurnCardAction:function(e,t,a,n,i,r){cc.log(" xoay tròn hạ tiêu ========="+t);var s=cc.rotateBy(.4,0,-90*e),o=cc.rotateBy(.3,0,-90*e),c=cc.callFunc(function(){n.active=!0,i&&i()}),l=null;null!=r?(l=cc.callFunc(r),a.runAction(cc.sequence(cc.delayTime(.4),s,c,o,l))):a.runAction(cc.sequence(cc.delayTime(.4),s,c,o))},loadRewardData:function(e){for(var t,a,n,i,r,s,o,c=this,l=(_(a={},(t=0==e?[0,1,2]:1==e?[1,0,2]:2==e?[2,1,0]:void 0)[0],{0:c._rewardinfo.item_template_id,1:c._rewardinfo.item_count}),_(a,t[1],{0:1005,1:1}),_(a,t[2],{0:1006,1:1}),a),h=Object.keys(l),d=0;d<h.length;++d)
n=h[d],i=l[h[d]],o=s=void 0,r={id:i[0],num:i[1],tips:!0,size:cc.size(100,100)},s=cc.instantiate(c.m_pItemBox),(o=s.getComponent("ItemBox")).ChangeItemInfo(r.id,r.num,!0,null,!0),o.m_pQuality.spriteFrame=c.m_pcardicon2,c.m_pmRewardIcon[n].node.addChild(s),c.m_pmRewardIcon[n].node.setScale(1.2)},playOpenCardsAni:function(e){var t=this;this.m_pmLigthTab[e].node.active=!0,this.runLigthAction(this.m_pmLigthTab[e].node,2,function(){t.m_pmLigthTab[e].node.stopAllActions(),t.m_pmLigthTab[e].node.active=!1})},closeBeforeAction:function(){for(var e=0;e<this.m_pmLigthTab.length;++e)
this.m_pmLigthTab[e].node.stopAllActions(),this.m_pmLigthTab[e].node.active=!1},getOpenCardIndex:function(e){if(null!=e&&0==this._mRewardOpenState[e])
return this._mRewardOpenState[e]=!0,e;for(var t=0;t<3;++t)
if(0==this._mRewardOpenState[t])
return this._mRewardOpenState[t]=!0,t;return-1},showOpenCardAction:function(t){var a=this;this.closeBeforeAction();var n=this.getOpenCardIndex(t);this._mSelectId=t,this.runTurnCardAction(3,n,this.m_pmRewardTab[n],this.m_pmRewardIcon[n].node,function(){var e;e=n,a.playOpenCardsAni(e),a.playOvalLight(a.m_pmRewardTab[e],cc.p(50,50))},function(){(function(){var e=a.getOpenCardIndex(t);a.runTurnCardAction(1,e,a.m_pmRewardTab[e],a.m_pmRewardIcon[e].node,null,null);e=a.getOpenCardIndex(e);a.runTurnCardAction(1,e,a.m_pmRewardTab[e],a.m_pmRewardIcon[e].node,null,null),a.performWithDelay(a.node,function(){a.checkRank()},1.5),a._mGetCardFinish=!0})()})},checkRank:function(){if(0<this._recvdata.isRankUp){cc.log(" biểu hiện bài danh bay lên ");var e=cc.instantiate(this.m_pRankup);this.node.addChild(e),e.getComponent("AreanRankUp").ChangeData(this._recvdata)}},performWithDelay:function(e,t,a){a=cc.delayTime(a);var n=cc.sequence(a,cc.callFunc(t));return e.runAction(n),n},playOvalLight:function(e,t){var a=cc.instantiate(this.m_povallight);e.addChild(a),a.setPosition(0,0);var n=a.getComponent(dragonBones.ArmatureDisplay);n.armature().animation.fadeIn("start",-1,1,0,"normal"),n.addEventListener(dragonBones.EventObject.COMPLETE,function(){a.destroy()},this)},Reward_OnClickHandler:function(e,t){var a=parseInt(t);this._mRewardOpenState[a]||(n.playBtnOpenEffect(),this.playCardAction(a))},playCardAction:function(e){this._mIsTranCardIng||(this._mIsTranCardIng=!0,this.loadRewardData(e),this.showOpenCardAction(e))},Mask_OnClickHandler:function(e){this._iscanclick&&(this._mGetCardFinish?(n.playBtnCloseEffect(),MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),r.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"):this.playCardAction(1))},showGuide:function(t){i.showGuide("AreanWinPanel",function(e){if(1==e)
return t})},setStatistics:function(e,t,a){this.statistics={left:e,right:t,data:a};var n={damage:-1};a.teams.forEach(function(e,t){e.damage>n.damage&&"left"==e.data.hero.side&&(n=e)})},BattleDetail_onClickHandler:function(){var n=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/BattleDetailLayer/BattleDetailLayer",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.node)){null!=n._shortMask_node&&(n._shortMask_node.destroy(),n._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("BattleDetailLayer").ChangeData(n.statistics.data)}})}}),cc._RF.pop()},{GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",MarqueeBufferMgr:"MarqueeBufferMgr",SoundUtil:"SoundUtil"}],ArenaBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"d0ad2y4p3hPm7lrMT/dI496","ArenaBufferMgr");var n=e("EnermyBufferMgr"),i=function(){};i.prototype.initBuffer=function(e){this.mArenainfo=e,this.mEnemyList=e.enemys,this.mRankList=e.ranks,this.mExchangeList=e.items,this.setEmBattleLastPage(2),this.mOriRank=e.my_rank,e.prevStaminaTime},i.prototype.setRightHero=function(e){n.getInstance().initEnermyData(e),this.mEnemyInfo=e},i.prototype.getRightHero=function(){return this.mEnemyInfo},i.prototype.setRightIndex=function(e){this.mRightIndex=e},i.prototype.getRightIndex=function(){return this.mRightIndex},i.prototype.setEmBattleLastPage=function(e){this.lastPage=e},t.exports=new i,cc._RF.pop()},{EnermyBufferMgr:"EnermyBufferMgr"}],ArenaCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"b0e8dFNlA5M9LpC6AWm+RbK","ArenaCfgMgr");var n=function(){};n.prototype.getRankReward=function(e){for(var t=DonotDestroyManager.GameData.Arena,a=0;a<t.rewards.length;++a){var n=t.rewards[a].rank_range;if(e>=n[0]&&e<=n[1])
return t.rewards[a]}
return t.rewards[t.rewards.length-1]},n.prototype.getStaminaCostUnit=function(){return DonotDestroyManager.GameData.Arena.stamina_cost},t.exports=new n,cc._RF.pop()},{}],ArenaRankItem:[function(e,t,a){"use strict";cc._RF.push(t,"4b51c0zMfNAH4z3fKQDedM7","ArenaRankItem");var n=e("ArenaCfgMgr"),i=e("MyProtocols"),r=e("ArenaBufferMgr"),s=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pLevel:cc.Label,m_pName:cc.Label,m_pFight:cc.Label,m_pDes:cc.Label,m_phonor:cc.Label,m_pMoney:cc.Label,m_pRankNum:cc.Label,m_pRankSpr:cc.Sprite,m_pRankContent:cc.Node,m_pZhengrong:cc.Button,m_pTiaozhan:cc.Button,m_pIcon:cc.Sprite,m_pBg:cc.Sprite,mBtnFight:cc.Node,m_pIconSpr:[cc.SpriteFrame],m_pRanklist:[cc.SpriteFrame],m_pBglist:[cc.SpriteFrame],_rankinfo:null,_ranktype:-1},onLoad:function(){},ChangeData:function(e){this._rankinfo=e.info,this._ranktype=e.type,this._index=e.index,this.Init()},Init:function(){var e=n.getRankReward(this._rankinfo.rank);this.m_pLevel.string="LV."+this._rankinfo.level,this.m_pName.string=this._rankinfo.nickname,this.m_pFight.string=this._rankinfo.fight,this.m_pDes.string=e.des,this.m_pIcon.spriteFrame=this.m_pIconSpr[this._rankinfo.sexId-1],this.m_pZhengrong.node.active=!1,this.m_pTiaozhan.node.active=!0,1==this._ranktype&&(this.m_pZhengrong.node.active=!0,this.m_pTiaozhan.node.active=!1),this._rankinfo.rank<=3?(this.m_pRankContent.active=!1,this.m_pRankSpr.node.active=!0,this.m_pRankSpr.spriteFrame=this.m_pRanklist[this._rankinfo.rank-1]):(this.m_pRankContent.active=!0,this.m_pRankSpr.node.active=!1,this.m_pRankNum.string=this._rankinfo.rank,this.m_pRankContent.width=this.m_pRankNum.node.width+60),this.m_phonor.string="x"+e.honor,this.m_pMoney.string="x"+e.gamemoney,this._rankinfo.playerId==MyPersistDataManager._playerData.id?(this.m_pTiaozhan.node.active=!1,this.m_pBg.spriteFrame=this.m_pBglist[1]):this.m_pBg.spriteFrame=this.m_pBglist[0]},Tz_OnClickHandler:function(e){s.playBtnOpenEffect(),this._index=this._index<0?0:this._index,r.setRightIndex(this._index),MyPersistDataManager._playerData.stamina<DonotDestroyManager.GameData.Arena.stamina_cost?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80)," Nại lực không đủ, nhỏ "+DonotDestroyManager.GameData.Arena.stamina_cost+" xin đến Tiệm mua Nhân Sâm!"):i.send_C2SArenaEnemyDetail(DonotDestroyManager._gameSocket,this._index)},ZR_OnClickHandler:function(e){s.playBtnOpenEffect(),i.send_C2SArenaPlayerDetail(DonotDestroyManager._gameSocket,this._rankinfo.playerId)}}),cc._RF.pop()},{ArenaBufferMgr:"ArenaBufferMgr",ArenaCfgMgr:"ArenaCfgMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil"}],ArenaReportCell:[function(e,t,a){"use strict";cc._RF.push(t,"2a669i5aBBCybbF7onOv/Wm","ArenaReportCell");var m=e("GameUtils");cc.Class({extends:cc.Component,properties:{m_pRichText:cc.RichText,_reportinfo:null},onLoad:function(){},ChangeData:function(e){this._reportinfo=e,this.Init()},Init:function(){this.InitData()},InitData:function(){var e=new Date;e.setTime(1e3*this._reportinfo.time);var t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),i=e.getHours(),r=e.getMinutes(),s=e.getSeconds(),o="<color=#00ff00>["+t+"-"+m.pad(a,2)+"-"+m.pad(n,2)+"] "+m.pad(i,2)+":"+m.pad(r,2)+":"+m.pad(s,2)+"</c> ",c=0==this._reportinfo.result?"<color=#ff0000> thất bại </c>":"<color=#00ff00> thành công </c>",l=1==this._reportinfo.type?" khởi xướng khiêu chiến ！ ngươi ":" đối với ngươi khởi xướng khiêu chiến ！ ngươi ",h=1==this._reportinfo.type?"Bạn chat với ":"",d="<color=#ffc600>"+this._reportinfo.nickname+"</c>",_=" ！ bài danh không thay đổi 。";if(0!=this._reportinfo.rankChange){_=" ！ bài danh "+(0<this._reportinfo.rankChange?"<color=#00ff00> bay lên </c> tới ":"<color=#ff0000> giảm xuống </c> tới ");var u=(this._reportinfo.rankChange<0?"<color=#ff0000>":"<color=#00ff00>")+this._reportinfo.rank+" danh 。</c>";this.m_pRichText.string=o+h+d+l+c+_+u}else
this.m_pRichText.string=o+h+d+l+c+_}}),cc._RF.pop()},{GameUtils:"GameUtils"}],ArenaReportLayer:[function(e,t,a){"use strict";cc._RF.push(t,"9ff334rBglEN4YBhTPlKHvJ","ArenaReportLayer"),cc.Class({extends:cc.Component,properties:{m_pReportcell:cc.Node,m_pItemParent:cc.Node,_reportinfo:null,_celllist:[]},onLoad:function(){},ChangeData:function(e){this._reportinfo=e,this.Init()},Init:function(){this.CreateCell()},CreateCell:function(){if(!(null==this._reportinfo||null==this._reportinfo.reports||this._reportinfo.reports.length<=0))
for(var e=0;e<this._reportinfo.reports.length;++e){var t=null;if(e<this._celllist.length)
t=this._celllist[e];else{var a=cc.instantiate(this.m_pReportcell);this.m_pItemParent.addChild(a),t=a.getComponent("ArenaReportCell"),this._celllist.push(t)}
t.node.active=!0,t.ChangeData(this._reportinfo.reports[e])}}}),cc._RF.pop()},{}],ArmiesManager:[function(u,e,t){"use strict";cc._RF.push(e,"42d16OQ5KhADp1p1FuHUGYt","ArmiesManager");var a=u("MeleeArmy"),n=u("RemoteArmy"),m=u("BattleConstants"),i=function(){this.armyActors=[],this.factorRemote=1,this.factorMelee=2};i.prototype.resetData=function(){this.armyActors=[],this.factorRemote=1,this.factorMelee=2},i.prototype.createArmy=function(e){var t;return e==m._ARMY_TYPE.Melee?t=new a:e==m._ARMY_TYPE.Remote&&(t=new n),cc.assert(t,"can not create amy atk type = %d",e),this.armyActors.push(t),t},i.prototype.searchTargetForMelee=function(e){var t,a=u("BattleManager"),n=[],i=e.getPosition(),r=i.x,s=i.y;e.side==m._BTL_SIDE.OUR?t=a.otrside.armies:e.side==m._BTL_SIDE.OTR&&(t=a.ourside.armies);for(var o=0;o<t.length;o++){var c=t[o];if(c.isSearchAble()&&0<c.slotsNum){var l=c.getPosition(),h=l.x,d=l.y,_=1*Math.abs(r-h)+4.2*Math.abs(s-d);c.getAtkType()==m._ARMY_TYPE.Remote?_*=this.factorRemote:c.getAtkType()==m._ARMY_TYPE.Melee&&("Charge"!=c.getState()&&"Meet"!=c.getState()||(_*=this.factorMelee)),n.push({army:c,distance:_})}}
if(n.sort(function(e,t){return e.distance-t.distance}),null!=n[0])
return n[0].army},i.prototype.searchTargetForRemote=function(e){var t,a=u("BattleManager"),n=[],i=e.getPosition(),r=i.x,s=i.y;e.side==m._BTL_SIDE.OUR?t=a.otrside.armies:e.side==m._BTL_SIDE.OTR&&(t=a.ourside.armies);for(var o=0;o<t.length;o++){var c=t[o];if(c.isSearchAble()){var l=c.getPosition(),h=l.x,d=l.y,_=Math.abs(r-h)+Math.abs(s-d);n.push({army:c,distance:_})}}
if(n.sort(function(e,t){return e.distance-t.distance}),null!=n[0])
return n[0].army},i.prototype.searchChargeForUnits=function(e){var n=e.target,t=e.hero;null==t||t.isTargetAble()||t.setTarget(n.hero);for(var i=0,a=function(e){for(var t=0;t<n.soldiers.length;t++){var a=n.soldiers[t];if(e.setTarget(a,1),null!=e.target)
return}
if(e.setTarget(n.hero,1),null==e.target&&(e.setTarget(n.hero,2),null==e.target)){for(t=0;t<n.soldiers.length;t++){a=n.soldiers[t];if(e.setTarget(a,2),null!=e.target)
return}
e.isWanderAble()&&(e.setPosition2Wander(n,i),i+=1)}},r=0;r<e.soldiers.length;r++){var s=e.soldiers[r];s.isTargetAble()||a(s)}
null==t||t.isTargetAble()||t.setTarget(n.soldiers[0])},i.prototype.searchAttackForUnits=function(e){var t=e.target,a=e.hero;if(null==a||a.isTargetAble()||a.setTarget(t.hero),null==a||a.isTargetAble()||a.setTarget(t.soldiers[0]),11==e.getArmyType())
for(var n=0;n<e.soldiers.length;n++){var i=e.soldiers[n];i.isTargetAble()||i.setTarget(t.hero)}
var r=!0;for(n=0;n<e.soldiers.length;n++){if(!(h=e.soldiers[n]).isTargetAble()){r=!1;break}}
if(!r){var s=[];null!=t.hero&&"Dead"!=t.hero.getState()&&s.push({t:t.hero,num:t.hero.remoteAtkedNum});for(n=0;n<t.soldiers.length;n++){var o=t.soldiers[n];s.push({t:o,num:o.remoteAtkedNum})}
s.sort(function(e,t){return e.num-t.num});n=0;for(var c=s.length,l=0;l<e.soldiers.length;l++){var h;if(!(h=e.soldiers[l]).isTargetAble()){var d=n;c<=n&&(d=n-Math.floor(n/c)*c),h.setTarget(s[d].t),n++}}}},i.prototype.getRandArmyPos=function(e){for(var t=[],a=0;a<this.armyActors.length;a++){var n=this.armyActors[a];"Destory"!=n.getState()&&"Strategy"!=n.getState()&&(e&&e!=n.side||t.push(n))}
var i=t[Math.floor(Math.random()*t.length)];if(null!=i)
return cc.p(i.getPosition())},i.prototype.getRandRemoteArmyPos=function(e){for(var t=[],a=[],n=0;n<this.armyActors.length;n++){var i=this.armyActors[n];"Destory"!=i.getState()&&"Strategy"!=i.getState()&&(null!=e&&e!=i.side||(i.getAtkType()==m._ARMY_TYPE.Remote&&t.push(i),a.push(i)))}
var r=t[Math.floor(Math.random()*t.length)];return null!=r?[!0,cc.p(r.getPosition())]:null!=(r=a[Math.floor(Math.random()*a.length)])?[!1,cc.p(r.getPosition())]:void 0},i.prototype.getLowestHPArmyPos=function(e){for(var t,a=0;a<this.armyActors.length;a++){var n=this.armyActors[a];if(null==e||e==n.side)
if(null==t)
t=n;else{var i=0;null!=t.hero&&(i=t.hero.hp);for(var r=0;r<t.soldiers.length;r++){i+=t.soldiers[r].hp}
var s=0;null!=n.hero&&(s=n.hero.hp);for(r=0;r<n.soldiers.length;r++){s+=n.soldiers[r].hp}
s<i&&(t=n)}}
return null!=t&&cc.p(t.getPosition())},i.prototype.removeArmy=function(e){for(var t=0;t<this.armyActors.length;t++){if(this.armyActors[t]==e){this.armyActors.splice(t,1);break}}},i.prototype.onUpdate=function(e){for(var t=0;t<this.armyActors.length;t++){this.armyActors[t].onUpdate(e)}},e.exports=new i,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleManager:"BattleManager",MeleeArmy:"MeleeArmy",RemoteArmy:"RemoteArmy"}],ArmyEquipDialog:[function(e,t,a){"use strict";cc._RF.push(t,"e4597FwC8ZMprmz9XiO0Tjf","ArmyEquipDialog");var n=e("ColorUtil"),i=e("MyProtocols"),r=e("i18n"),s=e("SoundUtil"),o=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pItemparent:cc.Node,m_pName:cc.Label,m_pMaxhp:cc.Label,m_pAtk:cc.Label,m_pDef:cc.Label,m_pHasNum:cc.Label,m_pNeedNum:cc.Label,m_pNeedLevel:cc.Label,m_pBtnValue:cc.Label,btnOperate:cc.Node,_unitequipjson:null,_equipinfo:null,_isJump:!1,_curlevel:-1,_heroid:-1,_index:-1},onLoad:function(){},setParams:function(e){this._equipinfo=e.equipinfo,this._unitequipjson=e.equipjson,this._curlevel=e.level,this._heroid=e.heroid,this._index=e.index,this.Init(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},Init:function(){var i=this;cc.loader.loadRes("Prefab/ItemBox/ItemBox",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);i.m_pItemparent.addChild(a);var n=a.getComponent("ItemBox");n.ChangeItemInfo(i._equipinfo[0],0),i.m_pName.string=n._itemjsoninfo.name}),this.m_pName.node.color=n.getColorByQuality(this._unitequipjson.quality),this.m_pAtk.string="+"+(this._unitequipjson.attrs.atk||0),this.m_pDef.string="+"+(this._unitequipjson.attrs.def||0),this.m_pMaxhp.string="+"+(this._unitequipjson.attrs.maxhp||0);var e=0;e=null==MyPersistDataManager._playerData.bagMap[this._unitequipjson.id]?0:MyPersistDataManager._playerData.bagMap[this._unitequipjson.id].num,this.m_pHasNum.string=e,this.m_pNeedLevel.string=r.t("detail_001",{value:this._equipinfo[2]}),this.m_pNeedNum.string=this._equipinfo[1],0<MyPersistDataManager._playerData.cardsMaplist[this._heroid].unitEquips[this._index]?(this.m_pBtnValue.string=r.t("detail_002"),this._isJump=!0,this.m_pHasNum.node.color=e<this._equipinfo[1]?cc.Color.RED:cc.Color.GREEN):e<this._equipinfo[1]?(this.m_pHasNum.node.color=cc.Color.RED,this.m_pBtnValue.string=r.t("detail_002"),this._isJump=!0):(this.m_pHasNum.node.color=cc.Color.GREEN,this.m_pBtnValue.string=r.t("sh_006"),this._isJump=!1),this._curlevel<this._equipinfo[2]?this.m_pNeedLevel.node.color=cc.Color.RED:this.m_pNeedLevel.node.color=cc.Color.GREEN},Mask_OnClickHandler:function(e){MyUiManager.Back(),s.playBtnCloseEffect()},Btn_OnClickHandler:function(e){s.playBtnOpenEffect(),this._isJump?MyUiManager.Open(MyUiManager.PanelInfo.StageFallPanel,{id:this._equipinfo[0],itemtype:1,num:this._equipinfo[1]}):this._curlevel<this._equipinfo[2]?MyUiManager.OpenFloatTipPanel(cc.p(0,130),r.t("detail_003")):i.send_C2SCardEquipUnit(DonotDestroyManager._gameSocket,this._heroid,this._index+1)},onDestroy:function(){},showGuide:function(){var t=this;o.showGuide("ArmyEquipDialog",function(e){if(1==e)
return t.btnOperate})}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GuideBufferMgr:"GuideBufferMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",i18n:"i18n"}],ArmyFormationLayer:[function(e,t,a){"use strict";cc._RF.push(t,"3aa3dttvCZP2qYkXLHze+Ks","ArmyFormationLayer");var i=e("ResLoaderManager"),n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pArmyItem:cc.Prefab,m_pItemParent:cc.Node,_raw_assets:{default:{},type:Object},_playerinfo:null},onLoad:function(){},LoadRes:function(){this.toLoadResList=[],this._raw_assets={};for(var e=0;e<this._playerinfo.cards.length;++e){var t=DonotDestroyManager.GameData.Cards[this._playerinfo.cards[e].template_id];this.toLoadResList.push(["UI/Heros/"+t.icon,cc.SpriteFrame])}
var a=this._loadProgressCb.bind(this),n=this._loadFinishCb.bind(this);i.asyncLoadAll(this.toLoadResList,a,n)},_loadProgressCb:function(e){},_loadFinishCb:function(e,t){cc.log("load teamskill resources finish!"),t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this),this.Init()},ChangeData:function(e){this._playerinfo=e,this.LoadRes()},Init:function(){this.CreateArmyItem()},CreateArmyItem:function(){for(var e=0;e<this._playerinfo.cards.length;++e){var t=cc.instantiate(this.m_pArmyItem);this.m_pItemParent.addChild(t),t.getComponent("ArmyItem").ChangeArenaData(this._playerinfo.cards[e],this._raw_assets)}},Mask_OnClickHandler:function(e){n.playBtnCloseEffect(),this.node.destroy()}}),cc._RF.pop()},{ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil"}],ArmyHeroWarpInfo:[function(i,e,t){"use strict";cc._RF.push(e,"0f47dK2cTxNYKYmgT4ReVg1","ArmyHeroWarpInfo");var s=i("ArmyPanel"),r=i("HeroFragBufferMgr"),o=i("MyProtocols"),c=i("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pArmyHeroItem:cc.Prefab,m_pherofragtip:cc.Node,_itemID:0,_armyitemlist:[],_isherofrag:!1},onLoad:function(){},updateItem:function(e){if(this._itemID=e,2*this._itemID<s.getInstance()._curHeroInfoList.length)
this.m_pherofragtip.active=!1,this._isherofrag=!1,this.CreateHeroInfo();else{this._isherofrag=!0;var t=s.getInstance()._curHeroInfoList.length%2==0?s.getInstance()._curHeroInfoList.length/2:parseInt(s.getInstance()._curHeroInfoList.length/2+1);this._itemID-t==0?(this.DisableItemList(),this.m_pherofragtip.active=!0):(this.m_pherofragtip.active=!1,this.CreateHeroFragInfo(this._itemID-t-1))}},CreateHeroFragInfo:function(e){for(var t=0;t<2;++t){var a=2*e+t;if(t<this._armyitemlist.length)
if(a<r.mHeroFragList.length){this._armyitemlist[t].active=!0;var n=this.HeroFragClickHandler.bind(this);this._armyitemlist[t].getComponent("ArmyItem").ChangeData(r.mHeroFragList[a],a,n,!1,this._isherofrag,s.getInstance()._raw_assets,!1),this._armyitemlist[t].setPosition(410*t-205,0)}else
this._armyitemlist[t].active=!1;else
a<r.mHeroFragList.length&&this.CreateArmyItem(t,a,r.mHeroFragList[a])}},CreateHeroInfo:function(){for(var e=-1,t=0;t<2;++t)
if(e=2*this._itemID+t,t<this._armyitemlist.length)
if(e<s.getInstance()._curHeroInfoList.length){this._armyitemlist[t].active=!0;var a=this.HeroClickHandler.bind(this);this._armyitemlist[t].getComponent("ArmyItem").ChangeData(s.getInstance()._curHeroInfoList[e],e,a,!0,this._isherofrag,s.getInstance()._raw_assets,!0),this._armyitemlist[t].setPosition(410*t-205,0)}else
this._armyitemlist[t].active=!1;else
e<s.getInstance()._curHeroInfoList.length&&this.CreateArmyItem(t,e,s.getInstance()._curHeroInfoList[e])},CreateArmyItem:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=cc.instantiate(this.m_pArmyHeroItem),r=i.getComponent("ArmyItem");this.node.addChild(i);n=null;n=this._isherofrag?this.HeroFragClickHandler.bind(this):this.HeroClickHandler.bind(this),r.ChangeData(a,t,n,!0,this._isherofrag,s.getInstance()._raw_assets,!0),i.setPosition(410*e-205,0),this._armyitemlist.push(i)},HeroClickHandler:function(e,t){cc.log(t+"for warp info"),c.playBtnOpenEffect(),s.getInstance().markScrollOffset(),MyUiManager.Open(MyUiManager.PanelInfo.HeroDetailsPanel,{herolist:s.getInstance()._curHeroInfoList,heroinfo:t.custom,index:t.index})},HeroFragClickHandler:function(e,t){cc.log(t+"for warp info"),c.playBtnOpenEffect();var a=t.custom,n=DonotDestroyManager.GameData.CardFrags[a.template_id];if(a.num>=n.craft_num)
return i("HeroFragBufferMgr").setComposeHeroId(n.card_id),void o.send_C2SCardCompose(DonotDestroyManager._gameSocket,a.template_id);MyUiManager.Open(MyUiManager.PanelInfo.StageFallPanel,{id:t.custom.template_id,itemtype:0})},DisableItemList:function(){if(!(null==this._armyitemlist||this._armyitemlist.length<=0))
for(var e=0;e<this._armyitemlist.length;++e)
this._armyitemlist[e].active=!1},onDestroy:function(){}}),cc._RF.pop()},{ArmyPanel:"ArmyPanel",HeroFragBufferMgr:"HeroFragBufferMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil"}],ArmyItem:[function(e,t,a){"use strict";cc._RF.push(t,"28866x9KulCLJV9lwMgl/ql","ArmyItem");var c=e("HeroBufferMgr"),o=e("OverComeBufferMgr"),s=e("MineBufferMgr"),l=e("ShaderUtil"),n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pReddot:cc.Node,m_pLevel:cc.Label,m_pName:cc.Label,m_pSoilderType:cc.Sprite,m_pQuality:cc.Sprite,m_pinFormation:cc.Sprite,m_pHeroIcon:cc.Sprite,m_pBaner:cc.Sprite,m_pFighting:cc.Label,m_pNumcontent:cc.Node,m_pNumlab:cc.Label,m_pStarNode:cc.Node,m_pSelect:cc.Node,m_pHeroContent:cc.Node,m_pHeroFragContent:cc.Node,m_pfragnum:cc.Label,m_pfragbar:cc.Sprite,m_pFragIcon:cc.Sprite,m_pMask:cc.Sprite,m_pYizhenwang:cc.Sprite,m_pLifebar:cc.Sprite,m_pLifeNode:cc.Node,m_psyntheticCue:cc.Prefab,m_pKZMspr:cc.Sprite,m_pStarList:[cc.Sprite],m_pBanerList:[cc.SpriteFrame],m_pStarsprlist:[cc.SpriteFrame],_heroid:0,_cardinfo:null,_herojsoninfo:null,m_pUnitTypeSprList:[cc.SpriteFrame],m_pQualitySprList:[cc.SpriteFrame],_index:-1,_isSelect:!1,_isfrag:!1,_frageffect:null,_cb:null,_isDead:!1,_isExclude:!1},onLoad:function(){},ChangeData:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=4<arguments.length&&void 0!==arguments[4]&&arguments[4],r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,s=6<arguments.length&&void 0!==arguments[6]&&arguments[6];this.InitData(),this._isfrag=i,this.SetHeroFrag(),this._cb=a,this._cardinfo=e,this._index=t;if(l.resetShader(this.m_pHeroIcon.node),l.resetShader(this.m_pFragIcon.node),i){if(this.m_pHeroContent.active=!1,this.m_pHeroFragContent.active=!0,this._herofragjson=DonotDestroyManager.GameData.CardFrags[e.template_id],this._herojsoninfo=DonotDestroyManager.GameData.Cards[this._herofragjson.card_id],this.m_pfragnum.string=e.num+"/"+this._herofragjson.craft_num,this.m_pfragbar.node.scaleX=1<e.num/this._herofragjson.craft_num?1:e.num/this._herofragjson.craft_num,this.m_pQuality.spriteFrame=this.m_pQualitySprList[0],this.m_pHeroIcon.spriteFrame=r["UI/Heros/"+this._herofragjson.icon],e.num<this._herofragjson.craft_num)
l.setGaryShader(this.m_pHeroIcon.node),l.setGaryShader(this.m_pFragIcon.node),this.m_pfragnum.node.active=!0,this.m_pKZMspr.node.active=!1;else
this._frageffect=cc.instantiate(this.m_psyntheticCue),this.node.addChild(this._frageffect),this._frageffect.setScale(1.1,1),this._frageffect.getComponent(dragonBones.ArmatureDisplay).armature().animation.fadeIn("action1",-1,-1,0,"normal"),this.m_pfragnum.node.active=!1,this.m_pKZMspr.node.active=!0;this.m_pReddot.active=!1}else
this.m_pHeroContent.active=!0,this.m_pHeroFragContent.active=!1,this._heroid=e.id,this._herojsoninfo=DonotDestroyManager.GameData.Cards[e.template_id],this.m_pLevel.string=this._cardinfo.level,1<e.num?(this.m_pNumcontent.active=n,this.m_pNumlab.string="x"+e.num):this.m_pNumcontent.active=!1,null!=e.isonline&&0<e.isonline?this.m_pinFormation.node.active=!0:this.m_pinFormation.node.active=!1,this.ShowStar(),this.m_pFighting.string=this._cardinfo.fight,this.m_pQuality.spriteFrame=this.m_pQualitySprList[this._herojsoninfo.quality],this.m_pHeroIcon.spriteFrame=r["UI/Heros/"+this._herojsoninfo.icon],s&&c.redPointHeroAll(e)?this.m_pReddot.active=!0:this.m_pReddot.active=!1;this.m_pSoilderType.spriteFrame=this.m_pUnitTypeSprList[this._herojsoninfo.unit_type-1],this.m_pBaner.spriteFrame=this.m_pBanerList[this._herojsoninfo.quality],this.m_pName.string=this._herojsoninfo.name;var o=new cc.Component.EventHandler;o.target=this.node,o.component="ArmyItem",o.handler="HeroClickHandler",o.customEventData=this._cardinfo,this.node.getComponent(cc.Button).clickEvents[0]=o},ChangeFTData:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=4<arguments.length&&void 0!==arguments[4]&&arguments[4],r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;if(this.ChangeData(e,t,a,n,i,r),this.m_pLifeNode.active=!0,this.m_pLifebar.node.scaleX=1,o.isOurHeroLive(e.template_id)){var s=o.getOurHp(e.template_id);this.m_pLifebar.node.scaleX=s/100}else
this.m_pLifebar.node.scaleX=0,this.m_pMask.node.active=!0,this.m_pYizhenwang.node.active=!0,this._isDead=!0},ChangeMineDefenceData:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=4<arguments.length&&void 0!==arguments[4]&&arguments[4],r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;this.ChangeData(e,t,a,n,i,r),s.isInOtherDefenceFormation(e.template_id)&&(this._isExclude=!0,this.m_pMask.node.active=!0)},ChangeArenaData:function(e,t){this.InitData(),this.SetHeroFrag(),this._cardinfo=e,this.m_pHeroContent.active=!0,this.m_pHeroFragContent.active=!1,this._heroid=e.id,this._herojsoninfo=DonotDestroyManager.GameData.Cards[e.template_id],this.m_pLevel.string=this._cardinfo.level,this.m_pNumcontent.active=!1,this.m_pinFormation.node.active=!1,this.ShowStar(),this.m_pFighting.string=e.fight,this.m_pQuality.spriteFrame=this.m_pQualitySprList[this._herojsoninfo.quality],this.m_pSoilderType.spriteFrame=this.m_pUnitTypeSprList[this._herojsoninfo.unit_type-1],this.m_pBaner.spriteFrame=this.m_pBanerList[this._herojsoninfo.quality],this.m_pName.string=this._herojsoninfo.name,this.m_pHeroIcon.spriteFrame=t["UI/Heros/"+this._herojsoninfo.icon]},ShowStar:function(){var e=0,t=0;this._herojsoninfo.quality<=1?this.m_pStarNode.active=!1:(this.m_pStarNode.active=!0,t=5==(e=2==this._herojsoninfo.quality?5:7)?-60:-90);for(var a=0;a<this.m_pStarList.length;++a)
a<e?(this.m_pStarList[a].node.active=!0,this.m_pStarList[a].node.setPosition(t+30*a,0)):this.m_pStarList[a].node.active=!1,this._cardinfo.grade>a?this.m_pStarList[a].spriteFrame=this.m_pStarsprlist[1]:this.m_pStarList[a].spriteFrame=this.m_pStarsprlist[0]},SetHeroFrag:function(){if(this._isfrag)
return this.m_pHeroContent.active=!1,void(this.m_pHeroFragContent.active=!0);this.m_pHeroContent.active=!0,this.m_pHeroFragContent.active=!1},SetSelect:function(){this.m_pSelect.active=!this._isSelect,this.m_pMask.node.active=!this._isSelect,this._isSelect=!this._isSelect},InitData:function(){this._isSelect=!1,this.m_pSelect.active=!1,this.m_pMask.node.active=!1,this.m_pYizhenwang.node.active=!1,this.m_pLifeNode.active=!1,this._isDead=!1,this._isExclude=!1,this.m_pinFormation.node.active=!1,null!=this._frageffect&&(this._frageffect.destroy(),this._frageffect=null)},HeroClickHandler:function(e,t){cc.log(t),n.playBtnOpenEffect(),this._isDead?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80)," anh hùng đã bỏ mình "):this._isExclude?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80)," anh hùng đã ở này hắn quặng điểm phòng thủ đội hình xuất chiến "):null!=this._cb&&this._cb(e,{custom:t,index:this._index,self:this})},onDestroy:function(){}}),cc._RF.pop()},{HeroBufferMgr:"HeroBufferMgr",MineBufferMgr:"MineBufferMgr",OverComeBufferMgr:"OverComeBufferMgr",ShaderUtil:"ShaderUtil",SoundUtil:"SoundUtil"}],ArmyPanel:[function(e,t,a){"use strict";cc._RF.push(t,"044caX7MHZFTL42IskEFPEd","ArmyPanel");var n=e("BattleBufferMgr"),c=e("HeroFragBufferMgr"),i=e("ResLoaderManager"),r=(e("GameUtils"),e("MyEventDispatcher")),s=e("NetEvent"),o=e("SoundUtil"),l=e("GuideBufferMgr"),h=cc.Class({extends:cc.Component,properties:{m_pHeroParent:cc.Node,m_btnBack:cc.Node,m_pTabMenuNormalList:[cc.Sprite],m_pMenuSprList:[cc.SpriteFrame],m_pNoHeroLab:cc.Label,m_pItemParent:cc.Node,FunctionBtnBar:cc.Prefab,mScrollView:cc.ScrollView,itemTemplate:cc.Prefab,itemTemplateHeight:110,spawnCount:12,spacing:0,bufferZone:600,_lastSelectTabMunuIndex:-1,_curSelectTabMenuIndex:-1,_curHeroInfoList:[],_onlineheromap:{default:{},type:Object},_raw_assets:{default:{},type:Object}},statics:{instance:null,getInstance:function(){return h.instance}},onLoad:function(){this.node.on("touchstart",this.ClickStart,this),this.S2CCardCompose_cb_func=this.S2CCardCompose_cb.bind(this),r.addListener(s.S2CCardCompose,this.S2CCardCompose_cb_func),this.LoadRes(),h.instance=this;var e=cc.instantiate(this.FunctionBtnBar);this.node.addChild(e),e.setPosition(cc.p(0,0)),e.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").changeStatus(0)},setParams:function(e){cc.log("Open ArmyPanel"),this._scrollOffset=e instanceof Object&&null!=e.scrollOffset?e.scrollOffset:null,this._selectedTab=e instanceof Object&&null!=e.selectedTab?e.selectedTab:0,this._params=e,this.closeCb=e.closeCb},Init:function(){this.TabMenuRegisterClickEvent(),this.SetSelectTabMenu(this._selectedTab),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},LoadRes:function(){if(this.toLoadResList=[],this._raw_assets={},MyPersistDataManager._playerData.cardslist.length<=0&&c.mHeroFragList.length<=0)
this.Init();else{for(var e=0;e<MyPersistDataManager._playerData.cardslist.length;++e){var t=DonotDestroyManager.GameData.Cards[MyPersistDataManager._playerData.cardslist[e].template_id];this.toLoadResList.push(["UI/Heros/"+t.icon,cc.SpriteFrame])}
for(e=0;e<c.mHeroFragList.length;++e){t=DonotDestroyManager.GameData.CardFrags[c.mHeroFragList[e].template_id];this.toLoadResList.push(["UI/Heros/"+t.icon,cc.SpriteFrame])}
var a=this._loadProgressCb.bind(this),n=this._loadFinishCb.bind(this);i.asyncLoadAll(this.toLoadResList,a,n)}},_loadProgressCb:function(e){},_loadFinishCb:function(e,t){cc.log("load teamskill resources finish!"),t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this),this.Init()},S2CCardCompose_cb:function(e){cc.log(" anh hùng hợp thành tin tức tiếp thu ");var n=c.getComposeHeroId(),i=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/RecruitPanel/GetHeroPanel",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=i&&cc.isValid(i.node)){null!=i._shortMask_node&&(i._shortMask_node.destroy(),i._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("GetHeroPanel").DoGetHeroAnim(n,4)}}),this.CreateItemForGroup(this._curSelectTabMenuIndex)},TabMenuRegisterClickEvent:function(){for(var e=0;e<this.m_pTabMenuNormalList.length;++e){var t=new cc.Component.EventHandler;t.target=this.node,t.component="ArmyPanel",t.handler="BtnClickHandler",t.customEventData=e.toString(),this.m_pTabMenuNormalList[e].getComponent(cc.Button).clickEvents[0]=t}},BtnClickHandler:function(e,t){cc.log(" điểm đánh nhãn :"+t),o.playBtnOpenEffect();var a=parseInt(t);this.SetSelectTabMenu(a),this._curSelectTabMenuIndex=a},SetSelectTabMenu:function(e){if("5"==e)
return this.mScrollView.stopAutoScroll(),void this.mScrollView.scrollToBottom();if(this._curSelectTabMenuIndex!=e){this._selectedTab=e;-1!=this._lastSelectTabMunuIndex&&(this.m_pTabMenuNormalList[this._lastSelectTabMunuIndex].spriteFrame=this.m_pMenuSprList[0]),this._curSelectTabMenuIndex=e,this.m_pTabMenuNormalList[this._curSelectTabMenuIndex].spriteFrame=this.m_pMenuSprList[1],this._lastSelectTabMunuIndex=this._curSelectTabMenuIndex,this.CreateItemForGroup(e),this.mScrollView.stopAutoScroll(),this.mScrollView.scrollToTop()}},CreateItemForGroup:function(e){this._curHeroInfoList=this.GetGroupInfoList(e),this.SetOnlineHero(this._curHeroInfoList),this._curHeroInfoList.sort(function(e,t){return e.isonline!=t.isonline?t.isonline-e.isonline:DonotDestroyManager.GameData.Cards[t.template_id].quality!=DonotDestroyManager.GameData.Cards[e.template_id].quality?DonotDestroyManager.GameData.Cards[t.template_id].quality-DonotDestroyManager.GameData.Cards[e.template_id].quality:e.fight!=t.fight?t.fight-e.fight:t.level-e.level});var t=this._curHeroInfoList.length%2==0?this._curHeroInfoList.length/2:parseInt(this._curHeroInfoList.length/2+1);cc.log(" chiều dài "+t);var a=c.mHeroFragList.length%2==0?c.mHeroFragList.length/2:parseInt(c.mHeroFragList.length/2+1),n=t+a;if(this.m_pNoHeroLab.node.active=n<=0,!(n<=0))
if(t+=a+1,this.content=this.mScrollView.content,this.content.height=t*(this.itemTemplateHeight+this.spacing)+this.spacing,0==this.content.children.length){this._spawnItems=[],this.updateTimer=0,this.updateInterval=.2;for(var i=this.lastContentPosY=0;i<this.spawnCount;++i){var r=cc.instantiate(this.itemTemplate);this.content.addChild(r),r.setPosition(0,-r.height*(.5+i)-this.spacing*(i+1)),r.getComponent("ArmyHeroWarpInfo").updateItem(i),this._spawnItems.push(r)}
null!=this._scrollOffset&&this.node.runAction(cc.sequence(cc.delayTime(.02),cc.callFunc(function(){this.mScrollView.scrollToOffset(this._scrollOffset)},this)))}else
for(var s=this.updateTimer=0;s<this.spawnCount;++s){var o=this._spawnItems[s];o.setPosition(0,-o.height*(.5+s)-this.spacing*(s+1)),o.getComponent("ArmyHeroWarpInfo").updateItem(s)}},markScrollOffset:function(){var e=this.mScrollView.getScrollOffset();null!=this._params&&this._params instanceof Object&&(this._params.scrollOffset=e,this._params.selectedTab=this._selectedTab)},SetOnlineHero:function(e){if(!(null==e||e.length<=0)){this._onlineheromap=this.GetOnlineHeromap();for(var t=0;t<e.length;++t)
null!=this._onlineheromap&&null!=this._onlineheromap[e[t].template_id]?e[t].isonline=1:e[t].isonline=0}},GetOnlineHeromap:function(){var e=n.getFormationData(1);if(null==e)
return null;var t={};return 0<e.a&&(t[e.a]=e.a),0<e.b&&(t[e.b]=e.b),0<e.c&&(t[e.c]=e.c),0<e.d&&(t[e.d]=e.d),0<e.e&&(t[e.e]=e.e),0<e.f&&(t[e.f]=e.f),0<e.g&&(t[e.g]=e.g),0<e.h&&(t[e.h]=e.h),0<e.i&&(t[e.i]=e.i),0<e.j&&(t[e.j]=e.j),t},GetGroupInfoList:function(e){if(0==e)
return MyPersistDataManager._playerData.cardslist;for(var t=[],a=0;a<MyPersistDataManager._playerData.cardslist.length;++a)
DonotDestroyManager.GameData.Cards[MyPersistDataManager._playerData.cardslist[a].template_id].group==e&&t.push(MyPersistDataManager._playerData.cardslist[a]);return t},HeroClickHandler:function(e,t){cc.log(t),o.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.HeroDetailsPanel,t)},ClickStart:function(e){},onDestroy:function(){r.removeListener(s.S2CCardCompose,this.S2CCardCompose_cb_func),(h.instance=null)!=this._raw_assets&&(this._raw_assets={})},Back_onclickHandler:function(e){o.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},showGuide:function(){var t=this;l.showGuide("ArmyCampLayer",function(e){return 1==e?t.m_pItemParent.children[0].children[1]:2==e?t.m_btnBack:void 0})},getPositionInView:function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.mScrollView.node.convertToNodeSpaceAR(t)},update:function(e){if(this.updateTimer+=e,!(this.updateTimer<this.updateInterval)){this.updateTimer=0;var t=this._spawnItems;if(null!=t){for(var a=this.bufferZone,n=this.mScrollView.content.y<this.lastContentPosY,i=(this.itemTemplateHeight+this.spacing)*t.length,r=0;r<t.length;++r){var s=this.getPositionInView(t[r]);if(n){if(s.y<-a&&t[r].y+i<0){t[r].setPositionY(t[r].y+i);var o=t[r].getComponent("ArmyHeroWarpInfo"),c=o._itemID-t.length;o.updateItem(c)}}else if(s.y>a&&t[r].y-i>-this.content.height){t[r].setPositionY(t[r].y-i);var l=t[r].getComponent("ArmyHeroWarpInfo"),h=l._itemID+t.length;l.updateItem(h)}}
this.lastContentPosY=this.mScrollView.content.y}}}});cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",HeroFragBufferMgr:"HeroFragBufferMgr",MyEventDispatcher:"MyEventDispatcher",NetEvent:"NetEvent",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil"}],ArmyUpgradeDialog:[function(e,t,a){"use strict";cc._RF.push(t,"fc56ffOjIlGGZGXp8ce1TSB","ArmyUpgradeDialog");var s=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=e("ColorUtil"),r=e("UnitBufferMgr"),i=e("MyProtocols"),o=e("i18n"),c=e("SoundUtil"),l=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pAttrItem:cc.Prefab,m_pEquipParent:cc.Node,m_pAttrParent:cc.Node,m_pCurUnitParent:cc.Node,m_pNextUnitParent:cc.Node,m_pCurName:cc.Label,m_pNextName:cc.Label,m_pNeedMoney:cc.Label,m_pNeedLv:cc.Label,m_pArrow:cc.Node,m_pBtnUp:cc.Button,_heroid:-1,_unitgrade:-1,_unittype:-1,_soldierpos:[],_attritemlist:[],_armyInfo:null,_createindex:-1,_isPlayEffect:!1,_cb:null,_CUR_UNITSPRE:null,_NEXT_UNITSPRE:null},onLoad:function(){},setParams:function(e){this._armyInfo=e.armyInfo,this._heroid=this._armyInfo.heroId,this._unittype=this._armyInfo._type,this._unitgrade=this._armyInfo.grade,this._soldierpos=new Array(cc.p(0,0),cc.p(-70,5),cc.p(-25,35),cc.p(-45,-30),cc.p(45,30),cc.p(20,-40),cc.p(65,-10)),this.Init(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},Init:function(){this.CreateAllSoldier(this._unittype,this._unitgrade),this.CreateAllSoldier(this._unittype,this._unitgrade+1),this.m_pCurName.string=this._armyInfo.name,this.m_pNextName.string=this._armyInfo.impName||this._armyInfo.name,this.m_pCurName.node.color=n.getColorByQuality(this._armyInfo.quality),this.m_pNextName.node.color=n.getColorByQuality(this._armyInfo.impQuality||this._armyInfo.quality),this.m_pNeedMoney.string="x"+this._armyInfo.gmUpGrade,this.m_pNeedLv.string="LV."+this._armyInfo.maxLv,this.updateArmyInfoAttr(),this.CreateEquips(),this.Arrowrunaction(),this.CheckCanUpgrade()||(this.m_pBtnUp.interactable=!1)},Arrowrunaction:function(){this.m_pArrow.runAction(cc.repeatForever(cc.sequence(cc.moveBy(.5,cc.p(10,0)),cc.moveBy(.5,cc.p(-10,0)))))},AddAttr:function(e,t){var a=null;this._createindex<this._attritemlist.length?a=this._attritemlist[this._createindex]:(a=cc.instantiate(this.m_pAttrItem),this.m_pAttrParent.addChild(a),this._attritemlist.push(a)),a.active=!0,a.getComponent("AttributeChangeItem").ChangeData(e,t,this._isPlayEffect),++this._createindex},DisableAttr:function(){for(var e=this._createindex;e<this._attritemlist.length;++e)
this._attritemlist[e].active=!1},CheckCanUpgrade:function(){for(var e=this._armyInfo.equips,t=!0,a=0;a<e.length;++a)
e[a]<=0&&(t=!1);return t},CreateEquips:function(){for(var e=this._armyInfo.equips,t=0;t<e.length;++t)
this.CreateItemBox(t,this._armyInfo.itemsUpgrade[t][0],e[t])},CreateItemBox:function(i,r,s){var o=this;cc.loader.loadRes("Prefab/ItemBox/ItemBox",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);o.m_pEquipParent.addChild(a);var n=a.getComponent("ItemBox");0<s?n.ChangeItemInfo(r,0):n.SetCanEquipEmptyItem(i,2)})},CreateAllSoldier:function(e,t){for(var a=0;a<7;++a)
this.CreateUnitsItem(a,e,t)},CreateUnitsItem:function(n,e,i){var t=i;10<i&&(t=10);var r=this,a="Prefab/battle/soldier/"+DonotDestroyManager.GameData.Units.unit_types[e-1][t-1].icon+"_blue";cc.loader.loadRes(a,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);i>r._unitgrade?(r._NEXT_UNITSPRE=t,r.m_pNextUnitParent.addChild(a)):(r._CUR_UNITSPRE=t,r.m_pCurUnitParent.addChild(a)),a.setPosition(r._soldierpos[n]),a.setScale(-1,1),a.getComponent(cc.Animation).play("stand")})},getArmyInfoAttr:function(e){var t=this._armyInfo.level-1;return"FROM_HP"==e?this._armyInfo.baseHp+t*this._armyInfo.addHp:"TO_HP"==e?(this._armyInfo.impHp||this._armyInfo.baseHp)+t*(this._armyInfo.impAddHp||this._armyInfo.addHp):"FROM_ATK"==e?this._armyInfo.baseAtk+t*this._armyInfo.addAtk:"TO_ATK"==e?(this._armyInfo.impAtk||this._armyInfo.baseAtk)+t*(this._armyInfo.impAddAtk||this._armyInfo.addAtk):"FROM_DEF"==e?this._armyInfo.baseDef+t*this._armyInfo.addDef:"TO_DEF"==e?(this._armyInfo.impDef||this._armyInfo.baseDef)+t*(this._armyInfo.impAddDef||this._armyInfo.addDef):void 0},getUnitEquipAddtion:function(){for(var e=0,t=0,a=0,n=0;n<this._armyInfo.equips.length;++n)
if(0<this._armyInfo.equips[n]){var i=this._armyInfo.itemsUpgrade[n][0];t+=r.getUnitEquipHADPlus(i,"atk"),a+=r.getUnitEquipHADPlus(i,"def"),e+=r.getUnitEquipHADPlus(i,"maxhp")}
return[e,t,a]},updateArmyInfoAttr:function(){var e=this.getUnitEquipAddtion(),t=s(e,3),a=t[0],n=t[1],i=t[2];a+=this.getArmyInfoAttr("FROM_HP"),n+=this.getArmyInfoAttr("FROM_ATK"),i+=this.getArmyInfoAttr("FROM_DEF"),this._createindex=0;var r=this._armyInfo.impdes2||this._armyInfo.des2;this.AddAttr(o.t("detail_004",{value:a}),this.getArmyInfoAttr("TO_HP")),this.AddAttr(o.t("detail_005",{value:n}),this.getArmyInfoAttr("TO_ATK")),this.AddAttr(o.t("detail_006",{value:i}),this.getArmyInfoAttr("TO_DEF")),this.AddAttr(this._armyInfo.des2.replace("。",""),r.replace("。","")),this.DisableAttr()},Upgrade_OnClickHandler:function(e){c.playBtnOpenEffect(),10<=this._unitgrade?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),o.t("detail_050")):i.send_C2SCardUpgradeUnit(DonotDestroyManager._gameSocket,this._heroid)},Mask_OnClickHandler:function(e){MyUiManager.Back(),c.playBtnCloseEffect(),null!=this._cb&&this._cb(this._curlevel,this._unitgrade)},showGuide:function(){var t=this;l.showGuide("ArmyUpgradeDialog",function(e){if(1==e)
return t.m_pBtnUp.node})}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GuideBufferMgr:"GuideBufferMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",UnitBufferMgr:"UnitBufferMgr",i18n:"i18n"}],ArmyUplevelDialog:[function(e,t,a){"use strict";cc._RF.push(t,"33ce2o1evNPRrRpr/iPxniA","ArmyUplevelDialog");var n=e("ColorUtil"),i=e("PropHintsEffect"),r=(e("ResLoaderManager"),e("MyProtocols")),s=e("NetEvent"),o=e("MyEventDispatcher"),c=e("SoundUtil"),l=e("i18n"),h=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pStrengthpre:cc.Prefab,m_pSoldierParent:cc.Node,m_pQualityFrame:cc.Sprite,m_pAttributeItem:cc.Prefab,m_pAttrParnet:cc.Node,m_pName:cc.Label,m_pLevel:cc.Label,m_pNeedBF:cc.Label,m_pHasBF:cc.Label,btnMax:cc.Node,_unittype:-1,_unitgrade:-1,_curlevel:-1,_soldierjson:null,_costjson:null,_soldierpre:null,_soldieritem:null,_soldieritemlist:[],_raw_assets:{default:{},type:Object},_strengtheffect:null,_strengthani:null,_isPlayEffect:!1,_createindex:-1,_attritemlist:[],_hasnum:-1,_heroid:-1,_cb:null,_lastlevel:-1},onLoad:function(){this.S2CCardTrain_auth_cb_func=this.S2CCardTrain_auth_cb.bind(this),o.addListener(s.S2CCardTrain,this.S2CCardTrain_auth_cb_func),this.S2CCardAutoTrain_auth_cb_func=this.S2CCardAutoTrain_auth_cb.bind(this),o.addListener(s.S2CCardAutoTrain,this.S2CCardAutoTrain_auth_cb_func)},setParams:function(e){this._unittype=e.type,this._unitgrade=e.grade,this._curlevel=e.lv,this._heroid=e.heroid,this._cb=e.cb,this._raw_assets=e.map,this._lastlevel=this._curlevel,this._soldierjson=DonotDestroyManager.GameData.Units.unit_types[this._unittype-1][this._unitgrade-1],this._soldierpos=new Array(cc.p(0,0),cc.p(-70,5),cc.p(-25,35),cc.p(-45,-30),cc.p(45,30),cc.p(20,-40),cc.p(65,-10)),this.Init(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},S2CCardTrain_auth_cb:function(e){c.playSoldUpgrade1Effect(),MyPersistDataManager._playerData.cardsMaplist[e.card_id].unit_level=e.unit_level,this._lastlevel=this._curlevel,this._curlevel=e.unit_level,this._hasnum=e.itemNum,this._isPlayEffect=!0,this.CreateEffect(),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight},S2CCardAutoTrain_auth_cb:function(e){c.playSoldUpgrade1Effect(),MyPersistDataManager._playerData.cardsMaplist[e.card_id].unit_level=e.unit_level,this._lastlevel=this._curlevel,this._curlevel=e.unit_level,this._hasnum=e.itemNum,this._isPlayEffect=!0,this.CreateEffect(),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight},Init:function(){this._costjson=DonotDestroyManager.GameData.Units.cost[this._unittype-1][this._unitgrade-1],this.m_pName.string=this._soldierjson.name,this.m_pName.node.color=n.getColorByQuality(this._soldierjson.quality),this.m_pLevel.string="LV."+this._curlevel+"/"+this._costjson.max_level,this.m_pNeedBF.string="x"+this._costjson.levelup_item_num[this._curlevel%10],null!=MyPersistDataManager._playerData.bagMap[1104]&&(this._hasnum=MyPersistDataManager._playerData.bagMap[1104].num),this.m_pHasBF.string="x"+this._hasnum,this._hasnum<this._costjson.levelup_item_num[this._curlevel]?(this.m_pNeedBF.node.color=cc.Color.RED,this.m_pHasBF.node.color=cc.Color.RED):(this.m_pNeedBF.node.color=cc.Color.GREEN,this.m_pHasBF.node.color=cc.Color.GREEN),this.CreateAllSoldier(),this.CreateAttr()},CreateAttr:function(){this._createindex=0,l.t("detail_004",{value:e}),this.AddAttr(l.t("detail_007",{value:this._curlevel}),this._curlevel+1);var e=this._soldierjson.ori_attrs.maxhp+(this._curlevel-1)*this._soldierjson.add_attrs.maxhp,t=this._soldierjson.ori_attrs.maxhp+this._curlevel*this._soldierjson.add_attrs.maxhp;this.AddAttr(l.t("detail_004",{value:e}),t);var a=this._soldierjson.ori_attrs.atk+(this._curlevel-1)*this._soldierjson.add_attrs.atk,n=this._soldierjson.ori_attrs.atk+this._curlevel*this._soldierjson.add_attrs.atk;this.AddAttr(l.t("detail_005",{value:a}),n);var i=this._soldierjson.ori_attrs.def+(this._curlevel-1)*this._soldierjson.add_attrs.def,r=this._soldierjson.ori_attrs.def+this._curlevel*this._soldierjson.add_attrs.def;this.AddAttr(l.t("detail_006",{value:i}),r),this.DisableAttr()},AddAttr:function(e,t){var a=null;this._createindex<this._attritemlist.length?a=this._attritemlist[this._createindex]:(a=cc.instantiate(this.m_pAttributeItem),this.m_pAttrParnet.addChild(a),this._attritemlist.push(a)),a.active=!0,a.getComponent("AttributeChangeItem").ChangeData(e,t,this._isPlayEffect),++this._createindex},DisableAttr:function(){for(var e=this._createindex;e<this._attritemlist.length;++e)
this._attritemlist[e].active=!1},CreateAllSoldier:function(){this.ClearSoldierItem();for(var e=0;e<7;++e)
this.CreateSoldierModel(e)},CreateSoldierModel:function(a){var n=this;this._soldierPrefabPath="Prefab/battle/soldier/"+this._soldierjson.icon+"_blue",cc.loader.loadRes(this._soldierPrefabPath,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),n._soldierpre=t,n._soldieritem=cc.instantiate(t),n.m_pSoldierParent.addChild(n._soldieritem),n._soldieritem.setPosition(n._soldierpos[a]),n._soldieritem.setScale(-1,1),n._soldieritemlist.push(n._soldieritem),n._soldieritem.getComponent(cc.Animation).play("stand")})},ClearSoldierItem:function(){if(!(null==this._soldieritemlist||this._soldieritemlist.length<=0)){for(var e=this._soldieritemlist.length-1;0<=e;--e)
this._soldieritemlist[e].removeFromParent(),this._soldieritemlist[e].destroy();if(null!=this._soldierpre){this._soldierjson.icon;this._soldierPrefabPath}
this._soldierpre=null,this._soldieritem=null,this._soldieritemlist=[]}},CreateEffect:function(){null!=this._strengtheffect&&(this._strengtheffect.removeFromParent(),this._strengtheffect.destroy(),(this._strengtheffect=null)!=this._strengthani&&this._strengthani.off("finished",this.onAnimCompleted,this)),this._strengtheffect=cc.instantiate(this.m_pStrengthpre),this.m_pSoldierParent.addChild(this._strengtheffect),this._strengtheffect.setScale(2),this._strengthani=this._strengtheffect.getComponent(cc.Animation),this._strengthani.on("finished",this.onAnimCompleted,this),this._strengthani.play()},onAnimCompleted:function(){null!=this._strengthani&&this._strengthani.off("finished",this.onAnimCompleted,this),null!=this._tmskstreffect&&(this._tmskstreffect.removeFromParent(),this._tmskstreffect.destroy(),this._tmskstreffect=null),this._strengthani=null,this.PlayerTextTipEffect(),this._isPlayEffect=!1},RefreshArmyInfo:function(){this.m_pLevel.string="LV."+this._curlevel+"/"+this._costjson.max_level,this.m_pHasBF.string="x"+this._hasnum,this.m_pNeedBF.string="x"+this._costjson.levelup_item_num[this._curlevel%10],this.CreateAttr(),this._curlevel==this._costjson.max_level&&(MyUiManager.Back(),null!=this._cb&&this._cb(this._heroid))},Mask_OnClickHandler:function(e){MyUiManager.Back(),c.playBtnCloseEffect(),null!=this._cb&&this._cb(this._heroid)},UpOne_OnClickHandler:function(e){c.playBtnOpenEffect(),this._hasnum<this._costjson.levelup_item_num[this._curlevel]?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),l.t("detail_008")):r.send_C2SCardTrain(DonotDestroyManager._gameSocket,this._heroid)},PlayerTextTipEffect:function(){var e=[[1,this._soldierjson.add_attrs.maxhp],[2,this._soldierjson.add_attrs.atk],[3,this._soldierjson.add_attrs.def]];i.runHeroPropEffect(this.node,{elemIdx:3,upgradeLv:this._curlevel-this._lastlevel,stateIdx:1},e,this.RefreshArmyInfo.bind(this),this._raw_assets)},UpMax_OnClickHandler:function(e){c.playBtnOpenEffect(),this._hasnum<this._costjson.levelup_item_num[this._curlevel]?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),l.t("detail_008")):r.send_C2SCardAutoTrain(DonotDestroyManager._gameSocket,this._heroid)},onDestroy:function(){o.removeListener(s.S2CCardTrain,this.S2CCardTrain_auth_cb_func),o.removeListener(s.S2CCardAutoTrain,this.S2CCardAutoTrain_auth_cb_func),this._soldierpre=null,this._soldieritem=null},showGuide:function(){var t=this;h.showGuide("ArmyUplevelDialog",function(e){if(1==e)
return t.btnMax})}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",PropHintsEffect:"PropHintsEffect",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil",i18n:"i18n"}],Army:[function(f,e,t){"use strict";cc._RF.push(e,"a2a7dS+2SBO8KvogYMYmSlR","Army");var g=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=f("FormationCfgMgr"),y=f("BattleConstants"),h=f("SoundUtil"),v=f("StrategyLine"),a=(f("GameUtils"),cc.Class({extends:f("WActor"),properties:{},ctor:function(){cc.log("Army create!"),this.side=1,this.col=0,this.row=0,this.hero=null,this.soldiers=[],this.slotsNum=2,this.target=null,this.meetTime=2,this.strategyPath=[],this.strategyLine=null,this.strategyVec=null,this.strategyPos=null,this.marchST=null,this.delayMove=0},isTargetAble:function(){},switchAttackTarget:function(){},getAtkType:function(){return this.hero?this.hero.getAtkType():this.soldiers[0]?this.soldiers[0].getAtkType():null},getArmyType:function(){return this.hero?this.hero.cfg.unit_type:this.soldiers[0].uType},setLocation:function(e,t){var a=s.findFormation(e.formation),n=a.positions[t];this.col=n[0]+e.forward,1==e.flip?this.row=6-n[1]:this.row=n[1],this.strategyPath=cc.clone(a.actions[t].path);for(var i=0;i<this.strategyPath.length;i++){var r=this.strategyPath[i];this.side==y._BTL_SIDE.OTR?(r[0]=-r[0],1==e.flip&&(r[1]=-r[1])):this.side==y._BTL_SIDE.OUR&&1==e.flip&&(r[1]=-r[1])}},getPosition:function(){var a=cc.p(1200,515),n=cc.p(-1200,-515),e=function(e,t){a.x=Math.min(e,a.x),a.y=Math.min(t,a.y),n.x=Math.max(e,n.x),n.y=Math.max(t,n.y)};if(this.hero&&"Dead"!=this.hero.getState()){var t=this.hero.getPosition(),i=t.x;e(i-=(s=t.y)/2,s)}
for(var r=0;r<this.soldiers.length;r++){var s,o=this.soldiers[r].getPosition();i=o.x;e(i-=(s=o.y)/2,s)}
var c=cc.pMidpoint(a,n);return cc.p(c.x+c.y/2,c.y)},add2Battle:function(e){var t,a,n,i;e?(t=e.x,a=e.y):this.side==y._BTL_SIDE.OUR?(t=300*this.col-1450,a=155*this.row-10-515):this.side==y._BTL_SIDE.OTR&&(t=-300*this.col+1500,a=155*this.row-10-515);var r=this.side;if(this.faceSide&&(r=this.faceSide),this.hero&&"Dead"!=this.hero.getState()){var s=this.getHeroPos2Army(),o=g(s,2);n=o[0],i=o[1],this.hero.setPosition(t+n*r,a+i),this.hero.add2Parent(),this.hero.setFSM()}
for(var c=0;c<this.soldiers.length;c++){var l=this.soldiers[c],h=Math.floor(c/5),d=c%5,_=this.getSoldierPos2Army(h,d,l.uType),u=g(_,2);n=u[0],i=u[1],l.setPosition(t+n*r,a+i),l.add2Parent(),l.setFSM()}
this.setFSM(),this.strategyPos=cc.p(this.getPosition());for(c=0;c<this.strategyPath.length;c++){var m=this.strategyPath[c];m[0]=this.strategyPos.x+m[0],m[1]=this.strategyPos.y+m[1],m[0]=m[0]-m[1]/2}
if(this.strategyPos.x=this.strategyPos.x-this.strategyPos.y/2,0<this.strategyPath.length){this.strategyPath.splice(0,0,[this.strategyPos.x,this.strategyPos.y]),this.strategyLine=new v,this.strategyLine.setPath(this.strategyPath),this.strategyLine.setTeamFrom(this.side==y._BTL_SIDE.OUR),this.strategyLine.setFSM();var p=f("BattleUiMgr");this.strategyLine.add2Layer(p.getInstance().bf_node),this.strategyLine.doEvent("Pointto"),this.doEvent("Strategy")}},getHeroPos2Army:function(){return[100,58]},getSoldierPos2Army:function(e,t,a){var n=1;return 2==a&&(n=1.3),[35-40*e*n,112-27*t]},isSearchAble:function(){var e=this.getState();return"Idle"==e||"Charge"==e||"Move"==e||"Meet"==e||"Arrange"==e},isArranged:function(){var e=!1;(!this.hero||"Dead"==this.hero.getState()||!this.hero.move2Pos||"Idle"==this.hero.getState()&&this.hero.move2Pos)&&(e=!0);for(var t=0;t<this.soldiers.length;t++){if(this.soldiers[t].move2Pos){e=!1;break}}
return e},getVector2Target:function(){var e=this.target.getPosition(),t=e.x,a=e.y,n=this.getPosition(),i=n.x,r=n.y;return cc.pSub(cc.p(t,a),cc.p(i,r))},setMoveVector:function(){var e=this.getVector2Target();this.hero&&"Dead"!=this.hero.getState()&&(this.hero.disVector=e);for(var t=0;t<this.soldiers.length;t++){this.soldiers[t].disVector=e}},removeDeadSoldier:function(e){for(var t=0;t<this.soldiers.length;t++){if(this.soldiers[t]==e){this.soldiers.splice(t,1);break}}},onenterIdle:function(){this.hero&&"Dead"!=this.hero.getState()&&this.hero.doEvent("Idle");for(var e=0;e<this.soldiers.length;e++){this.soldiers[e].doEvent("Idle")}},onenterMove:function(){var e=f("BattleManager");this.hero&&"Dead"!=this.hero.getState()&&this.hero.doEvent("Move");for(var t=0;t<this.soldiers.length;t++){this.soldiers[t].doEvent("Move")}
var a=this.getArmyType();if(10!=a&&11!=a){var n=h.getBattleSound("march",a),i=g(n,2),r=i[0],s=i[1],o=0;2==a&&(o=1),e.marchSE[o]||(this.marchST=s,e.marchSE[o]=h.playEffect(r))}},onleaveMove:function(){var e=f("BattleManager");if(this.marchST){for(var t in e.marchSE){var a=e.marchSE[t];h.stopEffect(a)}
this.marchST=null}},onenterArrange:function(){var e,t,a;if(this.hero&&"Dead"!=this.hero.getState()){a=this.hero.getState();var n=this.hero.getPosition();e=n.x,t=n.y;var i=this.getHeroPos2Army(),r=g(i,2),s=r[0],o=r[1];this.hero.move2Pos=cc.p(e,t),e-=s*this.side,t-=o,"Attack"!=a?(this.hero.doEvent("Idle"),this.hero.doEvent("Move")):this.hero.nextEv="Idle"}else{var c=this.getPosition();e=c.x,t=c.y}
for(var l=0;l<this.soldiers.length;l++){var h=this.soldiers[l];a=h.getState();var d=Math.floor(l/5),_=l%5,u=this.getSoldierPos2Army(d,_,h.uType),m=g(u,2),p=m[0],f=m[1];h.move2Pos=cc.p(e+p*this.side,t+f),"Attack"!=a?(h.doEvent("Idle"),h.doEvent("Move")):h.nextEv="Idle"}},onleaveArrange:function(){this.hero&&(this.hero.move2Pos=null);for(var e=0;e<this.soldiers.length;e++){this.soldiers[e].move2Pos=null}},onleaveMeet:function(){this.hero&&(this.hero.meet2Pos=null);for(var e=0;e<this.soldiers.length;e++){this.soldiers[e].meet2Pos=null}},onenterDestory:function(){var e=f("StagesEventManager"),t=f("ArmiesManager");e.dispatchTrigger3(this.hero),t.removeArmy(this)},onenterVictory:function(){this.hero&&"Dead"!=this.hero.getState()&&this.hero.doEvent("Cheer");for(var e=0;e<this.soldiers.length;e++){this.soldiers[e].doEvent("Cheer")}},onenterStrategy:function(){var e=f("EffectsManager"),t=cc.p(this.strategyPath[0][0],this.strategyPath[0][1]);t.x=t.x+t.y/2;var a=e.createEffect();a.id=930,a.target=t,a.setFSM();var n=e.createEffect();n.id=931,n.target=t,n.setFSM(),this.strategyLine.doEvent("Marquee")},onleaveStrategy:function(){var e=f("EffectsManager"),t=cc.p(this.strategyPath[this.strategyPath.length-1][0],this.strategyPath[this.strategyPath.length-1][1]);t.x=t.x+t.y/2;var a=e.createEffect();a.id=933,a.target=t,a.setFSM();var n=e.createEffect();n.id=934,n.target=t,n.setFSM()},onUpdate:function(e){var t=f("BattleManager");if(this.marchST&&(this.marchST=this.marchST-e,this.marchST<=0)){var a=this.getArmyType(),n=h.getBattleSound("march",a),i=g(n,2),r=i[0],s=i[1],o=0;2==a&&(o=1),this.marchST=s,t.marchSE[o]=h.playEffect(r)}
if(this.chargeST&&(this.chargeST=this.chargeST-e,this.chargeST<=0)){a=this.getArmyType();var c=h.getBattleSound("assault",a),l=g(c,2);r=l[0],s=l[1],o=0;2==a&&(o=1),this.chargeST=s,t.chargeSE[o]=h.playEffect(r)}},updateStrategy:function(e){if(!this.hero||!this.hero.openSkilled){var t;t=this.hero?this.hero.uCfg.assault_speed:this.soldiers[0].cfg.assault_speed;var n,i,r=this;this.strategyVec=this.strategyVec||(n=1,i=null,function(e){var t,a;return i?(t=cc.p(r.strategyPath[n][0],r.strategyPath[n][1]),cc.pDistance(r.strategyPos,t)<=e&&(r.strategyPos=t,n<r.strategyPath.length-1&&(a=cc.p(r.strategyPath[n+1][0],r.strategyPath[n+1][1]),i=cc.pSub(a,t)),n+=1)):(t=cc.p(r.strategyPath[0][0],r.strategyPath[0][1]),a=cc.p(r.strategyPath[1][0],r.strategyPath[1][1]),i=cc.pSub(a,t)),[n,i]});var a=this.strategyVec(t*e),s=g(a,2),o=s[0],c=s[1];if(o>this.strategyPath.length-1){this.doEvent("Idle"),this.hero&&(this.hero.node.opacity=255);for(var l=0;l<this.soldiers.length;l++){(_=this.soldiers[l]).node.opacity=255}
this.strategyLine.doEvent("Cancel")}else{var h=255*o/this.strategyPath.length*.6;if(e=cc.director.getScheduler().getTimeScale()*e*(null!=this.hero?this.hero.speedup:1),this.hero){this.hero.disVector=c;var d=this.hero.cfg.unit_type;3==d||5==d?this.hero.move(t,e):this.hero.move(t,e,"assault"),this.hero.node.opacity=h}
for(l=0;l<this.soldiers.length;l++){var _;(_=this.soldiers[l]).disVector=c,3==_.uType||5==_.uType?_.move(t,e):_.move(t,e,"assault"),_.node.opacity=h}
var u=cc.pMult(cc.pNormalize(c),t*e),m=cc.p(this.strategyPath[o][0],this.strategyPath[o][1]);cc.pDistance(this.strategyPos,m)<cc.pLength(u)?this.strategyPos=m:this.strategyPos=cc.pAdd(this.strategyPos,u),this.strategyLine.updatePoints(this.strategyPos.x+this.strategyPos.y/2,this.strategyPos.y)}}}}));e.exports=a,cc._RF.pop()},{ArmiesManager:"ArmiesManager",BattleConstants:"BattleConstants",BattleManager:"BattleManager",BattleUiMgr:"BattleUiMgr",EffectsManager:"EffectsManager",FormationCfgMgr:"FormationCfgMgr",GameUtils:"GameUtils",SoundUtil:"SoundUtil",StagesEventManager:"StagesEventManager",StrategyLine:"StrategyLine",WActor:"WActor"}],ArrowsManager:[function(t,e,a){"use strict";function n(){this.arrowActors=[],this.arrow1Pool=new cc.NodePool("arrow1"),this.arrow2Pool=new cc.NodePool("arrow2"),this.arrow3Pool=new cc.NodePool("arrow3"),this.iceBall1Pool=new cc.NodePool("iceBall1"),this.lightningBall1Pool=new cc.NodePool("lightningBall1")}
cc._RF.push(e,"d0420CjAmdHr6SBymoWDFNK","ArrowsManager"),n.prototype.resetData=function(){this.arrowActors=[],this.arrow1Pool.clear(),this.arrow2Pool.clear(),this.arrow3Pool.clear(),this.iceBall1Pool.clear(),this.lightningBall1Pool.clear()},n.prototype.putPool=function(e,t){this[e+"Pool"].put(t)},n.prototype.getPool=function(e){return this[e+"Pool"].get()},n.prototype.createArrow=function(){var e=new(t("Arrow"));return this.arrowActors.push(e),e},n.prototype.getCfgById=function(e){return DonotDestroyManager.GameData.Arrows[e-1]},n.prototype.removeArrow=function(e){for(var t=0;t<this.arrowActors.length;t++)
if(this.arrowActors[t]==e){this.arrowActors.splice(t,1);break}},n.prototype.pause=function(){for(var e=0;e<this.arrowActors.length;e++){this.arrowActors[e].node.pauseAllActions()}},n.prototype.resume=function(){for(var e=0;e<this.arrowActors.length;e++){this.arrowActors[e].node.resumeAllActions()}},e.exports=new n,cc._RF.pop()},{Arrow:"Arrow"}],Arrow:[function(g,e,t){"use strict";cc._RF.push(e,"e9a4bg16qVJI7zI+3PDs+yC","Arrow");var a=g("BattleConstants"),n=g("state-machine"),i=g("DamageLogic"),r=cc.Class({extends:g("WActor"),properties:{},ctor:function(){cc.log("Arrow create!"),this.id=0,this.cfg={},this.from=null,this.to=null,this.amt=null},setFSM:function(){var i=this;this.fsm=n.create({initial:"Init",events:[{name:"Fly",from:"Init",to:"Fly"},{name:"Dead",from:"Fly",to:"Dead"}],callbacks:{onenterstate:function(e,t,a){},onenterStart:function(e,t,a,n){i.onenterStart(e,t,a,n)},onenterDead:function(){i.onenterDead()},onenterInit:function(){i.onenterInit()},onenterFly:function(){i.onenterFly()}}})},setPosition:function(e,t){this._super(e,t),this.setLocalZOrder(a._BTL_ZORDER.BF_ARROW)},onenterInit:function(){var e=g("ArrowsManager");this.cfg=e.getCfgById(this.id);var t="Prefab/battle/arrow/"+this.cfg.file,a=g("BattleSceneMgr"),n=e.getPool(this.cfg.file);null==n?this.node=cc.instantiate(a.getInstance()._raw_assets[t]):(this.node=n,this.node.opacity=255),this.amt=this.node.getComponent(cc.Animation);var i=this;setTimeout(function(){i.doEvent("Fly")},10)},onenterFly:function(){var e,t=g("ArrowsManager"),a=this.from.getPosition(),n=a.x,i=a.y,r=this.to.getPosition(),s=r.x,o=r.y;n+=(e=n<s?1:-1)*this.cfg.deltafp[0],i+=this.cfg.deltafp[1],s+=e*this.cfg.deltatp[0],o+=this.cfg.deltatp[1],this.setPosition(n,i),this.add2Parent(),n-=i/2,s-=o/2;var c,l=cc.v2(s,o).sub(cc.v2(n,i)),h=l.mag(),d=h/this.cfg.speed;if(1==this.cfg.tracktype){var _=180/Math.PI*cc.pToAngle(l);this.node.rotation=-180-_,c=cc.sequence(cc.moveTo(d,cc.p(s,o)),cc.callFunc(function(){this.doEvent("Dead")},this),cc.callFunc(function(){t.putPool(this.cfg.file,this.node),this.node.stopAllActions()},this))}else if(2==this.cfg.tracktype){var u=cc.pMidpoint(cc.p(n,i),cc.p(s,o)),m=h/2.5;u.y=Math.max(Math.max(u.y,i),o)+m;var p=180/Math.PI*cc.pToAngle(cc.pSub(u,cc.p(n,i))),f=-p;this.node.rotation=-180-p,c=cc.sequence(cc.spawn(cc.jumpTo(d,cc.p(s,o),m,1),cc.rotateTo(d,-180-f)),cc.callFunc(function(){this.doEvent("Dead")},this),cc.delayTime(3),cc.fadeOut(1),cc.callFunc(function(){t.putPool(this.cfg.file,this.node),this.node.stopAllActions()},this))}
this.node.runAction(c),this.playAnimation("fly")},playAnimation:function(e){cc.log("Arrow playAnimation=%s",e),this.amt.play(e)},onenterDead:function(){this.playAnimation("die"),g("ArrowsManager").removeArrow(this);var e=0;if(null!=this.from.cfg.hp_perc_dmg){var t=this.from.hp/this.from.basehp;e=(1-(t=1<=(t=t<=0?0:t)?1:t))*this.from.cfg.hp_perc_dmg}
i.commonDamage(this.from,this.to,e)}});e.exports=r,cc._RF.pop()},{ArrowsManager:"ArrowsManager",BattleConstants:"BattleConstants",BattleSceneMgr:"BattleSceneMgr",DamageLogic:"DamageLogic",WActor:"WActor","state-machine":"state-machine"}],AttrChangeLabel:[function(e,t,a){"use strict";cc._RF.push(t,"be220L33ClFfb3q7/dWGZaZ","AttrChangeLabel"),cc.Class({extends:cc.Component,properties:{m_pAddNum:cc.Label,m_pSubNum:cc.Label,m_pAddorSub:cc.Sprite,m_pAttrType:cc.Sprite,m_pAttrPre:cc.Prefab,m_pAddAttrTypeList:[cc.SpriteFrame],m_pSubAttrTypeList:[cc.SpriteFrame],m_pAddorSubList:[cc.SpriteFrame]},onLoad:function(){},ChangeData:function(e){var t=e.shift();this.node.opacity=255,cc.log(" mới bắt đầu hóa =="+t.attr),t.isadd?(this.m_pSubNum.node.active=!1,this.m_pAddNum.node.active=!0,this.m_pAddNum.string=t.attr,this.m_pAddorSub.spriteFrame=this.m_pAddorSubList[0],this.m_pAttrType.spriteFrame=this.m_pAddAttrTypeList[t.attrtype]):(this.m_pSubNum.node.active=!0,this.m_pAddNum.node.active=!1,this.m_pSubNum.string=t.attr,this.m_pAddorSub.spriteFrame=this.m_pAddorSubList[1],this.m_pAttrType.spriteFrame=this.m_pSubAttrTypeList[t.attrtype]);var a=cc.callFunc(this.CheckListLength,this,e);this.node.setPosition(0,-70*t.index);var n=cc.sequence(cc.spawn(cc.moveBy(.8,cc.p(0,70)),cc.fadeOut(1.2).easing(cc.easeIn(2.5)),a),cc.callFunc(function(e){e.destroy()}));this.node.runAction(n)},CheckListLength:function(e,t){if(cc.log(" tiến vào kiểm tra =="+t.length),0<t.length){var a=cc.instantiate(this.m_pAttrPre);this.node.parent.addChild(a),a.getComponent("AttrChangeLabel").ChangeData(t)}}}),cc._RF.pop()},{}],AttributeChangeItem:[function(e,t,a){"use strict";cc._RF.push(t,"2c2aaOHQnNKIJQQrZFTxPvk","AttributeChangeItem");cc.Class({extends:cc.Component,properties:{m_pLeftvalue:cc.Label,m_pArrow:cc.Sprite,m_pRightvalue:cc.Label,m_pSecondStreamer:cc.Prefab,_streamereffect:null,_armatureDisplay:null,_armature:null,_isPlayEffect:!1},onLoad:function(){},ChangeData:function(e,t,a){this.m_pLeftvalue.string=e,this.m_pRightvalue.string=t,a&&this.CreateEffect(),t<=0?(this.m_pRightvalue.node.active=!1,this.m_pArrow.node.active=!1):(this.m_pRightvalue.node.active=!0,this.m_pArrow.node.active=!0)},CreateEffect:function(){this._streamereffect=cc.instantiate(this.m_pSecondStreamer),this.m_pLeftvalue.node.addChild(this._streamereffect),this._streamereffect.setPosition(120,0),this._armatureDisplay=this._streamereffect.getComponent(dragonBones.ArmatureDisplay),this._armature=this._armatureDisplay.armature(),this._armature.animation.fadeIn("Action1",-1,-1,0,"normal"),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this.onAnimCompleted,this)},onAnimCompleted:function(e){cc.log(" ta truyền phát tin xong rồi bắt đầu cắt bỏ "),e.type===dragonBones.EventObject.COMPLETE&&(this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onAnimCompleted,this),null!=this._streamereffect&&(this._streamereffect.removeFromParent(),this._streamereffect.destroy(),this._streamereffect=null))},onDestroy:function(){null!=this._armatureDisplay&&this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onAnimCompleted,this)}}),cc._RF.pop()},{}],AvoidWarDialog:[function(e,t,a){"use strict";cc._RF.push(t,"14d4brEundEs5IOaCV7iEIy","AvoidWarDialog");var n=e("MyProtocols"),i=e("NetEvent"),r=e("MyEventDispatcher"),s=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pMoneyNum:cc.Label,m_pMianzhannum:cc.Label,m_pleftbg:cc.Node,m_pRightbg:cc.Node,_diamond:-1,_itemcnt:-1},onLoad:function(){this.S2CTreasureAvoidRob_cb_func=this.S2CTreasureAvoidRob_cb.bind(this),r.addListener(i.S2CTreasureAvoidRob,this.S2CTreasureAvoidRob_cb_func)},onDestroy:function(){r.removeListener(i.S2CTreasureAvoidRob,this.S2CTreasureAvoidRob_cb_func)},ChangeData:function(e){this._cb=e.cb,this.Init()},Init:function(){this._diamond=MyPersistDataManager._playerData.money,this.m_pMoneyNum.string=this._diamond,this.m_pRightbg.width=this.m_pMoneyNum.node.width+10,this._itemcnt=this.GetItemCnt(),this.m_pMianzhannum.string=this._itemcnt,this.m_pleftbg.width=this.m_pMianzhannum.node.width+10},S2CTreasureAvoidRob_cb:function(e){cc.log(" miễn chiến tin tức tiếp thu "),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," miễn chiến đã muốn mở ra ..."),this._cb&&this._cb(e.timeStamp),this._diamond=MyPersistDataManager._playerData.money,this.m_pMoneyNum.string=this._diamond,this.m_pRightbg.width=this.m_pMoneyNum.node.width+10,this._itemcnt=this.GetItemCnt(),this.m_pMianzhannum.string=this._itemcnt,this.m_pleftbg.width=this.m_pMianzhannum.node.width+10},GetItemCnt:function(){var e=0;return null!=MyPersistDataManager._playerData.bagMap[1005]&&(e=MyPersistDataManager._playerData.bagMap[1005].num),e},OnClickHandler:function(e,t){if(s.playBtnOpenEffect(),0==parseInt(t)){if(this._itemcnt<=0)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," đạo cụ số lượng không đủ ");n.send_C2STreasureAvoidRob(DonotDestroyManager._gameSocket,1)}else{if(this._diamond<20)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," vàng không đủ ");n.send_C2STreasureAvoidRob(DonotDestroyManager._gameSocket,2)}},Mask_OnClickHandler:function(e){s.playBtnCloseEffect(),this.node.active=!1}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],BGAutoMove:[function(e,t,a){"use strict";cc._RF.push(t,"2d9dcPSqOhKJoJs7BKazsqN","BGAutoMove"),cc.Class({extends:cc.Component,properties:{bg_home_1_node:{default:null,type:cc.Node},rate:{default:1,type:cc.Integer}},onLoad:function(){},update:function(e){this.node.x=this.bg_home_1_node.x/this.rate}}),cc._RF.pop()},{}],BagBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"3398a6lghtJdLRgG/mKOXNq","BagBufferMgr");e("ItemBufferMgr");var u=e("ConsumeBufferMgr"),m=e("EquipFragBufferMgr"),n=function(){};n.prototype.hasRedPoints=function(){for(var e=DonotDestroyManager.GameData.Consumes,t=DonotDestroyManager.GameData.Boxes,a=DonotDestroyManager.GameData.EquipFrags,n=[!1,!1],i=u.getList(),r=0;r<i.length;r++){var s=i[r].template_id;if(null!=e[s]){n[0]=!0;break}
if(null!=t[s]){var o=t[s].key,c=o[0];if(0==o[1]){n[0]=!0;break}
if(null!=MyPersistDataManager._playerData.bagMap[c]){n[0]=!0;break}}}
for(var l=m.getList(),h=0;h<l.length;h++){var d=l[h],_=a[d.template_id].craft_num;if(d.num>=_){n[1]=!0;break}}
return n},t.exports=new n,cc._RF.pop()},{ConsumeBufferMgr:"ConsumeBufferMgr",EquipFragBufferMgr:"EquipFragBufferMgr",ItemBufferMgr:"ItemBufferMgr"}],BattleBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"f6dd56sCJVHa5eRuyX5Btpl","BattleBufferMgr");var n=function(){this.g_formationData=[],this.formStausList={}};n.prototype.isHasFidFormation=function(e){for(var t=0;t<this.g_formationData.length;t++){if(this.g_formationData[t].fid==e)
return!0}
return!1},n.prototype.setFormationData=function(e,t){if(!this.isHasFidFormation(e))
return t.fid=e,void this.g_formationData.push(t);for(var a=0;a<this.g_formationData.length;a++){var n=this.g_formationData[a];if(n.fid==e)
return n.formationId=t.formationId,n.forward=t.forward,n.flip=t.flip,n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n.e=t.e,n.f=t.f,n.g=t.g,n.h=t.h,n.i=t.i,void(n.j=t.j)}},n.prototype.getFormationData=function(e){for(var t=0;t<this.g_formationData.length;t++){var a=this.g_formationData[t];if(a.fid==e)
return a}
cc.log("fids:"+Object.keys(this.g_formationData));return{fid:1,formationId:1,forward:1,flip:0,a:0,b:0,c:0,d:0,e:0,f:0,g:0,h:0,i:0,j:0}},n.prototype.resetFormationCard=function(e){e.a=0,e.b=0,e.c=0,e.d=0,e.e=0,e.f=0,e.g=0,e.h=0,e.i=0,e.j=0},n.prototype.removeFormationCard=function(e){for(var t=0;t<this.g_formationData.length;t++){var a=this.g_formationData[t];a.a==e&&(a.a=0),a.b==e&&(a.b=0),a.c==e&&(a.c=0),a.d==e&&(a.d=0),a.e==e&&(a.e=0),a.f==e&&(a.f=0),a.g==e&&(a.g=0),a.h==e&&(a.h=0),a.i==e&&(a.i=0),a.j==e&&(a.j=0)}},t.exports=new n,cc._RF.pop()},{}],BattleConstants:[function(e,t,a){"use strict";cc._RF.push(t,"60738rrHjJLvLvxExn2bjI9","BattleConstants");var n={Default:1,OvCome:2,Acts:function(e,t){return parseInt(e+t)}};t.exports={_BTL_TYPE:{PVE:1,Elite:2,Arena:3,Snatch:4,OvCome:5,Guider:6},_BTL_ZORDER:{UI_PAUSE:2,BF_BEHIND:1,BF_FIELD:2500,BF_FRONT:5001,BF_ARROW:5002,BF_BIGSK:5003,U_BELOW:1,U_SHADOW:2,U_ARMATURE:3,U_BLOOD:4,U_ABOVE:5},_BTL_SIDE:{OUR:1,OTR:-1},_BTL_TEAMSKILL:{LS:1,FB:2,LN:3,HC:4},_FMT:n,_BTL_STATE:{INIT:0,ING:1,WIN:2,FAIL:3,CHEER:4,PAUSE:5},_ARMY_TYPE:{Melee:1,Remote:3},_BUFF_TARGET:{OurUnit:0,OurHero:1,OtrUnit:2,OtrHero:3},_BUFF_TYPE:{Stun:100,Frozen:101},_SKILL_TRIGGER:{Opening:0,Damage:1,HP_Perc:2,PreDead:6},_SKILL_TARGET:{SelfBody:0,OurRandHero:1,OurRandUnit:2,OurLowestHP:3,OurFrontHero:4,CurAttacking:5,OtrRandHero:6,OtrRandUnit:7,OtrLowestHP:8,OtrRearHero:9,RandTargets:10,OurRemoteHero:11,OtrRemoteHero:12},_SKILL_IMPACT:{Mate:0,Enemy:1}},cc._RF.pop()},{}],BattleDataManager:[function(e,t,a){"use strict";cc._RF.push(t,"9f26a9+ddpNQb07sldfMs8Z","BattleDataManager");var i=e("FormationCfgMgr"),n=e("HeroConfigMgr"),r=e("TeamSkillCfgMgr"),s=function(){};s.prototype.init=function(e){this.name=e.name,this.level=e.level,this.formation=e.formation,this.flip=e.flip,this.forward=e.forward,this.side=e.side,this.fightVal=e.fightVal,this.teams=[],this.extraTeams=[],this.extraBuffs=[],this.positions={},this.tmSkLvs=r.getTmSkLvs(this.level)},s.prototype.addHeroWithPosition=function(e,t){e.hero.uType=n.find(e.hero.id).unit_type,this.setPosition(e,t),this.teams.push(e)},s.prototype.addCardWithPosition=function(e,t){var a=this.createTeam(e);this.setPosition(a,t),this.teams.push(a)},s.prototype.setPosition=function(e,t){var a=i.findFormation(this.formation),n=a.positions[t];e.col=n[0]+this.forward-1,1==this.flip?e.row=6-n[1]-1:e.row=n[1]-1,cc.log("row = %d, col = %d",e.row,e.col),e.position=t,e.hero.position=t,e.action=a.actions[t],this.positions[t]=e},s.prototype.createTeam=function(e){var t={hero:{}};return t.hero.heroId=e.template_id,t.hero.id=e.template_id,t.hero.level=e.level,t.hero.grade=e.grade,t.hero.icon=e.heroCfg.icon,t.hero.uType=e.heroCfg.unit_type,t.unit_level=e.unit_level,t.unit_grade=e.unitGrade,t.unit_num=e.unit_num,null!=e.hpPerc&&(t.hpPerc=e.hpPerc),null!=e.atkPerc&&(t.atkPerc=e.atkPerc),null!=e.unitNum&&(t.unitNum=e.unitNum),t},s.create=function(e){var t=new s;return t.init(e),t},t.exports=s,cc._RF.pop()},{FormationCfgMgr:"FormationCfgMgr",HeroConfigMgr:"HeroConfigMgr",TeamSkillCfgMgr:"TeamSkillCfgMgr"}],BattleDetailLayer:[function(e,t,a){"use strict";cc._RF.push(t,"82074tSCmpAdZd/kGCLim7G","BattleDetailLayer");var o=e("BattleManager");cc.Class({extends:cc.Component,properties:{mLeftContent:cc.Node,mRightContent:cc.Node,mItemPrefab:cc.Prefab},onLoad:function(){},ChangeData:function(e){if(null!=e){for(var t=[],a=[],n=1,i=0;i<o.ourside.armies.length;i++){var r=o.ourside.armies[i];null!=(s=e.getStatistics(r))&&(n=Math.max(n,s.damage),t.push(s))}
for(i=0;i<o.otrside.armies.length;i++){var s;r=o.otrside.armies[i];null!=(s=e.getStatistics(r))&&(n=Math.max(n,s.damage),a.push(s))}
t.sort(function(e,t){return t.damage-e.damage}),a.sort(function(e,t){return t.damage-e.damage}),this.SetScollItem(t,this.mLeftContent,0,n),this.SetScollItem(a,this.mRightContent,1,n)}},SetScollItem:function(e,t,a,n){var r=e.length;for(i=0;i<r;i++){var s=cc.instantiate(this.mItemPrefab);t.addChild(s);var o=s.getComponent("DamageItem");o._barstate=a,e[i].percent=e[i].damage/n,o.ChangeData(e[i])}},Back_OnClickHandler:function(e,t){this.node.removeFromParent(),this.node.destroy()}}),cc._RF.pop()},{BattleManager:"BattleManager"}],BattleFailMgr:[function(e,t,a){"use strict";cc._RF.push(t,"cfd9a5LL2xO5YQ/N3hzjpXK","BattleFailMgr");var n=e("GameUtils"),i=e("MarqueeBufferMgr");cc.Class({extends:cc.Component,properties:{snatch_award_uiRoot:cc.Node,arena_award_uiRoot:cc.Node,pk_uiRoot:cc.Node,mine_uiRoot:cc.Node,labelBg:cc.Node,_staticData:null},onLoad:function(){},initUi:function(e,t){if(this._staticData=t.staticData,3==e){var a=this.snatch_award_uiRoot;a.active=!0,this.labelBg.active=!0,a.getChildByName("StaminaValue").getComponent(cc.Label).string=t.stamina,a.getChildByName("ExpVaule").getComponent(cc.Label).string=t.exp,a.getChildByName("GMoney").getComponent(cc.Label).string=t.gmoney}
if(4==e){var n=this.arena_award_uiRoot;n.active=!0,this.labelBg.active=!0,n.getChildByName("StaminaValue").getComponent(cc.Label).string=t.stamina,n.getChildByName("HonorValue").getComponent(cc.Label).string=t.honor,n.getChildByName("GMoney").getComponent(cc.Label).string=t.gmoney}
8==e&&(this.pk_uiRoot.active=!0,this.labelBg.active=!0,this.pk_uiRoot.getChildByName("winCount").getComponent(cc.Label).string=" thắng lợi :"+t.win_count,this.pk_uiRoot.getChildByName("looseCount").getComponent(cc.Label).string=" thất bại :"+t.loose_count),9==e&&(this.mine_uiRoot.active=!0,this.labelBg.active=!0,this.mine_uiRoot.getChildByName("StaminaValue").getComponent(cc.Label).string="-"+t.cost_energy),11==e&&(this.mine_uiRoot.active=!0,this.labelBg.active=!0,this.mine_uiRoot.getChildByName("StaminaValue").getComponent(cc.Label).string="-"+t.cost_energy),13==e&&(this.mine_uiRoot.active=!0,this.labelBg.active=!0,this.mine_uiRoot.getChildByName("StaminaValue").getComponent(cc.Label).string="-"+t.cost_energy)},jump2Hall:function(){MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),i.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"},HeroStrength_OnClick:function(e){this.jump2Hall(),MyUiManager.clearBackList(),MyUiManager.AddBack({closeCb:function(){n.back2Hall()}},MyUiManager.PanelInfo.ArmyPanel)},GetHero_OnClick:function(e){this.jump2Hall(),MyUiManager.clearBackList(),MyUiManager.AddBack({closeCb:function(){n.back2Hall()}},MyUiManager.PanelInfo.RecruitPanel)},RefreshEquip_OnClick:function(e){this.jump2Hall(),MyUiManager.clearBackList(),MyUiManager.AddBack({closeCb:function(){n.back2Hall()},index:1},MyUiManager.PanelInfo.StoreHousePanel)},BattleDetail_onClickHandler:function(){var n=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/BattleDetailLayer/BattleDetailLayer",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.node)){null!=n._shortMask_node&&(n._shortMask_node.destroy(),n._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("BattleDetailLayer").ChangeData(n._staticData)}})}}),cc._RF.pop()},{GameUtils:"GameUtils",MarqueeBufferMgr:"MarqueeBufferMgr"}],BattleFormationPanel:[function(e,t,a){"use strict";cc._RF.push(t,"5f776ufqL1NEZVnJsGscUGV","BattleFormationPanel");e("MyEventDispatcher");var u=e("SoundUtil"),n=(e("NetEvent"),e("PVEBattleManager")),i=e("ElitePVEBattleManager"),r=e("FTBattleManager"),s=e("HeroBufferMgr"),o=e("ActivityBattleManager"),c=(e("SnatchBattleManager"),e("PkBattleManager")),l=e("NPCFightCfgMgr"),h=e("GuideBufferMgr"),d=e("ResLoaderManager"),_=e("MarqueeBufferMgr"),m=e("PkBufferMgr"),p=e("GuozhanBattleManager"),f=e("GuozhanBufferMgr"),g=e("GuozhanCityBattleManager"),y=e("GuozhanFightBufferMgr"),v=cc.Class({m_pPos:null,m_pselfItem:null,m_pheroid:null,m_pState:null,m_nId:null,m_pEffectSpr:null,m_pPosKey:null}),M=cc.Class({m_vtPos:null,m_pHeroItem:null,m_nPosid:null,m_nHeroid:null,m_pPosKey:null}),S=cc.Class({extends:cc.Component,properties:{m_pFormatArrow:cc.Node,m_pMyName:cc.Label,m_pEnemyName:cc.Label,m_pMyFight:cc.Label,m_pEnemyFight:cc.Label,m_pFormationSquareitem:cc.Prefab,m_pMySquareNodeParent:cc.Node,m_pEnemySquareNodeParent:cc.Node,m_pMyHeroParent:cc.Node,m_pEnemyHeroParent:cc.Node,m_pFormationHero:cc.Prefab,m_pBG:cc.Node,m_pNewEffect:cc.Prefab,m_pNewParent:cc.Node,m_pReplaceFormationInfo:cc.Node,m_pUnitCounterInfo:cc.Node,btnExchange:cc.Node,btnBeginBattle:cc.Node,m_pMyFormationAttr1Value:cc.Label,m_pMyFormationAttr2Value:cc.Label,m_pMyFormationAttr1Icon:cc.Sprite,m_pMyFormationAttr2Icon:cc.Sprite,m_pEneFormationAttr1Value:cc.Label,m_pEneFormationAttr2Value:cc.Label,m_pEneFormationAttr1Icon:cc.Sprite,m_pEneFormationAttr2Icon:cc.Sprite,_mysquaremap:{default:{},type:Object},_enemysquaremap:{default:{},type:Object},_myHeromap:{default:{},type:Object},_formationeffectmap:{default:{},type:Object},_formationPosMap:{default:{},type:Object},_enemyMobjsoninfo:null,_curFormationID:0,_formationJson:null,_enemyformationjson:null,_curSelectHeroId:-1,_curtouchid:-1,_targetpos:cc.Vec2,_lastsuqare:null,_cursquare:null,_flip:0,_forward:0,_effectIconIndex:1,_heroformationmap:{default:{},type:Object},_onlineformation:null,_FormationAttrIconMap:{default:{},type:Object},_Embattlemanager:null,_NewEffectItem:null,_fid:-1,_isChangeData:!1,_leftinfo:null,_rightinfo:null,_battleType:-1,_raw_assets:{default:{},type:Object}},statics:{instance:null,getInstance:function(){return S.instance}},onLoad:function(){this._curSelectHeroId=-1,(S.instance=this)._Embattlemanager=this.node.getComponent("EmBattleDataManager"),this.m_pBG.on("touchstart",this.CanvasClickStart,this),this.m_pBG.on("touchmove",this.CanvasClickMove,this),this.m_pBG.on("touchend",this.CanvasClickEnd,this)},setParams:function(e){this._leftinfo=e.leftinfo,this._rightinfo=e.rightinfo,this._panelinfo=e.panelinfo,this._battleType=e.battletype,this._enemyformationjson=DonotDestroyManager.GameData.Formation[this._rightinfo.formation-1],this._fid=this._panelinfo.fid},start:function(){this._onlineformation=this._Embattlemanager.GetOnlineFormation(this._fid),this._Embattlemanager.SetFormationmoveinfo(this._onlineformation),this._heroformationmap=this._Embattlemanager.GetHeroFormationMap(),null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node));var e=this;setTimeout(function(){e.doLoad()},20)},doLoad:function(){this.toLoadResMap=new Map;for(var e=Object.keys(this._heroformationmap),t=0;t<e.length;++t)
if(0<this._heroformationmap[e[t]]){var a=this._heroformationmap[e[t]],n="Prefab/Heros/"+DonotDestroyManager.GameData.Cards[a].icon;this.toLoadResMap.set(n,cc.Prefab)}
for(t=0;t<this._rightinfo.Teams.length;++t){var i=this._rightinfo.Teams[t].id,r="Prefab/Heros/"+DonotDestroyManager.GameData.Cards[i].icon;this.toLoadResMap.set(r,cc.Prefab)}
var s=this._loadProgressCb.bind(this),o=this._loadFinishCb.bind(this);d.asyncLoadAll(this.toLoadResMap,s,o)},_loadProgressCb:function(e){null!=this._shortMask_node&&this._shortMask_node.getComponent("ShortLoadingMask").loadProgressChangeTips(e)},_loadFinishCb:function(e,t){cc.log("load em battle resources finish!"),t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this),t.length=0,null!=this._shortMask_node&&(this._shortMask_node.destroy(),this._shortMask_node=null),this.Init()},Init:function(){this.m_pMyName.string="LV"+MyPersistDataManager._playerData.level+" "+MyPersistDataManager._playerData.name,this.m_pEnemyName.string=this._rightinfo.name,15==this._battleType&&(this.m_pEnemyName.node.x+=20);var e=this._rightinfo.fight||l.getNPCFightVal(this._rightinfo);this.m_pEnemyFight.string=e,this._Embattlemanager._otherFight=e,this._curFormationID=this._Embattlemanager.GetCurFormationID(),this._formationJson=DonotDestroyManager.GameData.Formation[this._curFormationID-1],this._Embattlemanager.SetFormationData(),this.SetEnemyFormation(),this.SetMyFormationAttr(),this.SetEnemyFormationAttr(),this.CreateMySquare(),this.CreateEnemySquare(),this.SetAllSquareFormation(),this.CreateMyHero(),this.CreateEnemyHero(),this.CreateAllSquareEffect(!0),this.CreateNewFormationEffect(),this.InitArrow(),this.RefreshFight(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},InitArrow:function(){this.m_pFormatArrow.stopAllActions(),this.m_pFormatArrow.active=!1;for(var e=0,t=Object.keys(this._heroformationmap),a=0;a<t.length;++a){0<this._heroformationmap[t[a]]&&++e}
var n=e<MyPersistDataManager._playerData.formationSlots,i=!1,r=MyPersistDataManager._playerData.formationSlots;r<3&&(r=3);var s=DonotDestroyManager.GameData.Common.hero_num_limit[r-3];if(null!=s){var o=DonotDestroyManager.GameData.Arena.exchange[s[1]+9997][4];MyPersistDataManager._playerData.level>=o&&(i=!0)}
if(n||i){this.m_pFormatArrow.active=!0;var c=cc.sequence(cc.moveBy(.5,cc.p(0,10)),cc.moveBy(.5,cc.p(0,-10)));this.m_pFormatArrow.runAction(cc.repeatForever(c))}},CanvasClickStart:function(e){e=null!=e.detail?e.detail:e,-1==this._curSelectHeroId&&(this._curSelectHeroId=this._Embattlemanager.GetTouchHeroIndex(e),-1!=this._curSelectHeroId&&this._myHeromap[this._curSelectHeroId].m_pHeroItem.setLocalZOrder(1e4),this._startpos=e.touch.getLocation())},CanvasClickMove:function(e){if(e=null!=e.detail?e.detail:e,-1!=this._curSelectHeroId){if(e.touch.getID()!=this._curtouchid)
return;if(this.MoveHero(e),null!=this._lastsuqare&&1==this._mysquaremap[this._lastsuqare].m_pState&&(this._mysquaremap[this._lastsuqare].m_pselfItem.getComponent("FormationSquare").SetState(1),-1!=this._mysquaremap[this._lastsuqare].m_pheroid&&this._mysquaremap[this._lastsuqare].m_pheroid!=this._curSelectHeroId||this.SetSquareEffectForID(this._lastsuqare,!1)),this._cursquare=this._Embattlemanager.GetTouchSquare(e,this._curSelectHeroId,this._mysquaremap),-1==this._cursquare)
return;var t=this._mysquaremap[this._cursquare];if(this.SetSquareEffectForID(this._cursquare,!0),1==t.m_pState)
t.m_pselfItem.getComponent("FormationSquare").SetSelect(),this._lastsuqare=this._cursquare}else
1==e.getTouches().length?this._Embattlemanager.MoveBg(e,this.m_pBG):2==e.getTouches().length&&this._Embattlemanager.SetBgScale(e,this.m_pBG)},CanvasClickEnd:function(e){if((e=null!=e.detail?e.detail:e).touch.getID()==this._curtouchid&&(null!=this._lastsuqare&&1==this._mysquaremap[this._lastsuqare].m_pState&&this._mysquaremap[this._lastsuqare].m_pselfItem.getComponent("FormationSquare").SetState(1),-1!=this._curSelectHeroId)){var t=this._myHeromap[this._curSelectHeroId].m_vtPos;if(-1==this._cursquare)
this.MoveSelectHeroTopos(t,!0),this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){this.showGuide()},this)));else{var a=this._mysquaremap[this._cursquare];if(null==a)
return;if(0==a.m_pState)
this.MoveSelectHeroTopos(t,!0),this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){this.showGuide()},this)));else if(-1!=a.m_pheroid){if(cc.log(" vị trí thượng có anh hùng "),a.m_pheroid!=this._myHeromap[this._curSelectHeroId].m_nHeroid){var n=this.GetHeroItem(a.m_pheroid);this.SetSquareEffectForID(this._myHeromap[this._curSelectHeroId].m_nPosid,!0),this.MoveSelectHeroTopos(a.m_pPos,!1,n)}else
this.MoveSelectHeroTopos(t,!0);this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){this.showGuide()},this)))}else
this.MoveSelectHeroTopos(a.m_pPos),this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){this.showGuide()},this)))}
-1!=this._mysquaremap[this._myHeromap[this._curSelectHeroId].m_nPosid].m_pheroid?this.SetSquareEffectForID(this._myHeromap[this._curSelectHeroId].m_nPosid,!0):this.SetSquareEffectForID(this._myHeromap[this._curSelectHeroId].m_nPosid,!1),this._myHeromap[this._curSelectHeroId].m_pHeroItem.getComponent("FormationHero").PlayAnimation("stand"),this._curSelectHeroId=-1,this._curtouchid=-1}},GetHeroItem:function(e){return this._myHeromap[e]},MoveSelectHeroTopos:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(-1!=this._curSelectHeroId){var n=this._myHeromap[this._curSelectHeroId];if(!t){if(this._mysquaremap[n.m_nPosid].m_pheroid=-1,null!=a){var i=n.m_vtPos,r=cc.moveTo(.2,i);a.m_pHeroItem.runAction(r),a.m_pHeroItem.setLocalZOrder(-i.y),a.m_vtPos=n.m_vtPos,a.m_nPosid=n.m_nPosid,this._heroformationmap[a.m_pPosKey]==a.m_nHeroid&&(this._heroformationmap[a.m_pPosKey]=0),this._heroformationmap[this._mysquaremap[n.m_nPosid].m_pPosKey]=a.m_nHeroid,a.m_pPosKey=this._mysquaremap[n.m_nPosid].m_pPosKey,this._mysquaremap[n.m_nPosid].m_pheroid=a.m_nHeroid}
var s=n.m_pHeroItem;r=cc.moveTo(.2,e);return s.runAction(r),s.setLocalZOrder(-e.y),n.m_vtPos=e,this._mysquaremap[this._cursquare].m_pheroid=n.m_nHeroid,n.m_nPosid=this._mysquaremap[this._cursquare].m_nId,this._heroformationmap[n.m_pPosKey]==n.m_nHeroid&&(this._heroformationmap[n.m_pPosKey]=0),n.m_pPosKey=this._mysquaremap[this._cursquare].m_pPosKey,this._heroformationmap[n.m_pPosKey]=n.m_nHeroid,void(this._isChangeData=!0)}
s=n.m_pHeroItem,r=cc.moveTo(.2,e);s.runAction(r),s.setLocalZOrder(-e.y)}},MoveHero:function(e){if(-1!=this._curSelectHeroId){var t=this._myHeromap[this._curSelectHeroId].m_pHeroItem,a=(t.convertToWorldSpace(cc.v2(65,0)),this.node.convertTouchToNodeSpace(e.touch)),n=this.node.convertToWorldSpace(a),i=e.getPreviousLocation(),r=this.node.convertToWorldSpace(i),s=cc.pSub(n,r);this._targetpos=cc.pAdd(t.getPosition(),s),t.setPosition(this._targetpos),t.getComponent("FormationHero").PlayAnimation("move")}},SetSquareEffectForID:function(a,e){if(null!=this._mysquaremap[a]&&null!=this._mysquaremap[a].m_pEffectSpr){var n=this,i="";this._effectIconIndex=0==this._flip?1:0,"right1"==this._formationeffectmap[a].material[this._effectIconIndex]||"right2"==this._formationeffectmap[a].material[this._effectIconIndex]?(this._mysquaremap[a].m_pEffectSpr.node.width=342,this._mysquaremap[a].m_pEffectSpr.node.height=141,this._mysquaremap[a].m_pEffectSpr.node.setPosition(175,-30)):(this._mysquaremap[a].m_pEffectSpr.node.width=250,this._mysquaremap[a].m_pEffectSpr.node.height=200,this._mysquaremap[a].m_pEffectSpr.node.setPosition(50,120)),i=e?"jihuojiantou_"+this._formationeffectmap[a].material[this._effectIconIndex]+"_lanse":"jiantou_"+this._formationeffectmap[a].material[this._effectIconIndex]+"_lanse",null!=this._FormationAttrIconMap&&null!=this._FormationAttrIconMap["UI/emBattle/"+i]?this._mysquaremap[a].m_pEffectSpr.spriteFrame=this._FormationAttrIconMap["UI/emBattle/"+i]:cc.loader.loadRes("UI/emBattle/"+i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load iconspr success!"+t),n._mysquaremap[a].m_pEffectSpr.spriteFrame=t,null!=n._FormationAttrIconMap&&null==n._FormationAttrIconMap["UI/emBattle/"+i]&&(n._FormationAttrIconMap["UI/emBattle/"+i]=t)})}},CreateMyHero:function(){if(null!=this._heroformationmap)
for(var e=Object.keys(this._heroformationmap),t=0;t<e.length;++t)
if(0<this._heroformationmap[e[t]]){var a=this._Embattlemanager.GetFormationIndex(this._formationJson.positions[e[t]]);this.CreateFormationHeroItem(this._heroformationmap[e[t]],a)}},CreateEnemyHero:function(){for(var e=0;e<this._rightinfo.Teams.length;++e){var t=this._Embattlemanager.GetFormationIndex(this._enemyformationjson.positions[this._rightinfo.Teams[e].position],!0);this.CreateFormationHeroItem(this._rightinfo.Teams[e].id,t,this._rightinfo.Teams[e].level,!1)}},CreateFormationHeroItem:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],i=cc.instantiate(this.m_pFormationHero);if(n){this.m_pMyHeroParent.addChild(i);var r=this._mysquaremap[t].m_pPos,s=this.node.convertToWorldSpace(r),o=this.node.convertToWorldSpace(i.getPosition()),c=new cc.Vec2(s.x-o.x+i.getPosition().x,s.y-o.y+i.getPosition().y);i.setPosition(c),i.getComponent("FormationHero").ChangeData(e),i.setLocalZOrder(-r.y);var l=new M;l.m_vtPos=c,l.m_pHeroItem=i,l.m_nPosid=t,l.m_nHeroid=e,l.m_pPosKey=this._mysquaremap[t].m_pPosKey,this._myHeromap[e]=l,this._mysquaremap[t].m_pheroid=e}else{this.m_pEnemyHeroParent.addChild(i);r=this._enemysquaremap[t].m_pPos,s=this.node.convertToWorldSpace(r),o=this.node.convertToWorldSpace(i.getPosition()),c=new cc.Vec2(s.x-o.x+i.getPosition().x,s.y-o.y+i.getPosition().y);i.setPosition(c),i.getComponent("FormationHero").ChangeData(e,!0,a),i.setLocalZOrder(-r.y)}},SetMyFormationAttr:function(){var a=this;this.m_pMyFormationAttr1Value.string=this._formationJson.des1[0]+this._formationJson.des1[1],this.m_pMyFormationAttr2Value.string=this._formationJson.des2[0]+this._formationJson.des2[1],cc.loader.loadRes("UI/emBattle/"+this._formationJson.des1[2],cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load iconspr success!"+t),a.m_pMyFormationAttr1Icon.spriteFrame=t,null!=a._FormationAttrIconMap&&null==a._FormationAttrIconMap["UI/emBattle/"+a._formationJson.des1[2]]&&(a._FormationAttrIconMap["UI/emBattle/"+a._formationJson.des1[2]]=t)}),cc.loader.loadRes("UI/emBattle/"+this._formationJson.des2[2],cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load iconspr success!"+t),a.m_pMyFormationAttr2Icon.spriteFrame=t,null!=a._FormationAttrIconMap&&null==a._FormationAttrIconMap["UI/emBattle/"+a._formationJson.des2[2]]&&(a._FormationAttrIconMap["UI/emBattle/"+a._formationJson.des2[2]]=t)})},SetEnemyFormationAttr:function(){var a=this;this.m_pEneFormationAttr1Value.string=this._enemyformationjson.des1[0]+this._enemyformationjson.des1[1],this.m_pEneFormationAttr2Value.string=this._enemyformationjson.des2[0]+this._enemyformationjson.des2[1],cc.loader.loadRes("UI/emBattle/"+this._enemyformationjson.des1[2],cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load iconspr success!"+t),a.m_pEneFormationAttr1Icon.spriteFrame=t,null!=a._FormationAttrIconMap&&null==a._FormationAttrIconMap["UI/emBattle/"+a._enemyformationjson.des1[2]]&&(a._FormationAttrIconMap["UI/emBattle/"+a._enemyformationjson.des1[2]]=t)}),cc.loader.loadRes("UI/emBattle/"+this._enemyformationjson.des2[2],cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load iconspr success!"+t),a.m_pEneFormationAttr2Icon.spriteFrame=t,null!=a._FormationAttrIconMap&&null==a._FormationAttrIconMap["UI/emBattle/"+a._enemyformationjson.des2[2]]&&(a._FormationAttrIconMap["UI/emBattle/"+a._enemyformationjson.des2[2]]=t)})},CreateAllSquareEffect:function(e){var t=null,a="";e&&(t=Object.keys(this._formationeffectmap)),this._effectIconIndex=0==this._flip?1:0;for(var n=0;n<t.length;n++)
e&&(a=this._formationeffectmap[t[n]].material[this._effectIconIndex]),this.CreateSquareEffect(t[n],a,e)},ClearMySquareEffect:function(){for(var e=0;e<this._formation.length;++e)
null!=this._mysquaremap[this._formation[e]].m_pEffectSpr&&(this._mysquaremap[this._formation[e]].m_pEffectSpr.destroy(),this._mysquaremap[this._formation[e]].m_pEffectSpr=null)},CreateSquareEffect:function(e,t,a){var n=this,i=new cc.Node("SquareEffect"),r=i.addComponent(cc.Sprite),s="";r.trim=!1,r.sizeMode=cc.Sprite.SizeMode.CUSTOM,i.setScale(1.2),"right1"==t||"right2"==t?(i.width=342,i.height=141,i.setPosition(175,-30)):(i.width=250,i.height=200,i.setPosition(50,120)),a?(this._mysquaremap[e].m_pselfItem.addChild(i),s=-1!=this._mysquaremap[e].m_pheroid?"jihuojiantou_"+t+"_lanse":"jiantou_"+t+"_lanse",this._mysquaremap[e].m_pEffectSpr=r):(this._enemysquaremap[e].m_pselfItem.addChild(i),s="jiantou_"+t+"_hongse"),cc.loader.loadRes("UI/emBattle/"+s,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load iconspr success!"+t),r.spriteFrame=t,null!=n._FormationAttrIconMap&&null==n._FormationAttrIconMap["UI/emBattle/"+s]&&(n._FormationAttrIconMap["UI/emBattle/"+s]=t)})},CreateNewFormationEffect:function(){null!=this._Embattlemanager._neweffectinfo&&(this._NewEffectItem=cc.instantiate(this.m_pNewEffect),this.m_pNewParent.addChild(this._NewEffectItem))},RemoveNewFormationEffect:function(){null!=this._NewEffectItem&&(this._NewEffectItem.removeFromParent(),this._NewEffectItem.destroy(),this._NewEffectItem=null)},SetEnemyFormation:function(){this._eneFormation=[];for(var e=Object.keys(this._enemyformationjson.positions),t=0;t<e.length;t++){var a=this._Embattlemanager.GetFormationIndex(this._enemyformationjson.positions[e[t]],!0);this._eneFormation.push(a)}},CreateMySquare:function(){for(var e=0,t=-1,a=0;a<20;++a){a%5==0&&(e=0,t+=1);var n=new cc.Vec2(110*t-326-85*e,50*t-398+85*e);this.createSquare(n,a),e++}},CreateEnemySquare:function(){for(var e=0,t=-1,a=0;a<20;++a){a%5==0&&(e=0,t+=1);var n=new cc.Vec2(680-110*t-85*e,40-50*t+85*e);this.createSquare(n,a,!1),e++}},SetAllSquareFormation:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=0;t<this._formation.length;++t)
this.SetSquareState(this._formation[t],e)},SetSquareState:function(e,t){null!=this._mysquaremap[e]&&(this._mysquaremap[e].m_pselfItem.getComponent("FormationSquare").SetState(t),this._mysquaremap[e].m_pState=t,this._mysquaremap[e].m_pPosKey=this._formationPosMap[e])},createSquare:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=new v;if(n.m_pPos=e,n.m_nId=t,n.m_pState=0,a){var i=cc.instantiate(this.m_pFormationSquareitem);this.m_pMySquareNodeParent.addChild(i),i.setPosition(e),n.m_pselfItem=i,n.m_pheroid=-1,i.setLocalZOrder(1),this._mysquaremap[t]=n}else{i=cc.instantiate(this.m_pFormationSquareitem);this.m_pEnemySquareNodeParent.addChild(i),i.setPosition(e),n.m_pselfItem=i,n.m_pheroid=-1,i.setLocalZOrder(1);for(var r=0;r<this._eneFormation.length;++r){if(t==this._eneFormation[r])
i.getComponent("FormationSquare").SetState(2),n.m_pState=1,i.setLocalZOrder(2)}
this._enemysquaremap[t]=n}},MoveHeroTopos:function(e,t){e.m_pHeroItem.stopActionByTag(e.m_nHeroid);var a=this.node.convertToWorldSpace(e.m_vtPos),n=this.node.convertToWorldSpace(t),i=new cc.Vec2(n.x-a.x+e.m_vtPos.x,n.y-a.y+e.m_vtPos.y),r=cc.moveTo(.2,i);e.m_pHeroItem.runAction(cc.sequence(r,cc.callFunc(function(){e.m_pHeroItem.getComponent("FormationHero").PlayAnimation("stand")}))).setTag(e.m_nHeroid),e.m_pHeroItem.getComponent("FormationHero").PlayAnimation("move")},ChangeHeroFormationInfo:function(e){cc.log(" có mấy cái anh hùng ==="+e.length),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)));var t=this._Embattlemanager.ChangeNewOnLineFormation(this._heroformationmap,e);if(null!=t){var a={};a.formationId=this._curFormationID,a.forward=this._forward,a.flip=this._flip,a.fid=this._fid;for(var n=Object.keys(t),i=0;i<n.length;++i)
a[n[i]]=t[n[i]];this._Embattlemanager.SendBattleFormationSave(a)}},UpdateOnLineformationInfo:function(){if(cc.log(" đổi mới số liệu "),this._onlineformation=this._Embattlemanager.GetOnlineFormation(this._fid),this._heroformationmap=this._Embattlemanager.GetHeroFormationMap(),this._curFormationID!=this._onlineformation.formationId)
this._curFormationID=this._Embattlemanager.GetCurFormationID(),this._Embattlemanager.SetFormationmoveinfo(this._onlineformation),this._formationJson=DonotDestroyManager.GameData.Formation[this._curFormationID-1],this.SetAllSquareFormation(0),this.ClearMySquareEffect(),this._Embattlemanager.SetFormationData(),this.SetMyFormationAttr(),this.SetAllSquareFormation(),this.ChangeFormationMoveHero(),this.CreateAllSquareEffect(!0),this.RemoveNewFormationEffect();else{for(var e=0;e<this._formation.length;++e){var t=this._mysquaremap[this._formation[e]].m_pPosKey;if(0<this._heroformationmap[t]){if(this._mysquaremap[this._formation[e]].m_pheroid!=this._heroformationmap[t]){this.RemoveHero(this._mysquaremap[this._formation[e]].m_pheroid);var a=this._Embattlemanager.GetFormationIndex(this._formationJson.positions[t]);this.CreateFormationHeroItem(this._heroformationmap[t],a),this.SetSquareEffectForID(a,!0)}}else-1!=this._mysquaremap[this._formation[e]].m_pheroid&&this.RemoveHero(this._mysquaremap[this._formation[e]].m_pheroid)}
this.InitArrow()}},RefreshFight:function(){for(var e=0,t=Object.keys(this._heroformationmap),a=0;a<t.length;++a){var n=this._heroformationmap[t[a]];if(0<n){var i=s.getHeroByUid(n);null!=i?e+=i.fight:null!=this._leftinfo[n]&&(e+=this._leftinfo[n])}}
this.m_pMyFight.string=e,this._Embattlemanager._myFight=e},RemoveInFormationHero:function(e){for(var t=Object.keys(this._myHeromap),a=!1,n=0;n<t.length;++n){a=!1;for(var i=0;i<e.length;++i)
t[n]==e[i]&&(a=!0);a||(this.RemoveHero(t[n]),delete this._myHeromap[t[n]])}},RemoveHero:function(e){if(-1!=e){var t=this._myHeromap[e];this._mysquaremap[t.m_nPosid].m_pheroid=-1,delete this._myHeromap[e],null!=this._mysquaremap[t.m_nPosid].m_pEffectSpr&&this.SetSquareEffectForID(t.m_nPosid,!1),t.m_pHeroItem.removeFromParent(),t.m_pHeroItem.destroy()}},GetNoHeroSquare:function(){for(var e=0;e<this._formation.length;++e)
if(-1==this._mysquaremap[this._formation[e]].m_pheroid)
return this._formation[e];return-1},ChangeHeroFormation:function(e){u.playBtnOpenEffect();var t={};this._flip=0==this._flip?1:0,this._effectIconIndex=0==this._flip?1:0;for(var a=0;a<this._formation.length;++a){var n=5*parseInt(this._formation[a]/5)+2,i=n+(n-this._formation[a]);if(this._formation[a]!=i){if(!t[this._formation[a]]){this._mysquaremap[this._formation[a]].m_pselfItem.getComponent("FormationSquare").SetState(0),this._mysquaremap[this._formation[a]].m_pState=0,this._mysquaremap[this._formation[a]].m_pselfItem.setLocalZOrder(1);var r=this._mysquaremap[this._formation[a]].m_pPosKey;if(this._mysquaremap[this._formation[a]].m_pPosKey=this._mysquaremap[i].m_pPosKey,this._mysquaremap[i].m_pPosKey=r,-1!=this._mysquaremap[this._formation[a]].m_pheroid){var s=this.GetHeroItem(this._mysquaremap[this._formation[a]].m_pheroid),o=this._mysquaremap[i].m_pPos;if(-1!=this._mysquaremap[i].m_pheroid){var c=this.GetHeroItem(this._mysquaremap[i].m_pheroid);this.MoveHeroTopos(s,o),this.MoveHeroTopos(c,this._mysquaremap[this._formation[a]].m_pPos),s.m_vtPos=o,s.m_nPosid=i,c.m_vtPos=this._mysquaremap[this._formation[a]].m_pPos,c.m_nPosid=this._formation[a],this._mysquaremap[i].m_pheroid=s.m_nHeroid,this._mysquaremap[this._formation[a]].m_pheroid=c.m_nHeroid}else
this.MoveHeroTopos(s,o),s.m_vtPos=o,s.m_nPosid=i,this._mysquaremap[i].m_pheroid=s.m_nHeroid,this._mysquaremap[this._formation[a]].m_pheroid=-1}else if(-1!=this._mysquaremap[i].m_pheroid){var l=this.GetHeroItem(this._mysquaremap[i].m_pheroid);this.MoveHeroTopos(l,this._mysquaremap[this._formation[a]].m_pPos),l.m_vtPos=this._mysquaremap[this._formation[a]].m_pPos,l.m_nPosid=this._formation[a],this._mysquaremap[this._formation[a]].m_pheroid=this._mysquaremap[i].m_pheroid,this._mysquaremap[i].m_pheroid=-1}
if(null!=this._mysquaremap[this._formation[a]].m_pEffectSpr)
if(null!=this._mysquaremap[i].m_pEffectSpr){var h=this._mysquaremap[this._formation[a]].m_pEffectSpr;this._mysquaremap[this._formation[a]].m_pEffectSpr=this._mysquaremap[i].m_pEffectSpr,this._mysquaremap[i].m_pEffectSpr=h,this._mysquaremap[this._formation[a]].m_pEffectSpr.node.removeFromParent(),this._mysquaremap[i].m_pEffectSpr.node.removeFromParent(),this._mysquaremap[this._formation[a]].m_pselfItem.addChild(this._mysquaremap[this._formation[a]].m_pEffectSpr.node),this._mysquaremap[i].m_pselfItem.addChild(this._mysquaremap[i].m_pEffectSpr.node);var d=this._formationeffectmap[this._formation[a]];this._formationeffectmap[this._formation[a]]=this._formationeffectmap[i],this._formationeffectmap[i]=d;var _=!1;-1!=this._mysquaremap[i].m_pheroid&&(_=!0),this.SetSquareEffectForID(i,_),_=!1,-1!=this._mysquaremap[this._formation[a]].m_pheroid&&(_=!0),this.SetSquareEffectForID(this._formation[a],_)}else{this._mysquaremap[i].m_pEffectSpr=this._mysquaremap[this._formation[a]].m_pEffectSpr,this._mysquaremap[this._formation[a]].m_pEffectSpr=null,this._mysquaremap[i].m_pEffectSpr.node.removeFromParent(),this._mysquaremap[i].m_pselfItem.addChild(this._mysquaremap[i].m_pEffectSpr.node),this._formationeffectmap[i]=this._formationeffectmap[this._formation[a]],delete this._formationeffectmap[this._formation[a]];_=!1;-1!=this._mysquaremap[i].m_pheroid&&(_=!0),this.SetSquareEffectForID(i,_)}
else if(null!=this._mysquaremap[i].m_pEffectSpr){this._mysquaremap[this._formation[a]].m_pEffectSpr=this._mysquaremap[i].m_pEffectSpr,this._mysquaremap[i].m_pEffectSpr=null,this._mysquaremap[this._formation[a]].m_pEffectSpr.node.removeFromParent(),this._mysquaremap[this._formation[a]].m_pselfItem.addChild(this._mysquaremap[this._formation[a]].m_pEffectSpr.node),this._formationeffectmap[this._formation[a]]=this._formationeffectmap[i],delete this._formationeffectmap[i];_=!1;-1!=this._mysquaremap[this._formation[a]].m_pheroid&&(_=!0),this.SetSquareEffectForID(this._formation[a],_)}}
this._formation[a]=i,this._mysquaremap[i].m_pselfItem.getComponent("FormationSquare").SetState(1),this._mysquaremap[i].m_pState=1,this._mysquaremap[i].m_pselfItem.setLocalZOrder(2),t[i]=!0}}},FormationForward:function(e){if(u.playBtnOpenEffect(),-1==this._curSelectHeroId)
if(15<=this._Embattlemanager.GetFormationMaxId())
cc.log(" trận hình chưa đủ đi tới yêu cầu ");else{++this._forward;for(var t=this._formation.length-1;0<=t;--t){if(null!=this._mysquaremap[this._formation[t]].m_pEffectSpr&&(this._mysquaremap[this._formation[t]+5].m_pEffectSpr=this._mysquaremap[this._formation[t]].m_pEffectSpr,this._mysquaremap[this._formation[t]].m_pEffectSpr=null,this._mysquaremap[this._formation[t]+5].m_pEffectSpr.node.removeFromParent(),this._mysquaremap[this._formation[t]+5].m_pselfItem.addChild(this._mysquaremap[this._formation[t]+5].m_pEffectSpr.node),"right1"==this._formationeffectmap[this._formation[t]].material[this._effectIconIndex]||"right2"==this._formationeffectmap[this._formation[t]].material[this._effectIconIndex]?this._mysquaremap[this._formation[t]+5].m_pEffectSpr.node.setPosition(175,-30):this._mysquaremap[this._formation[t]+5].m_pEffectSpr.node.setPosition(50,120)),null!=this._formationeffectmap[this._formation[t]]&&(this._formationeffectmap[this._formation[t]+5]=this._formationeffectmap[this._formation[t]],delete this._formationeffectmap[this._formation[t]]),this._mysquaremap[this._formation[t]].m_pselfItem.getComponent("FormationSquare").SetState(0),this._mysquaremap[this._formation[t]].m_pState=0,this._mysquaremap[this._formation[t]].m_pselfItem.setLocalZOrder(1),this._mysquaremap[this._formation[t]+5].m_pselfItem.getComponent("FormationSquare").SetState(1),this._mysquaremap[this._formation[t]+5].m_pState=1,this._mysquaremap[this._formation[t]+5].m_pselfItem.setLocalZOrder(2),-1!=this._mysquaremap[this._formation[t]].m_pheroid){var a=this.GetHeroItem(this._mysquaremap[this._formation[t]].m_pheroid),n=this._mysquaremap[this._formation[t]+5].m_pPos;this.MoveHeroTopos(a,n),a.m_vtPos=n,a.m_nPosid+=5,this._mysquaremap[this._formation[t]+5].m_pheroid=a.m_nHeroid,this._mysquaremap[this._formation[t]].m_pheroid=-1}
this._mysquaremap[this._formation[t]+5].m_pPosKey=this._mysquaremap[this._formation[t]].m_pPosKey,this._mysquaremap[this._formation[t]].m_pPosKey=null,this._formation[t]+=5}}},FormationBack:function(e){if(u.playBtnOpenEffect(),-1==this._curSelectHeroId)
if(this._Embattlemanager.GetFormationMinId()<=4)
cc.log(" trận hình chưa đủ đi tới yêu cầu ");else{--this._forward;for(var t=0;t<this._formation.length;++t){if(null!=this._mysquaremap[this._formation[t]].m_pEffectSpr&&(this._mysquaremap[this._formation[t]-5].m_pEffectSpr=this._mysquaremap[this._formation[t]].m_pEffectSpr,this._mysquaremap[this._formation[t]].m_pEffectSpr=null,this._mysquaremap[this._formation[t]-5].m_pEffectSpr.node.removeFromParent(),this._mysquaremap[this._formation[t]-5].m_pselfItem.addChild(this._mysquaremap[this._formation[t]-5].m_pEffectSpr.node),"right1"==this._formationeffectmap[this._formation[t]].material[this._effectIconIndex]||"right2"==this._formationeffectmap[this._formation[t]].material[this._effectIconIndex]?this._mysquaremap[this._formation[t]-5].m_pEffectSpr.node.setPosition(175,-30):this._mysquaremap[this._formation[t]-5].m_pEffectSpr.node.setPosition(50,120)),null!=this._formationeffectmap[this._formation[t]]&&(this._formationeffectmap[this._formation[t]-5]=this._formationeffectmap[this._formation[t]],delete this._formationeffectmap[this._formation[t]]),this._mysquaremap[this._formation[t]].m_pselfItem.getComponent("FormationSquare").SetState(0),this._mysquaremap[this._formation[t]].m_pState=0,this._mysquaremap[this._formation[t]].m_pselfItem.setLocalZOrder(1),this._mysquaremap[this._formation[t]-5].m_pselfItem.getComponent("FormationSquare").SetState(1),this._mysquaremap[this._formation[t]-5].m_pState=1,this._mysquaremap[this._formation[t]-5].m_pselfItem.setLocalZOrder(2),-1!=this._mysquaremap[this._formation[t]].m_pheroid){var a=this.GetHeroItem(this._mysquaremap[this._formation[t]].m_pheroid),n=this._mysquaremap[this._formation[t]-5].m_pPos;this.MoveHeroTopos(a,n),a.m_vtPos=n,a.m_nPosid-=5,this._mysquaremap[this._formation[t]-5].m_pheroid=a.m_nHeroid,this._mysquaremap[this._formation[t]].m_pheroid=-1}
this._mysquaremap[this._formation[t]-5].m_pPosKey=this._mysquaremap[this._formation[t]].m_pPosKey,this._mysquaremap[this._formation[t]].m_pPosKey=null,this._formation[t]-=5}}},ChangeFormationMoveHero:function(){for(var e=function(e,t){for(var a=0;a<n.length;++a)
if(n[a]==t)
return!0;return!1},n=[],t=Object.keys(this._myHeromap),a=0;a<t.length;++a){var i=this._myHeromap[t[a]].m_pPosKey,r=this._Embattlemanager.GetFormationIndex(this._formationJson.positions[i]);this.MoveHeroTopos(this._myHeromap[t[a]],this._mysquaremap[r].m_pPos),this._myHeromap[t[a]].m_vtPos=this._mysquaremap[r].m_pPos,e(0,this._myHeromap[t[a]].m_nPosid)||(this._mysquaremap[this._myHeromap[t[a]].m_nPosid].m_pheroid=-1),this._myHeromap[t[a]].m_nPosid=r,this._mysquaremap[r].m_pheroid=this._myHeromap[t[a]].m_nHeroid,n.push(r)}},ChangeFormation:function(e){var t={};t.formationId=e,t.forward=0,t.flip=0,t.fid=this._fid;for(var a=Object.keys(this._heroformationmap),n=0;n<a.length;++n)
t[a[n]]=this._heroformationmap[a[n]];this._Embattlemanager.SendBattleFormationSave(t)},FightBtn_OnClickHandler:function(e){if(null!=this._panelinfo.energy_cost&&MyPersistDataManager._playerData.energy<this._panelinfo.energy_cost)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," thể lực không đủ ");else if(null!=this._panelinfo.require_level&&MyPersistDataManager._playerData.level<this._panelinfo.require_level)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," cấp bậc không đủ, cần "+this._panelinfo.require_level+" cấp ");else
switch(this._Embattlemanager.CheckNeedSendSaveFormation(),this._battleType){case 1:u.playBtnOpenEffect(),MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),_.setMarqueeCanPlay(!1),n.init(this._rightinfo.id,this._Embattlemanager._myFight,this._Embattlemanager._otherFight),n.enterBattlefield();break;case 2:u.playBtnOpenEffect(),MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),_.setMarqueeCanPlay(!1),i.init(this._rightinfo.id,this._Embattlemanager._myFight,this._Embattlemanager._otherFight),i.enterBattlefield();break;case 3:u.playBtnOpenEffect(),MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),_.setMarqueeCanPlay(!1),r.init(this._Embattlemanager._myFight,this._Embattlemanager._otherFight),r.enterBattlefield();break;case 4:this._Embattlemanager.SendArenaBattleStart();break;case 5:MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),_.setMarqueeCanPlay(!1),o.init(this._Embattlemanager._myFight,this._Embattlemanager._otherFight),o.enterBattlefield();break;case 6:this._Embattlemanager.SendTreasureRobStart();break;case 8:u.playBtnOpenEffect(),MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),_.setMarqueeCanPlay(!1);var t=m.getRightHero();c.init(t,this._Embattlemanager._myFight,this._Embattlemanager._otherFight),c.enterBattlefield();break;case 9:u.playBtnOpenEffect(),this._Embattlemanager.SendMineBattleStart();break;case 10:break;case 11:u.playBtnOpenEffect(),this._Embattlemanager.SendSecretBattleStart();break;case 12:u.playBtnOpenEffect(),this._Embattlemanager.SendBossBattleStart();break;case 13:u.playBtnOpenEffect(),MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),_.setMarqueeCanPlay(!1);var a=f.getRightHero();p.init(a,this._Embattlemanager._myFight,this._Embattlemanager._otherFight),p.enterBattlefield();break;case 14:u.playBtnOpenEffect(),this._Embattlemanager.SendGuozhanOfficeStart();break;case 15:u.playBtnOpenEffect(),MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),_.setMarqueeCanPlay(!1);t=y.getRightHero();g.init(t,this._Embattlemanager._myFight,this._Embattlemanager._otherFight),g.enterBattlefield()}},ReplaceFormation_OnClickHandler:function(e){u.playBtnOpenEffect(),null!=this.m_pReplaceFormationInfo&&(this.m_pReplaceFormationInfo.active=!0,this.m_pReplaceFormationInfo.getComponent("ReplaceFormationInfo").ChangeData(this._curFormationID))},SelectHero_OnClickHandler:function(e){if(u.playBtnOpenEffect(),11!=this._battleType){var i=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/BattleFormationPanel/SelectHeroPanel",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=i&&cc.isValid(i.node)){null!=i._shortMask_node&&(i._shortMask_node.destroy(),i._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a);var n=i.ChangeHeroFormationInfo.bind(i);a.getComponent("SelectHeroPanel").ChangeData({formationmap:i._heroformationmap,cb:n,battletype:i._battleType})}})}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," thỉnh ở thượng một cái mặt biên cắt ra trận anh hùng ！")},UnitCounter_OnClickHandler:function(e){u.playBtnOpenEffect(),this.m_pUnitCounterInfo.active=!0},Back_onclickHandler:function(e){this._Embattlemanager.CheckNeedSendSaveFormation(),MyUiManager.Back(),u.playBtnCloseEffect()},onDestroy:function(){(S.instance=null)!=this._raw_assets&&(this._raw_assets={}),this._FormationAttrIconMap={},this._mysquaremap={},this._enemysquaremap={},this._formationeffectmap={},this._myHeromap={},this._formationPosMap={}},showGuide:function(){var a=this;h.showGuide("EmbattleLayer",function(e){if(1==e)
return a.btnExchange;if(2==e&&0<a.m_pMyHeroParent.childrenCount){var t=a.m_pMyHeroParent.children[0].convertToWorldSpaceAR(cc.v2(0,0));return[t,cc.p(80,-140).add(t),a.m_pBG]}
return 3==e?a.btnBeginBattle:void 0})}});cc._RF.pop()},{ActivityBattleManager:"ActivityBattleManager",ElitePVEBattleManager:"ElitePVEBattleManager",FTBattleManager:"FTBattleManager",GuideBufferMgr:"GuideBufferMgr",GuozhanBattleManager:"GuozhanBattleManager",GuozhanBufferMgr:"GuozhanBufferMgr",GuozhanCityBattleManager:"GuozhanCityBattleManager",GuozhanFightBufferMgr:"GuozhanFightBufferMgr",HeroBufferMgr:"HeroBufferMgr",MarqueeBufferMgr:"MarqueeBufferMgr",MyEventDispatcher:"MyEventDispatcher",NPCFightCfgMgr:"NPCFightCfgMgr",NetEvent:"NetEvent",PVEBattleManager:"PVEBattleManager",PkBattleManager:"PkBattleManager",PkBufferMgr:"PkBufferMgr",ResLoaderManager:"ResLoaderManager",SnatchBattleManager:"SnatchBattleManager",SoundUtil:"SoundUtil"}],BattleLifeBarMgr:[function(e,t,a){"use strict";cc._RF.push(t,"eda1678n7tL346WRc/hcMWO","BattleLifeBarMgr"),cc.Class({extends:cc.Component,properties:{hp_bar:cc.Node,yellow_bar:cc.Node,_uClass:null},onLoad:function(){},setPercent:function(e){this.node.active=!0,e=e<0?0:e,this.hp_bar.scaleX=e,this.yellow_bar.stopAllActions(),this.yellow_bar.runAction(cc.sequence(cc.scaleTo(.7,e,1),cc.delayTime(.3),cc.callFunc(function(){"Soldier"==this._uClass&&(this.node.active=!1)},this)))}}),cc._RF.pop()},{}],BattleLoadingLayerMng:[function(e,t,a){"use strict";cc._RF.push(t,"a6b81I1F+9OH5xqD7Fp6QSg","BattleLoadingLayerMng");var n="normal",i=e("BattleManager"),r=e("FormationCfgMgr"),s={all_atk_icon:0,all_def_icon:1,all_hp_icon:2,archer_atk_icon:3,archer_def_icon:4,archer_hp_icon:5,cangfeng_formation_title:6,cavalry_atk_icon:7,cavalry_def_icon:8,cavalry_hp_icon:9,changshe_formation_title:10,duxie_formation_title:11,infantry_atk_icon:12,infantry_def_icon:13,infantry_hp_icon:14,lancer_atk_def:15,lancer_atk_icon:16,lancer_hp_icon:17,mage_atk_icon:18,mage_def_icon:19,mage_hp_icon:20,qizheng_formation_title:21,shiqiang_formation_title:22,xiexing_formation_title:23,xingluo_formation_title:24,yanchi_formation_title:25};cc.Class({extends:cc.Component,properties:{progressBar_node:{default:null,type:cc.Node},progressBar_ctrl:{default:null,type:cc.ProgressBar},cursor_node:{default:null,type:cc.Node},prewarbg_ske:{default:null,type:sp.Skeleton},prewar_ske:{default:null,type:sp.Skeleton},leftslotmap_ske:{default:null,type:dragonBones.ArmatureDisplay},rightslotmap_ske:{default:null,type:dragonBones.ArmatureDisplay},_animInFinishCb:null,l_formation_title:cc.Sprite,l_sprGainIcon1:cc.Sprite,l_lbGainDes1:cc.Label,l_sprGainIcon2:cc.Sprite,l_lbGainDes2:cc.Label,l_lbLevel:cc.Label,l_lbName:cc.Label,l_lbFightValue:cc.Label,l_ui_group:cc.Node,r_formation_title:cc.Sprite,r_sprGainIcon1:cc.Sprite,r_lbGainDes1:cc.Label,r_sprGainIcon2:cc.Sprite,r_lbGainDes2:cc.Label,r_lbLevel:cc.Label,r_lbName:cc.Label,r_lbFightValue:cc.Label,r_ui_group:cc.Node,startwar_ui_list:[cc.SpriteFrame]},onLoad:function(){this.prewar_ske.setAnimation(0,"in",!1),this.prewar_ske.addAnimation(0,"loop",!0,0),this.prewarbg_ske.setAnimation(0,"in",!1),this.prewarbg_ske.addAnimation(0,"loop",!0,0),this._prewarbgCompleteHandler_func=this._prewarbgCompleteHandler.bind(this),this.prewarbg_ske.setCompleteListener(this._prewarbgCompleteHandler_func),this._prewarbgEventHandler_func=this._prewarbgEventHandler.bind(this),this.prewarbg_ske.setEventListener(this._prewarbgEventHandler_func),this.progressBar_node.active=!1,this.l_ui_group.active=!1,this.r_ui_group.active=!1},onDestroy:function(){this._prewarbgCompleteHandler_func=null,this._prewarbgEventHandler_func=null},_prewarbgCompleteHandler:function(e){var t=e.animation?e.animation.name:"";cc.log("animation event:"+t),"in"==t&&this._doProgress()},_prewarbgEventHandler:function(e,t){"out"==t.data.name&&this._fadeOutFinishCb()},_animationEventHandler:function(e){cc.log("animation event!"+e.type);if(e.type===dragonBones.EventObject.COMPLETE){var t=e.detail.armature.name;if("in"===e.detail.animationState.name){cc.log("do in!,"+t);var a=e.detail.armature;setTimeout(function(){a.animation.fadeIn("loop",-1,-1,0,n)},20)}else if("leftslotmap"==t){a=e.detail.armature;setTimeout(function(){var e=r.findFormation(i.ourside.formation);a.animation.fadeIn(e.icon+"loop",-1,-1,0,n)},20),this.leftslotmap_ske.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this)}else if("rightslotmap"==t){a=e.detail.armature;setTimeout(function(){var e=r.findFormation(i.otrside.formation);a.animation.fadeIn(e.icon+"loop",-1,-1,0,n)},20),this.rightslotmap_ske.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this)}"prewar"==t&&"in"===e.detail.animationState.name?this.prewar_ske.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this):"prewarbg"==t&&"in"===e.detail.animationState.name&&(this._doProgress(),this.prewarbg_ske.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this)),"prewarbg"==t&&"out"===e.detail.animationState.name&&(this.prewarbg_ske.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._fadeOutFinishCb())}},_doProgress:function(){this.l_ui_group.active=!0;var e=r.findFormation(i.ourside.formation),t=r.findFormation(i.otrside.formation);this.l_formation_title.spriteFrame=this.startwar_ui_list[s[e.title_material]],this.l_sprGainIcon1.spriteFrame=this.startwar_ui_list[s[e.des1[2]]],this.l_lbGainDes1.string=e.des1[0]+e.des1[1],this.l_sprGainIcon2.spriteFrame=this.startwar_ui_list[s[e.des2[2]]],this.l_lbGainDes2.string=e.des2[0]+e.des2[1],this.l_lbLevel.string="LV."+i.ourside.level,this.l_lbName.string=i.ourside.nickname,this.l_lbFightValue.string=i.ourside.fightvalue,this.r_ui_group.active=!0,this.r_formation_title.spriteFrame=this.startwar_ui_list[s[t.title_material]],this.r_sprGainIcon1.spriteFrame=this.startwar_ui_list[s[t.des1[2]]],this.r_lbGainDes1.string=t.des1[0]+t.des1[1],this.r_sprGainIcon2.spriteFrame=this.startwar_ui_list[s[t.des2[2]]],this.r_lbGainDes2.string=t.des2[0]+t.des2[1],this.r_lbLevel.string="LV."+i.otrside.level,this.r_lbName.string=i.otrside.nickname,this.r_lbFightValue.string=i.otrside.fightvalue,this.progressBar_node.active=!0;var a=this;setTimeout(function(){null!=a._animInFinishCb&&a._animInFinishCb()},10)},doFadeOut:function(e){this._fadeOutFinishCb=e,this.prewar_ske.setAnimation(0,"out",!1),this.prewarbg_ske.setAnimation(0,"out",!1),this.progressBar_node.runAction(cc.fadeOut(.2),cc.callFunc(function(e){e.destroy()})),this.l_ui_group.runAction(cc.sequence(cc.moveBy(.14,cc.p(30,0)),cc.spawn(cc.fadeOut(.28),cc.moveBy(.28,cc.p(-200,0))).easing(cc.easeOut(.4)))),this.r_ui_group.runAction(cc.sequence(cc.moveBy(.14,cc.p(-30,0)),cc.spawn(cc.fadeOut(.28),cc.moveBy(.28,cc.p(200,0))).easing(cc.easeOut(.4))))},setAnimInFinishCb:function(e){this._animInFinishCb=e},changeProgress:function(e){this.progressBar_ctrl.progress=e,this.cursor_node.x=690*e-350}}),cc._RF.pop()},{BattleManager:"BattleManager",FormationCfgMgr:"FormationCfgMgr"}],BattleManager:[function(o,e,t){"use strict";cc._RF.push(e,"392c0y6ju9J4JrJWhToeX9c","BattleManager");var P=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},L=o("ArmiesManager"),B=o("HeroesManager"),w=o("SoldiersManager"),a=o("ArrowsManager"),r=o("SkillsManager"),s=o("BuffsManager"),c=o("EffectsManager"),E=o("StagesEventManager"),n=o("HeroDieManager"),b=o("FormationCfgMgr"),k=o("BattleConstants"),T=o("HeroConfigMgr"),A=o("UnitConfigMgr"),R=o("HeroBufferMgr"),F=o("UnitBufferMgr"),l=o("SoundUtil"),i=o("BattleWidgets"),h=o("MyEventDispatcher"),x=o("EnermyBufferMgr"),d=function(){};d.prototype.initData=function(){this.ourside={},this.otrside={},this.btlNode=null,this.btlState=0,this.btlWin=!1,this.bgFile="",this.otrTmSk={},this.successCB=null,this.failureCB=null,this.fightTime=0,this.hpStar=0,this.timeStar=null,this.type=1,this.marchSE={},this.chargeSE={},this.deadSE=null,this.deadSET=null,this.fightSE=null,this.fightSET=null,this.unFightSE=null;var e=o("../BattleStatistics");this.statistics=new e},d.prototype.resetData=function(){this.btlState=0,this.btlWin=!1,this.fightTime=0,this.hpStar=0,this.timeStar=null,L.resetData(),B.resetData(),w.resetData(),a.resetData(),r.resetData(),s.resetData(),c.resetData(),E.resetData(),n.resetData()},d.prototype.getNPCHpAtkDef=function(e,t){var a=e.ori_attrs.maxhp,n=e.ori_attrs.atk,i=e.ori_attrs.def,r=DonotDestroyManager.GameData.CardUpgrades.coefs[e.potential][t.grade];return a=a+(t.level-1+r.maxhp)*e.add_attrs.maxhp+t.static_maxhp||0,n=n+(t.level-1+r.atk)*e.add_attrs.atk+t.static_atk||0,i=i+(t.level-1+r.def)*e.add_attrs.def+t.static_def||0,[a*=1+t.rates_maxhp/100,n*=1+t.rates_atk/100,i*=1+t.rates_def/100]},d.prototype._initOurSide=function(e){this.ourside.nickname=e.name,this.ourside.level=e.level,this.ourside.fightvalue=e.fightVal,this.ourside.formation=e.formation,this.ourside.armies=[],this.ourside.hps=[0,0],this.ourside.heroDeadNum=0;for(var t=b.findFormation(e.formation),a=0;a<e.teams.length;a++){var n=e.teams[a],i=n.hero.heroId,r=null,s=null;if(i){var o=(r=MyPersistDataManager._playerData.cardsMaplist[i]).template_id;s=DonotDestroyManager.GameData.Cards[o]}else
s=T.find(n.hero.id);var c=s.unit_type,l=A.find(c,n.unit_grade),h=L.createArmy(l.atk_type),d=B.createHero(l.atk_type);d.army=h,d.id=null!=i?i:n.hero.id,d.tid=n.hero.id,d.cfg=s,d.uCfg=l,d.name=s.name;var _=t.attrs[c-1];if(r){d.level=r.level,d.grade=r.grade;var u=R.getHeroPropAttr(i,null,null,_),m=P(u,3);d.hp=m[0],d.atk=m[1],d.def=m[2]}else{d.level=n.hero.level,d.grade=n.hero.grade;var p=this.getNPCHpAtkDef(s,n.hero),f=P(p,3);d.hp=f[0],d.atk=f[1],d.def=f[2]}
n.atkPerc&&(d.atk*=n.atkPerc/100),n.hpPerc&&(d.init_basehp=d.hp,d.hp=d.hp*n.hpPerc/100),d.uNum=r&&r.unit_num||n.unit_num,this.ourside.hps[1]=this.ourside.hps[1]+d.hp;var g=[],y=d.uNum;n.unitNum&&(y=n.unitNum);for(var v=0;v<y;v++){var M=w.createSoldier(l.atk_type);if(M.army=h,M.cfg=l,M.name=l.name+"#"+v,M.uType=c,r){M.level=r.unit_level,M.grade=r.unitGrade;var S=F.getUnitPropAttr(r,_),C=P(S,3);M.hp=C[0],M.atk=C[1],M.def=C[2]}else{M.level=n.unit_level,M.grade=n.unit_grade;var D=A.getUnitPropAttr(c,M.grade,M.level),I=P(D,3);M.hp=I[0],M.atk=I[1],M.def=I[2]}
M.co=d.cfg.co,M.str=d.cfg.str,M.int=d.cfg.int,this.ourside.hps[1]=this.ourside.hps[1]+M.hp,g.push(M)}
h.hero=d,h.soldiers=g,h.side=k._BTL_SIDE.OUR,h.setLocation(e,n.position),cc.log("init hero,name=%s,hp=%d,atk=%d,def=%d",d.name,d.hp,d.atk,d.def),n.hero.side="left",this.statistics.setData(h,n),this.ourside.armies.push(h)}
this.ourside.hps[0]=this.ourside.hps[1]},d.prototype._initOtrSide=function(e){this.otrside.nickname=e.name,this.otrside.level=e.level,this.otrside.fightvalue=e.fightVal,this.otrside.formation=e.formation,this.otrside.stageId=e.stageId,this.otrside.subStageId=e.subStageId,this.otrside.armies=[],this.otrside.hps=[0,0];for(var t=0;t<e.teams.length;t++){var a=e.teams[t],n=a.hero.id,i=T.find(n),r=i.unit_type,s=A.find(r,a.unit_grade),o=L.createArmy(s.atk_type),c=B.createHero(s.atk_type);if(c.army=o,c.id=a.hero.heroId,c.tid=n,c.cfg=i,c.name=i.name,c.uCfg=s,c.level=a.hero.level,c.grade=a.hero.grade,a.hero.skill_enable){c.skEnable={};for(var l=Object.keys(a.hero.skill_enable),h=0;h<l.length;h++){var d=l[h],_=a.hero.skill_enable[d];c.skEnable[h]=1==_}}
if(c.id){var u=x.getInstance().getHeroPropAttr(c.id,!0),m=P(u,3);c.hp=m[0],c.atk=m[1],c.def=m[2]}else{var p=this.getNPCHpAtkDef(i,a.hero),f=P(p,3);c.hp=f[0],c.atk=f[1],c.def=f[2]}
c.keyPosition=a.position,this.otrside.hps[1]=this.otrside.hps[1]+c.hp,a.hpPerc&&(c.init_basehp=c.hp,c.hp=c.hp*a.hpPerc/100);for(var g=[],y=0;y<a.unit_num;y++){var v=w.createSoldier(s.atk_type);v.army=o,v.cfg=s,v.name=s.name+"#"+y,v.uType=r,v.level=a.unit_level,v.grade=a.unit_grade;var M=A.getUnitPropAttr(r,v.grade,v.level),S=P(M,3);v.hp=S[0],v.atk=S[1],v.def=S[2];var C=[i.co,i.str,i.int];v.co=C[0],v.str=C[1],v.int=C[2],this.otrside.hps[1]=this.otrside.hps[1]+v.hp,g.push(v)}
o.hero=c,o.soldiers=g,o.side=k._BTL_SIDE.OTR,o.setLocation(e,a.position),cc.log("init hero,name=%s,hp=%d,atk=%d,def=%d",c.name,c.hp,c.atk,c.def),this.statistics.setData(o,a),this.otrside.armies.push(o)}
if(this.otrside.hps[0]=this.otrside.hps[1],e.stage_event)
for(var D=0;D<e.stage_event.length;D++){var I=e.stage_event[D],b=DonotDestroyManager.GameData.StageEvents;E.initTriggers(b[I])}},d.prototype.createAmbushArmy=function(e,t,a,n){var i;e==k._BTL_SIDE.OUR?i=this.ourside:e==k._BTL_SIDE.OTR&&(i=this.otrside);var r=L.createArmy(k._ARMY_TYPE.Melee);r.side=e;var s,o=t.levels[a].creatures,c=t.levels[a].last,l=[];if(null!=o){s=n?o.unit_num[1]:o.unit_num[0];for(var h=0;h<s;h++){var d=w.createSoldier(k._ARMY_TYPE.Melee);d.army=r,d.cfg=A.find(o.unit_type,o.unit_grade),d.uType=o.unit_type,d.level=o.unit_level,d.grade=o.unit_grade;var _=A.getUnitPropAttr(o.unit_type,d.grade,d.level),u=P(_,3);d.hp=u[0],d.atk=u[1],d.def=u[2];var m=[t.co,t.str,t.int];d.co=m[0],d.str=m[1],d.int=m[2],d.lifeTime=c,d.initial(),l.push(d)}
return r.soldiers=l,i.armies.push(r),r}},d.prototype.createBallista=function(e,t,a,n){var i;e==k._BTL_SIDE.OUR?i=this.ourside:e==k._BTL_SIDE.OTR&&(i=this.otrside);var r=L.createArmy(k._ARMY_TYPE.Remote);r.side=e;var s,o=t.levels[a].creatures,c=t.levels[a].last,l=[];if(null!=o){s=n?o.unit_num[1]:o.unit_num[0];for(var h=0;h<s;h++){var d=w.createSoldier(k._ARMY_TYPE.Remote);d.army=r,d.cfg=A.find(o.unit_type,o.unit_grade),d.uType=o.unit_type,d.level=o.unit_level,d.grade=o.unit_grade;var _=A.getUnitPropAttr(o.unit_type,d.grade,d.level),u=P(_,3);d.hp=u[0],d.atk=u[1],d.def=u[2];var m=[t.co,t.str,t.int];d.co=m[0],d.str=m[1],d.int=m[2],d.lifeTime=c,d.initial(),l.push(d)}
return r.soldiers=l,i.armies.push(r),r}},d.prototype.getTmSkillGuidePos=function(e){var t,a=function(e){for(var t=0;t<e.length;t++){var a=e[t],n=a.getPosition(),i=n.x,r=n.y;i-=r/2;var s=o("BattleUiMgr").getInstance().bf_node.convertToWorldSpaceAR(cc.p(i,r));if("Destory"!=a.getState()&&s.x<1184&&150<s.x)
return s}
return null};return e==k._BTL_TEAMSKILL.LS||e==k._BTL_TEAMSKILL.FB?t=a(this.otrside.armies):e==k._BTL_TEAMSKILL.LN?t=cc.p(300,460):e==k._BTL_TEAMSKILL.HC&&(t=a(this.ourside.armies)),t},d.prototype.createEventArmy=function(e,t,a,n){var i,r;0==e?(e=k._BTL_SIDE.OUR,i=this.ourside,r=e):1==e?(e=k._BTL_SIDE.OTR,i=this.otrside,r=e):2==e?(e=k._BTL_SIDE.OTR,i=this.otrside,r=-e):3==e&&(e=k._BTL_SIDE.OUR,i=this.ourside,r=-e);var s=t.mob_id,o=T.find(s),c=o.unit_type,l=a[t.mob_type-1],h=A.find(c,l.unit_grade),d=L.createArmy(h.atk_type);d.side=e,d.faceSide=r,d.delayMove=n;var _=B.createHero(h.atk_type);_.army=d,_.tid=s,_.cfg=o,_.uCfg=h,_.level=l.level,_.grade=l.card_grade;var u,m,p,f,g=(u=o.ori_attrs.maxhp,m=o.ori_attrs.atk,p=o.ori_attrs.def,f=DonotDestroyManager.GameData.CardUpgrades.coefs[o.potential][l.card_grade],u=u+(l.level-1+f.maxhp)*o.add_attrs.maxhp+l.add_attrs.statics.maxhp||0,m=m+(l.level-1+f.atk)*o.add_attrs.atk+l.add_attrs.statics.atk||0,p=p+(l.level-1+f.def)*o.add_attrs.def+l.add_attrs.statics.def||0,[u*=1+l.add_attrs.rates.maxhp/100,m*=1+l.add_attrs.rates.atk/100,p*=1+l.add_attrs.rates.def/100]);_.hp=g[0],_.atk=g[1],_.def=g[2],_.eventHero=!0,i.hps[0]=i.hps[0]+_.hp,i.hps[1]=i.hps[1]+_.hp,_.initial(),_.openSkilled=!1,_.setFace2Side(r);for(var y=[],v=0;v<l.unit_num;v++){var M=w.createSoldier(h.atk_type);M.army=d,M.cfg=h,M.uType=c,M.level=l.unit_level,M.grade=l.unit_grade;var S=A.getUnitPropAttr(c,M.grade,M.level),C=P(S,3);M.hp=C[0],M.atk=C[1],M.def=C[2];var D=[o.co,o.str,o.int];M.co=D[0],M.str=D[1],M.int=D[2],i.hps[0]=i.hps[0]+M.hp,i.hps[1]=i.hps[1]+M.hp,M.initial(),M.setFace2Side(r),y.push(M)}
return d.hero=_,d.soldiers=y,i.armies.push(d),d},d.prototype.getFightTime=function(){return Math.floor(this.fightTime)},d.prototype.getOurHeroDeadNum=function(){return this.ourside.heroDeadNum},d.prototype.getOurHPPercent=function(){return Math.floor(this.ourside.hps[0]/this.ourside.hps[1]*100)},d.prototype.judgeBattleResult=function(){var a=this,e=function(e){for(var t=!1,a=0;a<e.length;a++){if("Arrange"==e[a].getState()){t=!0;break}}
return!t};this.btlState==k._BTL_STATE.ING?!function(){for(var e=!0,t=0;t<a.otrside.armies.length;t++)
if("Destory"!=a.otrside.armies[t].getState()){e=!1;break}
return e}
()?function(){for(var e=!0,t=0;t<a.ourside.armies.length;t++)
if("Destory"!=a.ourside.armies[t].getState()){e=!1;break}
return e}
()&&(this.btlState=k._BTL_STATE.FAIL,r.cancelSkillAll()):(this.btlWin=!0,this.btlState=k._BTL_STATE.WIN,r.cancelSkillAll()):this.btlState==k._BTL_STATE.WIN?e(this.ourside.armies)&&(this.btlState=k._BTL_STATE.CHEER,E.dispatchTrigger10(1)):this.btlState==k._BTL_STATE.FAIL&&e(this.otrside.armies)&&(this.btlState=k._BTL_STATE.CHEER,E.dispatchTrigger10(2))},d.prototype.pause=function(){cc.log("in BattleManager pause!"),this.btlState=k._BTL_STATE.PAUSE,B.pause(),w.pause(),a.pause(),r.pause(),c.pause(),this.deadSE&&l.pauseEffect(this.deadSE),this.fightSE&&l.pauseEffect(this.fightSE),this.unFightSE&&l.pauseEffect(this.unFightSE)},d.prototype.resume=function(){this.btlState=k._BTL_STATE.ING,B.resume(),w.resume(),a.resume(),c.resume(),r.resume(),this.deadSE&&l.resumeEffect(this.deadSE),this.fightSE&&l.resumeEffect(this.fightSE),this.unFightSE&&l.resumeEffect(this.unFightSE)},d.prototype.onUpdate=function(e){if(this.judgeBattleResult(),this.btlState!=k._BTL_STATE.PAUSE&&(L.onUpdate(e),B.onUpdate(e),w.onUpdate(e),s.onUpdate(e),E.onUpdate(e),this.deadSET&&0<this.deadSET&&(this.deadSET=this.deadSET-e,this.deadSET<=0&&(this.deadSE=null)),this.fightSET&&0<this.fightSET&&(this.fightSET=this.fightSET-e,this.fightSET<=0))){var t=l.getBattleSound("battle",2),a=P(t,2),n=a[0],i=a[1];btlMr.fightSET=i,btlMr.fightSE=l.playEffect(n)}
r.onUpdate(e),c.onUpdate(e)},d.prototype.getHPData=function(){for(var e=[],t=0;t<this.ourside.armies.length;t++){if((i=this.ourside.armies[t]).hero)
if("Dead"!=i.hero.getState()){var a=Math.min(1.2*i.hero.hp,i.hero.basehp),n=Math.min(i.soldiers.length+5,i.hero.uNum);e.push({hp:Math.floor(a/i.hero.basehp*100),unitNum:n,heroId:i.hero.id,owner:0})}else
e.push({hp:0,unitNum:0,heroId:i.hero.id,owner:0})}
for(t=0;t<this.otrside.armies.length;t++){var i;(i=this.otrside.armies[t]).hero&&("Dead"!=i.hero.getState()?e.push({hp:Math.floor(i.hero.hp/i.hero.basehp*100),unitNum:i.soldiers.length,heroId:i.hero.id,owner:1}):e.push({hp:0,unitNum:0,heroId:i.hero.id,owner:1}))}
return e},d.prototype.destroy=function(){h.removeEvent("onFightBegin"),h.removeEvent("onHeroBeKilled"),h.removeEvent("onHPChanged"),h.removeEvent("onShakeScreen"),h.removeEvent("onBattleTalk"),h.removeEvent("onCreateEventArmies"),h.removeEvent("onEventCastSkill"),h.removeEvent("onGuideTeamSkill"),L.resetData(),B.resetData(),w.resetData(),a.resetData(),r.resetData(),s.resetData(),c.resetData(),E.resetData(),n.resetData(),i.resetData()},d.prototype.clearStaticData=function(){this.statistics.clearData()},e.exports=new d,cc._RF.pop()},{"../BattleStatistics":"BattleStatistics",ArmiesManager:"ArmiesManager",ArrowsManager:"ArrowsManager",BattleConstants:"BattleConstants",BattleUiMgr:"BattleUiMgr",BattleWidgets:"BattleWidgets",BuffsManager:"BuffsManager",EffectsManager:"EffectsManager",EnermyBufferMgr:"EnermyBufferMgr",FormationCfgMgr:"FormationCfgMgr",HeroBufferMgr:"HeroBufferMgr",HeroConfigMgr:"HeroConfigMgr",HeroDieManager:"HeroDieManager",HeroesManager:"HeroesManager",MyEventDispatcher:"MyEventDispatcher",SkillsManager:"SkillsManager",SoldiersManager:"SoldiersManager",SoundUtil:"SoundUtil",StagesEventManager:"StagesEventManager",UnitBufferMgr:"UnitBufferMgr",UnitConfigMgr:"UnitConfigMgr"}],BattlePauseMgr:[function(e,t,a){"use strict";cc._RF.push(t,"221bcNVePNGpaemF/g3Twyd","BattlePauseMgr");e("GameUtils");var n=e("SoundUtil"),i=e("BattleManager"),r=e("MarqueeBufferMgr");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},resumeBattle:function(e){i.resume(),this.node.removeFromParent(),this.node.destroy()},exitBattle:function(e){cc.director.getScheduler().setTimeScale(1),i.destroy(),i.fightSE&&(n.stopEffect(i.fightSE),i.fightSE=null),n.stopAllEffects(),MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),r.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"}}),cc._RF.pop()},{BattleManager:"BattleManager",GameUtils:"GameUtils",MarqueeBufferMgr:"MarqueeBufferMgr",SoundUtil:"SoundUtil"}],BattleSceneMgr:[function(A,e,t){"use strict";cc._RF.push(e,"9daca0DEHBHtKY2fMBE2Uqf","BattleSceneMgr");var u=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},R=A("ResLoaderManager"),i=A("SoundUtil"),F=A("BattleManager"),d=A("SkillsManager"),_=A("BuffsManager"),x=A("EffectsManager"),m=A("ArmiesManager"),p=A("BattleConstants"),o=A("MyEventDispatcher"),a=A("NetEvent"),r=(A("GameUtils"),A("OverComeBufferMgr")),s=(A("StagesConfigMgr"),A("StageBufferMgr"),A("ArenaBufferMgr")),n=A("PkBattleManager"),c=A("AreanBattleManager"),U=(A("ActivityBufferMgr"),A("TeamSkillBufferMgr")),l=(A("EliteStagesConfigMgr"),A("PVEBattleManager")),h=A("ElitePVEBattleManager"),f=A("ActivityBattleManager"),g=A("SnatchBattleManager"),y=A("ArenaCfgMgr"),N=A("UnitConfigMgr"),v=A("GuideBufferMgr"),M=A("PlayerBufferMgr"),S=A("MarqueeBufferMgr"),C=A("MineBattleManager"),D=A("SecretBattleManager"),I=A("BossBattleManager"),b=A("BossBufferMgr"),P=A("GuozhanBattleManager"),L=A("GuozhanOfficeBattleManager"),B=A("GuozhanCityBattleManager"),w=A("GuozhanFightBufferMgr"),E=cc.Class({extends:cc.Component,properties:{battle_loading_prefab:cc.Prefab,_loading_instance:A("BattleLoadingLayerMng"),_raw_assets:{default:{},type:Object},_update_count:0,_tsSelected:null,_tsCastTimes:[]},statics:{instance:null,getInstance:function(){return E.instance}},onLoad:function(){cc.sys.garbageCollect(),(E.instance=this).tsCallBack=null,this.otrTsMorale=0,this.otrTsDelay=0,this.otrTsTimes=[],this.secondCD=1,this.isUpdate=!0;var e=cc.instantiate(this.battle_loading_prefab);cc.Canvas.instance.node.addChild(e),this._loading_instance=e.getComponent("BattleLoadingLayerMng"),this._loading_instance.setAnimInFinishCb(this.doLoadResources.bind(this)),setTimeout(function(){i.playBeginBattleEffect1()},20),this._tsCastTimes=[0,0,0,0],this.onCreateEventArmiesEvt=this.onCreateEventArmiesEvtCb.bind(this),o.addListener("onCreateEventArmies",this.onCreateEventArmiesEvt),this.onHPChangedEvt=this.onHPChangedEvtCb.bind(this),o.addListener("onHPChanged",this.onHPChangedEvt),this.S2CStageEnd_cb_func=this.S2CStageEnd_cb.bind(this),o.addListener(a.S2CStageEnd,this.S2CStageEnd_cb_func),this.S2CEliteStageEnd_cb_func=this.S2CEliteStageEnd_cb.bind(this),o.addListener(a.S2CEliteStageEnd,this.S2CEliteStageEnd_cb_func),this.S2CUserOvercomePassStage_cb_func=this.S2CUserOvercomePassStage_cb.bind(this),o.addListener(a.S2CUserOvercomePassStage,this.S2CUserOvercomePassStage_cb_func),this.S2CArenaBattleCalculate_cb_func=this.S2CArenaBattleCalculate_cb.bind(this),o.addListener(a.S2CArenaBattleCalculate,this.S2CArenaBattleCalculate_cb_func),this.S2CActivitiesBattlePass_cb_func=this.S2CActivitiesBattlePass_cb.bind(this),o.addListener(a.S2CActivitiesBattlePass,this.S2CActivitiesBattlePass_cb_func),this.S2CTreasureRobCalculate_cb_func=this.S2CTreasureRobCalculate_cb.bind(this),o.addListener(a.S2CTreasureRobCalculate,this.S2CTreasureRobCalculate_cb_func),this.S2CPkBattleCalculate_cb_func=this.S2CPkBattleCalculate_cb.bind(this),o.addListener(a.S2CPkBattleCalculate,this.S2CPkBattleCalculate_cb_func),this.S2CMineBattleCalculate_cb_func=this.S2CMineBattleCalculate_cb.bind(this),o.addListener(a.S2CMineBattleCalculate,this.S2CMineBattleCalculate_cb_func),this.S2CSecretBattleEnd_cb_func=this.S2CSecretBattleEnd_cb.bind(this),o.addListener(a.S2CSecretBattleEnd,this.S2CSecretBattleEnd_cb_func),this.S2CBossView_cb_func=this.S2CBossView_cb.bind(this),o.addListener(a.S2CBossView,this.S2CBossView_cb_func),this.PushBossBattleStatus_cb_func=this.PushBossBattleStatus_cb.bind(this),o.addListener(a.PushBossBattleStatus,this.PushBossBattleStatus_cb_func),this.S2CGuozhanBattleEnd_cb_func=this.S2CGuozhanBattleEnd_cb.bind(this),o.addListener(a.S2CGuozhanBattleEnd,this.S2CGuozhanBattleEnd_cb_func),this.S2CGuozhanOfficCalculate_cb_func=this.S2CGuozhanOfficCalculate_cb.bind(this),o.addListener(a.S2CGuozhanOfficCalculate,this.S2CGuozhanOfficCalculate_cb_func),this.S2CGuozhanCityCalculate_cb_func=this.S2CGuozhanCityCalculate_cb.bind(this),o.addListener(a.S2CGuozhanCityCalculate,this.S2CGuozhanCityCalculate_cb_func),this.S2CGuozhanFightView_cb_func=this.S2CGuozhanFightView_cb.bind(this),o.addListener(a.S2CGuozhanFightView,this.S2CGuozhanFightView_cb_func)},restart:function(e){this._tsSelected=null,this.tsCallBack=null,this.otrTsMorale=0,this.otrTsDelay=0,this.otrTsTimes=[],this.secondCD=1,this.isUpdate=!0;var t=cc.instantiate(this.battle_loading_prefab);cc.Canvas.instance.node.addChild(t),this._loading_instance=t.getComponent("BattleLoadingLayerMng"),e?this._loading_instance.setAnimInFinishCb(this.doLoadResources.bind(this)):this._loading_instance.setAnimInFinishCb(this.restartCb.bind(this)),setTimeout(function(){i.playBeginBattleEffect1()},20),this._tsCastTimes=[0,0,0,0]},restartCb:function(){cc.log("battle scene manager,restartCb");var e=cc.instantiate(this._raw_assets["Prefab/ui/battle/battle_main_layer"]),t=this._loading_instance.node.getLocalZOrder();cc.Canvas.instance.node.addChild(e,t-1);var a=this;setTimeout(function(){i.playBeginBattleEffect2(),a._LoadingFadeOutFinishCb()},500)},onDestroy:function(){(E.instance=null)!=this._raw_assets&&(this._raw_assets={}),o.removeListener(a.S2CArenaBattleCalculate,this.S2CArenaBattleCalculate_cb_func),o.removeListener(a.S2CStageEnd,this.S2CStageEnd_cb_func),o.removeListener(a.S2CEliteStageEnd,this.S2CEliteStageEnd_cb_func),o.removeListener(a.S2CUserOvercomePassStage,this.S2CUserOvercomePassStage_cb_func),o.removeListener(a.S2CActivitiesBattlePass,this.S2CActivitiesBattlePass_cb_func),o.removeListener(a.S2CTreasureRobCalculate,this.S2CTreasureRobCalculate_cb_func),o.removeListener(a.S2CPkBattleCalculate,this.S2CPkBattleCalculate_cb_func),o.removeListener(a.S2CMineBattleCalculate,this.S2CMineBattleCalculate_cb_func),o.removeListener(a.S2CSecretBattleEnd,this.S2CSecretBattleEnd_cb_func),o.removeListener(a.S2CBossView,this.S2CBossView_cb_func),o.removeListener(a.PushBossBattleStatus,this.PushBossBattleStatus_cb_func),o.removeListener(a.S2CGuozhanBattleEnd,this.S2CGuozhanBattleEnd_cb_func),o.removeListener(a.S2CGuozhanOfficCalculate,this.S2CGuozhanOfficCalculate_cb_func),o.removeListener(a.S2CGuozhanCityCalculate,this.S2CGuozhanCityCalculate_cb_func),o.removeListener(a.S2CGuozhanFightView,this.S2CGuozhanFightView_cb_func),F.destroy(),F.clearStaticData(),DonotDestroyManager._iconSpriteFrameMap={},o.removeListener("onHPChanged",this.onHPChangedEvt),o.removeListener("onCreateEventArmies",this.onCreateEventArmiesEvt)},S2CGuozhanFightView_cb:function(e){w.updateNetData(e)},S2CGuozhanCityCalculate_cb:function(e){B.calculateS2cCb(e)},S2CGuozhanOfficCalculate_cb:function(e){L.calculateS2cCb(e)},S2CGuozhanBattleEnd_cb:function(e){cc.log(" quốc chiến PVE chấm dứt tin tức tiếp thu "),P.calculateS2cCb(e)},PushBossBattleStatus_cb:function(e){if(12==F.type&&2==e.status&&e.level_index==b.getLevelIndex()){F.pause(),null!=this._alert_layer&&cc.isValid(this._alert_layer)||(this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer));var t="";t=e.is_by_damage?" thật đáng mừng ！ thế giới BOSS đã muốn bị đánh bại, điểm đánh phản hồi chủ mặt biên lĩnh thưởng cho ！":"BOSS chọn chiến thời gian đã đến kỳ, điểm đánh phản hồi chủ mặt biên ！",this._alert_layer.getComponent("AlertLayerManager").initContent(t,function(){MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),S.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"},!1)}},S2CBossView_cb:function(e){b.updateNetData(e);var t=b.getLevelIndex(),a=DonotDestroyManager.GameData.Boss.boss_hp[t]/1e3*b.getBossHpPercent();F.otrside.armies[0].hero.hp=a,F.otrside.hps[0]=a,o.dispatchEvent("onHPChanged"),A("BattleUiMgr").getInstance().updateBossHpPercent()},S2CSecretBattleEnd_cb:function(e){cc.log(" bí mật căn cứ chấm dứt tin tức tiếp thu "),D.calculateS2cCb(e)},S2CTreasureRobCalculate_cb:function(e){cc.log(" đoạt bảo tin tức tiếp thu "),g.calculateS2cCb(e)},S2CMineBattleCalculate_cb:function(e){cc.log(" quặng tràng chấm dứt tin tức tiếp thu "),C.calculateS2cCb(e)},S2CPkBattleCalculate_cb:function(e){cc.log("PK chấm dứt tin tức tiếp thu "),n.calculateS2cCb(e)},S2CActivitiesBattlePass_cb:function(e){cc.log(" sử thi chiến dịch 、 anh hùng thí luyện chấm dứt tin tức tiếp thu "),f.onSuccessCb(e)},S2CArenaBattleCalculate_cb:function(e){if(cc.log(" Đấu Trường chấm dứt tin tức tiếp thu "),s.mArenainfo.isRankUp=s.mArenainfo.my_rank-e.new_rank,e.isRankUp=s.mArenainfo.my_rank-e.new_rank,0!=e.result){s.mArenainfo.enemys=e.enemys,s.mArenainfo.my_rank=e.new_rank;var t=cc.instantiate(this._raw_assets["Prefab/ui/battle/AreanWinPanel"]);cc.Canvas.instance.node.addChild(t);var a={info:e,leftinfo:c.leftData,rightinfo:c.rightData,staticData:F.statistics};t.getComponent("AreanWinPanel").ChangeData(a)}else{var n=cc.instantiate(this._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(n),n.getComponent("BattleFailMgr").initUi(4,{honor:"+0",gmoney:"+0",stamina:"-"+y.getStaminaCostUnit(),staticData:F.statistics})}},S2CUserOvercomePassStage_cb:function(e){if(cc.log(" quá quan trảm tướng chấm dứt "),r.rand_key=e.rand_key,e.is_win)
r.initHpdataBuffer(e.heroHpData),r.mOverComeBuffer.stage_index+=1,r.mOverComeBuffer.haveReward=!0,r.initOtrHerosHpdatas({}),MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),S.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome";else{var t=[],a=MyPersistDataManager._playerData.pvpformation;0<a.a&&t.push({heroId:a.a,hp:0,unitNum:0}),0<a.b&&t.push({heroId:a.b,hp:0,unitNum:0}),0<a.c&&t.push({heroId:a.c,hp:0,unitNum:0}),0<a.d&&t.push({heroId:a.d,hp:0,unitNum:0}),0<a.e&&t.push({heroId:a.e,hp:0,unitNum:0}),0<a.f&&t.push({heroId:a.f,hp:0,unitNum:0}),0<a.g&&t.push({heroId:a.g,hp:0,unitNum:0}),0<a.h&&t.push({heroId:a.h,hp:0,unitNum:0}),0<a.i&&t.push({heroId:a.i,hp:0,unitNum:0}),0<a.j&&t.push({heroId:a.j,hp:0,unitNum:0}),r.initHpdataBuffer(t),r.initOtrHerosHpdatas({enemyHpData:e.heroHpData,current_enemy:r.mOverComeBuffer.current_enemy});var n=cc.instantiate(this._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(n),n.getComponent("BattleFailMgr").initUi(0,{staticData:F.statistics})}},S2CStageEnd_cb:function(e){cc.log(" nhận PVE chiến đấu chấm dứt tin tức "),l.onSuccessCb(e)},S2CEliteStageEnd_cb:function(e){cc.log(" nhận Elite PVE chiến đấu chấm dứt tin tức "),h.onSuccessCb(e)},doLoadResources:function(){switch(cc.log("doLoadResources"),this.toLoadResMap=new Map,this._addCachedUnit(F.ourside.armies,"blue"),this._addCachedUnit(F.otrside.armies,"red"),F.type){case 1:case 2:case 5:this.toLoadResMap.set("Prefab/ui/battle/battleWinPanel",cc.Prefab),this.toLoadResMap.set("Prefab/ui/battle/battleFailPanel",cc.Prefab);break;case 3:this.toLoadResMap.set("Prefab/ui/battle/battleFailPanel",cc.Prefab);break;case 4:this.toLoadResMap.set("Prefab/ui/battle/AreanWinPanel",cc.Prefab),this.toLoadResMap.set("Prefab/ui/battle/battleFailPanel",cc.Prefab);break;case 6:this.toLoadResMap.set("Prefab/ui/battle/SnatchWinPanel",cc.Prefab),this.toLoadResMap.set("Prefab/ui/battle/battleFailPanel",cc.Prefab);break;case 7:break;case 8:this.toLoadResMap.set("Prefab/ui/battle/PkWinPanel",cc.Prefab),this.toLoadResMap.set("Prefab/ui/battle/battleFailPanel",cc.Prefab);break;case 9:this.toLoadResMap.set("Prefab/ui/battle/MineWinPanel",cc.Prefab),this.toLoadResMap.set("Prefab/ui/battle/battleFailPanel",cc.Prefab);break;case 11:this.toLoadResMap.set("Prefab/ui/battle/SecretWinPanel",cc.Prefab),this.toLoadResMap.set("Prefab/ui/battle/battleFailPanel",cc.Prefab);break;case 13:case 14:case 15:this.toLoadResMap.set("Prefab/ui/battle/GuozhanPveWinPanel",cc.Prefab),this.toLoadResMap.set("Prefab/ui/battle/battleFailPanel",cc.Prefab)}
this.toLoadResMap.set("Prefab/effect/winstar",cc.Prefab),this.toLoadResMap.set("battle/battlewidgets",cc.SpriteAtlas),this.toLoadResMap.set("Prefab/battle/effects/dodge",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/dmgdefend",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/dmgarmor",cc.Prefab),this.toLoadResMap.set("sound/zdgc_03",cc.AudioClip),this.toLoadResMap.set("Prefab/ui/battle/battle_main_layer",cc.Prefab),this.toLoadResMap.set("Prefab/ui/battle/battle_pause_panel",cc.Prefab),this.toLoadResMap.set("Prefab/ui/battle/battle_talk_player",cc.Prefab),this.toLoadResMap.set("Prefab/Heros/rolebase",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/reinforceUnit",cc.Prefab),this.toLoadResMap.set("Prefab/battle/arrow/arrow1",cc.Prefab),this.toLoadResMap.set("Prefab/battle/arrow/arrow2",cc.Prefab),this.toLoadResMap.set("Prefab/battle/arrow/arrow3",cc.Prefab),this.toLoadResMap.set("Prefab/battle/arrow/iceBall1",cc.Prefab),this.toLoadResMap.set("Prefab/battle/arrow/lightningBall1",cc.Prefab),this.toLoadResMap.set("Prefab/battle/widget/heroLifeBarGreen",cc.Prefab),this.toLoadResMap.set("Prefab/battle/widget/heroLifeBarRed",cc.Prefab),this.toLoadResMap.set("Prefab/battle/widget/unitLifeBarGreen",cc.Prefab),this.toLoadResMap.set("Prefab/battle/widget/unitLifeBarRed",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/blood",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/beheaded",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/wasbeheaded",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/lightBox1",cc.Prefab);for(var e=!1,t=0;t<DonotDestroyManager.GameData.TeamSkills.items.length;t++){var a=DonotDestroyManager.GameData.TeamSkills.items[t],n=U.getBattleLevel(a.id);if(0==n){if(e)
break;n=1,e=!0}
for(var i=a.levels[n-1],r=0;r<i.effect.length;r++){var s=i.effect[r],o="Prefab/battle/effects/"+x.getCfgById(s.id||s[0]).file;this.toLoadResMap.set(o,cc.Prefab)}
for(r=0;r<i.crit_effect.length;r++){s=i.crit_effect[r],o="Prefab/battle/effects/"+x.getCfgById(s.id||s[0]).file;this.toLoadResMap.set(o,cc.Prefab)}}
if(null!=F.otrTmSk&&null!=F.otrTmSk.value)
for(t=0;t<F.otrTmSk.value.length;t++){var c=F.otrTmSk.skill_level[t];if(!(c<1)){for(i=DonotDestroyManager.GameData.TeamSkills.items[t].levels[c-1],r=0;r<i.effect.length;r++){s=i.effect[r],o="Prefab/battle/effects/"+x.getCfgById(s.id||s[0]).file;this.toLoadResMap.set(o,cc.Prefab)}
for(r=0;r<i.crit_effect.length;r++){s=i.crit_effect[r],o="Prefab/battle/effects/"+x.getCfgById(s.id||s[0]).file;this.toLoadResMap.set(o,cc.Prefab)}}}
this.toLoadResMap.set("Prefab/battle/effects/stun1",cc.Prefab),this.toLoadResMap.set("Prefab/battle/soldier/reinforce_1_blue",cc.Prefab),this.toLoadResMap.set("Prefab/battle/soldier/reinforce_1_red",cc.Prefab),this.toLoadResMap.set("Prefab/battle/soldier/reinforce_10_blue",cc.Prefab),this.toLoadResMap.set("Prefab/battle/soldier/reinforce_10_red",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/ballista_sight",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/tearScreen/tearScreenBg",cc.Prefab),MyPersistDataManager._playerData.sex%2==1?this.toLoadResMap.set("Prefab/battle/effects/tearScreen/tearScreenGentleman",cc.Prefab):this.toLoadResMap.set("Prefab/battle/effects/tearScreen/tearScreenLady",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/tearScreen/tearSkillName",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/gskill/gskill_flare",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/gskill/tmSkillBorder",cc.Prefab);var l=function(e){return 2==e||4==e||6==e||7==e};(l(F.ourside.formation)||l(F.otrside.formation))&&(this.toLoadResMap.set("Prefab/battle/effects/ambush1",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/ambush2",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/ambushOut2",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/ambushOut3",cc.Prefab)),this.toLoadResMap.set("battle/effect/march_blue",cc.SpriteFrame),this.toLoadResMap.set("battle/effect/march_red",cc.SpriteFrame),this.toLoadResMap.set("Prefab/battle/effects/March_route_blue",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/March_route_red",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/star_break",cc.Prefab),this.toLoadResMap.set("Prefab/battle/effects/star_break2",cc.Prefab),this.toLoadResMap.set("battle/scene/"+F.bgFile,cc.SpriteFrame);var h=[],d=A("StagesEventManager").triggers,_=Object.keys(d);for(r=0;r<_.length;r++)
for(var u=d[_[r]],m=0;m<u.length;m++)
for(var p=u[m][1],f=0;f<p.length;f++){var g=p[f];if(2==g[0]){var y=g[2];h.push([g[1],y])}}
var v=DonotDestroyManager.GameData.Reinforce,M=A("HeroConfigMgr");for(r=0;r<h.length;r++){var S=h[r][0],C=v[h[r][1]];for(f=0;f<C.troops.length;f++){var D=C.troops[f],I=(D.mob_id,D.mob_id),b=M.find(I),P="Prefab/Heros/"+b.icon;this.toLoadResMap.set(P,cc.Prefab),this._addCachedSkill(b.skills);var L=b.unit_type,B=C.attrs[D.mob_type-1],w=N.find(L,B.unit_grade);if(w){var E=0==S||3==S?"blue":"red";o=cc.js.formatStr("Prefab/battle/soldier/%s_%s",w.icon,E);this.toLoadResMap.set(o,cc.Prefab)}}}
var k=this._loadProgressCb.bind(this),T=this._loadFinishCb.bind(this);R.asyncLoadAll(this.toLoadResMap,k,T)},_loadProgressCb:function(e){this._loading_instance.changeProgress(e)},_loadFinishCb:function(e,t){cc.log("load battle resources finish!"),t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this);var a=cc.instantiate(this._raw_assets["Prefab/ui/battle/battle_main_layer"]),n=this._loading_instance.node.getLocalZOrder();cc.Canvas.instance.node.addChild(a,n-1),i.playBeginBattleEffect2(),this._LoadingFadeOutFinishCb()},_LoadingFadeOutFinishCb:function(){cc.log("loading fade out finish!"),this._loading_instance.node.destroy(),this._loading_instance=null,MyBgMusicManager.play(this._raw_assets["sound/zdgc_03"]),F.btlState=p._BTL_STATE.INIT;var e=function(e){for(var t=0;t<e.length;t++){var a=e[t];a.hero.initial();for(var n=0;n<a.soldiers.length;n++){a.soldiers[n].initial(t,a.soldiers[0].node)}
a.add2Battle()}};e(F.ourside.armies),e(F.otrside.armies),this.node.runAction(cc.sequence(cc.delayTime(.02),cc.callFunc(function(){this.fighting();var e=i.getBattleSound("battle",1),t=u(e,2),a=t[0];t[1];F.unFightSE=i.playEffect(a,!0);var n=1;null!=cc.sys.localStorage.getItem(M.getUserId()+"gBtlSpeedLocal")&&(n=cc.sys.localStorage.getItem(M.getUserId()+"gBtlSpeedLocal"),n=parseInt(n)),cc.director.getScheduler().setTimeScale(n)},this)))},fighting:function(){var r=DonotDestroyManager.GameData.TeamSkills.init_morale,s=this;this.tsCallBack=function(e,t){if("Restore"==e)
r=Math.min(r+DonotDestroyManager.GameData.TeamSkills.morale_restore*t,DonotDestroyManager.GameData.TeamSkills.max_morale),s.otrTsMorale=Math.min(s.otrTsMorale+DonotDestroyManager.GameData.TeamSkills.morale_restore*t,DonotDestroyManager.GameData.TeamSkills.max_morale);else if("Casted"==e){var a;if(null==s._tsSelected||!s._tsSelected.cfg)
return!1;a=s._tsSelected.cfg.id;var n=s._tsSelected.cfg.morale_cost.length,i=s._tsSelected.cfg.morale_cost[Math.min(n-1,s._tsCastTimes[a-1])];if(r<i)
return!1;r-=i,s._tsCastTimes[a-1]++,null!=s._tsSelected.node&&null!=s._tsSelected.node.getComponent("TeamSkillUiManager")&&s._tsSelected.node.getComponent("TeamSkillUiManager").cast1()}
return s._update_count%15==0&&o.dispatchEvent("onMoralChanged",r),!0},F.btlState=p._BTL_STATE.ING;var e=A("StagesEventManager");s=this;if(e.dispatchTrigger10(0,function(){o.dispatchEvent("onFightBegin"),v.showBattleSpeedGuide()}),null!=F.otrTmSk&&null!=F.otrTmSk.delay){var t=F.otrTmSk.delay[0],a=F.otrTmSk.delay[1];this.otrTsDelay=.1*(Math.random()*(10*a-10*t)+10*t)}
S.setMarqueeCanPlay(!0),S.checkHasMsg()&&S.doPlay()},update:function(e){if(this.isUpdate){var t=A("StagesEventManager");if(null!=F)
if(F.onUpdate(e),this._update_count++,F.btlState==p._BTL_STATE.ING){if(F.fightTime=F.fightTime+e,t.dispatchTrigger4(F.fightTime),0<this.secondCD&&(this.secondCD=this.secondCD-e,this.secondCD<=0&&(this.secondCD=1,this.fightTCB())),this.tsCallBack("Restore",e),0<this.otrTsDelay&&(this.otrTsDelay=this.otrTsDelay-e,this.otrTsDelay<=0)){var a=F.otrTmSk.delay[0],n=F.otrTmSk.delay[1];this.otrTsDelay=.1*(Math.random()*(10*n-10*a)+10*a),this.castEnermyTeamSkill()}
12==F.type&&I.onUpdate(e)}else
F.btlState==p._BTL_STATE.CHEER&&(this.isUpdate=!1,this.endBattle())}},castEnermyTeamSkill:function(){if(!(F.otrTmSk.rate<=0)){var i=this;if(!(this.otrTsMorale<function(){for(var e=0,t=0;t<F.otrTmSk.skill_level.length;t++)
if(0<F.otrTmSk.skill_level[t]){var a=DonotDestroyManager.GameData.TeamSkills.items[t],n=Math.min(i.otrTsTimes[t]||0,a.morale_cost.length-1);e=Math.max(e,a.morale_cost[n])}
return e}
()))
if(100*Math.random()>F.otrTmSk.rate)
this.otrTsMorale=this.otrTsMorale-function(){for(var e=1e3,t=0;t<F.otrTmSk.skill_level.length;t++)
if(0<F.otrTmSk.skill_level[t]){var a=DonotDestroyManager.GameData.TeamSkills.items[t],n=Math.min(i.otrTsTimes[t]||0,a.morale_cost.length-1);e=Math.min(e,a.morale_cost[n])}
return e}
();else{for(var e,t=0,a=0;a<F.otrTmSk.value.length;a++){t+=r=F.otrTmSk.value[a]}
if(!(t<1)){var n=Math.random()*t;for(a=0;a<F.otrTmSk.value.length;a++){var r;if(!((r=F.otrTmSk.value[a])<n)){e=a;break}
n-=r}
var s=F.otrTmSk.skill_level[e];if(!(s<1)){var o,c=DonotDestroyManager.GameData.TeamSkills.items[e],l=Math.min(this.otrTsTimes[c.id-1]||0,c.morale_cost.length-1);this.otrTsMorale=this.otrTsMorale-c.morale_cost[l],this.otrTsTimes[c.id-1]=l+1;var h=F.otrTmSk.ai_template,d=function(e){var t=Math.random(),a=t-1;e.x=e.x+20*t,e.y=e.y+20*a};if(1==h){if(1==c.id){if(!(o=m.getRandArmyPos()))
return;d(o)}else if(2==c.id)
o=m.getRandArmyPos();else if(3==c.id){if(!(o=m.getRandArmyPos()))
return;o.x=o.x+20}else if(4==c.id){if(!(o=m.getRandArmyPos(p._BTL_SIDE.OTR)))
return;d(o)}}else if(2==h)
if(1==c.id){if(!(o=m.getRandArmyPos(p._BTL_SIDE.OUR)))
return;d(o)}else if(2==c.id)
o=m.getRandArmyPos(p._BTL_SIDE.OUR);else if(3==c.id){if(!(o=m.getRandArmyPos(p._BTL_SIDE.OTR)))
return;o.x=o.x+20}else
4==c.id&&(o=m.getRandArmyPos(p._BTL_SIDE.OTR));else if(3==h)
if(1==c.id)
o=m.getRandArmyPos(p._BTL_SIDE.OUR);else if(2==c.id){o=m.getRandRemoteArmyPos(p._BTL_SIDE.OUR)[1]}else if(3==c.id){var _=m.getRandRemoteArmyPos(p._BTL_SIDE.OTR),u=_[0];if(!(o=_[1]))
return;o.x=u?o.x+20:o.x+100}else
4==c.id&&(o=m.getLowestHPArmyPos(p._BTL_SIDE.OTR));if(o)
A("BattleUiMgr").getInstance().castTeamSkill(o,{cfg:c,level:s})}}}}},_addCachedUnit:function(e,t){for(var a=0;a<e.length;a++){var n,i=e[a],r=i.hero;if(r){var s="Prefab/Heros/"+(n=r.cfg).icon;if(this.toLoadResMap.set(s,cc.Prefab),this._addCachedSkill(n.skills),36==n.id||214==n.id){var o="Prefab/battle/effects/battleCry1Buff2";this.toLoadResMap.set(o,cc.Prefab)}}
var c=i.soldiers[0];if(c){o=cc.js.formatStr("Prefab/battle/soldier/%s_%s",c.cfg.icon,t);this.toLoadResMap.set(o,cc.Prefab)}}},_addCachedSkill:function(e){for(var t=0;t<e.length;t++){for(var a=e[t][0],n=d.getCfgById(a),i=n.effect_1||[],r=0;r<i.length;r++){var s=i[r],o="Prefab/battle/effects/"+x.getCfgById(s.id||s[0]).file;this.toLoadResMap.set(o,cc.Prefab)}
var c=n.effect_2||[];for(r=0;r<c.length;r++){s=c[r],o="Prefab/battle/effects/"+x.getCfgById(s.id||s[0]).file;this.toLoadResMap.set(o,cc.Prefab)}
var l=n.buffId;if(l){var h=_.getCfgById(l);for(h.unit_type,r=0;r<h.effect.length;r++){s=h.effect[r],o="Prefab/battle/effects/"+x.getCfgById(s.id||s[0]).file;this.toLoadResMap.set(o,cc.Prefab)}}
n.quality<3?(this.toLoadResMap.set("battle/imageTitle/small/"+n.icon,cc.SpriteFrame),this.toLoadResMap.set("battle/imageTitle/small/"+n.icon,cc.SpriteFrame)):this.toLoadResMap.set("battle/imageTitle/big/"+n.icon,cc.SpriteFrame)}},fightTCB:function(){o.dispatchEvent("onBattleTimeAdd")},onHPChangedEvtCb:function(){if(this._update_count%8==0){var e=Math.floor(F.ourside.hps[0]/F.ourside.hps[1]*100)/100,t=F.otrside.hps[0]/F.otrside.hps[1],a=A("StagesEventManager");a.dispatchTrigger5(0,100*e),a.dispatchTrigger5(1,100*t)}},endBattle:function(){cc.director.getScheduler().setTimeScale(1),F.destroy(),F.fightSE&&(i.stopEffect(F.fightSE),F.fightSE=null),MyBgMusicManager.stop(),i.stopAllEffects(),F.btlWin?i.playSuccessEffect():i.playFailureEffect();this.node.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){F.btlWin?F.successCB():F.failureCB()}))),i.stopMusic()},onCreateEventArmiesEvtCb:function(e){for(var t=u(e,2),a=t[0],n=t[1],r=DonotDestroyManager.GameData.Reinforce[n],i=0;i<r.troops.length;i++){var s,o,c,l,h=r.troops[i],d=h.position;0==a||2==a?(c=(s=300*d[0]-5-1450)+50,l=(o=155*d[1]-10-515)+100):1!=a&&3!=a||(c=(s=300*d[0]+1555-1450)-50,l=(o=155*d[1]-10-515)+100);var _=cc.instantiate(this._raw_assets["Prefab/battle/effects/reinforceUnit"]);_.setPosition(c-l/2,l),A("BattleUiMgr").getInstance().bf_node.addChild(_,p._BTL_ZORDER.BF_FRONT),_.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("Skillup",-1,-1,0,"normal"),function(t,a,n,i){_.getComponent("dragonBones.ArmatureDisplay").addEventListener(dragonBones.EventObject.FRAME_EVENT,function(e){"fire"==e.detail.name&&F.createEventArmy(a,t,r.attrs,r.delayMove).add2Battle(cc.p(n,i))},this)}
(h,a,s,o)}}});cc._RF.pop()},{ActivityBattleManager:"ActivityBattleManager",ActivityBufferMgr:"ActivityBufferMgr",AreanBattleManager:"AreanBattleManager",ArenaBufferMgr:"ArenaBufferMgr",ArenaCfgMgr:"ArenaCfgMgr",ArmiesManager:"ArmiesManager",BattleConstants:"BattleConstants",BattleLoadingLayerMng:"BattleLoadingLayerMng",BattleManager:"BattleManager",BattleUiMgr:"BattleUiMgr",BossBattleManager:"BossBattleManager",BossBufferMgr:"BossBufferMgr",BuffsManager:"BuffsManager",EffectsManager:"EffectsManager",ElitePVEBattleManager:"ElitePVEBattleManager",EliteStagesConfigMgr:"EliteStagesConfigMgr",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",GuozhanBattleManager:"GuozhanBattleManager",GuozhanCityBattleManager:"GuozhanCityBattleManager",GuozhanFightBufferMgr:"GuozhanFightBufferMgr",GuozhanOfficeBattleManager:"GuozhanOfficeBattleManager",HeroConfigMgr:"HeroConfigMgr",MarqueeBufferMgr:"MarqueeBufferMgr",MineBattleManager:"MineBattleManager",MyEventDispatcher:"MyEventDispatcher",NetEvent:"NetEvent",OverComeBufferMgr:"OverComeBufferMgr",PVEBattleManager:"PVEBattleManager",PkBattleManager:"PkBattleManager",PlayerBufferMgr:"PlayerBufferMgr",ResLoaderManager:"ResLoaderManager",SecretBattleManager:"SecretBattleManager",SkillsManager:"SkillsManager",SnatchBattleManager:"SnatchBattleManager",SoundUtil:"SoundUtil",StageBufferMgr:"StageBufferMgr",StagesConfigMgr:"StagesConfigMgr",StagesEventManager:"StagesEventManager",TeamSkillBufferMgr:"TeamSkillBufferMgr",UnitConfigMgr:"UnitConfigMgr"}],BattleStatistics:[function(e,t,a){"use strict";cc._RF.push(t,"d3e6eZy7/1Ki5eGddlOE6dn","BattleStatistics");var n=function(){this.teams=new Map};n.prototype.setData=function(e,t){if(!this.teams.has(e)){var a={killHero:0,killUnit:0,damage:0};this.teams.set(e,a)}
this.teams.get(e).data=t},n.prototype.clearData=function(){this.teams.clear()},n.prototype.addKillUnit=function(e){this.teams.has(e)&&(this.teams.get(e).killUnit=this.teams.get(e).killUnit+1)},n.prototype.addKillHero=function(e){this.teams.has(e)&&(this.teams.get(e).killHero=this.teams.get(e).killHero+1)},n.prototype.addDamage=function(e,t){this.teams.has(e)&&(this.teams.get(e).damage=this.teams.get(e).damage+t)},n.prototype.getStatistics=function(e){return this.teams.get(e)},n.prototype.getKillUnit=function(a){var n=0;return this.teams.forEach(function(e,t){e.data.hero.side==a&&(n+=e.killUnit)}),n},n.prototype.getKillHero=function(a){var n=0;return this.teams.forEach(function(e,t){e.data.hero.side==a&&(n+=e.killHero)}),n},t.exports=n,cc._RF.pop()},{}],BattleTalkLayer:[function(e,t,a){"use strict";cc._RF.push(t,"c7124n9sY5KRoMy5WdofIi9","BattleTalkLayer");e("GameUtils");var n=e("SoundUtil"),i=e("BattleManager"),r=e("PlayerBufferMgr");cc.Class({extends:cc.Component,properties:{mLeftGroup:cc.Node,mRightGroup:cc.Node,mLeftRole:cc.Node,mRightRole:cc.Node,node_skip_guide:cc.Node,frame:cc.Node,txleftName:cc.Label,txrightName:cc.Label,txleftTalk:cc.Label,txrightTalk:cc.Label,_isLeftTalkShow:!1,_isRightTalkShow:!1,_scheduleUpdate:!1,_sumDt:0,res_head_icon_spr:[cc.SpriteFrame],_is_all_talk_show:!1},onLoad:function(){this._is_all_talk_show=!1;var e=i.otrside.stageId;this.node_skip_guide.active=null!=e&&100==e},initData:function(e,t){this.mTalkData=e,this.mEventCallBack=t,this.mCursorIndex=0,this.mEventCallBack("EVENT_TYPE_START"),this.talkLayer=this.node,this.txleftName.node.active=!1,this.txrightName.node.active=!1,this.txleftTalk.node.active=!1,this.txrightTalk.node.active=!1,this.setCircleEventListener(this.node),this.updateTalk(this.mTalkData[this.mCursorIndex])},onDestroy:function(){},updateTalk:function(e){this.mCursorIndex=this.mCursorIndex+1;var t=this.getRoleInfo(e);if("L"==e.dir){this.mLeftRole.active=!0,this.mLeftGroup.active=!0,this.mRightRole.active=!1,this.mRightGroup.active=!1,this.setRoleIcon(this.mLeftRole.getComponent(cc.Sprite),e),this.mLeftRole.setPositionX(this.mLeftRole.getPositionX()-20),this.txleftName.string=t[0],this.txleftName.node.active=!0;var a=this;this.slowDownFadeIn(function(){a.mLeftRole.runAction(cc.sequence(cc.spawn(cc.fadeIn(.16),cc.moveBy(.16,cc.p(20,0)).easing(cc.easeIn(.8))),cc.callFunc(function(){a.mArrowBtn=a.mLeftGroup.getChildByName("Arrow"),a.talkStrVal=e.talk,a.wordIdx=0,a._scheduleUpdate=!0,a.txTalkShowLab=a.txleftTalk,a._isLeftTalkShow=!0,a.setArrowAnimation()})))})}else{this.mLeftRole.active=!1,this.mLeftGroup.active=!1,this.mRightRole.active=!0,this.mRightGroup.active=!0,this.mRightRole.setScaleX(-1),this.setRoleIcon(this.mRightRole.getComponent(cc.Sprite),e),this.mRightRole.setPositionX(this.mRightRole.getPositionX()+20),this.txrightName.string=t[0],this.txrightName.node.active=!0;a=this;this.slowDownFadeIn(function(){a.mRightRole.runAction(cc.sequence(cc.spawn(cc.fadeIn(.16),cc.moveBy(.16,cc.p(-20,0)).easing(cc.easeIn(.8))),cc.callFunc(function(){a.mArrowBtn=a.mLeftGroup.getChildByName("Arrow"),a.talkStrVal=e.talk,a.wordIdx=0,a._scheduleUpdate=!0,a.setArrowAnimation(),a.txTalkShowLab=a.txrightTalk,a._isRightTalkShow=!0})))})}},update:function(e){if(this._scheduleUpdate){if(null==this.wordIdx)
return;this.wordIdx=this.wordIdx+1;var t=this.talkStrVal.substring(0,this.wordIdx);this.txTalkShowLab.string=t,this.txTalkShowLab.node.active=!0,this.wordIdx>=this.talkStrVal.length&&(this._scheduleUpdate=!1,this._is_all_talk_show=!0)}},refreshAllTalk:function(){this.txTalkShowLab.string=this.talkStrVal,this._is_all_talk_show=!0},slowDownFadeIn:function(e){var t=this;this.talkLayer.runAction(cc.sequence(cc.callFunc(function(){t.mLeftGroup.activeInHierarchy?(t.frame.runAction(cc.fadeIn(.16)),t.mLeftGroup.runAction(cc.fadeIn(.16))):t.mRightGroup.activeInHierarchy&&(t.frame.runAction(cc.fadeIn(.16)),t.mRightGroup.runAction(cc.fadeIn(.16)))}),cc.delayTime(.16),cc.callFunc(e)))},slowDownFadeOut:function(e){var t=this;this.talkLayer.runAction(cc.sequence(cc.callFunc(function(){t.mLeftGroup.activeInHierarchy?(t.mLeftRole.runAction(cc.fadeOut(.16)),t.frame.runAction(cc.fadeOut(.16)),t.mLeftGroup.runAction(cc.fadeOut(.16)),t.txleftTalk.node.active=!1,t._isLeftTalkShow=!1):t.mRightGroup.activeInHierarchy&&(t.mRightRole.runAction(cc.fadeOut(.16)),t.frame.runAction(cc.fadeOut(.16)),t.mRightGroup.runAction(cc.fadeOut(.16)),t.txrightTalk.node.active=!1,t._isRightTalkShow=!0)}),cc.delayTime(.16),cc.callFunc(e)))},getRoleInfo:function(e){var t=DonotDestroyManager.GameData.BattleTalk.Role[e.roleId],a=cc.clone(t);if(2==e.roleId){var n=r.getRoleID();a[1]=1==n?this.res_head_icon_spr[0]:this.res_head_icon_spr[1]}else{var i=a[1].replace("ui","UI");i=i.replace(".png","")}
return a},setRoleIcon:function(a,e){var t=DonotDestroyManager.GameData.BattleTalk.Role[e.roleId];if(2==e.roleId){var n=null;n=1==r.getRoleID()?this.res_head_icon_spr[0]:this.res_head_icon_spr[1],a.spriteFrame=n}else{var i;i=t[1].replace("ui","UI").replace(".png",""),cc.loader.loadRes(i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=a&&cc.isValid(a)&&(a.spriteFrame=t)})}},setCircleEventListener:function(e){var n=this,i=(new Date).getTime();e.on(cc.Node.EventType.TOUCH_START,function(e,t){if(!((new Date).getTime()-i<200)){i=(new Date).getTime();var a=function(){n._scheduleUpdate=!1,n.refreshAllTalk()};if(n._scheduleUpdate)
return a(),!0;if(this._is_all_talk_show){if(this._is_all_talk_show=!1,n.mTalkData.length<=n.mCursorIndex)
return n.mEventCallBack("EVENT_TYPE_END"),n._scheduleUpdate&&(n._scheduleUpdate=!1),n.slowDownFadeOut(function(){n.node.destroy()}),!0;n.slowDownFadeOut(function(){n._scheduleUpdate&&a(),n.updateTalk(n.mTalkData[n.mCursorIndex])})}
return!0}},this),e.on(cc.Node.EventType.TOUCH_END,function(e,t){},this)},setArrowAnimation:function(){var e=cc.fadeOut(1),t=e.reverse();this.mArrowBtn.runAction(cc.repeatForever(cc.sequence(e,t)))},clickHanlder_finishGuideFight:function(e,t){cc.director.getScheduler().setTimeScale(1),i.destroy(),i.fightSE&&(n.stopEffect(i.fightSE),i.fightSE=null),MyBgMusicManager.stop(),n.stopAllEffects(),n.stopMusic(),i.successCB()}}),cc._RF.pop()},{BattleManager:"BattleManager",GameUtils:"GameUtils",PlayerBufferMgr:"PlayerBufferMgr",SoundUtil:"SoundUtil"}],BattleUiMgr:[function(s,e,t){"use strict";cc._RF.push(e,"bd0abKmuNBBTJgFgfSUn3Y3","BattleUiMgr");var _=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},g=s("BattleManager"),y=s("BattleSceneMgr"),v=s("GameUtils"),M=s("SoundUtil"),S=s("EffectsManager"),C=s("BuffsManager"),D=s("BattleConstants"),n=s("MyEventDispatcher"),u=s("StageBufferMgr"),m=s("TeamSkillBufferMgr"),I=s("PlayerBufferMgr"),p=(s("BattleTalkLayer"),s("GuideBufferMgr")),a=s("BossBufferMgr"),i="normal",r=cc.Class({extends:cc.Component,properties:{bg_spr:cc.Sprite,left_name:cc.Label,right_name:cc.Label,btl_time_label:cc.Label,total_moral_label:cc.Label,bf_node:cc.Node,ui_node:cc.Node,main_font:cc.Font,sprLeftLB:cc.Node,sprRightLB:cc.Node,nodeTeamSkillParent:cc.Node,teamSkillPrefab:cc.Prefab,amtStarTime:cc.Node,amtStarHP:cc.Node,labBossHp:cc.Label,mBtnPause:cc.Node,mBtnSpeedUp:cc.Node,mBtnSpeedUpRate:cc.Sprite,btn_skip_guide:cc.Node,chunHeiBg:cc.Prefab,tearScreenMask:cc.SpriteFrame,enemyUseBlack_Spr:cc.SpriteFrame,enemyUse_Spr:cc.SpriteFrame,enemyUselight_Spr:cc.SpriteFrame,tmIconlight_Spr:cc.SpriteFrame,tmSkFrame_Spr:cc.SpriteFrame,skillIconList:[cc.SpriteFrame],SpeedUpRateList:[cc.SpriteFrame],timeStarLeftTime:cc.Integer,ourLifePercent:cc.Float},statics:{instance:null,getInstance:function(){return r.instance}},onLoad:function(){(r.instance=this).fieldScale=.9375,this.fieldSize={w:2400,h:1030},this.visibleScreen=cc.rect(0,0,v.DESIGN_WIDTH,v.DESIGN_HEIGHT),this.bg_spr.spriteFrame=y.getInstance()._raw_assets["battle/scene/"+g.bgFile],this.left_name.string=cc.js.formatStr("LV%d.%s",g.ourside.level,g.ourside.nickname),this.right_name.string=cc.js.formatStr("LV%d.%s",g.otrside.level,g.otrside.nickname);for(var e=m.getOpenSkillCount(),t=0;t<e;t++){var a=DonotDestroyManager.GameData.TeamSkills.items[t];this.addTeamSkillWidget(a,t)}
this.registerFieldTouches(),this.beganTouch=null,this.lstTouch=null,this.bMoved=!1,this.onHeroBeKilledEvt=this.onHeroBeKilledEvtCb.bind(this),n.addListener("onHeroBeKilled",this.onHeroBeKilledEvt),this.onShakeScreenEvt=this.onShakeScreenEvtCb.bind(this),n.addListener("onShakeScreen",this.onShakeScreenEvt),this.onBattleTimeAddEvt=this.onBattleTimeAddEvtCb.bind(this),n.addListener("onBattleTimeAdd",this.onBattleTimeAddEvt),this.onHPChangedEvt=this.onHPChangedEvtCb.bind(this),n.addListener("onHPChanged",this.onHPChangedEvt),this.onMoralChangedEvt=this.onMoralChangedEvtCb.bind(this),n.addListener("onMoralChanged",this.onMoralChangedEvt),this.onBattleTalkEvt=this.onBattleTalkEvtCb.bind(this),n.addListener("onBattleTalk",this.onBattleTalkEvt),this.onGuideTeamSkillEvt=this.onGuideTeamSkillEvtCb.bind(this),n.addListener("onGuideTeamSkill",this.onGuideTeamSkillEvt),this.initAmtUi(),this.timeStarLeftTime=g.timeStar,this.ourLifePercent=1,this.initButtons(),12==g.type?(this.labBossHp.node.active=!0,this.updateBossHpPercent()):this.labBossHp.node.active=!1},updateBossHpPercent:function(){var e=a.getBossHpPercent()/10;this.labBossHp.string=e.toFixed(1)+"%"},initButtons:function(){var e=g.otrside.stageId,t=null==e||100<e;this.mBtnPause.active=t||100<e;var a=1;null!=cc.sys.localStorage.getItem(I.getUserId()+"gBtlSpeedLocal")&&(a=cc.sys.localStorage.getItem(I.getUserId()+"gBtlSpeedLocal"),a=parseInt(a)),this.gBtlSpeed=a,1<this.gBtlSpeed?(this.mBtnSpeedUpRate.node.active=!0,this.mBtnSpeedUpRate.spriteFrame=this.SpeedUpRateList[2==this.gBtlSpeed?0:1]):this.mBtnSpeedUpRate.node.active=!1,this.mBtnSpeedUp.active=t,this.btn_skip_guide.active=null!=e&&100==e},speedUpHanlder:function(e){if(g.btlState!=D._BTL_STATE.CHEER){var t=I.getUserLevel(),a=I.getUserGameVip();t<15&&a<2?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"X2 15 cấp hoặc là VIP2 mở ra ！"):(15<=t&&t<30&&a<3?2==this.gBtlSpeed?(MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"X4 VIP3 hoặc 30 cấp mở ra ！"),this.gBtlSpeed=1):1==this.gBtlSpeed&&(this.gBtlSpeed=2):(this.gBtlSpeed=2*this.gBtlSpeed,8==this.gBtlSpeed&&(this.gBtlSpeed=1)),cc.sys.localStorage.setItem(I.getUserId()+"gBtlSpeedLocal",this.gBtlSpeed)),cc.director.getScheduler().setTimeScale(this.gBtlSpeed),this.mBtnSpeedUpRate.node.active=1<this.gBtlSpeed,2==this.gBtlSpeed?this.mBtnSpeedUpRate.spriteFrame=this.SpeedUpRateList[0]:4==this.gBtlSpeed&&(MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"X4 khả năng làm cho tạp đốn, thỉnh cẩn thận lựa chọn ！"),this.mBtnSpeedUpRate.spriteFrame=this.SpeedUpRateList[1])}},initAmtUi:function(){null!=g.timeStar?(this.amtStarTime.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("action1",-1,-1,0,i),this.btl_time_label.node.x=6):this.amtStarTime.active=!1,null!=g.hpStar?(this.amtStarHP.x=290*(1-g.hpStar)-313.8,this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("action1",-1,-1,0,i)):this.amtStarHP.active=!1},addTeamSkillWidget:function(e,t){for(var a=this.nodeTeamSkillParent.children,n=0;n<a.length;++n){var i=a[n];i.setPosition(i.x-116,75)}
var r=cc.instantiate(this.teamSkillPrefab);r.setPosition(-75,75),r.parent=this.nodeTeamSkillParent,r.getComponent("TeamSkillUiManager").initUi(e,t),r.setContentSize(90,90),r.name="TS"+t,r.on("touchend",this.onTeamSkillClickHandler,this);var s=new cc.Component.EventHandler;return s.target=this.node,s.component="BattleUiMgr",s.handler="onTeamSkillClickHandler",r.getComponent(cc.Button).clickEvents[0]=s,r},onTeamSkillClickHandler:function(e){if(g.btlState!=D._BTL_STATE.CHEER){var t=e.target;cc.log("onTeamSkillClick --------------"+t),null==y.getInstance()._tsSelected&&(y.getInstance()._tsSelected={},y.getInstance()._tsSelected.effect=cc.instantiate(y.getInstance()._raw_assets["Prefab/battle/effects/gskill/tmSkillBorder"]),y.getInstance()._tsSelected.effect.name="tmSkillBorder"),y.getInstance()._tsSelected.cfg=t.getComponent("TeamSkillUiManager")._tsCfg;var a=m.getBattleLevel(y.getInstance()._tsSelected.cfg.id);if(y.getInstance()._tsSelected.level=a,y.getInstance()._tsSelected.node!=t){null!=y.getInstance()._tsSelected.node&&(y.getInstance()._tsSelected.node.stopAllActions(),y.getInstance()._tsSelected.node.scale=1),y.getInstance()._tsSelected.node=t,y.getInstance()._tsSelected.effect.scale=1,y.getInstance()._tsSelected.effect.parent=t,y.getInstance()._tsSelected.effect.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("action1",-1,-1,0,i),t.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.8,1.2),cc.scaleTo(.8,1))));var n=t.getComponent("TeamSkillUiManager").isMoralEnough();y.getInstance()._tsSelected.effect.active=n}}},onDestroy:function(){r.instance=null,n.removeListener("onHeroBeKilled",this.onHeroBeKilledEvt),n.removeListener("onShakeScreen",this.onShakeScreenEvt),n.removeListener("onBattleTimeAdd",this.onBattleTimeAddEvt),n.removeListener("onHPChanged",this.onHPChangedEvt),n.removeListener("onMoralChanged",this.onMoralChangedEvt),n.removeListener("onBattleTalk",this.onBattleTalkEvt),m.removeTmpTeamSkill()},registerFieldTouches:function(){this.bf_node.on("touchstart",this.BfClickStartHandler,this),this.bf_node.on("touchmove",this.BfClickMoveHandler,this),this.bf_node.on("touchend",this.CardClickEndHandler,this)},BfClickStartHandler:function(e){this.beganTouch=e.touch.getLocation(),this.lstTouch=this.beganTouch,this.bMoved=!1},BfClickMoveHandler:function(e){var t=e.touch.getLocation(),a=cc.pSub(t,this.lstTouch),n=cc.pDistance(t,this.beganTouch);this.bMoved=17<n;var i=cc.pAdd(cc.p(this.bf_node.getPosition()),a);i.x=Math.min((this.fieldSize.w*this.fieldScale-this.visibleScreen.width)/2,Math.max(i.x,-(this.fieldSize.w*this.fieldScale-this.visibleScreen.width)/2)),i.y=Math.min((this.fieldSize.h*this.fieldScale-this.visibleScreen.height)/2,Math.max(i.y,-(this.fieldSize.h*this.fieldScale-this.visibleScreen.height)/2)),this.bf_node.setPosition(i),this.visibleScreen.x=this.visibleScreen.x-a.x,this.visibleScreen.y=this.visibleScreen.y-a.y,this.lstTouch=t},CardClickEndHandler:function(e){if(!this.bMoved){var t=this.bf_node.convertTouchToNodeSpaceAR(e.touch||e.detail.touch);t.x=t.x+t.y/2,this.castTeamSkill(t)}},castTeamSkill:function(h,e){if(g.btlState==D._BTL_STATE.ING){var d,_=D._BTL_SIDE.OUR;null!=e?(_=D._BTL_SIDE.OTR,d=e):d=y.getInstance()._tsSelected;var t=!0;if(_==D._BTL_SIDE.OUR&&(t=y.getInstance().tsCallBack("Casted")),t){var u,m=100*Math.random()<=d.cfg.crit_rate,c=d.level,a=d.cfg.levels[c-1];u=m?cc.clone(a.crit_effect):cc.clone(a.effect);var n,l=a.range;a.dmg_static&&(n=m?a.dmg_static[1]:a.dmg_static[0]);var p=a.buffId,f=this,i=function(e){var n=function(){g.btlState==D._BTL_STATE.ING&&e()},i=function(){for(var e=0;e<u.length;e++){var t=u[e],a=S.createEffect();a.id=t.id,a.delayTime=t.delay,a.direction=_,d.cfg.id==D._BTL_TEAMSKILL.LS||d.cfg.id==D._BTL_TEAMSKILL.HC?a.callback=n:d.cfg.id==D._BTL_TEAMSKILL.FB?(a.direction=1,0==e&&(a.complete=n)):d.cfg.id==D._BTL_TEAMSKILL.LN&&0==e&&(a.complete=n),a.target=h,a.setFSM()}
M.playEffect(d.cfg.sound[0])};if(_==D._BTL_SIDE.OTR){var t=new cc.Node;t.addComponent(cc.Sprite).spriteFrame=f.enemyUseBlack_Spr;var a=new cc.Node;a.addComponent(cc.Sprite).spriteFrame=f.enemyUse_Spr;var r=new cc.Node;r.addComponent(cc.Sprite).spriteFrame=f.enemyUselight_Spr;var s=new cc.Node;s.addComponent(cc.Sprite).spriteFrame=f.skillIconList[d.cfg.id-1];var o=new cc.Node;o.addComponent(cc.Sprite).spriteFrame=f.tmIconlight_Spr;var c=new cc.Node;c.addComponent(cc.Sprite).spriteFrame=f.tmSkFrame_Spr,c.setCascadeOpacityEnabled(!0),c.addChild(s),c.setPosition(95,0),c.setScale(.6),t.addChild(c),o.setPosition(95,0),t.addChild(o),t.addChild(a),t.addChild(r),t.setCascadeOpacityEnabled(!0),t.setOpacity(0),t.setPosition(v.DESIGN_WIDTH/2-150,v.DESIGN_HEIGHT/2-130),f.node.addChild(t),t.runAction(cc.sequence(cc.spawn(cc.moveBy(.2,cc.p(-150,0)).easing(cc.easeIn(.2)),cc.fadeIn(.2)),cc.callFunc(function(){r.destroy(),o.destroy()}),cc.moveBy(1.5,cc.p(-16,0)),cc.spawn(cc.moveBy(.4,cc.p(90,0)).easing(cc.easeIn(.4)),cc.fadeOut(.4)),cc.removeSelf(),cc.callFunc(function(){g.btlState==D._BTL_STATE.ING&&(i(),this.destroy())},t)))}else if(_==D._BTL_SIDE.OUR&&m){g.pause();var l=cc.instantiate(f.chunHeiBg);f.node.addChild(l),l.runAction(cc.sequence(cc.fadeTo(.2,156),cc.callFunc(function(){var e,t=cc.instantiate(y.getInstance()._raw_assets["Prefab/battle/effects/tearScreen/tearScreenBg"]);e=I.getRoleID()%2==1?cc.instantiate(y.getInstance()._raw_assets["Prefab/battle/effects/tearScreen/tearScreenGentleman"]):cc.instantiate(y.getInstance()._raw_assets["Prefab/battle/effects/tearScreen/tearScreenLady"]),l.addChild(t),l.addChild(e),t.getComponent(sp.Skeleton).setAnimation(0,"Ready",!1),e.getComponent(sp.Skeleton).setAnimation(0,"Ready",!1),M.playEffect(d.cfg.sound[1]),e.getComponent(sp.Skeleton).setEventListener(function(e,t){if("shake"==t.data.name){var a=cc.instantiate(y.getInstance()._raw_assets["Prefab/battle/effects/tearScreen/tearSkillName"]);a.setScale(.8),l.addChild(a),a.getComponent(sp.Skeleton).setAnimation(0,cc.js.formatStr("action%d",d.cfg.id),!1);var n=new cc.Node;n.addComponent(cc.Sprite).spriteFrame=f.tearScreenMask,n.setScale(4.7),n.runAction(cc.fadeOut(.5)),l.addChild(n),l.runAction(cc.sequence(cc.delayTime(1.1),cc.fadeOut(.3),cc.removeSelf(),cc.callFunc(function(){g.resume(),i(),this.destroy()},l)))}})})))}else
i()},r=function(e,t){if(cc.pDistance(e.getPosition(),h)<l/2)
if(t)
e.reduceHP(n,{class:"TeamSkill"});else{var a=null!=e.treatment&&1<e.treatment?e.treatment:1;e.increaseHP(n*a)}};d.cfg.id==D._BTL_TEAMSKILL.LS?i(function(){var e;_==D._BTL_SIDE.OUR?e=g.otrside.armies:_==D._BTL_SIDE.OTR&&(e=g.ourside.armies);for(var t=0;t<e.length;t++){var a=e[t];a.hero&&"Dead"!=a.hero.getState()&&r(a.hero,!0);for(var n=0;n<a.soldiers.length;n++){var i=a.soldiers[n];i&&"Dead"!=i.getState()&&r(i,!0)}}}):d.cfg.id==D._BTL_TEAMSKILL.FB?i(function(){for(var a=C.getCfgById(p),e=function(e){var t=C.createBuff();t.id=p,t.cfg=a,t.target=e,t.setFSM(),e.buffs.push(t)},t=_==D._BTL_SIDE.OUR?g.otrside.armies:g.ourside.armies,n=0;n<t.length;n++){var i=t[n];i.hero&&"Dead"!=i.hero.getState()&&cc.pDistance(i.hero.getPosition(),h)<l/2&&e(i.hero);for(var r=0;r<i.soldiers.length;r++){var s=i.soldiers[r];s&&"Dead"!=s.getState()&&cc.pDistance(s.getPosition(),h)<l/2&&e(s)}}
if(1!=d.cfg.id&&3!=d.cfg.id&&4!=d.cfg.id){var o=g.createAmbushArmy(_,d.cfg,c,m);_==D._BTL_SIDE.OUR?(h.x=h.x-50,h.y=h.y-80):_==D._BTL_SIDE.OTR&&(h.x=h.x,h.y=h.y-75),o.add2Battle(h)}}):d.cfg.id==D._BTL_TEAMSKILL.LN?i(function(){if(1!=d.cfg.id&&2!=d.cfg.id&&4!=d.cfg.id){var e=g.createBallista(_,d.cfg,c,m);_==D._BTL_SIDE.OUR?(h.x=h.x-110,h.y=h.y-155):_==D._BTL_SIDE.OTR&&(h.x=h.x+80,h.y=h.y-195),e.add2Battle(h)}}):d.cfg.id==D._BTL_TEAMSKILL.HC&&i(function(){var e;_==D._BTL_SIDE.OUR?e=g.ourside.armies:_==D._BTL_SIDE.OTR&&(e=g.otrside.armies);for(var t=0;t<e.length;t++){var a=e[t];a.hero&&"Dead"!=a.hero.getState()&&r(a.hero,!1);for(var n=0;n<a.soldiers.length;n++){var i=a.soldiers[n];i&&"Dead"!=i.getState()&&r(i,!1)}}})}}},onHeroBeKilledEvtCb:function(e){var t,a,n,i,r=e[0],s=e[1],o=(e[2],e[3]),c=e[4];t=c?"beheaded":"wasbeheaded",s==D._BTL_SIDE.OUR?(a="left",c?(n=r,i=c):n=r):s==D._BTL_SIDE.OTR&&(a="right",c&&(n=c),i=r);var l=0,h=o*this.visibleScreen.height/this.fieldSize.h;s==D._BTL_SIDE.OUR?l=-this.visibleScreen.width/2+140:s==D._BTL_SIDE.OTR&&(l=this.visibleScreen.width/2-140);var d=S.createEffect();if(d.id=16040006,d.cfg={file:t,action:a,layer:7,scale:.7},d.target=cc.p(l,h),d.setFSM(),n){var _=new cc.Node,u=_.addComponent(cc.Label);u.string=n,u.fontSize=32,u.lineHeight=40,u.font=this.main_font,(m=_.addComponent(cc.LabelOutline)).color=cc.Color.WHITE,m.widht=1,_.color=new cc.Color(0,0,255),_.setAnchorPoint(1,.5),_.setPosition(-50,0),d.node.addChild(_)}
if(i){var m,p=new cc.Node,f=p.addComponent(cc.Label);f.string=i,f.fontSize=32,f.lineHeight=40,f.font=this.main_font,(m=p.addComponent(cc.LabelOutline)).color=cc.Color.WHITE,m.widht=1,p.color=new cc.Color(255,0,0),p.setAnchorPoint(0,.5),p.setPosition(50,0),d.node.addChild(p)}},onShakeScreenEvtCb:function(e){for(var t=[60,-50,40,-30,20,-10,0],a=(this.fieldSize.h*this.fieldScale-this.visibleScreen.height)/2-this.bf_node.y,n=-(this.fieldSize.h*this.fieldScale-this.visibleScreen.height)/2-this.bf_node.y,i=0;i<t.length;i++){var r=t[i];t[i]=Math.min(a,Math.max(n,r))}
var s=0,o=0;for(i=0;i<t.length;i++){r=t[i];s=Math.max(s,r),o=Math.min(o,r)}
for(i=t.length-1;1<=i;i--)
t[i]=t[i]-t[i-1];this.visibleScreen.y=this.visibleScreen.y-s,this.visibleScreen.height=this.visibleScreen.height+s-o;var c=cc.sequence(cc.moveBy(.05,cc.p(0,t[0])),cc.moveBy(.08,cc.p(0,t[1])),cc.moveBy(.1,cc.p(0,t[2])),cc.moveBy(.1,cc.p(0,t[3])),cc.moveBy(.1,cc.p(0,t[4])),cc.moveBy(.1,cc.p(0,t[5])),cc.moveBy(.1,cc.p(0,t[6])),cc.callFunc(function(){this.visibleScreen.y=this.visibleScreen.y+s,this.visibleScreen.height=this.visibleScreen.height-(s-o)},this));this.bf_node.runAction(c)},onBattlePauseEvtCb:function(e){if(g.btlState==D._BTL_STATE.ING){g.pause();var t=s("BattleSceneMgr"),a=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/battle_pause_panel"]);cc.Canvas.instance.node.addChild(a)}},onBattleTimeAddEvtCb:function(){if(null!=g.timeStar){if(this.timeStarLeftTime<=0)
return;var e=g.timeStar-Math.floor(g.getFightTime());if(10<this.timeStarLeftTime&&e<=10){this.amtStarTime.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("action4",-1,-1,0,i);var t=cc.repeat(cc.sequence(cc.scaleTo(.12,1.2),cc.scaleTo(.16,.95),cc.scaleTo(.72,1)),10);this.btl_time_label.node.runAction(t)}
if(0<this.timeStarLeftTime&&e<=0){this.amtStarTime.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("action2",-1,-1,0,i);var a=function e(t){this.amtStarTime.getComponent("dragonBones.ArmatureDisplay").removeEventListener(dragonBones.EventObject.COMPLETE,e,this),this.amtStarTime.getComponent("dragonBones.ArmatureDisplay").removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,e,this),this.amtStarTime.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("action3",-1,-1,0,i)};this.amtStarTime.getComponent("dragonBones.ArmatureDisplay").addEventListener(dragonBones.EventObject.LOOP_COMPLETE,a,this),this.amtStarTime.getComponent("dragonBones.ArmatureDisplay").addEventListener(dragonBones.EventObject.COMPLETE,a,this),this.timeStarLeftTime=0}else
this.timeStarLeftTime=e;this.dispTime(this.timeStarLeftTime)}else
this.dispTime(g.getFightTime())},dispTime:function(e){var t=Math.floor(e/60),a=Math.floor(e%60),n=v.pad(t,2)+":"+v.pad(a,2);this.btl_time_label.string=n},onHPChangedEvtCb:function(){if(y.getInstance()._update_count%5==0){var e=Math.floor(g.ourside.hps[0]/g.ourside.hps[1]*100)/100,t=g.otrside.hps[0]/g.otrside.hps[1];if(this.ourLifePercent>=g.hpStar&&e<g.hpStar){this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("action2",-1,-1,0,i);var a=function e(t){this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").removeEventListener(dragonBones.EventObject.COMPLETE,e,this),this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,e,this),this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("action3",-1,-1,0,i)};this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").addEventListener(dragonBones.EventObject.LOOP_COMPLETE,a,this),this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").addEventListener(dragonBones.EventObject.COMPLETE,a,this)}else if(this.ourLifePercent<g.hpStar&&e>=g.hpStar){this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("action4",-1,-1,0,i);var n=function e(t){this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").removeEventListener(dragonBones.EventObject.COMPLETE,e,this),this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,e,this),this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("action1",-1,-1,0,i)};this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").addEventListener(dragonBones.EventObject.LOOP_COMPLETE,n,this),this.amtStarHP.getComponent("dragonBones.ArmatureDisplay").addEventListener(dragonBones.EventObject.COMPLETE,n,this)}
this.ourLifePercent=e,this.sprLeftLB.scaleX=this.ourLifePercent<0?0:this.ourLifePercent,t=1<(t=t<0?0:t)?1:t,this.sprRightLB.scaleX=t}},onMoralChangedEvtCb:function(e){this.total_moral_label.string=Math.round(e);for(var t=this.nodeTeamSkillParent.children,a=0;a<t.length;++a){t[a].getComponent("TeamSkillUiManager").moralChange(e)}},onBattleTalkEvtCb:function(e){g.pause();var t=_(e,2),a=t[0],n=t[1],i=s("BattleSceneMgr"),r=cc.instantiate(i.getInstance()._raw_assets["Prefab/ui/battle/battle_talk_player"]);cc.Canvas.instance.node.addChild(r),r.getComponent("BattleTalkLayer").initData(a,function(e){"EVENT_TYPE_END"==e&&(g.resume(),n())})},onGuideTeamSkillEvtCb:function(e){for(var t,a,n,i=_(e,2),r=i[0],s=i[1],o={3:1,10:2,11:3,12:4},c=DonotDestroyManager.GameData.TeamSkills,l=0;l<c.items.length;l++){var h=c.items[l];if(h.id==o[r]){t=h,a=l;break}}
function d(){g.resume(),s()}
u.isStageIdPassed(t.unlock)?n=this.nodeTeamSkillParent.getChildByName("TS"+a):(m.unlockTeamSkill(a),m.tmpSkillIndex=a,n=this.addTeamSkillWidget(t,a),this.onMoralChangedEvtCb(30)),setTimeout(function(){g.pause(),p.showTeamSkillGuide("BattleLayer",n,d,[r-1,t.id])},50)},clickHanlder_finishGuideFight:function(e,t){cc.director.getScheduler().setTimeScale(1),g.destroy(),g.fightSE&&(M.stopEffect(g.fightSE),g.fightSE=null),MyBgMusicManager.stop(),M.stopAllEffects(),M.stopMusic(),g.successCB()}});cc._RF.pop()},{BattleConstants:"BattleConstants",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleTalkLayer:"BattleTalkLayer",BossBufferMgr:"BossBufferMgr",BuffsManager:"BuffsManager",EffectsManager:"EffectsManager",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",PlayerBufferMgr:"PlayerBufferMgr",SoundUtil:"SoundUtil",StageBufferMgr:"StageBufferMgr",TeamSkillBufferMgr:"TeamSkillBufferMgr"}],BattleUtil:[function(e,t,a){"use strict";cc._RF.push(t,"e6bfcwdyWVBkrlR2uAL9HKJ","BattleUtil");var c=e("BattleManager"),n=(e("GameUtils"),function(){});n.createBattlefield=function(e,t,a,n,i){if(c.initData(),c._initOurSide(e),c._initOtrSide(t),c.bgFile=a.background[0],c.type=a.type,c.otrTmSk=cc.clone(null!=a.teamAiCfg?a.teamAiCfg:{}),a.teamAiCfg&&a.teamAiCfg.pvp)
for(var r=DonotDestroyManager.GameData.TeamSkillsAI.pvp_teamskils_level[t.level-1],s=0;s<r.length;s++){var o=r[s];0==o&&(c.otrTmSk.value[s]=0),c.otrTmSk.skill_level[s]=o}
t.stars&&(2==t.stars[1][0]&&(c.timeStar=t.stars[1][1]),3==t.stars[2][0]&&(c.hpStar=t.stars[2][1]/100)),c.successCB=n,c.failureCB=i},n.enterRealScene=function(){MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),MyPersistDataManager._playerData._firstEnterHome=!1,cc.director.loadScene("battle"),MyUiManager.currentSceneName="battle"},t.exports=n,cc._RF.pop()},{BattleManager:"BattleManager",GameUtils:"GameUtils"}],BattleWidgets:[function(p,e,t){"use strict";cc._RF.push(e,"553c49Pd4dB2IzmCvkknOJa","BattleWidgets");var a=function(){this.word_pool=new cc.NodePool("word")};a.prototype.createFloatWords=function(e,t,a){var n,i,r=p("BattleSceneMgr").getInstance()._raw_assets["battle/battlewidgets"],s=new cc.Node,o=0;a=a||1;for(var c=(e=Math.floor(e)).toFixed(0),l=0;l<c.length;l++){var h,d=c[l],_=cc.js.formatStr(t,d),u=null;if(null==(h=this.word_pool.get()))
u=(h=new cc.Node).addComponent(cc.Sprite);else
h.opacity=255,u=h.getComponent(cc.Sprite);var m=r.getSpriteFrame(_);u.spriteFrame=m,h.setScale(a),n=m.getRect().width,i=m.getRect().height,n=1==a?n:n+1,h.setPosition(o,0),o+=n,s.addChild(h)}
return s.setContentSize(cc.size(o,i)),s.setCascadeOpacityEnabled(!0),s},a.prototype.reuseWord=function(e){for(var t=e.children.length-1;0<=t;t--)
this.word_pool.put(e.children[t])},a.prototype.resetData=function(){cc.log("word pool size:"+this.word_pool.size()),this.word_pool.clear()},e.exports=new a,cc._RF.pop()},{BattleSceneMgr:"BattleSceneMgr"}],BattleWinMgr:[function(o,e,t){"use strict";cc._RF.push(e,"0ef96NuLxhBYp+XokR/F41Q","BattleWinMgr");var i=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=(o("GameUtils"),o("UnLockCfgMgr")),r=o("HeroConfigMgr"),c=o("ColorUtil"),l=o("ShaderUtil"),h=o("SoundUtil"),n=o("GuideBufferMgr"),s=o("PlayerBufferMgr"),d=o("MarqueeBufferMgr"),_=o("StageBufferMgr");cc.Class({extends:cc.Component,properties:{m_pItemBoxPrefab:cc.Prefab,m_pRewardContent:cc.Node,userLevelLabel:cc.Label,userExpLabel:cc.Label,userCopperLabel:cc.Label,mHeroName:cc.Label,mKillEnemy:cc.Label,mShowDetailBtn:cc.Button,redText:cc.Label,yellowText:cc.Label},onLoad:function(){this.mStarBoxList=[],this.mStarBoxList.push(this.node.getChildByName("BlueStarFrame")),this.mStarBoxList.push(this.node.getChildByName("YellowStarFrame")),this.mStarBoxList.push(this.node.getChildByName("RedStarFrame")),this.mStarText=[],this.mStarText.push(this.node.getChildByName("BlueBottom").getChildByName("New Label")),this.mStarText.push(this.node.getChildByName("YellowBottom").getChildByName("New Label")),this.mStarText.push(this.node.getChildByName("RedBottom").getChildByName("New Label"))},ChangeData:function(e){var t=e.star||1,a=this.change2StateList(t),n=i(a,2);this.mStartStateList=n[0],this.mLastStar=n[1],this.userLevelLabel.string=MyPersistDataManager._playerData.level,this.userExpLabel.string="+"+(e.addexp||0),this.userCopperLabel.string="+"+(e.addGmoney||0),this.ShowReward(e.gain||e.rewards),this.loadStarsAction("load")},ShowReward:function(e){for(var t=0;t<e.length;++t){var a=cc.instantiate(this.m_pItemBoxPrefab);a.getComponent("ItemBox").ChangeItemInfo(e[t].item_template_id||e[t].template_id,e[t].item_count||e[t].num,!0,null,!0),this.m_pRewardContent.addChild(a)}},sequencePlay:function(){this.node.getComponent(cc.Animation).play("btlWinIn")},onAniInEnd:function(){var e=this;this.loadStarsAction("play",function(){e.node.getComponent(cc.Animation).play("btlWinOut")})},onAniOutEnd:function(){var e=_.getCurChapGroupStageId(),t=i(e,3);t[0],t[1];if(105==t[2]){var a=this;MyUiManager.Open(MyUiManager.PanelInfo.FirstPayPanel,{closeCb:function(){a.popupLevelUpAndUnlock()}})}else
this.popupLevelUpAndUnlock()},popupLevelUpAndUnlock:function(){if(s.isLevelUpAble()){var n=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/ui/mainhome/LevelUpLayer",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.node)){null!=n._shortMask_node&&(n._shortMask_node.destroy(),n._shortMask_node=null);var a=cc.instantiate(t);s.showLevelUpLayer(a,function(){n.showGuide()})}})}else
a.checkNewUnLockFunc(),this.showGuide()},setStarCfg:function(e){var t=function(e,t){return 2==e?t+" giây nội đạt được thắng lợi ":3==e?" huyết lượng tỉ lệ phần trăm lớn hơn "+t+"%":4==e?1==t?" vô anh hùng bỏ mình ":" bỏ mình anh hùng cái sổ nhỏ "+t:void 0};this.yellowText.string=t(e.stars[1][0],e.stars[1][1]),this.redText.string=t(e.stars[2][0],e.stars[2][1])},setStatistics:function(e,t,a){this.statistics={left:e,right:t,data:a};var n={damage:-1};a.teams.forEach(function(e,t){e.damage>n.damage&&"left"==e.data.hero.side&&(n=e)});var i=r.find(n.data.hero.id);this.mHeroName.string=i.name,this.mHeroName.node.color=c.getColorByQuality(i.quality),this.mKillEnemy.string=n.killHero,this.mShowDetailBtn.clickEvents[0].handler="BattleDetail_onClickHandler"},BattleDetail_onClickHandler:function(){var n=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/BattleDetailLayer/BattleDetailLayer",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.node)){null!=n._shortMask_node&&(n._shortMask_node.destroy(),n._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("BattleDetailLayer").ChangeData(n.statistics.data)}})},change2StateList:function(e){for(var t=[];0<e;)
t.push(!0),e--;for(var a=0,n=0;n<3;n++)
null==t[n]&&(t[n]=!1),1==t[n]&&(a=n);return[t,a]},loadStarsAction:function(e,n){var t=this.mStartStateList.length,a=o("BattleSceneMgr");if("load"!=e)
if("play"!=e);else{var i=0;for(r=0;r<t;r++)
1==this.mStartStateList[r]&&(0!=r&&(i=.2),r==this.mLastStar&&(i=.25),this.node.runAction(cc.sequence(cc.delayTime(i*(r+1)),cc.callFunc(function(e,t){var a=this.mStarBoxList[t].getChildByTag(t);a.getComponent(dragonBones.ArmatureDisplay).armature().animation.fadeIn("start",-1,-1,0,"normal"),a.getComponent(dragonBones.ArmatureDisplay).addEventListener(dragonBones.EventObject.COMPLETE,function(){cc.log("star animation finish!,keyIdx=%d",t),t==this.mLastStar?(h.playStarShowDownEffect(),null!=n&&(n(),n=null)):h.playStarShowupEffect()},this)},this,r))))}
else
for(var r=0;r<t;r++){var s=cc.instantiate(a.getInstance()._raw_assets["Prefab/effect/winstar"]);s.setScale(.8),s.setTag(r),this.mStarBoxList[r].addChild(s),s.getComponent(dragonBones.ArmatureDisplay).armature().animation.fadeIn("static",-1,-1,0,"normal"),!1===this.mStartStateList[r]&&(this.mStarText[r].color=c.getColorByIndex(5),l.setGaryShader(this.mStarBoxList[r]))}},jump2Hall:function(){MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),d.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"},showGuide:function(){n.showGuide("SuccessPanel",null)}}),cc._RF.pop()},{BattleSceneMgr:"BattleSceneMgr",ColorUtil:"ColorUtil",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",HeroConfigMgr:"HeroConfigMgr",MarqueeBufferMgr:"MarqueeBufferMgr",PlayerBufferMgr:"PlayerBufferMgr",ShaderUtil:"ShaderUtil",SoundUtil:"SoundUtil",StageBufferMgr:"StageBufferMgr",UnLockCfgMgr:"UnLockCfgMgr"}],BgMusicConfig:[function(e,t,a){"use strict";cc._RF.push(t,"7e431GGCGpBMbFqH0AqIIBc","BgMusicConfig");t.exports={hallmusic:"sound/zjm_01",perbattle:"sound/jzbz_15",battle:"sound/zdgc_03",recruit:"sound/UI_jg"},cc._RF.pop()},{}],BgMusicManager:[function(a,e,t){"use strict";cc._RF.push(e,"dce5dlLVFpDn597tm1UqnAa","BgMusicManager");a("BgMusicConfig");cc.Class({extends:cc.Component,properties:{_bgMusicId:-1,_oldAudioPath:cc.String,_soundVolumn:1},onLoad:function(){var e=.5;null!=cc.sys.localStorage.getItem("soundVolumn")&&(e=parseFloat(cc.sys.localStorage.getItem("soundVolumn"))),this._soundVolumn=e},play:function(e){this._oldAudioPath!=e&&(this._oldAudioPath=e,MyPersistDataManager._playerData.musicVolume&&(-1<this._bgMusicId&&cc.audioEngine.stop(this._bgMusicId),this._bgMusicId=cc.audioEngine.play(e,!0,this._soundVolumn)))},setSoundVolumn:function(e){this._soundVolumn=e,-1<this._bgMusicId&&cc.audioEngine.setVolume(this._bgMusicId,e)},stop:function(){-1<this._bgMusicId&&(cc.audioEngine.stop(this._bgMusicId),this._bgMusicId=-1),this._oldAudioPath=""},pause:function(){-1<this._bgMusicId&&cc.audioEngine.pause(this._bgMusicId)},resumePlay:function(){if(-1<this._bgMusicId)
cc.audioEngine.resume(this._bgMusicId);else{var e=a("MainHomeSceneManager").getInstance()._raw_assets.get("sound/zjm_01"),t=.5;null!=cc.sys.localStorage.getItem("soundVolumn")&&(t=parseFloat(cc.sys.localStorage.getItem("soundVolumn"))),this._bgMusicId=cc.audioEngine.play(e,!0,t)}},uncacheAll:function(){cc.audioEngine.uncacheAll()},stopAll:function(){cc.audioEngine.stopAll(),this._bgMusicId=-1}}),cc._RF.pop()},{BgMusicConfig:"BgMusicConfig",MainHomeSceneManager:"MainHomeSceneManager"}],BlackShop:[function(e,t,a){"use strict";cc._RF.push(t,"68b0b/ftxRFAYKtxEnJAWf0","BlackShop");var n=e("SoundUtil"),i=e("GameUtils"),r=e("MyProtocols"),s=e("NetEvent"),o=e("MyEventDispatcher"),c=e("MyUIEvent"),l=e("i18n");cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pYukedouNum:cc.Label,m_pShopItemPrefab:cc.Prefab,m_pItemParent:cc.Node,m_pTimeClock:cc.Label,m_pRefreshDes:cc.Label,m_pFeiZao:cc.Node,m_pGold:cc.Node,m_pRewardPanel:cc.Prefab,m_pPlayerMoney:cc.Label,_isTimeRunning:!1,_counttime:0,_timeCamp:0,_remainSeconds:0,_refreshState:0,_freetimes:0,_itemScriptList:[]},onLoad:function(){this.BlackMarketInfo_auth_cb_func=this.BlackMarketInfo_auth_cb.bind(this),o.addListener(s.S2CBlackMarketInfo,this.BlackMarketInfo_auth_cb_func),this.BlackMarketBuy_auth_cb_func=this.BlackMarketBuy_auth_cb.bind(this),o.addListener(s.S2CBlackMarketBuy,this.BlackMarketBuy_auth_cb_func),this.BlackMarketRefresh_auth_cb_func=this.BlackMarketRefresh_auth_cb.bind(this),o.addListener(s.S2CBlackMarketRefresh,this.BlackMarketRefresh_auth_cb_func),this.MoneyChange_auth_cb_func=this.MoneyChange_auth_cb.bind(this),o.addListener(c.onGoldChange,this.MoneyChange_auth_cb_func)},update:function(e){this._isTimeRunning&&(this._counttime+=e,1<=this._counttime&&(this._counttime-=1,this._remainSeconds--,this._remainSeconds<=-10?(this._isTimeRunning=!1,r.send_C2SBlackMarketRefresh(DonotDestroyManager._gameSocket)):this.CalculateTime()))},onDestroy:function(){o.removeListener(s.S2CBlackMarketInfo,this.BlackMarketInfo_auth_cb_func),o.removeListener(s.S2CBlackMarketBuy,this.BlackMarketBuy_auth_cb_func),o.removeListener(s.S2CBlackMarketRefresh,this.BlackMarketRefresh_auth_cb_func),o.removeListener(c.onGoldChange,this.MoneyChange_auth_cb_func),this._itemScriptList=[]},MoneyChange_auth_cb:function(e){this.m_pPlayerMoney.string=e},BlackMarketRefresh_auth_cb:function(){switch(this._refreshState){case 1:this.m_pRefreshDes.string=l.t("blackshop_003",{value:this._freetimes});break;case 2:this.m_pRefreshDes.string="x"+MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.BlackMarket.refresh_item[0]].num}
for(var e=0;e<this._itemScriptList.length;++e)
this._itemScriptList[e].m_pItemSellMask.active=!1,this._itemScriptList[e].m_pBuyBtn.enabled=!0},BlackMarketBuy_auth_cb:function(e){var t=[],a=e.gain;t.push({itemId:a.item_template_id,cnt:a.item_count});var n=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(n),n.getComponent("GetRewardPanel")._itemlist=t;var i=0;null!=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.BlackMarket.exchange_item]&&(i=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.BlackMarket.exchange_item].num),this.m_pYukedouNum.string=l.t("blackshop_001",{value:i});for(var r=0;r<this._itemScriptList.length;++r)
this._itemScriptList[r].BlackShopJudge();this._itemScriptList[e.slot_index].m_pItemSellMask.active=!0,this._itemScriptList[e.slot_index].m_pBuyBtn.enabled=!1},BlackMarketInfo_auth_cb:function(e){this._timeCamp=1e3*e.refreshTimestamp,0<Math.floor((1e3*e.refreshTimestamp-(new Date).getTime())/1e3)?this._remainSeconds=Math.floor((1e3*e.refreshTimestamp-(new Date).getTime())/1e3):this._remainSeconds=0,this.CalculateTime(),this._isTimeRunning=!0;var t=MyPersistDataManager._playerData.vip_level;this._freetimes=DonotDestroyManager.GameData.BlackMarket.free_refresh_times[t]-e.refreshTimes,this.m_pRefreshDes.node.color=new cc.Color(255,252,0),this.m_pFeiZao.active=!1,this.m_pGold.active=!1,0<this._freetimes?(this._refreshState=1,this.m_pRefreshDes.node.setPosition(110,231),this.m_pRefreshDes.string=l.t("blackshop_003",{value:this._freetimes})):null!=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.BlackMarket.refresh_item[0]]&&0<MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.BlackMarket.refresh_item[0]].num?(this._refreshState=2,this.m_pFeiZao.active=!0,this.m_pRefreshDes.node.setPosition(246,231),this.m_pRefreshDes.string="x"+MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.BlackMarket.refresh_item[0]].num):(this._refreshState=3,this.m_pGold.active=!0,this.m_pRefreshDes.node.setPosition(160,231),this.m_pRefreshDes.string=l.t("blackshop_004",{value:DonotDestroyManager.GameData.BlackMarket.refresh_money}));var a=e.items;this.SetBlackShopItem(a)},setParams:function(e){this.closeCb=e.closeCb,this.ScaleToLarge(),this.Init()},Init:function(){var e=0;null!=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.BlackMarket.exchange_item]&&(e=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.BlackMarket.exchange_item].num),this.m_pYukedouNum.string=l.t("blackshop_001",{value:e}),r.send_C2SBlackMarketInfo(DonotDestroyManager._gameSocket),this.m_pPlayerMoney.string=MyPersistDataManager._playerData.money},SetBlackShopItem:function(e){if(0==this._itemScriptList.length)
for(var t=0;t<e.length;++t){(n=(a=cc.instantiate(this.m_pShopItemPrefab)).getComponent("ShopItem"))._itemState=4,n.ChangeData(e[t].itemTemplateId,e[t].num,e[t].is_buy,e[t].price,t),this._itemScriptList.push(n),this.m_pItemParent.addChild(a)}
else
for(t=0;t<e.length;++t){var a,n;if(null==this._itemScriptList[t])
(n=(a=cc.instantiate(this.m_pShopItemPrefab)).getComponent("ShopItem"))._itemState=4,this._itemScriptList[t]=n;this._itemScriptList[t].ChangeData(e[t].itemTemplateId,e[t].num,e[t].is_buy,e[t].price,t)}},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},Refresh_onClickHandler:function(){n.playBtnOpenEffect(),r.send_C2SBlackMarketRefresh(DonotDestroyManager._gameSocket)},CalculateTime:function(){var e=Math.floor(this._remainSeconds/3600),t=Math.floor(this._remainSeconds%3600/60),a=this._remainSeconds%60;this.m_pTimeClock.string=i.pad(e,2)+":"+i.pad(t,2)+":"+i.pad(a,2)}}),cc._RF.pop()},{GameUtils:"GameUtils",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],BossBattleManager:[function(e,t,a){"use strict";cc._RF.push(t,"d7420kEToRFk6nG55rwXQ9Y","BossBattleManager");var g=e("BattleDataManager"),n=e("BattleUtil"),i=e("MyProtocols"),d=(e("ArenaBufferMgr"),e("PlayerBufferMgr")),_=e("HeroBufferMgr"),u=e("BattleBufferMgr"),r=e("MarqueeBufferMgr"),y=e("BossBufferMgr"),s=function(){this._dt_sum=0,this._boss_hurt=0};s.prototype.init=function(e,t,a){this._dt_sum=0,this._boss_hurt=0,this.leftData=this.getLeftData(),this.rightData=this.getRightData(e),this.leftData.fightVal=t,this.rightData.fightVal=a;var n=DonotDestroyManager.GameData.Boss;this.background=n.stage_mobs[e].battleground,this.mEmenyData=n},s.prototype.enterBattlefield=function(){var e=DonotDestroyManager.GameData.TeamSkillsAI,t={background:this.background,teamAiCfg:e[4],type:12},a=this;n.createBattlefield(this.leftData,this.rightData,t,function(){a.onSuccess()},function(){a.onFailure()}),n.enterRealScene()},s.prototype.onSuccess=function(){0<this._boss_hurt&&i.send_C2SBossHurt(DonotDestroyManager._gameSocket,this._boss_hurt,y.getR()),i.send_C2SBossView(DonotDestroyManager._gameSocket,y.getLevelIndex()),this._dt_sum=0,this._boss_hurt=0},s.prototype.onFailure=function(){MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),r.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"},s.prototype.getLeftData=function(){var e={side:"left"};e.name=d.getNickName(),e.level=d.getUserLevel();var t=u.getFormationData(102);e.formation=t.formationId,e.forward=t.forward,e.flip=t.flip;for(var a=g.create(e),n=Object.keys(t),i=0;i<n.length;++i){var r=n[i];if("fid"!=r&&"formationId"!=r&&"forward"!=r&&"flip"!=r&&"0"!=r){var s=t[r],o=_.getHeroByUid(s);o&&(delete o.hpPerc,y.isBuff()&&(o.atkPerc=130),a.addCardWithPosition(o,r))}}
for(var c=0;c<a.teams.length;c++){var l=a.teams[c],h=_.getExtraPropAttr(l.hero.heroId);l.hero.extraAttr=cc.clone(h)}
return a},s.prototype.getRightData=function(e){var t=DonotDestroyManager.GameData.Boss.boss_attrs[e],a=t.level,n=DonotDestroyManager.GameData.Boss.stage_mobs[e],i=n[1].mob_id,r=DonotDestroyManager.GameData.Cards[i],s={};s.name=r.name,s.side="right",s.level=a,s.formation=n.formation,s.forward=n.forward,s.flip=n.flip;var o=g.create(s);o.stageId=2001,o.stage_event=[],o.isMobHero=!0,o.stars=[[1,0],[2,60],[3,50]];for(var c=Object.keys(n),l=0;l<c.length;l++){var h=c[l];if("formation"!==h&&"forward"!==h&&"flip"!==h&&"battleground"!==h){var d=n[h];if(!DonotDestroyManager.GameData.Common.FIGHT_CONTROL_ENEMY[0]){var _={},u=t;if(_.hero={},_.hero.id=d.mob_id,_.hero.level=u.level,_.hero.grade=u.card_grade,d.skill_enable){_.hero.skill_enable=[];for(var m=0;m<d.skill_enable.length;m++){var p=d.skill_enable[m];_.hero.skill_enable.push(p)}}
u.add_attrs.rates&&(_.hero.rates_maxhp=u.add_attrs.rates.maxhp,_.hero.rates_atk=u.add_attrs.rates.atk,_.hero.rates_def=u.add_attrs.rates.def),u.add_attrs.statics&&(_.hero.static_maxhp=u.add_attrs.statics.maxhp,_.hero.static_atk=u.add_attrs.statics.atk,_.hero.static_def=u.add_attrs.statics.def),_.unit_num=u.unit_num,_.unit_grade=u.unit_grade,_.unit_level=u.unit_level;var f=y.getBossHpPercent()/10;_.hpPerc=f,o.addHeroWithPosition(_,d.position)}}}
return o},s.prototype.onUpdate=function(e){this._dt_sum+=e,1<=this._dt_sum&&(0<this._boss_hurt&&i.send_C2SBossHurt(DonotDestroyManager._gameSocket,this._boss_hurt,y.getR()),i.send_C2SBossView(DonotDestroyManager._gameSocket,y.getLevelIndex()),this._dt_sum=0,this._boss_hurt=0)},s.prototype.onBossHurt=function(e){e<=0||(this._boss_hurt+=e)},t.exports=new s,cc._RF.pop()},{ArenaBufferMgr:"ArenaBufferMgr",BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",BattleUtil:"BattleUtil",BossBufferMgr:"BossBufferMgr",HeroBufferMgr:"HeroBufferMgr",MarqueeBufferMgr:"MarqueeBufferMgr",MyProtocols:"MyProtocols",PlayerBufferMgr:"PlayerBufferMgr"}],BossBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"006b2A2cqJOMLzkfwzz0Qpa","BossBufferMgr");var n=function(){};n.prototype.initNetData=function(e){this._netData=e},n.prototype.updateNetData=function(e){this._netData.level_index=e.level_index,this._netData.my_level_index=e.my_level_index,this._netData.my_rank=e.my_rank,this._netData.my_damage_sum=e.my_damage_sum,this._netData.top_rank_list=e.top_rank_list,this._netData.boss_hp=e.boss_hp,this._netData.is_in_battle=e.is_in_battle,this._netData.battle_cd_time=e.battle_cd_time,this._netData.attack_count=e.attack_count,this._netData.damage_reward_get=e.damage_reward_get,this._netData.rank_reward_get=e.rank_reward_get,this._netData.is_buff=e.is_buff},n.prototype.getNetData=function(){return this._netData},n.prototype.getLevelIndex=function(){return this._netData.level_index},n.prototype.updateR=function(e){this.r=e},n.prototype.getR=function(){return this.r},n.prototype.getBossHpPercent=function(){return this._netData.boss_hp},n.prototype.getMyDamageSum=function(){return this._netData.level_index==this._netData.my_level_index?this._netData.my_damage_sum:0},n.prototype.getRewardGet=function(e){return 0==e?this._netData.damage_reward_get:this._netData.rank_reward_get},n.prototype.updateAwardGet=function(e){0==e?this._netData.damage_reward_get=!0:this._netData.rank_reward_get=!0},n.prototype.getRankRewards=function(e){return DonotDestroyManager.GameData.Boss.rank_rewards[this._netData.level_index]},n.prototype.isBuff=function(){return this._netData.is_buff},n.prototype.setIsBuff=function(){this._netData.is_buff=!0},n.prototype.getMyLevelIndex=function(){return null!=this._netData?this._netData.my_level_index:-1},t.exports=new n,cc._RF.pop()},{}],BossMainPanel:[function(e,t,a){"use strict";cc._RF.push(t,"2823eSjM+RKkonlxKfh44xp","BossMainPanel");var c=e("SoundUtil"),n=e("TimeUtil"),l=e("i18n"),i=e("MyProtocols"),r=e("MyEventDispatcher"),s=e("NetEvent"),h=e("BattleBufferMgr"),d=e("GameUtils"),_=e("BossBattleManager"),f=e("BossBufferMgr"),o=e("MyUIEvent");cc.Class({extends:cc.Component,properties:{lab_my_rank:cc.Label,lab_my_damage:cc.Label,lab_cd_time:cc.Label,lab_cd_title:cc.Label,lab_hp_percent:cc.Label,node_hp_percent:cc.Node,in_battle_nodes:[cc.Node],lab_try_count:cc.Label,btn_guwu:cc.Button,node_boss_root:cc.Node,lab_boss_name:cc.Label,node_elite_lock:cc.Node,nodes_tab:[cc.Node],sprite_tab_status:[cc.SpriteFrame],pre_rank_item:cc.Prefab,node_rank_parent:cc.Node,m_pRewardPanel:cc.Prefab,node_guwus:[cc.Node],node_arrow_guwu:cc.Node,_node_boss_model:cc.Node,_sum_time:0,_rank_item_pool:cc.NodePool,_last_level_index:-1},setParams:function(e){this.closeCb=e.closeCb},goBack:function(){c.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},onLoad:function(){this.S2CBossView_cb_func=this.S2CBossView_cb.bind(this),r.addListener(s.S2CBossView,this.S2CBossView_cb_func),this.S2CBossGetAward_cb_func=this.S2CBossGetAward_cb.bind(this),r.addListener(s.S2CBossGetAward,this.S2CBossGetAward_cb_func),this.PushBossBattleStatus_cb_func=this.PushBossBattleStatus_cb.bind(this),r.addListener(s.PushBossBattleStatus,this.PushBossBattleStatus_cb_func),this.S2CBossGuwu_cb_func=this.S2CBossGuwu_cb.bind(this),r.addListener(s.S2CBossGuwu,this.S2CBossGuwu_cb_func),this.ActivitiesBattleFormation_auth_cb_func=this.ActivitiesBattleFormation_auth_cb.bind(this),r.addListener(s.S2CActivitiesBattleFormation,this.ActivitiesBattleFormation_auth_cb_func),this._rank_item_pool=new cc.NodePool("RankItem"),this._last_level_index=-1},onDestroy:function(){r.removeListener(s.S2CBossView,this.S2CBossView_cb_func),r.removeListener(s.S2CBossGetAward,this.S2CBossGetAward_cb_func),r.removeListener(s.PushBossBattleStatus,this.PushBossBattleStatus_cb_func),r.removeListener(s.S2CActivitiesBattleFormation,this.ActivitiesBattleFormation_auth_cb_func),r.removeListener(s.S2CBossGuwu,this.S2CBossGuwu_cb_func),this._rank_item_pool.clear()},S2CBossGuwu_cb:function(e){f.setIsBuff(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," ngài tác chiến bộ đội ủng hộ thành công, chắc chắn đánh đâu thắng đó không gì cản nổi ！");for(var t=0;t<this.node_guwus.length;t++){this.node_guwus[t].color=cc.Color.WHITE}
this.node_arrow_guwu.active=!0},PushBossBattleStatus_cb:function(e){i.send_C2SBossView(DonotDestroyManager._gameSocket,f.getLevelIndex())},S2CBossGetAward_cb:function(e){if(f.updateAwardGet(e.type),null!=e.rewards&&0<e.rewards.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.rewards}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," thưởng cho Nhận thành công");r.dispatchEvent(o.onBossRewardGet,e.type)},ActivitiesBattleFormation_auth_cb:function(e){null!=e.formation&&h.setFormationData(e.formation.fid,e.formation)},S2CBossView_cb:function(e){f.updateNetData(e),this.isValid&&this.refreshUI()},start:function(){MyPersistDataManager._playerData.level<DonotDestroyManager.GameData.Boss.elite_level?this.node_elite_lock.active=!0:this.node_elite_lock.active=!1,this.refreshUI();h.isHasFidFormation(102)||i.send_C2SActivitiesBattleFormation(DonotDestroyManager._gameSocket,102)},refreshUI:function(){this.setTabSelected(f.getNetData().level_index),this.lab_my_damage.string=f.getMyDamageSum(),-1<f.getNetData().my_rank?this.lab_my_rank.string=" đệ "+(f.getNetData().my_rank+1)+" danh ":this.lab_my_rank.string=" chưa thượng bảng ",this.updateCdTimeStr();var e=f.getBossHpPercent()/10;if(e=0<e&&e<100?e.toFixed(1):parseInt(e),this.lab_hp_percent.string=e+"%",this.node_hp_percent.width=f.getNetData().boss_hp/1e3*223,this.lab_try_count.string=f.getNetData().attack_count,f.getNetData().is_in_battle)
for(var t=0;t<this.in_battle_nodes.length;t++){this.in_battle_nodes[t].active=!0}
else
for(var a=0;a<this.in_battle_nodes.length;a++){this.in_battle_nodes[a].active=!1}
if(this._last_level_index!=f.getNetData().level_index){var n=f.getNetData().level_index,i=DonotDestroyManager.GameData.Boss.stage_mobs[n][1].mob_id,r=DonotDestroyManager.GameData.Boss.boss_attrs[n],s=DonotDestroyManager.GameData.Cards[i];this.lab_boss_name.string=s.name;var o=this;cc.loader.loadRes("Prefab/Heros/"+s.icon,cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load heroprefab success!"),cc.isValid(o.node)){null!=o._node_boss_model&&o._node_boss_model.destroy();var a=cc.instantiate(t);o.node_boss_root.addChild(a),a.setScale(r.scale),a.setPosition(r.pos[0],r.pos[1]),a.getComponent(sp.Skeleton).setAnimation(0,"skill1",!1),a.getComponent(sp.Skeleton).addAnimation(0,"stand",!0,0),o._node_boss_model=a}}),this.node_rank_parent.height=300}
for(var c=this.node_rank_parent.children,l=c.length-1;0<=l;l--)
this._rank_item_pool.put(c[l]);for(var h=0;h<f.getNetData().top_rank_list.length;h++){var d=f.getNetData().top_rank_list[h],_=this._rank_item_pool.get();null==_&&(_=cc.instantiate(this.pre_rank_item)),this.node_rank_parent.addChild(_),_.getComponent("BossRankItem").setParams(h,d)}
if(this._last_level_index=f.getNetData().level_index,f.getNetData().is_in_battle?this.lab_cd_title.string=" khoảng cách BOSS chấm dứt thời gian ：":this.lab_cd_title.string=" khoảng cách BOSS đến đến lúc ：",f.getNetData().is_in_battle)
if(this.btn_guwu.interactable=!0,f.getNetData().is_buff){for(var u=0;u<this.node_guwus.length;u++){this.node_guwus[u].color=cc.Color.WHITE}
this.node_arrow_guwu.active=!0}else{for(var m=0;m<this.node_guwus.length;m++){this.node_guwus[m].color=cc.Color.GRAY}
this.node_arrow_guwu.active=!1}
else{this.btn_guwu.interactable=!1;for(var p=0;p<this.node_guwus.length;p++){this.node_guwus[p].color=cc.Color.GRAY}
this.node_arrow_guwu.active=!1}},setTabSelected:function(e){for(var t=0;t<this.nodes_tab.length;t++){var a=this.nodes_tab[t];a.getChildByName("tabNormal").getComponent(cc.Sprite).spriteFrame=t==e?this.sprite_tab_status[1]:this.sprite_tab_status[0]}},update:function(e){this._sum_time+=e,1<=this._sum_time&&(f.getNetData().battle_cd_time--,f.getNetData().battle_cd_time=f.getNetData().battle_cd_time<0?0:f.getNetData().battle_cd_time,this.updateCdTimeStr(),f.getNetData().is_in_battle&&i.send_C2SBossView(DonotDestroyManager._gameSocket,f.getNetData().level_index),this._sum_time=0)},updateCdTimeStr:function(){var e=f.getNetData().battle_cd_time,t=n.secondToTime(e);this.lab_cd_time.string=t},clickHandler_battle:function(e,t){if(c.playBtnOpenEffect(),f.getNetData().is_in_battle)
if(-1<f.getNetData().my_level_index&&f.getNetData().level_index!=f.getNetData().my_level_index)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),l.t("boss004"),1e3);else if(f.getNetData().attack_count<=0)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),l.t("boss002"),1e3);else{if(!h.isHasFidFormation(102)){var a=h.getFormationData(1),n=d.clone(a);h.setFormationData(102,n)}
var i=f.getNetData().level_index,r=DonotDestroyManager.GameData.Boss.stage_mobs[i][1].mob_id,s=DonotDestroyManager.GameData.Cards[r],o={name:"LV"+DonotDestroyManager.GameData.Boss.boss_attrs[f.getNetData().level_index].level+"."+s.name,fight:0,formation:DonotDestroyManager.GameData.Boss.stage_mobs[f.getNetData().level_index].formation,flip:DonotDestroyManager.GameData.Boss.stage_mobs[f.getNetData().level_index].flip,forward:DonotDestroyManager.GameData.Boss.stage_mobs[f.getNetData().level_index].forward,Teams:this.GetEnemyTeams(),id:0};_.init(i),o.teams=_.rightData.teams,MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:o,panelinfo:{energy_cost:0,fid:102},battletype:12})}
else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),l.t("boss001"),1e3)},GetEnemyTeams:function(){for(var e=DonotDestroyManager.GameData.Boss.stage_mobs[f.getNetData().level_index],t=1,a=[];null!=e[t];){var n={};n.id=e[t].mob_id,n.level=DonotDestroyManager.GameData.Boss.boss_attrs[f.getNetData().level_index].level,n.position=e[t].position,a.push(n),++t}
return a},clickHandler_rewards:function(e,t){c.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.BossRewardPanel,{})},clickHandler_guwu:function(e,t){c.playBtnOpenEffect(),i.send_C2SBossGuwu(DonotDestroyManager._gameSocket,f.getLevelIndex())},clickHandler_tab:function(e,t){c.playBtnOpenEffect();var a=parseInt(t);f.getNetData().level_index!=a&&(1==a&&MyPersistDataManager._playerData.level<DonotDestroyManager.GameData.Boss.elite_level?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),l.t("boss003",{level:DonotDestroyManager.GameData.Boss.elite_level}),1e3):i.send_C2SBossView(DonotDestroyManager._gameSocket,a))}}),cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",BossBattleManager:"BossBattleManager",BossBufferMgr:"BossBufferMgr",GameUtils:"GameUtils",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",TimeUtil:"TimeUtil",i18n:"i18n"}],BossRankItem:[function(e,t,a){"use strict";cc._RF.push(t,"dcf316sFmRKzbybvGYs0pbi","BossRankItem"),cc.Class({extends:cc.Component,properties:{spr_rank_number:cc.Sprite,lab_rank_number:cc.Label,lab_name:cc.Label,lab_hurt_value:cc.Label,res_top_rank:[cc.SpriteFrame]},setParams:function(e,t){e<=2?(this.spr_rank_number.node.active=!0,this.lab_rank_number.node.active=!1,this.spr_rank_number.spriteFrame=this.res_top_rank[e]):(this.spr_rank_number.node.active=!1,this.lab_rank_number.node.active=!0,this.lab_rank_number.string=e+1),this.lab_name.string="Lv"+t.level+"."+t.nickname,this.lab_hurt_value.string=t.damage_val},start:function(){}}),cc._RF.pop()},{}],BossRewardItem1:[function(e,t,a){"use strict";cc._RF.push(t,"50009rFVUBDRbFCLcrzwKnu","BossRewardItem1");var r=e("BossBufferMgr");cc.Class({extends:cc.Component,properties:{node_item_parent:cc.Node,lab_damage_sum:cc.Label,lab_damage_percent:cc.Label,node_damage_percent:cc.Node,btn_get:cc.Button,pre_item_box:cc.Prefab},changeData:function(e){this.lab_damage_sum.string=" tích lũy thương tổn ："+e.damage_val;var t=100*r.getMyDamageSum()/e.damage_val;t=0<(t=100<(t=t<0?0:t)?100:t)&&t<100?t.toFixed(1):parseInt(t),this.lab_damage_percent.string=t+"%",this.node_damage_percent.width=223*t/100;for(var a=0;a<e.rewards.length;a++){var n=e.rewards[a],i=cc.instantiate(this.pre_item_box);i.setScale(.8),i.width=80,i.height=80,this.node_item_parent.addChild(i),i.getComponent("ItemBox").ChangeItemInfo(n[0],n[1],!0,null,!0)}},start:function(){}}),cc._RF.pop()},{BossBufferMgr:"BossBufferMgr"}],BossRewardPanel:[function(e,t,a){"use strict";cc._RF.push(t,"4dfb6tGJaBBGKZThSs2iU4e","BossRewardPanel");var n=e("SoundUtil"),_=e("BossBufferMgr"),i=e("MyUIEvent"),r=e("MyEventDispatcher"),s=e("MyProtocols");cc.Class({extends:cc.Component,properties:{nodes_tab:[cc.Node],sprite_tab_status:[cc.SpriteFrame],node_tabs:[cc.Node],reward_parent:[cc.Node],mScrollView:[cc.ScrollView],pre_damage_reward_item:cc.Prefab,pre_rank_reward_item:cc.Prefab,lab_my_damage:cc.Label,lab_my_rank:cc.Label,btn_progress_get_award:cc.Button,btn_rank_get_award:cc.Button,_selected_tab:0,_is_init:[cc.Boolean]},onLoad:function(){this._selected_tab=0,this._is_init=[!1,!1],this.S2CBossGetAward_cb_func=this.S2CBossGetAward_cb.bind(this),r.addListener(i.onBossRewardGet,this.S2CBossGetAward_cb_func)},onDestroy:function(){r.removeListener(i.onBossRewardGet,this.S2CBossGetAward_cb_func)},S2CBossGetAward_cb:function(e){0==e?this.btn_progress_get_award.interactable=!1:this.btn_rank_get_award.interactable=!1},setParams:function(e){},goBack:function(){n.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},start:function(){this.refreshUI()},refreshUI:function(){this.setTabSelected(this._selected_tab),this.showList(this._selected_tab)},showList:function(e){for(var t=0;t<this.node_tabs.length;t++){var a=this.node_tabs[t];a.active=t==e}
if(this._is_init[e])
this.mScrollView[e].scrollToTop();else{switch(e){case 0:var n=_.getMyDamageSum();this.lab_my_damage.string=n;var i=_.getRewardGet(e),r=DonotDestroyManager.GameData.Boss.damage_rewards;!i&&n>=r[0].damage_val?this.btn_progress_get_award.interactable=!0:this.btn_progress_get_award.interactable=!1;for(var s=r.length-1;0<=s;s--){var o=r[s],c=cc.instantiate(this.pre_damage_reward_item);this.reward_parent[e].addChild(c),c.getComponent("BossRewardItem1").changeData(o)}
break;case 1:n=_.getMyDamageSum(),!(i=_.getRewardGet(e))&&0<n&&_.getNetData().level_index==_.getNetData().my_level_index?this.btn_rank_get_award.interactable=!0:this.btn_rank_get_award.interactable=!1,-1<_.getNetData().my_rank?this.lab_my_rank.string=" đệ "+(_.getNetData().my_rank+1)+" danh ":this.lab_my_rank.string=" chưa thượng bảng ";for(var l=_.getRankRewards(),h=0;h<l.length;h++){var d=cc.instantiate(this.pre_rank_reward_item);this.reward_parent[e].addChild(d),d.getComponent("BossRewardRankItem").changeData(h)}}
this._is_init[e]=!0}},setTabSelected:function(e){for(var t=0;t<this.nodes_tab.length;t++){var a=this.nodes_tab[t];a.getChildByName("tabNormal").getComponent(cc.Sprite).spriteFrame=t==e?this.sprite_tab_status[1]:this.sprite_tab_status[0]}},clickHandler_tab:function(e,t){n.playBtnOpenEffect();var a=parseInt(t);this._selected_tab!=a&&(this._selected_tab=a,this.refreshUI())},clickHanlder_getReward:function(e,t){var a=parseInt(t);s.send_C2SBossGetAward(DonotDestroyManager._gameSocket,a)}}),cc._RF.pop()},{BossBufferMgr:"BossBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],BossRewardRankItem:[function(e,t,a){"use strict";cc._RF.push(t,"7b52d6Gob1BDpbEPBLU8d0O","BossRewardRankItem");var c=e("BossBufferMgr");cc.Class({extends:cc.Component,properties:{lab_rank:cc.Label,node_item_parent:cc.Node,pre_item_box:cc.Prefab},changeData:function(e){var t=c.getRankRewards(),a=t[e],n="";if(0<e){var i=t[e-1];n=i.rank_pos+1==a.rank_pos?" đệ "+a.rank_pos+" danh ":" đệ "+(i.rank_pos+1)+"-"+a.rank_pos+" danh "}else
n=" đệ "+a.rank_pos+" danh ";this.lab_rank.string=n;for(var r=0;r<a.rewards.length;r++){var s=a.rewards[r],o=cc.instantiate(this.pre_item_box);o.setScale(.8),o.width=80,o.height=80,this.node_item_parent.addChild(o),o.getComponent("ItemBox").ChangeItemInfo(s[0],s[1],!0,null,!0)}},start:function(){}}),cc._RF.pop()},{BossBufferMgr:"BossBufferMgr"}],BuffsManager:[function(t,e,a){"use strict";cc._RF.push(e,"9a886RjAA1IqIzMm/KX71gX","BuffsManager");var n=t("BattleConstants"),i=function(){this.buffActors=[]};i.prototype.resetData=function(){this.buffActors=[]},i.prototype.createBuff=function(){var e=new(t("Buff"));return this.buffActors.push(e),e},i.prototype.getCfgById=function(e){return DonotDestroyManager.GameData.Buffs[e]},i.prototype.removeBuff=function(e){for(var t=0;t<this.buffActors.length;t++){if(this.buffActors[t]==e){this.buffActors.splice(t,1);break}}},i.prototype.isTargetAble=function(e,t,a){return a==n._BUFF_TARGET.OurUnit?t.side()==e.side():a==n._BUFF_TARGET.OurHero?t.side()==e.side()&&"Hero"==t.class:a==n._BUFF_TARGET.OtrUnit?t.side()!=e.side():a==n._BUFF_TARGET.OtrHero?t.side()!=e.side()&&"Hero"==t.class:void 0},i.prototype.onUpdate=function(e){for(var t=0;t<this.buffActors.length;t++){this.buffActors[t].onUpdate(e)}},e.exports=new i,cc._RF.pop()},{BattleConstants:"BattleConstants",Buff:"Buff"}],Buff:[function(i,e,t){"use strict";cc._RF.push(e,"65b93JtrAlAlb0eYK2vvO8P","Buff");var r=i("BattleConstants"),a=i("BuffsManager"),n=i("state-machine"),s=cc.Class({extends:i("WActor"),properties:{_add_atk:0,_add_def:0,_add_speed:0,_add_dodge:0,_add_crit:0,_add_crit_damage:0,_add_anti_debuff:0},ctor:function(){cc.log("Buff create!"),this.id=0,this.cfg={},this.origin=null,this.target=null,this.effects=[],this.remainT=0,this.addhp=0,this.addhpT=0,this.stunCB=null,this.frozenCB=null},setFSM:function(){var i=this;this.fsm=n.create({initial:"Init",events:[{name:"Active",from:"Init",to:"Display"},{name:"End",from:"Display",to:"Complete"},{name:"Cancel",from:"*",to:"Complete"}],callbacks:{onenterstate:function(e,t,a){},onenterStart:function(e,t,a,n){i.onenterStart(e,t,a,n)},onafterActive:function(e,t,a,n){i.onafterActive()},onafterResume:function(e,t,a,n){i.onafterResume()},onafterDead:function(){i.onafterDead()},onenterInit:function(){i.onenterInit()},onenterComplete:function(){i.onenterComplete()},onafterEnd:function(){i.onafterEnd()},onafterCancel:function(){i.onafterCancel()}}})},addEffects:function(){if((this.cfg.buff_type!=r._BUFF_TYPE.Stun||this.stunCB)&&this.cfg.effect)
for(var e=i("EffectsManager"),t=0;t<this.cfg.effect.length;t++){var a=this.cfg.effect[t],n=e.createEffect();n.id=a[0],n.delayTime=a[1],n.direction=this.target.getOrient(),n.target=this.target,n.setFSM(),this.effects.push(n)}},onafterActive:function(){this.doAddon();var e=!1;(11==this.cfg.buff_type||this.cfg.buff_type==r._BUFF_TYPE.Stun||this.cfg.buff_type==r._BUFF_TYPE.Frozen||this._add_atk<0||this._add_def<0||this._add_speed<0||this._add_dodge<0||this._add_crit<0||this._add_crit_damage<0||this._add_anti_debuff<0||null!=this.cfg.hp&&this.cfg.hp[0]<0||null!=this.cfg.anger&&this.cfg.anger<0)&&(e=!0),e&&null!=this.target&&"Hero"==this.target.class&&0<this.target.anti_debuff&&Math.random()<this.target.anti_debuff?this.remainT=.2:(this.cfg.buff_type==r._BUFF_TYPE.Stun?this.stunCB=this.target.stun(this.cfg.targetanim):this.cfg.buff_type==r._BUFF_TYPE.Frozen&&(this.frozenCB=this.target.frozen()),e&&null!=this.target&&"Hero"==this.target.class&&0<this.target.reduce_debuff&&(this.remainT*=1-this.target.reduce_debuff,this.remainT=this.remainT<=.1?.1:this.remainT))},doAddon:function(){if(this.cfg.atk){var e=this.target.atk;this.target.atk=Math.max(this.target.atk+this.target.baseatk*this.cfg.atk/100,1),this._add_atk+=this.target.atk-e}
if(this.cfg.def){var t=this.target.def;this.target.def=Math.max(this.target.def+this.target.basedef*this.cfg.def/100,1),this._add_def+=this.target.def-t}
if(this.cfg.speedup){var a=this.target.speedup;this.target.speedup=Math.max(this.target.speedup+this.cfg.speedup/100,0),this._add_speed+=this.target.speedup-a}
if(this.cfg.dodge){var n=this.target.dodge;this.target.dodge=Math.max(this.target.dodge+this.cfg.dodge,0),this._add_dodge+=this.target.dodge-n}
if(this.cfg.crit){var i=this.target.crit;this.target.crit=Math.max(this.target.crit+this.cfg.crit,0),this._add_crit+=this.target.crit-i}
if(this.cfg.critD){var r=this.target.critD;this.target.critD=Math.max(this.target.critD+this.cfg.critD,0),this._add_crit_damage+=this.target.critD-r}
if(this.cfg.anti_debuff){var s=this.target.anti_debuff;this.target.anti_debuff=Math.max(this.target.anti_debuff+this.cfg.anti_debuff/100,0),this._add_anti_debuff+=this.target.anti_debuff-s}
1==this.cfg.dmg_free&&(this.target.buff_dmg_free=!0)},onenterInit:function(){this.remainT=this.cfg.last_time,this.cfg.hp&&(this.addhp=this.cfg.hp[0],this.addhpT=this.cfg.hp[1]);var e=this;setTimeout(function(){e.doEvent("Active"),e.addEffects()},10),this._add_atk=0,this._add_def=0,this._add_speed=0,this._add_dodge=0,this._add_crit=0,this._add_crit_damage=0,this._add_anti_debuff=0},onafterEnd:function(){for(var e=0;e<this.effects.length;e++){this.effects[e].doEvent("End")}
this.stunCB&&this.stunCB(),this.frozenCB&&this.frozenCB()},onafterCancel:function(){for(var e=0;e<this.effects.length;e++){this.effects[e].doEvent("Cancel")}
this.stunCB=null,this.frozenCB=null},onenterComplete:function(){a.removeBuff(this),0!=this._add_atk&&(this.target.atk=this.target.atk-this._add_atk,this._add_atk=0),0!=this._add_def&&(this.target.def=this.target.def-this._add_def,this._add_def=0),0!=this._add_speed&&(this.target.speedup=this.target.speedup-this._add_speed,this._add_speed=0),0!=this._add_dodge&&(this.target.dodge=this.target.dodge-this._add_dodge,this._add_dodge=0),0!=this._add_crit&&(this.target.crit=this.target.crit-this._add_crit,this._add_crit=0),0!=this._add_crit_damage&&(this.target.critD=this.target.critD-this._add_crit_damage,this._add_crit_damage=0),0!=this._add_anti_debuff&&(this.target.anti_debuff=this.target.anti_debuff-this._add_anti_debuff,this._add_anti_debuff=0),1==this.cfg.dmg_free&&(this.target.buff_dmg_free=!1)},onUpdate:function(e){"Display"==this.getState()&&0<=this.remainT&&(this.remainT=this.remainT-e,0<this.addhpT&&(this.addhpT=this.addhpT-e,this.addhpT<=0&&(this.addhpT=this.cfg.hp[1],this.target.buffDamage(this.origin,this.addhp))),this.remainT<0&&this.doEvent("End"))}});e.exports=s,cc._RF.pop()},{BattleConstants:"BattleConstants",BuffsManager:"BuffsManager",EffectsManager:"EffectsManager",WActor:"WActor","state-machine":"state-machine"}],BuyEnergy:[function(n,e,t){"use strict";cc._RF.push(e,"073e9UTRH1M37Dw+tPDQxSh","BuyEnergy");var i=n("SoundUtil"),a=n("MyProtocols"),r=n("NetEvent"),s=n("MyEventDispatcher"),o=(n("GameUtils"),n("i18n")),c=cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,buyTimes:cc.Label,goldNum:cc.Label,energyNum:cc.Label,showDialogPrefab:cc.Prefab,itemContent:cc.Node,btnClick:cc.Button,btnName:cc.Label,desState:[cc.Node],_dialogList:[],_useGold:0},statics:{instance:null,getInstance:function(){return c.instance}},onLoad:function(){(c.instance=this).PaymentGetInfo_auth_cb_func=this.PaymentGetInfo_auth_cb.bind(this),s.addListener(r.S2CPaymentGetInfo,this.PaymentGetInfo_auth_cb_func),this.PaymentBuyEnergy_auth_cb_func=this.PaymentBuyEnergy_auth_cb.bind(this),s.addListener(r.S2CPaymentBuyEnergy,this.PaymentBuyEnergy_auth_cb_func)},onDestroy:function(){s.removeListener(r.S2CPaymentGetInfo,this.PaymentGetInfo_auth_cb_func),s.removeListener(r.S2CPaymentBuyEnergy,this.PaymentBuyEnergy_auth_cb_func),this._dialogList=[],c.instance=null},PaymentGetInfo_auth_cb:function(e){MyPersistDataManager._playerData.gamemoneyTimes=e.gamemoneyTimes,MyPersistDataManager._playerData.energyTimes=e.energyTimes,this.Init()},PaymentBuyEnergy_auth_cb:function(e){var t={useGold:this._useGold,getItem:100,multiple:1};this._dialogList.unshift(t),this.SetDialogItem(),MyPersistDataManager._playerData.energyTimes=e.energyTimes,this.Init()},setParams:function(e){this.closeCb=e.closeCb,this.ScaleToLarge(),0==MyPersistDataManager._playerData.energyTimes?a.send_C2SPaymentGetInfo(DonotDestroyManager._gameSocket):this.Init()},Init:function(){var e=MyPersistDataManager._playerData.energyTimes,t=MyPersistDataManager._playerData.money,a=MyPersistDataManager._playerData.vip_level;13<a&&(a=13);MyPersistDataManager._playerData.level;var n=DonotDestroyManager.GameData.Payment.energy.times[a],i=Math.round(n-e);this.buyTimes.string=o.t("headtabpanel_001",{value1:i,value2:n});var r=this.btnClick.clickEvents[0];0<i?(this.goldNum.node.active=!0,this.energyNum.node.active=!0,this.desState[0].active=!0,this.desState[1].active=!1,this.goldNum.string=DonotDestroyManager.GameData.Payment.energy.details[e][0],this._useGold=DonotDestroyManager.GameData.Payment.energy.details[e][0],this.energyNum.string=DonotDestroyManager.GameData.Payment.energy.details[e][1],r.handler="Buy_onClickHandler",this.btnClick.clickEvents[0]=r,this.btnName.string=o.t("headtabpanel_003")):(this.goldNum.node.active=!1,this.energyNum.node.active=!1,this.desState[0].active=!1,this.desState[1].active=!0,r.handler="GoToPay_onClickHandler",this.btnClick.clickEvents[0]=r,this.btnName.string=o.t("headtabpanel_004")),t<this._useGold?this.goldNum.node.color=new cc.Color(252,0,0):this.goldNum.node.color=cc.Color.WHITE},SetDialogItem:function(){0!=this._dialogList.length&&this.itemContent.getComponent("UIWarp").initContent(this._dialogList.length)},Back_onClickHandler:function(){i.playBtnCloseEffect(),MyUiManager.Back()},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Buy_onClickHandler:function(e,t){i.playBtnOpenEffect(),MyPersistDataManager._playerData.energy>=DonotDestroyManager.GameData.Common.player_max_energy?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),o.t("1803",{energy:DonotDestroyManager.GameData.Common.player_max_energy})):a.send_C2SPaymentBuyEnergy(DonotDestroyManager._gameSocket)},GoToPay_onClickHandler:function(e,t){MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:this.closeCb,state:1}),i.playBtnOpenEffect();var a=n("MainHomeManager");null!=a.getInstance()&&a.getInstance().BlackMaskFadeIn(null)}});cc._RF.pop()},{GameUtils:"GameUtils",MainHomeManager:"MainHomeManager",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],BuyGameMoney:[function(n,e,t){"use strict";cc._RF.push(e,"babcc2ReH9ACpH8sHmJygFz","BuyGameMoney");var i=n("SoundUtil"),a=n("MyProtocols"),r=n("NetEvent"),s=n("MyEventDispatcher"),o=n("GameUtils"),c=n("i18n"),l=cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,buyTimes:cc.Label,goldNum:cc.Label,copperNum:cc.Label,showDialogPrefab:cc.Prefab,itemContent:cc.Node,btnClick:cc.Button,btnName:cc.Label,desState:[cc.Node],multipleSpritFrame:[cc.SpriteFrame],_dialogList:[],_useGold:0},statics:{instance:null,getInstance:function(){return l.instance}},onLoad:function(){(l.instance=this).PaymentGetInfo_auth_cb_func=this.PaymentGetInfo_auth_cb.bind(this),s.addListener(r.S2CPaymentGetInfo,this.PaymentGetInfo_auth_cb_func),this.PaymentBuyMoney_auth_cb_func=this.PaymentBuyMoney_auth_cb.bind(this),s.addListener(r.S2CPaymentBuyMoney,this.PaymentBuyMoney_auth_cb_func)},onDestroy:function(){s.removeListener(r.S2CPaymentGetInfo,this.PaymentGetInfo_auth_cb_func),s.removeListener(r.S2CPaymentBuyMoney,this.PaymentBuyMoney_auth_cb_func),this._dialogList=[],l.instance=null},PaymentGetInfo_auth_cb:function(e){MyPersistDataManager._playerData.gamemoneyTimes=e.gamemoneyTimes,MyPersistDataManager._playerData.energyTimes=e.energyTimes,this.Init()},PaymentBuyMoney_auth_cb:function(i){var e={useGold:this._useGold,getItem:i.add_gamemoney,multiple:i.multiple};console.log("PaymentBuyMoney_auth_cb--------"),console.log(i),this._dialogList.unshift(e),this.SetDialogItem(),1!=i.multiple&&o.callInNextTick(function(e){var t=new cc.Node("multiple"),a=t.addComponent(cc.Sprite);3==i.multiple?a.spriteFrame=e.multipleSpritFrame[0]:a.spriteFrame=e.multipleSpritFrame[1],t.setPosition(-246,-190),cc.Canvas.instance.node.addChild(t);var n=cc.sequence(cc.moveBy(.6,cc.p(.5,100)),cc.removeSelf());t.runAction(n)},this),MyPersistDataManager._playerData.gamemoneyTimes=i.gamemoneyTimes,this.Init()},setParams:function(e){this.closeCb=e.closeCb,this.ScaleToLarge(),0==MyPersistDataManager._playerData.gamemoneyTimes?a.send_C2SPaymentGetInfo(DonotDestroyManager._gameSocket):this.Init()},Init:function(){var e=MyPersistDataManager._playerData.gamemoneyTimes,t=MyPersistDataManager._playerData.money,a=MyPersistDataManager._playerData.vip_level;13<a&&(a=13);var n=MyPersistDataManager._playerData.level,i=DonotDestroyManager.GameData.Payment.gamemoney.times[a],r=Math.round(i-e);this.buyTimes.string=c.t("headtabpanel_001",{value1:r,value2:i});var s=this.btnClick.clickEvents[0];0<r?(this.goldNum.node.active=!0,this.copperNum.node.active=!0,this.desState[0].active=!0,this.desState[1].active=!1,this.goldNum.string=DonotDestroyManager.GameData.Payment.gamemoney.details[e][0],this._useGold=DonotDestroyManager.GameData.Payment.gamemoney.details[e][0],this.copperNum.string=Math.round((15e3+100*n)*DonotDestroyManager.GameData.Payment.gamemoney.details[e][1]),s.handler="Buy_onClickHandler",this.btnClick.clickEvents[0]=s,this.btnName.string=c.t("headtabpanel_003")):(this.goldNum.node.active=!1,this.copperNum.node.active=!1,this.desState[0].active=!1,this.desState[1].active=!0,s.handler="GoToPay_onClickHandler",this.btnClick.clickEvents[0]=s,this.btnName.string=c.t("headtabpanel_004")),t<this._useGold?this.goldNum.node.color=new cc.Color(252,0,0):this.goldNum.node.color=cc.Color.WHITE},SetDialogItem:function(){0!=this._dialogList.length&&this.itemContent.getComponent("UIWarp").initContent(this._dialogList.length)},Back_onClickHandler:function(){i.playBtnCloseEffect(),MyUiManager.Back()},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Buy_onClickHandler:function(e,t){i.playBtnOpenEffect(),console.log("send_C2SPaymentBuyMoney-----"),a.send_C2SPaymentBuyMoney(DonotDestroyManager._gameSocket)},GoToPay_onClickHandler:function(e,t){MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:this.closeCb,state:1}),i.playBtnOpenEffect();var a=n("MainHomeManager");null!=a.getInstance()&&a.getInstance().BlackMaskFadeIn(null)}});cc._RF.pop()},{GameUtils:"GameUtils",MainHomeManager:"MainHomeManager",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],1:[function(e,t,a){var n,i,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}
function o(){throw new Error("clearTimeout has not been defined")}
function c(t){if(n===setTimeout)
return setTimeout(t,0);if((n===s||!n)&&setTimeout)
return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}
(function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}
try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}})();var l,h=[],d=!1,_=-1;function u(){d&&l&&(d=!1,l.length?h=l.concat(h):_=-1,h.length&&m())}
function m(){if(!d){var e=c(u);d=!0;for(var t=h.length;t;){for(l=h,h=[];++_<t;)
l&&l[_].run();_=-1,t=h.length}
l=null,d=!1,function(t){if(i===clearTimeout)
return clearTimeout(t);if((i===o||!i)&&clearTimeout)
return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}
(e)}}
function p(e,t){this.fun=e,this.array=t}
function f(){}
r.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)
for(var a=1;a<arguments.length;a++)
t[a-1]=arguments[a];h.push(new p(e,t)),1!==h.length||d||c(m)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],CardLevelsMgr:[function(e,t,a){"use strict";cc._RF.push(t,"79e29iQquVEqb7N67fH5Pi9","CardLevelsMgr");var n=function(){this.CardLevelsMgr=null};n.prototype.getLevelExpTotal=function(e,t){var a=0;this.CardLevelsMgr=DonotDestroyManager.GameData.CardLevels;var n=this.CardLevelsMgr.levels[e],i=n.length;t<i&&(i=t);for(var r=0;r<i;++r)
a+=n[r][0];return a},n.prototype.getLevelExpMax=function(e){var t=0;this.CardLevelsMgr=DonotDestroyManager.GameData.CardLevels;for(var a=this.CardLevelsMgr.levels[e],n=a.length,i=1;i<n;++i)
t+=a[i][0];return t},n.prototype.getLevelExp=function(e,t){this.CardLevelsMgr=DonotDestroyManager.GameData.CardLevels;var a=this.CardLevelsMgr.levels[e],n=a.length;return t<n&&(n=t),a[n-1][0]},n.prototype.getLevelCostTotal=function(e,t){var a=0;this.CardLevelsMgr=DonotDestroyManager.GameData.CardLevels;var n=this.CardLevelsMgr.levels[e],i=n.length;t<i&&(i=t);for(var r=0;r<i;++r)
a+=n[r][1]*n[r][0];return a},n.prototype.getLevelCost=function(e,t){this.CardLevelsMgr=DonotDestroyManager.GameData.CardLevels;var a=this.CardLevelsMgr.levels[e],n=a.length;return t<n&&(n=t),a[n-1][1]*a[n-1][0]},n.prototype.getLevelCfg=function(e,t){this.CardLevelsMgr=DonotDestroyManager.GameData.CardLevels;var a=this.CardLevelsMgr.levels[e],n=a.length;return t<n&&(n=t),a[n-1]},n.prototype.getLevelMax=function(e){return this.CardLevelsMgr=DonotDestroyManager.GameData.CardLevels,this.CardLevelsMgr.levels[e].length},n.prototype.getLvByExp=function(e,t){if(0==t)
return 0;this.CardLevelsMgr=DonotDestroyManager.GameData.CardLevels;for(var a=this.CardLevelsMgr.levels[e],n=a.length,i=0,r=0;r<n;++r)
if(t<=(i+=a[r][0]))
return r;return n},n.prototype.getLvByExp=function(e,t,a){this.CardLevelsMgr=DonotDestroyManager.GameData.CardLevels;for(var n=this.CardLevelsMgr.levels[e],i=n.length,r=0,s=0,o=0;o<i;++o)
if(o<=a){if(t<=(r+=n[o][0]))
return s;s+=n[o][0]*n[o][1]}
return 0},t.exports=new n,cc._RF.pop()},{}],CardUpgradesMgr:[function(e,t,a){"use strict";cc._RF.push(t,"3fdb2ptoIxAga4QrfdAwShK","CardUpgradesMgr");var n=function(){};n.getCost=function(e,t){return DonotDestroyManager.GameData.CardUpgrades.costs[e][t]},n.getCoefs=function(e,t){return DonotDestroyManager.GameData.CardUpgrades.coefs[e][t]},t.exports=n,cc._RF.pop()},{}],ChangeHeadFrameLayer:[function(e,t,a){"use strict";cc._RF.push(t,"d0114bhxeZCRow8a8LtOIpH","ChangeHeadFrameLayer");var n=e("SoundUtil"),i=e("i18n"),r=(e("SelectRoleInfo"),e("MyUIEvent")),s=e("NetEvent"),o=e("MyProtocols"),c=e("MyEventDispatcher"),l=cc.Class({extends:cc.Component,properties:{mScrollView:cc.ScrollView,itemTemplateWidth:200,pre_column_item:cc.Prefab,_hero_icon_last_select:cc.Node,_netData:null},statics:{instance:null},onLoad:function(){(l.instance=this).S2CChangeHeadFrame_cb_func=this.S2CChangeHeadFrame_cb.bind(this),c.addListener(s.S2CChangeHeadFrame,this.S2CChangeHeadFrame_cb_func),this.onHeadFrameSelect_cb_func=this.onHeadFrameSelect_cb.bind(this),c.addListener(r.onHeadFrameSelect,this.onHeadFrameSelect_cb_func)},onDestroy:function(){l.instance=null,c.removeListener(s.S2CChangeHeadFrame,this.S2CChangeHeadFrame_cb_func),c.removeListener(r.onHeadFrameSelect,this.onHeadFrameSelect_cb_func)},onHeadFrameSelect_cb:function(e){this._hero_icon_last_select!=e&&(this._hero_icon_last_select.getComponent("HeadFrameColumnWidget").setSelected(!1),this._hero_icon_last_select=e)},S2CChangeHeadFrame_cb:function(e){MyPersistDataManager._playerData.head_frame=e.head_frame_id,c.dispatchEvent(r.onHeadFrameChange,e.head_frame_id),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("userdetailinfo_017")),this.doClosePanel()},setParams:function(e){this._netData=e.netData},start:function(){var e=DonotDestroyManager.GameData.HeadFrame.length,t=this.mScrollView.content;t.width=e*this.itemTemplateWidth;for(var a=0;a<e;++a){var n=cc.instantiate(this.pre_column_item);t.addChild(n),n.setPosition(n.width*(.5+a),0);var i=n.getComponent("HeadFrameColumnWidget").updateItem(a);null!=i&&(this._hero_icon_last_select=i)}
this._hero_icon_last_select.getComponent("HeadFrameColumnWidget").setSelected(!0)},doClosePanel:function(){MyUiManager.Back(),n.playBtnCloseEffect()},doChangeName:function(){n.playBtnOpenEffect();var e=this._hero_icon_last_select.getComponent("HeadFrameColumnWidget")._myIndex+1;cc.log("headFrameId=%d",e),o.send_C2SChangeHeadFrame(DonotDestroyManager._gameSocket,e)},setCloseCb:function(e){this.finishCb=e}});cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SelectRoleInfo:"SelectRoleInfo",SoundUtil:"SoundUtil",i18n:"i18n"}],ChangeIconLayer:[function(e,t,a){"use strict";cc._RF.push(t,"ddcc0md4K1IAYnbgDeqTxjR","ChangeIconLayer");var n=e("SoundUtil"),i=e("i18n"),r=(e("SelectRoleInfo"),e("MyUIEvent")),s=e("NetEvent"),o=e("MyProtocols"),c=e("MyEventDispatcher"),l=cc.Class({extends:cc.Component,properties:{mScrollView:cc.ScrollView,pre_row_container:cc.Prefab,itemTemplateHeight:150,_hero_icon_last_select:cc.Node},statics:{instance:null},onLoad:function(){(l.instance=this).S2CChangeIcon_cb_func=this.S2CChangeIcon_cb.bind(this),c.addListener(s.S2CChangeIcon,this.S2CChangeIcon_cb_func),this.onHeroIconSelect_cb_func=this.onHeroIconSelect_cb.bind(this),c.addListener(r.onHeroIconSelect,this.onHeroIconSelect_cb_func)},onDestroy:function(){l.instance=null,c.removeListener(s.S2CChangeIcon,this.S2CChangeIcon_cb_func),c.removeListener(r.onHeroIconSelect,this.onHeroIconSelect_cb_func)},onHeroIconSelect_cb:function(e){this._hero_icon_last_select!=e&&(null!=this._hero_icon_last_select&&this._hero_icon_last_select.getComponent("HeroIconNameWidget").setSelected(!1),this._hero_icon_last_select=e)},S2CChangeIcon_cb:function(e){MyPersistDataManager._playerData.icon=e.iconId,c.dispatchEvent(r.onIconChange,e.iconId),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("userdetailinfo_015")),this.doClosePanel()},setParams:function(e){},start:function(){this.myCards=cc.js.array.copy(MyPersistDataManager._playerData.cardslist),this.myCards.sort(function(e,t){return e.isonline!=t.isonline?t.isonline-e.isonline:DonotDestroyManager.GameData.Cards[t.template_id].quality!=DonotDestroyManager.GameData.Cards[e.template_id].quality?DonotDestroyManager.GameData.Cards[t.template_id].quality-DonotDestroyManager.GameData.Cards[e.template_id].quality:e.fight!=t.fight?t.fight-e.fight:t.level-e.level});var e=2+this.myCards.length,t=parseInt((e-1)/5)+1,a=this.mScrollView.content;a.height=t*this.itemTemplateHeight;for(var n=0;n<t;++n){var i=cc.instantiate(this.pre_row_container);a.addChild(i),i.setPosition(0,-i.height*(.5+n));var r=i.getComponent("HeadRowContainer").updateItem(n);null!=r&&(this._hero_icon_last_select=r)}},doClosePanel:function(){MyUiManager.Back(),n.playBtnCloseEffect()},doChangeName:function(){if(n.playBtnOpenEffect(),null!=this._hero_icon_last_select){var e=this._hero_icon_last_select.getComponent("HeroIconNameWidget")._my_index,t=1;if(e<2)
t=e+1;else
t=l.instance.myCards[e-2].template_id+10;cc.log("myIconId=%d",t),o.send_C2SChangeIcon(DonotDestroyManager._gameSocket,t)}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("userdetailinfo_018"))},setCloseCb:function(e){this.finishCb=e}});cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SelectRoleInfo:"SelectRoleInfo",SoundUtil:"SoundUtil",i18n:"i18n"}],ChangeNameLayer:[function(e,t,a){"use strict";cc._RF.push(t,"dce44kJNPxBno9bFj4dudr/","ChangeNameLayer");var n=e("SoundUtil"),i=e("i18n"),r=e("SelectRoleInfo"),s=e("MyUIEvent"),o=e("NetEvent"),c=e("MyProtocols"),l=e("MyEventDispatcher");cc.Class({extends:cc.Component,properties:{mNameInput:cc.EditBox,lab_jinkuai_cost:cc.Label},onLoad:function(){this.mNameInput.string=MyPersistDataManager._playerData.name,this.lab_jinkuai_cost.string="x"+DonotDestroyManager.GameData.Common.change_name_cost,this.S2CChangeName_cb_func=this.S2CChangeName_cb.bind(this),l.addListener(o.S2CChangeName,this.S2CChangeName_cb_func)},onDestroy:function(){l.removeListener(o.S2CChangeName,this.S2CChangeName_cb_func)},S2CChangeName_cb:function(e){MyPersistDataManager._playerData.name=e.name,l.dispatchEvent(s.onNameChange,e.name),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("userdetailinfo_013")),this.doClosePanel()},setParams:function(e){},doClosePanel:function(){MyUiManager.Back(),n.playBtnCloseEffect()},doChangeName:function(){n.playBtnOpenEffect();var e=this.mNameInput.string;null!=e&&""!=e?e!=MyPersistDataManager._playerData.name?c.send_C2SChangeName(DonotDestroyManager._gameSocket,e):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("userdetailinfo_012")):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("userdetailinfo_011"))},setCloseCb:function(e){this.finishCb=e},RandomName_OnClickHandler:function(e){n.playBtnOpenEffect(),this.mNameInput.string=r()}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SelectRoleInfo:"SelectRoleInfo",SoundUtil:"SoundUtil",i18n:"i18n"}],ChargePageView:[function(i,e,t){"use strict";cc._RF.push(e,"baa3cUzvCJJKoat6VShuPBE","ChargePageView");var r=i("SoundUtil");cc.Class({extends:cc.Component,properties:{left_Btn:cc.Button,rigth_Btn:cc.Button,vipTitle:cc.Label,m_pMoveMaskNode:cc.Node,m_pPagePrefab:cc.Prefab,_indexVip:0,_nowPage:cc.Node,_nextPage:cc.Node,_pX:0,_pX2:0,_isSwitch:!1},onLoad:function(){},ChangeData:function(e){null==this._nowPage&&this.Init(e),this.vipTitle.string=this._indexVip},Init:function(e){this._indexVip=e;var t=cc.instantiate(this.m_pPagePrefab);t.getComponent("MovePage").ChangeData(this._indexVip),this.m_pMoveMaskNode.addChild(t),this._nowPage=t},SwitchVip_onclickHandler:function(e,t){r.playPageEffect();var a=parseInt(t);this.rigth_Btn.enabled=!1,this.left_Btn.enabled=!1,0==a?(this._indexVip--,this._pX=-630,this._pX2=670):1==a&&(this._indexVip++,this._pX=670,this._pX2=-630),this.MoveAct(this._pX,this._pX2),this.ChangeData();var n=i("VipPayMgn");null!=n.Instance&&(n.Instance._params.targetVip=this._indexVip,n.Instance._target_vip=this._indexVip)},MoveAct:function(e,t){var a=this,n=cc.instantiate(this.m_pPagePrefab);n.getComponent("MovePage").ChangeData(this._indexVip),this.m_pMoveMaskNode.addChild(n),n.x=e,this._nextPage=n;var i=cc.moveTo(.3,cc.p(t,0)),r=cc.moveTo(.3,cc.p(0,0));this._nextPage.runAction(r);var s=cc.sequence(i,cc.callFunc(function(){a.DestroyPage()}));this._nowPage.runAction(s)},DestroyPage:function(){this._nowPage.removeFromParent(),this._nowPage.destroy(),this._nowPage=this._nextPage,this._nextPage=null},JudgeBtnShow:function(){0==this._indexVip?this.left_Btn.node.active=!1:13==this._indexVip?this.rigth_Btn.node.active=!1:(this.left_Btn.node.active=!0,this.rigth_Btn.node.active=!0)}}),cc._RF.pop()},{SoundUtil:"SoundUtil",VipPayMgn:"VipPayMgn"}],ChargeScrollView:[function(e,t,a){"use strict";cc._RF.push(t,"3e11bDKaPNPyIBcUS8APyyx","ChargeScrollView"),cc.Class({extends:cc.Component,properties:{m_pViewItemNode:cc.Node,itemPrefab:[cc.Prefab]},onLoad:function(){},ChangeData:function(){this.SetAllItems()},ShowItem:function(e){var t=null;e<2?(t=cc.instantiate(this.itemPrefab[0])).getComponent("VipPayCell1").ChangeData(e):(t=cc.instantiate(this.itemPrefab[1])).getComponent("VipPayCell2").ChangeData(e),this.m_pViewItemNode.addChild(t)},SetAllItems:function(){var e=DonotDestroyManager.GameData.Charge.payment.length;3!=DonotDestroyManager.jsbChannel&&4!=DonotDestroyManager.jsbChannel&&5!=DonotDestroyManager.jsbChannel&&6!=DonotDestroyManager.jsbChannel&&7!=DonotDestroyManager.jsbChannel||(e=8);for(var t=0;t<e;++t)
this.ShowItem(t)}}),cc._RF.pop()},{}],ChatItem:[function(i,e,t){"use strict";cc._RF.push(e,"12b6b6jExFGKKeWagxDiksv","ChatItem");var r=i("SoundUtil"),o=i("HeroConfigMgr"),c=i("GuozhanBufferMgr");cc.Class({extends:cc.Component,properties:{m_pIcon:cc.Sprite,m_pHeadFrame:cc.Sprite,m_pLevel:cc.Label,m_pContent:cc.RichText,m_pIconSpriteFrames:[cc.SpriteFrame],_chatinfo:null,index:0,_itemID:0},onLoad:function(){},SetInfo:function(e){},updateItem:function(e){this._itemID=e;var t=i("ChatPanel");this._itemID>=t.getInstance()._chatviewList.length?this.node.active=!1:(this.node.active=!0,this._chatinfo=t.getInstance()._chatviewList[t.getInstance()._chatviewList.length-1-this._itemID],this.Init())},refreshItem:function(){},Init:function(){switch(this._chatinfo.chat_type){case 1:var e=c.getOfficeNameByIndex(this._chatinfo.office_index);this._chatinfo.sender_uid==MyPersistDataManager._playerData.id?this.m_pContent.string=e+"<color=#00ff00> ta </c>:"+this._chatinfo.content:this.m_pContent.string=e+this._chatinfo.sender_name+":"+this._chatinfo.content;break;case 2:if(this._chatinfo.sender_uid==MyPersistDataManager._playerData.id){var t="Bạn chat với "+this._chatinfo.receiver_name+" nói :";-1==this._chatinfo.content.indexOf(t)?this.m_pContent.string="Bạn chat với <color=#0fffff>"+this._chatinfo.receiver_name+"</c> nói :"+this._chatinfo.content:this.m_pContent.string=this._chatinfo.content}else
this.m_pContent.string="<color=#0fffff>"+this._chatinfo.sender_name+"</c> đối ngươi nói :"+this._chatinfo.content;break;case 3:e=c.getOfficeNameByIndex(this._chatinfo.office_index),this._chatinfo.sender_uid==MyPersistDataManager._playerData.id?this.m_pContent.string=e+"<color=#00ff00> ta </c>:"+this._chatinfo.content:this.m_pContent.string=e+this._chatinfo.sender_name+":"+this._chatinfo.content}
if(this.m_pLevel.string=this._chatinfo.level,this._chatinfo.icon<10)
this.m_pIcon.spriteFrame=this.m_pIconSpriteFrames[this._chatinfo.icon-1];else{var a=this._chatinfo.icon-10,n=o.find(a);if(null!=n){var i=n.icon,r=this;cc.loader.loadRes("UI/Heros/"+i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r&&cc.isValid(r.m_pIcon)&&(r.m_pIcon.spriteFrame=t,r.m_pIcon.node.width=87,r.m_pIcon.node.height=87)})}}
var s=DonotDestroyManager.GameData.HeadFrame[this._chatinfo.head_frame_id-1];r=this;cc.loader.loadRes("UI/HeadFrame/"+s.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r&&cc.isValid(r.node)&&(r.m_pHeadFrame.spriteFrame=t)})},HeadFrame_OnClickHandler:function(e,t){if(r.playBtnOpenEffect(),this._chatinfo.sender_uid!=MyPersistDataManager._playerData.id){var a=i("ChatPanel");a.getInstance().m_pChatPlayerInfo.active=!0;var n=a.getInstance().m_pChatPlayerInfo.getComponent("ChatPlayerInfo");n.ChangeData(this._chatinfo),n.m_pIcon.spriteFrame=this.m_pIcon.spriteFrame,n.spr_head_frame.spriteFrame=this.m_pHeadFrame.spriteFrame,n.m_pIcon.node.width=87,n.m_pIcon.node.height=87}}}),cc._RF.pop()},{ChatPanel:"ChatPanel",GuozhanBufferMgr:"GuozhanBufferMgr",HeroConfigMgr:"HeroConfigMgr",SoundUtil:"SoundUtil"}],ChatPanel:[function(e,t,a){"use strict";cc._RF.push(t,"9944aLxTtVP8pEOCNjS8chf","ChatPanel");var n=e("MyProtocols"),i=e("NetEvent"),r=e("MyEventDispatcher"),s=e("SoundUtil"),o=e("MyUIEvent"),c=e("BattleBufferMgr"),l=e("PkBufferMgr"),h=e("GuoZhanConstants"),d=cc.Class({extends:cc.Component,properties:{m_pInput:cc.EditBox,m_pTopBtnList:[cc.Button],m_pContent:cc.Node,m_pChatPlayerInfo:cc.Node,m_pNewMessageNode:cc.Node,m_pNewMessageLab:cc.Label,m_pReddot:cc.Node,node_private_redpoint:cc.Node,node_nation_redpoint:cc.Node,lab_nation_name:cc.Label,mScrollView:cc.ScrollView,itemTemplate:cc.Prefab,itemTemplateHeight:110,spawnCount:12,spacing:0,bufferZone:600,_isShow:null,m_pBtnSpriteFrame:[cc.SpriteFrame],_lastSelectTabMenu:null,_curselectIndex:null,_chatviewList:[],_chatitemList:[],_curZOrder:null,_pushZOrder:null,_intervalId:null,_targetchatinfo:null,_sendvalue:null,_newmesNum:0},statics:{instance:null,getInstance:function(){return d.instance}},onLoad:function(){(d.instance=this)._isShow=!1,this._curZOrder=1,this._pushZOrder=-100,this.chatview_auth_cb_func=this.chatview_auth_cb.bind(this),r.addListener(i.S2CChatView,this.chatview_auth_cb_func),this.ChatPush_auth_cb_func=this.ChatPush_auth_cb.bind(this),r.addListener(i.S2CChatPush,this.ChatPush_auth_cb_func),this.s2cchat_auth_cb_func=this.s2cchat_auth_cb.bind(this),r.addListener(i.S2CChat,this.s2cchat_auth_cb_func),this.RefreshData(),this.node.on("touchstart",this.touch_start,this),this.m_pInput.node.on("editing-did-ended",this.EditEnd_callback,this),this._sendvalue="",this.redPointsRefresh_cb_func=this.redPointsRefresh_cb.bind(this),r.addListener(o.redPointsRefresh,this.redPointsRefresh_cb_func),this.S2CPkEnemyFormation_cb_func=this.S2CPkEnemyFormation_cb.bind(this),r.addListener(i.S2CPkEnemyFormation,this.S2CPkEnemyFormation_cb_func),this.S2CArenaFormation_cb_func=this.S2CArenaFormation_cb.bind(this),r.addListener(i.S2CArenaFormation,this.S2CArenaFormation_cb_func),0<MyPersistDataManager._playerData.nation_id?this.lab_nation_name.string=" quốc gia ("+h.NATION_LIST[MyPersistDataManager._playerData.nation_id-1]+")":this.lab_nation_name.string=" quốc gia "},S2CArenaFormation_cb:function(e){cc.log(" tiếp thu pvp đội hình tin tức "),MyPersistDataManager._playerData.pvpformation=e.formation,null!=e.formation&&c.setFormationData(2,e.formation)},S2CPkEnemyFormation_cb:function(e){cc.log(" chiến đấu tin tức tiếp thu "),l.setRightHero(e),this.OpenFormationLayer(e)},OpenFormationLayer:function(e){var t={name:e.base_info.nickname+"LV."+e.base_info.level,fight:e.base_info.fight,formation:e.formation.formationId,flip:e.formation.flip,forward:e.formation.forward,Teams:this.GetEnemyTeams(e),id:0};MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:t,panelinfo:{fid:2},battletype:8})},GetEnemyTeams:function(e){var t=[],a=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a].level;return 0};if(0<e.formation.a){var n=a(e.cards,e.formation.a);t.push({id:e.formation.a,level:n,position:"a"})}
if(0<e.formation.b){n=a(e.cards,e.formation.b);t.push({id:e.formation.b,level:n,position:"b"})}
if(0<e.formation.c){n=a(e.cards,e.formation.c);t.push({id:e.formation.c,level:n,position:"c"})}
if(0<e.formation.d){n=a(e.cards,e.formation.d);t.push({id:e.formation.d,level:n,position:"d"})}
if(0<e.formation.e){n=a(e.cards,e.formation.e);t.push({id:e.formation.e,level:n,position:"e"})}
if(0<e.formation.f){n=a(e.cards,e.formation.f);t.push({id:e.formation.f,level:n,position:"f"})}
if(0<e.formation.g){n=a(e.cards,e.formation.g);t.push({id:e.formation.g,level:n,position:"g"})}
if(0<e.formation.h){n=a(e.cards,e.formation.h);t.push({id:e.formation.h,level:n,position:"h"})}
if(0<e.formation.i){n=a(e.cards,e.formation.i);t.push({id:e.formation.i,level:n,position:"i"})}
if(0<e.formation.j){n=a(e.cards,e.formation.j);t.push({id:e.formation.j,level:n,position:"j"})}
return t},redPointsRefresh_cb:function(){-1<MyPersistDataManager._playerData.RedPoint.indexOf(8)?this.m_pReddot.active=!0:this.m_pReddot.active=!1},EditEnd_callback:function(e){var t=this.m_pInput.string;if(cc.log(" chấm dứt đưa vào ========="+t),null==this._targetchatinfo)
this._sendvalue=t;else{var a="Bạn chat với "+this._targetchatinfo.sender_name+" nói :";-1<t.indexOf(a)?this._sendvalue=t.substr(a.length):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Lỗi chat riêng!")}},touch_start:function(e){},onDestroy:function(){r.removeListener(i.S2CChatView,this.chatview_auth_cb_func),r.removeListener(i.S2CChatPush,this.ChatPush_auth_cb_func),r.removeListener(i.S2CChat,this.s2cchat_auth_cb_func),d.instance=null,r.removeListener(o.redPointsRefresh,this.redPointsRefresh_cb_func),r.removeListener(i.S2CPkEnemyFormation,this.S2CPkEnemyFormation_cb_func),r.removeListener(i.S2CArenaFormation,this.S2CArenaFormation_cb_func)},setParams:function(e){},s2cchat_auth_cb:function(e){cc.log("NetEvent.S2CChat"),this.m_pInput.string="",this._sendvalue=""},ChatPush_auth_cb:function(e){this._isShow?this._curselectIndex==e.chat_type&&(this._chatviewList.push(e),this.showListView()):this.m_pReddot.active=!0},SetSize:function(e){if(e)
return this.node.width=1334,void(this.node.height=750);this.node.width=this.node.height=0},chatview_auth_cb:function(e){if(cc.log(" nhận mở ra nói chuyện phiếm mặt bản ==="+e.chat_content.length),this.ClearChatItem(),!this._isShow){this.m_pContent.active=!0;var t=cc.moveBy(.2,cc.p(728,0));this.node.runAction(t),this._isShow=!this._isShow,this.SetSize(!0)}
this.m_pReddot.active=!1,this._chatviewList=e.chat_content,this.showListView(),this.node_private_redpoint.active=e.new_msg_list[0],this.node_nation_redpoint.active=e.new_msg_list[1]},showListView:function(){if(this.content=this.mScrollView.content,this.content.height=this._chatviewList.length*(this.itemTemplateHeight+this.spacing)+this.spacing,0==this.content.children.length){this._spawnItems=[],this.updateTimer=0,this.updateInterval=.2;for(var e=this.lastContentPosY=0;e<this.spawnCount;++e){var t=cc.instantiate(this.itemTemplate);this.content.addChild(t),t.setPosition(0,-t.height*(.5+e)-this.spacing*(e+1)),t.getComponent("ChatItem").updateItem(e),this._spawnItems.push(t)}}else
for(var a=this.updateTimer=0;a<this.spawnCount;++a){var n=this._spawnItems[a];n.setPosition(0,-n.height*(.5+a)-this.spacing*(a+1)),n.getComponent("ChatItem").updateItem(a)}},SendChatContent:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;cc.log(" gửi đi đối tượng ID==="+t+"type=="+this._curselectIndex),n.send_C2SChat(DonotDestroyManager._gameSocket,this._curselectIndex,t,e)},ChatShow_OnClickHandler:function(e){s.playBtnOpenEffect(),this.OpenChatPanel(this._isShow),cc.log(this.node.getPosition())},RefreshData:function(){this._curselectIndex=1,this.m_pTopBtnList[0].normalSprite=this.m_pBtnSpriteFrame[1],null!=this._lastSelectTabMenu&&(this._lastSelectTabMenu.normalSprite=this.m_pBtnSpriteFrame[0]),this._lastSelectTabMenu=this.m_pTopBtnList[0]},OpenChatPanel:function(e){if(e){var t=cc.moveBy(.2,cc.p(-728,0)),a=cc.callFunc(this.setcontentactive,this);this.node.runAction(cc.sequence(t,a)),this.RefreshData(),this._isShow=!this._isShow,this.ClearChatItem(),this.SetSize(!1),this.m_pNewMessageNode.active=!1,this._newmesNum=0,this._sendvalue="",n.send_C2SChatVisit(DonotDestroyManager._gameSocket)}else
n.send_C2SChatView(DonotDestroyManager._gameSocket,this._curselectIndex)},setcontentactive:function(){this.m_pContent.active=!1},ChangeChatItem:function(e,t){this._chatitemList[e].active=!0,this._chatitemList[e].getComponent("ChatItem").SetInfo(t)},ClearChatItem:function(){for(null!=this._intervalId&&clearInterval(this._intervalId);0<this._chatitemList.length;)
this._chatitemList.pop().destroy();this._curZOrder=1},TabMenu_OnClickHandler:function(e,t){s.playBtnOpenEffect();var a=parseInt(t);s.playBtnOpenEffect(),this.SelectTabMenuIndex(a)},SelectTabMenuIndex:function(e){if(2==e)
if(null!=this._targetchatinfo){var t="Bạn chat với "+this._targetchatinfo.sender_name+":";this.m_pInput.string=t}else
this.m_pInput.string="";if(this._curselectIndex!=e){2!=e&&(this._targetchatinfo=null,this.m_pInput.string="",this._sendvalue=""),null!=this._lastSelectTabMenu&&(this._lastSelectTabMenu.normalSprite=this.m_pBtnSpriteFrame[0]);var a=this.m_pTopBtnList[e-1];this._curselectIndex=e,a.normalSprite=this.m_pBtnSpriteFrame[1],cc.log(" trước mặt điểm đánh nhãn ==="+e),this._lastSelectTabMenu=a,n.send_C2SChatView(DonotDestroyManager._gameSocket,this._curselectIndex)}},Send_OnClickHandler:function(e,t){if(s.playBtnOpenEffect(),2!=this._curselectIndex||null!=this._targetchatinfo)
if(""!=this._sendvalue){var a=0;null!=this._targetchatinfo&&(a=this._targetchatinfo.sender_uid),this.SendChatContent(this._sendvalue,a)}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin nhập nội dung!");else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không có đối tượng chat!")},getPositionInView:function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.mScrollView.node.convertToNodeSpaceAR(t)},update:function(e){if(this.updateTimer+=e,!(this.updateTimer<this.updateInterval)){this.updateTimer=0;var t=this._spawnItems;if(null!=t){for(var a=this.bufferZone,n=this.mScrollView.content.y<this.lastContentPosY,i=(this.itemTemplateHeight+this.spacing)*t.length,r=0;r<t.length;++r){var s=this.getPositionInView(t[r]);if(n){if(s.y<-a&&t[r].y+i<0){t[r].setPositionY(t[r].y+i);var o=t[r].getComponent("ChatItem"),c=o._itemID-t.length;o.updateItem(c)}}else if(s.y>a&&t[r].y-i>-this.content.height){t[r].setPositionY(t[r].y-i);var l=t[r].getComponent("ChatItem"),h=l._itemID+t.length;l.updateItem(h)}}
this.lastContentPosY=this.mScrollView.content.y}}}});cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",GuoZhanConstants:"GuoZhanConstants",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",PkBufferMgr:"PkBufferMgr",SoundUtil:"SoundUtil"}],ChatPlayerInfo:[function(n,e,t){"use strict";cc._RF.push(e,"4408byXSSBK97AaumEsQ4J2","ChatPlayerInfo");var i=n("SoundUtil"),a=n("MyProtocols"),r=n("GuozhanBufferMgr");cc.Class({extends:cc.Component,properties:{m_pName:cc.Label,lab_office:cc.Label,m_pHeadFrame:cc.Sprite,m_pIcon:cc.Sprite,spr_head_frame:cc.Sprite,m_pLevel:cc.Label,m_pVip:cc.Label,_chatinfo:null},onLoad:function(){},ChangeData:function(e){this._chatinfo=e,this.Init(),null==MyPersistDataManager._playerData.pvpformation&&a.send_C2SArenaFormation(DonotDestroyManager._gameSocket)},Init:function(){if(this.m_pLevel.string=this._chatinfo.level,this.m_pName.string="Tên:"+this._chatinfo.sender_name,-1==this._chatinfo.office_index||99==this._chatinfo.office_index||199==this._chatinfo.office_index||299==this._chatinfo.office_index)
this.lab_office.string=" vô quốc chiến chức quan ";else{var e=r.getOfficeNameByIndex(this._chatinfo.office_index);this.lab_office.string="Chức quan:"+e}
this.m_pVip.string="VIP"+this._chatinfo.vip_level},private_OnClickHandler:function(e,t){i.playBtnOpenEffect();var a=n("ChatPanel");this.node.active=!1,a.getInstance()._targetchatinfo=this._chatinfo,a.getInstance().SelectTabMenuIndex(2)},Mask_OnClickHandler:function(e){i.playBtnCloseEffect(),this.node.active=!1},Pk_OnClickHandler:function(e,t){i.playBtnOpenEffect(),a.send_C2SPkEnemyFormation(DonotDestroyManager._gameSocket,this._chatinfo.sender_uid)}}),cc._RF.pop()},{ChatPanel:"ChatPanel",GuozhanBufferMgr:"GuozhanBufferMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil"}],ColorUtil:[function(e,t,a){"use strict";cc._RF.push(t,"bc8c3XuM0VC3aj9fkSeKREQ","ColorUtil");var n=[cc.color(255,255,255),cc.color(0,255,0),cc.color(0,204,255),cc.color(255,0,250),cc.color(255,215,0)],i=["FFFFFF","00FF00","00CCFF","CC66FF"],r=[cc.color(255,255,255),cc.color(0,0,0),cc.color(255,0,0),cc.color(0,255,0),cc.color(0,0,255),cc.color(179,179,179),cc.color(255,228,31),cc.color(255,255,0),cc.color(255,204,0)];t.exports={getColorByQuality:function(e){return 5<=e||e<0?n[0]:n[e]},getRichtextColorByQuality:function(e){return 4<=e||e<0?i[0]:i[e]},getColorByIndex:function(e){return r[e]}},cc._RF.pop()},{}],CommonHelpPanel:[function(e,t,a){"use strict";cc._RF.push(t,"72b5fCdXChIQ77KM1jmBd4N","CommonHelpPanel"),cc.Class({extends:cc.Component,properties:{lab_title:cc.Label,lab_content:cc.Label},start:function(){},setParams:function(e){this.lab_title.string=e.title,this.lab_content.string=e.content}}),cc._RF.pop()},{}],ConsumablesInfo:[function(n,e,t){"use strict";cc._RF.push(e,"4dff7jDTslFcqk6xsiDPZq8","ConsumablesInfo");var i=n("ColorUtil"),r=n("SoundUtil"),s=n("MyProtocols"),o=(n("NetEvent"),n("i18n"));cc.Class({extends:cc.Component,properties:{m_pTopitemParent:cc.Node,m_pXuqiuitemparent:cc.Node,m_pName:cc.Label,m_pNum:cc.Label,m_pDes:cc.Label,m_pXuqiuContent:cc.Node,m_pBtnlab:cc.Label,m_pUseMoreBtn:cc.Button,m_pUseBtn:cc.Button,m_pXuqiuName:cc.Label,m_pItemBox:cc.Prefab,_simpleinfo:null,_topitembox:null,_xuqiuitembox:null,_needKeyInfo:null},onLoad:function(){cc.log(" tiến vào onload")},ChangeData:function(e){null!=e&&(this._simpleinfo=e,this.Init())},Init:function(){n("StoreHousePanel");(this._needKeyInfo=null)==this._topitembox&&(this._topitembox=this.Createitembox(this.m_pTopitemParent));var e=this._topitembox.getComponent("ItemBox");e.ChangeItemData(this._simpleinfo,null,!1),this.m_pName.string=e._itemjsoninfo.name,this.m_pName.node.color=i.getColorByQuality(e._itemjsoninfo.quality),this.m_pNum.string=o.t("sh_001",{num:this._simpleinfo.num}),this.m_pDes.string=e._itemjsoninfo.des,this.m_pXuqiuContent.active=!1;var t=-1;if(null!=e._itemjsoninfo.key&&0<e._itemjsoninfo.key[1]){this.m_pXuqiuContent.active=!0,null==this._xuqiuitembox&&(this._xuqiuitembox=this.Createitembox(this.m_pXuqiuitemparent));var a=this._xuqiuitembox.getComponent("ItemBox");a.ChangeItemInfo(e._itemjsoninfo.key[0],0,!1,null,!1),this.m_pXuqiuName.string=a._itemjsoninfo.name+" x"+e._itemjsoninfo.key[1],this._needKeyInfo=MyPersistDataManager._playerData.bagMap[e._itemjsoninfo.key[0]],null!=this._needKeyInfo?(this.m_pUseBtn.node.setPosition(142,-298),this.m_pUseMoreBtn.node.active=!0,this.m_pBtnlab.node.active=!0,t=this._needKeyInfo.num<=this._simpleinfo.num?this._needKeyInfo.num:this._simpleinfo.num,this.m_pBtnlab.string=o.t("sh_002",{num:t})):(this.m_pUseBtn.node.setPosition(262,-298),this.m_pUseMoreBtn.node.active=!1,this.m_pBtnlab.node.active=!1)}else
1<this._simpleinfo.num?(t=this._simpleinfo.num,1200==this._simpleinfo.template_id&&50*t+MyPersistDataManager._playerData.energy>DonotDestroyManager.GameData.Common.player_max_energy&&(t=parseInt((500-MyPersistDataManager._playerData.energy)/50)),this.m_pUseBtn.node.setPosition(142,-298),this.m_pUseMoreBtn.node.active=!0,this.m_pBtnlab.node.active=!0,this.m_pBtnlab.string=o.t("sh_002",{num:t})):(this.m_pUseBtn.node.setPosition(262,-298),this.m_pUseMoreBtn.node.active=!1,this.m_pBtnlab.node.active=!1);this.UseBtnRegisterClickEvent(this.m_pUseBtn,1),this.UseBtnRegisterClickEvent(this.m_pUseMoreBtn,t)},UseBtnRegisterClickEvent:function(e,t){var a=new cc.Component.EventHandler;a.target=this.node,a.component="ConsumablesInfo",a.handler="UseItem_OnClickHandler",a.customEventData=t,e.clickEvents[0]=a},Createitembox:function(e){var t=cc.instantiate(this.m_pItemBox);return e.addChild(t),t},UseItem_OnClickHandler:function(e,t){r.playBtnOpenEffect();var a=parseInt(t),n=[];if(-1!=a){if(null==this._topitembox.getComponent("ItemBox")._itemjsoninfo.key||this._topitembox.getComponent("ItemBox")._itemjsoninfo.key[1]<=0)
cc.log(" không có key"),n.push({template_id:this._simpleinfo.template_id,count:a}),s.send_C2SUseItem(DonotDestroyManager._gameSocket,n);else{if(null==this._needKeyInfo)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),o.t("sh_003"));n.push({template_id:this._simpleinfo.template_id,count:a}),s.send_C2SUseItem(DonotDestroyManager._gameSocket,n)}
cc.log(" sử dụng đạo cụ ===="+this._simpleinfo.template_id+" chiều dài ==="+a)}},onDestroy:function(){this._topitembox=null,this._xuqiuitembox=null}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",StoreHousePanel:"StoreHousePanel",i18n:"i18n"}],ConsumeBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"0aa8bV7xupFdZ0gyjQ9xPKM","ConsumeBufferMgr");var n=function(){this.consumeList=[]};n.prototype.initList=function(e){e.length<=0?this.consumeList=[]:this.consumeList=e},n.prototype.AddConsumeEntity=function(e){for(var t=null,a=0;a<this.consumeList.length;++a){var n=this.consumeList[a];n.template_id==e.template_id&&(t=n)}
null!=t?t.num=e.num:this.consumeList.push(e)},n.prototype.AddConsumeNum=function(e,t){for(var a=null,n=0,i=0;i<this.consumeList.length;++i){var r=this.consumeList[i];r.template_id==e&&(a=r,n=i)}
null!=a&&t<=0&&this.consumeList.splice(n,1)},n.prototype.getList=function(){return this.consumeList},n.prototype.hasRune=function(){return 0<this.consumeList.length},t.exports=new n,cc._RF.pop()},{}],ConsumeMultiUse:[function(e,t,a){"use strict";cc._RF.push(t,"7cdd97dCktIDrAmLt3iUD7D","ConsumeMultiUse");var n=e("MyProtocols"),i=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pItemParent:cc.Node,m_pGamemoney:cc.Label,_iteminfolist:[],_raw_assets:null},onLoad:function(){},ChangeData:function(e,t){this._iteminfolist=e,this._raw_assets=t,this.Init()},Init:function(){this.SetData()},CreateItemBox:function(e,t){var a=cc.instantiate(this._raw_assets["Prefab/ItemBox/ItemBox"]);this.m_pItemParent.addChild(a),a.getComponent("ItemBox").ChangeItemInfo(e,t,!0,null,!0)},SetData:function(){for(var e=0,t=0;t<this._iteminfolist.length;++t){this.CreateItemBox(this._iteminfolist[t].id,this._iteminfolist[t].num),e+=DonotDestroyManager.GameData.Consumes[this._iteminfolist[t].id].mods.gamemoney*this._iteminfolist[t].num}
this.m_pGamemoney.string="x"+e},OnClickHandler:function(){i.playBtnCloseEffect(),this.SendUseItem(),this.node.destroy()},SendUseItem:function(){for(var e=[],t=0;t<this._iteminfolist.length;++t)
e.push({template_id:this._iteminfolist[t].id,count:this._iteminfolist[t].num});n.send_C2SUseItem(DonotDestroyManager._gameSocket,e)},Mask_OnClickHandler:function(e){i.playBtnCloseEffect(),this.node.destroy()}}),cc._RF.pop()},{MyProtocols:"MyProtocols",SoundUtil:"SoundUtil"}],CrawlCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"698b3Auyf9Di5oY4z3qNN4b","CrawlCfgMgr");var n=function(){};n.isHaveCrawl=function(e,t){var a=DonotDestroyManager.GameData.Crawl;return null!=a[e-1]&&null!=a[e-1][t]},n.isHaveCrawEnd=function(e){return null!=DonotDestroyManager.GameData.Crawl[e-1].ed},t.exports=n,cc._RF.pop()},{}],CreateRolePanel:[function(e,t,a){"use strict";cc._RF.push(t,"48b6fpAMSNB5qr3U8eQTD0z","CreateRolePanel");var n=e("SelectRoleInfo"),m=e("MyProtocols"),i=e("NetEvent"),r=e("MyEventDispatcher"),s=e("SoundUtil");e("GameUtils");cc.Class({extends:cc.Component,properties:{m_pName:cc.EditBox,m_pMan:cc.Sprite,m_pWoman:cc.Sprite,node_character:cc.Node,node_touchArea:cc.Node,m_pManSpr:[cc.SpriteFrame],m_pWomanSpr:[cc.SpriteFrame],spine_character:[cc.Node],_sessionid:null,_sex:null,_tmpName:"",_boy_node:cc.Node,_girl_node:cc.Node},start:function(){null==this._tmpName||""==this._tmpName?this.m_pName.string=n():this.m_pName.string=this._tmpName,this._sex=1,this.changePic(),this.showCharacter(),this.node_touchArea.on("touchstart",this.BfClickStartHandler,this),this.node_touchArea.on("touchend",this.BfClickEndHandler,this)},BfClickStartHandler:function(e){this._beganTouch=e.touch.getLocation()},BfClickEndHandler:function(e){var t=e.touch.getLocation();50<Math.abs(t.x-this._beganTouch.x)&&this.moveSex(t.x>this._beganTouch.x?1:-1)},setParams:function(e){this._sessionid=e.sessionId,this._tmpName=e.nickname,this._createrole_auth_cb_func=this._createrole_auth_cb.bind(this),r.addListener(i.S2CCreateCharacter,this._createrole_auth_cb_func)},onDestroy:function(){r.removeListener(i.S2CCreateCharacter,this._createrole_auth_cb_func)},BtnOk_OnClickHandler:function(e){s.playBtnOpenEffect(),this._tmpName=this.m_pName.string,m.send_C2SCreateCharacter(DonotDestroyManager._gameSocket,this._sex,this.m_pName.string,this._sessionid)},_createrole_auth_cb:function(e){var t=e.character_id;cc.log(" sáng tạo nhân vật hồi điều ,roleid=%d",t);var a=null;if(null!=window.wanba_gift_id&&(a={wanba_gift_id:window.wanba_gift_id,appid:window.OPEN_DATA.appid,openid:window.OPEN_DATA.openid,openkey:window.OPEN_DATA.openkey,pf:window.OPEN_DATA.pf}),m.send_C2SEnterGame(DonotDestroyManager._gameSocket,this._sessionid,a),null!=window.open_platform)
switch(window.open_platform){case 1:var n={act:"1",serverid:i=cc.sys.localStorage.getItem("lastloginserver"),rolename:this._tmpName,roleid:t,level:"1"};qhsdk.role(n);break;case 2:window.reportRegister();break;case 3:var i,r=" phục vụ khí #"+(i=cc.sys.localStorage.getItem("lastloginserver"));null!=DonotDestroyManager._gameServerInfo&&(r=DonotDestroyManager._gameServerInfo.server_name),ZmSdk.getInstance().reportRoleStatus({datatype:"2",serverid:i.toString(),servername:r,roleid:t,rolename:this._tmpName,rolelevel:"1",fightvalue:"1"})}
if(2==DonotDestroyManager.jsbChannel){var s=cc.sys.localStorage.getItem("lastloginserver"),o=" phục vụ khí #"+s;null!=DonotDestroyManager._gameServerInfo&&(o=DonotDestroyManager._gameServerInfo.server_name);var c=new Date,l=Math.round(c.getTime()/1e3).toString(),h={roleId:t.toString(),roleName:this._tmpName,roleLevel:"1",zoneId:s,zoneName:o,balance:"0",vip:"0",partyName:" vô bang phái ",roleCTime:l,roleLevelMTime:l};window.webkit.messageHandlers.setData.postMessage({param1:"createrole",param2:JSON.stringify(h)})}else if(11==DonotDestroyManager.jsbChannel){var d=cc.sys.localStorage.getItem("lastloginserver");cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","setData","(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;Ljava/lang/String;)V",2,0,t.toString(),this._tmpName,"1",parseInt(d),serverName,"0"):jsb.reflection.callStaticMethod("SDKHandler","submitData:and1:and2:and3:and4:and5:and6:and7:",2,d,serverName,this._tmpName,t.toString(),"1","0","0")}else if(12==DonotDestroyManager.jsbChannel){var _=cc.sys.localStorage.getItem("lastloginserver"),u=" phục vụ khí #"+_;null!=DonotDestroyManager._gameServerInfo&&(u=DonotDestroyManager._gameServerInfo.server_name),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","setUserInfo","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;I)V",_,u,this._tmpName,t.toString(),"1","13","18888",1):jsb.reflection.callStaticMethod("QuickSDKHandler","updateRoleInfoWith:and1:and2:and3:and4:and5:and6:and7:",u,this._tmpName,_,t.toString(),"18888","13","1",1)}
null!=window.TDGA&&window.TDGA.Account.setAccountName(this._tmpName)},RandomName_OnClickHandler:function(e){s.playBtnOpenEffect(),this.m_pName.string=n()},changePic:function(){1==this._sex?(this.m_pWoman.spriteFrame=this.m_pWomanSpr[0],this.m_pMan.spriteFrame=this.m_pManSpr[1]):(this.m_pWoman.spriteFrame=this.m_pWomanSpr[1],this.m_pMan.spriteFrame=this.m_pManSpr[0])},showCharacter:function(){this.getMyNode(this._sex).getComponent(sp.Skeleton).setAnimation(0,"stand",!0);var e=this.getOtherNode(this._sex);e.opacity=0,e.scale=.8,e.setPosition(200*(1==this._sex?-1:1),20),e.getComponent(sp.Skeleton).setAnimation(0,"stand",!0)},Sex_OnClickHandler:function(e,t){s.playBtnOpenEffect();var a=parseInt(t);if(this._sex!=a)
if(this._sex=a,this.changePic(),this.spine_character[0].stopAllActions(),this.spine_character[1].stopAllActions(),1==this._sex){var n=this.spine_character[0];n.setPosition(200,20),n.runAction(cc.spawn(cc.moveTo(.5,cc.v2(0,0)),cc.fadeIn(.5),cc.scaleTo(.5,1))),this.spine_character[1].runAction(cc.spawn(cc.moveTo(.5,cc.v2(-200,0)),cc.fadeOut(.5),cc.scaleTo(.5,.8)))}else{var i=this.spine_character[1];i.setPosition(-200,20),i.runAction(cc.spawn(cc.moveTo(.5,cc.v2(0,0)),cc.fadeIn(.5),cc.scaleTo(.5,1))),this.spine_character[0].runAction(cc.spawn(cc.moveTo(.5,cc.v2(200,0)),cc.fadeOut(.5),cc.scaleTo(.5,.8)))}},moveSex:function(e){if(this.spine_character[0].stopAllActions(),this.spine_character[1].stopAllActions(),1==this._sex){this.spine_character[0].runAction(cc.spawn(cc.moveTo(.5,cc.v2(200*e,0)),cc.fadeOut(.5),cc.scaleTo(.5,.8)));var t=this.spine_character[1];t.setPosition(200* -e,20),t.runAction(cc.spawn(cc.moveTo(.5,cc.v2(0,0)),cc.fadeIn(.5),cc.scaleTo(.5,1)))}else{this.spine_character[1].runAction(cc.spawn(cc.moveTo(.5,cc.v2(200*e,0)),cc.fadeOut(.5),cc.scaleTo(.5,.8)));var a=this.spine_character[0];a.setPosition(200* -e,20),a.runAction(cc.spawn(cc.moveTo(.5,cc.v2(0,0)),cc.fadeIn(.5),cc.scaleTo(.5,1)))}
this._sex=3-this._sex,this.changePic()},getMyNode:function(e){return this.spine_character[e-1]},getOtherNode:function(e){return this.spine_character[2-e]}}),cc._RF.pop()},{GameUtils:"GameUtils",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SelectRoleInfo:"SelectRoleInfo",SoundUtil:"SoundUtil"}],DailySharePanel:[function(e,t,a){"use strict";cc._RF.push(t,"de9bd8TgU5MiZQxTMIv64i5","DailySharePanel");var n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{node_items_parent:cc.Node,pre_item_box:cc.Prefab},setParams:function(e){},goBack:function(){n.playBtnCloseEffect(),MyUiManager.Back()},start:function(){for(var e=DonotDestroyManager.GameData.Common.weixin_share_award,t=0;t<e.length;t++){var a=e[t];this.CreateItemBox(a[0],a[1])}},CreateItemBox:function(e,t){var a=cc.instantiate(this.pre_item_box);this.node_items_parent.addChild(a),a.getComponent("ItemBox").ChangeItemInfo(e,t,!0,null,!0)},clickHandler_share:function(){if(n.playBtnOpenEffect(),null!=window.open_platform)
switch(window.open_platform){case 1:qhsdk.share();break;case 2:mqq.ui.showShareMenu();break;case 3:ZmSdk.getInstance().isSupportMethod("share")?ZmSdk.getInstance().share({title:" tam quốc quân đoàn chiến ",content:" mau tới thể nghiệm thiên quân vạn mã chém giết tam quốc chiến trường đi ！",imgurl:"http://cdn.lejigames.com/icon/100x100px.png",ext:""},function(e){null!=e&&"ok"==e.success&&MyProtocols.send_C2SGetQunheiWxShareAward(DonotDestroyManager._gameSocket)}):ZmSdk.getInstance().isSupportMethod("setShareInfo")?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," điểm đánh hữu thượng giác chia xẻ ！"):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," không duy trì chia xẻ ！");break;case 6:window.H5API.shareGame("s1"),this.node.runAction(cc.sequence(cc.delayTime(4),cc.callFunc(function(e){MyProtocols.send_C2SGetQunheiWxShareAward(DonotDestroyManager._gameSocket)})))}}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],DamageItem:[function(e,t,a){"use strict";cc._RF.push(t,"2e6e2R2wn9O5ZJJssADW8cF","DamageItem");var n=e("i18n"),i=e("ColorUtil");cc.Class({extends:cc.Component,properties:{m_pItemBox:cc.Prefab,m_pItemBoxParent:cc.Node,m_pHeroName:cc.Label,m_pHeroGrade:cc.Label,m_pKillHero:cc.RichText,m_pKillEnemy:cc.RichText,m_pDamage:cc.RichText,m_pBarpress:cc.Sprite,m_pBarSpriteFrame:[cc.SpriteFrame],_herocolor:null,_barstate:0},onLoad:function(){},ChangeData:function(e){this.SetItemBox(e.data.hero),this.m_pHeroName.string=this._herojson.name,this.m_pHeroName.node.color=i.getColorByQuality(this._herojson.quality),this.m_pHeroGrade.string="+"+e.data.hero.grade,this.m_pHeroGrade.node.color=i.getColorByQuality(this._herojson.quality),this.m_pKillHero.string=n.t("battledetail_001",{value:e.killHero}),this.m_pKillEnemy.string=n.t("battledetail_002",{value:e.killUnit}),this.m_pDamage.string=n.t("battledetail_003",{value:e.damage}),this.m_pBarpress.spriteFrame=this.m_pBarSpriteFrame[this._barstate];var t=e.percent;(0<=t||t<=1)&&(this.m_pBarpress.node.scaleX=t)},SetItemBox:function(e){var t=cc.instantiate(this.m_pItemBox);this.m_pItemBoxParent.addChild(t);var a=t.getComponent("ItemBox");a.ChangeHeroInfo(e.id,1,e.level,!1,null,!0),this._herojson=a._itemjsoninfo}}),cc._RF.pop()},{ColorUtil:"ColorUtil",i18n:"i18n"}],DamageLogic:[function(g,e,t){"use strict";cc._RF.push(e,"bf8f6JTa85FIbFJIE9BxOUC","DamageLogic");var a={commonDamage:function(e,t,a){if(null!=e&&null!=t)
if(null!=e.cfg&&100<=e.cfg.potential){var n=g("SkillsManager"),i=t.getPosition().x,r=t.getPosition().y;i-=r/2;for(var s=n.getRangeRect(i,r,[130,130],e.getOrient()),o=n.getOtherSideArmies(e.side()),c=0;c<o.length;c++){var l=o[c];if(l.isSearchAble()){var h,d;if(l.hero&&"Dead"!=l.hero.getState()){var _=l.hero.getPosition();h=_.x,h-=(d=_.y)/2,(-1==s||cc.rectContainsPoint(s,cc.p(h,d)))&&l.hero.commonDamage(e,a)}
for(var u=[],m=0;m<l.soldiers.length;m++){if((f=l.soldiers[m])&&"Dead"!=f.getState()){var p=f.getPosition();h=p.x,h-=(d=p.y)/2,(-1==s||cc.rectContainsPoint(s,cc.p(h,d)))&&u.push(f)}}
for(m=0;m<u.length;m++){var f;(f=u[m]).commonDamage(e,a)}}}}else
e.isTargetAble()&&t.commonDamage(e,a);else
cc.warn("param error,from:"+e+";to:"+t)}};e.exports=a,cc._RF.pop()},{SkillsManager:"SkillsManager"}],DayActivityLayer:[function(e,t,a){"use strict";cc._RF.push(t,"ad1ecuiZ59OgqlUu9acnqql","DayActivityLayer");var n=e("SoundUtil"),i=e("MyProtocols"),r=e("NetEvent"),s=e("MyEventDispatcher"),o=e("ArenaBufferMgr"),c=e("GuideBufferMgr"),l=e("PlayerBufferMgr"),h=e("MyUIEvent"),d=e("PkBufferMgr"),_=e("SecretBufferMgr"),u=e("OverComeBufferMgr"),m=e("GuozhanBufferMgr"),p=e("GuozhanFightBufferMgr"),f=cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pMissionItemPrefab:cc.Prefab,m_pItemContent:cc.Node,m_pRewardPanel:cc.Prefab,_itemScriptList:[],_isLunchGet:!1,_isDinnerGet:!1,_isMidNightGet:!1,_showList:[],FunctionBtnBar:cc.Prefab,_params:null,mScrollView:cc.ScrollView,itemTemplate:cc.Prefab,itemTemplateHeight:110,spawnCount:12,spacing:0,bufferZone:600},statics:{instance:null,getInstance:function(){return f.instance}},onLoad:function(){(f.instance=this).DailyMissionList_auth_cb_func=this.DailyMissionList_auth_cb.bind(this),s.addListener(r.S2CDailyMissionList,this.DailyMissionList_auth_cb_func),this.DailyMissionGetAward_auth_cb_func=this.DailyMissionGetAward_auth_cb.bind(this),s.addListener(r.S2CDailyMissionGetAward,this.DailyMissionGetAward_auth_cb_func),this.S2CArenaView_cb_func=this.S2CArenaView_cb.bind(this),s.addListener(r.S2CArenaView,this.S2CArenaView_cb_func),this.OvercomeInfoAll_auth_cb_func=this.OvercomeInfoAll_auth_cb.bind(this),s.addListener(r.S2COvercomeInfoAll,this.OvercomeInfoAll_auth_cb_func),this.S2CDailyMissionGetAwardAll_cb_func=this.S2CDailyMissionGetAwardAll_cb.bind(this),s.addListener(r.S2CDailyMissionGetAwardAll,this.S2CDailyMissionGetAwardAll_cb_func),this.onDayMissionChange_cb_func=this.onDayMissionChange_cb.bind(this),s.addListener(h.onDayMissionChange,this.onDayMissionChange_cb_func),this.S2CRankView_cb_func=this.S2CRankView_cb.bind(this),s.addListener(r.S2CRankView,this.S2CRankView_cb_func),this.S2CMineList_cb_func=this.S2CMineList_cb.bind(this),s.addListener(r.S2CMineList,this.S2CMineList_cb_func),this.S2CSecretView_cb_func=this.S2CSecretView_cb.bind(this),s.addListener(r.S2CSecretView,this.S2CSecretView_cb_func),this.S2CGuozhanView_cb_func=this.S2CGuozhanView_cb.bind(this),s.addListener(r.S2CGuozhanView,this.S2CGuozhanView_cb_func),this.S2CGuozhanFightView_cb_func=this.S2CGuozhanFightView_cb.bind(this),s.addListener(r.S2CGuozhanFightView,this.S2CGuozhanFightView_cb_func);var e=cc.instantiate(this.FunctionBtnBar);this.node.addChild(e),e.setPosition(cc.p(0,0)),e.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").changeStatus(0)},S2CGuozhanView_cb:function(e){m.initNetData(e),MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanMainPanel,{netData:e})},S2CGuozhanFightView_cb:function(e){p.initNetData(e),m.initNetData(e),MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanFightPanel,{netData:e})},S2CSecretView_cb:function(e){_.initNetData(e),MyUiManager.Open(MyUiManager.PanelInfo.SecretMainPanel,{netData:e})},S2CMineList_cb:function(e){MyUiManager.Open(MyUiManager.PanelInfo.MineMainPanel,{netData:e})},S2CRankView_cb:function(e){d.setWinLooseInfo(e.pkWinLoose),MyUiManager.Open(MyUiManager.PanelInfo.RankLayer,{info:e})},onDayMissionChange_cb:function(e){this.SetMissionItem(MyPersistDataManager._playerData.daymissionlist)},onDestroy:function(){s.removeListener(r.S2CDailyMissionList,this.DailyMissionList_auth_cb_func),s.removeListener(r.S2CDailyMissionGetAward,this.DailyMissionGetAward_auth_cb_func),s.removeListener(r.S2CArenaView,this.S2CArenaView_cb_func),s.removeListener(r.S2COvercomeInfoAll,this.OvercomeInfoAll_auth_cb_func),s.removeListener(r.S2CDailyMissionGetAwardAll,this.S2CDailyMissionGetAwardAll_cb_func),s.removeListener(h.onDayMissionChange,this.onDayMissionChange_cb_func),s.removeListener(r.S2CRankView,this.S2CRankView_cb_func),s.removeListener(r.S2CMineList,this.S2CMineList_cb_func),s.removeListener(r.S2CSecretView,this.S2CSecretView_cb_func),s.removeListener(r.S2CGuozhanView,this.S2CGuozhanView_cb_func),s.removeListener(r.S2CGuozhanFightView,this.S2CGuozhanFightView_cb_func),this._itemScriptList=[],this._showList=[],f.instance=null},S2CDailyMissionGetAwardAll_cb:function(e){if(null!=e.attachs&&0<e.attachs.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.attachs,t.getComponent("GetRewardPanel")._closeCb=this.awardCloseCb.bind(this)}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Nhận thành công")},OvercomeInfoAll_auth_cb:function(e){u.rand_key=e.rand_key,u.initBuffer(e),u.initOtrHerosHpdatas(e),MyUiManager.Open(MyUiManager.PanelInfo.FightThroughLayer,e)},S2CArenaView_cb:function(e){cc.log(" tiếp thu Đấu Trường liệt biểu tin tức "),o.initBuffer(e),MyUiManager.Open(MyUiManager.PanelInfo.AreanMainLayer,e)},DailyMissionGetAward_auth_cb:function(e){var t=DonotDestroyManager.GameData.DailyMissions[e.mission_tpl_id],a=[];0<t.rewards.gamemoney&&a.push({itemId:1450,cnt:t.rewards.gamemoney}),0<t.rewards.money&&a.push({itemId:1451,cnt:t.rewards.money}),0<t.rewards.exp&&a.push({itemId:1452,cnt:t.rewards.exp}),0<t.rewards.energy&&a.push({itemId:1453,cnt:t.rewards.energy});var n=t.rewards.items;if(1==t.id&&(n=DonotDestroyManager.GameData.Charge.vip_levels[MyPersistDataManager._playerData.vip_level].award),0<n.length)
for(var i=0;i<n.length;++i)
a.push({itemId:n[i][0],cnt:n[i][1]});var r=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(r),r.getComponent("GetRewardPanel")._itemlist=a,r.getComponent("GetRewardPanel")._closeCb=this.awardCloseCb.bind(this);for(i=0;i<this._showList.length;++i)
if(this._showList[i].mission_tpl_id==e.mission_tpl_id){21==this._showList[i].mission_tpl_id&&(this._isLunchGet=!0),22==this._showList[i].mission_tpl_id&&(this._isDinnerGet=!0);for(var s=0;s<MyPersistDataManager._playerData.daymissionlist.length;++s)
MyPersistDataManager._playerData.daymissionlist[s].mission_tpl_id==this._showList[i].mission_tpl_id&&MyPersistDataManager._playerData.daymissionlist.splice(s,1);this.SetMissionItem(MyPersistDataManager._playerData.daymissionlist);break}},DailyMissionList_auth_cb:function(e){MyPersistDataManager._playerData.daymissionlist=e.missions,this.SetMissionItem(MyPersistDataManager._playerData.daymissionlist),this.mScrollView.stopAutoScroll(),this.mScrollView.scrollToTop(),this.node.runAction(cc.sequence(cc.delayTime(.25),cc.callFunc(function(){this.showGuide()},this)))},awardCloseCb:function(){l.isLevelUpAble()&&cc.loader.loadRes("Prefab/ui/mainhome/LevelUpLayer",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);l.showLevelUpLayer(a,function(){})})},setParams:function(e){this._params=e,this.closeCb=e.closeCb,this.ScaleToLarge(),0==MyPersistDataManager._playerData.daymissionlist.length?i.send_C2SDailyMissionList(DonotDestroyManager._gameSocket):(this.SetMissionItem(MyPersistDataManager._playerData.daymissionlist),this.node.runAction(cc.sequence(cc.delayTime(.3),cc.callFunc(function(){this.showGuide()},this))))},SetMissionItem:function(e){this._isLunchGet=this.JudgeIsGet(e,21),this._isDinnerGet=this.JudgeIsGet(e,22),this._isMidNightGet=this.JudgeIsGet(e,23),this._showList=e.concat();for(var l=this.JudgeTime(),t=e.length-1;0<=t;--t)
if((21==e[t].mission_tpl_id||22==e[t].mission_tpl_id||23==e[t].mission_tpl_id)&&l!=e[t].mission_tpl_id)
for(var a=0;a<this._showList.length;++a)
this._showList[a]==e[t]&&this._showList.splice(a,1);if(this._showList.sort(function(e,t){var a,n=e.mission_tpl_id,i=t.mission_tpl_id,r=DonotDestroyManager.GameData.DailyMissions[n],s=DonotDestroyManager.GameData.DailyMissions[i],o=0,c=0;21==n||22==n||23==n?l==n&&3600*(a=new Date).getHours()+60*a.getMinutes()+a.getSeconds()>=r.timelimit[0]&&(o=1):e.progress>=r.mission_require[1]?o=2:1==r.order&&(o=1);21==i||22==i||23==i?l==i&&3600*(a=new Date).getHours()+60*a.getMinutes()+a.getSeconds()>=s.timelimit[0]&&(c=1):t.progress>=s.mission_require[1]?c=2:1==s.order&&(c=1);return c-o}),this.content=this.mScrollView.content,this.content.height=this._showList.length*(this.itemTemplateHeight+this.spacing)+this.spacing,0==this.content.children.length){this._spawnItems=[],this.updateTimer=0,this.updateInterval=.2;for(var n=this.lastContentPosY=0;n<this.spawnCount;++n){var i=cc.instantiate(this.itemTemplate);this.content.addChild(i),i.setPosition(0,-i.height*(.5+n)-this.spacing*(n+1)),i.getComponent("DayMissionItem").updateItem(n),this._spawnItems.push(i)}
var r=!0;if(0<this._showList.length){var s=this._showList[0],o=s.mission_tpl_id,c=DonotDestroyManager.GameData.DailyMissions[o];s.progress<c.mission_require[1]&&(r=!1)}
null==this._params.scrollOffset||r||this.node.runAction(cc.sequence(cc.delayTime(.02),cc.callFunc(function(){this.mScrollView.scrollToOffset(this._params.scrollOffset)},this)))}else
for(var h=this.updateTimer=0;h<this.spawnCount;++h){var d=this._spawnItems[h];d.setPosition(0,-d.height*(.5+h)-this.spacing*(h+1)),d.getComponent("DayMissionItem").updateItem(h)}},markScrollOffset:function(){var e=this.mScrollView.getScrollOffset();null!=this._params&&this._params instanceof Object&&(this._params.scrollOffset=e)},JudgeIsGet:function(e,t){for(var a=0;a<e.length;++a)
if(e[a].mission_tpl_id==t)
return!1;return!0},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},JudgeTime:function(){var e=new Date,t=3600*e.getHours()+60*e.getMinutes()+e.getSeconds();return t<DonotDestroyManager.GameData.DailyMissions[21].timelimit[1]?this._isLunchGet?22:21:t<DonotDestroyManager.GameData.DailyMissions[22].timelimit[1]?this._isDinnerGet?23:22:23},showGuide:function(){var n=this;c.showGuide("DayActivityLayer",function(e){if(1==e){var t=n.m_pItemContent.children[0].getComponent("DayMissionItem").goToBtn,a=n.m_pItemContent.children[0].getComponent("DayMissionItem").awardBtn;return 1==t.node.activeInHierarchy?t.node:a.node}})},getRewardAll:function(e){n.playBtnOpenEffect(),i.send_C2SDailyMissionGetAwardAll(DonotDestroyManager._gameSocket)},getPositionInView:function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.mScrollView.node.convertToNodeSpaceAR(t)},update:function(e){if(this.updateTimer+=e,!(this.updateTimer<this.updateInterval)){this.updateTimer=0;var t=this._spawnItems;if(null!=t){for(var a=this.bufferZone,n=this.mScrollView.content.y<this.lastContentPosY,i=(this.itemTemplateHeight+this.spacing)*t.length,r=0;r<t.length;++r){var s=this.getPositionInView(t[r]);if(n){if(s.y<-a&&t[r].y+i<0){t[r].setPositionY(t[r].y+i);var o=t[r].getComponent("DayMissionItem"),c=o._itemID-t.length;o.updateItem(c)}}else if(s.y>a&&t[r].y-i>-this.content.height){t[r].setPositionY(t[r].y-i);var l=t[r].getComponent("DayMissionItem"),h=l._itemID+t.length;l.updateItem(h)}}
this.lastContentPosY=this.mScrollView.content.y}}}});cc._RF.pop()},{ArenaBufferMgr:"ArenaBufferMgr",GuideBufferMgr:"GuideBufferMgr",GuozhanBufferMgr:"GuozhanBufferMgr",GuozhanFightBufferMgr:"GuozhanFightBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",OverComeBufferMgr:"OverComeBufferMgr",PkBufferMgr:"PkBufferMgr",PlayerBufferMgr:"PlayerBufferMgr",SecretBufferMgr:"SecretBufferMgr",SoundUtil:"SoundUtil"}],DayMissionItemAward1:[function(e,t,a){"use strict";cc._RF.push(t,"08141swTXZA7Yubr2U7Ykfm","DayMissionItemAward1"),cc.Class({extends:cc.Component,properties:{itemImage:cc.Sprite,itemImageFrame:[cc.SpriteFrame],itemMoneyNum:cc.Label,_isGameMoney:!1,_isExp:!1},onLoad:function(){},ChangeData:function(e){this._isExp?this.itemImage.spriteFrame=this.itemImageFrame[2]:this._isGameMoney?this.itemImage.spriteFrame=this.itemImageFrame[0]:this.itemImage.spriteFrame=this.itemImageFrame[1],this.itemMoneyNum.string="x"+e}}),cc._RF.pop()},{}],DayMissionItem:[function(e,t,a){"use strict";cc._RF.push(t,"fa8e9mWNJNJebxWMGWWq+qr","DayMissionItem");var s=e("ColorUtil"),o=e("MyProtocols"),c=(e("NetEvent"),e("MyEventDispatcher"),e("GameUtils")),l=(e("i18n"),e("DayActivityLayer")),h=e("SoundUtil"),r={act_1:0,act_2:1,pkIcon:2,tubiao10:3,tubiao11:4,tubiao12:5,tubiao1:6,tubiao2:7,tubiao3:8,tubiao4:9,tubiao5:10,tubiao6:11,tubiao7:12,tubiao8:13,tubiao9:14,mineIcon:15,secretIcon:16,gzIcon:17,charge8:18,charge10:19};cc.Class({extends:cc.Component,properties:{missionName:cc.Label,missionDes:cc.Label,missionImage:cc.Sprite,res_mission_title_img:[cc.SpriteFrame],missionPro:cc.Label,missionRewardPrefabs:[cc.Prefab],rewardContent:cc.Node,missionItemBg:[cc.SpriteFrame],itemBgSprite:cc.Sprite,goToBtn:cc.Button,jinduNode:cc.Node,awardBtn:cc.Button,energyItem:cc.SpriteFrame,showSprite:cc.Sprite,_missionId:0,_missionPro:0,_itemId:0,_itemcfg:null,_timeState:0,_eatNode:null,GoToPanel:{default:null,type:Object},_itemID:0},onLoad:function(){this.GoToPanel={9:MyUiManager.PanelInfo.VipPayMgn,3:MyUiManager.PanelInfo.StageMapPanel,4:MyUiManager.PanelInfo.StageMapPanel,5:MyUiManager.PanelInfo.AreanMainLayer,7:MyUiManager.PanelInfo.SnatchMainLayer,1:MyUiManager.PanelInfo.BuyGameMoney,6:MyUiManager.PanelInfo.StoreHousePanel,2:MyUiManager.PanelInfo.RecruitPanel,8:MyUiManager.PanelInfo.FightThroughLayer,10:MyUiManager.PanelInfo.ArmyPanel,12:MyUiManager.PanelInfo.WeeklyBattleLayer,13:MyUiManager.PanelInfo.EpicBattleLayer,14:MyUiManager.PanelInfo.VipPayMgn,15:MyUiManager.PanelInfo.VipPayMgn,16:MyUiManager.PanelInfo.RankLayer,17:MyUiManager.PanelInfo.MineMainPanel,18:MyUiManager.PanelInfo.SecretMainPanel,19:MyUiManager.PanelInfo.GuoZhanMainPanel}},onDestroy:function(){},updateItem:function(e){this._itemID=e,this.Init()},Init:function(){var e=l.getInstance()._showList;this._itemID<e.length?(this._missionId=e[this._itemID].mission_tpl_id,this._missionPro=e[this._itemID].progress,this.ReadInfo()):this.node.active=!1},ReadInfo:function(){var e=DonotDestroyManager.GameData.DailyMissions[this._missionId];this.missionName.string=e.name,this.missionDes.string=e.des;var t=e.icon.replace(/.png/,""),a=r[t];if(this.missionImage.spriteFrame=this.res_mission_title_img[a],21==this._missionId||22==this._missionId||23==this._missionId){var n=new Date;if(3600*n.getHours()+60*n.getMinutes()+n.getSeconds()<e.timelimit[0]){if(this.missionPro.node.active=!0,this.missionPro.string=e.timelimit[0]/3600+":00 - "+e.timelimit[1]/3600+":00",this.missionPro.node.setPositionX(250),this.jinduNode.active=!1,this.goToBtn.node.active=!1,this.awardBtn.node.active=!1,this.itemBgSprite.spriteFrame=this.missionItemBg[0],null==this._eatNode){var i=new cc.Node("New Sprite");i.addComponent(cc.Sprite).spriteFrame=this.energyItem,i.setPosition(cc.v2(274,-14)),i.parent=this.node,this._eatNode=i}
this.goToBtn.node.active=!1}else
this.goToBtn.node.active=!1,this.jinduNode.active=!1,this.missionPro.node.active=!1,this.awardBtn.node.active=!0,this.itemBgSprite.spriteFrame=this.missionItemBg[1]}else
null!=this._eatNode&&(this._eatNode.removeFromParent(),this._eatNode.destroy(),this._eatNode=null,this.missionPro.node.setPositionX(274)),this._missionPro>=e.mission_require[1]||14==e.mission_require[0]||15==e.mission_require[0]||9==e.mission_require[0]?(this.goToBtn.node.active=!1,this.jinduNode.active=!1,this.missionPro.node.active=!1,this.awardBtn.node.active=!0,this.itemBgSprite.spriteFrame=this.missionItemBg[1]):(this.goToBtn.node.active=!0,this.jinduNode.active=!0,this.missionPro.node.active=!0,this.awardBtn.node.active=!1,this.itemBgSprite.spriteFrame=this.missionItemBg[0],this.missionPro.string=this._missionPro+"/"+e.mission_require[1]);this.GetRewardInfo(e)},JudgeStage:function(e){},GetRewardInfo:function(e){if(0<this.rewardContent.children.length&&c.destroyAllChildren(this.rewardContent),0<e.rewards.gamemoney){var t=cc.instantiate(this.missionRewardPrefabs[0]),a=t.getComponent("DayMissionItemAward1");a._isGameMoney=!0,a._isExp=!1,a.ChangeData(e.rewards.gamemoney),this.rewardContent.addChild(t)}
0<e.rewards.money&&((a=(t=cc.instantiate(this.missionRewardPrefabs[0])).getComponent("DayMissionItemAward1"))._isGameMoney=!1,a._isExp=!1,a.ChangeData(e.rewards.money),this.rewardContent.addChild(t)),0<e.rewards.exp&&((a=(t=cc.instantiate(this.missionRewardPrefabs[0])).getComponent("DayMissionItemAward1"))._isExp=!0,a.ChangeData(e.rewards.exp),this.rewardContent.addChild(t));var n=e.rewards.items;if(1==e.id&&(n=DonotDestroyManager.GameData.Charge.vip_levels[MyPersistDataManager._playerData.vip_level].award),0<n.length)
for(var i=0;i<n.length;++i){var r=(t=cc.instantiate(this.missionRewardPrefabs[1])).getComponent(cc.Label);this._itemId=n[i][0],this.GetItemCfg(),r.node.color=s.getColorByQuality(this._itemcfg[this._itemId].quality),r.string=this._itemcfg[this._itemId].name+"x"+n[i][1],this.rewardContent.addChild(t)}},GetItemCfg:function(){null!=DonotDestroyManager.GameData.Consumes[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Consumes:null!=DonotDestroyManager.GameData.Boxes[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Boxes:null!=DonotDestroyManager.GameData.Items[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Items:null!=DonotDestroyManager.GameData.Equips[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Equips:null!=DonotDestroyManager.GameData.EquipFrags[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.EquipFrags:null!=DonotDestroyManager.GameData.Treasures[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Treasures:null!=DonotDestroyManager.GameData.CardFrags[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.CardFrags:null!=DonotDestroyManager.GameData.UnitsEquips[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.UnitsEquips:null!=DonotDestroyManager.GameData.TreasureFrags[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.TreasureFrags:null!=DonotDestroyManager.GameData.Cards[this._itemId]&&(this._itemcfg=DonotDestroyManager.GameData.Cards)},AwardBtn_onClickHandler:function(){o.send_C2SDailyMissionGetAward(DonotDestroyManager._gameSocket,this._missionId)},GoToBtn_onClickHandler:function(e,t){h.playBtnOpenEffect(),null!=l.getInstance()&&l.getInstance().markScrollOffset();var a=DonotDestroyManager.GameData.DailyMissions[this._missionId].mission_require[0];if(null!=this.GoToPanel[a])
if(3==a)
MyUiManager.Open(this.GoToPanel[a],{iselite:!1});else if(4==a)
MyUiManager.Open(this.GoToPanel[a],{iselite:!0});else if(6==a)
MyUiManager.Open(this.GoToPanel[a],{index:1});else if(5==a)
o.send_C2SArenaView(DonotDestroyManager._gameSocket,0);else if(8==a)
o.send_C2SOvercomeInfoAll(DonotDestroyManager._gameSocket,0);else if(16==a)
o.send_C2SRankView(DonotDestroyManager._gameSocket,1);else if(17==a){for(var n=MyPersistDataManager._playerData.level,i=DonotDestroyManager.GameData.Common.mine_levels,r=0,s=0;s<i.length-1&&n>=i[s];s++)
r=s;o.send_C2SMineList(DonotDestroyManager._gameSocket,r,0)}else
18==a?o.send_C2SSecretView(DonotDestroyManager._gameSocket):19==a?o.send_C2SGuozhanView(DonotDestroyManager._gameSocket):MyUiManager.Open(this.GoToPanel[a],"")}}),cc._RF.pop()},{ColorUtil:"ColorUtil",DayActivityLayer:"DayActivityLayer",GameUtils:"GameUtils",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],DoNotDestroyMng:[function(e,t,a){"use strict";cc._RF.push(t,"75ec4lascBMjJz4g5Dvfeap","DoNotDestroyMng");var n=e("LejiSocket"),i=(e("MyEventDispatcher"),e("NetEvent"),{1:"3.1.165.199",2:"3.1.165.199",3:"3.1.165.199",4:"3.1.165.199",5:"3.1.165.199",6:"3.1.165.199",7:"3.1.165.199",8:"3.1.165.199",9:"3.1.165.199",10:"3.1.165.199",11:"3.1.165.199",12:"3.1.165.199",13:"3.1.165.199",14:"3.1.165.199",15:"3.1.165.199",16:"3.1.165.199",17:"3.1.165.199",18:"3.1.165.199",19:"3.1.165.199",20:"3.1.165.199"});cc.Class({extends:cc.Component,properties:{login_host:{default:1,type:cc.Enum({" nội võng ":1,"h5 ngoạn đi ":2,"Egame ngoại võng thí nghiệm ":3," dịch tiếp - lam nguyệt ":4,"h5 liên vận ":5," ngoại võng thí nghiệm ":6," bản hào xét duyệt ":7," thâm quyến tức thác -iOS":8," Thượng Hải điển du -iOS":9," Bắc Kinh lưu diệp -iOS":10," thâm quyến tinh đằng -iOS":11," thâm quyến sang phú -iOS":12," Quảng Châu thường thường -iOS":13," Quảng Châu đậu ngoạn - đuôi dài ":14," Quảng Châu đậu ngoạn -iOS":15," thâm quyến meo meo nhân -iOS":16," Hải Nam sướng khốc -bt":17," Quảng Châu thiên chiến - mãn V":18," tam quốc danh tướng truyền - mãn V":19,"quick- quả hạch ":20})},login_port:8650,login_port_nossl:8550,isGm:{default:0,type:cc.Enum({" đóng cửa ":0," mở ra ":1})},jsbChannel:{default:0,type:cc.Enum({" bạch bao ":0," dịch tiếp ":1,"iOS-h5":2,"iOS-gnetop":3,"iOS-yunbee":4,"iOS-liuye":5,"iOS-xingteng":6,"iOS-chuangfu":7,"iOS-pingping":8,"iOS-douwan":9,"iOS-miaoren":10,"185syRHsdk":11,"tianzhan-manv":12,"quick-sdk-h5":13})},loadingLayer:{default:null,type:cc.Prefab},ShortLoadingLayer:{default:null,type:cc.Prefab},FloattipPanel:{default:null,type:cc.Prefab},AlertLayer:{default:null,type:cc.Prefab},DescribeTip:{default:null,type:cc.Prefab},BattleUnitPic:{default:null,type:cc.SpriteFrame},MarqueeWidget:{default:null,type:cc.Prefab},_loginSocket:{default:null,type:n},_iconSpriteFrameMap:{default:{},type:Object},GuideLayer:{default:null,type:cc.Prefab},_gameServerInfo:Object,_gameSocket:{default:null,type:n},HeroDataList:[],GameData:Object,_YiJieSwitchAccountInfo:null,_packageId:null},onLoad:function(){if(cc.game.addPersistRootNode(this.node),window.DonotDestroyManager=this,window.YIJIEAPI=this.node.getComponent("YiJieManager"),window.JSB_OPEN_API=this.node.getComponent("IosOpenManager"),window.MyUiManager=this.node.getComponent("UiManager"),window.MyBgMusicManager=this.node.getComponent("BgMusicManager"),window.MyPersistDataManager=this.node.getComponent("PersistDataManager"),null!=window.open_platform&&(2==window.open_platform?this.login_host=2:this.login_host=5),6==this.login_host?(this.login_port=9650,this.login_port_nossl=9550):7==this.login_host?(this.login_port=7650,this.login_port_nossl=7550):8==this.login_host?(this.login_port=9850,this.login_port_nossl=9750):9==this.login_host?(this.login_port=9850,this.login_port_nossl=9750):14==this.login_host?(this.login_port=9650,this.login_port_nossl=9550):17==this.login_host?(this.login_port=9650,this.login_port_nossl=9550):18==this.login_host&&(this.login_port=9650,this.login_port_nossl=9550),13==this.jsbChannel){QuickSDK.init("49344721508032723063567440653497","42280595",!0,function(){console.log("init success"),this.initSocket()}.bind(this))}else
this.initSocket()},initSocket:function(){var e="wss://"+i[this.login_host]+":"+this.login_port+"/ws";2!=this.login_host&&5!=this.login_host&&20!=this.login_host&&(e="ws://"+i[this.login_host]+":"+this.login_port_nossl+"/ws"),this._loginSocket=new n(e)},onDestroy:function(){this._loginSocket.close()},_keyHandler:function(e,t){switch(e){case cc.KEY.back:11==DonotDestroyManager.jsbChannel?cc.sys.os===cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","exit","()V"):12==DonotDestroyManager.jsbChannel&&cc.sys.os===cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","exit","()V");break;default:return}}}),cc._RF.pop()},{LejiSocket:"LejiSocket",MyEventDispatcher:"MyEventDispatcher",NetEvent:"NetEvent"}],EffectsManager:[function(t,e,a){"use strict";cc._RF.push(e,"5500cgKUylGA4B9hS9Z0NGn","EffectsManager");var n=t("BattleManager"),i=t("BattleConstants"),r=function(){this.effectActors=[],this.poolMap=new Map};r.prototype.resetData=function(){this.effectActors=[],this.poolMap.forEach(function(e,t){e.clear()}),this.poolMap.clear()},r.prototype.putPool=function(e,t){var a=this.poolMap.get(e);null==a&&(a=new cc.NodePool(e),this.poolMap.set(e,a)),a.put(t)},r.prototype.getPool=function(e){var t=this.poolMap.get(e);return null!=t?t.get():null},r.prototype.createEffect=function(){var e=new(t("Effect"));return this.effectActors.push(e),e},r.prototype.getCfgById=function(e){return DonotDestroyManager.GameData.Effects[e]},r.prototype.removeEffect=function(e){for(var t=this.effectActors.length-1;0<=t;t--){e==this.effectActors[t]&&this.effectActors.splice(t,1)}},r.prototype.getPositionYWithoutShield=function(e,t,a){for(var n=a,i=0;i<this.effectActors.length;i++){var r=this.effectActors[i];if(r.id==e){var s,o=(s=null!=r.node?r.getPosition():r.target).x,c=s.y;Math.abs(o-t)<70&&(n=Math.max(n,c+30))}}
return n},r.prototype.onUpdate=function(e){for(var t=0;t<this.effectActors.length;t++){var a=this.effectActors[t];n.btlState==i._BTL_STATE.PAUSE&&a.pauseAble||a.onUpdate(e)}},r.prototype.pause=function(){for(var e=0;e<this.effectActors.length;e++){var t=this.effectActors[e];t.pauseAble&&"Display"==t.getState()&&t.doEvent("Pause")}},r.prototype.resume=function(){for(var e=0;e<this.effectActors.length;e++){var t=this.effectActors[e];t.pauseAble&&"Paused"==t.getState()&&t.doEvent("Resume")}},e.exports=new r,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleManager:"BattleManager",Effect:"Effect"}],Effect:[function(n,e,t){"use strict";cc._RF.push(e,"46f713wp55A2aputlFyFRQL","Effect");var i=n("EffectsManager"),a=n("BattleConstants"),r=n("state-machine"),s=n("MyEventDispatcher"),o=0,c=1,l=2,h=3,d=5,_=6,u=7,m=cc.Class({extends:n("WActor"),properties:{},ctor:function(){cc.log("Effect create!"),this.id=0,this.cfg=null,this.delayTime=0,this.direction=1,this.target=null,this.callback=null,this.complete=null,this.pauseAble=!0,this.autoEnd=!0,this.targetX=0,this.targetY=0},setFSM:function(){var i=this;this.fsm=r.create({initial:"Init",events:[{name:"Start",from:"Init",to:"Display"},{name:"Pause",from:"Display",to:"Paused"},{name:"Resume",from:"Paused",to:"Display"},{name:"End",from:"Display",to:"Complete"},{name:"Cancel",from:"*",to:"Complete"}],callbacks:{onenterstate:function(e,t,a){},onafterStart:function(e,t,a,n){i.onafterStart(e,t,a,n)},onafterPause:function(e,t,a,n){i.onafterPause()},onafterResume:function(e,t,a,n){i.onafterResume()},onafterDead:function(){i.onafterDead()},onenterInit:function(){i.onenterInit()},onenterComplete:function(){i.onenterComplete()}}})},setPosition:function(e,t){this.cfg.layer==c||this.cfg.layer==l||this.cfg.layer==u?this.node.setPosition(e,t):this.node.setPosition(e-t/2,t)},onenterInit:function(){if(this.cfg=this.cfg||i.getCfgById(this.id),this.delayTime=this.delayTime||0,!this.target.x&&!this.target.y){var e=this.target.getPosition();this.targetX=e.x,this.targetY=e.y}
var t="Prefab/battle/effects/"+this.cfg.file,a=n("BattleSceneMgr");this.node=i.getPool(this.cfg.file),null==this.node&&(this.node=cc.instantiate(a.getInstance()._raw_assets[t]))},onafterStart:function(){this.display()},onafterPause:function(){if(this.node&&this.node.active&&this.node.activeInHierarchy){var e=this.node.getComponent("dragonBones.ArmatureDisplay");if(null!=e.armature()&&null!=e.armature().animation){var t=null;t=e.armature().animation.lastAnimationName,e.armature().animation.stop(t)}}},onafterResume:function(){if(this.node&&this.node.active&&this.node.activeInHierarchy){var e=this.node.getComponent("dragonBones.ArmatureDisplay");if(null!=e.armature()&&null!=e.armature().animation){var t=null;t=e.armature().animation.lastAnimationName,e.armature().animation.fadeIn(t,-1,-1,0,"normal")}}},onenterComplete:function(){if(null!=this.node&&cc.isValid(this.node)){var e=this.node.getComponent("dragonBones.ArmatureDisplay");null!=e&&(e.removeEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),e.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this)),this.node=i.putPool(this.cfg.file,this.node)}},onUpdate:function(e){if("Init"==this.getState()){var t=cc.director.getScheduler().getTimeScale();this.delayTime=this.delayTime-t*e,this.delayTime<0&&this.doEvent("Start")}},display:function(){var e=null!=this.cfg.times?this.cfg.times:1,t=null!=this.cfg.scale?this.cfg.scale:1,a=this.target.x,n=this.target.y;if(!a&&!n){var i=this.cfg.x||0,r=this.cfg.y||0;this.cfg.layer==c||this.cfg.layer==l?(a=i*this.direction,n=r,"Hero"==this.target.class&&(this.cfg.offsetx&&(a+=this.cfg.offsetx),this.cfg.offsety&&(n+=this.cfg.offsety))):(a=this.targetX+i*this.direction,n=this.targetY+r)}
this.setPosition(a,n),this.setScale(t*this.direction,t),this.add2Target();var s=this.node.getComponent("dragonBones.ArmatureDisplay");s.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),s.addEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),null!=s.armature()&&null!=s.armature().animation&&s.armature().animation.fadeIn(this.cfg.action||this.cfg.file,-1,e,0,"normal")},_frameEventHandler:function(e){"fire"==e.detail.name?this.onFire():"shake"==e.detail.name&&this.onShake()},_animationEventHandler:function(e){e.type==dragonBones.EventObject.COMPLETE&&(this.node.getComponent("dragonBones.ArmatureDisplay").removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this.autoEnd&&this.doEvent("End"),this.complete&&this.complete())},add2Target:function(){if(this.cfg.layer==o)
this.setLocalZOrder(a._BTL_ZORDER.BF_BEHIND),this.add2Parent();else if(this.cfg.layer==c)
cc.assert(this.target.node,"target must be Unit"),this.setLocalZOrder(a._BTL_ZORDER.U_BELOW),this.add2Parent(this.target.node);else if(this.cfg.layer==l)
cc.assert(this.target.node,"target must be Unit"),this.setLocalZOrder(a._BTL_ZORDER.U_ABOVE),this.add2Parent(this.target.node);else if(this.cfg.layer==h)
this.pauseAble?this.setLocalZOrder(a._BTL_ZORDER.BF_FRONT):this.setLocalZOrder(a._BTL_ZORDER.BF_BIGSK),this.add2Parent();else if(this.cfg.layer==d){var e=this.getPosition().y;this.setLocalZOrder(a._BTL_ZORDER.BF_FIELD-e+1),this.add2Parent()}else if(this.cfg.layer==_){e=this.getPosition().y;this.setLocalZOrder(a._BTL_ZORDER.BF_FIELD-e-1),this.add2Parent()}else if(this.cfg.layer==u){this.setLocalZOrder(a._BTL_ZORDER.BF_FRONT);var t=n("BattleUiMgr");this.add2Parent(t.getInstance().ui_node)}},onFire:function(){if(this.callback){var e=this.target.x,t=this.target.y;e||t||(e=this.targetX,t=this.targetY),this.callback(e,t,this.direction)}},onShake:function(){s.dispatchEvent("onShakeScreen")}});e.exports=m,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleSceneMgr:"BattleSceneMgr",BattleUiMgr:"BattleUiMgr",EffectsManager:"EffectsManager",MyEventDispatcher:"MyEventDispatcher",WActor:"WActor","state-machine":"state-machine"}],ElitePVEBattleManager:[function(u,e,t){"use strict";cc._RF.push(e,"c2fd7xeTYRMCphEhZOfoZgQ","ElitePVEBattleManager");var a=u("BattleUtil"),n=u("TeamDataUtil"),_=u("BattleDataManager"),c=u("StageEventCfgMgr"),m=u("EliteStagesConfigMgr"),p=u("BattleManager"),f=u("EliteStageBufferMgr"),r=u("MyProtocols"),i=function(){};i.prototype.init=function(e,t,a){this.stageId=e,this.stageCfg=m.getStageByStageId(e),this.leftData=n.getLeftData(),this.leftData.fightVal=t,this.rightData=this.getElitePVERightData(e),this.rightData.fightVal=a,this.extraBattleTeam(),this.extraBattleBuff(),this.background=DonotDestroyManager.GameData.EliteStageMobs[e].battleground,this.mCostEnergy=this.stageCfg.energy_cost,this.mStageTag="PVE_ELITE_"+this.stageId},i.prototype.extraBattleTeam=function(){for(var e=this.rightData.stage_event,t=c.getEvtTeamList(e),a=0;a<t.length;a++)
for(var n=t[a],i=0;i<n.length;i++){var r=n[i];if("left"==r.side)
for(var s=0;s<r.list.length;s++){var o=r.list[s];this.leftData.extraTeams.push(o)}
else if("right"==r.side)
for(s=0;s<r.list.length;s++){o=r.list[s];this.rightData.extraTeams.push(o)}}},i.prototype.extraBattleBuff=function(){for(var e=this.rightData.stage_event,t=c.getEvtBuffList(e),a=0;a<t.length;a++){var n=t[a];this.rightData.extraBuffs.push(n)}},i.prototype.getElitePVERightData=function(e){var t=m.getStageByStageId(e),a=m.getEliteGroup(e),n=DonotDestroyManager.GameData.EliteStageMobs[e],i={};i.name=cc.js.formatStr("Cứ Điểm %d",e%100),t.isboss&&(i.name=a.name),i.side="right",i.level=30,i.formation=n.formation,i.forward=n.forward,i.flip=n.flip;var r=_.create(i);r.stageId=e,r.stage_event=t.stage_event,r.isMobHero=!0,r.stars=t.stars;for(var s=Object.keys(n),o=0;o<s.length;o++){var c=s[o];if("formation"!==c&&"forward"!==c&&"flip"!==c&&"battleground"!==c){var l=n[c];if(!DonotDestroyManager.GameData.Common.FIGHT_CONTROL_ENEMY[4]){var h={},d=t.attrs[l.mob_type-1];h.hero={},h.hero.id=l.mob_id,h.hero.level=d.level,h.hero.grade=d.card_grade,d.add_attrs.rates&&(h.hero.rates_maxhp=d.add_attrs.rates.maxhp,h.hero.rates_atk=d.add_attrs.rates.atk,h.hero.rates_def=d.add_attrs.rates.def),d.add_attrs.statics&&(h.hero.static_maxhp=d.add_attrs.statics.maxhp,h.hero.static_atk=d.add_attrs.statics.atk,h.hero.static_def=d.add_attrs.statics.def),h.unit_num=d.unit_num,h.unit_grade=d.unit_grade,h.unit_level=d.unit_level,r.addHeroWithPosition(h,l.position)}}}
return r},i.prototype.enterBattlefield=function(){var e={background:this.background,teamAiCfg:DonotDestroyManager.GameData.TeamSkillsAI[2][this.stageId],type:2},t=this;a.createBattlefield(this.leftData,this.rightData,e,function(){t.onSuccess()},function(){t.onFailure()}),a.enterRealScene()},i.prototype.onSuccess=function(){var e=m.getGroupIdByStage(this.stageId),t=m.getStageIndex(this.stageId),a=p.getFightTime(),n=p.getOurHPPercent(),i=p.getOurHeroDeadNum();r.send_C2SEliteStageEnd(DonotDestroyManager._gameSocket,e-1,t,!0,a,n,i)},i.prototype.onSuccessCb=function(e){var t=m.getStageIdByIndex(e.group_index+1,e.stage_index),a=DonotDestroyManager.GameData.EliteStages[e.group_index].stage[t];if(null==MyPersistDataManager._playerData.chapterseliteMap[e.group_index+1]){var n={stages:[],star_award:[]};n.stages.push({star:e.star,times:e.times}),MyPersistDataManager._playerData.chapterseliteMap[e.group_index+1]=n,MyPersistDataManager._playerData.chapterselitelist.push(n);var i=m.getNextStage(t);f.setStageIdUnLock(i)}else{var r=MyPersistDataManager._playerData.chapterseliteMap[e.group_index+1].stages[e.stage_index];if(null==r){MyPersistDataManager._playerData.chapterseliteMap[e.group_index+1].stages[e.stage_index]={star:e.star,times:e.times};i=m.getNextStage(t);f.setStageIdUnLock(i)}else
r.times=e.times,e.star>r.star&&(r.star=e.star)}
if(a.isboss&&(MyPersistDataManager._playerData.elite_count--,MyPersistDataManager._playerData.elite_count<0&&(MyPersistDataManager._playerData.elite_count=0)),p.btlWin){var s=p.getFightTime(),o=p.getOurHPPercent(),c=p.getOurHeroDeadNum();cc.log("ElitePVEBattleManager ----------- %d,%d,%d",s,o,c);var l=u("BattleSceneMgr"),h=cc.instantiate(l.getInstance()._raw_assets["Prefab/ui/battle/battleWinPanel"]);cc.Canvas.instance.node.addChild(h),e.addexp=a.exp,e.addGmoney=a.gamemoney;var d=h.getComponent("BattleWinMgr");d.ChangeData(e),d.setStatistics(this.leftData,this.rightData,p.statistics),d.setStarCfg(a),d.sequencePlay()}else{l=u("BattleSceneMgr");var _=cc.instantiate(l.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(_),_.getComponent("BattleFailMgr").initUi(0,{staticData:p.statistics})}},i.prototype.onFailure=function(){var e=u("BattleSceneMgr"),t=cc.instantiate(e.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(t),t.getComponent("BattleFailMgr").initUi(0,{staticData:p.statistics})},e.exports=new i,cc._RF.pop()},{BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleUtil:"BattleUtil",EliteStageBufferMgr:"EliteStageBufferMgr",EliteStagesConfigMgr:"EliteStagesConfigMgr",MyProtocols:"MyProtocols",StageEventCfgMgr:"StageEventCfgMgr",TeamDataUtil:"TeamDataUtil"}],EliteRewardItem:[function(e,t,a){"use strict";cc._RF.push(t,"f6f53R4TMpE0ZNk2WbkFYBe","EliteRewardItem");var n=e("ColorUtil"),i=e("StageEliteSelectPanel");cc.Class({extends:cc.Component,properties:{m_pItemBox:cc.Prefab,m_pItemParent:cc.Node,m_pName:cc.Label,_itemid:-1,index:-1,_itemscript:null},onLoad:function(){},changeData:function(){this._itemid=i.getInstance()._rewardinfolist[this.index],this.Init()},Init:function(){this.CreateItemBox(),this.m_pName.string=this._itemscript._itemjsoninfo.name,this.m_pName.node.color=n.getColorByQuality(this._itemscript._itemjsoninfo.quality)},CreateItemBox:function(){var e=null;null!=this._itemscript?e=this._itemscript.node:(e=cc.instantiate(this.m_pItemBox),this.m_pItemParent.addChild(e)),this._itemscript=e.getComponent("ItemBox"),this._itemscript.ChangeItemInfo(this._itemid,0,!1,null,!0)}}),cc._RF.pop()},{ColorUtil:"ColorUtil",StageEliteSelectPanel:"StageEliteSelectPanel"}],EliteStageBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"9c233xVboFHb73o4LkiBVs8","EliteStageBufferMgr");var n=function(){this.mStageList=[],this.mStarRewards={},this.mLastChapterid=0};n.prototype.isStageIdPassed=function(e){var t=Math.floor(e/100),a=e%100-1;return null!=MyPersistDataManager._playerData.chapterseliteMap&&null!=MyPersistDataManager._playerData.chapterselitelist[t]&&null!=MyPersistDataManager._playerData.chapterselitelist[t].stages[a]},n.prototype.getCurChapStageSubId=function(){return null==MyPersistDataManager._playerData.chapterselitelist||MyPersistDataManager._playerData.chapterselitelist.length<=0?[1,1,101]:(this.mGroupId=MyPersistDataManager._playerData.chapterselitelist.length,this.mChapterId=Math.ceil(this.mGroupId/5),this.mStageId=MyPersistDataManager._playerData.chapterselitelist[this.mGroupId-1].stages.length+100*this.mGroupId,[this.mChapterId,this.mGroupId,this.mStageId])},n.prototype.checkEliteTimesEnough=function(){return 0<MyPersistDataManager._playerData.elite_count},n.prototype.setStageIdUnLock=function(e){this.mStageIdPass=e},n.prototype.getStageIdUnLock=function(){return this.mStageIdPass||0},t.exports=new n,cc._RF.pop()},{}],EliteStageSelectItem:[function(e,t,a){"use strict";cc._RF.push(t,"7efb1PRUtxHh6811orSGtCa","EliteStageSelectItem");var n=e("StageEliteSelectPanel"),i=e("MyProtocols"),r=(e("GameUtils"),e("ElitePVEBattleManager")),s=e("EliteStageBufferMgr"),o=e("PlayerBufferMgr"),c=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pRewardContent:cc.Node,m_pBossContent:cc.Node,m_pNobossContent:cc.Node,m_plocknormal:cc.Sprite,m_plockboss:cc.Sprite,m_pDizuo:cc.Sprite,m_pQizhi:cc.Sprite,m_pTopTip:cc.Sprite,m_pBossicon:cc.Sprite,m_pItembox:cc.Prefab,mUnlcokPrefab:cc.Prefab,m_pItemparent:cc.Node,m_pnormalstarcontent:cc.Node,m_pbossstarcontent:cc.Node,m_predbossicon:cc.Sprite,m_pStarnormallist:[cc.Sprite],m_pStarbosslist:[cc.Sprite],m_pQizhilist:[cc.SpriteFrame],m_pDizuolist:[cc.SpriteFrame],m_pBossstarsprlist:[cc.SpriteFrame],m_pStarSprlist:[cc.SpriteFrame],_stageindex:-1,_isboss:!1,_curstar:-1,_stageinfo:null,_ispass:!1,_curStageindex:-1,_curgroup:-1,_stageid:-1,_isgetreward:!1,_stagenormalspr:null,_stagePressSpr:null,_stagegaoliang:null,_unlockNode:cc.Node},onLoad:function(){},ChangeData:function(e){this._stageinfo=e.info,this._stagejson=e.json,this._stageindex=e.stageindex,this._curStageindex=e.curstage,this._curgroup=e.group,this._stageid=e.stageid,this.Init()},RefreshRewardinfo:function(e){this._stageinfo=e,this._isgetreward=null!=this._stageinfo&&this._stageinfo.is_get_award,this.m_pRewardContent.active=!this._isgetreward},Init:function(){this._isboss=this._stagejson.isboss,this._curstar=null==this._stageinfo?0:this._stageinfo.star,this._ispass=null!=this._stageinfo,this._isgetreward=null!=this._stageinfo&&this._stageinfo.is_get_award,this._isboss?(this.m_pBossContent.active=!0,this.m_pNobossContent.active=!1,this.SetUnlockState(this.m_pbossstarcontent,this.m_plockboss.node),this.SetStarState(this.m_pStarbosslist,this.m_pBossstarsprlist),this.LoadbossIcon()):(this.m_pBossContent.active=!1,this.m_pNobossContent.active=!0,this.SetUnlockState(this.m_pnormalstarcontent,this.m_plocknormal.node),this.SetStarState(this.m_pStarnormallist,this.m_pStarSprlist),this.Createrewarditem(),this._stageindex<this._curStageindex&&(this.m_pQizhi.spriteFrame=this._ispass?this.m_pQizhilist[2]:this.m_pQizhilist[1],this.m_pRewardContent.active=!this._isgetreward,this.m_pDizuo.spriteFrame=this.m_pDizuolist[1]))},LoadbossIcon:function(){var a=this,e="Chapter"+n.getInstance()._curchapterid,t=DonotDestroyManager.GameData.EliteStages[this._curgroup-1];cc.log(" quan tạp đường nhỏ ==="+e),cc.loader.loadRes("UI/StageMap/"+e+"/"+t.icon[0].replace(".png",""),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load icon success!"),a._stagenormalspr=t,a.m_pBossicon.spriteFrame=t,a.m_pBossicon.getComponent(cc.Button).normalSprite=t}),cc.loader.loadRes("UI/StageMap/"+e+"/"+t.icon[1].replace(".png",""),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load icon success!"),a._stagePressSpr=t,a.m_pBossicon.getComponent(cc.Button).pressedSprite=t}),this._ispass?cc.loader.loadRes("UI/StageMap/"+e+"/"+t.icon[2].replace(".png",""),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load icon success!"),a._stagegaoliang=t,a.m_predbossicon.spriteFrame=t}):this.m_predbossicon.node.active=!1},SetUnlockState:function(e,t){if(this._stageindex<this._curStageindex)
return e.active=!0,void(t.active=!1);t.active=!this._ispass,e.active=this._ispass},SetStarState:function(e,t){for(var a=0;a<e.length;++a)
a<this._curstar?e[a].spriteFrame=t[1]:e[a].spriteFrame=t[0]},StageOnClickHandler:function(e){if(c.playBtnOpenEffect(),this._stageindex>this._curStageindex-1)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Nguyên soái,cần chiếm Cứ Điểm trước đây!");else{if(this._isboss){if(!s.checkEliteTimesEnough())
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Đã dùng hết số lần khiêu chiến ngày!");if(o.getUserEnergy()<this._stagejson.energy_cost)
return MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không đủ thể lực!"),void MyUiManager.Open(MyUiManager.PanelInfo.BuyEnergy,{});this.RemoveAssets()}
DonotDestroyManager.GameData.EliteStages[this._curgroup-1];var t={name:"Cứ Điểm"+(this._stageindex+1)+" LV30",fight:0,formation:DonotDestroyManager.GameData.EliteStageMobs[this._stageid].formation,flip:DonotDestroyManager.GameData.EliteStageMobs[this._stageid].flip,forward:DonotDestroyManager.GameData.EliteStageMobs[this._stageid].forward,Teams:this.GetEnemyTeams(),id:this._stageid},a={energy_cost:this._stagejson.energy_cost,fid:1};r.init(t.id),t.teams=r.rightData.teams,MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:t,panelinfo:a,battletype:2})}},GetEnemyTeams:function(){for(var e=DonotDestroyManager.GameData.EliteStageMobs[this._stageid],t=1,a=[];null!=e[t];){var n={};n.id=e[t].mob_id,n.level=this._stagejson.attrs[e[t].mob_type-1].level,n.position=e[t].position,a.push(n),++t}
return a},Reward_OnClickHandler:function(e){c.playBtnOpenEffect(),this._stageindex>this._curStageindex-1?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Nhận thưởng sau khi chiếm Cứ Điểm hiện tại!"):this._stageindex!=this._curStageindex-1?i.send_C2SElitePointAwardGet(DonotDestroyManager._gameSocket,this._curgroup-1,this._stageindex):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Chiếm Cứ Điểm để nhận")},Createrewarditem:function(){var e=cc.instantiate(this.m_pItembox);this.m_pItemparent.addChild(e),e.getComponent("ItemBox").ChangeItemInfo(this._stagejson.first_drops[0].items[0][0],0,!1,this.Reward_OnClickHandler.bind(this))},RemoveAssets:function(){this.m_pBossicon.spriteFrame=null,this.m_pBossicon.getComponent(cc.Button).normalSprite=null,this.m_pBossicon.getComponent(cc.Button).pressedSprite=null,this.m_predbossicon.spriteFrame=null,this._stagenormalspr=null,this._stagePressSpr=null,this._stagegaoliang=null},getGuideNode:function(){return this._isboss?this.m_pBossContent.getChildByName("stage_1"):this.m_pNobossContent},onDestroy:function(){},playUnlock:function(){this._unlockNode=cc.instantiate(this.mUnlcokPrefab),this.node.addChild(this._unlockNode),this.node.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){c.playUnlockLevelEffect(),this._unlockNode.getComponent(dragonBones.ArmatureDisplay).armature().animation.fadeIn("action1",-1,-1,0,"normal")},this))),this._unlockNode.getComponent(dragonBones.ArmatureDisplay).addEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),s.setStageIdUnLock(0)},_animationEventHandler:function(e){e.type===dragonBones.EventObject.COMPLETE&&this._unlockNode.destroy()}}),cc._RF.pop()},{ElitePVEBattleManager:"ElitePVEBattleManager",EliteStageBufferMgr:"EliteStageBufferMgr",GameUtils:"GameUtils",MyProtocols:"MyProtocols",PlayerBufferMgr:"PlayerBufferMgr",SoundUtil:"SoundUtil",StageEliteSelectPanel:"StageEliteSelectPanel"}],EliteStagesConfigMgr:[function(e,t,a){"use strict";cc._RF.push(t,"e3cbfBnsx5IcIOH7VvNan3r","EliteStagesConfigMgr");var n=function(){};n.getEliteGroup=function(e){var t=Math.floor(e/100-1);return DonotDestroyManager.GameData.EliteStages[t]},n.getGroupIdByStage=function(e){return Math.floor(e/100)},n.getStageIndex=function(e){return e%100-1},n.getStageGroup=function(e){return DonotDestroyManager.GameData.EliteStages[e]},n.getStageGroupNameById=function(e){return this.getStageGroup(e).name},n.getStageGroupNameId=function(e){var t=this.getStageGroupNameById(this.getGroupIdByStage(e)),a=0;return a=1e3<e?e.toString().substr(2):e.toString().substr(1),cc.js.formatStr("%s*Ải %s",t,parseInt(a))},n.getStageByStageId=function(e){return n.getEliteGroup(e).stage[e]},n.getStageIdByIndex=function(e,t){DonotDestroyManager.GameData.EliteStages[e-1];return 100*e+t+1},n.getStageFallList=function(e){for(var t=[],a=DonotDestroyManager.GameData.EliteStages,n=0;n<a.length;++n){var i=!1,r=Object.keys(a[n].stage),s=r.indexOf("_iN$t");-1<s&&r.splice(s,1);for(var o=0;o<r.length;++o){if(a[n].stage[r[o]].isboss)
for(var c={},l=!1,h=0;h<a[n].stage[r[o]].drops.length;++h){for(var d=0;d<a[n].stage[r[o]].drops[h].items.length;++d)
if(a[n].stage[r[o]].drops[h].items[d][0]==e){c.chapter_id=a[n].chapter_id,c.prev_elitestage_group=a[n].prev_elitestage_group,c.stageId=parseInt(r[o]),c.name=a[n].name,c.stageType=2,t.push(c),l=!0;break}
if(l){i=!0;break}}
if(i)
break}}
return t},n.getLastStageIdGroup=function(e){for(var t=DonotDestroyManager.GameData.EliteStages[e-1],a=Object.keys(t.stage),n=0,i=0;i<a.length;++i){var r=a[i];parseInt(r)>n&&(n=parseInt(r))}
return n},n.getGroupRequireLevel=function(e){var t=DonotDestroyManager.GameData.EliteStages[e-1];return null!=t?t.require_level:-1},n.getStageCount=function(e){var t=Object.keys(e.stage),a=t.indexOf("_iN$t");return-1<a&&t.splice(a,1),t.length},n.getNextStage=function(e){var t=n.getGroupIdByStage(e),a=n.getLastStageIdGroup(t);return e<a?e+1:e==a&&t<DonotDestroyManager.GameData.EliteStages.length?100*(t+1)+1:e},t.exports=n,cc._RF.pop()},{}],EmBattleDataManager:[function(e,t,a){"use strict";cc._RF.push(t,"26aaaL4MRdDbJHcJ8MVzkSN","EmBattleDataManager");var n=e("BattleBufferMgr"),i=e("NetEvent"),r=e("MyProtocols"),s=e("MyEventDispatcher"),o=e("OverComeBufferMgr"),c=e("ArenaBufferMgr"),l=e("AreanBattleManager"),h=e("SoundUtil"),d=e("ActivityBufferMgr"),_=e("SnatchBufferMgr"),u=e("SnatchBattleManager"),m=e("MarqueeBufferMgr"),p=e("MineBufferMgr"),f=e("MineBattleManager"),g=e("SecretBufferMgr"),y=e("SecretBattleManager"),v=e("BossBufferMgr"),M=e("BossBattleManager"),S=e("GuozhanBufferMgr"),C=e("GuozhanOfficeBattleManager");cc.Class({extends:cc.Component,properties:{_battlepanel:null,_neweffectinfo:null,_myFight:cc.Integer,_otherFight:cc.Integer},onLoad:function(){this._battlepanel=this.node.getComponent("BattleFormationPanel"),this._neweffectinfo=cc.sys.localStorage.getItem(MyPersistDataManager._playerData.server_id+"newformation"+MyPersistDataManager._playerData.id),this._BattleFormationSave_auth_cb_func=this._BattleFormationSave_auth_cb.bind(this),s.addListener(i.S2CBattleFormationSave,this._BattleFormationSave_auth_cb_func),this.S2CArenaBattleStart_cb_func=this.S2CArenaBattleStart_cb.bind(this),s.addListener(i.S2CArenaBattleStart,this.S2CArenaBattleStart_cb_func),this.S2CTreasureRobBattleStart_cb_func=this.S2CTreasureRobBattleStart_cb.bind(this),s.addListener(i.S2CTreasureRobBattleStart,this.S2CTreasureRobBattleStart_cb_func),this.S2CMineEnemyDetail_cb_func=this.S2CMineEnemyDetail_cb.bind(this),s.addListener(i.S2CMineEnemyDetail,this.S2CMineEnemyDetail_cb_func),this.S2CSecretBattleStart_cb_func=this.S2CSecretBattleStart_cb.bind(this),s.addListener(i.S2CSecretBattleStart,this.S2CSecretBattleStart_cb_func),this.S2CBossBattleStart_cb_func=this.S2CBossBattleStart_cb.bind(this),s.addListener(i.S2CBossBattleStart,this.S2CBossBattleStart_cb_func),this.S2CGuozhanOfficeStart_cb_func=this.S2CGuozhanOfficeStart_cb.bind(this),s.addListener(i.S2CGuozhanOfficeStart,this.S2CGuozhanOfficeStart_cb_func)},onDestroy:function(){s.removeListener(i.S2CBattleFormationSave,this._BattleFormationSave_auth_cb_func),s.removeListener(i.S2CArenaBattleStart,this.S2CArenaBattleStart_cb_func),s.removeListener(i.S2CTreasureRobBattleStart,this.S2CTreasureRobBattleStart_cb_func),s.removeListener(i.S2CMineEnemyDetail,this.S2CMineEnemyDetail_cb_func),s.removeListener(i.S2CSecretBattleStart,this.S2CSecretBattleStart_cb_func),s.removeListener(i.S2CBossBattleStart,this.S2CBossBattleStart_cb_func),s.removeListener(i.S2CGuozhanOfficeStart,this.S2CGuozhanOfficeStart_cb_func)},S2CGuozhanOfficeStart_cb:function(e){MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),m.setMarqueeCanPlay(!1),S.updateR(e.rand_key);var t=S.getOfficeEnemyData();C.init(t,this._myFight,this._otherFight),C.enterBattlefield()},S2CBossBattleStart_cb:function(e){var t=e.level_index;v.updateR(e.r),MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),m.setMarqueeCanPlay(!1),M.init(t,this._myFight,this._otherFight),M.enterBattlefield()},S2CSecretBattleStart_cb:function(){MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),MyUiManager.Remove2Panel(76,!0),m.setMarqueeCanPlay(!1),y.init(this._battlepanel._rightinfo.id,this._myFight,this._otherFight),y.enterBattlefield()},S2CMineEnemyDetail_cb:function(e){MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),m.setMarqueeCanPlay(!1),p.setRightHero(e),f.init(e,this._myFight,this._otherFight),f.enterBattlefield()},S2CTreasureRobBattleStart_cb:function(e){0!=e.result?(MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),MyUiManager.Remove2Panel(53,!0),m.setMarqueeCanPlay(!1),u.init(u.mEmenyData,this._myFight,this._otherFight),u.rand_key=e.rand_key,u.enterBattlefield()):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không thể Đoạt Bảo!")},S2CArenaBattleStart_cb:function(e){if(cc.log(" tiếp thu hay không có thể chiến đấu tin tức "),0!=e.result){h.playBtnOpenEffect(),MyUiManager.ClearOpenList(),MyUiManager.RemoveBackList(17),m.setMarqueeCanPlay(!1);var t=c.getRightHero();l.init(t,this._myFight,this._otherFight),l.randkey=e.rand_key,l.enterBattlefield()}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không thể PK")},_BattleFormationSave_auth_cb:function(e){cc.log(" bảo tồn trận hình S2C tin tức nhận ")},UpdateInfo:function(e){n.setFormationData(this._battlepanel._fid,e),this._battlepanel._isChangeData=!1,this._battlepanel.UpdateOnLineformationInfo()},SendBattleFormationSave:function(e){10==this._battlepanel._battleType?r.send_C2SMineDefFormationSave(DonotDestroyManager._gameSocket,this._battlepanel._panelinfo.level_index,this._battlepanel._panelinfo.point_index,e):r.send_C2SBattleFormationSave(DonotDestroyManager._gameSocket,e),this.UpdateInfo(e),this._battlepanel.RefreshFight()},SendArenaBattleStart:function(){var e=c.getRightIndex();r.send_C2SArenaBattleStart(DonotDestroyManager._gameSocket,e)},SendTreasureRobStart:function(){var e=_.getbattleindex();r.send_C2STreasureRobBattleStart(DonotDestroyManager._gameSocket,e)},SendMineBattleStart:function(){var e=p.getRightHero();r.send_C2SMineEnemyDetail(DonotDestroyManager._gameSocket,e.level_index,e.point_index)},SendSecretBattleStart:function(){var e=g.getMapId(),t=g.getOnlineFormation();r.send_C2SSecretBattleStart(DonotDestroyManager._gameSocket,e,t)},SendBossBattleStart:function(){var e=v.getLevelIndex();r.send_C2SBossBattleStart(DonotDestroyManager._gameSocket,e)},SendGuozhanOfficeStart:function(){var e=S.targetOfficeIndex();r.send_C2SGuozhanOfficeStart(DonotDestroyManager._gameSocket,e)},CheckNeedSendSaveFormation:function(){if(this._battlepanel._onlineformation.flip==this._battlepanel._flip&&this._battlepanel._onlineformation.forward==this._battlepanel._forward||(this._battlepanel._isChangeData=!0),this._battlepanel._isChangeData){var e={};e.formationId=this._battlepanel._curFormationID,e.forward=this._battlepanel._forward,e.flip=this._battlepanel._flip,e.fid=this._battlepanel._fid;for(var t=Object.keys(this._battlepanel._heroformationmap),a=0;a<t.length;++a)
e[t[a]]=this._battlepanel._heroformationmap[t[a]];this.SendBattleFormationSave(e)}},ChangeNewOnLineFormation:function(e,t){for(var a={},n=[],i=Object.keys(e),r=-1,s=0;s<i.length;++s){r=-1;for(var o=0;o<t.length;++o)
t[o]==e[i[s]]&&(r=o);-1!=r?(t.splice(r,1),a[i[s]]=e[i[s]]):(0<e[i[s]]&&n.push(i[s]),a[i[s]]=0)}
if(t.length<=0&&n<=0)
return null;var c=0;for(s=0;s<i.length;++s)
a[i[s]]<=0&&c<t.length&&(a[i[s]]=t[c],++c);return a},SetFormationmoveinfo:function(e){this._battlepanel._forward=e.forward,this._battlepanel._flip=e.flip},GetCurFormationID:function(){return null==this._battlepanel._onlineformation?1:this._battlepanel._onlineformation.formationId},GetOnlineFormation:function(e){return n.getFormationData(e)},GetHeroFormationMap:function(){if(null==this._battlepanel._onlineformation)
return null;var e={};if(e.a=this._battlepanel._onlineformation.a,e.b=this._battlepanel._onlineformation.b,e.c=this._battlepanel._onlineformation.c,e.d=this._battlepanel._onlineformation.d,e.e=this._battlepanel._onlineformation.e,e.f=this._battlepanel._onlineformation.f,e.g=this._battlepanel._onlineformation.g,e.h=this._battlepanel._onlineformation.h,e.i=this._battlepanel._onlineformation.i,e.j=this._battlepanel._onlineformation.j,3==this._battlepanel._battleType)
for(var t=Object.keys(e),a=0;a<t.length;++a){0<(n=e[t[a]])&&(o.isOurHeroLive(n)||(e[t[a]]=0),null==MyPersistDataManager._playerData.cardsMaplist[n]&&(e[t[a]]=0))}
if(5==this._battlepanel._battleType)
for(t=Object.keys(e),a=0;a<t.length;++a){var n=e[t[a]],i=d.judgeHeroGroup();if(0<n&&5!=i)
DonotDestroyManager.GameData.Cards[n].group!=i&&(e[t[a]]=0),null==MyPersistDataManager._playerData.cardsMaplist[n]&&(e[t[a]]=0)}
return e},GetFormationIndex:function(e){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){var t=5*(e[0]-1)+e[1]-1+(null!=this._battlepanel._rightinfo.forward?5*this._battlepanel._rightinfo.forward:0);if(null!=this._battlepanel._rightinfo.flip&&1==this._battlepanel._rightinfo.flip){var a=t%5;t=5*parseInt(t/5)+4-a}
return t}
var n=5*(e[0]-1)+e[1]-1+5*this._battlepanel._forward;if(1==this._battlepanel._flip){var i=5*parseInt(n/5)+2;return i+(i-n)}
return n},SetFormationData:function(){this._battlepanel._formation=[],this._battlepanel._formationPosMap={},this._battlepanel._formationeffectmap={};for(var e=Object.keys(this._battlepanel._formationJson.positions),t=0;t<e.length;t++){var a=this.GetFormationIndex(this._battlepanel._formationJson.positions[e[t]]);this._battlepanel._formation.push(a),this._battlepanel._formationPosMap[a]=e[t],null!=this._battlepanel._formationJson.actions[e[t]].material&&0<this._battlepanel._formationJson.actions[e[t]].material.length&&(this._battlepanel._formationeffectmap[a]=this._battlepanel._formationJson.actions[e[t]])}
this._battlepanel._formation.sort(function(e,t){if(e!=t)
return e-t})},GetFormationMaxId:function(){for(var e=0,t=0;t<this._battlepanel._formation.length;++t)
this._battlepanel._formation[t]>=e&&(e=this._battlepanel._formation[t]);return e},GetFormationMinId:function(){for(var e=100,t=0;t<this._battlepanel._formation.length;++t)
this._battlepanel._formation[t]<=e&&(e=this._battlepanel._formation[t]);return e},GetTouchSquare:function(e,t,a){for(var n=this._battlepanel._myHeromap[t].m_pHeroItem.convertToWorldSpace(cc.v2(65,0)),i=-1,r=0;r<this._battlepanel._formation.length;++r){var s=a[this._battlepanel._formation[r]].m_pselfItem.convertToWorldSpace(cc.v2(85,60)),o=cc.pSub(n,s);Math.abs(o.x)<80&&Math.abs(o.y)<55&&(i=a[this._battlepanel._formation[r]].m_nId)}
return-1==i?-1:i},GetTouchHeroIndex:function(e){for(var t=this.node.convertTouchToNodeSpace(e.touch),a=this.node.convertToWorldSpace(t),n=-1,i=0;i<this._battlepanel._formation.length;++i)
if(-1!=this._battlepanel._mysquaremap[this._battlepanel._formation[i]].m_pheroid){var r=this._battlepanel._mysquaremap[this._battlepanel._formation[i]].m_pselfItem.convertToWorldSpace(cc.v2(85,60)),s=cc.pSub(a,r);Math.abs(s.x)<80&&Math.abs(s.y)<55&&(n=this._battlepanel._mysquaremap[this._battlepanel._formation[i]].m_pheroid)}
return-1==n?-1:(this._battlepanel._curtouchid=e.touch.getID(),n)},MoveBg:function(e,t){var a=this.node.convertTouchToNodeSpace(e.touch),n=this.node.convertToWorldSpace(a),i=e.getPreviousLocation(),r=this.node.convertToWorldSpace(i),s=cc.pAdd(t.getPosition(),cc.pSub(n,r)),o=parseInt((t.width*t.scale-cc.Canvas.instance.node.width)/2),c=parseInt((t.height*t.scale-cc.Canvas.instance.node.height)/2);s.x>o?s.x=o:s.x<-o&&(s.x=-o),s.y>c?s.y=c:s.y<-c&&(s.y=-c),t.setPosition(s)},SetBgScale:function(e,t){var a=e.getTouches()[0],n=e.getTouches()[1],i=a.getLocation(),r=n.getLocation(),s=cc.pDistance(a.getPreviousLocation(),n.getPreviousLocation()),o=cc.pDistance(i,r)/s*t.scale;o<=1&&(o=1),1.8<=o&&(o=1.8),t.scale=o;var c=parseInt((t.width*t.scale-cc.Canvas.instance.node.width)/2),l=parseInt((t.height*t.scale-cc.Canvas.instance.node.height)/2);t.x>c?t.x=c:t.x<-c&&(t.x=-c),t.y>l?t.y=l:t.y<-l&&(t.y=-l)}});cc._RF.pop()},{ActivityBufferMgr:"ActivityBufferMgr",AreanBattleManager:"AreanBattleManager",ArenaBufferMgr:"ArenaBufferMgr",BattleBufferMgr:"BattleBufferMgr",BossBattleManager:"BossBattleManager",BossBufferMgr:"BossBufferMgr",GuozhanBufferMgr:"GuozhanBufferMgr",GuozhanOfficeBattleManager:"GuozhanOfficeBattleManager",MarqueeBufferMgr:"MarqueeBufferMgr",MineBattleManager:"MineBattleManager",MineBufferMgr:"MineBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",OverComeBufferMgr:"OverComeBufferMgr",SecretBattleManager:"SecretBattleManager",SecretBufferMgr:"SecretBufferMgr",SnatchBattleManager:"SnatchBattleManager",SnatchBufferMgr:"SnatchBufferMgr",SoundUtil:"SoundUtil"}],EnableTouch:[function(e,t,a){"use strict";cc._RF.push(t,"1f8fb3CC4lMGobQL3dMNJK5","EnableTouch"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.on("touchstart",function(){})}}),cc._RF.pop()},{}],EnermyBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"28c66jcPr1Fi4qP/jM0ncKj","EnermyBufferMgr");var n=e("HeroConfigMgr"),i=function(){this.g_enermyData={},this.g_enermyData.enemyList=[]};i.myInstance=null,i.getInstance=function(){return null==i.myInstance&&(i.myInstance=new i),i.myInstance},i.prototype.initEmptyEnermy=function(){this.g_enermyData={},this.g_enermyData.enemyList=[]},i.prototype.initEnermyData=function(e){if(this.initEmptyEnermy(),null!=e){for(var t in e.cards){var a=e.cards[t];a.heroCfg=n.find(a.template_id),this.g_enermyData.enemyList.push(a)}
this.g_enermyData.roleId=e.roleId,this.g_enermyData.uid=e.uid,this.g_enermyData.level=e.level,this.g_enermyData.rank=e.rank,this.g_enermyData.nickname=e.nickname,this.g_enermyData.formation=e.formation}},i.prototype.getHeroByUid=function(e){for(var t=0;t<this.g_enermyData.enemyList.length;t++){var a=this.g_enermyData.enemyList[t];if(a.template_id==e)
return a}},i.prototype.getHeroPropAttr=function(e){var t=this.getHeroByUid(e);return cc.assert(t,"Enemy[%d] is not exist",e),[t.maxhp,t.atk,t.def]},i.prototype.getHeroExtraProp=function(e){var t=this.getHeroByUid(e);return null==t?[]:t.extra_props},t.exports=i,cc._RF.pop()},{HeroConfigMgr:"HeroConfigMgr"}],EpicBattleLayer:[function(e,t,a){"use strict";cc._RF.push(t,"b7b27olS0pJdr21ivF7uI+4","EpicBattleLayer");var n=e("SoundUtil"),i=e("i18n"),r=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pEpic:[cc.Sprite],m_pEpicBtn:[cc.Button],m_pEpic1Frame:[cc.SpriteFrame],m_pEpic2Frame:[cc.SpriteFrame],m_pEpicDes:[cc.Label],_spriteFrame:[],_dateState:0,_guideBtn:cc.Node},onLoad:function(){this._spriteFrame.push(this.m_pEpic1Frame),this._spriteFrame.push(this.m_pEpic2Frame)},setParams:function(e){this.closeCb=e.closeCb,this.JudgeDate(),this.ScaleToLarge()},JudgeDate:function(){this.ClearEpic();var e=(new Date).getDay();0!=e?e%2!=0?this.ChangeEpic(0):this.ChangeEpic(1):(this.ChangeEpic(0),this.ChangeEpic(1))},ClearEpic:function(){for(var e=0;e<2;++e){this.m_pEpic[e].spriteFrame=this._spriteFrame[e][0],this.m_pEpicBtn[e].transition=cc.Button.Transition.NONE,this.m_pEpicDes[e].node.color=new cc.Color(252,253,140),this.m_pEpicBtn[e].clickEvents[0].handler="NoOpen_onClickHandler"}},ChangeEpic:function(e){null==this._guideBtn&&(this._guideBtn=this.m_pEpicBtn[e].node),this.m_pEpic[e].spriteFrame=this._spriteFrame[e][1],this.m_pEpicBtn[e].transition=cc.Button.Transition.SPRITE,this.m_pEpicBtn[e].normalSprite=this._spriteFrame[e][1],this.m_pEpicBtn[e].pressedSprite=this._spriteFrame[e][2],this.m_pEpicDes[e].node.color=new cc.Color(102,255,0),this.m_pEpicBtn[e].clickEvents[0].handler="OpenLayer_onClickHandler"},OpenLayer_onClickHandler:function(e,t){n.playBtnOpenEffect();var a=parseInt(t);MyUiManager.Open(MyUiManager.PanelInfo.SelectMissionLayer,{index:a,state:1})},NoOpen_onClickHandler:function(e,t){MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("week_001"))},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},start:function(){this.showGuide()},showGuide:function(){var t=this;r.showGuide("EpicBattleLayer",function(e){if(1==e)
return t._guideBtn})}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",SoundUtil:"SoundUtil",i18n:"i18n"}],EquipBufferMgr:[function(i,e,t){"use strict";cc._RF.push(e,"bd55br4n+tFx5jEHpFkohQW","EquipBufferMgr");var h=i("EquipEnhanceCfgMgr"),n=i("EquipCfgMgr"),d=function(){this.mEquipList=[]},a=null;d.getInstance=function(){return null==a&&(a=new d),a},d.resetData=function(){d.is_init=!1},d.is_init=!1;var r=["HP:", "Công:", "Phòng:", "Phá Giáp:", "Miễn Thương:", "Mệnh Trung:", "Né Tránh:", "Bạo Kích:", "Bạo Thương:", "ST min:", "ST max:"],s={1:"maxhp",2:"atk",4:"dmg_deal_static",8:"crit_rate",9:"crit_coef",dmg_deal_static:4,5:"dmg_get_static",10:"min_dmg",11:"max_dmg",3:"def",6:"hit_rate",def:3,maxhp:1,max_dmg:11,crit_coef:9,dmg_get_static:5,7:"dodge",min_dmg:10,crit_rate:8,dodge:7,hit_rate:6,atk:2},o={10:"speedup",11:"unit_num",12:"blood",13:"treatment",14:"anti_debuff",15:"reduce_debuff"};d.getEquipAttrName=function(e){return s[e]},d.getEquipAttrName1=function(e){return o[e]},d.getEquipAttrDes=function(e){return r[e-1]},d.getEquipByUid=function(e){return MyPersistDataManager._playerData.bagMap[e]},d.getEquipTierId=function(e){var t=MyPersistDataManager._playerData.bagMap[e];if(null!=t){var a=t.template_id;return n.getEquipConfig(a).tier}
return 0},d.prototype.initEquipList=function(e){if(!d.is_init){d.is_init=!0,this.mEquipList=[];for(var t=0;t<e.length;t++){var a=e[t];this.addEquipEntity(a)}}},d.prototype.addEquipEntity=function(e){var t=e.template_id,a=n.getEquipConfig(t);null!=a&&(e.equipCfg=a,e.unitAddState=0!=e.unitAttr.id?2:1),this.mEquipList.push(e)},d.prototype.removeEquip=function(e){for(var t=-1,a=0;a<this.mEquipList.length;++a){if(this.mEquipList[a].uuid==e){t=a;break}}
-1<t&&this.mEquipList.splice(t,1)},d.prototype.getFreeEquipByPos=function(e){for(var t=null,a=0;a<this.mEquipList.length;++a){var n=this.mEquipList[a];if(null==n.heroid)
if(DonotDestroyManager.GameData.Equips[n.template_id].position==e){t=n;break}}
return t},d.prototype.getEquipAll=function(){return this.mEquipList},d.bindHeroForEquip=function(e,t){var a=d.getEquipByUid(e);if(null!=a&&null!=a.unitAttr&&0!=a.unitAttr.id){var n=i("HeroConfigMgr").find(t);a.unitAddState=a.equipCfg.unit_type==n.unit_type?3:a.unitAddState}},d.unBindHeroForEquip=function(e){var t=d.getEquipByUid(e);null!=t&&(t.unitAddState=0!=t.unitAttr.id?2:1,delete t.heroid)},d.getEquipPropAttr=function(e,t){var a=d.getEquipByUid(e),n=0,i=0,r=0;if(null==a)
return[n,i,r];t=t||{};var s=a.template_id,o=DonotDestroyManager.GameData.Equips[s],c=t.equipLv||a.enhance_level,l=h.getAttrCoef(c);return null!=o.ori_attrs.maxhp&&(n=o.ori_attrs.maxhp+l*o.enhance_base.maxhp),null!=o.ori_attrs.atk&&(i=o.ori_attrs.atk+l*o.enhance_base.atk),null!=o.ori_attrs.def&&(r=o.ori_attrs.def+l*o.enhance_base.def),t.isNotRefine||(n+=a.hpEx,i+=a.atkEx,r+=a.defEx),[n,i,r]},d.getExtraPropAttr=function(e){for(var t=d.getEquipByUid(e),a={},n=0;n<t.attrEx.length;n++){var i=t.attrEx[n];a[d.getEquipAttrName(i.id)]=i.num}
return a},d.getEquipRefinePropAttr=function(e){var t=d.getEquipByUid(e);if(t)
return[t.hpEx,t.atkEx,t.defEx]},d.prototype.checkEquipCombineRedPoint=function(){for(var e=!1,t=new Array(4),a=0;a<this.mEquipList.length;++a){var n=this.mEquipList[a];if(null==n.heroid){var i=DonotDestroyManager.GameData.Equips[n.template_id].quality;null!=t[i]?t[i]+=1:t[i]=1}}
for(a=0;a<t.length;++a)
if(5<=t[a]){e=!0;break}
return e},e.exports=d,cc._RF.pop()},{EquipCfgMgr:"EquipCfgMgr",EquipEnhanceCfgMgr:"EquipEnhanceCfgMgr",HeroConfigMgr:"HeroConfigMgr"}],EquipCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"2ac278ObklEs6u7uod6T4C7","EquipCfgMgr"),t.exports={getEquipConfig:function(e){return DonotDestroyManager.GameData.Equips[e]}},cc._RF.pop()},{}],EquipEnhanceCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"f2e9fBonxhHUrAWuUCbCvBB","EquipEnhanceCfgMgr"),t.exports={getAttrCoef:function(e){return DonotDestroyManager.GameData.Enhanceconfig.levels[e-1].attr_coef},getLevelCnt:function(){return DonotDestroyManager.GameData.Enhanceconfig.levels.length},getMoneyCoef:function(e){var t=DonotDestroyManager.GameData.Enhanceconfig.levels[e-1];return null==t?1:t.gamemoney_coef}},cc._RF.pop()},{}],EquipFragBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"cc81fu8W1RMq5BCkB6mhH4I","EquipFragBufferMgr");var n=function(){this.equipFragList=[]};n.prototype.initList=function(e){e.length<=0?this.equipFragList=[]:this.equipFragList=e},n.prototype.AddEquipFragEntity=function(e){for(var t=null,a=0;a<this.equipFragList.length;++a){var n=this.equipFragList[a];n.template_id==e.template_id&&(t=n)}
null!=t?t.num=e.num:this.equipFragList.push(e)},n.prototype.AddEquipFragNum=function(e,t){for(var a=null,n=0,i=0;i<this.equipFragList.length;++i){var r=this.equipFragList[i];r.template_id==e&&(a=r,n=i)}
null!=a&&t<=0&&this.equipFragList.splice(n,1)},n.prototype.getList=function(){return this.equipFragList},n.prototype.hasRune=function(){return 0<this.equipFragList.length},t.exports=new n,cc._RF.pop()},{}],EquipRefineAttrItem:[function(e,t,a){"use strict";cc._RF.push(t,"843cecXG05OZb2qgrG71/7r","EquipRefineAttrItem");var n=e("EquipBufferMgr");cc.Class({extends:cc.Component,properties:{m_pLeftvalue:cc.Label,m_pRightvalue:cc.Label,m_pChangeText:cc.Label,m_pArrow:cc.Sprite,m_pArrowSpr:[cc.SpriteFrame],m_pSecondStreamer:cc.Prefab,_streamereffect:null,_armatureDisplay:null,_armature:null,_isPlayEffect:!1,_attrdata:null,_curVal:-1,_intervalId:-1},onLoad:function(){},ChangeData:function(e,t){this._attrdata=e,t?this.runSecondAct(e.refineVal,this._curVal,this.m_pRightvalue):this.RefreshAttr()},RefreshAttr:function(){var e=n.getEquipAttrDes(this._attrdata.attrtype);this.m_pLeftvalue.string=e+this._attrdata.oriVal,this.m_pRightvalue.string="(+"+this._attrdata.refineVal,this._curVal=this._attrdata.refineVal;var t=this._attrdata.changeVal;this._attrdata.isRiseTips?(this.m_pArrow.node.active=!0,0<=t?(this.m_pChangeText.string="+"+t+")",this.m_pArrow.spriteFrame=this.m_pArrowSpr[0],this.m_pRightvalue.node.color=cc.color(0,255,0),this.m_pChangeText.node.color=cc.color(0,255,0)):(this.m_pChangeText.string=t+")",this.m_pArrow.spriteFrame=this.m_pArrowSpr[1],this.m_pRightvalue.node.color=cc.color(255,0,0),this.m_pChangeText.node.color=cc.color(255,0,0))):(this.m_pArrow.node.active=!1,this.m_pChangeText.string=" tối cao "+t+")",this.m_pRightvalue.node.color=cc.color(255,255,187),this.m_pChangeText.node.color=cc.color(255,255,187)),this.m_pLeftvalue.node.color=cc.Color.WHITE,3<this._attrdata.attrtype&&(this.m_pLeftvalue.node.color=cc.color(34,204,255))},CreateEffect:function(){this._streamereffect=cc.instantiate(this.m_pSecondStreamer),this.m_pRightvalue.node.addChild(this._streamereffect),this._streamereffect.setPosition(50,0),this._armatureDisplay=this._streamereffect.getComponent(dragonBones.ArmatureDisplay),this._armature=this._armatureDisplay.armature(),this._armature.animation.fadeIn("Action1",-1,-1,0,"normal"),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this.onAnimCompleted,this)},onAnimCompleted:function(e){cc.log(" ta truyền phát tin xong rồi bắt đầu cắt bỏ "),e.type===dragonBones.EventObject.COMPLETE&&(this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onAnimCompleted,this),null!=this._streamereffect&&(this._streamereffect.removeFromParent(),this._streamereffect.destroy(),this._streamereffect=null),this.RefreshAttr())},runSecondAct:function(a,n,i,r){var s=this,o=Math.ceil((a-n)/10),c=.2;a-n!=0?this._intervalId=setInterval(function(){if(n<=a&&0<c)
i.string="(+"+n,a<=(n+=o)&&(n=a),c-=.02;else{clearInterval(s._intervalId),i.string="(+"+a;var e=i.node.color,t=cc.sequence(cc.spawn(cc.scaleTo(.1,1.5),cc.tintTo(.1,255,255,255)),cc.spawn(cc.scaleTo(.1,1),cc.tintTo(.1,255,204,0),cc.callFunc(function(){i.node.color=e}),cc.delayTime(.3),cc.callFunc(r)));i.node.runAction(t),s.CreateEffect()}},20):this.CreateEffect()},onDestroy:function(){clearInterval(this._intervalId),null!=this._armatureDisplay&&this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onAnimCompleted,this)}}),cc._RF.pop()},{EquipBufferMgr:"EquipBufferMgr"}],EquipRefineLayer:[function(e,t,a){"use strict";cc._RF.push(t,"4746eLbrVBN5rroNE8RukXb","EquipRefineLayer");var I=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=e("ColorUtil"),b=e("EquipBufferMgr"),i=e("MyEventDispatcher"),_=e("MyProtocols"),r=e("NetEvent"),u=e("SoundUtil"),s=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pItemParent:cc.Node,m_pAttrItem:cc.Node,m_pAttrParent:cc.Node,m_pGamemoney:cc.Label,m_pDiamond:cc.Label,m_pXuantie:cc.Label,m_pName:cc.Label,m_pLevel:cc.Label,lab_money_cost:cc.Label,m_p1btnlab:cc.Label,m_p5btnlab:cc.Label,m_p10btnlab:cc.Label,m_btnRefine1:cc.Node,m_btnRefine3:cc.Node,m_pTypeList:[cc.Sprite],m_pTypeSprFrame:[cc.SpriteFrame],_cb:null,_equipbuffer:null,_equipcfg:null,_isPlayEffect:!1,_attritemlist:[],_curconsumeType:-1,_ischange:!1,_currefreshTimes:-1,_itemnum:-1},onLoad:function(){this.S2CEquipRefresh_cb_func=this.S2CEquipRefresh_cb.bind(this),i.addListener(r.S2CEquipRefresh,this.S2CEquipRefresh_cb_func),this.S2CEquipRefreshSave_cb_func=this.S2CEquipRefreshSave_cb.bind(this),i.addListener(r.S2CEquipRefreshSave,this.S2CEquipRefreshSave_cb_func)},start:function(){this.showGuide()},onDestroy:function(){i.removeListener(r.S2CEquipRefresh,this.S2CEquipRefresh_cb_func),i.removeListener(r.S2CEquipRefreshSave,this.S2CEquipRefreshSave_cb_func)},setParams:function(e){this._equipbuffer=e.buffer,this._equipcfg=DonotDestroyManager.GameData.Equips[this._equipbuffer.template_id],this._cb=e.cb,this._raw_assets=e.map,this.Init()},Init:function(){this.m_pName.string=this._equipcfg.name,this.m_pName.node.color=n.getColorByQuality(this._equipcfg.quality),this.m_pLevel.string="Lv."+this._equipbuffer.enhance_level,this.RefreshData(),this.CreateTopItemBox(),this.SelectConsumeHandler(1),this.RefreshAttr(),this.lab_money_cost.string="x"+DonotDestroyManager.GameData.Refresh.costs.type3.money},S2CEquipRefresh_cb:function(e){cc.log(" Tẩy thuộc tính tin tức tiếp thu "),u.playGainGoodsEffectNew(),this.RefreshAttr(!0,{refineData:e}),this.RefreshData(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},S2CEquipRefreshSave_cb:function(e){cc.log(" Tẩy thuộc tính bảo tồn tin tức tiếp thu "),0<e.card_id&&(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight),MyPersistDataManager._playerData.bagMap[e.equip_uuid].hpEx=e.hpEx,MyPersistDataManager._playerData.bagMap[e.equip_uuid].atkEx=e.atkEx,MyPersistDataManager._playerData.bagMap[e.equip_uuid].defEx=e.defEx;for(var t=0;t<MyPersistDataManager._playerData.bagMap[e.equip_uuid].attrEx.length;++t)
for(var a=MyPersistDataManager._playerData.bagMap[e.equip_uuid].attrEx[t],n=0;n<e.attrEx.length;++n)
a.id==e.attrEx[n].id&&(a.num=e.attrEx[n].num);this._ischange=!1,this._isPlayEffect=!0,this.ChangeBtnLab(),this.RefreshAttr()},RefreshData:function(){this.m_pGamemoney.string="x"+MyPersistDataManager._playerData.gameMoney,this.m_pDiamond.string="x"+MyPersistDataManager._playerData.money,this._itemnum=0,null!=MyPersistDataManager._playerData.bagMap[1004]&&(this._itemnum=MyPersistDataManager._playerData.bagMap[1004].num),this.m_pXuantie.string="x"+this._itemnum},RefreshAttr:function(n,e){for(var i=null==e?{}:e.refineData,t=Object.keys(this._equipcfg.refresh),a=0,r=0;r<t.length;++r){var s=parseInt(t[r]);if(this._equipbuffer.enhance_level>=s&&(a=s),this._equipbuffer.enhance_level<s)
break}
var o=function(e,t){if(!n)
return c[b.getEquipAttrName(e)][0];if(1<=e&&e<=3)
return i[{1:"hpEx",2:"atkEx",3:"defEx"}
[e]];if(4<=e&&e<=11)
for(var a=0;a<i.attrEx.length;++a)
if(i.attrEx[a].id==e)
return i.attrEx[a].num},c=this._equipcfg.refresh[a],l=(Object.keys(c),[]),h=[],d=[],_=b.getEquipPropAttr(this._equipbuffer.uuid,{isNotRefine:!0}),u=I(_,3),m=u[0],p=u[1],f=u[2],g=b.getEquipRefinePropAttr(this._equipbuffer.uuid),y=I(g,3),v=y[0],M=y[1],S=y[2];l.push(m),l.push(p),l.push(f),h.push(v),h.push(M),h.push(S);for(r=0;r<3;++r){if(0<l[r])
(D={attrType:r+1})[1]=l[r],D[2]=h[r],D[3]=o(D.attrType,D[2]),d.push(D)}
var C=i.attrEx;if(null!=this._equipbuffer.attrEx&&0<this._equipbuffer.attrEx.length&&(C=this._equipbuffer.attrEx),C)
for(r=0;r<C.length;++r){(D={attrType:C[r].id,1:0})[2]=C[r].num,D[3]=o(D.attrType,D[2]),d.push(D)}
for(r=this._createindex=0;r<d.length;++r){var D=d[r];this.AddAttr(D.attrType,D[1],D[2],D[3],n)}
this._isPlayEffect=!1},ConsumeType_OnClickHandler:function(e,t){u.playBtnOpenEffect();var a=parseInt(t);this.SelectConsumeHandler(a)},SelectConsumeHandler:function(e){this._curconsumeType=e;for(var t=0;t<this.m_pTypeList.length;++t)
this.m_pTypeList[t].spriteFrame=t==e-1?this.m_pTypeSprFrame[1]:this.m_pTypeSprFrame[0]},AddAttr:function(e,t,a,n,i){var r=null;this._createindex<this._attritemlist.length?r=this._attritemlist[this._createindex]:(r=cc.instantiate(this.m_pAttrItem),this.m_pAttrParent.addChild(r),this._attritemlist.push(r)),r.active=!0,r.setPosition(0,0),r.getComponent("EquipRefineAttrItem").ChangeData({attrtype:e,oriVal:t,refineVal:a,changeVal:n,isRiseTips:i},this._isPlayEffect),++this._createindex},CreateTopItemBox:function(){var e=cc.instantiate(this._raw_assets["Prefab/ItemBox/ItemBox"]);this.m_pItemParent.addChild(e),e.getComponent("ItemBox").ChangeItemInfo(this._equipbuffer.template_id,0),e.setScale(.8)},getRefreshTimes:function(e){var t=0;return 1==e?t=1:2==e?t=5:3==e&&(t=10),t},ChangeBtnLab:function(e){e?(this.m_p1btnlab.string="Hủy",this.m_p10btnlab.string="Đổi",this.m_p5btnlab.string="Tẩy x"+e):(this.m_p1btnlab.string="Tẩy x1",this.m_p10btnlab.string="Tẩy x10",this.m_p5btnlab.string="Tẩy x5")},getRefreshReq:function(e){var t=DonotDestroyManager.GameData.Refresh.costs["type"+e];return[t.gamemoney,t.money,t.items[0]]},Refine_OnClickHandler:function(e,t){var a=parseInt(t),n=this;if(this._ischange)
switch(a){case 1:u.playBtnOpenEffect();var i=cc.instantiate(DonotDestroyManager.AlertLayer);cc.Canvas.instance.node.addChild(i),i.getComponent("AlertLayerManager").initContent("Bạn xác nhận hủy thay đổi thuộc tính lần này?",function(){n.RefreshAttr(),n._ischange=!1,n.ChangeBtnLab(),null!=i&&i.destroy()});break;case 2:var r=this.getRefreshReq(this._curconsumeType),s=I(r,3),o=s[0],c=s[1],l=s[2];if(MyPersistDataManager._playerData.gameMoney<o*this._currefreshTimes)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Không đủ Xu!");if(MyPersistDataManager._playerData.money<c*this._currefreshTimes)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Không đủ Vàng!");if(this._itemnum<l[1]*this._currefreshTimes)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Không đủ số lượng vật phẩm!");this.ChangeBtnLab(this._currefreshTimes),_.send_C2SEquipRefresh(DonotDestroyManager._gameSocket,this._equipbuffer.uuid,this._curconsumeType,this._currefreshtype);break;case 3:u.playBtnOpenEffect(),_.send_C2SEquipRefreshSave(DonotDestroyManager._gameSocket,this._equipbuffer.uuid)}
else{this._currefreshTimes=this.getRefreshTimes(a),this._currefreshtype=a;var h=this.getRefreshReq(this._curconsumeType),d=I(h,3);o=d[0],c=d[1],l=d[2];MyPersistDataManager._playerData.gameMoney<o*this._currefreshTimes?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Không đủ Xu!"):MyPersistDataManager._playerData.money<c*this._currefreshTimes?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Không đủ Vàng!"):this._itemnum<l[1]*this._currefreshTimes?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Không đủ số lượng vật phẩm!"):(this._ischange=!0,this.ChangeBtnLab(this._currefreshTimes),_.send_C2SEquipRefresh(DonotDestroyManager._gameSocket,this._equipbuffer.uuid,this._curconsumeType,a))}},Mask_OnClickHandler:function(e){MyUiManager.Back(),u.playBtnCloseEffect(),null!=this._cb&&this._cb()},showGuide:function(){var t=this;s.showGuide("EquipRefineLayer",function(e){return 1==e?t.m_btnRefine1:2==e?t.m_btnRefine3:void 0},function(){t.showGuide()})}}),cc._RF.pop()},{ColorUtil:"ColorUtil",EquipBufferMgr:"EquipBufferMgr",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],EquipStrengthLayer:[function(e,t,a){"use strict";cc._RF.push(t,"b2941/6v4xPw5BmuEUzBTg+","EquipStrengthLayer");var u=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=e("ColorUtil"),m=e("EquipBufferMgr"),n=e("EquipEnhanceCfgMgr"),i=e("MyProtocols"),s=e("NetEvent"),o=e("MyEventDispatcher"),p=e("PropHintsEffect"),c=(e("ResLoaderManager"),e("GameUtils"),e("SoundUtil")),_=e("i18n");cc.Class({extends:cc.Component,properties:{m_pItemPanet:cc.Node,m_pAttrItem:cc.Prefab,m_pEquipStr:cc.Prefab,m_pAttrParent:cc.Node,m_pName:cc.Label,m_pLevel:cc.Label,m_pMoney:cc.Label,_equipbuffer:null,_createindex:-1,_attritemlist:[],_isPlayEffect:!1,_upgradeCost:-1,_curlevel:-1,_raw_assets:{default:{},type:Object},_refresh_cb:null,_autoinfo:[]},onLoad:function(){this.S2CEquipEnhance_auth_cb_func=this.S2CEquipEnhance_auth_cb.bind(this),o.addListener(s.S2CEquipEnhance,this.S2CEquipEnhance_auth_cb_func),this.S2CEquipEnhanceAuto_auth_cb_func=this.S2CEquipEnhanceAuto_auth_cb.bind(this),o.addListener(s.S2CEquipEnhanceAuto,this.S2CEquipEnhanceAuto_auth_cb_func)},setParams:function(e){this._equipbuffer=e.equipbuffer,this._refresh_cb=e.cb,this._raw_assets=e.map,this._curlevel=this._equipbuffer.enhance_level,this.Init()},S2CEquipEnhanceAuto_auth_cb:function(e){cc.log(" tiếp đã bị tự động cường hóa tin tức "),0<e.card_id&&(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight),MyPersistDataManager._playerData.bagMap[e.equip_uuid].enhance_level=e.enhance_level,this._autoinfo=e.infos,this.AutoShoweffect(this._autoinfo)},S2CEquipEnhance_auth_cb:function(e){cc.log(" tiếp đã bị cường hóa tin tức "),0<e.card_id&&(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight),c.playEquipStrEffect(),MyPersistDataManager._playerData.bagMap[e.equip_uuid].enhance_level=e.enhance_level;var t=e.enhance_level-this._curlevel;this._curlevel=e.enhance_level,this._isPlayEffect=!0,this.RunEquipStr(t)},AutoShoweffect:function(e){if(!(null==e||e.length<=0)){c.playEquipStrEffect();var t=e[0];e.splice(0,1);var a=t.level;this._curlevel+=t.level,this._isPlayEffect=!0,this.RunEquipStr(a)}},Init:function(){this._isPlayEffect=!1;var i=this;cc.loader.loadRes("Prefab/ItemBox/ItemBox",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);i.m_pItemPanet.addChild(a);var n=a.getComponent("ItemBox");n.ChangeItemInfo(i._equipbuffer.template_id,0),i.m_pName.string=n._itemjsoninfo.name,i.m_pName.node.color=r.getColorByQuality(n._itemjsoninfo.quality)}),this.RefreshPanelLayer()},RefreshPanelLayer:function(){var e=n.getLevelCnt(),t=0;t=this._curlevel>=e?e:this._curlevel+1;var a=n.getMoneyCoef(t);MyPersistDataManager._playerData.level;this._upgradeCost=this._equipbuffer.equipCfg.enhance_base.gamemoney*a,this.m_pLevel.string="Lv."+this._curlevel+"/"+MyPersistDataManager._playerData.level,this.m_pMoney.string="x"+this._upgradeCost,this._upgradeCost>MyPersistDataManager._playerData.gameMoney?this.m_pMoney.node.color=cc.Color.RED:this.m_pMoney.node.color=cc.Color.GREEN,this.RefreshAttrText()},RefreshAttrText:function(){var e=DonotDestroyManager.GameData.Common,t=this._curlevel+1;t>e.player_max_level&&(t=e.player_max_level);var a=m.getEquipPropAttr(this._equipbuffer.uuid,{equipLv:this._curlevel}),n=u(a,3),i=n[0],r=n[1],s=n[2],o=m.getEquipPropAttr(this._equipbuffer.uuid,{equipLv:t}),c=u(o,3),l=c[0],h=c[1],d=c[2];this._createindex=0,this.AddAttr(_.t("detail_007",{value:this._curlevel}),t),0!=i&&this.AddAttr(_.t("detail_004",{value:i}),l),0!=r&&this.AddAttr(_.t("detail_005",{value:r}),h),0!=s&&this.AddAttr(_.t("detail_006",{value:s}),d)},AddAttr:function(e,t){var a=null;this._createindex<this._attritemlist.length?a=this._attritemlist[this._createindex]:(a=cc.instantiate(this.m_pAttrItem),this.m_pAttrParent.addChild(a),this._attritemlist.push(a)),a.active=!0,a.getComponent("AttributeChangeItem").ChangeData(e,t,this._isPlayEffect),++this._createindex},DisableAttr:function(){for(var e=this._createindex;e<this._attritemlist.length;++e)
this._attritemlist[e].active=!1},RunEquipStr:function(e){var t=this,a=cc.instantiate(this.m_pEquipStr);this.m_pItemPanet.addChild(a),a.setPosition(0,0),a.setScale(1.2);var n=a.getComponent(dragonBones.ArmatureDisplay);n.armature().animation.fadeIn("equipStr",-1,-1,0,"normal"),n.addEventListener(dragonBones.EventObject.COMPLETE,function(){a.removeFromParent(),a.destroy(),t.RefreshPanelLayer(),t.runEquipPropEffect(e)},this)},runEquipPropEffect:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=this,a=m.getEquipPropAttr(this._equipbuffer.uuid,{equipLv:this._curlevel}),n=u(a,3),i=n[0],r=n[1],s=n[2],o=m.getEquipPropAttr(this._equipbuffer.uuid,{equipLv:this._curlevel+1}),c=u(o,3),l=c[0],h=c[1],d=c[2],_=[];0!=i&&_.push([1,(l-i)*e]),0!=r&&_.push([2,(h-r)*e]),0!=s&&_.push([3,(d-s)*e]),p.runEquipPropEffect(this.node,{upgradeLv:e,tipPos:cc.p(0,0),propPos:cc.p(0,-100)},_,function(){t.AutoShoweffect(t._autoinfo)},this._raw_assets)},Mask_OnClickHandler:function(e){this._autoinfo=[],MyUiManager.Back(),c.playBtnCloseEffect(),null!=this._refresh_cb&&this._refresh_cb(this._equipbuffer.uuid)},Strength_OnClickHandler:function(e){this._equipbuffer.enhance_level>=MyPersistDataManager._playerData.level?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),_.t("detail_038")):this._upgradeCost>MyPersistDataManager._playerData.gameMoney?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),_.t("detail_058")):i.send_C2SEquipEnhance(DonotDestroyManager._gameSocket,this._equipbuffer.uuid)},AutoStrength_OnClickHandler:function(){this._equipbuffer.enhance_level>=MyPersistDataManager._playerData.level?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),_.t("detail_038")):this._upgradeCost>MyPersistDataManager._playerData.gameMoney?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),_.t("detail_058")):i.send_C2SEquipEnhanceAuto(DonotDestroyManager._gameSocket,this._equipbuffer.uuid)},onDestroy:function(){o.removeListener(s.S2CEquipEnhance,this.S2CEquipEnhance_auth_cb_func),o.removeListener(s.S2CEquipEnhanceAuto,this.S2CEquipEnhanceAuto_auth_cb_func)}}),cc._RF.pop()},{ColorUtil:"ColorUtil",EquipBufferMgr:"EquipBufferMgr",EquipEnhanceCfgMgr:"EquipEnhanceCfgMgr",GameUtils:"GameUtils",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",PropHintsEffect:"PropHintsEffect",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil",i18n:"i18n"}],EsFailed:[function(e,t,a){"use strict";cc._RF.push(t,"88d4aYO8ypIfaqaunha4zGx","EsFailed");var i=e("SoundUtil"),r=e("ColorUtil"),s=e("i18n");cc.Class({extends:cc.Component,properties:{m_pFailTitle:cc.Node,m_pTitleLight:cc.Node,m_pBackContent:cc.Node,m_pFrontContent:cc.Node,m_pItemBox:cc.Prefab,m_pItemEffect:cc.Prefab,m_pQuestion:cc.SpriteFrame,m_pTipsSprFrame:cc.SpriteFrame,m_pTipsFont:cc.Font,m_pLight1:cc.SpriteFrame,m_pLight2:cc.SpriteFrame,m_pBtn:cc.Button,m_pCloseBtn:cc.Button,m_pRewardPanel:cc.Prefab,m_pDes:cc.RichText,_itemsScipt:[],_gainGameMoney:[],_gainGameMoneySum:0,_backItemList:[],_frontMaskList:[],_light1List:[],_light2List:[],_itemsNameList:[]},onLoad:function(){},changeData:function(e,t,a){if(this.m_pDes.string=s.t("esmain_005"),0<t.length)
for(var n=0;n<t.length;++n)
for(var i=0;i<e.length&&(t[n]!=e[i]._uuid||(this._itemsScipt.push(e[i]),this._itemsScipt.length!=t.length));++i);else
this.m_pDes.string=s.t("esmain_006");this._gainGameMoney=a,this.Init(),this.showLigthsAction(this._light1List)},Init:function(){this.TitleLightAction(),this.SetItems()},SetItems:function(){for(var e=0;e<5;++e){var t=cc.instantiate(this.m_pItemBox),a=t.getComponent("ItemBox");if(this.m_pBackContent.addChild(t),this.SetLight2(t),this.m_pBackContent.active=!1,t.opacity=0,e<this._itemsScipt.length)
a.ChangeItemInfo(this._itemsScipt[e]._itemId,1,!0,null,!1);else{var n=e-this._itemsScipt.length;a.ChangeItemInfo(1450,this._gainGameMoney[n],!0,null,!1),this._gainGameMoneySum+=this._gainGameMoney[n]}
this._backItemList.push(a);var i=new cc.Node("skin");i.addComponent(cc.Sprite).spriteFrame=this.m_pQuestion,this.m_pFrontContent.addChild(i),this.SetLight1(i),this._frontMaskList.push(i)}},TitleLightAction:function(){var e=this;e.m_pFailTitle.opacity=0;var t=cc.delayTime(.1),a=cc.spawn(cc.fadeIn(.3),cc.moveBy(.4,cc.p(0,20))),n=cc.moveBy(.3,cc.p(0,-5));e.m_pFailTitle.runAction(cc.sequence(t,a,cc.spawn(n,cc.callFunc(function(){e.m_pTitleLight.runAction(cc.sequence(cc.spawn(cc.fadeIn(.8),cc.scaleTo(.8,2.5)),cc.delayTime(.5),cc.fadeOut(.8),cc.removeSelf(!0)))}))))},SetLight1:function(e){var t=new cc.Node("Light1");t.addComponent(cc.Sprite).spriteFrame=this.m_pLight1,e.addChild(t),t.setLocalZOrder(100),t.opacity=0,this._light1List.push(t)},SetLight2:function(e){var t=new cc.Node("Light2");t.addComponent(cc.Sprite).spriteFrame=this.m_pLight2,e.addChild(t),t.setLocalZOrder(101),t.opacity=0,this._light2List.push(t)},SetItemsName:function(e){var t=new cc.Node("Name");t.addComponent(cc.Sprite).spriteFrame=this.m_pTipsSprFrame,e.node.addChild(t),t.setContentSize(112,46),t.setPosition(0,-74);var a=new cc.Node,n=a.addComponent(cc.Label);if(t.addChild(a),1450!=e._itemId){var i="";i=3==e._itemjsoninfo.quality?"<color=#e800e8>":2==e._itemjsoninfo.quality?"<color=#0fffff>":1==e._itemjsoninfo.quality?"<color=#9aff02>":"<color=#ffffff>",i+=e._itemjsoninfo.name+"</color>",this._itemsNameList.push(i)}
a.color=r.getColorByQuality(e._itemjsoninfo.quality),n.string=e._itemjsoninfo.name,n.font=this.m_pTipsFont,n.fontSize=24,n.lineHeight=30},showLigthsAction:function(t){var a=this,n=0;a.runLigthAction(t[n],null,1,function e(){4<(n+=1)&&(n=0),a.runLigthAction(t[n],null,1,e)})},stopLigthsAction:function(e){for(var t=0;t<e.length;++t)
e[t].stopAllActions(),e[t].opacity=0},sequenceOpenCard:function(){i.playBtnCloseEffect();var t=this;t.m_pBtn.node.active=!1,t.stopLigthsAction(t._light1List);for(var e=function(e){t.runLigthAction(t._light2List[e],t._light1List[e],2,null)},a=function(e){t.m_pBackContent.active=!0,4<=e&&t.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){t.m_pDes.string=s.t("esmain_007");for(var e=0;e<t._itemsNameList.length;++e)
t.m_pDes.string+=t._itemsNameList[e],e<t._itemsNameList.length-1&&(t.m_pDes.string+=",");0!=t._gainGameMoneySum&&(t.m_pDes.string+=s.t("esmain_008",{value:t._gainGameMoneySum})),t.m_pCloseBtn.clickEvents[0].handler="CloseEsFailed_onClickHandler"})))},n=0;n<5;++n)t.runTurnCardAction(1,n,t._frontMaskList[n],t._backItemList[n].node,e,a),t.SetItemsName(t._backItemList[n])},CloseEsFailed_onClickHandler:function(e,t){i.playBtnCloseEffect(),this.node.destroy();var a=[];a.push({itemId:1450,cnt:this._gainGameMoneySum});var n=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(n),n.getComponent("GetRewardPanel")._itemlist=a},runLigthAction:function(e,t,a,n){var i=cc.spawn(cc.fadeIn(.2),cc.scaleTo(.2,1.2)),r=cc.spawn(cc.fadeOut(.2),cc.scaleTo(.2,1.2)),s=cc.spawn(cc.fadeIn(.1),cc.scaleTo(.1,1.3)),o=cc.spawn(cc.fadeOut(.4),cc.scaleTo(.4,1.6)),c=cc.delayTime(.1);1==a?e.runAction(cc.sequence(i,c,r,cc.callFunc(n))):2==a&&e.runAction(cc.sequence(cc.callFunc(function(){t.runAction(cc.sequence(cc.fadeOut(.3),cc.removeSelf(!1)))}),s,o))},runTurnCardAction:function(e,t,a,n,i,r){var s=this,o=cc.rotateBy(.4,0,-90),c=cc.rotateBy(.3,0,-90),l=cc.callFunc(function(){n.parent.active=!0,null!=i&&i(t)}),h=null;null!=r&&(h=cc.callFunc(r(t))),a.runAction(cc.sequence(cc.delayTime(.2*t),o,cc.callFunc(function(){a.getComponent(cc.Sprite).spriteFrame=s.m_pQuestion}),o,c,cc.callFunc(function(){a.getComponent(cc.Sprite).spriteFrame=s.m_pQuestion}),c,l,cc.callFunc(function(){a.opacity=0,n.opacity=255}),h))}}),cc._RF.pop()},{ColorUtil:"ColorUtil",SoundUtil:"SoundUtil",i18n:"i18n"}],EsMain:[function(e,t,a){"use strict";cc._RF.push(t,"2afd9elXgND7bHwf2DOSSa/","EsMain");var o=e("SoundUtil"),i=e("ColorUtil"),n=e("ItemBufferMgr"),c=e("MyProtocols"),r=e("NetEvent"),s=e("MyEventDispatcher"),h=e("i18n"),l=e("GuideBufferMgr"),d=cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pLeftParent:cc.Node,m_pRightContent:cc.Node,m_pTipsSprFrame:cc.SpriteFrame,m_pItemLight:cc.SpriteFrame,m_pTipsFont:cc.Font,m_pItemBox:cc.Prefab,m_pItemBoxEffect:cc.Prefab,m_pBtnInput:cc.Button,m_pBtnName:cc.Label,m_pSuccessPrefab:cc.Prefab,m_pFailPrefab:cc.Prefab,m_pRewardPanel:cc.Prefab,m_pTipPrefab:cc.Prefab,m_pComposTips:cc.Label,m_pTipsCopper:cc.Node,mFive_Buy_Btn:cc.Node,mScrollView:cc.ScrollView,itemTemplate:cc.Prefab,itemTemplateHeight:110,spawnCount:12,spacing:0,bufferZone:600,_leftItemPos:[],_leftItemList:[],_equipList:[],_rightItemScript:[],_indexNum:0},statics:{instance:null,getInstance:function(){return d.instance}},onLoad:function(){(d.instance=this)._leftItemPos=[cc.v2(0,190),cc.v2(-172,68),cc.v2(-145,-132),cc.v2(133,-132),cc.v2(170,68)],this.EquipCompose_auth_cb_func=this.EquipCompose_auth_cb.bind(this),s.addListener(r.S2CEquipCompose,this.EquipCompose_auth_cb_func),this._idSet=new Set},onDestroy:function(){s.removeListener(r.S2CEquipCompose,this.EquipCompose_auth_cb_func),d.instance=null,this._idSet.clear()},setParams:function(e){this.closeCb=e.closeCb,this.ScaleToLarge(),this.Init()},Init:function(){this.SetEquipList(),this.SetWrapItem(this._equipList),this.SetLeftItems();var e=this.m_pBtnInput.clickEvents[0];this.JudgeLeftFull()||(e.handler="PutInAll_onClickHandler",this.m_pBtnName.string=h.t("esmain_001")),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},SetEquipList:function(){this._equipList=[];for(var e=MyPersistDataManager._playerData.baglist,t=0;t<e.length;++t)
null!=DonotDestroyManager.GameData.Equips[e[t].template_id]&&n.isEquipEntity(e[t].template_id)&&null==e[t].heroid&&this._equipList.push(e[t]);this._equipList.sort(function(e,t){var a=e.template_id,n=t.template_id,i=e.enhance_level,r=t.enhance_level,s=DonotDestroyManager.GameData.Equips[a].quality,o=DonotDestroyManager.GameData.Equips[n].quality;return s!=o?o-s:i!=r?r-i:n-a})},SetWrapItem:function(e){var t=e.length%4==0?e.length/4:Math.floor(e.length/4+1);if(this.content=this.mScrollView.content,this.content.height=t*(this.itemTemplateHeight+this.spacing)+this.spacing,0==this.content.children.length){this._spawnItems=[],this.updateTimer=0,this.updateInterval=.2;for(var a=this.lastContentPosY=0;a<this.spawnCount;++a){var n=cc.instantiate(this.itemTemplate);this.content.addChild(n),n.setPosition(0,-n.height*(.5+a)-this.spacing*(a+1)),n.getComponent("EsWrapItem").updateItem(a),this._spawnItems.push(n)}}else
for(var i=this.updateTimer=0;i<this.spawnCount;++i){var r=this._spawnItems[i];r.setPosition(0,-r.height*(.5+i)-this.spacing*(i+1)),r.getComponent("EsWrapItem").updateItem(i)}},SetLeftItems:function(){if(0==this._leftItemList.length)
for(var e=0;e<5;++e){var t=cc.instantiate(this.m_pItemBox),a=t.getComponent("ItemBox");this._leftItemList.push(a),a.SetEmptyItem(),this.m_pLeftParent.addChild(t),t.setPosition(this._leftItemPos[e])}
else
for(e=0;e<5;++e){var n=this._leftItemList[e].node.getChildByName("Name");null!=n&&(n.removeFromParent(),n.destroy()),this._leftItemList[e].SetEmptyItem()}},EquipCompose_auth_cb:function(a){var n=this,i=null;if(null!=a.gain)
this.node.runAction(cc.sequence(cc.callFunc(function(){i=cc.instantiate(n.m_pSuccessPrefab),cc.Canvas.instance.node.addChild(i);var e=cc.sequence(cc.scaleTo(.05,1.05),cc.scaleTo(.06,.96),cc.scaleTo(.083,1.04),cc.scaleTo(.1,.97),cc.scaleTo(.11,1.03),cc.scaleTo(.13,.99),cc.scaleTo(.15,1.01),cc.scaleTo(.13,1));n.node.runAction(e)},this),cc.delayTime(.7),cc.callFunc(function(){var e=[];e.push({itemId:a.gain.item_template_id,cnt:a.gain.item_count});var t=cc.instantiate(n.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e,i.destroy()},this)));else{var e=(i=cc.instantiate(n.m_pFailPrefab)).getComponent("EsFailed");cc.Canvas.instance.node.addChild(i),e.changeData(this._leftItemList,a.keepItems,a.gainGameMoney)}
this._idSet.clear(),this.Init(),this.node.parent.getComponent("EsRoot").checkRedPoints()},StartCompos_onClickHandler:function(e,t){for(var a=[],n=[],i=0;i<this._leftItemList.length;++i)
a.push(this._leftItemList[i]._uuid),n.push(this._leftItemList[i]._itemjsoninfo);if(3==this._leftItemList[0]._itemjsoninfo.quality){var r=cc.instantiate(this.m_pTipPrefab),s=r.getComponent("SmelterTips");return cc.Canvas.instance.node.addChild(r),void s.changeData(n,null,null,a)}
o.playSmelterEquipEffect(),c.send_C2SEquipCompose(DonotDestroyManager._gameSocket,a)},PutInAll_onClickHandler:function(e,t){o.playBtnOpenEffect();for(var a=-1,n=-1,i=0;i<5;++i)
if(0!=this._leftItemList[i]._itemId){a=this._leftItemList[i]._itemjsoninfo.quality,n=i;break}
-1==a&&(a=this.JudgeEquipNum(3));for(var r=this._indexNum=0;r<5;++r)
if(-1==a)
this.CreatTips(2);else if(r!=n&&0==this._leftItemList[r]._itemId){if(-1==this.JudgeEquipNum(a))
return void this.CreatTips(2);this.DelayClick(r,a)}
this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){this.showGuide()},this)))},DelayClick:function(s,o){var c=this;this.m_pBtnInput.enabled=!1,this._leftItemList[s].node.runAction(cc.sequence(cc.delayTime(.2*s),cc.callFunc(function(){for(var e=0;e<c._equipList.length;++e){var t=c._equipList[e].uuid;if(o==DonotDestroyManager.GameData.Equips[c._equipList[e].template_id].quality&&!c._idSet.has(t)&&c._indexNum<5){c._indexNum++;for(var a=c.m_pRightContent,n=null,i=0;i<a.children.length&&(n=a.children[i].getComponent("EsWrapItem")._itemScriptList[e%4].getComponent("ItemBox"))._uuid!=t;++i)
n=null;null!=n&&(c._rightItemScript.length<c._leftItemList.length&&s>=c._rightItemScript.length?c._rightItemScript.push(n):s<c._rightItemScript.length&&(c._rightItemScript[s]=n),c.ItemClickEffect(n.node),n.SetSelect(!0,2)),c.ItemClickEffect(c._leftItemList[s].node);var r=c.LeftItemCancelHandler.bind(c);c._leftItemList[s].ChangeItemInfo(c._equipList[e].template_id,c._equipList[e].num,!1,r,!1),null!=c._leftItemList[s]._itemjsoninfo.tier&&0<c._leftItemList[s]._itemjsoninfo.tier&&c.SetItemEffect(c._leftItemList[s]),c._leftItemList[s]._uuid=t,c._idSet.add(t),c.SetLeftItemName(c._leftItemList[s]);break}}
c.ShowComposeTips();c.JudgeLeftFull();c.JudgeLeftFull()&&(c.m_pBtnInput.clickEvents[0].handler="StartCompos_onClickHandler",c.m_pBtnName.string=h.t("esmain_002"),c.m_pBtnInput.enabled=!0)})))},JudgeEquipNum:function(e){for(var t=0,a=0;a<this._equipList.length;++a){var n=DonotDestroyManager.GameData.Equips[this._equipList[a].template_id].quality;if(n==e&&5<=++t)
return n}
return 0<e?this.JudgeEquipNum(e-1):-1},RightItemClickHandler:function(e,t){for(var a=e.getComponent("ItemBox"),n=this.JudgeLeftFull(),i=-1,r=0;r<5;++r)
if(0!=this._leftItemList[r]._itemId){i=this._leftItemList[r]._itemjsoninfo.quality;break}
n&&!a._isselect&&this.CreatTips(0);for(r=0;r<this._leftItemList.length;++r){if(0!=this._leftItemList[r]._itemId&&a._itemjsoninfo.quality!=this._rightItemScript[r]._itemjsoninfo.quality)
return void this.CreatTips(1);if(-1!=i&&a._itemjsoninfo.quality!=i)
return void this.CreatTips(1);if(!a._isselect&&0==this._leftItemList[r]._itemId){this._rightItemScript.length<this._leftItemList.length&&r>=this._rightItemScript.length?this._rightItemScript.push(a):r<this._rightItemScript.length&&(this._rightItemScript[r]=a);var s=this.LeftItemCancelHandler.bind(this);this.ItemClickEffect(this._leftItemList[r].node),this._leftItemList[r].ChangeItemInfo(t.id,t.num,!1,s,!1),null!=this._leftItemList[r]._itemjsoninfo.tier&&0<this._leftItemList[r]._itemjsoninfo.tier&&this.SetItemEffect(this._leftItemList[r]),this._leftItemList[r]._uuid=a._uuid,this.SetLeftItemName(this._leftItemList[r]),this.ItemClickEffect(a.node),this._idSet.add(this._leftItemList[r]._uuid),a.SetSelect(!0,2);break}
if(a._isselect&&this._leftItemList[r]._itemId==t.id&&e.getComponent("ItemBox")._uuid==this._leftItemList[r]._uuid){var o=this._leftItemList[r].node.getChildByName("Name");null!=o&&(o.removeFromParent(),o.destroy());var c=this._leftItemList[r].node.getChildByName("itemBorder");null!=c&&(c.active=!1),this._idSet.delete(this._rightItemScript[r]._uuid),a.SetSelect(!1,2),this._rightItemScript[r]=null,this._leftItemList[r].SetEmptyItem();break}}
this.ShowComposeTips();var l=this.m_pBtnInput.clickEvents[0];this.JudgeLeftFull()?(l.handler="StartCompos_onClickHandler",this.m_pBtnName.string=h.t("esmain_002")):(l.handler="PutInAll_onClickHandler",this.m_pBtnName.string=h.t("esmain_001"))},LeftItemCancelHandler:function(e,t){if(null!=this._rightItemScript){for(var a=4;0<=a;a--)
if(null!=this._rightItemScript[a]&&this._leftItemList[a]._itemId==t[0]&&e.getComponent("ItemBox")._uuid==this._leftItemList[a]._uuid){var n=this._leftItemList[a].node.getChildByName("Name");null!=n&&(n.removeFromParent(),n.destroy());var i=this._leftItemList[a].node.getChildByName("itemBorder");null!=i&&(i.active=!1),this._idSet.delete(this._leftItemList[a]._uuid),this._rightItemScript[a]._uuid==this._leftItemList[a]._uuid&&(this._rightItemScript[a].SetSelect(!1,2),this._rightItemScript[a]=null),this._leftItemList[a].SetEmptyItem();break}
this.ShowComposeTips();var r=this.m_pBtnInput.clickEvents[0];this.JudgeLeftFull()||(r.handler="PutInAll_onClickHandler",this.m_pBtnName.string=h.t("esmain_001"))}},ShowComposeTips:function(){if(this.JudgeLeftFull())
for(var e=0;e<this._leftItemList.length;++e)
if(0!=this._leftItemList[e]._itemId){var t=this._leftItemList[e]._itemjsoninfo.quality,a=DonotDestroyManager.GameData.Forge.equips.synthesis;return this.m_pComposTips.node.active=!0,this.m_pTipsCopper.active=!0,void(this.m_pComposTips.string=h.t("esmain_012",{value1:a[t].gamemoney,value2:a[t].rate}))}
this.m_pTipsCopper.active=!1,this.m_pComposTips.node.active=!1},JudgeLeftFull:function(){for(var e=0;e<5;++e)
if(0==this._leftItemList[e]._itemId)
return!1;return!0},JudgeLeftHave:function(){for(var e=0;e<5;++e)
if(0<this._leftItemList[e]._itemId)
return!0;return!1},SetLeftItemName:function(e){var t=new cc.Node("Name");t.addComponent(cc.Sprite).spriteFrame=this.m_pTipsSprFrame,e.node.addChild(t),t.setContentSize(112,46),t.setPosition(0,-74);var a=new cc.Node,n=a.addComponent(cc.Label);t.addChild(a),a.color=i.getColorByQuality(e._itemjsoninfo.quality),n.string=e._itemjsoninfo.name,n.font=this.m_pTipsFont,n.fontSize=24,n.lineHeight=30},ItemClickEffect:function(e){var t=new cc.Node("Light");t.addComponent(cc.Sprite).spriteFrame=this.m_pItemLight,e.addChild(t),t.opacity=0,t.runAction(cc.sequence(cc.fadeIn(.1),cc.fadeOut(.2),cc.callFunc(function(e){e.destroy()})))},SetItemEffect:function(e){var t=e.node.getChildByName("itemBorder");null==t?(e._tiereffect=cc.instantiate(this.m_pItemBoxEffect),e.node.addChild(e._tiereffect)):t.active=!0},CreatTips:function(e){switch(e){case 0:MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),h.t("esmain_009"));break;case 1:MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),h.t("esmain_010"));break;case 2:MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),h.t("esmain_011"))}},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},showGuide:function(){var t=this;l.showGuide("EsMain",function(e){return 1==e?t.mFive_Buy_Btn:2==e?t.m_pBtnInput.node:void 0})},getPositionInView:function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.mScrollView.node.convertToNodeSpaceAR(t)},update:function(e){if(this.updateTimer+=e,!(this.updateTimer<this.updateInterval)){this.updateTimer=0;var t=this._spawnItems;if(null!=t){for(var a=this.bufferZone,n=this.mScrollView.content.y<this.lastContentPosY,i=(this.itemTemplateHeight+this.spacing)*t.length,r=0;r<t.length;++r){var s=this.getPositionInView(t[r]);if(n){if(s.y<-a&&t[r].y+i<0){t[r].setPositionY(t[r].y+i);var o=t[r].getComponent("EsWrapItem"),c=o._itemID-t.length;o.updateItem(c)}}else if(s.y>a&&t[r].y-i>-this.content.height){t[r].setPositionY(t[r].y-i);var l=t[r].getComponent("EsWrapItem"),h=l._itemID+t.length;l.updateItem(h)}}
this.lastContentPosY=this.mScrollView.content.y}}}});cc._RF.pop()},{ColorUtil:"ColorUtil",GuideBufferMgr:"GuideBufferMgr",ItemBufferMgr:"ItemBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],EsRoot:[function(e,t,a){"use strict";cc._RF.push(t,"ba2aaKJEDxDpLYXAfDOUkAc","EsRoot");var n=e("SoundUtil"),i=e("MyEventDispatcher"),r=e("MyProtocols"),s=e("NetEvent"),o=e("GuideBufferMgr"),c=e("RunesBufferMgr"),l=e("EquipBufferMgr");cc.Class({extends:cc.Component,properties:{node_equip_combine:cc.Node,node_rune_combine:cc.Node,node_rune_tab:cc.Node,node_equip_tab:cc.Node,node_rune_redmind:cc.Node,node_equip_redmind:cc.Node,res_tab_bg:[cc.SpriteFrame],_selected_tab_type:0},setParams:function(e){this.closeCb=e.closeCb,this.changeSelectTab(1)},start:function(){this.checkRedPoints()},checkRedPoints:function(){c.checkRuneCombineRedPoint()?this.node_rune_redmind.active=!0:this.node_rune_redmind.active=!1,l.getInstance().checkEquipCombineRedPoint()?this.node_equip_redmind.active=!0:this.node_equip_redmind.active=!1},onLoad:function(){this.S2CRuneSuccessRate_cb_func=this.S2CRuneSuccessRate_cb.bind(this),i.addListener(s.S2CRuneSuccessRate,this.S2CRuneSuccessRate_cb_func),this.node_equip_combine.active=!1,this.node_rune_combine.active=!1,this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},S2CRuneSuccessRate_cb:function(e){this.node_equip_combine.activeInHierarchy||(this.node_rune_combine.active=!0,this.node_rune_combine.getComponent("RuneCombinePanel").changeData(e.success_rate))},onDestroy:function(){i.removeListener(s.S2CRuneSuccessRate,this.S2CRuneSuccessRate_cb_func)},ClickHandlerLeftTab:function(e,t){var a=parseInt(t);n.playBtnOpenEffect(),this.changeSelectTab(a)},changeSelectTab:function(e){e!=this._selected_tab_type&&(1==e?(this.node_rune_tab.getChildByName("tabNormal").getComponent(cc.Sprite).spriteFrame=this.res_tab_bg[1],this.node_equip_tab.getChildByName("tabNormal").getComponent(cc.Sprite).spriteFrame=this.res_tab_bg[0],this.node_equip_combine.active=!1,this.node_rune_combine.active=!1,r.send_C2SRuneSuccessRate(DonotDestroyManager._gameSocket)):(this.node_rune_tab.getChildByName("tabNormal").getComponent(cc.Sprite).spriteFrame=this.res_tab_bg[0],this.node_equip_tab.getChildByName("tabNormal").getComponent(cc.Sprite).spriteFrame=this.res_tab_bg[1],this.node_equip_combine.active=!0,this.node_rune_combine.active=!1,this.node_equip_combine.getComponent("EsMain").Init()),this._selected_tab_type=e)},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},showGuide:function(){var t=this;o.showGuide("EsRoot",function(e){if(1==e)
return t.node_equip_tab})}}),cc._RF.pop()},{EquipBufferMgr:"EquipBufferMgr",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",RunesBufferMgr:"RunesBufferMgr",SoundUtil:"SoundUtil"}],EsWrapItem:[function(e,t,a){"use strict";cc._RF.push(t,"3b0afGWNqVPX4nIlyV301EC","EsWrapItem");var h=e("EsMain");cc.Class({extends:cc.Component,properties:{m_pItemBoxPrefab:cc.Prefab,m_pItemBoxEffect:cc.Prefab,_itemID:0,_itemScriptList:[]},onLoad:function(){},updateItem:function(e){this._itemID=e;var t,a=-1;t=h.getInstance()._equipList;for(var n=0;n<4;n++){var i=t[a=4*this._itemID+n],r=h.getInstance()._idSet;if(n<this._itemScriptList.length){var s=this._itemScriptList[n].node.getChildByName("itemBorder");if(null!=s&&(s.active=!1),a<t.length){this._itemScriptList[n].node.active=!0;var o=h.getInstance(),c=o.RightItemClickHandler.bind(o),l={template_id:i.template_id,level:i.enhance_level,uuid:i.uuid,cb:c,showlv:!0,showlvbg:!0};this._itemScriptList[n].ChangeEquipInfo(l),null!=this._itemScriptList[n]._itemjsoninfo.tier&&0<this._itemScriptList[n]._itemjsoninfo.tier&&this.SetItemEffect(this._itemScriptList[n]),r.has(i.uuid)&&this._itemScriptList[n].SetSelect(!0,2)}else
this._itemScriptList[n].node.active=!1}else
a<t.length&&this.SetItemBox(i)}},SetItemBox:function(e){var t=h.getInstance(),a=cc.instantiate(this.m_pItemBoxPrefab),n=a.getComponent("ItemBox");this._itemScriptList.push(n),this.node.addChild(a);var i=t.RightItemClickHandler.bind(t),r={template_id:e.template_id,level:e.enhance_level,uuid:e.uuid,cb:i,showlv:!0,showlvbg:!0};n.ChangeEquipInfo(r),null!=n._itemjsoninfo.tier&&0<n._itemjsoninfo.tier&&this.SetItemEffect(n)},SetItemEffect:function(e){var t=e.node.getChildByName("itemBorder");null==t?(e._tiereffect=cc.instantiate(this.m_pItemBoxEffect),e.node.addChild(e._tiereffect)):t.active=!0}}),cc._RF.pop()},{EsMain:"EsMain"}],ExpandTipsPanel:[function(e,t,a){"use strict";cc._RF.push(t,"ab4d3yDvERLCI4yrK7lg7H3","ExpandTipsPanel");var n=e("MyProtocols"),i=(e("NetEvent"),e("i18n"));cc.Class({extends:cc.Component,properties:{m_pDiamond:cc.Label,m_pBagTypeLab:cc.Label,_bagid:0,_needmoney:0,_expandcount:0},onLoad:function(){},ChangeData:function(e){this._bagid=e,this._expandcount=0,this.GetExpandCount(e),this._needmoney=DonotDestroyManager.GameData.Common.bags.expand[0]+this._expandcount*DonotDestroyManager.GameData.Common.bags.expand[1],this.m_pBagTypeLab.string=i.t("sh_004",{type:this.GetBagName(e)}),this.m_pDiamond.string="X"+this._needmoney},BtnOk_OnClickHandler:function(e){MyPersistDataManager._playerData.money<this._needmoney?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("121")):(n.send_C2SExpandBag(DonotDestroyManager._gameSocket,this._bagid),this.node.active=!1)},GetExpandCount:function(e){for(var t=0;t<MyPersistDataManager._playerData.expand_info.length;++t)
e==MyPersistDataManager._playerData.expand_info[t].bag_id&&(this._expandcount=MyPersistDataManager._playerData.expand_info[t].expand_count)},GetBagName:function(e){var t="";switch(e){case 0:t=i.t("sh_005");break;case 1:t=i.t("sh_006");break;case 2:t=i.t("sh_007");break;case 3:t=i.t("sh_008");break;case 4:t=i.t("sh_009")}
return t},Mask_OnClickHandler:function(e){this.node.active=!1}}),cc._RF.pop()},{MyProtocols:"MyProtocols",NetEvent:"NetEvent",i18n:"i18n"}],FTBattleManager:[function(e,t,a){"use strict";cc._RF.push(t,"78c5cuov+FFpIzNhtRn/Rlw","FTBattleManager");var m=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},p=(e("TeamDataUtil"),e("OverComeBufferMgr")),h=e("PlayerBufferMgr"),d=e("BattleBufferMgr"),f=e("BattleDataManager"),i=e("BattleUtil"),_=e("HeroBufferMgr"),c=e("MyProtocols"),l=e("BattleManager"),n=function(){};n.prototype.init=function(e,t){p.setOverComeBattleModel(!0);var a=DonotDestroyManager.GameData.StageMobs;this.leftData=this.getLeftData(),this.rightData=this.getRightData(p.getOtrEmemyInfo()),this.leftData.fightVal=e,this.rightData.fightVal=t,this.background=a[101].battleground},n.prototype.enterBattlefield=function(){var e=p.getCurStage(),t=DonotDestroyManager.GameData.TeamSkillsAI,a={background:this.background,teamAiCfg:t[5][e],type:3},n=this;i.createBattlefield(this.leftData,this.rightData,a,function(){n.onSuccess()},function(){n.onFailure()}),i.enterRealScene()},n.prototype.getLeftData=function(){var e={side:"left"};e.name=h.getNickName(),e.level=h.getUserLevel();var t=d.getFormationData(2);e.formation=t.formationId,e.forward=t.forward,e.flip=t.flip;for(var a=f.create(e),n=Object.keys(t),i=0;i<n.length;++i){var r=n[i];if("fid"!=r&&"formationId"!=r&&"forward"!=r&&"flip"!=r&&"0"!=r){var s=t[r],o=_.getHeroByUid(s);if(o&&p.isOurHeroLive(s)){var c=p.getOurHeroHpdata(s),l=m(c,2);o.hpPerc=l[0],o.unitNum=l[1],delete o.atkPerc,a.addCardWithPosition(o,r)}}}
return a},n.prototype.onSuccess=function(){cc.log("win==============");for(var e=[],t=0;t<l.ourside.armies.length;++t){var a=l.ourside.armies[t];if(null!=a.hero){var n={},i=0;"Dead"!=a.hero.getState()&&(i=100*a.hero.hp/a.hero.basehp),i<=0?i=0:100<(i+=20)&&(i=100),n.hp=i,n.heroId=a.hero.id;for(var r=0,s=0;s<a.soldiers.length;++s)"Dead"!=a.soldiers[s].getState()&&++r;(r+=5)>a.hero.uNum&&(r=a.hero.uNum),n.unitNum=r,e.push(n)}}
var o=p.rand_key-MyPersistDataManager._playerData.id;c.send_C2SUserOvercomePassStage(DonotDestroyManager._gameSocket,!0,e,o)},n.prototype.onFailure=function(){cc.log("faied==============");for(var e=[],t=0;t<l.otrside.armies.length;++t){var a=l.otrside.armies[t];if(null!=a.hero){var n={},i=0;"Dead"!=a.hero.getState()&&(i=100*a.hero.hp/a.hero.basehp,i=Math.round(i)),0<i&&(i+=20),i=100<(i=i<=0?0:i)?100:i,n.hp=i,n.heroId=a.hero.id;for(var r=0,s=0;s<a.soldiers.length;++s)"Dead"!=a.soldiers[s].getState()&&++r;n.unitNum=r,e.push(n)}}
var o=p.rand_key-MyPersistDataManager._playerData.id;c.send_C2SUserOvercomePassStage(DonotDestroyManager._gameSocket,!1,e,o)},n.prototype.getRightData=function(n){var e={side:"right"};e.name=n.nickname,e.level=n.level,e.fightVal=n.fight,e.formation=n.formation.formationId,e.forward=n.formation.forward,e.flip=n.formation.flip;for(var t=f.create(e),a=n.formation,i=[a.a,a.b,a.c,a.d,a.e,a.f,a.g,a.h,a.i,a.j],r=function(e){for(var t=Object.keys(n.formation),a=0;a<t.length;++a){if("fid"!=t[a]&&"formationId"!=t[a]&&"forward"!=t[a]&&"flip"!=t[a])
if(e==n.formation[t[a]])
return t[a]}},s=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a]},o=DonotDestroyManager.GameData.Common,c=0;c<i.length;++c){var l=i[c];if(!o.FIGHT_CONTROL_ENEMY[3]&&0!=l){var h=s(n.cards,l);if(null!=h&&p.isOtrHeroLive(h.template_id)){var d={hero:{}};d.hero.id=h.template_id,d.hero.heroId=h.template_id,d.hero.level=h.level,d.hero.grade=h.grade,d.unit_level=h.unitLevel,d.unit_grade=h.unitGrade;var _=p.getOtrHerosHpData(h.template_id),u=m(_,2);d.hpPerc=u[0],d.unit_num=u[1],t.addHeroWithPosition(d,r(d.hero.id))}}}
return t},t.exports=new n,cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleUtil:"BattleUtil",HeroBufferMgr:"HeroBufferMgr",MyProtocols:"MyProtocols",OverComeBufferMgr:"OverComeBufferMgr",PlayerBufferMgr:"PlayerBufferMgr",TeamDataUtil:"TeamDataUtil"}],FightChangeTips:[function(e,t,a){"use strict";cc._RF.push(t,"a230eBkuLxJdoD+ZlKCmzNb","FightChangeTips");e("ColorUtil");cc.Class({extends:cc.Component,properties:{lab_fight:cc.Label,_old_fight:0,_new_fight:0,_do_change:!1,_curent_val:0,_frame_count:0},onLoad:function(){this._do_change=!1,this.node.runAction(cc.sequence(cc.delayTime(3.3),cc.callFunc(function(e){e.destroy()},this.node)))},setParams:function(e,t){this._old_fight=e,this._new_fight=t,this._curent_val=this._old_fight,this._diff_frames=60,this._change_per_frame=(this._new_fight-this._old_fight)/this._diff_frames,this._frame_count=0},evtPopupFinish:function(e){this._do_change=!0},update:function(e){if(this._do_change)
if(this._frame_count++,60<this._frame_count){this._do_change=!1;var t=this._new_fight>this._old_fight?"+":"";this.lab_fight.string=this._new_fight+"("+t+(this._new_fight-this._old_fight)+")"}else
this._curent_val+=this._change_per_frame,this.lab_fight.string=parseInt(this._curent_val)},onDestroy:function(){}}),cc._RF.pop()},{ColorUtil:"ColorUtil"}],FightThroughArmyItem:[function(e,t,a){"use strict";cc._RF.push(t,"935d5BrtFpNqL3U9kGtrzLb","FightThroughArmyItem"),cc.Class({extends:cc.Component,properties:{m_pItemBox:cc.Prefab,m_pitemparent:cc.Node,m_pLifebar:cc.Sprite,m_pYizhengwang:cc.Node,_OvercomeUserCardInfo:null,_itembox:null,_hpdata:null},onLoad:function(){},ChangeData:function(e,t){this._OvercomeUserCardInfo=e,this._hpdata=t,this.Init()},Init:function(){this.InitData(),this.CreateItem()},InitData:function(){this.m_pLifebar.node.scaleX=1,this.m_pYizhengwang.active=!1,null!=this._hpdata&&(this.m_pLifebar.node.scaleX=this._hpdata.hp/100,this._hpdata.hp<=0&&(this.m_pYizhengwang.active=!0))},CreateItem:function(){null==this._itembox&&(this._itembox=cc.instantiate(this.m_pItemBox),this.m_pitemparent.addChild(this._itembox)),this._itembox.getComponent("ItemBox").ChangeHeroInfo(this._OvercomeUserCardInfo.template_id,0,this._OvercomeUserCardInfo.level,!1)}}),cc._RF.pop()},{}],FightThroughArmy:[function(e,t,a){"use strict";cc._RF.push(t,"e800fbaxlJIAoKyCfhKOpWA","FightThroughArmy");var n=e("MyProtocols"),i=e("MyEventDispatcher"),r=e("NetEvent"),s=e("BattleBufferMgr"),o=e("OverComeBufferMgr"),c=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pName:cc.Label,m_pLevel:cc.Label,m_pNum:cc.Label,m_pHeroparent:cc.Node,m_parmyitem:cc.Node,m_pSex:cc.Sprite,m_pSexSpr:[cc.SpriteFrame],_OvercomeEnemyStruct:null,_heroHpData:null,_index:-1,_armyitemlist:[]},onLoad:function(){this.S2CArenaFormation_cb_func=this.S2CArenaFormation_cb.bind(this),i.addListener(r.S2CArenaFormation,this.S2CArenaFormation_cb_func)},S2CArenaFormation_cb:function(e){cc.log(" tiếp thu pvp đội hình tin tức "),MyPersistDataManager._playerData.pvpformation=e.formation,null!=e.formation&&s.setFormationData(2,e.formation),this.OpenFormationLayer()},ChangeData:function(e){this._OvercomeEnemyStruct=e.info,this._heroHpData=e.heroHpData,this._index=e.index,this.Init()},Init:function(){this.m_pName.string=this._OvercomeEnemyStruct.nickname,this.m_pLevel.string=this._OvercomeEnemyStruct.level,this.m_pNum.string=this._index+1+"/15",this.m_pSex.spriteFrame=this.m_pSexSpr[this._OvercomeEnemyStruct.sexId-1],this.CreateArmyitem()},GetHpData:function(e,t){for(var a=Object.keys(e),n=0;n<a.length;++n){var i=e[a[n]];if(i.heroId==t)
return i}
return null},CreateArmyitem:function(){for(var e=0;e<this._OvercomeEnemyStruct.cards.length;++e){var t=null;if(e<this._armyitemlist.length)
this._armyitemlist[e].active=!0,t=this._armyitemlist[e].getComponent("FightThroughArmyItem");else{var a=cc.instantiate(this.m_parmyitem);a.active=!0,this.m_pHeroparent.addChild(a),this._armyitemlist.push(a),t=a.getComponent("FightThroughArmyItem")}
var n=this.GetHpData(this._heroHpData,this._OvercomeEnemyStruct.cards[e].template_id);t.ChangeData(this._OvercomeEnemyStruct.cards[e],n)}
for(e=this._OvercomeEnemyStruct.cards.length;e<this._armyitemlist.length;++e)
this._armyitemlist[e].active=!1},GetEnemyTeams:function(){var e=[],t=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a].level;return 0};if(0<this._OvercomeEnemyStruct.formation.a){var a=this._OvercomeEnemyStruct.formation.a;if(o.isOtrHeroLive(a)){var n=t(this._OvercomeEnemyStruct.cards,this._OvercomeEnemyStruct.formation.a);e.push({id:this._OvercomeEnemyStruct.formation.a,level:n,position:"a"})}}
if(0<this._OvercomeEnemyStruct.formation.b){a=this._OvercomeEnemyStruct.formation.b;if(o.isOtrHeroLive(a)){n=t(this._OvercomeEnemyStruct.cards,a);e.push({id:a,level:n,position:"b"})}}
if(0<this._OvercomeEnemyStruct.formation.c){a=this._OvercomeEnemyStruct.formation.c;if(o.isOtrHeroLive(a)){n=t(this._OvercomeEnemyStruct.cards,a);e.push({id:a,level:n,position:"c"})}}
if(0<this._OvercomeEnemyStruct.formation.d){a=this._OvercomeEnemyStruct.formation.d;if(o.isOtrHeroLive(a)){n=t(this._OvercomeEnemyStruct.cards,a);e.push({id:a,level:n,position:"d"})}}
if(0<this._OvercomeEnemyStruct.formation.e){a=this._OvercomeEnemyStruct.formation.e;if(o.isOtrHeroLive(a)){n=t(this._OvercomeEnemyStruct.cards,a);e.push({id:a,level:n,position:"e"})}}
if(0<this._OvercomeEnemyStruct.formation.f){a=this._OvercomeEnemyStruct.formation.f;if(o.isOtrHeroLive(a)){n=t(this._OvercomeEnemyStruct.cards,a);e.push({id:a,level:n,position:"f"})}}
if(0<this._OvercomeEnemyStruct.formation.g){a=this._OvercomeEnemyStruct.formation.g;if(o.isOtrHeroLive(a)){n=t(this._OvercomeEnemyStruct.cards,a);e.push({id:a,level:n,position:"g"})}}
if(0<this._OvercomeEnemyStruct.formation.h){a=this._OvercomeEnemyStruct.formation.h;if(o.isOtrHeroLive(a)){n=t(this._OvercomeEnemyStruct.cards,a);e.push({id:a,level:n,position:"h"})}}
if(0<this._OvercomeEnemyStruct.formation.i){a=this._OvercomeEnemyStruct.formation.i;if(o.isOtrHeroLive(a)){n=t(this._OvercomeEnemyStruct.cards,a);e.push({id:a,level:n,position:"i"})}}
if(0<this._OvercomeEnemyStruct.formation.j){a=this._OvercomeEnemyStruct.formation.j;if(o.isOtrHeroLive(a)){n=t(this._OvercomeEnemyStruct.cards,a);e.push({id:a,level:n,position:"j"})}}
return e},Fight_OnClickHandler:function(){null!=MyPersistDataManager._playerData.pvpformation?this.OpenFormationLayer():n.send_C2SArenaFormation(DonotDestroyManager._gameSocket)},OpenFormationLayer:function(){var e={name:this._OvercomeEnemyStruct.nickname+"LV."+this._OvercomeEnemyStruct.level,fight:this._OvercomeEnemyStruct.fight,formation:this._OvercomeEnemyStruct.formation.formationId,flip:this._OvercomeEnemyStruct.formation.flip,forward:this._OvercomeEnemyStruct.formation.forward,Teams:this.GetEnemyTeams(),id:0};MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:e,panelinfo:{fid:2},battletype:3})},Mask_OnClickHandler:function(e){c.playBtnCloseEffect(),this.node.active=!1},onDestroy:function(){i.removeListener(r.S2CArenaFormation,this.S2CArenaFormation_cb_func)}}),cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",OverComeBufferMgr:"OverComeBufferMgr",SoundUtil:"SoundUtil"}],FightThroughLayer:[function(e,t,a){"use strict";cc._RF.push(t,"43da1n9cLlIwqmV9aoCFeFN","FightThroughLayer");var r="normal",n=e("MyProtocols"),i=e("NetEvent"),s=e("MyEventDispatcher"),o=e("OverComeBufferMgr"),c=e("OverComeCfgMgr"),l=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pNum:cc.Label,m_pContent:cc.Node,m_pAirNode:cc.Node,m_pFloatArrow:cc.Node,m_pFightArmy:cc.Node,m_pFightRole:cc.Node,m_pRewardPanel:cc.Prefab,m_pScrollView:cc.ScrollView,m_pThroughTips:cc.Node,m_pWoodBoxSpr:[cc.SpriteFrame],m_pGreenBoxSpr:[cc.SpriteFrame],_mStageTable:null,_mBoxTable:null,_mMaxStageCount:-1,_mCurrentStage:-1,_mCrossState:!1,_bgwidth:-1,_OvercomeInfo:null,_fight:-1,_armatureDisplay:null,_armature:null,_canResetNum:-1},onLoad:function(){this.S2COvercomeClaimReward_cb_func=this.S2COvercomeClaimReward_cb.bind(this),s.addListener(i.S2COvercomeClaimReward,this.S2COvercomeClaimReward_cb_func),this.S2COvercomeReset_cb_func=this.S2COvercomeReset_cb.bind(this),s.addListener(i.S2COvercomeReset,this.S2COvercomeReset_cb_func)},S2COvercomeReset_cb:function(e){var t={stage_index:0,haveReward:!1};t.todayResets=e.todayResets,t.current_enemy=e.current_enemy,t.heroHpData=[],t.enemyHpData=[],o.initBuffer(t),o.initOtrHerosHpdatas({current_enemy:e.current_enemy}),this._OvercomeInfo=o.mOverComeBuffer,this.Init()},S2COvercomeClaimReward_cb:function(e){cc.log(" lĩnh thưởng tin tức "),this._mBoxTable[this._mCurrentStage-1].stopAllActions(),this._OvercomeInfo.current_enemy=e.current_enemy,o.mOverComeBuffer.current_enemy=e.current_enemy,this._OvercomeInfo.haveReward=!1,o.initOtrHerosHpdatas({current_enemy:e.current_enemy});var t="wood";this._mCurrentStage%3==0&&(t="green");this._armatureDisplay=this._mBoxTable[this._mCurrentStage-1].getChildByName(t).getComponent(dragonBones.ArmatureDisplay),this._armature=this._armatureDisplay.armature(),this._armature.animation.fadeIn("action4",-1,1,0,r),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this.animationcb,this);for(var a=[],n=0;n<e.gain.length;++n)
a.push({itemId:e.gain[n].item_template_id,cnt:e.gain[n].item_count});var i=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(i),i.getComponent("GetRewardPanel")._itemlist=a,this.moveFloatArrow(this._mCurrentStage,this._OvercomeInfo.haveReward)},animationcb:function(e){e.type===dragonBones.EventObject.COMPLETE&&(this._armature.animation.fadeIn("action3",-1,-1,0,r),this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.animationcb,this),this.m_pScrollView.scrollToPercentHorizontal(1,1,!0))},setParams:function(e){this.closeCb=e.closeCb,this._OvercomeInfo=o.mOverComeBuffer,this.Init()},Init:function(){this.initData(),this.initLayer(),this.Register_StageEvent(),this.Register_BoxEvent(),this.setMapOtherData(),this.m_pScrollView.scrollToPercentHorizontal(1,1,!0)},setMapOtherData:function(){var e=this._mCurrentStage;this._OvercomeInfo.haveReward&&(e-=1)<=0&&(e=0),this.moveFloatArrow(e,this._OvercomeInfo.haveReward)},initData:function(){this._mMaxStageCount=15,this._mCurrentStage=this._OvercomeInfo.stage_index,this._mStageTable={},this._mBoxTable={},this._mCrossState=this._mCurrentStage>=this._mMaxStageCount,this._canResetNum=o.getCanResetTimes(),this.m_pNum.string="Hôm nay còn "+this._canResetNum+" lần"},initLayer:function(){for(var e=0;e<this._mMaxStageCount;++e)
this._mStageTable[e]=this.m_pContent.getChildByName("stage_"+(e+1)),this._mBoxTable[e]=this.m_pContent.getChildByName("box"+(e+1));for(e=0;e<this._mMaxStageCount;++e)
this.setBoxImageState(e)},Register_StageEvent:function(){for(var e=Object.keys(this._mStageTable),t=0;t<e.length;++t){var a=new cc.Component.EventHandler;a.target=this.node,a.component="FightThroughLayer",a.handler="Stage_OnClickHandler",a.customEventData=e[t],this._mStageTable[e[t]].getComponent(cc.Button).clickEvents[0]=a}},Register_BoxEvent:function(){for(var e=Object.keys(this._mBoxTable),t=0;t<e.length;++t){var a=new cc.Component.EventHandler;a.target=this.node,a.component="FightThroughLayer",a.handler="Box_OnClickHandler",a.customEventData=e[t],this._mBoxTable[e[t]].getComponent(cc.Button).clickEvents[0]=a}},RefreshLockState:function(){for(var e=Object.keys(this._mStageTable),t=0;t<e.length;++t){if(t<=this._mCurrentStage)
this._mStageTable[e[t]].getChildByName("_lock_icon").active=!1}},moveFloatArrow:function(e,t){if(e>=this._mMaxStageCount)
return this.m_pFloatArrow.active=!1,this.m_pAirNode.active=!1,this.m_pContent.width=2766,void this.RefreshLockState();var a=0,n=0;t?(a=this._mBoxTable[e].getPositionX(),n=this._mBoxTable[e].height/2+this._mBoxTable[e].getPositionY(),this.m_pFloatArrow.setPosition(a,n+10),this.shakeBoxAni(this._mBoxTable[e])):(a=this._mStageTable[e].getPositionX(),n=this._mStageTable[e].height/2+this._mStageTable[e].getPositionY(),this.m_pFloatArrow.setPosition(a,n-40)),this.addArrowAnimation(),this.m_pAirNode.setPositionX(a),this.m_pAirNode.runAction(cc.moveTo(1,cc.p(a+100,-5)));var i=922;5<=e&&2766<(i=a+300)&&(i=2766),this.m_pContent.width=i,this.RefreshLockState()},addArrowAnimation:function(){this.m_pFloatArrow.stopAllActions();var e=[this.m_pFloatArrow.getPositionX(),this.m_pFloatArrow.getPositionY()],t=e[0],a=e[1],n=a+20;this.m_pFloatArrow.runAction(cc.repeatForever(cc.sequence(cc.moveTo(1,cc.p(t,n)),cc.moveTo(1,cc.p(t,a)))))},setBoxImageState:function(e){var t="wood";(e+1)%3==0&&(t="green");var a=this._mBoxTable[e].getChildByName(t).getComponent(dragonBones.ArmatureDisplay).armature();this._OvercomeInfo.haveReward&&e==this._mCurrentStage-1?a.animation.fadeIn("action2",-1,-1,0,r):e<this._mCurrentStage?a.animation.fadeIn("action3",-1,-1,0,r):a.animation.fadeIn("action1",-1,-1,0,r)},shakeBoxAni:function(e){var t=[cc.rotateTo(.1,-10),cc.rotateTo(.1,0),cc.rotateTo(.1,10)],a=t[0],n=t[1],i=t[2],r=cc.repeatForever(cc.sequence(a,i,a,i,a,i,n,cc.delayTime(1.1)));e.runAction(r)},Box_OnClickHandler:function(e,t){l.playBtnOpenEffect(),cc.log(t);var a=parseInt(t);if(this._OvercomeInfo.haveReward){if(a==this._mCurrentStage-1)
return void n.send_C2SOvercomeClaimReward(DonotDestroyManager._gameSocket,0);a>=this._mCurrentStage&&this.ShowTips(a)}else
a>=this._mCurrentStage&&this.ShowTips(a)},ShowTips:function(e){var t=c.getDropGameMoney(e);this.m_pThroughTips.active=!0,this.m_pThroughTips.getComponent("FightThroughtTip").ChangeData(t)},Stage_OnClickHandler:function(e,t){l.playBtnOpenEffect(),cc.log(t);var a=parseInt(t);if(a==this._mCurrentStage){if(null==this._OvercomeInfo.current_enemy||this._OvercomeInfo.haveReward)
return;return this.m_pFightArmy.active=!0,void this.m_pFightArmy.getComponent("FightThroughArmy").ChangeData({info:this._OvercomeInfo.current_enemy,index:a,heroHpData:o.mOtrHerosHpdatas})}
a<this._mCurrentStage&&MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Đã vượt ải này!")},Role_OnClickHandler:function(e){l.playBtnOpenEffect(),this.m_pFightRole.active=!0},RoleMask_OnClickHandler:function(e){l.playBtnOpenEffect(),this.m_pFightRole.active=!1},OverShop_OnClickHandler:function(e){l.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.ShopMallLayer,{state:3})},Restart_OnClickHandler:function(e){if(l.playBtnOpenEffect(),this._canResetNum<=0)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Đã dùng hết");else{var t=this;this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent("Có kết thúc ải này và bắt đầu Trảm Tướng lại?",function(){t._alert_layer.removeFromParent(),t._alert_layer.destroy(),t._alert_layer=null,n.send_C2SOvercomeReset(DonotDestroyManager._gameSocket,0)})}},Back_OnClickHandler:function(e){MyUiManager.Back(),l.playBtnCloseEffect(),null!=this.closeCb&&this.closeCb()},onDestroy:function(){s.removeListener(i.S2COvercomeClaimReward,this.S2COvercomeClaimReward_cb_func),s.removeListener(i.S2COvercomeReset,this.S2COvercomeReset_cb_func)}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",OverComeBufferMgr:"OverComeBufferMgr",OverComeCfgMgr:"OverComeCfgMgr",SoundUtil:"SoundUtil"}],FightThroughtTip:[function(e,t,a){"use strict";cc._RF.push(t,"ae884/fVVxNyoY7EO5FKNkU","FightThroughtTip"),cc.Class({extends:cc.Component,properties:{m_pMoney:cc.Label},onLoad:function(){},ChangeData:function(e){this.m_pMoney.string=e},Mask_OnClickHandler:function(e){this.node.active=!1}}),cc._RF.pop()},{}],FirstPayAwardItem:[function(e,t,a){"use strict";cc._RF.push(t,"25b7at0khxKLpe9SJrgXcpp","FirstPayAwardItem");var i=e("ColorUtil");cc.Class({extends:cc.Component,properties:{itemName:cc.Label,firstPayEffect:cc.Prefab,itemBoxParent:cc.Node,itemBoxPrefab:cc.Prefab,_itemsBoxNode:cc.Node,_itemData:null,_itemId:0,_ishero:!1},onLoad:function(){},ChangeData:function(e,t){this._itemId=e,this.ReadInfo(e,t)},ReadInfo:function(e,t){var a=cc.instantiate(this.itemBoxPrefab);this.itemBoxParent.addChild(a),this._itemsBoxNode=a;var n=this._itemsBoxNode.getComponent("ItemBox");n.ChangeItemInfo(e,t,!0,null,!0),this.GetItemCfg(),this.itemName.string=this._itemData[e].name,this.itemName.node.color=i.getColorByQuality(n._itemjsoninfo.quality),1==this._ishero&&this.AddEffect()},GetItemCfg:function(){this._ishero=!1,null!=DonotDestroyManager.GameData.Consumes[this._itemId]?this._itemData=DonotDestroyManager.GameData.Consumes:null!=DonotDestroyManager.GameData.Boxes[this._itemId]?this._itemData=DonotDestroyManager.GameData.Boxes:null!=DonotDestroyManager.GameData.Items[this._itemId]?this._itemData=DonotDestroyManager.GameData.Items:null!=DonotDestroyManager.GameData.Equips[this._itemId]?this._itemData=DonotDestroyManager.GameData.Equips:null!=DonotDestroyManager.GameData.EquipFrags[this._itemId]?this._itemData=DonotDestroyManager.GameData.EquipFrags:null!=DonotDestroyManager.GameData.Treasures[this._itemId]?this._itemData=DonotDestroyManager.GameData.Treasures:null!=DonotDestroyManager.GameData.CardFrags[this._itemId]?this._itemData=DonotDestroyManager.GameData.CardFrags:null!=DonotDestroyManager.GameData.Cards[this._itemId]?(this._itemData=DonotDestroyManager.GameData.Cards,this._ishero=!0):null!=DonotDestroyManager.GameData.UnitsEquips[this._itemId]?this._itemData=DonotDestroyManager.GameData.UnitsEquips:null!=DonotDestroyManager.GameData.TreasureFrags[this._itemId]&&(this._itemData=DonotDestroyManager.GameData.TreasureFrags)},AddEffect:function(){var e=cc.instantiate(this.firstPayEffect);this.node.addChild(e)}}),cc._RF.pop()},{ColorUtil:"ColorUtil"}],FirstPayMgn:[function(e,t,a){"use strict";cc._RF.push(t,"a6fe8cT2Q5DrrEmNyW/6QGq","FirstPayMgn");var c=e("SoundUtil"),n=e("MyEventDispatcher"),i=e("MyProtocols"),r=e("NetEvent"),s=e("GuideBufferMgr"),l=e("ColorUtil");c=e("SoundUtil"),e("GameUtils");cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,itemsContentNode:cc.Node,firstPayItemPrefab:cc.Prefab,goToChargeBtn:cc.Button,getRewardBtn:cc.Button,awardMask:cc.Sprite,m_pRewardPanel:cc.Prefab,labCardDesc:cc.Label,labCardPotential:cc.Label,nodeSkillRoot:cc.Node,heroInfoNodes:[cc.Node],heroArmature:sp.Skeleton},onLoad:function(){this.GetFirstPayAward_auth_cb_func=this.GetFirstPayAward_auth_cb.bind(this),n.addListener(r.S2CGetFirstPayAward,this.GetFirstPayAward_auth_cb_func)},start:function(){this.showGuide(),this.heroArmature.setAnimation(0,"stand",!0),this.heroArmature.setCompleteListener(this._dragonbonesEventHandler.bind(this))},onDestroy:function(){n.removeListener(r.S2CGetFirstPayAward,this.GetFirstPayAward_auth_cb_func)},_dragonbonesEventHandler:function(e){"skill1"==(e.animation?e.animation.name:"")&&this.heroArmature.setAnimation(0,"stand",!0)},GetFirstPayAward_auth_cb:function(){this.getRewardBtn.node.active=!1,this.awardMask.node.active=!0,MyPersistDataManager._playerData.chargeInfo.first_award_get=!0;for(var e=DonotDestroyManager.GameData.Charge.first_charge.items,t=[],a=0;a<e.length;++a)
t.push({itemId:e[a][0],cnt:e[a][1]});var n=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(n),n.getComponent("GetRewardPanel")._itemlist=t},setParams:function(e){this.closeCb=e.closeCb,this.ChangeData()},ChangeData:function(){this.ScaleToLarge(),this.ReadInfo()},ReadInfo:function(){this.goToChargeBtn.node.active=!0,this.getRewardBtn.node.active=!1,this.awardMask.node.active=!1;var e=MyPersistDataManager._playerData.chargeInfo;1==e.is_first_pay&&(this.goToChargeBtn.node.active=!1,this.getRewardBtn.node.active=!0,1==e.first_award_get&&(this.getRewardBtn.node.active=!1,this.awardMask.node.active=!0));for(var t=DonotDestroyManager.GameData.Charge.first_charge.items,a=0;a<t.length;++a){var n=cc.instantiate(this.firstPayItemPrefab);n.getComponent("FirstPayAwardItem").ChangeData(t[a][0],t[a][1]),this.itemsContentNode.addChild(n)}
var i=DonotDestroyManager.GameData.Cards[195];this.labCardDesc.string=i.des,this.labCardPotential.string=i.potential;var r=i.skills;for(a=0;a<r.length;a++){var s=r[a][0],o=DonotDestroyManager.GameData.Skills[s];this.nodeSkillRoot.children[a+1].children[0].getComponent(cc.Label).string=o.name,this.nodeSkillRoot.children[a+1].children[0].color=l.getColorByQuality(o.quality),this.nodeSkillRoot.children[a+1].children[1].getComponent(cc.Label).string=o.des}
this.heroInfoNodes[0].runAction(cc.sequence(cc.delayTime(.2),cc.fadeIn(.3))),this.heroInfoNodes[1].runAction(cc.sequence(cc.delayTime(.5),cc.fadeIn(.3))),this.heroInfoNodes[2].runAction(cc.sequence(cc.delayTime(.8),cc.fadeIn(.3))),this.heroInfoNodes[3].runAction(cc.sequence(cc.delayTime(.3),cc.fadeIn(.2),cc.delayTime(.2),cc.callFunc(function(){if(this.heroArmature.setAnimation(0,"skill1",!1),3<=i.quality){var e=i.sound?i.sound:i.icon;c.playHeroSound(e)}},this)))},GetReward_onClickHandler:function(e,t){c.playBtnOpenEffect(),i.send_C2SGetFirstPayAward(DonotDestroyManager._gameSocket)},Back_onClickHandler:function(){c.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},VipPay_onClickHandler:function(){MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1}),c.playBtnOpenEffect()},showGuide:function(){s.showGuide("FirstPayLayer",null)}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],FloatTipPanel:[function(e,t,a){"use strict";cc._RF.push(t,"83ca7c2bdRFs7g8QxGcpwwe","FloatTipPanel");cc.Class({extends:cc.Component,properties:{m_pBg:cc.Node,m_pValue:cc.Label},SetInfo:function(e){this.m_pValue.string=e,this.m_pBg.width+=this.m_pValue.node.width,this.node.scale=.8,this.node.runAction(cc.sequence(cc.scaleTo(.15,1.2).easing(cc.easeOut(3)),cc.scaleTo(.08,1).easing(cc.easeIn(3)),cc.delayTime(1.5),cc.moveBy(.3,cc.p(0,70)),cc.spawn(cc.scaleTo(.2,.7),cc.fadeTo(.2,150)),cc.callFunc(function(e){e.destroy()})))},onLoad:function(){}});cc._RF.pop()},{}],FormationCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"4cd7cjkQQpNA43uNO8XYvzZ","FormationCfgMgr"),t.exports={findFormation:function(e){return DonotDestroyManager.GameData.Formation[e-1]}},cc._RF.pop()},{}],FormationHero:[function(e,t,a){"use strict";cc._RF.push(t,"23b59BjPGFATJmlYveq7jYJ","FormationHero");var i=e("ColorUtil"),r=e("BattleFormationPanel"),s={0:"all",1:"infantry",2:"cavalry",3:"archer",4:"lancer",5:"mage"};cc.Class({extends:cc.Component,properties:{m_pHeroName:cc.Label,m_pHeroSoldierType:cc.Sprite,m_pHeroFormationAttr:cc.Sprite,m_pHeroParent:cc.Node,m_pSoldierFrames:[cc.SpriteFrame],_herojson:null,_heroid:0,_heropre:null,_isenemy:!1,_armature:null,_armatureDisplay:null,ismove:!1,_mobtype:-1,_attriconpre:null,_formationJson:null},onLoad:function(){},ChangeData:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1;this._heroid=e,this._herojson=DonotDestroyManager.GameData.Cards[this._heroid],this._isenemy=t,this._mobtype=a,this.Init()},Init:function(){var a=this;if(this._formationJson=r.getInstance()._formationJson,this._isenemy)
this.m_pHeroName.string="lv"+this._mobtype+this._herojson.name,this.m_pHeroFormationAttr.node.active=!1;else{var e=MyPersistDataManager._playerData.cardsMaplist[this._heroid],t=0;t=null==e?MyPersistDataManager._playerData.level:e.level,this.m_pHeroName.string="lv"+t+this._herojson.name,this.m_pHeroFormationAttr.node.active=!0,this.LoadFormationAddAttr()}
this.m_pHeroName.node.color=i.getColorByQuality(this._herojson.quality),this._herojson.is_spine&&(this.m_pHeroName.node.y+=30),this.m_pHeroSoldierType.spriteFrame=this.m_pSoldierFrames[this._herojson.unit_type-1];var n=r.getInstance()._raw_assets["Prefab/Heros/"+this._herojson.icon];null!=n?this.instantiatePrefab(n):cc.loader.loadRes("Prefab/Heros/"+this._herojson.icon,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load heroprefab success!"),a.instantiatePrefab(t)})},instantiatePrefab:function(e){if(null!=this&&cc.isValid(this.node)){this._heropre=e;var t=cc.instantiate(e);this.m_pHeroParent.addChild(t),null!=this._herojson.is_spine&&this._herojson.is_spine?this._isenemy&&t.setScale(-1,1):this._isenemy||t.setScale(-1,1),t.getComponent(sp.Skeleton).setAnimation(0,"stand",!0)}},LoadFormationAddAttr:function(){for(var a=this,e=0,t=0,n=0,i="",r=0;r<this._formationJson.attrs.length;++r)
0<this._formationJson.attrs[r].maxhp_rate&&++e,0<this._formationJson.attrs[r].def_rate&&++t,0<this._formationJson.attrs[r].atk_rate&&++n;0<e&&(5==e?i=s[0]+"_hp_icon":0<this._formationJson.attrs[this._herojson.unit_type-1].maxhp_rate&&(i=s[this._herojson.unit_type]+"_hp_icon")),0<t&&(5==t?i=s[0]+"_def_icon":0<this._formationJson.attrs[this._herojson.unit_type-1].def_rate&&(i=s[this._herojson.unit_type]+"_def_icon")),0<n&&(5==n?i=s[0]+"_atk_icon":0<this._formationJson.attrs[this._herojson.unit_type-1].atk_rate&&(i=s[this._herojson.unit_type]+"_atk_icon")),""!=i?cc.loader.loadRes("UI/emBattle/"+i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load iconspr success!"+t),a._attriconpre=t,a.m_pHeroFormationAttr.spriteFrame=t}):this.m_pHeroFormationAttr.node.active=!1},PlayAnimation:function(e){if(null!=this._armature&&(!this.ismove||"move"!=e)){var t=this;setTimeout(function(){t._armature.animation.fadeIn(e,-1,-1,0,"normal")},10),this.ismove="move"==e}},onDestroy:function(){this._heropre,this._heropre=null,this._attriconpre,this._attriconpre=null}}),cc._RF.pop()},{BattleFormationPanel:"BattleFormationPanel",ColorUtil:"ColorUtil"}],FormationSquare:[function(e,t,a){"use strict";cc._RF.push(t,"294c9op8EJNp5uuG/kIu4nq","FormationSquare"),cc.Class({extends:cc.Component,properties:{m_pSquare:cc.Sprite,m_pSquareSprframe:[cc.SpriteFrame]},onLoad:function(){},SetState:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;this.m_pSquare.spriteFrame=this.m_pSquareSprframe[e]},SetSelect:function(){this.m_pSquare.spriteFrame=this.m_pSquareSprframe[3]}}),cc._RF.pop()},{}],FrameAnimationCallback:[function(e,t,a){"use strict";cc._RF.push(t,"a9536yMclRKGbwAVphGBpF+","FrameAnimationCallback"),cc.Class({extends:cc.Component,properties:{baseModel:{default:null,type:e("Soldier"),serializable:!1}},onLoad:function(){},fireAnimation:function(){cc.log("FrameAnimationCallback#fireAnimation"),null!=this.baseModel&&this.baseModel.fireAnimationCb()}}),cc._RF.pop()},{Soldier:"Soldier"}],GameStoryLayer:[function(R,e,t){"use strict";cc._RF.push(e,"7e965ZPRTFDs6Likp15iYbR","GameStoryLayer");var F=R("ResLoaderManager"),a=R("SoundUtil"),n=R("GameUtils"),i=R("MarqueeBufferMgr"),x=R("HeroConfigMgr"),f=R("TeamSkillBufferMgr"),U=R("UnitConfigMgr"),g=R("EffectsManager"),_=R("SkillsManager"),u=R("BuffsManager"),r=[[1,2,3],[1,2,3],[1,2,3],[1,2,3]],N=R("GuideFight");cc.Class({extends:cc.Component,properties:{_storyIdx:cc.Integer,_actionIdx:cc.Integer,_handlePlay:!0,_callback:null,_my_sex:1,title_djjx_spr:cc.Node,_raw_assets:{default:{},type:Object},_mStoryAni:null},setParams:function(e){this._my_sex=e.sex,this._callback=function(){cc.log("in callback!"),MyUiManager.clearBackList(),MyUiManager.Remove(37),i.setMarqueeCanPlay(!1),N.init(),N.enterBattlefield()};var t=[],a=1==this._my_sex?"boy":"girl";t.push([cc.js.formatStr("Prefab/gamestory/%scomic_1",a),cc.Prefab]),t.push([cc.js.formatStr("Prefab/gamestory/%scomic_2",a),cc.Prefab]),t.push([cc.js.formatStr("Prefab/gamestory/%scomic_3",a),cc.Prefab]),t.push([cc.js.formatStr("Prefab/gamestory/%scomic_4",a),cc.Prefab]),this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),this._shortMask_node.getComponent("ShortLoadingMask").setText("141"),cc.Canvas.instance.node.addChild(this._shortMask_node),F.asyncLoadAll(t,this.loadProgressCb.bind(this),this.loadFinishCb.bind(this))},onLoad:function(){this._storyIdx=0,this._actionIdx=1,this._handlePlay=!0,this.title_djjx_spr.runAction(cc.repeatForever(cc.sequence(cc.fadeTo(1,102),cc.fadeTo(1,255)))),null!=window.TDGA&&TDGA.onEvent("guide_GameStroyOnLoad",{count:1})},loadProgressCb:function(e){cc.log("load percent:%d",e)},loadFinishCb:function(e,t){t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this),t=[],null!=this._shortMask_node&&(this._shortMask_node.destroy(),this._shortMask_node=null),this.node.on("touchend",this.ContinueClickEndHandler,this),this.playStory(!1),n.callInNext100ms(function(e){e.preLoadBattleRes()},this)},preLoadBattleRes:function(){var e=new Map;e.set("Prefab/effect/winstar",cc.Prefab),e.set("battle/battlewidgets",cc.SpriteAtlas),e.set("Prefab/battle/effects/dodge",cc.Prefab),e.set("Prefab/battle/effects/dmgdefend",cc.Prefab),e.set("Prefab/battle/effects/dmgarmor",cc.Prefab),e.set("sound/zdgc_03",cc.AudioClip),e.set("Prefab/ui/battle/battle_main_layer",cc.Prefab),e.set("Prefab/ui/battle/battle_pause_panel",cc.Prefab),e.set("Prefab/ui/battle/battle_talk_player",cc.Prefab),e.set("Prefab/Heros/rolebase",cc.Prefab),e.set("Prefab/battle/effects/reinforceUnit",cc.Prefab),e.set("Prefab/battle/arrow/arrow1",cc.Prefab),e.set("Prefab/battle/arrow/arrow2",cc.Prefab),e.set("Prefab/battle/arrow/arrow3",cc.Prefab),e.set("Prefab/battle/arrow/iceBall1",cc.Prefab),e.set("Prefab/battle/arrow/lightningBall1",cc.Prefab),e.set("Prefab/battle/widget/heroLifeBarGreen",cc.Prefab),e.set("Prefab/battle/widget/heroLifeBarRed",cc.Prefab),e.set("Prefab/battle/widget/unitLifeBarGreen",cc.Prefab),e.set("Prefab/battle/widget/unitLifeBarRed",cc.Prefab),e.set("Prefab/battle/effects/blood",cc.Prefab),e.set("Prefab/battle/effects/beheaded",cc.Prefab),e.set("Prefab/battle/effects/wasbeheaded",cc.Prefab),e.set("Prefab/battle/effects/lightBox1",cc.Prefab);for(var t=!1,a=new Set,n=0;n<DonotDestroyManager.GameData.TeamSkills.items.length;n++){var i=DonotDestroyManager.GameData.TeamSkills.items[n],r=f.getBattleLevel(i.id);if(0==r){if(t)
break;r=1,t=!0}
for(var s=i.levels[r-1],o=0;o<s.effect.length;o++){var c=s.effect[o],l="Prefab/battle/effects/"+g.getCfgById(c.id||c[0]).file;a.add(l),e.set(l,cc.Prefab)}
for(o=0;o<s.crit_effect.length;o++){c=s.crit_effect[o],l="Prefab/battle/effects/"+g.getCfgById(c.id||c[0]).file;a.add(l),e.set(l,cc.Prefab)}}
var h=!0,d=!1,_=void 0;try{for(var u,m=a[Symbol.iterator]();!(h=(u=m.next()).done);h=!0){var p=u.value;e.set(p,cc.Prefab)}}catch(e){d=!0,_=e}
finally{try{!h&&m.return&&m.return()}
finally{if(d)
throw _}}
e.set("Prefab/battle/effects/stun1",cc.Prefab),e.set("Prefab/battle/soldier/reinforce_1_blue",cc.Prefab),e.set("Prefab/battle/soldier/reinforce_1_red",cc.Prefab),e.set("Prefab/battle/soldier/reinforce_10_blue",cc.Prefab),e.set("Prefab/battle/soldier/reinforce_10_red",cc.Prefab),e.set("Prefab/battle/effects/ballista_sight",cc.Prefab),e.set("Prefab/battle/effects/tearScreen/tearScreenBg",cc.Prefab),MyPersistDataManager._playerData.sex%2==1?e.set("Prefab/battle/effects/tearScreen/tearScreenGentleman",cc.Prefab):e.set("Prefab/battle/effects/tearScreen/tearScreenLady",cc.Prefab),e.set("Prefab/battle/effects/tearScreen/tearSkillName",cc.Prefab),e.set("Prefab/battle/effects/gskill/gskill_flare",cc.Prefab),e.set("Prefab/battle/effects/gskill/tmSkillBorder",cc.Prefab),e.set("battle/effect/march_blue",cc.SpriteFrame),e.set("battle/effect/march_red",cc.SpriteFrame),e.set("Prefab/battle/effects/March_route_blue",cc.Prefab),e.set("Prefab/battle/effects/March_route_red",cc.Prefab),e.set("Prefab/battle/effects/star_break",cc.Prefab),e.set("Prefab/battle/effects/star_break2",cc.Prefab),F.asyncLoadAll(e,function(e){},function(e,t){},!1)},preLoadBattleResCard:function(){for(var e=new Map,t=N.getLeftData(),a=N.getRightData(),n=0;n<t.teams.length;n++){var i=t.teams[n],r=x.find(i.hero.id);this.preLoadBattleRes1Card(r,e)}
for(var s=0;s<a.teams.length;s++){var o=a.teams[s],c=x.find(o.hero.id);this.preLoadBattleRes1Card(c,e)}
var l=R("StagesEventManager");if(a.stage_event)
for(var h=0;h<a.stage_event.length;h++){var d=a.stage_event[h],_=DonotDestroyManager.GameData.StageEvents;l.initTriggers(_[d])}
for(var u=[],m=l.triggers,p=Object.keys(m),f=0;f<p.length;f++)
for(var g=m[p[f]],y=0;y<g.length;y++)
for(var v=g[y][1],M=0;M<v.length;M++){var S=v[M];if(2==S[0]){var C=S[2];u.push([S[1],C])}}
var D=DonotDestroyManager.GameData.Reinforce;for(f=0;f<u.length;f++){var I=u[f][0],b=D[u[f][1]];for(M=0;M<b.troops.length;M++){var P=b.troops[M],L=P.mob_id,B=x.find(L);this.preLoadBattleRes1Card(B,e);var w=B.unit_type,E=b.attrs[P.mob_type-1],k=U.find(w,E.unit_grade);if(k){var T=0==I||3==I?"blue":"red",A=cc.js.formatStr("Prefab/battle/soldier/%s_%s",k.icon,T);e.set(A,cc.Prefab)}}}
l.resetData(),F.asyncLoadAll(e,function(e){},function(e,t){var a=R("MainHomeSceneManager");null!=a.getInstance()&&null!=a.getInstance()._loadingLayer&&cc.isValid(a.getInstance()._loadingLayer)&&(a.getInstance()._loadingLayer.destroy(),a.getInstance()._loadingLayer=null)},!1)},preLoadBattleRes1Card:function(e,t){var a="Prefab/Heros/"+e.icon;t.set(a,cc.Prefab),this._addCachedSkill(e.skills,t)},_addCachedSkill:function(e,t){for(var a=0;a<e.length;a++){for(var n=e[a][0],i=_.getCfgById(n),r=i.effect_1||[],s=0;s<r.length;s++){var o=r[s],c="Prefab/battle/effects/"+g.getCfgById(o.id||o[0]).file;t.set(c,cc.Prefab)}
var l=i.effect_2||[];for(s=0;s<l.length;s++){o=l[s],c="Prefab/battle/effects/"+g.getCfgById(o.id||o[0]).file;t.set(c,cc.Prefab)}
var h=i.buffId;if(h){var d=u.getCfgById(h);for(d.unit_type,s=0;s<d.effect.length;s++){o=d.effect[s],c="Prefab/battle/effects/"+g.getCfgById(o.id||o[0]).file;t.set(c,cc.Prefab)}}
i.quality<3?(t.set("battle/imageTitle/small/"+i.icon,cc.SpriteFrame),t.set("battle/imageTitle/small/"+i.icon,cc.SpriteFrame)):t.set("battle/imageTitle/big/"+i.icon,cc.SpriteFrame)}},ContinueClickEndHandler:function(e){a.playBtnOpenEffect(),this._handlePlay=!0,this.finishStoryAction(),this.playStory&&this.playStory(!1)},getStoryAni:function(e){var n=this,t=function(){var e=1==n._my_sex?"boy":"girl",t=cc.js.formatStr("Prefab/gamestory/%scomic_%d",e,n._storyIdx+1),a=cc.instantiate(n._raw_assets[t]);return a.tag=2e3,n.node.addChild(a),a},a=this.node.getChildByTag(2e3);return e?(a&&(a.destroy(),a=null),t()):a||t()},playStory:function(e){this._mStoryAni=this.getStoryAni(e),this._mStoryAni.getComponent(dragonBones.ArmatureDisplay).armature().animation.fadeIn("action"+this._actionIdx,-1,-1,0,"normal"),this._mStoryAni.getComponent(dragonBones.ArmatureDisplay).removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._mStoryAni.getComponent(dragonBones.ArmatureDisplay).addEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),e&&1==this._storyIdx&&n.callInNext100ms(function(e){e.preLoadBattleResCard()},this)},_animationEventHandler:function(e){2==this._actionIdx&&(this._handlePlay=!1),this._handlePlay&&this.finishStoryAction()},finishStoryAction:function(){if(this._storyIdx<r.length)
if(this._actionIdx<r[this._storyIdx].length)
this._actionIdx=this._actionIdx+1,this.playStory(!1);else{if(this._storyIdx++,this._actionIdx=1,this._storyIdx>=r.length)
return void this._callback();this.playStory(!0)}},onDestroy:function(){null!=this._raw_assets&&(this._raw_assets={})}}),cc._RF.pop()},{BuffsManager:"BuffsManager",EffectsManager:"EffectsManager",GameUtils:"GameUtils",GuideFight:"GuideFight",HeroConfigMgr:"HeroConfigMgr",MainHomeSceneManager:"MainHomeSceneManager",MarqueeBufferMgr:"MarqueeBufferMgr",ResLoaderManager:"ResLoaderManager",SkillsManager:"SkillsManager",SoundUtil:"SoundUtil",StagesEventManager:"StagesEventManager",TeamSkillBufferMgr:"TeamSkillBufferMgr",UnitConfigMgr:"UnitConfigMgr"}],GameUtils:[function(t,e,a){"use strict";cc._RF.push(e,"55303+X1oRCrqQN5GOU28g6","GameUtils");var n,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=t("GuideBufferMgr"),s=t("EquipBufferMgr"),o=t("HeroBufferMgr"),c=t("ItemBufferMgr"),l=t("TreasureBufferMgr"),h=t("MarqueeBufferMgr"),d=t("SoundUtil"),_={DESIGN_WIDTH:1334,DESIGN_HEIGHT:750,pad:(n=[],function(e,t){var a=t-e.toString().length;return a<=0?e:(n[a]||(n[a]=new Array(a+1).join("0")),n[a]+e)}),randInt:function(e,t){return void 0!==t?parseInt(Math.random()*(t-e)+e):parseInt(Math.random()*e)},changeNodeColor:function(e,t){e.color=t;var a=e.children;if(a)
for(var n=0;n<a.length;n++)
this.changeNodeColor(a[n],t)},callInNextTick:function(e,t,a){e&&setTimeout(function(){e(t,a)},30)},callInNext100ms:function(e,t,a){e&&setTimeout(function(){e(t,a)},100)},callInNext500ms:function(e,t,a){e&&setTimeout(function(){e(t,a)},500)},formatBytes:function(e){return 1073741824<=e?(e/1073741824).toFixed(2)+"GB":1048576<=e?(e/1048576).toFixed(2)+"MB":1024<=e?(e/1024).toFixed(2)+"KB":e+"B"},formatDate:function(e){var t="";86400<=e&&(t+=parseInt(e/86400)+" ngày ");3600<=(e%=86400)&&(t+=parseInt(e/3600)+" tiếng ");60<=(e%=3600)&&(t+=parseInt(e/60)+" phút ");return t+=(e%=60)+" giây"},formatDate2:function(e){var t=new Date(1e3*e);return t.getMonth()+1+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()},releaseAssets:function(e,t){},releaseSceneAssets:function(){},destroyAllChildren:function(e){e.destroyAllChildren()},restartGame:function(){(MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),MyPersistDataManager.resetData(),r.resetData(),s.resetData(),l.resetData(),o.resetData(),c.resetData(),MyUiManager.backAll(),h.setMarqueeCanPlay(!1),"battle"==MyUiManager.currentSceneName)&&(cc.director.getScheduler().setTimeScale(1),t("BattleManager").destroy(),d.stopAllEffects());cc.director.loadScene("login"),MyUiManager.currentSceneName="login"},clone:function(e){var t=e.constructor?new e.constructor:{};for(var a in e){var n=e[a];"object"!==(void 0===n?"undefined":i(n))||!n||n instanceof HTMLElement?t[a]=n:t[a]=this.clone(n)}
return t},back2Hall:function(){var e=t("MainHomeManager");null==e.getInstance()?t("MainHomeSceneManager").getInstance().instanceSceneNode():e.getInstance().BlackMaskFadeOut()}};e.exports=_,cc._RF.pop()},{BattleManager:"BattleManager",EquipBufferMgr:"EquipBufferMgr",GuideBufferMgr:"GuideBufferMgr",HeroBufferMgr:"HeroBufferMgr",ItemBufferMgr:"ItemBufferMgr",MainHomeManager:"MainHomeManager",MainHomeSceneManager:"MainHomeSceneManager",MarqueeBufferMgr:"MarqueeBufferMgr",SoundUtil:"SoundUtil",TreasureBufferMgr:"TreasureBufferMgr"}],GetHeroPanel:[function(e,t,a){"use strict";cc._RF.push(t,"042b1Gnh+VKPq5i0Ol2sHeU","GetHeroPanel");var h=e("ResLoaderManager"),d=e("ColorUtil"),n=e("MyProtocols"),i=e("GuideBufferMgr"),r=e("RecruitAnimCtrl"),s=e("GetTenHeroPanel"),o=e("SoundUtil");cc.Class({extends:cc.Component,properties:{TitleSpriteFrameList:[cc.SpriteFrame],BgSprite:cc.Sprite,TitleSprite:cc.Sprite,QualityLightNode:cc.Node,HeroNode:cc.Node,AnimNodeParent:cc.Node,heroLabelNode:cc.Node,heroNameFlash:cc.Node,heroInfomationNode:cc.Node,InfoNodeList:[cc.Node],HeroDes:cc.Label,BtnsNode:cc.Node,CostPicList:[cc.SpriteFrame],CostSprite:cc.Sprite,CostLabel:cc.Label,TenHeroBackBtn:cc.Node,_herojsoninfo:null,_heroItem:null,_raw_assets:Map,_StartFlag:0,_recruitType:0},onLoad:function(){this._raw_assets=new Map},DoGetHeroAnim:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];this._recruitType=t,this._herojsoninfo=DonotDestroyManager.GameData.Cards[e];var n=this._herojsoninfo.quality,i=this;cc.loader.loadRes("UI/Recruit/recruitBg"+n,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=i&&cc.isValid(i.node)&&(i.BgSprite.spriteFrame=t)});this.BgSprite.node.opacity=1;var r=cc.fadeIn(.15).easing(cc.easeIn(.2)),s=cc.callFunc(function(){n<3?this.TitleSprite.spriteFrame=this.TitleSpriteFrameList[0]:3==n&&(this.TitleSprite.spriteFrame=this.TitleSpriteFrameList[1]),this.TitleSprite.node.scale=4;var e=cc.callFunc(this.CreatHeroFunc,this),t=cc.sequence(cc.scaleTo(.15,1).easing(cc.easeIn(.2)),e);this.TitleSprite.node.runAction(t)},this);r=cc.sequence(r,s),this.BgSprite.node.runAction(r),a&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),this._shortMask_node.getComponent("ShortLoadingMask").setText("141"),cc.Canvas.instance.node.addChild(this._shortMask_node)),this._raw_assets.set("Prefab/RecruitPanel/QualityLight/QualityLight"+n,cc.Prefab),this._raw_assets.set("Prefab/Heros/"+this._herojsoninfo.icon,cc.Prefab),this._raw_assets.set("UI/Heros/soldierType"+this._herojsoninfo.unit_type,cc.SpriteFrame),this._raw_assets.set("UI/Heros/group"+this._herojsoninfo.group,cc.SpriteFrame);var o=[];this._raw_assets.forEach(function(e,t){o.push(new Array(t,e))});var c=this._loadProgressCb.bind(this),l=this._loadFinishCb.bind(this);h.asyncLoadAll(o,c,l)},_loadProgressCb:function(){},_loadFinishCb:function(e,t){var a=this;t.forEach(function(e){a._raw_assets.set(e[0],e[1]),e=null}),null!=this._shortMask_node&&(this._shortMask_node.destroy(),this._shortMask_node=null),this.CreatHeroFunc()},CreatHeroFunc:function(){if(this._StartFlag++,!(this._StartFlag<2)){this._StartFlag=0,this.AnimNodeParent.active=!0;var e=cc.instantiate(this._raw_assets.get("Prefab/RecruitPanel/QualityLight/QualityLight"+this._herojsoninfo.quality));this.QualityLightNode.addChild(e),e.setPosition(0,0);var t=[];t=2==this._herojsoninfo.unit_type?[1.08,1.35]:[1.08,1.6],this._heroItem=cc.instantiate(this._raw_assets.get("Prefab/Heros/"+this._herojsoninfo.icon)),this.HeroNode.addChild(this._heroItem),this._heroItem.setPosition(0,0),this._heroItem.scale=t[0];var a=cc.callFunc(function(){this.heroLabelNode.active=!0;var e=this.heroLabelNode.children;e[1].getComponent(cc.Sprite).spriteFrame=this._raw_assets.get("UI/Heros/soldierType"+this._herojsoninfo.unit_type),e[2].getComponent(cc.Sprite).spriteFrame=this._raw_assets.get("UI/Heros/group"+this._herojsoninfo.group),e[3].getComponent(cc.Label).string=this._herojsoninfo.name,e[3].color=d.getColorByQuality(this._herojsoninfo.quality),e[3].scale=8;var t=cc.callFunc(function(){this.heroNameFlash.active=!0},this),a=cc.scaleTo(.15,1).easing(cc.easeIn(.2));a=cc.sequence(a,t),e[3].runAction(a)},this),n=cc.scaleTo(.2,t[1]);if(n=cc.sequence(n,a),this._heroItem.runAction(n),null!=this._herojsoninfo.is_spine&&this._herojsoninfo.is_spine)
this._heroItem.getComponent(sp.Skeleton).setAnimation(0,"stand",!0),this._showInfo({type:0});else{var i=this._heroItem.getComponent(sp.Skeleton);i.setCompleteListener(this._heroEntranceComplete.bind(this)),i.setAnimation(0,"entrance",!1),i.addAnimation(0,"stand",!0,0)}
3<=this._herojsoninfo.quality&&this.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){var e=this._herojsoninfo.sound?this._herojsoninfo.sound:this._herojsoninfo.icon;o.playHeroSound(e)},this)))}},_heroEntranceComplete:function(e){var t=e.animation?e.animation.name:"";cc.log("animation event:"+t),"entrance"==t&&(this.heroInfomationNode.active=!0,this._showInfo())},_showInfo:function(){var e=this._herojsoninfo.des;this.HeroDes.string=e;var t=this._herojsoninfo.potential;this.InfoNodeList[1].children[1].getComponent(cc.Label).string=t;for(var a=this._herojsoninfo.skills,n=0;n<2;n++)
if(null!=a[n]){var i=a[n][0],r=DonotDestroyManager.GameData.Skills[i];this.InfoNodeList[2].children[n+1].children[0].getComponent(cc.Label).string=r.name,this.InfoNodeList[2].children[n+1].children[0].color=d.getColorByQuality(r.quality),this.InfoNodeList[2].children[n+1].children[1].getComponent(cc.Label).string=r.des}
this.setCostLabel();var s=cc.callFunc(function(){this.InfoNodeList[0].children[1].runAction(cc.fadeIn(.5))},this);s=cc.sequence(cc.fadeIn(.2),s);var o=cc.callFunc(function(){this.InfoNodeList[1].children[1].runAction(cc.fadeIn(.5))},this);o=cc.sequence(cc.fadeIn(.2),o);var c=cc.callFunc(function(){var e=cc.sequence(cc.fadeIn(.4),cc.callFunc(function(){this.InfoNodeList[2].children[2].runAction(cc.fadeIn(.3))},this));this.InfoNodeList[2].children[1].runAction(e)},this);if(c=cc.sequence(cc.fadeIn(.2),c),this.InfoNodeList[0].runAction(s),this.InfoNodeList[1].runAction(o),this.InfoNodeList[2].runAction(c),3!=this._recruitType&&4!=this._recruitType){var l=this;this.BtnsNode.active=!0,this.BtnsNode.opacity=0;var h=cc.sequence(cc.delayTime(1),cc.fadeIn(.2),cc.callFunc(function(){l.showGuide()}));this.BtnsNode.runAction(h)}else{this.TenHeroBackBtn.active=!0,this.TenHeroBackBtn.opacity=0;h=cc.sequence(cc.delayTime(.5),cc.fadeIn(.2));this.TenHeroBackBtn.runAction(h)}},closeSelf:function(){o.playBtnCloseEffect(),this.BtnsNode.active=!1,this.TenHeroBackBtn.active=!1,this.fadeOut()},fadeOut:function(){var e=cc.callFunc(function(){3==this._recruitType?(this._heroItem.removeFromParent(),s.getInstance().getPurpleHero(this._heroItem)):4==this._recruitType||r.getInstance().PlayPanelFadeInAnim()},this),t=cc.callFunc(function(){this.node.removeFromParent(),this.node.destroy()},this),a=cc.sequence(e,cc.fadeOut(.3),t);this.node.runAction(a)},setCostLabel:function(){switch(this._recruitType){case 1:this.CostSprite.spriteFrame=this.CostPicList[0],this.CostLabel.string=this._getItemNum(0)+"/1",0==this._getItemNum(0)?this.CostLabel.node.color=d.getColorByIndex(2):this.CostLabel.node.color=d.getColorByIndex(3);break;case 2:0<this._getItemNum(1)?(this.CostSprite.spriteFrame=this.CostPicList[1],this.CostLabel.string=this._getItemNum(1)+"/1",this.CostLabel.node.color=d.getColorByIndex(3)):(this.CostSprite.spriteFrame=this.CostPicList[2],this.CostLabel.string="1600",this.CostLabel.node.color=d.getColorByIndex(6));break;case 3:this.CostSprite.spriteFrame=this.CostPicList[2],this.CostLabel.string="13888",this.CostLabel.node.color=d.getColorByIndex(6)}},_getItemNum:function(e){var t=DonotDestroyManager.GameData.Common.recruit_hero_cost;return MyPersistDataManager._playerData.bagMap[t[e]]?MyPersistDataManager._playerData.bagMap[t[e]].num:0},reRecruit:function(){switch(o.playBtnOpenEffect(),this._recruitType){case 1:if(!(0<this._getItemNum(0)))
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không đủ trà,mau đi đánh Phó Bản");r.getInstance().ClickMaskNode.active=!0,n.send_C2SPubBuy(DonotDestroyManager._gameSocket,this._recruitType);break;case 2:if(0<this._getItemNum(1))
r.getInstance().ClickMaskNode.active=!0,n.send_C2SPubBuy(DonotDestroyManager._gameSocket,this._recruitType);else{if(!(1600<MyPersistDataManager._playerData.money))
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin nạp thêm:)");r.getInstance().ClickMaskNode.active=!0,n.send_C2SPubBuy(DonotDestroyManager._gameSocket,this._recruitType)}
break;case 3:if(!(13888<MyPersistDataManager._playerData.money))
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin nạp thêm:)");r.getInstance().ClickMaskNode.active=!0,n.send_C2SPubBuy(DonotDestroyManager._gameSocket,this._recruitType)}
r.getInstance().node.active=!0,this.node.removeFromParent(),this.node.destroy()},onDestroy:function(){null!=this._raw_assets&&(this._raw_assets.clear(),this._raw_assets=null)},showGuide:function(){var t=this;i.showGuide("GetHeroPanel",function(e){if(1==e)
return t.BtnsNode.getChildByName("btn5")})}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GetTenHeroPanel:"GetTenHeroPanel",GuideBufferMgr:"GuideBufferMgr",MyProtocols:"MyProtocols",RecruitAnimCtrl:"RecruitAnimCtrl",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil"}],GetRewardPanel:[function(e,t,a){"use strict";cc._RF.push(t,"084bcPILYlNGrF1AlmrezmK","GetRewardPanel");var o=e("SoundUtil");cc.Class({extends:cc.Component,properties:{itemContent:cc.Node,itemBox_prefab:cc.Prefab,panel_node:cc.Node,tipsGoOn:cc.Node,_isRuningAction:!1,_creatCount:0,_itemlist:null,_closeCb:null},onLoad:function(){this.fadeInStart(),this.tipsGoOn.runAction(cc.repeatForever(cc.sequence(cc.fadeTo(1,102),cc.fadeTo(1,255))))},showItem:function(r){var s=this;this._creatCount=0;var e=cc.callFunc(function(){var e=cc.instantiate(s.itemBox_prefab);this.itemContent.addChild(e),e.getComponent("ItemBox").ChangeItemInfo(r[this._creatCount].itemId||r[this._creatCount].item_template_id||r[this._creatCount].nID,r[this._creatCount].cnt||r[this._creatCount].item_count||r[this._creatCount].nNum,!0,null,!0),e.stopAllActions(),e.scale=.1;var t=cc.scaleTo(.1,1.1),a=cc.scaleTo(.1,1),n=cc.callFunc(function(){var e=this.getComponent("ItemBox").m_pActionFrame.node;e.active=!0,e.stopAllActions(),e.opacity=255;var t=cc.callFunc(function(){this.active=!1},e),a=cc.sequence(cc.fadeOut(.2),t);e.runAction(a)},e),i=cc.sequence(t,a,n);e.runAction(i),o.playGainGoodsEffect(),this._creatCount++},this),t=cc.sequence(e,cc.delayTime(.2));t=cc.repeat(t,r.length),this.itemContent.runAction(t)},closeSelf:function(){this.node.removeFromParent(),this.node.destroy(),null!=this._closeCb&&this._closeCb()},fadeInStart:function(){this._isRuningAction=!0,this.panel_node.scale=.5;var e=cc.scaleTo(.2,1),t=cc.callFunc(this._fadeInComplete,this);e=cc.sequence(e,t),this.panel_node.runAction(e)},_fadeInComplete:function(){this._isRuningAction=!1,this.showItem(this._itemlist)},fadeOutStart:function(){if(!this._isRuningAction){this._isRuningAction=!0,this.panel_node.stopAllActions();var e=cc.scaleTo(.3,.5),t=cc.callFunc(this._fadeOutComplete,this);e=cc.sequence(e,t),this.panel_node.runAction(e)}},_fadeOutComplete:function(){this._isRuningAction=!1,this.closeSelf()}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],GetTenHeroPanel:[function(e,t,a){"use strict";cc._RF.push(t,"86d5eAfuEpP/ZfRf56tbJgl","GetTenHeroPanel");var c=e("ResLoaderManager"),o="normal",l=e("RecruitManager"),n=e("RecruitAnimCtrl"),s=e("SoundUtil"),i=e("MyProtocols"),r=cc.Class({extends:cc.Component,properties:{bg_node:cc.Node,title_node:cc.Node,heroNodeParent:cc.Node,roleComing:dragonBones.ArmatureDisplay,BtnsNode:cc.Node,nameFrameList:[cc.SpriteFrame],unitTypeList:[cc.SpriteFrame],groupList:[cc.SpriteFrame],_heroIdList:[],_recruitType:3,_currentDisplayId:0,_raw_assets:Map,_StartFlag:0,_purpleHeroId:0,_itemList:[],_initCount:1,_heroBgItem:null},statics:{instance:null,getInstance:function(){return r.instance}},onLoad:function(){(r.instance=this)._heroBgItem=this.heroNodeParent.children[0].getComponent("HeroBaseNode").herotemp_node,this._heroBgInit()},_heroBgInit:function(){var e=cc.instantiate(this._heroBgItem);if(this.heroNodeParent.children[this._initCount].addChild(e),e.setPosition(0,0),this.heroNodeParent.children[this._initCount].getComponent("HeroBaseNode").herotemp_node=e,this._initCount++,this._initCount<10){var t=this._heroBgInit.bind(this);setTimeout(t,20)}},_RoleComingActionHandler:function(e){var t=e.detail.animationState.name;if("ordinary"==t){var a=cc.sequence(cc.moveBy(.1,cc.v2(0,-20)),cc.moveBy(.1,cc.v2(0,20))),n=cc.spawn(a,cc.scaleTo(.2,1)).easing(cc.easeIn(.2));this.heroNodeParent.children[this._currentDisplayId].runAction(n);var i=cc.sequence(cc.moveBy(.1,cc.v2(0,-20)),cc.moveBy(.1,cc.v2(0,20))),r=cc.spawn(i,cc.scaleTo(.2,1)).easing(cc.easeIn(.2));this.heroNodeParent.children[this._currentDisplayId].getComponent("HeroBaseNode").baseNode.runAction(r)}else if("rare"==t){a=cc.sequence(cc.moveBy(.1,cc.v2(0,-20)),cc.moveBy(.1,cc.v2(0,20))),n=cc.spawn(a,cc.scaleTo(.2,1)).easing(cc.easeIn(.2));this.heroNodeParent.children[this._currentDisplayId].runAction(n);i=cc.sequence(cc.moveBy(.1,cc.v2(0,-20)),cc.moveBy(.1,cc.v2(0,20))),r=cc.spawn(i,cc.scaleTo(.2,1)).easing(cc.easeIn(.2));this.heroNodeParent.children[this._currentDisplayId].getComponent("HeroBaseNode").baseNode.runAction(r),this.roleComing.node.setPosition(0,0),this.roleComing.armature().animation.fadeIn("rare_screen",.1,-1,0,o)}else if("rare_screen"==t){var s=cc.instantiate(l.getInstance().GetHeroPanelPrefab);s.setPosition(0,0),cc.Canvas.instance.node.addChild(s),s.getComponent("GetHeroPanel").DoGetHeroAnim(this._purpleHeroId,3,!1)}else"rare_back"==t&&(this.heroNodeParent.children[this._currentDisplayId].getComponent("HeroBaseNode").purpleLight_node.active=!0,this._currentDisplayId++,this._currentDisplayId<=9&&this.displayHero())},DoAction:function(e){this._heroIdList=e;this.bg_node.opacity=1;var t=cc.fadeIn(.15).easing(cc.easeIn(.2)),a=cc.callFunc(function(){this.title_node.scale=4;var e=cc.callFunc(this.displayHero,this),t=cc.sequence(cc.scaleTo(.15,1).easing(cc.easeIn(.2)),e);this.title_node.runAction(t)},this);t=cc.sequence(t,a),this.bg_node.runAction(t),this._raw_assets=new Map;for(var n=0;n<this._heroIdList.length;n++){var i=DonotDestroyManager.GameData.Cards[this._heroIdList[n]];this._raw_assets.set("Prefab/Heros/"+i.icon,cc.Prefab)}
this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),this._shortMask_node.getComponent("ShortLoadingMask").setText("141"),cc.Canvas.instance.node.addChild(this._shortMask_node);var r=[];this._raw_assets.forEach(function(e,t){r.push(new Array(t,e))});var s=this._loadProgressCb.bind(this),o=this._loadFinishCb.bind(this);c.asyncLoadAll(r,s,o)},_loadProgressCb:function(e){null!=this._shortMask_node&&cc.isValid(this._shortMask_node)&&this._shortMask_node.getComponent("ShortLoadingMask").loadProgressChangeTips(e)},_loadFinishCb:function(e,t){var a=this;t.forEach(function(e){a._raw_assets.set(e[0],e[1]),e=null}),null!=this._shortMask_node&&(this._shortMask_node.destroy(),this._shortMask_node=null),this.displayHero()},displayHero:function(){if(this._StartFlag++,!(this._StartFlag<2)){var i=cc.callFunc(function(){if(9==this._currentDisplayId){this.BtnsNode.active=!0,this.BtnsNode.opacity=0;var e=cc.sequence(cc.delayTime(1),cc.fadeIn(.2));this.BtnsNode.runAction(e)}
var t=this._heroIdList[this._currentDisplayId];this.heroNodeParent.children[this._currentDisplayId].getComponent("HeroBaseNode").setHeroLabel(t);var a=this.heroNodeParent.children[this._currentDisplayId].getPosition();if(a.y-=84,this.roleComing.node.active||(this.roleComing.node.active=!0,this.roleComing.addEventListener(dragonBones.EventObject.COMPLETE,this._RoleComingActionHandler,this)),this.roleComing.node.setPosition(a),3==DonotDestroyManager.GameData.Cards[t].quality)
this.roleComing.armature().animation.fadeIn("rare",.1,-1,0,o),s.playRecruitEffect(),this._purpleHeroId=t;else if(s.playRecruitCommonEffect(),this.roleComing.armature().animation.fadeIn("ordinary",.1,-1,0,o),this._currentDisplayId<9){var n=cc.sequence(cc.delayTime(.5),r,i);this.heroNodeParent.children[this._currentDisplayId].runAction(n)}},this),r=cc.callFunc(function(){this._currentDisplayId++},this);cc.sequence(i,cc.delayTime(.5),r);this.heroNodeParent.children[this._currentDisplayId].runAction(i)}},getPurpleHero:function(e){this._itemList.push(e),this.node.addChild(e),this.heroNodeParent.children[this._currentDisplayId].getComponent("HeroBaseNode").herotemp_node.active=!1;var t=this.heroNodeParent.children[this._currentDisplayId].getPosition();t.y-=84;var a=cc.spawn(cc.moveTo(.5,t),cc.scaleTo(.5,1)),n=cc.callFunc(function(){this.roleComing.node.setPosition(t),this.roleComing.armature().animation.fadeIn("rare_back",.1,-1,0,o)},this),i=cc.sequence(a,n);e.runAction(i)},closeSelf:function(){s.playBtnCloseEffect(),this.BtnsNode.active=!1,this.fadeOut(),n.getInstance().PlayPanelFadeInAnim()},fadeOut:function(){var e=cc.callFunc(function(){},this),t=cc.callFunc(function(){this.node.removeFromParent(),this.node.destroy()},this),a=cc.sequence(e,cc.fadeOut(.3),t);this.node.runAction(a)},reRecruit:function(){s.playBtnOpenEffect(),13888<MyPersistDataManager._playerData.money?(n.getInstance().ClickMaskNode.active=!0,i.send_C2SPubBuy(DonotDestroyManager._gameSocket,this._recruitType),n.getInstance().node.active=!0,this.node.removeFromParent(),this.node.destroy()):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin nạp thêm")},onDestroy:function(){null!=this._raw_assets&&(this._raw_assets.forEach(function(e,t){for(var a=cc.loader.getDependsRecursively(e),n=0;n<a.length;n++)
cc.loader.release(a[n])}),this._raw_assets.clear(),this._raw_assets=null),r.instance=null}});cc._RF.pop()},{MyProtocols:"MyProtocols",RecruitAnimCtrl:"RecruitAnimCtrl",RecruitManager:"RecruitManager",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil"}],GmPanel:[function(e,t,a){"use strict";cc._RF.push(t,"7481bOpi6VPxoee8B0D7SA4","GmPanel");var n=e("MyProtocols"),i=e("NetEvent"),r=e("MyEventDispatcher");cc.Class({extends:cc.Component,properties:{m_pInput:cc.EditBox},onLoad:function(){this.gmcmd_auth_cb_func=this.gmcmd_auth_cb.bind(this),r.addListener(i.S2CGmCmd,this.gmcmd_auth_cb_func)},gmcmd_auth_cb:function(e){cc.log("Gửi thành công==="+e.ret_code);var t="Gửi thành công";0!=e.ret_code&&(t="Gửi thất bại"),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),t)},Send_OnClickHandler:function(){""!=this.m_pInput.string?n.send_C2SGmCmd(DonotDestroyManager._gameSocket,this.m_pInput.string):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin nhập nội dung")},onDestroy:function(){r.removeListener(i.S2CGmCmd,this.gmcmd_auth_cb_func)},Close_OnClickHandler:function(e){MyUiManager.Back()}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent"}],GreyShader:[function(e,t,a){"use strict";cc._RF.push(t,"28e2fks2fVM2bphf8rWlGtj","GreyShader");t.exports={frag:"varying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\n vec4 col = texture2D(CC_Texture0, v_texCoord);\n float grey = dot(col.rgb, vec3(0.299, 0.587, 0.114));\n gl_FragColor = vec4(grey, grey, grey, col.a);\n}",vert:null,setUniforms:function(e){}},cc._RF.pop()},{}],GuideBufferMgr:[function(s,e,t){"use strict";cc._RF.push(e,"2424fMg4chHyqN7L3MwPV8l","GuideBufferMgr");var h=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=[0,13],a=[4,10],d=s("GuideSearch"),n=s("MyProtocols"),i=function(){this.resetData()};i.prototype.resetData=function(){this.is_init=!1,this.GUDIE_COMPLETE=!1,this.GuideRecord=[],this.GUIDE_OPEN_STATE=!0,this.mGuideBattlePass=!1},i.prototype.initGuideBufferMgr=function(e){if(!this.is_init){this.is_init=!0;if(null==e||0==e.length)
return this.setGuideBattlePass(!1),void(this.GuideRecord=cc.clone(DonotDestroyManager.GameData.Guide.templates));this.setGuideBattlePass(!0),this.GuideRecord=cc.clone(DonotDestroyManager.GameData.Guide.templates);for(var t=0;t<e.length;t++){var a=e[t];DonotDestroyManager.GameData.Guide.guidelist[a.module]&&(DonotDestroyManager.GameData.Guide.guidelist[a.module].length>=a.step?this.GuideRecord[a.module]=a.step:this.GuideRecord[a.module]=DonotDestroyManager.GameData.Guide.guidelist[a.module].length)}
this.GuideRecord=this.handleGuideRecord(this.GuideRecord),-1==function(e){if(e.length<DonotDestroyManager.GameData.Guide.guidelist.length)
return 0;for(var t=0;t<e.length;t++){var a=e[t];if(DonotDestroyManager.GameData.Guide.guidelist[a.module].length>a.step+1)
return 0}
return-1}
(e)&&(this.GUDIE_COMPLETE=!0)}},i.prototype.showGuide=function(t,a,n,i,r){if(i=null==i,this.GUIDE_OPEN_STATE&&!this.GUDIE_COMPLETE){var e=d.getCurPageGuideEvent(t,r),s=h(e,2),o=s[0],c=s[1];if(o)
if(this.isGuideComplete(c))
r&&n&&n();else if(c=this.handleGuideBreak(c),this.mGuideData=this.getGuideData(a,c),9999!=this.mGuideData.pos){var l=this;null==this._guidelayer&&(this._guidelayer=cc.instantiate(DonotDestroyManager.GuideLayer),cc.Canvas.instance.node.addChild(this._guidelayer,1e3)),this._guidelayer.getComponent("GuideLayer").setParams(this.mGuideData,function(e){l.mGuideData.isNoReleaseGuide||null!=l._guidelayer&&(l._guidelayer.destroy(),l._guidelayer=null),l.saveGuideRecord(l.mGuideData.guideInfo,l.mGuideData.key),1==e&&i?l.showGuide(t,a,n,null,r):n&&n(c)})}else
cc.log("guide error."+this.mGuideData.page+"guidepoint == null");else
cc.log("current page no guide event!")}},i.prototype.getGuideData=function(e,t){var a=DonotDestroyManager.GameData.Guide.guidelist[t[0]][t[1]];return a.guideInfo=t,a.pos=this.getGuidePointPos(e,a),a.fid=this.equal(t,r)?2:1,a.isRectGuide=this.isRectGuide(t),a.isNoReleaseGuide=this.isNoReleaseGuide(a),a},i.prototype.showTeamSkillGuide=function(a,e,n,i){var r=this;this.showGuide(a,e,function(){var e=s("BattleManager").getTmSkillGuidePos(i[1]),t=s("BattleUiMgr").getInstance().bf_node;r.showGuide(a,[e,t],n,null,i[0])},null,i[0])},i.prototype.showBattleSpeedGuide=function(){if(2<=s("PlayerBufferMgr").getUserLevel()&&this.isFirstBattleSpeed()){var e=s("BattleManager");e.pause(),this.showGuide("BattleLayer",null,function(){e.resume()},1)}},i.prototype.getGuidePointPos=function(e,t){if(t.st)
return cc.p(200,-50);if(e instanceof cc.Vec2)
return this.equal(t.guideInfo,r)&&(t.touchRect=cc.v2(127,226)),e;var a=null;if((a=e instanceof Function?e(t.tag):e)instanceof Array)
return this.equal(t.guideInfo,r)?(t.touchRect=new cc.Vec2(600,600),t.widget=a[2],t.endPosWorld=a[1]):(t.touchRect=cc.v2(120,120),t.widget=a[1]),a[0];if(!a)
return 9999;null!=a.getComponent(cc.Widget)&&a.getComponent(cc.Widget).updateAlignment();var n=new cc.Vec2(a.width,a.height);t.touchRect=n,t.widget=a,cc.log(a.name);var i=a.convertToWorldSpaceAR(cc.v2(0,0));return cc.log("anchorPoint."+i),i},i.prototype.saveGuideRecord=function(e,t){this.setCurGuideInfo(e),t&&this.sendUserGuideReq(e),null!=window.TDGA&&TDGA.onEvent("guide_"+e[0]+"_"+e[1],{count:1})},i.prototype.sendUserGuideReq=function(e,t){cc.log("upload guide step:"+e),n.send_C2SGuideStepSet(DonotDestroyManager._gameSocket,e[0],e[1])},i.prototype.getCurGuideInfo=function(){return this.mGuideInfo||[0,0]},i.prototype.setCurGuideInfo=function(e){this.mGuideInfo=e,this.GuideRecord[e[0]]=e[1]},i.prototype.getFormSlideGuide=function(e){return this.equal(e,r)},i.prototype.isRectGuide=function(e){for(var t=[[0,13],[2,2],[9,2],[10,2],[11,2],[19,2]],a=0;a<t.length;a++){var n=t[a];if(this.equal(n,e))
return!0}
return!1},i.prototype.isNoReleaseGuide=function(e){if("HomeMainLayer"==e.page){var t=null==e.tag,a=e.tag&&3<e.tag;return t||a}},i.prototype.isChangeGanNing=function(){return this.equal(this.getCurGuideInfo(),a)},i.prototype.setGYPGuideOver=function(){this.GuideRecord[0]<r[1]&&this.saveGuideRecord(r,!0)},i.prototype.equal=function(e,t){return e[0]==t[0]&&e[1]==t[1]},i.prototype.isStarted=function(e){return-1!=this.GuideRecord[e]},i.prototype.isGuideComplete=function(e){return DonotDestroyManager.GameData.Guide.guidelist[e[0]].length<=this.GuideRecord[e[0]]+1},i.prototype.isFirstSnatch=function(){return 0==this.GUDIE_COMPLETE&&this.GuideRecord[5]<=5?1:0},i.prototype.isFirstArean=function(){return 0==this.GUDIE_COMPLETE&&this.GuideRecord[6]<=1?1:0},i.prototype.isFirstSlot=function(){return 0==this.GUDIE_COMPLETE&&this.GuideRecord[6]<6},i.prototype.isFristEs=function(){return 0==this.GUDIE_COMPLETE&&this.GuideRecord[15]<=0?1:0},i.prototype.isFristArmy=function(){return 0==this.GUDIE_COMPLETE&&6<=this.GuideRecord[14]&&this.GuideRecord[14]<16},i.prototype.isFirstBattleSpeed=function(){return 0==this.GUDIE_COMPLETE&&-1==this.GuideRecord[22]},i.prototype.isRecruitHero=function(){return 0==this.GUDIE_COMPLETE&&1==this.GuideRecord[4]},i.prototype.getTreaHandleGuide=function(){return 20==this.getCurGuideInfo()[0]?1:2},i.prototype.isCanTreaSten=function(){return 0==this.GUDIE_COMPLETE&&2<=this.GuideRecord[20]&&this.GuideRecord[20]<5},i.prototype.isCanTreaRefine=function(){return 0==this.GUDIE_COMPLETE&&1<=this.GuideRecord[21]&&this.GuideRecord[21]<6},i.prototype.isCanEquipRefine=function(){return 0==this.GUDIE_COMPLETE&&0<=this.GuideRecord[25]&&this.GuideRecord[25]<10},i.prototype.isCanFightBoss=function(){var e=s("EliteStageBufferMgr");return 5<=this.GuideRecord[7]&&e.isStageIdPassed(104)},i.prototype.isFirstEcsGuided=function(){return 5<=this.GuideRecord[7]},i.prototype.setArmyUpGradeGuideOver=function(){this.GuideRecord[14]<16&&this.setCurGuideInfo([14,16])},i.prototype.isArmyUpGradeComplete=function(){return 16<this.GuideRecord[14]},i.prototype.isGuideBattlePass=function(){return this.mGuideBattlePass},i.prototype.setGuideBattlePass=function(e){this.mGuideBattlePass=e},i.prototype.isStoreHouseGuide=function(){return this.isCanTreaSten()||this.isCanTreaRefine()},i.prototype.offlineRewardFix=function(){-1==this.GuideRecord[0]&&(this.GuideRecord[0]=0)},i.prototype.handleGuideRecord=function(e){return 2<e[0]&&e[0]<5&&(e[0]=5),12<e[0]&&e[0]<15&&(e[0]=15),0<e[4]&&(e[23]=0),2<e[4]&&e[4]<6&&(e[4]=6),5<e[1]&&e[1]<8&&(e[1]=8),1<e[3]&&e[3]<3&&(e[3]=3),3==e[6]&&(e[6]=4),6<e[6]&&e[6]<9&&(e[6]=9),6==e[5]&&(this.setSnatchGuide(e[5]),e[5]=-1),3<e[14]&&e[14]<19&&(this.setSoliderGuide(e[14]),e[14]=-1),18<=e[14]&&(e[14]=22),10<=e[25]&&(e[25]=12),e},i.prototype.setSoliderGuide=function(e){this.soliderGudie=e},i.prototype.getSoliderGuide=function(){return this.soliderGudie},i.prototype.setSnatchGuide=function(e){this.snatchGudie=e},i.prototype.getSnatchGuide=function(){return this.snatchGudie},i.prototype.handleGuideBreak=function(e){if(1==e[0]&&3==e[1])
s("HeroBufferMgr").isInFormFirstHeroEquiped()&&(e[1]=6);else if(4==e[0]&&3==e[1]){s("HeroBufferMgr").isHasHeroByTid(46)&&(e[1]=5)}else if(4==e[0]&&9==e[1]){s("HeroBufferMgr").isHasHeroOnFormation(46)&&(e[1]=12)}
return e},i.prototype.hasHomeFirstGuide=function(e){for(var t=DonotDestroyManager.GameData.Guide.searchbox,a=0;a<t.length;a++){var n=DonotDestroyManager.GameData.Guide.searchbox[a],i=null!=this.GuideRecord[n]?this.GuideRecord[n]:-1;if(!this.isGuideComplete([n,i])){i<DonotDestroyManager.GameData.Guide.guidelist[n].length-1&&i++;var r=DonotDestroyManager.GameData.Guide.guidelist[n][i];if("HomeMainLayer"==r.page||e&&"StageSelectorLayer"==r.page){if(!d.isLevelStageAble([n,i]))
continue;return!0}}}
return!1},i.prototype.hasPageGuide=function(e){for(var t=DonotDestroyManager.GameData.Guide.searchbox,a=0;a<t.length;a++){var n=DonotDestroyManager.GameData.Guide.searchbox[a],i=null!=this.GuideRecord[n]?this.GuideRecord[n]:-1;if(!this.isGuideComplete([n,i]))
if(i<DonotDestroyManager.GameData.Guide.guidelist[n].length-1&&i++,DonotDestroyManager.GameData.Guide.guidelist[n][i].page==e){if(!d.isLevelStageAble([n,i]))
continue;return!0}}
return!1},e.exports=new i,cc._RF.pop()},{BattleManager:"BattleManager",BattleUiMgr:"BattleUiMgr",EliteStageBufferMgr:"EliteStageBufferMgr",GuideSearch:"GuideSearch",HeroBufferMgr:"HeroBufferMgr",MyProtocols:"MyProtocols",PlayerBufferMgr:"PlayerBufferMgr"}],GuideFight:[function(e,t,a){"use strict";cc._RF.push(t,"10dac6pZNxPoquVXqgacYwl","GuideFight");var _=e("PlayerBufferMgr"),u=e("BattleDataManager"),n=e("HeroConfigMgr"),c=e("StageEventCfgMgr"),i=e("BattleUtil"),r=(e("GameUtils"),e("GuideBufferMgr")),s=e("MyProtocols"),o=e("MarqueeBufferMgr"),l=function(){};l.prototype.init=function(){this.leftData=this.getLeftData(),this.rightData=this.getRightData(),this.extraBattleTeam(),this.extraBattleBuff();var e=DonotDestroyManager.GameData.StageMobs;this.background=e[101].battleground},l.prototype.enterBattlefield=function(){null!=window.TDGA&&TDGA.onEvent("guide_GuideFightStart",{count:1});var e={background:this.background,type:7},t=this;i.createBattlefield(this.leftData,this.rightData,e,function(){t.onSuccess()},function(){t.onFailure()}),i.enterRealScene()},l.prototype.onSuccess=function(){MyPersistDataManager._playerData.isNewCharacter=!1,MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),r.setGuideBattlePass(!0),s.send_C2SGuideStepSet(DonotDestroyManager._gameSocket,0,-1),null!=window.TDGA&&TDGA.onEvent("guide_GuideFightFinish",{count:1}),o.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"},l.prototype.onFailure=function(){MyPersistDataManager._playerData.isNewCharacter=!1,MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),r.setGuideBattlePass(!0),s.send_C2SGuideStepSet(DonotDestroyManager._gameSocket,0,-1),o.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"},l.prototype.extraBattleTeam=function(){for(var e=this.rightData.stage_event,t=c.getEvtTeamList(e),a=0;a<t.length;++a)
for(var n=t[a],i=0;i<n.length;++i){var r=n[i];if("left"==r.side)
for(var s=0;s<r.length;++s){var o=r[s];this.leftData.extraTeams.push(o)}
else if("right"==r.side)
for(s=0;s<r.length;++s){o=r[s];this.rightData.extraTeams.push(o)}}},l.prototype.extraBattleBuff=function(){for(var e=this.rightData.stage_event,t=c.getEvtBuffList(e),a=0;a<t.length;++a){var n=t[a];this.rightData.extraBuffs.push(n)}},l.prototype.getHeroIcon=function(e){var t=n.getHeroAttr(e,1,1);if(t.icon)
return t.icon},l.prototype.getRightData=function(){var e=DonotDestroyManager.GameData.GuideBattle,t=e.mobs,a=e.forces_attrs,n={teams:{}};n.name=t.name,n.side="right",n.level=1,n.fightVal=t.fightpower,n.formation=t.formation,n.forward=t.forward,n.flip=t.flip;var i=u.create(n);i.stageId=100,i.stage_event=e.stage_event;for(var r=Object.keys(t),s=DonotDestroyManager.GameData.Common,o=0;o<r.length;++o){var c=r[o];if("name"!=c&&"formation"!=c&&"forward"!=c&&"level"!=c&&"fightpower"!=c&&"flip"!=c&&!s.FIGHT_CONTROL_ENEMY[5]){var l={},h=t[c],d=a[h.mob_type-1];if(l.unit_level=d.unit_level,l.hero={},h.skill_enable){l.hero.skill_enable=[];for(var _=0;_<h.skill_enable.length;++_)
l.hero.skill_enable.push(h.skill_enable[_])}
d.add_attrs.rates&&(l.hero.rates_maxhp=d.add_attrs.rates.maxhp,l.hero.rates_atk=d.add_attrs.rates.atk,l.hero.rates_def=d.add_attrs.rates.def),d.add_attrs.statics&&(l.hero.static_maxhp=d.add_attrs.statics.maxhp,l.hero.static_atk=d.add_attrs.statics.atk,l.hero.static_def=d.add_attrs.statics.def),l.hero.id=h.mob_id,l.hero.icon=this.getHeroIcon(l.hero.id),l.hero.level=d.level,l.hero.grade=d.card_grade,l.unit_num=d.unit_num,l.unit_grade=d.unit_grade,l.unit_level=d.unit_level,i.addHeroWithPosition(l,h.position)}}
return i},l.prototype.getLeftData=function(){var e=DonotDestroyManager.GameData.GuideBattle,t=e.forces,a=e.forces_attrs,n={teams:{}};n.name=_.getNickName(),n.side="left",n.level=1,n.fightVal=t.fightpower,n.formation=t.formation,n.forward=t.forward,n.flip=t.flip;for(var i=u.create(n),r=Object.keys(t),s=0;s<r.length;++s){var o=r[s];if("name"!=o&&"formation"!=o&&"forward"!=o&&"level"!=o&&"fightpower"!=o&&"flip"!=o){var c=t[o],l={},h=a[c.mob_type-1];if(l.unit_level=h.unit_level,l.hero={},c.skill_enable){l.hero.skill_enable=[];for(var d=0;d<c.skill_enable.length;++d)
l.hero.skill_enable.push(c.skill_enable[d])}
h.add_attrs.rates&&(l.hero.rates_maxhp=h.add_attrs.rates.maxhp,l.hero.rates_atk=h.add_attrs.rates.atk,l.hero.rates_def=h.add_attrs.rates.def),h.add_attrs.statics&&(l.hero.static_maxhp=h.add_attrs.statics.maxhp,l.hero.static_atk=h.add_attrs.statics.atk,l.hero.static_def=h.add_attrs.statics.def),l.hero.id=c.mob_id,l.hero.icon=this.getHeroIcon(l.hero.id),l.hero.level=h.level,l.hero.grade=h.card_grade,l.unit_num=h.unit_num,l.unit_grade=h.unit_grade,l.unit_level=h.unit_level,i.addHeroWithPosition(l,c.position)}}
return i},t.exports=new l,cc._RF.pop()},{BattleDataManager:"BattleDataManager",BattleUtil:"BattleUtil",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",HeroConfigMgr:"HeroConfigMgr",MarqueeBufferMgr:"MarqueeBufferMgr",MyProtocols:"MyProtocols",PlayerBufferMgr:"PlayerBufferMgr",StageEventCfgMgr:"StageEventCfgMgr"}],GuideLayer:[function(e,t,a){"use strict";cc._RF.push(t,"037cdwPuyZMKatXfjIYRg81","GuideLayer");var n=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{mContainer:cc.Node,m_pmCircleNode:cc.Node,m_pmFrame:cc.Sprite,m_pmTalkText:cc.Label,m_pmGirl:cc.Sprite,m_pmArrow:cc.Sprite,m_pGuideSpr:[cc.SpriteFrame],m_bgSpr:cc.Node,_mStepData:null,_mTouchRect:null,_isTouchValid:!1},setParams:function(e,t){this.node.setPosition(cc.v2(0,0)),this._mStepData=e,this._touchBack=t,this.m_pmCircleNode.active=!1,this.m_pmFrame.node.active=!1,this.m_bgSpr.active=!1,this.node.runAction(cc.sequence(cc.delayTime(.03),cc.callFunc(function(){this.m_pmCircleNode.active=!0,this.m_pmFrame.node.active=!0,this.node.getComponent(cc.Widget).updateAlignment(),this.InitUI()},this)))},onLoad:function(){this.node.setLocalZOrder(1e3)},InitUI:function(){this._mTouchRect=this._mStepData.touchRect,null!=this._mTouchRect&&(this._mTouchRect.x=this._mTouchRect.x<50?50:this._mTouchRect.x,this._mTouchRect.y=this._mTouchRect.y<50?50:this._mTouchRect.y),this.setCircleVisable(this._mStepData.st),this.setBlackCoverDisplay(this._mStepData.st);var e=this.node.convertToNodeSpaceAR(this._mStepData.pos);if(cc.log(" thế giới tọa độ ======================"+this._mStepData.pos),cc.log("guide layer position:"+this.node.getPosition()),cc.log(" tiết điểm tọa độ ======================x=%d,y=%d",e.x,e.y),this.m_pmCircleNode.setPosition(e),this._mIsDragHero=n.getFormSlideGuide(this._mStepData.guideInfo),this.handleAniDispatch(this._mStepData),this.setCircleEventListener(this.m_pmCircleNode,this._mStepData,this._touchBack),this._mStepData.talk){this.m_pmFrame.node.width;this.m_pmTalkText.string=this._mStepData.talk;cc.Size(this.m_pmFrame.node.width,this.m_pmFrame.node.height);this.m_pmGirl.spriteFrame=this.m_pGuideSpr[this._mStepData.role-1],"R"==this._mStepData.dirc?(this.m_pmFrame.node.setPosition(290,-280),this.m_pmGirl.node.setScale(1),this.m_pmGirl.node.setPosition(268,90),this.m_pmTalkText.node.setPosition(-176,0)):(this.m_pmFrame.node.setPosition(-290,-280),this.m_pmGirl.node.setScale(-1,1),this.m_pmGirl.node.setPosition(-268,90),this.m_pmTalkText.node.setPosition(-99,0))}else
this.setTalkFrameVisable(!1)},playSliderHeroAni:function(){this.mContainer.active=!0,this.mContainer.stopAllActions();var e=this.m_pmCircleNode.convertToWorldSpaceAR(cc.v2(0,0)),t=this.mContainer.parent.convertToNodeSpaceAR(e);this.mContainer.setPosition(t);var a=cc.p(t),n=cc.p(a.x-5,a.y-165),i=cc.repeatForever(cc.sequence(cc.fadeIn(.3),cc.spawn(cc.moveTo(1.5,n),cc.fadeTo(2,150)),cc.fadeOut(.3),cc.delayTime(.5),cc.place(a)));this.mContainer.setCascadeOpacityEnabled(!0),this.mContainer.runAction(i)},handleAniDispatch:function(e){this._mIsDragHero&&2==e.fid&&(this.m_pmCircleNode.active=!1,this.playSliderHeroAni())},onTouchListener:function(e,t){cc.log(" điểm đánh sự kiện bao trùm ");var a=t[1],n=t[0];a(2),n.emit([e]),e.currentTarget.getComponent(cc.Button).clickEvents[0]=n},setCircleEventListener:function(s,e,t){var o=this;this.node.targetOff(this),this.node.on("touchstart",function(e){if(cc.log(" điểm đánh lâu ============"),this._mIsDragHero){this._isTouchValid=!1;var t=o.node.convertTouchToNodeSpace(e.touch),a=o.node.convertToWorldSpace(t),n=s.convertToWorldSpaceAR(cc.v2(0,0)),i=cc.pSub(a,n);if(Math.abs(i.x)<60&&Math.abs(i.y)<60){if(cc.log(" điểm đánh ngón tay khu vực ====onTouchStart"),o._mStepData.isRectGuide){var r=o._mStepData.widget;null!=r&&r.emit("touchstart",e)}
this._isTouchValid=!0}}},this),this.node.on("touchmove",function(e){var t=o._mStepData.widget;this._mIsDragHero&&null!=t&&1==this._isTouchValid&&t.emit("touchmove",e)},this),this.node.on("touchend",function(e){if(cc.log(" điểm đánh chấm dứt lâu ============"),cc.log("Touch Ended: "+e),cc.log("touchend-====================="),o._mStepData.st)
o._touchBack(1);else{var t=o.node.convertTouchToNodeSpace(e.touch),a=o.node.convertToWorldSpace(t),n=s.convertToWorldSpaceAR(cc.v2(0,0));null!=o._mStepData.endPosWorld&&(n=o._mStepData.endPosWorld);var i=cc.pSub(a,n);if(Math.abs(i.x)<o._mTouchRect.x/2&&Math.abs(i.y)<o._mTouchRect.y/2){if(cc.log(" điểm đánh ngón tay khu vực ====onTouchEnd"),o._mIsDragHero&&!o._isTouchValid)
return;if(o._mStepData.isRectGuide)
return o._touchBack(2),void(null!=(r=o._mStepData.widget)&&r.emit("touchend",e));e.target=o._mStepData.widget,o._mStepData.widget.getComponent(cc.Button).clickEvents[0].emit([e]),o._touchBack(2)}else{var r;o._mIsDragHero&&null!=(r=o._mStepData.widget)&&r.emit("touchend",e)}}},this)},setBlackCoverDisplay:function(e){this.m_bgSpr.active=!!e},isTouchInResRect:function(){},setCircleVisable:function(e){this.m_pmCircleNode.active=!e},setTalkFrameVisable:function(e){this.m_pmFrame.node.active=e},setTouchRectArean:function(e,t){}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr"}],GuideSearch:[function(d,e,t){"use strict";cc._RF.push(e,"960b0hsqpVO36OrKD6TIcQX","GuideSearch");var _=function(){};_.getCurPageGuideEvent=function(e,t){if(t&&_.isTeamSkill(t))
return[!0,[t,d("GuideBufferMgr").GuideRecord[t]+1]];var a=_.serachGuideInfo(e);return[-1!=a,a]},_.serachGuideInfo=function(e){for(var t=d("GuideBufferMgr"),a=0,n=DonotDestroyManager.GameData.Guide.searchbox.length;a<n;){var i=DonotDestroyManager.GameData.Guide.searchbox[a],r=null!=t.GuideRecord[i]?t.GuideRecord[i]:-1;if(r<DonotDestroyManager.GameData.Guide.guidelist[i].length-1){r++;var s,o=DonotDestroyManager.GameData.Guide.guidelist[i][r];if("SectionMainLayer"==e){var c=d("StageBufferMgr"),l=c.isGroupIsPass(1),h=!c.isGroupIsPass(5);if(t.GuideRecord[4]<1&&l&&h)
return[23,0]}
if(e==o.page)
if(s=_.getGuideResult(i,r))
return s;if("HomeMainLayer"==e&&"StageSelectorLayer"==o.page&&o.tag&&o.tag<7)
if(s=_.getGuideResult(i,r))
return s}
a+=1}
return cc.log("no guide can be show;"+e),-1},_.getGuideResult=function(e,t){var a=[e,t],n=d("StageBufferMgr");if(4==e)
return n.isGroupIsPass(1)?a:null;if(16==e)
return _.isSlotAble()?a:null;if(_.isLevelStageAble(a)){if(7==e&&-1<t&&t<5)
return d("EliteStageBufferMgr").isStageIdPassed(101)?null:a;var i,r=d("GuideBufferMgr");if(14==e)
if(3==t)
return[e,t=null!=(i=r.getSoliderGuide())?i+1:t];return 5==e&&1==t?[e,t=null!=(i=r.getSnatchGuide())?i:t]:a}
return null},_.isLevelStageAble=function(e){var t=DonotDestroyManager.GameData.Guide.guidelist[e[0]][e[1]],a=!1;null==t.lv&&(a=!0);var n=d("PlayerBufferMgr");t.lv&&t.lv<=n.getUserLevel()&&(a=!0);var i=!1;null==t.stage&&(i=!0);var r=d("StageBufferMgr");return!(!t.stage||!r.isStageIdPassed(t.stage))||a&&i},_.isSlotAble=function(){return 4==d("PlayerBufferMgr").getFormations()},_.isTeamSkill=function(e){for(var t=[2,9,10,11,19],a=0;a<t.length;a++)
if(e==t[a])
return!0;return!1},e.exports=_,cc._RF.pop()},{EliteStageBufferMgr:"EliteStageBufferMgr",GuideBufferMgr:"GuideBufferMgr",PlayerBufferMgr:"PlayerBufferMgr",StageBufferMgr:"StageBufferMgr"}],GuoZhanChangeNation:[function(e,t,a){"use strict";cc._RF.push(t,"3018d0qKNpHroaKoz5USoG+","GuoZhanChangeNation");var r=e("SoundUtil"),s=e("GuozhanBufferMgr"),n=e("GameUtils"),i=e("i18n"),o=e("MyProtocols"),c=e("MyEventDispatcher"),l=e("NetEvent"),h=e("GuozhanFightBufferMgr"),d=e("MyUIEvent");cc.Class({extends:cc.Component,properties:{btn_confirm:cc.Button,node_selected_tip:cc.Node,list_nations:[cc.Node],lab_cd_time:cc.Label,lab_change_cost:cc.Label,_nation_id:0},onLoad:function(){this.S2CGuozhanChangeNation_cb_func=this.S2CGuozhanChangeNation_cb.bind(this),c.addListener(l.S2CGuozhanChangeNation,this.S2CGuozhanChangeNation_cb_func)},onDestroy:function(){c.removeListener(l.S2CGuozhanChangeNation,this.S2CGuozhanChangeNation_cb_func)},S2CGuozhanChangeNation_cb:function(e){r.playGainGoodsEffectNew(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("guozhan003")),e.old_nation<=0?(MyUiManager.backAll(),setTimeout(function(){o.send_C2SGuozhanView(DonotDestroyManager._gameSocket)},200)):(s.updateMyNationId(e.target_nation,e.change_nation_cd),h.updateMyNationId(e.target_nation,e.change_nation_cd),s.updateOfficeIndex(-1),h.updateOfficeIndex(-1),MyUiManager.Back(),null!=this._closeCb&&this._closeCb(),c.dispatchEvent(d.onGuoZhanNationChange)),MyPersistDataManager._playerData.nation_id=e.target_nation},start:function(){0==s.getMyNation()?(this._nation_id=n.randInt(1,4),this._nation_id=3<this._nation_id?3:this._nation_id):(this._nation_id=s.getMyNation(),this.btn_confirm.interactable=!1);var e=this.list_nations[this._nation_id-1];this.node_selected_tip.x=e.x;var t=s.getChangeNationCd();this.lab_cd_time.string=0<t?n.formatDate(t):"",this.lab_change_cost.string="X"+DonotDestroyManager.GameData.Common.guozhan_change_nation_cost},setParams:function(e){this._netData=e.info,this._closeCb=e.closeCb},Back_onClickHandler:function(){r.playBtnCloseEffect(),MyUiManager.Back()},confirm_clickHander:function(e,t){r.playBtnOpenEffect(),s.getMyNation()!=this._nation_id?o.send_C2SGuozhanChangeNation(DonotDestroyManager._gameSocket,this._nation_id):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("guozhan002"))},changeNation_clickHander:function(e,t){r.playBtnOpenEffect();var a=parseInt(t),n=this.list_nations[a];this.node_selected_tip.x=n.x;var i=a+1;this._nation_id=i,s.getMyNation()==i?this.btn_confirm.interactable=!1:this.btn_confirm.interactable=!0}}),cc._RF.pop()},{GameUtils:"GameUtils",GuozhanBufferMgr:"GuozhanBufferMgr",GuozhanFightBufferMgr:"GuozhanFightBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],GuoZhanCityNode:[function(e,t,a){"use strict";cc._RF.push(t,"bb638nvw59BI7GMHWAp3LiV","GuoZhanCityNode");var n=e("SoundUtil"),i=e("GuozhanBufferMgr"),r=e("MyProtocols"),s=e("i18n"),o=e("MyEventDispatcher"),c=e("MyUIEvent"),l=[cc.color(0,214,255),cc.color(255,127,0),cc.Color.GREEN,cc.Color.WHITE,cc.Color.YELLOW];cc.Class({extends:cc.Component,properties:{spr_city:cc.Sprite,lab_city_name:cc.Label,_city_index:0},changeData:function(e,t){this._city_index=e.ChengID-1;var a=e.countryType+"_"+e.img;this.spr_city.spriteFrame=t.getSpriteFrame(a),this.lab_city_name.string=e.ChengName,this.lab_city_name.node.color=l[e.countryType-1]},start:function(){this.node.on("touchstart",this.ClickStartHandler,this),this.node.on("touchend",this.ClickEndHandler,this)},ClickStartHandler:function(e){this._beganTouch=e.touch.getLocation()},ClickEndHandler:function(e){var t=e.touch.getLocation();cc.pDistance(t,this._beganTouch)<30&&this.clickHanlder_detail()},clickHanlder_detail:function(){n.playBtnOpenEffect(),this.node.runAction(cc.sequence(cc.scaleTo(.08,1.2),cc.scaleTo(.08,1),cc.callFunc(function(){this.doClick()},this)))},doClick:function(){if(i.isCityPass(this._city_index))
i._netData.player_city_index!=this._city_index?o.dispatchEvent(c.onGuozhanMove,this._city_index):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Bạn đã di chuyển đến thành này!");else{var e=DonotDestroyManager.GameData.Common.guozhan_pve_energy_cost[0];if(MyPersistDataManager._playerData.energy<e)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),s.t("guozhan001",{energy:e}),1e3);i.hasWay2City(this._city_index)?0==i._netData.pass_city_index.length?r.send_C2SGuozhanBattleStart(DonotDestroyManager._gameSocket,this._city_index):o.dispatchEvent(c.onGuozhanMove,this._city_index):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Đường đến thành này không thông!")}}}),cc._RF.pop()},{GuozhanBufferMgr:"GuozhanBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],GuoZhanCityPanel:[function(e,t,a){"use strict";cc._RF.push(t,"31b1f7+9IxINqpkYP0nqQHs","GuoZhanCityPanel");var _=e("GuozhanFightBufferMgr"),n=e("SoundUtil"),i=(e("MyProtocols"),e("MyEventDispatcher")),r=e("NetEvent");cc.Class({extends:cc.Component,properties:{lab_city_name:cc.Label,lab_my_steps:cc.Label,lab_cost_steps:cc.Label,spr_country:cc.Sprite,res_countrys:[cc.SpriteFrame],nodes_move_btn:[cc.Node],node_fight_btn:cc.Node,pre_city_player:cc.Prefab,m_playerDetailPrefab:cc.Prefab,_city_index:0},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back()},onLoad:function(){this.S2CRankPlayerDetail_cb_func=this.S2CRankPlayerDetail_cb.bind(this),i.addListener(r.S2CRankPlayerDetail,this.S2CRankPlayerDetail_cb_func)},onDestroy:function(){i.removeListener(r.S2CRankPlayerDetail,this.S2CRankPlayerDetail_cb_func)},S2CRankPlayerDetail_cb:function(e){cc.log(" ngoạn gia anh hùng đội hình tin tức tiếp thu ");var t=cc.instantiate(this.m_playerDetailPrefab);cc.Canvas.instance.node.addChild(t),t.getComponent("RankPlayerDetail").ChangeData(e)},setParams:function(e){var t=e.netData,a=_.getCityInfo(t.city_index);this._city_index=t.city_index,this.spr_country.spriteFrame=this.res_countrys[a.nation_id-1],a.nation_id==_.getMyNation()?this.spr_country.node.color=cc.Color.GREEN:this.spr_country.node.color=cc.Color.RED;var n=DonotDestroyManager.GameData.CityList[t.city_index];if(this.lab_city_name.string=n.ChengName,this.lab_my_steps.string=_._netData.move_step,_._netData.my_city_index==t.city_index){this.node_fight_btn.active=!1;for(var i=0;i<this.nodes_move_btn.length;i++){this.nodes_move_btn[i].active=!1}
this.lab_cost_steps.string=0,this.lab_cost_steps.node.color=cc.Color.GREEN}else if(a.nation_id==_.getMyNation()){this.node_fight_btn.active=!1;for(var r=0;r<this.nodes_move_btn.length;r++){this.nodes_move_btn[r].active=!0}}else{this.node_fight_btn.active=!0;for(var s=0;s<this.nodes_move_btn.length;s++){this.nodes_move_btn[s].active=!1}}
var o=_.getCostSteps(t.city_index);o<0?o=999:a.nation_id!=_.getMyNation()&&(o+=2),this._cost_steps=o,this.lab_cost_steps.string=o,_._netData.move_step>=o?this.lab_cost_steps.node.color=cc.Color.GREEN:this.lab_cost_steps.node.color=cc.Color.RED;for(var c=0;c<t.players.length;c++){var l=t.players[c],h=_.getCityPlayerPos(c),d=cc.instantiate(this.pre_city_player);d.setPosition(h[0],h[1]),this.node.addChild(d),d.getComponent("GuoZhanCityPlayer").changeData(l,a.nation_id)}},start:function(){},clickHandler_move:function(e,t){n.playBtnOpenEffect(),-1!=_.getMyCityIndex()?_._netData.move_step<this._cost_steps?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Không đủ bước,không thể đến thành này!"):(MyUiManager.Back(),_.setTargetCityIndex(this._city_index)):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Hiện tại bạn chưa chiếm thành nào!")}}),cc._RF.pop()},{GuozhanFightBufferMgr:"GuozhanFightBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],GuoZhanCityPlayer:[function(e,t,a){"use strict";cc._RF.push(t,"ef5a3mf+ghLioh+JzVrUclw","GuoZhanCityPlayer");var o=e("HeroConfigMgr"),c=e("GuozhanFightBufferMgr"),n=e("SoundUtil"),i=e("MyProtocols");cc.Class({extends:cc.Component,properties:{spr_country:cc.Sprite,spr_head_frame:cc.Sprite,spr_head_icon:cc.Sprite,lab_level:cc.Label,lab_name:cc.Label,res_country_pic:[cc.SpriteFrame],m_pIconSpriteFrames:[cc.SpriteFrame],node_hp_percent:cc.Node},changeData:function(e,t){if(this._player_id=e.id,this.spr_country.spriteFrame=this.res_country_pic[t-1],this.lab_level.string=e.level,this.lab_name.string=e.nickname,e.id==MyPersistDataManager._playerData.id?this.lab_name.node.color=cc.Color.GREEN:t==c.getMyNation()?this.lab_name.node.color=cc.Color.YELLOW:this.lab_name.node.color=cc.Color.RED,e.icon<10)
this.spr_head_icon.spriteFrame=this.m_pIconSpriteFrames[e.icon-1];else{var a=e.icon-10,n=o.find(a);if(null!=n){var i=n.icon,r=this;cc.loader.loadRes("UI/Heros/"+i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r&&cc.isValid(r.node)&&(r.spr_head_icon.spriteFrame=t,r.spr_head_icon.node.width=87,r.spr_head_icon.node.height=87)})}}
var s=DonotDestroyManager.GameData.HeadFrame[e.head_frame_id-1];r=this;cc.loader.loadRes("UI/HeadFrame/"+s.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r&&cc.isValid(r.node)&&(r.spr_head_frame.spriteFrame=t)}),this.node_hp_percent.width=223*e.hp_perc/100},start:function(){},ZR_clickHander:function(e,t){n.playBtnOpenEffect(),i.send_C2SRankPlayerDetail(DonotDestroyManager._gameSocket,2,this._player_id)}}),cc._RF.pop()},{GuozhanFightBufferMgr:"GuozhanFightBufferMgr",HeroConfigMgr:"HeroConfigMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil"}],GuoZhanConstants:[function(e,t,a){"use strict";cc._RF.push(t,"d95e4LHka9JT7sobczUSamf","GuoZhanConstants"),t.exports={NATION_LIST:["Ngụy","Thục","Ngô"]},cc._RF.pop()},{}],GuoZhanFightCity:[function(e,t,a){"use strict";cc._RF.push(t,"1f7abye//ZMyKJ27SLjuUse","GuoZhanFightCity");var n=e("SoundUtil"),o=e("GuozhanFightBufferMgr"),i=e("MyProtocols"),c=(e("i18n"),e("MyEventDispatcher"),e("MyUIEvent"),[cc.color(0,214,255),cc.color(255,127,0),cc.Color.GREEN,cc.Color.WHITE,cc.Color.YELLOW]);cc.Class({extends:cc.Component,properties:{spr_city:cc.Sprite,lab_city_name:cc.Label,lab_occupy_players:cc.Label,pre_fire:cc.Prefab,_city_index:0},changeData:function(e,t){this._city_index=e.ChengID-1,this.updateUI(e,t)},updateUI:function(e,t){var a=o.getCityOwnNation(this._city_index),n=a+"_"+e.img;this.spr_city.spriteFrame=t.getSpriteFrame(n),this.lab_city_name.string=e.ChengName,this.lab_city_name.node.color=c[a-1];var i=o.getCityInfo(this._city_index);0==i.player_size?this.lab_occupy_players.string="Thành trống":this.lab_occupy_players.string=i.player_name+"("+i.player_size+")";var r=this.node.getChildByName("fire");if(1==i.in_battle&&null==r){var s=cc.instantiate(this.pre_fire);this.node.addChild(s)}else
0==i.in_battle&&null!=r&&(r.destroy(),r=null)},start:function(){this.node.on("touchstart",this.ClickStartHandler,this),this.node.on("touchend",this.ClickEndHandler,this)},ClickStartHandler:function(e){this._beganTouch=e.touch.getLocation()},ClickEndHandler:function(e){var t=e.touch.getLocation();cc.pDistance(t,this._beganTouch)<30&&this.clickHanlder_detail()},clickHanlder_detail:function(){n.playBtnOpenEffect(),o.isPlayerMoving()?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Đội của bạn đang hành quân,xin thử lại sau!"):this.node.runAction(cc.sequence(cc.scaleTo(.08,1.2),cc.scaleTo(.08,1),cc.callFunc(function(){this.doClick()},this)))},doClick:function(){i.send_C2SGuoZhanCityDetail(DonotDestroyManager._gameSocket,this._city_index)}}),cc._RF.pop()},{GuozhanFightBufferMgr:"GuozhanFightBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],GuoZhanFightPanel:[function(e,t,a){"use strict";cc._RF.push(t,"adb6aVTPDNFJIxKElFiOrGJ","GuoZhanFightPanel");var i=e("SoundUtil"),p=e("GuozhanFightBufferMgr"),f=e("MyProtocols"),n=e("NetEvent"),r=e("MyUIEvent"),s=e("MyEventDispatcher"),o=(e("NPCFightCfgMgr"),e("BattleBufferMgr")),g=e("GameUtils"),c=e("GuozhanBufferMgr"),l=e("i18n"),y=[0,31,62];cc.Class({extends:cc.Component,properties:{node_bg_map:cc.Node,citySpriteAtlas:cc.SpriteAtlas,node_scene_parent:cc.Node,node_city_parent:cc.Node,node_yun_parent:cc.Node,pre_city_item:cc.Prefab,mini_map_point_parent:cc.Node,spr_minimap_huang_kuang:cc.Node,spr_minimap_cur_city:cc.Node,pre_ketiaozhan:cc.Prefab,node_player_move_tip:cc.Node,node_guide:cc.Node,lab_my_steps:cc.Label,labs_nation_city_count:[cc.Label],res_wei_shu_wu:[cc.SpriteFrame],res_maps:[cc.SpriteFrame],res_minimap_point:[cc.SpriteFrame],m_pRewardPanel:cc.Prefab,spr_role_pos:cc.Sprite,res_role_pic:[cc.SpriteFrame],_beganTouch:null,_lstTouch:null,_moveTowardVec:null,_start_frame:0,_player_node:cc.Node,_way_path_list:[]},setParams:function(e){this.closeCb=e.closeCb},goBack:function(){i.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},onLoad:function(){this.S2CArenaFormation_cb_func=this.S2CArenaFormation_cb.bind(this),s.addListener(n.S2CArenaFormation,this.S2CArenaFormation_cb_func),this.S2CGuozhanMove_cb_func=this.S2CGuozhanMove_cb.bind(this),s.addListener(n.S2CGuozhanMove,this.S2CGuozhanMove_cb_func),this.onGuozhanMove_cb_func=this.onGuozhanMove_cb.bind(this),s.addListener(r.onGuozhanMove,this.onGuozhanMove_cb_func),this.S2CGuozhanOfficeView_cb_func=this.S2CGuozhanOfficeView_cb.bind(this),s.addListener(n.S2CGuozhanOfficeView,this.S2CGuozhanOfficeView_cb_func),this.S2CGuoZhanCityDetail_cb_func=this.S2CGuoZhanCityDetail_cb.bind(this),s.addListener(n.S2CGuoZhanCityDetail,this.S2CGuoZhanCityDetail_cb_func),this.S2CGuoZhanCityMove_cb_func=this.S2CGuoZhanCityMove_cb.bind(this),s.addListener(n.S2CGuoZhanCityMove,this.S2CGuoZhanCityMove_cb_func),this.S2CGuozhanFightView_cb_func=this.S2CGuozhanFightView_cb.bind(this),s.addListener(n.S2CGuozhanFightView,this.S2CGuozhanFightView_cb_func),this.S2CGuozhanCityCalculate_cb_func=this.S2CGuozhanCityCalculate_cb.bind(this),s.addListener(n.S2CGuozhanCityCalculate,this.S2CGuozhanCityCalculate_cb_func),this.onGuoZhanNationChange_cb_func=this.onGuoZhanNationChange_cb.bind(this),s.addListener(r.onGuoZhanNationChange,this.onGuoZhanNationChange_cb_func),this.PushGuoZhanPass_cb_func=this.PushGuoZhanPass_cb.bind(this),s.addListener(n.PushGuoZhanPass,this.PushGuoZhanPass_cb_func),this.S2CGuozhanHistory_cb_func=this.S2CGuozhanHistory_cb.bind(this),s.addListener(n.S2CGuozhanHistory,this.S2CGuozhanHistory_cb_func)},onDestroy:function(){s.removeListener(n.S2CArenaFormation,this.S2CArenaFormation_cb_func),s.removeListener(n.S2CGuozhanMove,this.S2CGuozhanMove_cb_func),s.removeListener(r.onGuozhanMove,this.onGuozhanMove_cb_func),s.removeListener(n.S2CGuozhanOfficeView,this.S2CGuozhanOfficeView_cb_func),s.removeListener(n.S2CGuoZhanCityDetail,this.S2CGuoZhanCityDetail_cb_func),s.removeListener(n.S2CGuoZhanCityMove,this.S2CGuoZhanCityMove_cb_func),s.removeListener(n.S2CGuozhanFightView,this.S2CGuozhanFightView_cb_func),s.removeListener(n.S2CGuozhanCityCalculate,this.S2CGuozhanCityCalculate_cb_func),s.removeListener(r.onGuoZhanNationChange,this.onGuoZhanNationChange_cb_func),s.removeListener(n.PushGuoZhanPass,this.PushGuoZhanPass_cb_func),s.removeListener(n.S2CGuozhanHistory,this.S2CGuozhanHistory_cb_func)},S2CGuozhanHistory_cb:function(e){MyUiManager.Open(MyUiManager.PanelInfo.MineHistoryRecrod,{netData:e,closeCb:null,panelType:2})},PushGuoZhanPass_cb:function(e){MyUiManager.backAll(),setTimeout(function(){f.send_C2SGuozhanView(DonotDestroyManager._gameSocket)},200)},onGuoZhanNationChange_cb:function(){this.updateCityPointInfo(),this.updateUI(),this.removeKeTiaoZhan(),this.addKeTiaoZhan(),this.refreshSmallMap(),this.clickHanlder_myPos(null,null,!0),this.refreshPlayerPosition()},S2CGuozhanCityCalculate_cb:function(e){if(i.playGainGoodsEffectNew(),1==e.ret){if(null!=e.rewards&&0<e.rewards.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.rewards,t.getComponent("GetRewardPanel")._closeCb=this.awardCloseCb.bind(this)}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Chiếm thành công!");this.updateCityPointInfo(),this.updateUI(),this.removeKeTiaoZhan(),this.addKeTiaoZhan(),this.refreshSmallMap()}},awardCloseCb:function(){var e=p.getMyCityIndex(),t=DonotDestroyManager.GameData.CityList[e].ChengName;MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),l.t("guozhan006",{value:t}))},S2CGuozhanFightView_cb:function(e){p.updateNetData(e),c.updateNetData(e)},S2CGuoZhanCityMove_cb:function(e){if(1==e.ret)
this.updateCityPointInfo(),this.updateUI(),this.refreshSmallMap();else if(0==e.players.length){var t=e.r-MyPersistDataManager._playerData.id,a=[p._netData.hp_perc];f.send_C2SGuozhanCityCalculate(DonotDestroyManager._gameSocket,1,a,t)}else
p.updateMoveStep(e.move_step),p.setRightHero(e.players),this.OpenFormationLayer(e.players[0])},S2CGuoZhanCityDetail_cb:function(e){MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanCityPanel,{netData:e,closeCb:null})},S2CGuozhanOfficeView_cb:function(e){c.setOfficePlayers(e),MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanOffice,{})},onGuozhanMove_cb:function(e){var t=p.getMyCityIndex();null!=this._way_path_list&&1<=this._way_path_list.length&&(t=this._way_path_list[0]),null!=this._player_node&&this._player_node.stopAllActions();var a=p.getWay2City(t,e);0!=a.length&&null!=this._player_node&&(this._way_path_list=a,this.node_player_move_tip.active=!0,this.playerMoveStep())},playerMoveStep:function(){if(null==this._way_path_list||1==this._way_path_list.length){this._player_node.getComponent(sp.Skeleton).setAnimation(0,"stand",!0);var e=this._way_path_list[0];return this._way_path_list=[],f.send_C2SGuoZhanCityMove(DonotDestroyManager._gameSocket,e),p.setDoMove(!1),void(this.node_player_move_tip.active=!1)}
this._player_node.getComponent(sp.Skeleton).setAnimation(0,"walk",!0);var t=Math.abs(this._player_node.scaleX),a=DonotDestroyManager.GameData.CityList[this._way_path_list[0]];DonotDestroyManager.GameData.CityList[this._way_path_list[1]].pointX>a.pointX?this._player_node.scaleX=t:this._player_node.scaleX=-t,this._way_path_list.shift();var n=DonotDestroyManager.GameData.CityList[this._way_path_list[0]];this._player_node.runAction(cc.sequence(cc.moveTo(2,cc.p(n.pointX,50-n.pointY)),cc.callFunc(function(){this.playerMoveStep()},this)))},S2CGuozhanMove_cb:function(e){p.updateStayCityIndex(e.city_index)},S2CArenaFormation_cb:function(e){cc.log(" tiếp thu pvp đội hình tin tức "),MyPersistDataManager._playerData.pvpformation=e.formation,null!=e.formation&&o.setFormationData(2,e.formation)},OpenFormationLayer:function(e){var t=p._enemyInfo.length,a=e.base_info.nickname+"(1/"+t+")",n=e.base_info.fight,i={name:a+"LV."+e.base_info.level,fight:n,formation:e.formation.formationId,flip:e.formation.flip,forward:e.formation.forward,Teams:this.GetEnemyTeams(e),id:0};MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:i,panelinfo:{fid:2},battletype:15})},GetEnemyTeams:function(e){var t=[],a=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a].level;return 0};if(0<e.formation.a){var n=a(e.cards,e.formation.a);t.push({id:e.formation.a,level:n,position:"a"})}
if(0<e.formation.b){n=a(e.cards,e.formation.b);t.push({id:e.formation.b,level:n,position:"b"})}
if(0<e.formation.c){n=a(e.cards,e.formation.c);t.push({id:e.formation.c,level:n,position:"c"})}
if(0<e.formation.d){n=a(e.cards,e.formation.d);t.push({id:e.formation.d,level:n,position:"d"})}
if(0<e.formation.e){n=a(e.cards,e.formation.e);t.push({id:e.formation.e,level:n,position:"e"})}
if(0<e.formation.f){n=a(e.cards,e.formation.f);t.push({id:e.formation.f,level:n,position:"f"})}
if(0<e.formation.g){n=a(e.cards,e.formation.g);t.push({id:e.formation.g,level:n,position:"g"})}
if(0<e.formation.h){n=a(e.cards,e.formation.h);t.push({id:e.formation.h,level:n,position:"h"})}
if(0<e.formation.i){n=a(e.cards,e.formation.i);t.push({id:e.formation.i,level:n,position:"i"})}
if(0<e.formation.j){n=a(e.cards,e.formation.j);t.push({id:e.formation.j,level:n,position:"j"})}
return t},start:function(){null==MyPersistDataManager._playerData.pvpformation&&f.send_C2SArenaFormation(DonotDestroyManager._gameSocket),this.updateUI();for(var e=0;e<this.node_bg_map.children.length;e++){var t=this.node_bg_map.children[e];t.getComponent(cc.Sprite).spriteFrame=this.res_maps[e];var a=e%6*600+300,n=554* -parseInt(e/6)-277;t.setPosition(a,n)}
for(var i=DonotDestroyManager.GameData.CityList,r=0;r<i.length;r++){var s=i[r],o=cc.instantiate(this.pre_city_item);o.setPosition(s.pointX,-s.pointY),this.node_city_parent.addChild(o),o.getComponent("GuoZhanFightCity").changeData(s,this.citySpriteAtlas)}
for(var c=0;c<y.length;c++){var l=y[c],h=this.node_city_parent.children[l],d=new cc.Node("CityRoot#"+c);d.setPosition(0,265),d.setScale(.5),d.addComponent(cc.Sprite).spriteFrame=this.res_wei_shu_wu[c],h.addChild(d)}
if(this.addKeTiaoZhan(),this.registerFieldTouches(),-1<p.getMyCityIndex())
this.initScenePositionByCity(p.getMyCityIndex());else{var _=p.getMyNation();this.initScenePositionByCity(y[_-1])}
if(this.initSmallMap(),this.registMiniMapClick(),-1<p.getMyCityIndex()){var u=this,m=1==MyPersistDataManager._playerData.sex?"boy":"girl";cc.loader.loadRes("Prefab/GuoZhan/guozhan_"+m,cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),u._player_node=cc.instantiate(t),u.node_scene_parent.addChild(u._player_node);var a=DonotDestroyManager.GameData.CityList[p.getMyCityIndex()];u._player_node.setPosition(a.pointX,50-a.pointY),u._player_node.setScale(.8),u._player_node.getComponent(sp.Skeleton).setAnimation(0,"stand",!0)})}
p.isPlayerMoving()&&g.callInNextTick(function(e){e.onGuozhanMove_cb(p.getTargetCityIndex())},this),this.spr_role_pos.spriteFrame=this.res_role_pic[MyPersistDataManager._playerData.sex-1]},refreshPlayerPosition:function(){if(null!=this._player_node){var e=DonotDestroyManager.GameData.CityList[p.getMyCityIndex()];this._player_node.setPosition(e.pointX,50-e.pointY)}},removeKeTiaoZhan:function(){for(var e=0;e<this.node_city_parent.children.length;e++){var t=this.node_city_parent.children[e].getChildByName("ketiaozhan");null!=t&&t.destroy()}},addKeTiaoZhan:function(){for(var e=p.getInBattleCitys(),t=0;t<e.length;t++){var a=e[t],n=this.node_city_parent.children[a],i=cc.instantiate(this.pre_ketiaozhan);i.setPosition(0,60),n.addChild(i,1,"ketiaozhan"),i.getComponent(sp.Skeleton).setAnimation(0,"newAnimation",!0)}},updateUI:function(){var e=p.getMyNation();this.lab_my_steps.string=p._netData.move_step;for(var t=0;t<this.labs_nation_city_count.length;t++){var a=this.labs_nation_city_count[t];a.string=p._netData.nation_city_count[t],a.node.color=e-1==t?cc.Color.GREEN:cc.Color.RED}},updateCityPointInfo:function(){for(var e=DonotDestroyManager.GameData.CityList,t=0;t<this.node_city_parent.children.length;t++){var a=e[t];this.node_city_parent.children[t].getComponent("GuoZhanFightCity").updateUI(a,this.citySpriteAtlas)}},registMiniMapClick:function(){this.mini_map_point_parent.on("touchstart",this.MinimapClickStartHandler,this),this.mini_map_point_parent.on("touchmove",this.MinimapClickMoveHandler,this)},MinimapClickStartHandler:function(e){var t=this.mini_map_point_parent.convertTouchToNodeSpaceAR(e.touch),a=3600* -t.x/this.mini_map_point_parent.width,n=3324* -t.y/this.mini_map_point_parent.height;this.updateScenePosition(a,n)},MinimapClickMoveHandler:function(e){if(cc.director.getTotalFrames()%3==0){var t=this.mini_map_point_parent.convertTouchToNodeSpaceAR(e.touch),a=3600* -t.x/this.mini_map_point_parent.width,n=3324* -t.y/this.mini_map_point_parent.height;this.updateScenePosition(a,n)}},initSmallMap:function(){for(var e=DonotDestroyManager.GameData.CityList,t=0;t<e.length;t++){var a=e[t],n=new cc.Node("MiniMapPoint#"+t);n.setPosition(a.pointX*this.mini_map_point_parent.width/3600,-a.pointY*this.mini_map_point_parent.height/3324);var i=n.addComponent(cc.Sprite),r=p.getCityOwnNation(t);i.spriteFrame=this.res_minimap_point[r-1],this.mini_map_point_parent.addChild(n)}
if(this.spr_minimap_huang_kuang.zIndex=2,this.spr_minimap_huang_kuang.width=cc.director.getVisibleSize().width*this.mini_map_point_parent.width/3600,this.spr_minimap_huang_kuang.height=cc.director.getVisibleSize().height*this.mini_map_point_parent.height/3324,-(this.spr_minimap_cur_city.zIndex=1)<p.getMyCityIndex()){var s=DonotDestroyManager.GameData.CityList[p.getMyCityIndex()];this.spr_minimap_cur_city.setPosition(s.pointX*this.mini_map_point_parent.width/3600,12-s.pointY*this.mini_map_point_parent.height/3324);var o=cc.moveBy(.5,cc.p(0,6));this.spr_minimap_cur_city.runAction(cc.repeatForever(cc.sequence(o,o.reverse())))}else
this.spr_minimap_cur_city.active=!1;for(var c=p.getInBattleCitys(),l=0;l<c.length;l++){var h=c[l];this.mini_map_point_parent.children[h+2].getComponent(cc.Sprite).spriteFrame=this.res_minimap_point[this.res_minimap_point.length-1]}},refreshSmallMap:function(){for(var e=0;e<this.mini_map_point_parent.children.length-2;e++){var t=this.mini_map_point_parent.children[e],a=p.getCityOwnNation(e);t.getComponent(cc.Sprite).spriteFrame=this.res_minimap_point[a-1]}
if(-(this.spr_minimap_cur_city.zIndex=1)<p.getMyCityIndex()){var n=DonotDestroyManager.GameData.CityList[p.getMyCityIndex()];this.spr_minimap_cur_city.setPosition(n.pointX*this.mini_map_point_parent.width/3600,12-n.pointY*this.mini_map_point_parent.height/3324),this.spr_minimap_cur_city.stopAllActions();var i=cc.moveBy(.5,cc.p(0,6));this.spr_minimap_cur_city.runAction(cc.repeatForever(cc.sequence(i,i.reverse())))}
for(var r=p.getInBattleCitys(),s=0;s<r.length;s++){var o=r[s];this.mini_map_point_parent.children[o].getComponent(cc.Sprite).spriteFrame=this.res_minimap_point[this.res_minimap_point.length-1]}},registerFieldTouches:function(){this.node_scene_parent.on("touchstart",this.BfClickStartHandler,this),this.node_scene_parent.on("touchmove",this.BfClickMoveHandler,this),this.node_scene_parent.on("touchend",this.BfClickEndHandler,this),this.node_scene_parent.on("touchcancel",this.BfClickCancelHandler,this)},BfClickCancelHandler:function(e){this.node_scene_parent.stopAllActions()},BfClickStartHandler:function(e){this._beganTouch=e.touch.getLocation(),this._lstTouch=this._beganTouch,this.node_scene_parent.stopAllActions(),this._start_frame=cc.director.getTotalFrames()},BfClickMoveHandler:function(e){var t=e.touch.getLocation(),a=cc.pSub(t,this._lstTouch);this._moveTowardVec=a;var n=cc.pAdd(cc.p(this.node_scene_parent.getPosition()),a);this.updateScenePosition(n.x,n.y),this._lstTouch=t},BfClickEndHandler:function(e){if(null!=this._moveTowardVec&&null!=this._lstTouch){if(cc.pDistance(this._beganTouch,this._lstTouch)/(cc.director.getTotalFrames()-this._start_frame)<5)
return!1;this._moveTowardVec.normalizeSelf(),this._moveTowardVec.mulSelf(250);var t=cc.pAdd(cc.p(this.node_scene_parent.getPosition()),this._moveTowardVec);t.x=Math.min(-cc.director.getVisibleSize().width/2,Math.max(t.x,cc.director.getVisibleSize().width/2-3600)),t.y=Math.min(3324-cc.director.getVisibleSize().height/2,Math.max(t.y,cc.director.getVisibleSize().height/2)),this.node_scene_parent.runAction(cc.sequence(cc.moveTo(.8,t).easing(cc.easeCubicActionOut()),cc.callFunc(function(e){this.updateScenePosition(e.x,e.y)},this)))}},initScenePositionByCity:function(e){var t=DonotDestroyManager.GameData.CityList[e];this.updateScenePosition(-t.pointX,t.pointY-80)},updateScenePosition:function(e,t){e=Math.min(-cc.director.getVisibleSize().width/2,Math.max(e,cc.director.getVisibleSize().width/2-3600)),t=Math.min(3324-cc.director.getVisibleSize().height/2,Math.max(t,cc.director.getVisibleSize().height/2)),this.node_scene_parent.setPosition(e,t),this.spr_minimap_huang_kuang.setPosition(-e*this.mini_map_point_parent.width/3600,-t*this.mini_map_point_parent.height/3324)},update:function(e){if(1<=this._way_path_list.length&&cc.director.getTotalFrames()%4==0){var t=this._player_node.getPosition();this.spr_minimap_cur_city.setPosition(t.x*this.mini_map_point_parent.width/3600,12-(-t.y-50)*this.mini_map_point_parent.height/3324)}},clickHanlder_ui:function(e,t){i.playBtnOpenEffect(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Mở khi vượt hết ải các thành trong thế giới sương mù!")},clickHanlder_office:function(e,t){i.playBtnOpenEffect(),p.isPvePass()?0==p.getMyNation()?MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanChangeNation,{closeCb:function(){0<p.getMyNation()&&f.send_C2SGuozhanOfficeView(DonotDestroyManager._gameSocket)}}):f.send_C2SGuozhanOfficeView(DonotDestroyManager._gameSocket):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Mở khi vượt hết ải các thành trong thế giới sương mù!")},clickHanlder_help:function(e,t){i.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.CommonHelpPanel,{title:l.t("guozhan007"),content:l.t("guozhan008")})},clickHanlder_changeNation:function(e,t){i.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanChangeNation,{})},clickHanlder_myPos:function(e,t,a){if(null==a&&i.playBtnOpenEffect(),-1<p.getMyCityIndex())
this.initScenePositionByCity(p.getMyCityIndex());else{var n=p.getMyNation();this.initScenePositionByCity(y[n-1])}},clickHanlder_defenceFormation:function(e,t){i.playBtnOpenEffect();MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:{name:"Cài đặt đội hình PVP",fight:0,formation:1,flip:0,forward:0,Teams:[],id:0},panelinfo:{fid:2},battletype:16})},clickHanlder_historyRecord:function(e,t){i.playBtnOpenEffect(),f.send_C2SGuozhanHistory(DonotDestroyManager._gameSocket)}}),cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",GameUtils:"GameUtils",GuozhanBufferMgr:"GuozhanBufferMgr",GuozhanFightBufferMgr:"GuozhanFightBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NPCFightCfgMgr:"NPCFightCfgMgr",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],GuoZhanMainPanel:[function(e,t,a){"use strict";cc._RF.push(t,"dc146+fsxdBzJcq00ro33Qf","GuoZhanMainPanel");var n=e("SoundUtil"),I=e("GuozhanBufferMgr"),b=e("MyProtocols"),i=e("NetEvent"),r=e("MyUIEvent"),s=e("MyEventDispatcher"),o=e("NPCFightCfgMgr"),c=e("BattleBufferMgr"),P=e("GameUtils"),L=[31,0,62];cc.Class({extends:cc.Component,properties:{node_bg_map:cc.Node,citySpriteAtlas:cc.SpriteAtlas,node_scene_parent:cc.Node,node_city_parent:cc.Node,node_yun_parent:cc.Node,pre_city_item:cc.Prefab,mini_map_point_parent:cc.Node,spr_minimap_huang_kuang:cc.Node,spr_minimap_cur_city:cc.Node,pre_ketiaozhan:cc.Prefab,node_player_move_tip:cc.Node,node_guide:cc.Node,res_wei_shu_wu:[cc.SpriteFrame],res_maps:[cc.SpriteFrame],res_minimap_point:[cc.SpriteFrame],res_yun:[cc.SpriteFrame],_beganTouch:null,_lstTouch:null,_moveTowardVec:null,_start_frame:0,_player_node:cc.Node,_way_path_list:[]},setParams:function(e){this.closeCb=e.closeCb,this._netData=e.netData},goBack:function(){n.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},onLoad:function(){this.S2CGuozhanBattleStart_cb_func=this.S2CGuozhanBattleStart_cb.bind(this),s.addListener(i.S2CGuozhanBattleStart,this.S2CGuozhanBattleStart_cb_func),this.S2CArenaFormation_cb_func=this.S2CArenaFormation_cb.bind(this),s.addListener(i.S2CArenaFormation,this.S2CArenaFormation_cb_func),this.S2CGuozhanMove_cb_func=this.S2CGuozhanMove_cb.bind(this),s.addListener(i.S2CGuozhanMove,this.S2CGuozhanMove_cb_func),this.onGuozhanMove_cb_func=this.onGuozhanMove_cb.bind(this),s.addListener(r.onGuozhanMove,this.onGuozhanMove_cb_func),this.S2CGuozhanOfficeView_cb_func=this.S2CGuozhanOfficeView_cb.bind(this),s.addListener(i.S2CGuozhanOfficeView,this.S2CGuozhanOfficeView_cb_func)},onDestroy:function(){s.removeListener(i.S2CGuozhanBattleStart,this.S2CGuozhanBattleStart_cb_func),s.removeListener(i.S2CArenaFormation,this.S2CArenaFormation_cb_func),s.removeListener(i.S2CGuozhanMove,this.S2CGuozhanMove_cb_func),s.removeListener(r.onGuozhanMove,this.onGuozhanMove_cb_func),s.removeListener(i.S2CGuozhanOfficeView,this.S2CGuozhanOfficeView_cb_func)},S2CGuozhanOfficeView_cb:function(e){I.setOfficePlayers(e),MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanOffice,{})},onGuozhanMove_cb:function(e){var t=I._netData.player_city_index;null!=this._way_path_list&&1<=this._way_path_list.length&&(t=this._way_path_list[0]),null!=this._player_node&&this._player_node.stopAllActions();var a=I.getWay2City(t,e);0!=a.length&&null!=this._player_node&&(this._way_path_list=a,this.node_player_move_tip.active=!0,this.playerMoveStep())},playerMoveStep:function(){if(null==this._way_path_list||1==this._way_path_list.length){this._player_node.getComponent(sp.Skeleton).setAnimation(0,"stand",!0);var e=this._way_path_list[0];return this._way_path_list=[],I.isCityPass(e)?b.send_C2SGuozhanMove(DonotDestroyManager._gameSocket,e):b.send_C2SGuozhanBattleStart(DonotDestroyManager._gameSocket,e),void(this.node_player_move_tip.active=!1)}
this._player_node.getComponent(sp.Skeleton).setAnimation(0,"walk",!0);var t=Math.abs(this._player_node.scaleX),a=DonotDestroyManager.GameData.CityList[this._way_path_list[0]];DonotDestroyManager.GameData.CityList[this._way_path_list[1]].pointX>a.pointX?this._player_node.scaleX=t:this._player_node.scaleX=-t,this._way_path_list.shift();var n=DonotDestroyManager.GameData.CityList[this._way_path_list[0]];this._player_node.runAction(cc.sequence(cc.moveTo(2,cc.p(n.pointX,50-n.pointY)),cc.callFunc(function(){this.playerMoveStep()},this)))},S2CGuozhanMove_cb:function(e){I.updateStayCityIndex(e.city_index)},S2CArenaFormation_cb:function(e){cc.log(" tiếp thu pvp đội hình tin tức "),MyPersistDataManager._playerData.pvpformation=e.formation,null!=e.formation&&c.setFormationData(2,e.formation)},S2CGuozhanBattleStart_cb:function(e){I.setRightHero(e),this.OpenFormationLayer(e)},OpenFormationLayer:function(e){var t=DonotDestroyManager.GameData.CityList[e.city_index].ChengName+"Thủ Quân",a=o.getRobotFightVal(e.cards),n={name:t+"LV."+e.enemy_level,fight:a,formation:e.formation.formationId,flip:e.formation.flip,forward:e.formation.forward,Teams:this.GetEnemyTeams(e),id:0};MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:n,panelinfo:{fid:2},battletype:13})},GetEnemyTeams:function(e){var t=[],a=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a].level;return 0};if(0<e.formation.a){var n=a(e.cards,e.formation.a);t.push({id:e.formation.a,level:n,position:"a"})}
if(0<e.formation.b){n=a(e.cards,e.formation.b);t.push({id:e.formation.b,level:n,position:"b"})}
if(0<e.formation.c){n=a(e.cards,e.formation.c);t.push({id:e.formation.c,level:n,position:"c"})}
if(0<e.formation.d){n=a(e.cards,e.formation.d);t.push({id:e.formation.d,level:n,position:"d"})}
if(0<e.formation.e){n=a(e.cards,e.formation.e);t.push({id:e.formation.e,level:n,position:"e"})}
if(0<e.formation.f){n=a(e.cards,e.formation.f);t.push({id:e.formation.f,level:n,position:"f"})}
if(0<e.formation.g){n=a(e.cards,e.formation.g);t.push({id:e.formation.g,level:n,position:"g"})}
if(0<e.formation.h){n=a(e.cards,e.formation.h);t.push({id:e.formation.h,level:n,position:"h"})}
if(0<e.formation.i){n=a(e.cards,e.formation.i);t.push({id:e.formation.i,level:n,position:"i"})}
if(0<e.formation.j){n=a(e.cards,e.formation.j);t.push({id:e.formation.j,level:n,position:"j"})}
return t},start:function(){null==MyPersistDataManager._playerData.pvpformation&&b.send_C2SArenaFormation(DonotDestroyManager._gameSocket);for(var e=0;e<this.node_bg_map.children.length;e++){var t=this.node_bg_map.children[e];t.getComponent(cc.Sprite).spriteFrame=this.res_maps[e];var a=e%6*600+300,n=554* -parseInt(e/6)-277;t.setPosition(a,n)}
for(var i=DonotDestroyManager.GameData.CityList,r=0;r<i.length;r++){var s=i[r],o=cc.instantiate(this.pre_city_item);o.setPosition(s.pointX,-s.pointY),this.node_city_parent.addChild(o),o.getComponent("GuoZhanCityNode").changeData(s,this.citySpriteAtlas)}
for(var c=0;c<L.length;c++){var l=L[c],h=this.node_city_parent.children[l],d=new cc.Node("CityRoot#"+c);d.setPosition(0,265),d.setScale(.5),(D=d.addComponent(cc.Sprite)).spriteFrame=this.res_wei_shu_wu[c],h.addChild(d)}
for(var _=I.getInBattleCitys(),u=0;u<_.length;u++){var m=_[u],p=this.node_city_parent.children[m],f=cc.instantiate(this.pre_ketiaozhan);f.setPosition(0,60),p.addChild(f,1),f.getComponent(sp.Skeleton).setAnimation(0,"newAnimation",!0)}
if(0==this._netData.pass_city_index.length){var g=this.node_city_parent.children[0];this.node_guide.active=!0,this.node_guide.parent=g,this.node_guide.zIndex=2,this.node_guide.setPosition(0,70),this.node_guide.getComponent(sp.Skeleton).setAnimation(0,"action1",!0)}
if(this.registerFieldTouches(),this.initScenePositionByCity(this._netData.player_city_index),this.initSmallMap(),this.registMiniMapClick(),0<this._netData.pass_city_index.length){var y=this,v=1==MyPersistDataManager._playerData.sex?"boy":"girl";cc.loader.loadRes("Prefab/GuoZhan/guozhan_"+v,cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),y._player_node=cc.instantiate(t),y.node_scene_parent.addChild(y._player_node);var a=DonotDestroyManager.GameData.CityList[y._netData.player_city_index];y._player_node.setPosition(a.pointX,50-a.pointY),y._player_node.setScale(.8),y._player_node.getComponent(sp.Skeleton).setAnimation(0,"stand",!0)})}
for(var M=0;M<i.length;M++){var S=i[M];if(!I.isCityPass(M)){var C=new cc.Node("yun#"+M);C.setPosition(S.pointX,-S.pointY);var D=C.addComponent(cc.Sprite);0==this._netData.pass_city_index.length&&0==M?D.spriteFrame=this.res_yun[2]:I.isCityInBattle(M)?D.spriteFrame=this.res_yun[1]:D.spriteFrame=this.res_yun[0],this.node_yun_parent.addChild(C)}}
I.isPvePass()&&0==I.getMyNation()&&P.callInNext100ms(function(){MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanChangeNation,{})})},registMiniMapClick:function(){this.mini_map_point_parent.on("touchstart",this.MinimapClickStartHandler,this),this.mini_map_point_parent.on("touchmove",this.MinimapClickMoveHandler,this)},MinimapClickStartHandler:function(e){var t=this.mini_map_point_parent.convertTouchToNodeSpaceAR(e.touch),a=3600* -t.x/this.mini_map_point_parent.width,n=3324* -t.y/this.mini_map_point_parent.height;this.updateScenePosition(a,n)},MinimapClickMoveHandler:function(e){if(cc.director.getTotalFrames()%3==0){var t=this.mini_map_point_parent.convertTouchToNodeSpaceAR(e.touch),a=3600* -t.x/this.mini_map_point_parent.width,n=3324* -t.y/this.mini_map_point_parent.height;this.updateScenePosition(a,n)}},initSmallMap:function(){for(var e=DonotDestroyManager.GameData.CityList,t=0;t<e.length;t++){var a=e[t],n=new cc.Node("MiniMapPoint#"+t);n.setPosition(a.pointX*this.mini_map_point_parent.width/3600,-a.pointY*this.mini_map_point_parent.height/3324),n.addComponent(cc.Sprite).spriteFrame=this.res_minimap_point[a.countryType-1],this.mini_map_point_parent.addChild(n)}
this.spr_minimap_huang_kuang.zIndex=2,this.spr_minimap_huang_kuang.width=cc.director.getVisibleSize().width*this.mini_map_point_parent.width/3600,this.spr_minimap_huang_kuang.height=cc.director.getVisibleSize().height*this.mini_map_point_parent.height/3324,this.spr_minimap_cur_city.zIndex=1;var i=DonotDestroyManager.GameData.CityList[this._netData.player_city_index];this.spr_minimap_cur_city.setPosition(i.pointX*this.mini_map_point_parent.width/3600,12-i.pointY*this.mini_map_point_parent.height/3324);var r=cc.moveBy(.5,cc.p(0,6));this.spr_minimap_cur_city.runAction(cc.repeatForever(cc.sequence(r,r.reverse())));for(var s=I.getInBattleCitys(),o=0;o<s.length;o++){var c=s[o];this.mini_map_point_parent.children[c+2].getComponent(cc.Sprite).spriteFrame=this.res_minimap_point[this.res_minimap_point.length-1]}},registerFieldTouches:function(){this.node_scene_parent.on("touchstart",this.BfClickStartHandler,this),this.node_scene_parent.on("touchmove",this.BfClickMoveHandler,this),this.node_scene_parent.on("touchend",this.BfClickEndHandler,this),this.node_scene_parent.on("touchcancel",this.BfClickCancelHandler,this)},BfClickCancelHandler:function(e){this.node_scene_parent.stopAllActions()},BfClickStartHandler:function(e){this._beganTouch=e.touch.getLocation(),this._lstTouch=this._beganTouch,this.node_scene_parent.stopAllActions(),this._start_frame=cc.director.getTotalFrames()},BfClickMoveHandler:function(e){var t=e.touch.getLocation(),a=cc.pSub(t,this._lstTouch);this._moveTowardVec=a;var n=cc.pAdd(cc.p(this.node_scene_parent.getPosition()),a);this.updateScenePosition(n.x,n.y),this._lstTouch=t},BfClickEndHandler:function(e){if(null!=this._moveTowardVec&&null!=this._lstTouch){if(cc.pDistance(this._beganTouch,this._lstTouch)/(cc.director.getTotalFrames()-this._start_frame)<5)
return!1;this._moveTowardVec.normalizeSelf(),this._moveTowardVec.mulSelf(250);var t=cc.pAdd(cc.p(this.node_scene_parent.getPosition()),this._moveTowardVec);t.x=Math.min(-cc.director.getVisibleSize().width/2,Math.max(t.x,cc.director.getVisibleSize().width/2-3600)),t.y=Math.min(3324-cc.director.getVisibleSize().height/2,Math.max(t.y,cc.director.getVisibleSize().height/2)),this.node_scene_parent.runAction(cc.sequence(cc.moveTo(.8,t).easing(cc.easeCubicActionOut()),cc.callFunc(function(e){this.updateScenePosition(e.x,e.y)},this)))}},initScenePositionByCity:function(e){var t=DonotDestroyManager.GameData.CityList[e];this.updateScenePosition(-t.pointX,t.pointY-80)},updateScenePosition:function(e,t){e=Math.min(-cc.director.getVisibleSize().width/2,Math.max(e,cc.director.getVisibleSize().width/2-3600)),t=Math.min(3324-cc.director.getVisibleSize().height/2,Math.max(t,cc.director.getVisibleSize().height/2)),this.node_scene_parent.setPosition(e,t),this.spr_minimap_huang_kuang.setPosition(-e*this.mini_map_point_parent.width/3600,-t*this.mini_map_point_parent.height/3324)},update:function(e){if(1<=this._way_path_list.length&&cc.director.getTotalFrames()%4==0){var t=this._player_node.getPosition();this.spr_minimap_cur_city.setPosition(t.x*this.mini_map_point_parent.width/3600,12-(-t.y-50)*this.mini_map_point_parent.height/3324)}},clickHanlder_ui:function(e,t){n.playBtnOpenEffect(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Mở khi vượt hết ải các thành trong thế giới sương mù!")},clickHanlder_changeNation:function(e,t){MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanChangeNation,{})},clickHanlder_office:function(e,t){n.playBtnOpenEffect(),I.isPvePass()?0==I.getMyNation()?MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanChangeNation,{closeCb:function(){0<I.getMyNation()&&b.send_C2SGuozhanOfficeView(DonotDestroyManager._gameSocket)}}):b.send_C2SGuozhanOfficeView(DonotDestroyManager._gameSocket):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Mở khi vượt hết ải các thành trong thế giới sương mù!")}}),cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",GameUtils:"GameUtils",GuozhanBufferMgr:"GuozhanBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NPCFightCfgMgr:"NPCFightCfgMgr",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],GuoZhanOfficeIcon:[function(e,t,a){"use strict";cc._RF.push(t,"23cfaWCD1dHtZwoNgHKCRuz","GuoZhanOfficeIcon");var m=e("GuoZhanConstants"),p=e("GuozhanBufferMgr"),f=e("HeroConfigMgr"),n=e("SoundUtil"),i=e("MyProtocols");cc.Class({extends:cc.Component,properties:{lab_position:cc.Label,lab_enemy_name:cc.Label,lab_level:cc.Label,spr_head_icon:cc.Sprite,spr_head_frame:cc.Sprite,btn_fight:cc.Button,m_pIconSpriteFrames:[cc.SpriteFrame],_level_index:0,_pos_index:0},setParams:function(e,t){this._level_index=e,this._pos_index=t;var a=DonotDestroyManager.GameData.GuoZhanOffice[e].positions[t],n=p.getMyNation(),i=m.NATION_LIST[n-1];0==e&&(a=i+a),this.lab_position.string=a;var r=p.getOfficeIndex();r=-1==r?10:parseInt(r/10),this.btn_fight.interactable=e==r-1;var s=p.getOfficePlayer(e,t),o=0,c=null;if(null!=s)
this.lab_enemy_name.string=s.nickname,s.id==MyPersistDataManager._playerData.id?this.lab_enemy_name.node.color=cc.Color.GREEN:this.lab_enemy_name.node.color=cc.Color.WHITE,this.lab_level.string=s.level,s.icon<10?this.spr_head_icon.spriteFrame=this.m_pIconSpriteFrames[s.icon-1]:o=s.icon-10,c=DonotDestroyManager.GameData.HeadFrame[s.head_frame_id-1];else{this.lab_enemy_name.string=i+" Quốc Vệ Binh",this.lab_enemy_name.node.color=cc.Color.WHITE;var l=2*(10-e)+30;this.lab_level.string=l;var h=parseInt(2*Math.random());h=2<=h?1:h,this.spr_head_icon.spriteFrame=this.m_pIconSpriteFrames[h],c=DonotDestroyManager.GameData.HeadFrame[0]}
if(0<o){var d=f.find(o);if(null!=d){var _=d.icon,u=this;cc.loader.loadRes("UI/Heros/"+_,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=u&&cc.isValid(u.node)&&(u.spr_head_icon.spriteFrame=t,u.spr_head_icon.node.width=87,u.spr_head_icon.node.height=87)})}}
u=this;cc.loader.loadRes("UI/HeadFrame/"+c.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=u&&cc.isValid(u.node)&&(u.spr_head_frame.spriteFrame=t)})},start:function(){},fight_clickHander:function(e,t){n.playBtnOpenEffect();var a=DonotDestroyManager.GameData.Common.guozhan_pve_energy_cost[0];MyPersistDataManager._playerData.energy<a?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),i18n.t("guozhan001",{energy:a}),1e3):i.send_C2SGuozhanOfficeDetail(DonotDestroyManager._gameSocket,10*this._level_index+this._pos_index)}}),cc._RF.pop()},{GuoZhanConstants:"GuoZhanConstants",GuozhanBufferMgr:"GuozhanBufferMgr",HeroConfigMgr:"HeroConfigMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil"}],GuoZhanOfficeWrapItem:[function(e,t,a){"use strict";cc._RF.push(t,"897dc83r7RHKItmLeNSf+ch","GuoZhanOfficeWrapItem");var n=e("GuoZhanOffice");cc.Class({extends:cc.Component,properties:{lab_office_title:cc.Label,pre_office_icon:cc.Prefab,node_icon_parent:cc.Node,lab_energy_cost:cc.Label,spr_guozhan_title:cc.Sprite,res_titles:[cc.SpriteFrame],pre_reward_tips:cc.Prefab,_itemID:0},onLoad:function(){this.spr_guozhan_title.node.on("touchstart",this.onTipsTouchBegan,this),this.spr_guozhan_title.node.on("touchcancel",this.onTipsTouchEnded,this),this.spr_guozhan_title.node.on("touchend",this.onTipsTouchEnded,this)},onTipsTouchBegan:function(){this._tipNode=cc.instantiate(this.pre_reward_tips),n.instance.node.addChild(this._tipNode),this._tipNode.getComponent("GuoZhanTips").setParams(this._itemID)},onTipsTouchEnded:function(){null!=this._tipNode&&(this._tipNode.destroy(),this._tipNode=null)},updateItem:function(e){this._itemID=e,this.lab_office_title.string=DonotDestroyManager.GameData.GuoZhanOffice[e].title,this.reuseItems(),this.initPlayerIcons(),this.lab_energy_cost.string="-"+DonotDestroyManager.GameData.Common.guozhan_pve_energy_cost[0],this.spr_guozhan_title.spriteFrame=this.res_titles[e]},reuseItems:function(){var e=this.node_icon_parent.children;if(null!=e&&0<e.length)
for(var t=e.length-1;0<=t;t--)
n.instance._player_icon_pool.put(e[t])},initPlayerIcons:function(){for(var e=DonotDestroyManager.GameData.GuoZhanOffice[this._itemID],t=0;t<e.positions.length;t++){var a=n.instance._player_icon_pool.get();null==a&&((a=cc.instantiate(this.pre_office_icon)).scale=.85),this.node_icon_parent.addChild(a),a.getComponent("GuoZhanOfficeIcon").setParams(this._itemID,t)}},start:function(){}}),cc._RF.pop()},{GuoZhanOffice:"GuoZhanOffice"}],GuoZhanOffice:[function(e,t,a){"use strict";cc._RF.push(t,"f91afAS65JAs7R30B0ZB4Yw","GuoZhanOffice");var n=e("SoundUtil"),c=e("GuozhanBufferMgr"),l=e("GuoZhanConstants"),i=e("MyEventDispatcher"),r=e("NetEvent"),h=e("NPCFightCfgMgr"),s=e("i18n"),o=e("MyProtocols"),d=cc.Class({extends:cc.Component,properties:{spr_nations:[cc.SpriteFrame],spr_nation:cc.Sprite,_player_icon_pool:cc.NodePool,mScrollView:cc.ScrollView,itemTemplate:cc.Prefab,itemTemplateHeight:180,spawnCount:5,spacing:0,bufferZone:400},setParams:function(e){this._netData=e.info},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back()},statics:{instance:null},onLoad:function(){(d.instance=this)._player_icon_pool=new cc.NodePool("LeftRuneItem"),this.S2CGuozhanOfficeDetail_cb_func=this.S2CGuozhanOfficeDetail_cb.bind(this),i.addListener(r.S2CGuozhanOfficeDetail,this.S2CGuozhanOfficeDetail_cb_func)},onDestroy:function(){d.instance=null,this._player_icon_pool.clear(),i.removeListener(r.S2CGuozhanOfficeDetail,this.S2CGuozhanOfficeDetail_cb_func)},start:function(){this.createScrollItems(),this.node.runAction(cc.sequence(cc.delayTime(.02),cc.callFunc(function(){var e=c.getOfficeIndex();e=-1==e?10:parseInt(e/10),this.mScrollView.scrollToPercentVertical((10-e)/10)},this)));var e=c.getMyNation();this.spr_nation.spriteFrame=this.spr_nations[e-1]},S2CGuozhanOfficeDetail_cb:function(e){this.OpenFormationLayer(e)},OpenFormationLayer:function(e){var t=e.office_index;c.setOfficeEnemyData(e);var a=parseInt(t/10),n=c.getMyNation(),i=l.NATION_LIST[n-1],r=null!=e.base_info?e.base_info.nickname:i+" Quốc Vệ Binh",s=null!=e.base_info?e.base_info.fight:h.getRobotFightVal(e.cards),o={name:r+"LV."+(null!=e.base_info?e.base_info.level:2*(10-a)+30),fight:s,formation:e.formation.formationId,flip:e.formation.flip,forward:e.formation.forward,Teams:this.GetEnemyTeams(e),id:0};MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:o,panelinfo:{fid:2},battletype:14})},GetEnemyTeams:function(e){var t=[],a=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a].level;return 0};if(0<e.formation.a){var n=a(e.cards,e.formation.a);t.push({id:e.formation.a,level:n,position:"a"})}
if(0<e.formation.b){n=a(e.cards,e.formation.b);t.push({id:e.formation.b,level:n,position:"b"})}
if(0<e.formation.c){n=a(e.cards,e.formation.c);t.push({id:e.formation.c,level:n,position:"c"})}
if(0<e.formation.d){n=a(e.cards,e.formation.d);t.push({id:e.formation.d,level:n,position:"d"})}
if(0<e.formation.e){n=a(e.cards,e.formation.e);t.push({id:e.formation.e,level:n,position:"e"})}
if(0<e.formation.f){n=a(e.cards,e.formation.f);t.push({id:e.formation.f,level:n,position:"f"})}
if(0<e.formation.g){n=a(e.cards,e.formation.g);t.push({id:e.formation.g,level:n,position:"g"})}
if(0<e.formation.h){n=a(e.cards,e.formation.h);t.push({id:e.formation.h,level:n,position:"h"})}
if(0<e.formation.i){n=a(e.cards,e.formation.i);t.push({id:e.formation.i,level:n,position:"i"})}
if(0<e.formation.j){n=a(e.cards,e.formation.j);t.push({id:e.formation.j,level:n,position:"j"})}
return t},createScrollItems:function(){this.content=this.mScrollView.content;var e=DonotDestroyManager.GameData.GuoZhanOffice.length;if(this.content.height=e*(this.itemTemplateHeight+this.spacing)+this.spacing,0==this.content.children.length){this._spawnItems=[],this.updateTimer=0,this.updateInterval=.2;for(var t=this.lastContentPosY=0;t<this.spawnCount;++t){var a=cc.instantiate(this.itemTemplate);this.content.addChild(a),a.setPosition(0,-a.height*(.5+t)-this.spacing*(t+1)),a.getComponent("GuoZhanOfficeWrapItem").updateItem(t),this._spawnItems.push(a)}
null!=this._scrollOffset&&this.node.runAction(cc.sequence(cc.delayTime(.02),cc.callFunc(function(){this.mScrollView.scrollToOffset(this._scrollOffset)},this)))}},getPositionInView:function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.mScrollView.node.convertToNodeSpaceAR(t)},update:function(e){if(this.updateTimer+=e,!(this.updateTimer<this.updateInterval)){this.updateTimer=0;var t=this._spawnItems;if(null!=t){for(var a=this.bufferZone,n=this.mScrollView.content.y<this.lastContentPosY,i=(this.itemTemplateHeight+this.spacing)*t.length,r=0;r<t.length;++r){var s=this.getPositionInView(t[r]);if(n){if(s.y<-a&&t[r].y+i<0){t[r].setPositionY(t[r].y+i);var o=t[r].getComponent("GuoZhanOfficeWrapItem"),c=o._itemID-t.length;o.updateItem(c)}}else if(s.y>a&&t[r].y-i>-this.content.height){t[r].setPositionY(t[r].y-i);var l=t[r].getComponent("GuoZhanOfficeWrapItem"),h=l._itemID+t.length;l.updateItem(h)}}
this.lastContentPosY=this.mScrollView.content.y}}},switch_nation_clickHandler:function(e,t){n.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanChangeNation,{closeCb:function(){MyUiManager.Back(),o.send_C2SGuozhanOfficeView(DonotDestroyManager._gameSocket)}})},help_clickHanlder:function(e,t){n.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.CommonHelpPanel,{title:s.t("guozhan004"),content:s.t("guozhan005")})}});cc._RF.pop()},{GuoZhanConstants:"GuoZhanConstants",GuozhanBufferMgr:"GuozhanBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NPCFightCfgMgr:"NPCFightCfgMgr",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],GuoZhanTips:[function(e,t,a){"use strict";cc._RF.push(t,"50520itNAVGRoQwDjrJDQyc","GuoZhanTips");var r=e("ItemsConfigMgr");cc.Class({extends:cc.Component,properties:{lab_gold:cc.Label,lab_cooper:cc.Label,lab_item_reward:cc.Label,lab_rank_reward:cc.Label},start:function(){},setParams:function(e){var t=DonotDestroyManager.GameData.GuoZhanReward[e];this.lab_gold.string=t.money,this.lab_cooper.string=t.gamemoney;for(var a="",n=0;n<t.items.length;n++){var i=t.items[n];a+=r.processItemCfg(i[0]).name+"X"+i[1]+"，"}
a=a.substring(0,a.length-1),this.lab_item_reward.string=a,this.lab_rank_reward.string=0==e?"1. Lời nhắc máy chủ đầy đủ trực tuyến \ n2. Vị trí chính thức hiển thị trò chuyện":"1. Trò chuyện để hiển thị các vị trí chính thức"}}),cc._RF.pop()},{ItemsConfigMgr:"ItemsConfigMgr"}],GuozhanBattleManager:[function(s,e,t){"use strict";cc._RF.push(e,"f3298/mVBRACKNPxfDm2n6Q","GuozhanBattleManager");s("TeamDataUtil");var u=s("BattleDataManager"),n=s("BattleUtil"),m=s("HeroConfigMgr"),a=s("MyProtocols"),d=s("PlayerBufferMgr"),_=s("HeroBufferMgr"),p=s("BattleBufferMgr"),o=s("GuozhanBufferMgr"),c=s("BattleManager"),i=function(){};i.prototype.init=function(e,t,a){var n=DonotDestroyManager.GameData.StageMobs;this.leftData=this.getLeftData(),this.rightData=this.getRightData(e),this.leftData.fightVal=t,this.rightData.fightVal=a,this.background=n[1606].battleground,this.mEmenyData=e},i.prototype.enterBattlefield=function(){var e=DonotDestroyManager.GameData.TeamSkillsAI,t={background:this.background,teamAiCfg:e[4],type:13},a=this;n.createBattlefield(this.leftData,this.rightData,t,function(){a.onSuccess()},function(){a.onFailure()}),n.enterRealScene()},i.prototype.onSuccess=function(){var e=this.mEmenyData.r-MyPersistDataManager._playerData.id;a.send_C2SGuozhanBattleEnd(DonotDestroyManager._gameSocket,this.mEmenyData.city_index,1,e)},i.prototype.onFailure=function(){var e=this.mEmenyData.r-MyPersistDataManager._playerData.id;a.send_C2SGuozhanBattleEnd(DonotDestroyManager._gameSocket,this.mEmenyData.city_index,0,e)},i.prototype.calculateS2cCb=function(e){var t=s("BattleSceneMgr");if(0!=e.ret){var a=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/GuozhanPveWinPanel"]);cc.Canvas.instance.node.addChild(a);var n={info:e,enemy_name:"Chiếm:"+DonotDestroyManager.GameData.CityList[e.city_index].ChengName,cost_energy:-DonotDestroyManager.GameData.Common.guozhan_pve_energy_cost[0]};a.getComponent("GuozhanPveWinPanel").ChangeData(n),a.getComponent("GuozhanPveWinPanel").setStatistics(this.leftData,this.rightData,c.statistics),o.passCity(e.city_index)}else{var i=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(i);var r=DonotDestroyManager.GameData.Common.guozhan_pve_energy_cost[1];i.getComponent("BattleFailMgr").initUi(13,{cost_energy:r,staticData:c.statistics})}},i.prototype.getLeftData=function(){var e={side:"left"};e.name=d.getNickName(),e.level=d.getUserLevel();var t=p.getFormationData(2);e.formation=t.formationId,e.forward=t.forward,e.flip=t.flip;for(var a=u.create(e),n=Object.keys(t),i=0;i<n.length;++i){var r=n[i];if("fid"!=r&&"formationId"!=r&&"forward"!=r&&"flip"!=r&&"0"!=r){var s=t[r],o=_.getHeroByUid(s);o&&(delete o.hpPerc,delete o.atkPerc,a.addCardWithPosition(o,r))}}
for(var c=0;c<a.teams.length;c++){var l=a.teams[c],h=_.getExtraPropAttr(l.hero.heroId);l.hero.extraAttr=cc.clone(h)}
return a},i.prototype.getRightData=function(n){var e={side:"right"},t=DonotDestroyManager.GameData.CityList[n.city_index].ChengName+"Thủ Quân";e.name=t,e.level=n.enemy_level,e.fightVal=0,e.formation=n.formation.formationId,e.forward=n.formation.forward,e.flip=n.formation.flip;for(var a=u.create(e),i=n.formation,r=[i.a,i.b,i.c,i.d,i.e,i.f,i.g,i.h,i.i,i.j],s=function(e){for(var t=Object.keys(n.formation),a=0;a<t.length;++a){if("fid"!=t[a]&&"formationId"!=t[a]&&"forward"!=t[a]&&"flip"!=t[a])
if(e==n.formation[t[a]])
return t[a]}},o=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a]},c=DonotDestroyManager.GameData.Common,l=0;l<r.length;++l){var h=r[l];if(!c.FIGHT_CONTROL_ENEMY[3]&&0!=h){var d=o(n.cards,h);if(null!=d){var _={hero:{}};_.hero.id=d.template_id,_.hero.heroId=d.template_id,_.hero.level=d.level,_.hero.grade=d.grade,_.unit_level=d.unitLevel,_.unit_grade=d.unitGrade,_.unit_num=m.getHeroUnitNum(_.hero.grade,_.hero.id),a.addHeroWithPosition(_,s(_.hero.id))}}}
return a},e.exports=new i,cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleUtil:"BattleUtil",GuozhanBufferMgr:"GuozhanBufferMgr",HeroBufferMgr:"HeroBufferMgr",HeroConfigMgr:"HeroConfigMgr",MyProtocols:"MyProtocols",PlayerBufferMgr:"PlayerBufferMgr",TeamDataUtil:"TeamDataUtil"}],GuozhanBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"f78cbBZ9zROgLGmpGPI9TZX","GuozhanBufferMgr");var n=e("EnermyBufferMgr"),_=["ID1","ID2","ID3","ID4","ID5"],r=["Ngụy","Thục","Ngô"],i=function(){this._netData=null,this._passCitySet=new Set};i.prototype.initNetData=function(e){if(this._netData=e,null!=this._netData.pass_city_index&&0<this._netData.pass_city_index.length)
for(var t=0;t<this._netData.pass_city_index.length;t++){var a=this._netData.pass_city_index[t];this._passCitySet.add(a)}},i.prototype.updateNetData=function(e){this._netData.my_nation=e.my_nation,this._netData.change_nation_cd=e.change_nation_cd,this._netData.my_office=e.my_office},i.prototype.isCityPass=function(e){return this._passCitySet.has(e)},i.prototype.isCityInBattle=function(e){for(var t=DonotDestroyManager.GameData.CityLianjie[e],a=0;a<_.length;a++){var n=t[_[a]];if(0<n&&this.isCityPass(n-1))
return!0}
return!1},i.prototype.passCity=function(e){this._netData.pass_city_index.push(e),this._passCitySet.add(e),this._netData.player_city_index=e},i.prototype.updateStayCityIndex=function(e){this._netData.player_city_index=e},i.prototype.getWay2City=function(e,t){if(e==t)
return[];var a=[],n=new Set;n.add(e);var i=[];for(i.push(e);0<i.length;)
for(var r=i.shift(),s=DonotDestroyManager.GameData.CityLianjie[r],o=0;o<_.length;o++){var c=s[_[o]],l=c-1;if(0<c&&!n.has(l)){if(a[l]=r,t==l){i.length=0;break}
this.isCityPass(l)&&(n.add(l),i.push(l))}}
for(var h=t,d=[];null!=h;)
d.push(h),h=a[h];return d.reverse()},i.prototype.dfs=function(e){this.dfs_search_times++,this.checkedCitys.add(e),this.search_path.push(e);for(var t=DonotDestroyManager.GameData.CityLianjie[e],a=0;a<_.length;a++){var n=t[_[a]],i=n-1;if(0<n&&!this.checkedCitys.has(i)){if(this.end_city_index==i)
return this.search_path.push(i),!0;if(this.isCityPass(i)&&this.dfs(i))
return!0}}
return this.search_path.pop(),!1},i.prototype.getInBattleCitys=function(){var e=[];if(0==this._netData.pass_city_index.length)
e.push(0);else
for(var t=0;t<this._netData.pass_city_index.length;t++)
for(var a=this._netData.pass_city_index[t],n=DonotDestroyManager.GameData.CityLianjie[a],i=0;i<_.length;i++){var r=n[_[i]];0<r&&!this.isCityPass(r-1)&&-1==e.indexOf(r-1)&&e.push(r-1)}
return e},i.prototype.setRightHero=function(e){n.getInstance().initEnermyData(e),this._enemyInfo=e},i.prototype.getRightHero=function(){return this._enemyInfo},i.prototype.hasWay2City=function(e){var t=!1;if(0==this._netData.pass_city_index.length&&e==this._netData.player_city_index)
return!0;for(var a=DonotDestroyManager.GameData.CityLianjie[e],n=0;n<_.length;n++){var i=a[_[n]];if(0<i&&this.isCityPass(i-1)){t=!0;break}}
return t},i.prototype.isPvePass=function(){return this._netData.pass_city_index.length>=DonotDestroyManager.GameData.CityList.length},i.prototype.getMyNation=function(){return this._netData.my_nation},i.prototype.updateMyNationId=function(e,t){this._netData.my_nation=e,this._netData.change_nation_cd=t},i.prototype.getChangeNationCd=function(){return this._netData.change_nation_cd},i.prototype.getOfficeIndex=function(){return this._netData.my_office},i.prototype.updateOfficeIndex=function(e){this._netData.my_office=e},i.prototype.targetOfficeIndex=function(){return this._enemy_data.office_index},i.prototype.setOfficeEnemyData=function(e){n.getInstance().initEnermyData(e),this._enemy_data=e},i.prototype.getOfficeEnemyData=function(){return this._enemy_data},i.prototype.updateR=function(e){this._r=e},i.prototype.setOfficePlayers=function(e){for(var t=e.player_list,a=[],n=0;n<t.length;n++){var i=t[n],r=i.office_index,s=parseInt(r/10);null==a[s]&&(a[s]=new Array),a[s].push(i)}
this._player_map=a},i.prototype.getOfficePlayer=function(e,t){var a=this._player_map[e];if(null!=a)
for(var n=0;n<a.length;n++){var i=a[n];if(t==i.office_index%10)
return i}
return null},i.prototype.getOfficeNameByIndex=function(e){if(-1==e||99==e||199==e||299==e)
return"";var t=parseInt(e/100),a=parseInt(e%100/10),n=DonotDestroyManager.GameData.GuoZhanOffice[a].title,i=n;return 0==a&&(i=r[t-1]+n.substring(1)),i="["+i+"]"},t.exports=new i,cc._RF.pop()},{EnermyBufferMgr:"EnermyBufferMgr"}],GuozhanCityBattleManager:[function(d,e,t){"use strict";cc._RF.push(e,"05d23QVOmBNM7z1vxQyocf8","GuozhanCityBattleManager");d("TeamDataUtil");var u=d("BattleDataManager"),s=d("BattleUtil"),m=d("HeroConfigMgr"),_=d("MyProtocols"),p=d("PlayerBufferMgr"),f=d("HeroBufferMgr"),g=d("BattleBufferMgr"),y=d("BattleManager"),v=d("GuozhanFightBufferMgr"),M=d("EnermyBufferMgr"),S=d("GameUtils"),a=function(){};a.prototype.init=function(e,t,a){var n=DonotDestroyManager.GameData.StageMobs;this.leftData=this.getLeftData(),this.rightData=this.getRightData(e),this.leftData.fightVal=t,this.rightData.fightVal=a,this.background=n[1505].battleground,this.mEmenyData=e},a.prototype.enterBattlefield=function(){var e=DonotDestroyManager.GameData.TeamSkillsAI,t={background:this.background,teamAiCfg:e[4],type:15},a=this;s.createBattlefield(this.leftData,this.rightData,t,function(){a.onSuccess()},function(){a.onFailure()}),s.enterRealScene()},a.prototype.resetBattlefield=function(e,t){var a=DonotDestroyManager.GameData.StageMobs;this.leftData=this.getLeftData(),this.rightData=this.getRightData(e),this.leftData.fightVal=t,this.background=a[1505].battleground,this.mEmenyData=e;var n=DonotDestroyManager.GameData.TeamSkillsAI,i={background:this.background,teamAiCfg:n[4],type:15},r=this;s.createBattlefield(this.leftData,this.rightData,i,function(){r.onSuccess()},function(){r.onFailure()})},a.prototype.onSuccess=function(){for(var e=v._enemyInfo.length,t=v._enemy_index,a=0,n=0,i=0;i<y.ourside.armies.length;++i){var r=y.ourside.armies[i];if(null!=r.hero){var s=0;n+=r.hero.basehp,"Dead"!=r.hero.getState()&&(s=r.hero.hp),a+=s}}
var o=parseInt(100*a/n);if(o<=0?o=20:o+=20,o=100<o?100:o,v.updateMyHpPercent(o),e-1<=t){var c=[o],l=v._r-MyPersistDataManager._playerData.id;_.send_C2SGuozhanCityCalculate(DonotDestroyManager._gameSocket,1,c,l)}else{v._enemy_index++,cc.Canvas.instance.node.destroyAllChildren(),y.resetData();var h=v._enemyInfo[v._enemy_index];M.getInstance().initEnermyData(h),this.resetBattlefield(h,this.leftData.fightVal),S.callInNextTick(function(){d("BattleSceneMgr").getInstance().restart(!0)})}},a.prototype.onFailure=function(){for(var e=v._r-MyPersistDataManager._playerData.id,t=0,a=0,n=0;n<y.otrside.armies.length;++n){var i=y.otrside.armies[n];if(null!=i.hero){var r=0;a+=i.hero.basehp,"Dead"!=i.hero.getState()&&(r=i.hero.hp),t+=r}}
var s=parseInt(100*t/a);s<=0?s=20:s+=20,s=100<s?100:s;for(var o=v._enemyInfo.length,c=v._enemy_index,l=new Array(o),h=0;h<o;h++)
l[h]=h<c?0:h==c?s:v._enemyInfo[h].base_info.hp_perc;_.send_C2SGuozhanCityCalculate(DonotDestroyManager._gameSocket,0,l,e)},a.prototype.calculateS2cCb=function(e){var t=d("BattleSceneMgr");if(0!=e.ret){var a=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/GuozhanPveWinPanel"]);cc.Canvas.instance.node.addChild(a);var n={info:e,enemy_name:"Chiếm 【"+DonotDestroyManager.GameData.CityList[e.city_index].ChengName+"】",cost_energy:-3};a.getComponent("GuozhanPveWinPanel").ChangeData(n),a.getComponent("GuozhanPveWinPanel").setStatistics(this.leftData,this.rightData,y.statistics)}else{var i=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(i);i.getComponent("BattleFailMgr").initUi(13,{cost_energy:3,staticData:y.statistics})}},a.prototype.getLeftData=function(){var e={side:"left"};e.name=p.getNickName(),e.level=p.getUserLevel();var t=g.getFormationData(2);e.formation=t.formationId,e.forward=t.forward,e.flip=t.flip;for(var a=u.create(e),n=Object.keys(t),i=0;i<n.length;++i){var r=n[i];if("fid"!=r&&"formationId"!=r&&"forward"!=r&&"flip"!=r&&"0"!=r){var s=t[r],o=f.getHeroByUid(s);if(o){var c=v.getMyHpPercent();o.hpPerc=c,delete o.atkPerc,a.addCardWithPosition(o,r)}}}
for(var l=0;l<a.teams.length;l++){var h=a.teams[l],d=f.getExtraPropAttr(h.hero.heroId);h.hero.extraAttr=cc.clone(d)}
return a},a.prototype.getRightData=function(n){var e={side:"right"};e.name=n.base_info.nickname+"("+(v._enemy_index+1)+"/"+v._enemyInfo.length+")",e.level=n.base_info.level,e.fightVal=n.base_info.fight,e.formation=n.formation.formationId,e.forward=n.formation.forward,e.flip=n.formation.flip;for(var t=u.create(e),a=n.formation,i=[a.a,a.b,a.c,a.d,a.e,a.f,a.g,a.h,a.i,a.j],r=function(e){for(var t=Object.keys(n.formation),a=0;a<t.length;++a){if("fid"!=t[a]&&"formationId"!=t[a]&&"forward"!=t[a]&&"flip"!=t[a])
if(e==n.formation[t[a]])
return t[a]}},s=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a]},o=DonotDestroyManager.GameData.Common,c=0;c<i.length;++c){var l=i[c];if(!o.FIGHT_CONTROL_ENEMY[3]&&0!=l){var h=s(n.cards,l);if(null!=h){var d={hero:{}};d.hero.id=h.template_id,d.hero.heroId=h.template_id,d.hero.level=h.level,d.hero.grade=h.grade,d.unit_level=h.unitLevel,d.unit_grade=h.unitGrade,d.unit_num=m.getHeroUnitNum(d.hero.grade,d.hero.id);var _=v.getEnemyHpPercent();d.hpPerc=_,t.addHeroWithPosition(d,r(d.hero.id))}}}
return t},e.exports=new a,cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleUtil:"BattleUtil",EnermyBufferMgr:"EnermyBufferMgr",GameUtils:"GameUtils",GuozhanFightBufferMgr:"GuozhanFightBufferMgr",HeroBufferMgr:"HeroBufferMgr",HeroConfigMgr:"HeroConfigMgr",MyProtocols:"MyProtocols",PlayerBufferMgr:"PlayerBufferMgr",TeamDataUtil:"TeamDataUtil"}],GuozhanFightBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"0bd94qzztNG1qu+5Fh8cT7S","GuozhanFightBufferMgr");var n=e("EnermyBufferMgr"),_=["ID1","ID2","ID3","ID4","ID5"],r=["Ngụy","Thục","Ngô"],i=[[7,137],[9,-60],[-192,37],[211,37],[-192,229],[-386,131],[-383,-65],[-189,-166],[205,229],[403,129],[411,-70],[214,-168]],s=function(){this._netData=null,this._passCitySet=new Set};s.prototype.initNetData=function(e){if(this._netData=e,null!=this._netData.pass_city_index&&0<this._netData.pass_city_index.length)
for(var t=0;t<this._netData.pass_city_index.length;t++){var a=this._netData.pass_city_index[t];this._passCitySet.add(a)}
this._do_move=!1},s.prototype.updateNetData=function(e){this._netData.city_list=e.city_list,this._netData.my_city_index=e.my_city_index,this._netData.move_step=e.move_step,this._netData.nation_city_count=e.nation_city_count,this._netData.hp_perc=e.hp_perc,this._netData.my_nation=e.my_nation,this._netData.change_nation_cd=e.change_nation_cd,this._netData.my_office=e.my_office},s.prototype.updateMoveStep=function(e){this._netData.move_step=e},s.prototype.getMyCityIndex=function(){return this._netData.my_city_index},s.prototype.getCityOwnNation=function(e){return this._netData.city_list[e].nation_id},s.prototype.isCityPass=function(e){return this._netData.city_list[e].nation_id==this._netData.my_nation},s.prototype.isCityInBattle=function(e){for(var t=DonotDestroyManager.GameData.CityLianjie[e],a=0;a<_.length;a++){var n=t[_[a]];if(0<n&&this.isCityPass(n-1))
return!0}
return!1},s.prototype.passCity=function(e){this._netData.pass_city_index.push(e),this._passCitySet.add(e),this._netData.player_city_index=e},s.prototype.updateStayCityIndex=function(e){this._netData.player_city_index=e},s.prototype.getWay2City=function(e,t){if(e==t)
return[];var a=[],n=new Set;n.add(e);var i=[];for(i.push(e);0<i.length;)
for(var r=i.shift(),s=DonotDestroyManager.GameData.CityLianjie[r],o=0;o<_.length;o++){var c=s[_[o]],l=c-1;if(0<c&&!n.has(l)){if(a[l]=r,t==l){i.length=0;break}
this.isCityPass(l)&&(n.add(l),i.push(l))}}
for(var h=t,d=[];null!=h;)
d.push(h),h=a[h];return d.reverse()},s.prototype.getCostSteps=function(e){var t=this._netData.my_city_index;if(t==e)
return 0;if(-1==t)
return-1;var a=[],n=new Set;n.add(t);var i=[],r=!1;for(i.push(t);0<i.length;)
for(var s=i.shift(),o=DonotDestroyManager.GameData.CityLianjie[s],c=0;c<_.length;c++){var l=o[_[c]],h=l-1;if(0<l&&!n.has(h)){if(a[h]=s,e==h){r=!(i.length=0);break}
this.isCityPass(h)&&(n.add(h),i.push(h))}}
var d=-1;return r&&(d=1),d},s.prototype.dfs=function(e){this.dfs_search_times++,this.checkedCitys.add(e),this.search_path.push(e);for(var t=DonotDestroyManager.GameData.CityLianjie[e],a=0;a<_.length;a++){var n=t[_[a]],i=n-1;if(0<n&&!this.checkedCitys.has(i)){if(this.end_city_index==i)
return this.search_path.push(i),!0;if(this.isCityPass(i)&&this.dfs(i))
return!0}}
return this.search_path.pop(),!1},s.prototype.getInBattleCitys=function(){for(var e=[],t=0;t<this._netData.city_list.length;t++)
if(!this.isCityPass(t))
for(var a=DonotDestroyManager.GameData.CityLianjie[t],n=0;n<_.length;n++){var i=a[_[n]];0<i&&this.isCityPass(i-1)&&-1==e.indexOf(t)&&e.push(t)}
return e},s.prototype.getCityInfo=function(e){return this._netData.city_list[e]},s.prototype.setRightHero=function(e){this._enemy_index=0,n.getInstance().initEnermyData(e[this._enemy_index]),this._enemyInfo=e},s.prototype.getRightHero=function(){return this._enemyInfo[this._enemy_index]},s.prototype.getMyHpPercent=function(){return this._netData.hp_perc},s.prototype.updateMyHpPercent=function(e){this._netData.hp_perc=e},s.prototype.getEnemyHpPercent=function(){return this._enemyInfo[this._enemy_index].base_info.hp_perc},s.prototype.hasWay2City=function(e){var t=!1;if(0==this._netData.pass_city_index.length&&e==this._netData.player_city_index)
return!0;for(var a=DonotDestroyManager.GameData.CityLianjie[e],n=0;n<_.length;n++){var i=a[_[n]];if(0<i&&this.isCityPass(i-1)){t=!0;break}}
return t},s.prototype.isPvePass=function(){return null!=this._netData},s.prototype.getMyNation=function(){return this._netData.my_nation},s.prototype.updateMyNationId=function(e,t){null!=this._netData&&(this._netData.my_nation=e,this._netData.change_nation_cd=t)},s.prototype.getChangeNationCd=function(){return this._netData.change_nation_cd},s.prototype.getOfficeIndex=function(){return this._netData.my_office},s.prototype.updateOfficeIndex=function(e){this._netData.my_office=e},s.prototype.updateR=function(e){this._r=e},s.prototype.setOfficePlayers=function(e){for(var t=e.player_list,a=[],n=0;n<t.length;n++){var i=t[n],r=i.office_index,s=parseInt(r/10);null==a[s]&&(a[s]=new Array),a[s].push(i)}
this._player_map=a},s.prototype.getOfficePlayer=function(e,t){var a=this._player_map[e];if(null!=a)
for(var n=0;n<a.length;n++){var i=a[n];if(t==i.office_index%10)
return i}
return null},s.prototype.getOfficeNameByIndex=function(e){if(-1==e||99==e||199==e||299==e)
return"";var t=parseInt(e/100),a=parseInt(e%100/10),n=DonotDestroyManager.GameData.GuoZhanOffice[a].title,i=n;return 0==a&&(i=r[t-1]+n.substring(1)),i="["+i+"]"},s.prototype.getCityPlayerPos=function(e){return i[e]},s.prototype.setTargetCityIndex=function(e){this._target_city_index=e,this._do_move=!0},s.prototype.isPlayerMoving=function(){return this._do_move},s.prototype.setDoMove=function(e){this._do_move=e},s.prototype.getTargetCityIndex=function(){return this._target_city_index},t.exports=new s,cc._RF.pop()},{EnermyBufferMgr:"EnermyBufferMgr"}],GuozhanOfficeBattleManager:[function(d,e,t){"use strict";cc._RF.push(e,"81e14L2vP1Fj7sWF9GkfFqm","GuozhanOfficeBattleManager");d("TeamDataUtil");var p=d("BattleDataManager"),n=d("BattleUtil"),f=d("HeroConfigMgr"),a=d("MyProtocols"),_=d("PlayerBufferMgr"),u=d("HeroBufferMgr"),m=d("BattleBufferMgr"),g=(d("PkBufferMgr"),d("BattleManager")),y=d("GuozhanBufferMgr"),v=d("GuoZhanConstants"),i=function(){};i.prototype.init=function(e,t,a){var n=DonotDestroyManager.GameData.StageMobs;this.leftData=this.getLeftData(),this.rightData=this.getRightData(e),this.leftData.fightVal=t,this.rightData.fightVal=a,this.background=n[610].battleground,this.mEmenyData=e},i.prototype.enterBattlefield=function(){var e=DonotDestroyManager.GameData.TeamSkillsAI,t={background:this.background,teamAiCfg:e[4],type:14},a=this;n.createBattlefield(this.leftData,this.rightData,t,function(){a.onSuccess()},function(){a.onFailure()}),n.enterRealScene()},i.prototype.onSuccess=function(){var e=y._r-MyPersistDataManager._playerData.id,t=y._enemy_data.office_index;a.send_C2SGuozhanOfficCalculate(DonotDestroyManager._gameSocket,t,1,e)},i.prototype.onFailure=function(){var e=y._r-MyPersistDataManager._playerData.id,t=y._enemy_data.office_index;a.send_C2SGuozhanOfficCalculate(DonotDestroyManager._gameSocket,t,0,e)},i.prototype.calculateS2cCb=function(e){var t=d("BattleSceneMgr");if(0!=e.ret){var a=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/GuozhanPveWinPanel"]);cc.Canvas.instance.node.addChild(a);var n=e.office_index,i=parseInt(n/10),r=n%10,s=DonotDestroyManager.GameData.GuoZhanOffice[i],o=s.positions[r],c={info:e,enemy_name:"【"+s.title+"】"+o,cost_energy:-DonotDestroyManager.GameData.Common.guozhan_pve_energy_cost[0]};a.getComponent("GuozhanPveWinPanel").ChangeData(c),a.getComponent("GuozhanPveWinPanel").setStatistics(this.leftData,this.rightData,g.statistics),y.setOfficePlayers(e),y.updateOfficeIndex(e.office_index)}else{var l=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(l);var h=DonotDestroyManager.GameData.Common.guozhan_pve_energy_cost[1];l.getComponent("BattleFailMgr").initUi(13,{cost_energy:h,staticData:g.statistics})}},i.prototype.getLeftData=function(){var e={side:"left"};e.name=_.getNickName(),e.level=_.getUserLevel();var t=m.getFormationData(2);e.formation=t.formationId,e.forward=t.forward,e.flip=t.flip;for(var a=p.create(e),n=Object.keys(t),i=0;i<n.length;++i){var r=n[i];if("fid"!=r&&"formationId"!=r&&"forward"!=r&&"flip"!=r&&"0"!=r){var s=t[r],o=u.getHeroByUid(s);o&&(delete o.hpPerc,delete o.atkPerc,a.addCardWithPosition(o,r))}}
for(var c=0;c<a.teams.length;c++){var l=a.teams[c],h=u.getExtraPropAttr(l.hero.heroId);l.hero.extraAttr=cc.clone(h)}
return a},i.prototype.getRightData=function(n){var e={side:"right"},t=y.getMyNation(),a=v.NATION_LIST[t-1];e.name=null!=n.base_info?n.base_info.nickname:a+" Quốc Vệ Binh";var i=parseInt(n.office_index/10);e.level=null!=n.base_info?n.base_info.level:2*(10-i)+30,e.formation=n.formation.formationId,e.forward=n.formation.forward,e.flip=n.formation.flip;for(var r=p.create(e),s=n.formation,o=[s.a,s.b,s.c,s.d,s.e,s.f,s.g,s.h,s.i,s.j],c=function(e){for(var t=Object.keys(n.formation),a=0;a<t.length;++a){if("fid"!=t[a]&&"formationId"!=t[a]&&"forward"!=t[a]&&"flip"!=t[a])
if(e==n.formation[t[a]])
return t[a]}},l=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a]},h=DonotDestroyManager.GameData.Common,d=0;d<o.length;++d){var _=o[d];if(!h.FIGHT_CONTROL_ENEMY[3]&&0!=_){var u=l(n.cards,_);if(null!=u){var m={hero:{}};m.hero.id=u.template_id,m.hero.heroId=u.template_id,m.hero.level=u.level,m.hero.grade=u.grade,m.unit_level=u.unitLevel,m.unit_grade=u.unitGrade,m.unit_num=f.getHeroUnitNum(m.hero.grade,m.hero.id),r.addHeroWithPosition(m,c(m.hero.id))}}}
return r},e.exports=new i,cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleUtil:"BattleUtil",GuoZhanConstants:"GuoZhanConstants",GuozhanBufferMgr:"GuozhanBufferMgr",HeroBufferMgr:"HeroBufferMgr",HeroConfigMgr:"HeroConfigMgr",MyProtocols:"MyProtocols",PkBufferMgr:"PkBufferMgr",PlayerBufferMgr:"PlayerBufferMgr",TeamDataUtil:"TeamDataUtil"}],GuozhanPveWinPanel:[function(e,t,a){"use strict";cc._RF.push(t,"263ce/kyOFKArdxnNaTP8J9","GuozhanPveWinPanel");e("GameUtils");var n=e("SoundUtil"),i=(e("GuideBufferMgr"),e("MarqueeBufferMgr"));e("MineConstants");cc.Class({extends:cc.Component,properties:{m_pwinpre:cc.Prefab,node_uiAll:cc.Node,_recvdata:null,m_pRewardContent:cc.Node,m_pItemBoxPrefab:cc.Prefab,lab_city_name:cc.Label,lab_cost_energy:cc.Label,_iscanclick:!1},onLoad:function(){},ChangeData:function(e){this._recvdata=e.info,this.Init(),this.lab_city_name.string=e.enemy_name,this.lab_cost_energy.string=e.cost_energy},Init:function(){this.InitData(),this.CreateWinarmature()},InitData:function(){this._iscanclick=!1,this.node_uiAll.active=!1;for(var e=0;e<this._recvdata.rewards.length;++e){var t=cc.instantiate(this.m_pItemBoxPrefab);t.getComponent("ItemBox").ChangeItemInfo(this._recvdata.rewards[e].itemId,this._recvdata.rewards[e].cnt,!0,null,!0),this.m_pRewardContent.addChild(t)}},CreateWinarmature:function(){var t=this,e=cc.instantiate(this.m_pwinpre);this.node.addChild(e),e.setPosition(0,-50);var a=e.getComponent(sp.Skeleton);a.setAnimation(0,"action2",!1),a.setCompleteListener(function(e){t.showResultUi()})},showResultUi:function(){cc.log(" truyền phát tin thưởng cho động họa "),this._iscanclick=!0,this.node_uiAll.active=!0},Mask_OnClickHandler:function(e){this._iscanclick&&(n.playBtnCloseEffect(),MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),i.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome")},setStatistics:function(e,t,a){this.statistics={left:e,right:t,data:a};var n={damage:-1};a.teams.forEach(function(e,t){e.damage>n.damage&&"left"==e.data.hero.side&&(n=e)})},BattleDetail_onClickHandler:function(){var n=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/BattleDetailLayer/BattleDetailLayer",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.node)){null!=n._shortMask_node&&(n._shortMask_node.destroy(),n._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("BattleDetailLayer").ChangeData(n.statistics.data)}})}}),cc._RF.pop()},{GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",MarqueeBufferMgr:"MarqueeBufferMgr",MineConstants:"MineConstants",SoundUtil:"SoundUtil"}],HammerAnimationCtrl:[function(e,t,a){"use strict";cc._RF.push(t,"b0f10EoLuxJkpjjq9PhzT/C","HammerAnimationCtrl");var n=e("SoundUtil"),i=(e("ColorUtil"),e("MyEventDispatcher")),r=e("MyUIEvent"),s=e("i18n");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},knockEnd:function(e,t){n.playGainGoodsEffect(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),s.t("rune002")),i.dispatchEvent(r.onAniHammerFinish)},onDestroy:function(){},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],HeadFrameColumnWidget:[function(l,e,t){"use strict";cc._RF.push(e,"012126E42VMzLlWNkAZWSGk","HeadFrameColumnWidget");var c=l("MyEventDispatcher"),h=l("MyUIEvent"),d=l("SoundUtil");cc.Class({extends:cc.Component,properties:{spr_head_frame:cc.Sprite,lab_vip:cc.Label,node_vip_level:cc.Node,node_frag_count:cc.Node,node_frag_progress:cc.Node,lab_frag_percent:cc.Label,lab_desc:cc.Label,node_selected:cc.Node,_myIndex:0},onLoad:function(){},updateItem:function(e){this._myIndex=e;var t=DonotDestroyManager.GameData.HeadFrame[e];this.lab_desc.string=t.desc;var a=this;if(cc.loader.loadRes("UI/HeadFrame/"+t.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=a&&cc.isValid(a.node)&&(a.spr_head_frame.spriteFrame=t)}),0<t.vip?(this.node_vip_level.active=!0,this.lab_vip.string=t.vip):this.node_vip_level.active=!1,0<t.fragment.length){this.node_frag_count.active=!0;for(var n=l("ChangeHeadFrameLayer"),i=t.fragment[0],r=t.fragment[1],s=0,o=0;o<n.instance._netData.frags_count.length;o+=2)
i==n.instance._netData.frags_count[o]&&(s=n.instance._netData.frags_count[o+1]);this.lab_frag_percent.string=s+"/"+r,this.lab_frag_percent.node.color=s<r?cc.Color.RED:cc.Color.GREEN;var c=s/r;c=1<c?1:c,this.node_frag_progress.scaleX=c}else
this.node_frag_count.active=!1;return t.id==MyPersistDataManager._playerData.head_frame?this.node:null},start:function(){},setSelected:function(e){this.node_selected.active=!!e},click_handler:function(e,t){d.playBtnOpenEffect();var a=DonotDestroyManager.GameData.HeadFrame[this._myIndex];if(0<a.vip&&MyPersistDataManager._playerData.vip_level<a.vip)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không đủ lv VIP,xin tăng cấp VIP!");else{if(0<a.fragment.length){for(var n=l("ChangeHeadFrameLayer"),i=a.fragment[0],r=a.fragment[1],s=!1,o=0;o<n.instance._netData.frags_count.length;o+=2)
i==n.instance._netData.frags_count[o]&&n.instance._netData.frags_count[o+1]>=r&&(s=!0);if(!s)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không đủ mảnh,xin thu thập "+r+" mảnh rồi thử lại!")}
this.setSelected(!0),c.dispatchEvent(h.onHeadFrameSelect,this.node)}}}),cc._RF.pop()},{ChangeHeadFrameLayer:"ChangeHeadFrameLayer",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],HeadRowContainer:[function(o,e,t){"use strict";cc._RF.push(e,"efd3aQ4io5GIZlVFeSWhfr3","HeadRowContainer"),cc.Class({extends:cc.Component,properties:{pre_head1:cc.Prefab},onLoad:function(){},updateItem:function(e){for(var t=o("ChangeIconLayer"),a=null,n=0;n<5;n++){var i=n+5*e;if(i>=2+t.instance.myCards.length)
break;var r=cc.instantiate(this.pre_head1);if(i<2)
r.getComponent("HeroIconNameWidget").initData(i,i,!1),MyPersistDataManager._playerData.icon==i+1?(a=r).getComponent("HeroIconNameWidget").setSelected(!0):r.getComponent("HeroIconNameWidget").setSelected(!1);else{var s=t.instance.myCards[i-2];r.getComponent("HeroIconNameWidget").initData(i,s.template_id,!0),MyPersistDataManager._playerData.icon-10==s.template_id?(a=r).getComponent("HeroIconNameWidget").setSelected(!0):r.getComponent("HeroIconNameWidget").setSelected(!1)}
r.x=73+125*n,this.node.addChild(r)}
return a},start:function(){}}),cc._RF.pop()},{ChangeIconLayer:"ChangeIconLayer"}],HelloWorld:[function(e,t,a){"use strict";cc._RF.push(t,"280c3rsZJJKnZ9RqbALVwtK","HelloWorld");var n=function(){this.num=0};n.prototype.addNum=function(){this.num++},n.prototype.getNum=function(){return this.num},t.exports=new n,cc._RF.pop()},{}],HeroAddonWidget:[function(e,t,a){"use strict";cc._RF.push(t,"b47fcbhJ3dCL5UnN5Viwj/j","HeroAddonWidget");var n=e("SoundUtil"),h=e("HeroBufferMgr"),o=e("AdditionCfgMgr");cc.Class({extends:cc.Component,properties:{m_pYuanfenNode:cc.Node,m_pLabatlas:cc.Font},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back()},setParams:function(e){this._hero_id=e.hero_id},addfate:function(){for(var e=DonotDestroyManager.GameData.Cards[this._hero_id],t=-45,a=0;a<5;++a){var n="addition_"+(a+1),i=o.getAdditionById(e.additions[n]);if(i){var r=this.CreateLabel(i.name,24);this.m_pYuanfenNode.addChild(r.node),r.node.setAnchorPoint(0,1),r.node.setPosition(-245,t),r.node.width=96,r.node.color=cc.color(255,216,0);var s=this.CreateRichText(this.GetDes(i.des,i.tri_coef),24);this.m_pYuanfenNode.addChild(s.node),s.node.setPosition(-90,t),s.node.setAnchorPoint(0,1),s.maxWidth=375,t-=s.node.height+20}}
this.m_pYuanfenNode.height=Math.abs(t)},GetDes:function(e,t){for(var a="<color=#ffffff>",n=[],i=0;i<t.length;++i){var r=t[i];if(0<r&&r<500){var s=DonotDestroyManager.GameData.Cards[this._hero_id];r==this._hero_id||r==s.root_id?n[i]=!0:n[i]=h.isHasHeroByTidAndExtends(r)}else
n[i]=!1}
for(var o=0,c=0,l="";o<e.length;)"L"==e[o]?(n[c]?a+="<color=#ffff00>":a+="<color=#5B6767>",l="</c>",++o,++c):(a+=e[o],""!=l&&(a+="</c>",l=""),++o);return a},CreateLabel:function(e,t){var a=(new cc.Node).addComponent(cc.Label);return a.font=this.m_pLabatlas,a.fontSize=t,a.lineHeight=t+4,a.string=e,a},CreateRichText:function(e,t){var a=(new cc.Node).addComponent(cc.RichText);return a.font=this.m_pLabatlas,a.fontSize=t,a.lineHeight=t+4,a.string=e,a},start:function(){this.addfate()}}),cc._RF.pop()},{AdditionCfgMgr:"AdditionCfgMgr",HeroBufferMgr:"HeroBufferMgr",SoundUtil:"SoundUtil"}],HeroAttributePanel:[function(e,t,a){"use strict";cc._RF.push(t,"cdd95DfEwxJso2r7OyTKIXC","HeroAttributePanel");var d=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_=e("HeroBufferMgr"),n=e("CardLevelsMgr"),o=e("ColorUtil"),c=e("AdditionCfgMgr"),s=e("TalentsCfgMgr"),u=e("i18n"),i=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pFight:cc.Label,m_pDes:cc.Label,m_PLevel:cc.Label,m_pName:cc.Label,m_pEXPbar:cc.Sprite,m_pGroup:cc.Sprite,m_pSoldierType:cc.Sprite,m_pQuality:cc.Sprite,m_pAttrparent:cc.Node,m_pSkillNode:cc.Node,m_pYuanfenNode:cc.Node,m_pTianfuNode:cc.Node,m_pLabatlas:cc.Font,m_pSoldierTypeList:[cc.SpriteFrame],m_pGroupList:[cc.SpriteFrame],m_pBanerList:[cc.SpriteFrame],_herobuffer:null},onLoad:function(){},setParams:function(e){this._herobuffer=e.herobuffer,this.Init()},Init:function(){this.addHeroAttr(),this.m_pName.string=this._herobuffer.heroCfg.name,this.m_PLevel.string="LV."+this._herobuffer.level,this.m_pFight.string=_.getHeroFightVal(this._herobuffer.template_id),this.m_pDes.string=this._herobuffer.heroCfg.des;var e=n.getLevelCfg(this._herobuffer.heroCfg.potential,this._herobuffer.level+1);this.m_pEXPbar.node.scaleX=this._herobuffer.exp/e[0],this.m_pGroup.spriteFrame=this.m_pGroupList[this._herobuffer.heroCfg.group-1],this.m_pSoldierType.spriteFrame=this.m_pSoldierTypeList[this._herobuffer.heroCfg.unit_type-1],this.m_pQuality.spriteFrame=this.m_pBanerList[this._herobuffer.heroCfg.quality],this.addSkill(),this.addfate(),this.addtalents()},addSkill:function(){for(var e=DonotDestroyManager.GameData.Skills,t=this._herobuffer.heroCfg,a=-45,n=0;n<t.skills.length;++n)
if(null!=e[t.skills[n][0]]){var i=this.CreateLabel(e[t.skills[n][0]].name,24);if(this.m_pSkillNode.addChild(i.node),i.node.setAnchorPoint(0,1),i.node.setPosition(-245,a),1==n&&3<=t.quality&&this._herobuffer.grade<3){var r=o.getColorByQuality(e[t.skills[n][0]].quality);i.node.color=cc.color(Math.round(91*r.getR()/255),Math.round(103*r.getG()/255),Math.round(103*r.getB()/255))}else
i.node.color=o.getColorByQuality(e[t.skills[n][0]].quality);var s=this.CreateLabel(e[t.skills[n][0]].des,24);this.m_pSkillNode.addChild(s.node),s.node.setAnchorPoint(0,1),s.node.setPosition(-90,a),s.overflow=cc.Label.Overflow.RESIZE_HEIGHT,s.node.width=375,a-=s.node.height+20}
this.m_pSkillNode.height=Math.abs(a)},addtalents:function(){var e=this._herobuffer.heroCfg.talents;if(0<e.length){for(var t=-45,a=0;a<e.length;++a){var n=s.getTalentCfg(e[a]);if(n){var i=this.CreateLabel(n.name,24);this.m_pTianfuNode.addChild(i.node),i.node.setAnchorPoint(0,1),i.node.setPosition(-245,t);var r=this.CreateRichText(n.des,24);this.m_pTianfuNode.addChild(r.node),r.node.setAnchorPoint(0,1),r.node.setPosition(-90,t),r.maxWidth=375,t-=r.node.height+20,this._herobuffer.grade>a?i.node.color=cc.Color.YELLOW:(i.node.color=cc.Color.GRAY,r.string+=u.t("detail_009",{value:a+1}))}}
this.m_pTianfuNode.height=Math.abs(t)}else
this.m_pTianfuNode.active=!1},addfate:function(){for(var e=this._herobuffer.heroCfg,t=-45,a=0;a<5;++a){var n="addition_"+(a+1),i=c.getAdditionById(e.additions[n]);if(i){var r=this.CreateLabel(i.name,24);this.m_pYuanfenNode.addChild(r.node),r.node.setAnchorPoint(0,1),r.node.setPosition(-245,t),r.node.width=96,this._herobuffer[n]?r.node.color=cc.color(255,216,0):r.node.color=cc.color(86,86,86);var s=this.CreateRichText(this.GetDes(i.des,this._herobuffer[n],i.tri_coef),24);this.m_pYuanfenNode.addChild(s.node),s.node.setPosition(-90,t),s.node.setAnchorPoint(0,1),s.maxWidth=375,t-=s.node.height+20}}
this.m_pYuanfenNode.height=Math.abs(t)},GetDes:function(e,t,a){for(var n="<color=#ffffff>",i=[],r=0;r<a.length;++r)
t?i[r]=!0:0<a[r]&&a[r]<500?i[r]=_.isHasHeroByTidAndExtends(a[r]):i[r]=_.isEquipOnHero(a[r],this._herobuffer);for(var s=0,o=0,c="";s<e.length;)"L"==e[s]?(i[o]?n+="<color=#ffff00>":n+="<color=#5B6767>",c="</c>",++s,++o):(n+=e[s],""!=c&&(n+="</c>",c=""),++s);return n},addHeroAttr:function(){for(var e=_.getHeroPropAttr(this._herobuffer.template_id),t=d(e,3),a=t[0],n=t[1],i=t[2],r=_.getExtraPropAttr(this._herobuffer.template_id),s=this._herobuffer.heroCfg,o=[[u.t("detail_010"),s.str,u.t("sh_010"),n],[u.t("detail_011"),s.int,u.t("sh_011"),i],[u.t("detail_012"),s.co,u.t("detail_013"),a]],c=[[u.t("detail_014"),r.max_dmg,u.t("detail_015"),r.min_dmg],[u.t("detail_016"),r.crit_coef,u.t("detail_017"),r.dmg_get_static],[u.t("detail_018"),r.crit_rate,u.t("detail_019"),r.dodge],[u.t("detail_020"),r.dmg_deal_static,u.t("detail_021"),r.hit_rate]],l=0,h=0;h<o.length;++h)
this.loadAttrItem(o[h],l,cc.Color.WHITE),l-=30;for(h=0;h<c.length;++h)
this.loadAttrItem(c[h],l,cc.color(34,205,254)),l-=30},loadAttrItem:function(e,t,a){var n=this.CreateLabel(e[0],24);this.m_pAttrparent.addChild(n.node),n.node.setAnchorPoint(0,.5),n.node.setPosition(-210,t),n.node.color=a;var i=this.CreateLabel(e[1]||0,24);this.m_pAttrparent.addChild(i.node),i.node.setAnchorPoint(0,.5),i.node.setPosition(-110,t),i.node.color=a;var r=this.CreateLabel(e[2],24);this.m_pAttrparent.addChild(r.node),r.node.setAnchorPoint(0,.5),r.node.setPosition(-10,t),r.node.color=a;var s=this.CreateLabel(e[3]||0,24);this.m_pAttrparent.addChild(s.node),s.node.setAnchorPoint(0,.5),s.node.setPosition(90,t),s.node.color=a},CreateLabel:function(e,t){var a=(new cc.Node).addComponent(cc.Label);return a.font=this.m_pLabatlas,a.fontSize=t,a.lineHeight=t+4,a.string=e,a},CreateRichText:function(e,t){var a=(new cc.Node).addComponent(cc.RichText);return a.font=this.m_pLabatlas,a.fontSize=t,a.lineHeight=t+4,a.string=e,a},Back_onclickHandler:function(e){i.playBtnCloseEffect(),MyUiManager.Back()}}),cc._RF.pop()},{AdditionCfgMgr:"AdditionCfgMgr",CardLevelsMgr:"CardLevelsMgr",ColorUtil:"ColorUtil",HeroBufferMgr:"HeroBufferMgr",SoundUtil:"SoundUtil",TalentsCfgMgr:"TalentsCfgMgr",i18n:"i18n"}],HeroBaseNode:[function(e,t,a){"use strict";cc._RF.push(t,"c6846OP+wBFG7hPwfoGNZ7P","HeroBaseNode");e("ColorUtil"),e("RecruitManager");var n=e("GetTenHeroPanel");cc.Class({extends:cc.Component,properties:{baseNode:cc.Node,lightOut_node:cc.Node,purpleLight_node:cc.Node,herotemp_node:cc.Node,uniteType_sprite:cc.Sprite,nameFrame_sprite:cc.Sprite,groupFrame_sprite:cc.Sprite,name_label:cc.Label,heroNode:cc.Node,roleComing:cc.Node,_herojsoninfo:null,_heroitem:null},onLoad:function(){},setHeroLabel:function(e){this._herojsoninfo=DonotDestroyManager.GameData.Cards[e],this.uniteType_sprite.spriteFrame=n.getInstance().unitTypeList[this._herojsoninfo.unit_type-1],this.groupFrame_sprite.spriteFrame=n.getInstance().groupList[this._herojsoninfo.group-1],this.nameFrame_sprite.spriteFrame=n.getInstance().nameFrameList[this._herojsoninfo.quality],this.name_label.string=this._herojsoninfo.name,this.heroComeIn()},heroComeIn:function(){this.lightOut_node.active=!0;var e=n.getInstance()._raw_assets.get("Prefab/Heros/"+this._herojsoninfo.icon);3!=this._herojsoninfo.quality&&(this._heroitem=cc.instantiate(e),this.heroNode.addChild(this._heroitem),this._heroitem.setPosition(0,0),this._heroitem.getComponent(sp.Skeleton).setAnimation(0,"stand",!0),this.herotemp_node.active=!1,n.getInstance()._itemList.push(this._heroitem)),this.groupFrame_sprite.node.parent.active=!0,this.groupFrame_sprite.node.parent.opacity=0,this.groupFrame_sprite.node.parent.runAction(cc.fadeIn(.3)),this.name_label.node.active=!0,this.name_label.node.opacity=0,this.name_label.node.runAction(cc.fadeIn(.3))}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GetTenHeroPanel:"GetTenHeroPanel",RecruitManager:"RecruitManager"}],HeroBoxSelect:[function(c,e,t){"use strict";cc._RF.push(e,"eec8bcwppFJtI9mOHNh806b","HeroBoxSelect");var l=c("ItemsConfigMgr"),s=c("SoundUtil"),a=c("MyEventDispatcher"),n=c("MyUIEvent"),i=c("NetEvent"),o=c("MyProtocols"),h=c("SecretBufferMgr");cc.Class({extends:cc.Component,properties:{lab_level:cc.Label,lab_star_num:cc.Label,lab_name:cc.Label,spr_border:cc.Sprite,spr_hero_icon:cc.Sprite,node_cannot_select:cc.Node,node_is_selected:cc.Node,node_hp_percent:cc.Node,node_btn_add:cc.Node,res_border_sprite:[cc.SpriteFrame],_hero_tpl_id:0,_mob_id:0,_is_formation:!1},onLoad:function(){this._hp_val=1e3,this.onHeroBoxUnSelect_cb_func=this.onHeroBoxUnSelect_cb.bind(this),a.addListener(n.onHeroBoxUnSelect,this.onHeroBoxUnSelect_cb_func),this.S2CSecretSoldierRevive_cb_func=this.S2CSecretSoldierRevive_cb.bind(this),a.addListener(i.S2CSecretSoldierRevive,this.S2CSecretSoldierRevive_cb_func)},onDestroy:function(){a.removeListener(n.onHeroBoxUnSelect,this.onHeroBoxUnSelect_cb_func),a.removeListener(i.S2CSecretSoldierRevive,this.S2CSecretSoldierRevive_cb_func)},S2CSecretSoldierRevive_cb:function(e){var t=e.hero_id;this._mob_id==t&&(this.node_hp_percent.width=93,this.node_cannot_select.active=!1,this.node_btn_add.active=!1)},onHeroBoxUnSelect_cb:function(e){this._mob_id==e&&this.setSelect(!1)},start:function(){},setSelect:function(e){null!=this.node&&(this.node_is_selected.active=!!e)},ChangeHeroInfo:function(e,t,a,n){this._is_formation=!1,this._mob_id=e,this._hero_tpl_id=t;var i=l.processItemCfg(t);this.spr_border.spriteFrame=this.res_border_sprite[i.quality],this.lab_level.string=a,this.lab_star_num.string=n,this.lab_name.string=i.name;var r="UI/Heros/"+i.icon.replace(".png",""),s=this;cc.loader.loadRes(r,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=s&&cc.isValid(s.node)&&(s.spr_hero_icon.spriteFrame=t)});var o=h.getMyHpPercent(this._mob_id);0==o?(this.node_cannot_select.active=!0,this.node_hp_percent.width=0):(this.node_cannot_select.active=!1,this.node_hp_percent.width=parseInt(93*o/1e3)),this.node_btn_add.active=o<1e3,c("SecretPointPanel").Instance.isOnlineFormation(e)?this.setSelect(!0):this.setSelect(!1)},ChangeHeroInfoFormation:function(e,t,a,n){this._is_formation=!0,this._mob_id=e,this._hero_tpl_id=t;var i=l.processItemCfg(t);this.spr_border.spriteFrame=this.res_border_sprite[i.quality],this.lab_level.string=a,this.lab_star_num.string=n,this.lab_name.string=i.name;var r="UI/Heros/"+i.icon.replace(".png",""),s=this;cc.loader.loadRes(r,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=s&&cc.isValid(s.node)&&(s.spr_hero_icon.spriteFrame=t)});var o=h.getMyHpPercent(this._mob_id);0==o?(this.node_cannot_select.active=!0,this.node_hp_percent.width=0):(this.node_cannot_select.active=!1,this.node_hp_percent.width=parseInt(93*o/1e3)),this.node_btn_add.active=o<1e3},clickHanlder:function(e,t){s.playBtnOpenEffect(),1!=this.node_cannot_select.active&&(this._is_formation?a.dispatchEvent(n.onHeroBoxUnSelect,this._mob_id):a.dispatchEvent(n.onHeroBoxSelect,this))},clickHanlderAddHp:function(e,t){s.playBtnOpenEffect();var a=h.getReviveCount(),n=DonotDestroyManager.GameData.Common.secret_soldier_revive,i=0;i=a>=n.length?n[n.length-1]:n[a];var r=this;this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent("Có tiêu "+i+" Vàng hồi phục full HP?",function(){r._alert_layer.destroy(),r._alert_layer=null,o.send_C2SSecretSoldierRevive(DonotDestroyManager._gameSocket,r._mob_id)})}}),cc._RF.pop()},{ItemsConfigMgr:"ItemsConfigMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SecretBufferMgr:"SecretBufferMgr",SecretPointPanel:"SecretPointPanel",SoundUtil:"SoundUtil"}],HeroBoxSimple:[function(e,t,a){"use strict";cc._RF.push(t,"bc2577537xC0JKQLQxsdRzU","HeroBoxSimple");var i=e("ItemsConfigMgr"),n=e("SoundUtil"),r=e("MyEventDispatcher"),s=e("MyUIEvent");e("NetEvent"),e("MyProtocols"),e("SecretBufferMgr");cc.Class({extends:cc.Component,properties:{lab_name:cc.Label,lab_potential:cc.Label,spr_border:cc.Sprite,spr_hero_icon:cc.Sprite,res_border_sprite:[cc.SpriteFrame],_hero_tpl_id:0,_mob_id:0,_is_formation:!1},onLoad:function(){},onDestroy:function(){},start:function(){},ChangeHeroInfo:function(e){this._hero_tpl_id=e;var t=i.processItemCfg(e);this.lab_potential.string=t.potential,this.spr_border.spriteFrame=this.res_border_sprite[t.quality],this.lab_name.string=t.name;var a="UI/Heros/"+t.icon.replace(".png",""),n=this;cc.loader.loadRes(a,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.node)&&(n.spr_hero_icon.spriteFrame=t)})},clickHanlder:function(e,t){n.playBtnOpenEffect(),r.dispatchEvent(s.onJumpHeroShow),MyUiManager.Open(MyUiManager.PanelInfo.HeroShowPanel,{card_tpl_id:this._hero_tpl_id})}}),cc._RF.pop()},{ItemsConfigMgr:"ItemsConfigMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SecretBufferMgr:"SecretBufferMgr",SoundUtil:"SoundUtil"}],HeroBox:[function(e,t,a){"use strict";cc._RF.push(t,"be6d6ilJhFMfaZs0Xv3wryM","HeroBox");var s=e("ItemsConfigMgr");cc.Class({extends:cc.Component,properties:{lab_level:cc.Label,lab_star_num:cc.Label,lab_name:cc.Label,spr_border:cc.Sprite,spr_hero_icon:cc.Sprite,res_border_sprite:[cc.SpriteFrame]},start:function(){},ChangeHeroInfo:function(e,t,a){var n=s.processItemCfg(e);this.spr_border.spriteFrame=this.res_border_sprite[n.quality],this.lab_level.string=t,this.lab_star_num.string=a,this.lab_name.string=n.name;var i="UI/Heros/"+n.icon.replace(".png",""),r=this;cc.loader.loadRes(i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r&&cc.isValid(r.node)&&(r.spr_hero_icon.spriteFrame=t)})}}),cc._RF.pop()},{ItemsConfigMgr:"ItemsConfigMgr"}],HeroBufferMgr:[function(o,e,t){"use strict";cc._RF.push(e,"27de1yOSpxIYrqiau+m4WBg","HeroBufferMgr");var V=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},h=o("AdditionCfgMgr"),I=o("TalentsCfgMgr"),f=o("EquipCfgMgr"),b=o("EquipBufferMgr"),P=o("TreasureBufferMgr"),g=o("TiersCfgMgr"),l=o("CardLevelsMgr"),c=o("RunesBufferMgr"),d=o("HeroConfigMgr"),a=function(){this.resetData()},m=[260,520,780,1040];a.prototype.resetData=function(){this.is_init=!1},a.prototype.initHeroList=function(e){if(cc.log("HeroBufferMgr.initHeroList!"),!this.is_init){this.is_init=!0;for(var t=0;t<e.length;t++){var a=e[t];a.heroCfg=DonotDestroyManager.GameData.Cards[a.template_id];for(var n=0;n<4;n++)
if("0"!=a.equips[n]){var i=a.equips[n];this.bindHeroEquipUid(a),b.bindHeroForEquip(i,a.template_id)}
a.unit_num=this.getHeroUnitNum(a)}
this.updateHeroAddition()}},a.prototype.init1Hero=function(e){cc.log("HeroBufferMgr.init1Hero!"),e.heroCfg=DonotDestroyManager.GameData.Cards[e.template_id],e.unit_num=this.getHeroUnitNum(e),this.updateHeroAddition()},a.prototype.updateHeroUnitNum=function(e){e.unit_num=this.getHeroUnitNum(e)},a.prototype.getHeroUnitNum=function(e){for(var t=I.getEffectVal(e.heroCfg.talents,e.grade,3),a=I.processUnitNumVal(t),n=0,i=0;i<4;i++)
if("0"!=e.equips[i]){var r=b.getEquipByUid(e.equips[i]);if(r){var s=r.unitAttr.id,o=r.unitAttr.num;3==r.unitAddState&&4==s&&(n+=o)}}
for(var c=0,l=0;l<e.runePutup.length;l++){var h=e.runePutup[l],d=e.runeLevel[l];if(0<h){var _=DonotDestroyManager.GameData.Runes[h],u=1;0<d&&(u=1+DonotDestroyManager.GameData.RuneLevel[_.quality].add_on[d-1]/100),null!=_.unit_num&&0<_.unit_num&&(c+=parseInt(_.unit_num*u))}}
return a+n+c},a.prototype.getHeroByUid=function(e){return MyPersistDataManager._playerData.cardsMaplist[e]},a.prototype.getHeroFightVal=function(e){var t=this.getHeroByUid(e);return this.getHeroFightValByHero(t)},a.prototype.getHeroFightValByHero=function(e){return this.getHeroScore(e)+this.getUnitScore(e)},a.prototype.getHeroScore=function(e){for(var t=this.getHeroPropByHero(e),a=V(t,3),n=a[0],i=a[1],r=a[2],s=Math.floor(.05*n+i+r),o=0,c=0;c<e.runePutup.length;c++){var l=e.runePutup[c],h=e.runeLevel[c];if(0<l){var d=DonotDestroyManager.GameData.Runes[l];if("1"==d.addon_type||"2"==d.addon_type||"3"==d.addon_type)
continue;var _=1;0<h&&(_=1+DonotDestroyManager.GameData.RuneLevel[d.quality].add_on[h-1]/100);var u=m[d.quality]*_;"2-10"!=d.addon_type&&"3-5"!=d.addon_type&&"1-11"!=d.addon_type||(u/=2),o+=u}}
return s+parseInt(o)},a.prototype.getUnitScore=function(e){var t=o("UnitBufferMgr").getUnitPropAttr(e),a=V(t,3),n=a[0],i=a[1],r=a[2],s=Math.floor(.05*n+i+r);return Math.floor(s*e.unit_num/20)},a.prototype.getHeroPropAttr=function(e,t,a,n){var i=this.getHeroByUid(e);return cc.assert(i,"Hero[%s] is not found.",e),this.getHeroPropByHero(i,t,a,n)},a.prototype.getExtraPropAttr=function(e){var t={},a=this.getHeroByUid(e);if(null==a)
return t;for(var n=0;n<4;n++)
if("0"!=a.equips[n]){var i=a.equips[n],r=b.getExtraPropAttr(i);for(var s in r){var o=r[s];t[s]=(t[s]||0)+o}}
for(var c=4;c<6;c++)
if("0"!=a.equips[c]){var l=a.equips[c],h=P.getExtraPropAttr(l);for(var s in h){o=h[s];t[s]=(t[s]||0)+o}}
for(var d=0;d<a.heroCfg.talents.length;d++){var _=a.heroCfg.talents[d];if(d+1<=a.grade){var u=I.getTalentCfg(_),m=b.getEquipAttrName(u.coefs[0]);1==u.talent_type&&3<u.coefs[0]&&(t[m]=(t[m]||0)+u.coefs[1])}}
for(var p=0;p<a.runePutup.length;p++){var f=a.runePutup[p],g=a.runeLevel[p];if(0<f)
for(var y=DonotDestroyManager.GameData.Runes[f],v=y.addon_type.split("-"),M=0;M<v.length;M++){var S=parseInt(v[M]),C="";if(3<S&&S<=9?C=b.getEquipAttrName(S):9<S&&(C=b.getEquipAttrName1(S)),""!=C){var D=1;0<g&&(D=1+DonotDestroyManager.GameData.RuneLevel[y.quality].add_on[g-1]/100),t[C]=(t[C]||0)+parseInt(y[C]*D)}}}
return t},a.prototype.getAdditionProp=function(e){for(var t=0,a=0,n=0,i=1;i<6;i++){var r="addition_"+i;if(e[r]){var s=e.heroCfg.additions[r],o=h.getAdditionById(s);t+=o.rate.maxhp||0,a+=o.rate.atk||0,n+=o.rate.def||0}}
return[t,a,n]},a.prototype.getTalentProp=function(e,t){for(var a=0,n=0,i=0,r=0,s=0,o=0,c=0;c<e.length;c++){var l=e[c];if(c+1<=t){var h=I.getTalentCfg(l),d=h.talent_type,_=h.coefs;1==d?1==_[0]?a+=_[1]:2==_[0]?n+=_[1]:3==_[0]&&(i+=_[1]):2==d&&(1==_[0]?r+=_[1]:2==_[0]?s+=_[1]:3==_[0]&&(o+=_[1]))}}
return[a,n,i,r,s,o]},a.prototype.getEquipProp=function(e){for(var t=0,a=0,n=0,i=0;i<4;i++)
if("0"!=e.equips[i]){var r=e.equips[i],s=b.getEquipPropAttr(r),o=V(s,3);t+=o[0],a+=o[1],n+=o[2]}
var c=this.getTierPropAttr(e),l=V(c,3);return[t+=l[0],a+=l[1],n+=l[2]]},a.prototype.getTierPropAttr=function(e,t){var a,n=0,i=0,r=0,s=!1;if(t){if(0==(a=b.getEquipTierId(t)))
return[n,i,r];s=!0}
for(var o=[],c=0;c<4;c++){var l=e.equips[c],h=null;"0"!=l&&(h=b.getEquipByUid(l));var d=null;if(null!=h){var _=h.template_id;d=f.getEquipConfig(_)}
s?h&&0!=d.tier&&d.tier==a&&(null==o[d.tier]&&(o[d.tier]=0),o[d.tier]=o[d.tier]+1):h&&0!=d.tier&&(null==o[d.tier]&&(o[d.tier]=0),o[d.tier]=o[d.tier]+1)}
for(var u in o){var m=o[u];if(1<m){var p=g.getTiersAddtion(u,m,s);n+=p.maxhp,i+=p.atk,r+=p.def}}
return[n,i,r]},a.prototype.getTreasureProp=function(e){for(var t=0,a=0,n=0,i=0,r=0,s=0,o=4;o<6;o++)
if("0"!=e.equips[o]){var c=e.equips[o],l=P.getTreaPropAttr(c),h=V(l,6);t+=h[0],a+=h[1],n+=h[2],i+=h[3],r+=h[4],s+=h[5]}
return[t,a,n,i,r,s]},a.prototype.getHeroPropByHero=function(e,t,a,n){n=n||{maxhp_rate:0,atk_rate:0,def_rate:0};for(var i=t||e.level,r=null==a?e.grade:a,s=DonotDestroyManager.GameData.CardUpgrades.coefs[e.heroCfg.potential][r],o=e.heroCfg.ori_attrs.maxhp+(i-1+s.maxhp)*e.heroCfg.add_attrs.maxhp,c=e.heroCfg.ori_attrs.atk+(i-1+s.atk)*e.heroCfg.add_attrs.atk,l=e.heroCfg.ori_attrs.def+(i-1+s.def)*e.heroCfg.add_attrs.def,h=this.getAdditionProp(e),d=V(h,3),_=d[0],u=d[1],m=d[2],p=this.getTalentProp(e.heroCfg.talents,r),f=V(p,6),g=f[0],y=f[1],v=f[2],M=f[3],S=f[4],C=f[5],D=this.getEquipProp(e),I=V(D,3),b=I[0],P=I[1],L=I[2],B=this.getTreasureProp(e),w=V(B,6),E=w[0],k=w[1],T=w[2],A=w[3],R=w[4],F=w[5],x=0,U=0,N=0,G=0;G<e.runePutup.length;G++){var H=e.runePutup[G],O=e.runeLevel[G];if(0<H){var q=DonotDestroyManager.GameData.Runes[H],j=1;0<O&&(j=1+DonotDestroyManager.GameData.RuneLevel[q.quality].add_on[O-1]/100),null!=q.maxhp&&(x+=q.maxhp*j),null!=q.atk&&(U+=q.atk*j),null!=q.def&&(N+=q.def*j)}}
return o=o*(1+_/100+M/100+A/1e4+n.maxhp_rate/100)+g+b+E+x,c=c*(1+u/100+S/100+R/1e4+n.atk_rate/100)+y+P+k+U,l=l*(1+m/100+C/100+F/1e4+n.def_rate/100)+v+L+T+N,[Math.floor(o),Math.floor(c),Math.floor(l)]},a.prototype.getHeroExpImp=function(e){for(var t=0,a=0;a<e.length;++a)
if(e[a].config){var n=e[a].config.entity;n.itemCfg?t+=e[a].config.exp:n.heroCfg&&(t+=l.getLevelExpTotal(n.heroCfg.potential,n.level))}
return t},a.prototype.getHeroUpgradeLV=function(e,t){var a=this.getHeroByUid(e),n=t+a.exp,i=l.getLevelMax(a.heroCfg.potential);if(0==n||a.level==i)
return[a.level,0,0];for(var r=0,s=a.level;r<n;)
s+=1,r+=l.getLevelExp(a.heroCfg.potential,s);var o=l.getLevelExp(a.heroCfg.potential,a.level+1),c=r-l.getLevelExp(a.heroCfg.potential,s);return s-=1,o<n&&n<r?0!=r&&0==c?[s,o]:[s,c]:(n==r&&(s+=1),[s,r])},a.prototype.getHeroStrengthReqCoin=function(e,t,a,n){if(0==n)
return 0;var i=this.getHeroByUid(e),r=n+i.exp-a,s=0,o=l.getLevelCfg(i.heroCfg.potential,i.level+1);if(t==i.level||0==r)
return s+=n*o[1];s+=(o[0]-i.exp)*o[1];for(var c=i.level+1;c<t;++c)
s+=l.getLevelCost(i.heroCfg.potential,c+1);0<r&&(s+=r*(o=l.getLevelCfg(i.heroCfg.potential,t+1))[1]);return s},a.prototype.getUpgradeTotalExp=function(e){for(var t=0,a=this.getHeroByUid(e),n=MyPersistDataManager._playerData.level,i=0,r=a.level;r<=n;r++){i+=l.getLevelCfg(a.heroCfg.potential,r+1)[0]}
return t=(t=i-a.exp)<0?0:t},a.prototype.isHasHeroByTid=function(e){return null!=MyPersistDataManager._playerData.cardsMaplist[e]},a.prototype.isHasHeroByTidAndExtends=function(e){if(null!=MyPersistDataManager._playerData.cardsMaplist[e])
return!0;for(var t=d.getExtendHeros(e),a=0;a<t.length;a++){var n=t[a];if(null!=MyPersistDataManager._playerData.cardsMaplist[n])
return!0}
return!1},a.prototype.updateHeroAddition=function(){for(var e=MyPersistDataManager._playerData.cardslist.length,t=0;t<e;++t){var a=MyPersistDataManager._playerData.cardslist[t];this.updateHeroAddition1(a)}},a.prototype.updateHeroAddition1=function(e){for(var t=Object.keys(e.heroCfg.additions),a=e.heroCfg.additions,n=t.length,i=0;i<n;++i){var r=a["addition_"+(i+1)];if(r&&0!=r){var s=h.getAdditionById(r);if(2==s.tri_type){var o=s.tri_coef.length;e["addition_"+(i+1)]=!0;for(var c=0;c<o;++c){var l=this.isHasHeroByTidAndExtends(s.tri_coef[c]);if(e["addition_"+(i+1)]=e["addition_"+(i+1)]&&l,!l)
break}}}}
this.updateEquipAddition(e)},a.prototype.updateEquipAddition=function(e){for(var t=e.heroCfg.additions,a=Object.keys(e.heroCfg.additions).length,n=0;n<a;++n){var i=t["addition_"+(n+1)];if(i&&0!=i){var r=h.getAdditionById(i);1==r.tri_type&&(e["addition_"+(n+1)]=!1,this.isEquipOnHero(r.tri_coef[0],e)&&(e["addition_"+(n+1)]=!0))}}},a.prototype.isEquipOnHero=function(e,t){for(var a=0;a<t.equips.length;++a)
if("0"!=t.equips[a]&&MyPersistDataManager._playerData.bagMap[t.equips[a]].template_id==e)
return!0;return!1},a.prototype.isHasHeroOnFormation=function(e){var t=o("BattleBufferMgr").getFormationData(1);return null!=t&&(0<t.a&&t.a==e||(0<t.b&&t.b==e||(0<t.c&&t.c==e||(0<t.d&&t.d==e||(0<t.e&&t.e==e||(0<t.f&&t.f==e||(0<t.g&&t.g==e||(0<t.h&&t.h==e||(0<t.i&&t.i==e||0<t.j&&t.j==e)))))))))},a.prototype.getInFormationHeroIdList=function(){var e=o("BattleBufferMgr").getFormationData(1);if(null==e)
return null;var t=[];return 0<e.a&&t.push(e.a),0<e.b&&t.push(e.b),0<e.c&&t.push(e.c),0<e.d&&t.push(e.d),0<e.e&&t.push(e.e),0<e.f&&t.push(e.f),0<e.g&&t.push(e.g),0<e.h&&t.push(e.h),0<e.i&&t.push(e.i),0<e.j&&t.push(e.j),t},a.prototype.getInFormationFightMaxHero=function(){var e=this.getInFormationHeroIdList(),i=this;return 0<e.length?(e.sort(function(e,t){var a=i.getHeroFightVal(e),n=i.getHeroFightVal(t);return a!=n?n<a:e<t}),e[0]):(cc.log("Hiện tại không có anh hùng nào trong trận"),null)},a.prototype.isInFormFirstHeroEquiped=function(){return"0"!=this.getHeroByUid(this.getInFormationFightMaxHero()).equips[0]},a.prototype.removeHero=function(e){for(var t=this.getHeroByUid(e),a=0;a<4;a++)
if("0"!=t.equips[a]){var n=t.equips[a];b.unBindHeroForEquip(n)}},a.prototype.bindHeroEquipUid=function(e){this.updateEquipAddition(e),e.unit_num=this.getHeroUnitNum(e)},a.prototype.redPointHeroAll=function(e){return!!(this.redPointEquipTreaPutup(e)||this.redPointEquipLevelup(e)||this.redPointUpLevel(e)||this.redpointAddGrade(e)||this.redPointRunes(e)||this.redpointUnitLevelup(e)||this.redpointUnitEquip(e)||this.redpointUnitUpgrade(e))},a.prototype.redPointEquipTreaPutup=function(e){for(var t=!1,a=0;a<6;a++){if("0"==e.equips[a])
if(a<4){if(null!=b.getInstance().getFreeEquipByPos(a+1)){t=!0;break}}else if(null!=P.getInstance().getFreeTreaByPos(a+1)){t=!0;break}}
return t},a.prototype.redPointEquipLevelup=function(e){for(var t=!1,a=0;a<4;a++)
if("0"!=e.equips[a]){var n=e.equips[a],i=MyPersistDataManager._playerData.bagMap[n];if(null!=i&&i.enhance_level<MyPersistDataManager._playerData.level&&5e3<MyPersistDataManager._playerData.gameMoney){t=!0;break}}
return t},a.prototype.redPointUpLevel=function(e){var t=!1;if(e.level<MyPersistDataManager._playerData.level&&5e3<MyPersistDataManager._playerData.gameMoney)
for(var a=DonotDestroyManager.GameData.Common.card_levelup_items_id,n=0;n<a.length;n++){var i=a[n];if(null!=MyPersistDataManager._playerData.bagMap[i]&&0<MyPersistDataManager._playerData.bagMap[i].num){t=!0;break}}
return t},a.prototype.redPointRunes=function(e){var t=e.runeUnlock.length,a=DonotDestroyManager.GameData.Common.rune_cost_hammer[t];if(null!=a&&null!=MyPersistDataManager._playerData.bagMap[1060]&&MyPersistDataManager._playerData.bagMap[1060].num>=a)
return!0;if(!c.hasRune())
return!1;for(var n=0;n<6;n++){var i=!0;if(1<n&&-1==e.runeUnlock.indexOf(n)&&(i=!1),i&&0==e.runePutup[n])
return!0}
for(var r=0;r<6;r++){var s=e.runePutup[r];if(0<s){var o=DonotDestroyManager.GameData.Runes[s];if(0<c.getRuneList(-1,o.quality+1).length)
return!0}}
return!1},a.prototype.redpointAddGrade=function(e){var t=e.grade;e.grade==d.getTalentCnt(e.heroCfg.id)&&(t=e.grade-1);var a=DonotDestroyManager.GameData.CardUpgrades.costs[e.heroCfg.potential][t];if(null==a)
return!1;for(var n=0;n<a.items.length;++n){var i=a.items[n][0],r=a.items[n][1],s=!1;if(null!=MyPersistDataManager._playerData.bagMap[i]&&MyPersistDataManager._playerData.bagMap[i].num>=r&&(s=!0),!s)
r<=P.getInstance().getFreeTreaCount(i)&&(s=!0);if(!s)
return!1}
return!(0<a.cards&&e.num-1<a.cards)&&!(0<a.gamemoney&&MyPersistDataManager._playerData.gameMoney<a.gamemoney)},a.prototype.redpointUnitLevelup=function(e){var t=!1,a=e.heroCfg.unit_type,n=e.unitGrade,i=DonotDestroyManager.GameData.Units.cost[a-1][n-1];if(null==i)
return!1;if(e.unit_level>=i.max_level)
return!1;if(e.unit_level>=MyPersistDataManager._playerData.level)
return!1;var r=i.levelup_item_num[e.unit_level%10],s=i.levelup_item_id;return null!=MyPersistDataManager._playerData.bagMap[s]&&MyPersistDataManager._playerData.bagMap[s].num>=r&&(t=!0),t},a.prototype.redpointUnitEquip=function(e){var t=!1,a=e.heroCfg.unit_type,n=e.unitGrade,i=DonotDestroyManager.GameData.Units.cost[a-1][n-1];if(null==i)
return!1;for(var r=0;r<i.upgrade_item.length;++r){var s=i.upgrade_item[r];if(!(0<e.unitEquips[r])){var o=s[0],c=s[1],l=s[2];if(null!=MyPersistDataManager._playerData.bagMap[o]&&MyPersistDataManager._playerData.bagMap[o].num>=c&&e.unit_level>=l){t=!0;break}}}
return t},a.prototype.redpointUnitUpgrade=function(e){var t=e.heroCfg.unit_type,a=e.unitGrade,n=DonotDestroyManager.GameData.Units.cost[t-1][a-1];if(null==n)
return!1;if(e.unit_level<n.max_level)
return!1;for(var i=0;i<e.unitEquips.length;i++)
if(0==e.unitEquips[i])
return!1;return!(0<n.upgrade_gamemoney&&MyPersistDataManager._playerData.gameMoney<n.upgrade_gamemoney)},e.exports=new a,cc._RF.pop()},{AdditionCfgMgr:"AdditionCfgMgr",BattleBufferMgr:"BattleBufferMgr",CardLevelsMgr:"CardLevelsMgr",EquipBufferMgr:"EquipBufferMgr",EquipCfgMgr:"EquipCfgMgr",HeroConfigMgr:"HeroConfigMgr",RunesBufferMgr:"RunesBufferMgr",TalentsCfgMgr:"TalentsCfgMgr",TiersCfgMgr:"TiersCfgMgr",TreasureBufferMgr:"TreasureBufferMgr",UnitBufferMgr:"UnitBufferMgr"}],HeroConfigMgr:[function(e,t,a){"use strict";cc._RF.push(t,"4b296A7Y1tCHZTcQADMNqMx","HeroConfigMgr");var i=e("TalentsCfgMgr"),u=e("CardUpgradesMgr"),m=function(){};m.find=function(e){var t=DonotDestroyManager.GameData.Cards[e];return t||null},m.getTalentCnt=function(e){return m.find(e).talents.length},m.getHeroUnitNum=function(e,t){var a=m.find(t),n=i.getEffectVal(a.talents,e,3);return i.processUnitNumVal(n)},m.getHeroAttr=function(e,t,a){for(var n=m.find(e),i={},r=Object.keys(n),s=0;s<r.length;++s)
i[r[s]]=n[r[s]];var o=Object.keys(n.ori_attrs);for(s=0;s<o.length;++s){var c=n.ori_attrs[o[s]];i[o[s]]=c}
var l=Object.keys(n.add_attrs);for(s=0;s<l.length;++s){c=n.add_attrs[l[s]];i[l[s]]=i[l[s]]+c*(t-1)}
if(0<a){var h=u.getCoefs(n.potential,a),d=Object.keys(h);for(s=0;s<d.length;++s){var _=d[s];c=h[_];null==n.add_attrs[_]?i[_]=h[_]:i[_]=i[_]+n.add_attrs[_]*h[_]}}
return i},m.getExtendHeros=function(e){var t=m.find(e);return null!=t&&null!=t.extend_id?t.extend_id:[]},t.exports=m,cc._RF.pop()},{CardUpgradesMgr:"CardUpgradesMgr",TalentsCfgMgr:"TalentsCfgMgr"}],HeroDetailsPanel:[function(e,t,a){"use strict";cc._RF.push(t,"f7f1exV6ZdCH4WNIa+j5xu1","HeroDetailsPanel");var r=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=(e("HeroConfigMgr"),e("NetEvent"),e("MyEventDispatcher")),s=e("i18n"),o=e("CardLevelsMgr"),c=e("HeroBufferMgr"),i=e("ResLoaderManager"),l=(e("GameUtils"),e("AdditionCfgMgr")),h=e("ColorUtil"),d=e("MyUIEvent"),_=e("SoundUtil"),u=e("GuideBufferMgr"),m=e("UnLockCfgMgr"),p=cc.Class({extends:cc.Component,properties:{m_pMask:cc.Node,m_pHeroName:cc.Label,m_pZhizi:cc.Label,m_pFighting:cc.Label,m_pAttack:cc.Label,m_pDefen:cc.Label,m_pLife:cc.Label,m_pLevel:cc.Label,mBtnBack:cc.Node,mBtnShengJi:cc.Node,mBtnRune:cc.Node,node_red_onkeyEquipLevelup:cc.Node,node_red_levelup:cc.Node,node_red_upgrade:cc.Node,node_red_runes:cc.Node,node_red_unit_upgrade:cc.Node,m_pSoldierType:cc.Sprite,m_pGroup:cc.Sprite,m_pBaner:cc.Sprite,m_pShangzhen:cc.Node,m_pCurbar:cc.Sprite,mAutoStrenBtn:cc.Node,mBtnShengJie:cc.Node,mBtnSoldierUplevel:cc.Node,mBtnSoldierUpgrade:cc.Node,m_pLeftArrow:cc.Node,m_pRightArrow:cc.Node,m_pHeroParent:cc.Node,m_pItemBox:cc.Prefab,m_pAttrchangeinfo:cc.Prefab,m_pTiereffectPrefab:cc.Prefab,m_pChangeLabelParent:cc.Node,m_pLeftBg:cc.Button,m_pStarNode:cc.Node,m_pBtnUpgrade:cc.Node,m_pLabUpgrade:cc.Node,m_pStarList:[cc.Sprite],m_pStarsprlist:[cc.SpriteFrame],m_pSideList:[cc.SpriteFrame],m_pAdditionList:[cc.Label],m_pSkillLab:[cc.Label],m_pSoldierTypeList:[cc.SpriteFrame],m_pGroupList:[cc.SpriteFrame],m_pBanerList:[cc.SpriteFrame],pre_rune_small_tip:cc.Prefab,node_rune_list:cc.Node,_heroid:null,_heroinfo:null,_tierseffect:null,_herojsoninfo:null,_heropre:null,_heroitem:null,_armature:null,_armatureDisplay:null,_rolebasepre:null,_rolebaseitem:null,_rolebasearmature:null,_rolebasearmatureDisplay:null,_atk:0,_def:0,_maxhp:0,_shortMask_node:null,_curHeroList:null,_index:-1,_unitsview:null,_equipview:null,_panelinfo:null,_raw_assets:{default:{},type:Object},_lastPlaySoundFrame:0},statics:{instance:null,getInstance:function(){return p.instance}},LoadRes:function(){this.toLoadResList=[],this.toLoadResList.push(["UI/PropHints/number_1",cc.LabelAtlas]),this.toLoadResList.push(["UI/PropHints/number_2",cc.LabelAtlas]),this.toLoadResList.push(["UI/PropHints/number_3",cc.LabelAtlas]),this.toLoadResList.push(["UI/PropHints/numberSub_1",cc.LabelAtlas]),this.toLoadResList.push(["Prefab/effect/propHints",cc.Prefab]),this.toLoadResList.push(["Prefab/ItemBox/ItemBox",cc.Prefab]),this.toLoadResList.push(["Prefab/HeroDetailsPanel/HeroEquipInfo",cc.Prefab]),this.toLoadResList.push(["Prefab/ItemBox/itemBorder",cc.Prefab]);var e=this._loadProgressCb.bind(this),t=this._loadFinishCb.bind(this);i.asyncLoadAll(this.toLoadResList,e,t)},_loadProgressCb:function(e){},_loadFinishCb:function(e,t){cc.log("load teamskill resources finish!"),t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this)},InitEffectFX:function(){null==this._tierseffect&&(this._tierseffect=cc.instantiate(this.m_pTiereffectPrefab))},InitRune:function(){this.node_rune_list.destroyAllChildren();for(var e=0;e<this._heroinfo.runePutup.length;e++){var t=this._heroinfo.runePutup[e];if(0<t){var a=cc.instantiate(this.pre_rune_small_tip);this.node_rune_list.addChild(a),a.getComponent("RuneSmallTip").changeData(t)}}},InitStar:function(){var e=0,t=0;this._herojsoninfo.quality<=1?(this.m_pStarNode.active=!1,this.m_pBtnUpgrade.active=!1,this.m_pLabUpgrade.active=!1):(this.m_pStarNode.active=!0,this.m_pBtnUpgrade.active=!0,this.m_pLabUpgrade.active=!0,t=5==(e=2==this._herojsoninfo.quality?5:7)?-70:-105);for(var a=0;a<this.m_pStarList.length;++a)
a<e?(this.m_pStarList[a].node.active=!0,this.m_pStarList[a].node.setPosition(t+35*a,-128)):this.m_pStarList[a].node.active=!1,this._heroinfo.grade>a?this.m_pStarList[a].spriteFrame=this.m_pStarsprlist[1]:this.m_pStarList[a].spriteFrame=this.m_pStarsprlist[0]},onLoad:function(){(p.instance=this).LoadRes(),this.InitEffectFX(),this._unitsview=this.node.getComponent("HeroUnitsView"),this._equipview=this.node.getComponent("HeroEquipView"),this._refreshheroupgrade_cb_func=this.RefreshUpgrade.bind(this),n.addListener(d.RefreshHeroUpgrade,this._refreshheroupgrade_cb_func)},setParams:function(e){this._panelinfo=e,this._heroinfo=this._panelinfo.heroinfo,this._curHeroList=this._panelinfo.herolist,this._index=this._panelinfo.index,cc.log(" trước mặt anh hùng hạ tiêu ===="+this._index),this._heroid=this._heroinfo.template_id,this._herojsoninfo=DonotDestroyManager.GameData.Cards[this._heroinfo.template_id],this.Init()},Init:function(){var i=this;this.m_pHeroName.string=this._herojsoninfo.name,this.m_pZhizi.string=this._herojsoninfo.potential,this.m_pLevel.string="Lv."+this._heroinfo.level;var e=c.getHeroPropAttr(this._heroinfo.template_id),t=r(e,3);this._maxhp=t[0],this._atk=t[1],this._def=t[2],this.m_pAttack.string=s.t("hd_001",{value:this._atk}),this.m_pDefen.string=s.t("hd_002",{value:this._def}),this.m_pLife.string=s.t("hd_003",{value:this._maxhp}),this.m_pSoldierType.spriteFrame=this.m_pSoldierTypeList[this._herojsoninfo.unit_type-1],this.m_pGroup.spriteFrame=this.m_pGroupList[this._herojsoninfo.group-1],this.m_pBaner.spriteFrame=this.m_pBanerList[this._herojsoninfo.quality],this.m_pLeftArrow.active=!0,this.m_pRightArrow.active=!0,this.m_pFighting.string=c.getHeroFightVal(this._heroinfo.template_id);var a=o.getLevelCfg(this._heroinfo.heroCfg.potential,this._heroinfo.level+1);this.m_pCurbar.node.scaleX=1<this._heroinfo.exp/a[0]?1:this._heroinfo.exp/a[0],this._index<=0&&(this.m_pLeftArrow.active=!1),this._index>=this._curHeroList.length-1&&(this.m_pRightArrow.active=!1),this.InitStar(),this.InitRune(),null==this._rolebaseitem&&cc.loader.loadRes("Prefab/Heros/rolebase",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load rolebase success!"),i._rolebasepre=t,i._rolebaseitem=cc.instantiate(t),i.m_pHeroParent.addChild(i._rolebaseitem),i._rolebasearmatureDisplay=i._rolebaseitem.getComponent(dragonBones.ArmatureDisplay),i._rolebasearmature=i._rolebasearmatureDisplay.armature(),i._rolebasearmature.animation.fadeIn("blue",-1,-1,0,"normal")}),cc.loader.loadRes("Prefab/Heros/"+this._herojsoninfo.icon,cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load heroprefab success!"),cc.isValid(i.node)){null!=i._heroitem&&(i._heroitem.removeFromParent(),i._heroitem.destroy(),i._heroitem=null),null!=i._heropre&&i._heropre!=t&&(i._heropre=null),i._heropre=t,i._heroitem=cc.instantiate(t),i.m_pHeroParent.addChild(i._heroitem),null==i._herojsoninfo.is_spine&&i._heroitem.setScale(-1,1);var a=null!=i._herojsoninfo.is_spine&&i._herojsoninfo.is_spine?i._herojsoninfo.skills[0][1]:"entrance";if(i._heroitem.getComponent(sp.Skeleton).setAnimation(0,a,!1),i._heroitem.getComponent(sp.Skeleton).addAnimation(0,"stand",!0,0),3<=i._herojsoninfo.quality&&(null==i._panelinfo.is_sound||1==i._panelinfo.is_sound)){var n=i._herojsoninfo.sound?i._herojsoninfo.sound:i._herojsoninfo.icon;_.playHeroSound(n)}}}),this.UpdateSkill(),this.UpdateFateView();var n=new cc.Component.EventHandler;n.target=this.node,n.component="HeroDetailsPanel",n.handler="Heroinfo_Onclickhandler",n.customEventData=this._heroid,this.m_pLeftBg.clickEvents[0]=n,this._unitsview.InitContent(this._heroinfo),this._equipview.InitContent(this._heroinfo),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this))),this._refreshRedPoints()},_refreshRedPoints:function(){c.redPointEquipLevelup(this._heroinfo)?this.node_red_onkeyEquipLevelup.active=!0:this.node_red_onkeyEquipLevelup.active=!1,c.redPointUpLevel(this._heroinfo)?this.node_red_levelup.active=!0:this.node_red_levelup.active=!1,c.redpointAddGrade(this._heroinfo)?this.node_red_upgrade.active=!0:this.node_red_upgrade.active=!1,c.redPointRunes(this._heroinfo)?this.node_red_runes.active=!0:this.node_red_runes.active=!1,c.redpointUnitLevelup(this._heroinfo)||c.redpointUnitUpgrade(this._heroinfo)?this.node_red_unit_upgrade.active=!0:this.node_red_unit_upgrade.active=!1},_animationEventHandler:function(e){if(cc.log("animation event!"+e.type),e.type===dragonBones.EventObject.COMPLETE||e.type===dragonBones.EventObject.LOOP_COMPLETE){if(cc.log("animation event complete!"),"entrance"===e.detail.animationState.name){var t=this;setTimeout(function(){null!=t&&cc.isValid(t)&&cc.isValid(t.node)&&t._armature.animation.fadeIn("stand",-1,-1,0,"normal")},20)}
this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._animationEventHandler,this)}},UpdateSkill:function(){for(var e=DonotDestroyManager.GameData.Skills,t=this._heroinfo.heroCfg,a=0;a<this.m_pSkillLab.length;++a)
a<t.skills.length&&null!=e[t.skills[a][0]]?(this.m_pSkillLab[a].node.active=!0,this.m_pSkillLab[a].string=e[t.skills[a][0]].name,1==a&&3<=t.quality&&this._heroinfo.grade<3?this.m_pSkillLab[a].node.color=cc.color(91,103,103):this.m_pSkillLab[a].node.color=h.getColorByQuality(e[t.skills[a][0]].quality)):this.m_pSkillLab[a].node.active=!1},UpdateFateView:function(){for(var e=this._heroinfo.heroCfg,t=0,a=0;a<5;++a){var n="addition_"+(a+1),i=l.getAdditionById(e.additions[n]);i&&(this.m_pAdditionList[t].node.active=!0,this.m_pAdditionList[t].string=i.name,this._heroinfo[n]?this.m_pAdditionList[t].node.color=cc.color(255,216,0):this.m_pAdditionList[t].node.color=cc.color(86,86,86),++t)}
if(t<this.m_pAdditionList.length)
for(a=t;a<this.m_pAdditionList.length;++a)
this.m_pAdditionList[a].node.active=!1},RefreshPanelInfo:function(e,t){if(this._refreshRedPoints(),e)
if(t!=this._index)
this.SwitchHeroInfo({herolist:this._curHeroList,heroinfo:this._curHeroList[t],index:t});else{this._heroinfo=MyPersistDataManager._playerData.cardsMaplist[this._heroinfo.template_id],this.m_pLevel.string="Lv."+this._heroinfo.level;var a=o.getLevelCfg(this._heroinfo.heroCfg.potential,this._heroinfo.level+1);this.m_pCurbar.node.scaleX=1<this._heroinfo.exp/a[0]?1:this._heroinfo.exp/a[0],this.RefreshAttributes(),this._index<=0&&(this.m_pLeftArrow.active=!1),this._index>=this._curHeroList.length-1&&(this.m_pRightArrow.active=!1)}},RefreshUpgrade:function(){this.InitStar(),this.RefreshAttributes(),this.UpdateSkill(),this._refreshRedPoints()},RefreshAttributes:function(){var e=c.getHeroPropAttr(this._heroinfo.template_id),t=r(e,3);this._maxhp=t[0],this._atk=t[1],this._def=t[2],this.m_pAttack.string=s.t("hd_001",{value:this._atk}),this.m_pDefen.string=s.t("hd_002",{value:this._def}),this.m_pLife.string=s.t("hd_003",{value:this._maxhp});var a=c.getHeroFightVal(this._heroinfo.template_id);this.m_pFighting.string=a,this._heroinfo.fight=a},SwitchHeroInfo:function(e){this._panelinfo.herolist=e.herolist,this._panelinfo.heroinfo=e.heroinfo,this._panelinfo.index=e.index,this._panelinfo.is_sound=!0,this._heroinfo=this._panelinfo.heroinfo,this._curHeroList=this._panelinfo.herolist,this._index=this._panelinfo.index,this._heroid=this._heroinfo.template_id,this._herojsoninfo=DonotDestroyManager.GameData.Cards[this._heroinfo.template_id],this.Init()},SwitchHero_OnClickHandler:function(e,t){_.playPageEffect(),0!=parseInt(t)?this.SwitchHeroInfo({herolist:this._curHeroList,heroinfo:this._curHeroList[this._index+1],index:this._index+1}):this.SwitchHeroInfo({herolist:this._curHeroList,heroinfo:this._curHeroList[this._index-1],index:this._index-1})},Lvup_OnClickHandler:function(e){if(_.playBtnOpenEffect(),this._heroinfo.level>=MyPersistDataManager._playerData.level)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),s.t("detail_022"));else{var t=m.getFuncUnLockInfo(11),a=r(t,2),n=a[0],i=a[1];n?MyUiManager.Open(MyUiManager.PanelInfo.HeroLvUpLayer,{herobuffer:this._heroinfo,index:this._index,cb:this.RefreshPanelInfo.bind(this),pre:this._heropre,map:this._raw_assets}):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),i)}},Upgrade_OnClickHandler:function(){_.playBtnOpenEffect();var e=m.getFuncUnLockInfo(38),t=r(e,2),a=t[0],n=t[1];a?MyUiManager.Open(MyUiManager.PanelInfo.HeroUpgradeDialog,{herobuffer:this._heroinfo,map:this._raw_assets}):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),n)},Back_onclickHandler:function(e){MyUiManager.Back(),_.playBtnCloseEffect()},Heroinfo_Onclickhandler:function(e,t){cc.log("Mở bảng chi tiết"),_.playBtnOpenEffect(),this._panelinfo.is_sound=!1,MyUiManager.Open(MyUiManager.PanelInfo.HeroAttributePanel,{herobuffer:this._heroinfo})},clickHanlder_heroBody:function(){if(!(cc.director.getTotalFrames()-this._lastPlaySoundFrame<60)&&(this._lastPlaySoundFrame=cc.director.getTotalFrames(),null!=this._heroitem&&"stand"==this._heroitem.getComponent(sp.Skeleton).animation)){var e=[],t=(e=null==this._herojsoninfo.is_spine?["attack1","attack2","attack3"]:["attack1","attack2"])[parseInt(Math.random()*e.length)];this._heroitem.getComponent(sp.Skeleton).setAnimation(0,t,!1),this._heroitem.getComponent(sp.Skeleton).addAnimation(0,"stand",!0,0)}},onDestroy:function(){(p.instance=null)!=this._armatureDisplay&&this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),n.removeListener(d.RefreshHeroUpgrade,this._refreshheroupgrade_cb_func),this._heropre,this._rolebasepre,this._rolebasepre=null,this._rolebaseitem=null,this._heropre=null,(this._heroitem=null)!=this._shortMask_node&&this._shortMask_node.destroy(),(this._shortMask_node=null)!=this._tierseffect&&this._tierseffect.destroy(),(this._tierseffect=null)!=this._raw_assets&&(this._raw_assets={})},showGuide:function(){var t=this;return u.isArmyUpGradeComplete()||!this.isAllUnitEquipOn()||(u.setArmyUpGradeGuideOver(),this._unitsview.isUnitEquipUpGradeAble())?u.isFristArmy()&&null==t._unitsview.getCanEquipBtn()?null:void u.showGuide("HeroViewLayer",function(e){return 1==e?t._equipview.m_pEquipParent.children[0]:3==e?t.mBtnShengJi:4==e?t._equipview.m_pEquipParent.children[5]:6==e?t.mBtnSoldierUplevel:7==e?t.mAutoStrenBtn:8==e?t._unitsview.getCanEquipBtn():9==e?t.mBtnSoldierUpgrade:10==e?t.mBtnShengJie:11==e?t.mBtnBack:12==e?t.mBtnRune:void 0},function(e){19==e[1]&&t.showGuide()}):null},isAllUnitEquipOn:function(){for(var e=!0,t=0;t<5;t++)
if(MyPersistDataManager._playerData.cardsMaplist[this._heroid].unitEquips[t]<=0){e=!1;break}
return e},jump2Rune:function(e,t){_.playBtnOpenEffect(),this._panelinfo.is_sound=!1,MyUiManager.Open(MyUiManager.PanelInfo.HeroRuneLayer,{hero_template:this._herojsoninfo,hero_entity:this._heroinfo})}});cc._RF.pop()},{AdditionCfgMgr:"AdditionCfgMgr",CardLevelsMgr:"CardLevelsMgr",ColorUtil:"ColorUtil",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",HeroBufferMgr:"HeroBufferMgr",HeroConfigMgr:"HeroConfigMgr",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil",UnLockCfgMgr:"UnLockCfgMgr",i18n:"i18n"}],HeroDieManager:[function(l,e,t){"use strict";cc._RF.push(e,"18bddEmrmhGJY85cYKAVOkX","HeroDieManager");var s=l("BattleConstants"),a=function(){};a.prototype.resetData=function(){},a.prototype.die1=function(e,t){var a=l("BattleManager"),n=null;n=e==s._BTL_SIDE.OUR?a.otrside.armies:a.ourside.armies;for(var i=0;i<n.length;i++){var r=n[i];if(r.isSearchAble()&&r.hero&&"Dead"!=r.hero.getState()){if(36==r.hero.cfg.id){this.addBuff(r.hero,20034);break}
if(214==r.hero.cfg.id){this.addBuff(r.hero,20177);break}}}},a.prototype.addBuff=function(e,t){for(var a=!1,n=null,i=e.buffs.length-1;0<=i;i--){var r=e.buffs[i];if(r.cfg.id==t){a=!0,n=r;break}}
if(a)
n.doAddon();else{var s=l("BuffsManager"),o=s.getCfgById(t),c=s.createBuff();c.id=t,c.cfg=o,c.origin=e,c.target=e,c.setFSM(),e.buffs.push(c)}},e.exports=new a,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleManager:"BattleManager",BuffsManager:"BuffsManager"}],HeroEquipInfo:[function(t,e,a){"use strict";cc._RF.push(e,"9c926myeVJIqIERJqdxYsIk","HeroEquipInfo");var b=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},P=t("i18n"),L=t("ColorUtil"),n=t("MyProtocols"),B=t("EquipBufferMgr"),w=t("TreasureBufferMgr"),l=t("ItemBufferMgr"),s=t("SoundUtil"),o=t("UnLockCfgMgr"),i=t("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pEquipName:cc.Label,m_pEquipHeroLab:cc.Label,m_pEquipLevel:cc.Label,m_pJianjievalue:cc.Label,m_pUnitlab:cc.Label,m_pRefineAttr:cc.Label,m_pEquipItemParent:cc.Node,m_pTierItem:cc.Node,m_pTiersParent:cc.Node,m_btnRefine:cc.Node,m_pTaozhuangContent:cc.Node,m_pJinglianContent:cc.Node,m_pBottomContent:cc.Node,m_pArrow1:cc.Node,m_pArrow2:cc.Node,m_pJinlianLab:cc.Label,m_pStarList:[cc.Sprite],m_pStarSprFrame:[cc.SpriteFrame],m_pAtrList:[cc.Label],m_pTierAttrList:[cc.Label],m_pJsAtrList:[cc.Label],_simpleinfo:null,_attrindex:0,_tierscfg:null,_tiersitemlist:[],_equipbox:null,_pos:-1,_attrcount:0,_herobuffer:null,_tiercount:-1,_raw_assets:null,_scriptname:"",_panelindtance:null,_params:null},onLoad:function(){},start:function(){this.showGuide()},ChangeData:function(e){this._params=e,this._simpleinfo=e.buffer,this._pos=e.pos,this._herobuffer=e.herobuffer,this._raw_assets=e.map,this._scriptname=e.scriptname,this._scriptname&&(this._panelindtance=t(this._scriptname)),this._cb=e.cb,this.Init()},Init:function(){var e=null==this._params.showbtn||this._params.showbtn;this.m_pBottomContent.active=e,this._attrindex=0,null==this._equipbox&&(this._equipbox=cc.instantiate(this._raw_assets["Prefab/ItemBox/ItemBox"]),this.m_pEquipItemParent.addChild(this._equipbox));var t=this._equipbox.getComponent("ItemBox"),a={template_id:this._simpleinfo.template_id,uuid:this._simpleinfo.uuid};if(t.ChangeEquipInfo(a),null!=t._itemjsoninfo.tier&&0<t._itemjsoninfo.tier&&(null==t._tiereffect?(t._tiereffect=cc.instantiate(this._raw_assets["Prefab/ItemBox/itemBorder"]),this._equipbox.addChild(t._tiereffect)):t._tiereffect.active=!0),null!=this._simpleinfo.heroid?(this.m_pEquipHeroLab.node.active=!0,this.m_pEquipHeroLab.string=P.t("sh_043",{value:DonotDestroyManager.GameData.Cards[this._simpleinfo.heroid].name})):this.m_pEquipHeroLab.node.active=!1,this.m_pEquipName.string=t._itemjsoninfo.name,this.m_pEquipName.node.color=L.getColorByQuality(t._itemjsoninfo.quality),this.m_pJianjievalue.string=t._itemjsoninfo.des,this.ShowArrow(),l.isEquipEntity(this._simpleinfo.template_id)){if(null!=this._simpleinfo.unitAttr&&0!=this._simpleinfo.unitAttr.id){this.m_pUnitlab.node.active=!0,this.m_pEquipHeroLab.node.active&&this.m_pEquipHeroLab.node.setPosition(-115,-15),this.m_pUnitlab.string=this.getAddUnitAttr(t._itemjsoninfo.unit_type,this._simpleinfo.unitAttr);var n=MyPersistDataManager._playerData.bagMap[this._simpleinfo.uuid].heroid,i=cc.Color.GRAY;if(null!=n){var r=DonotDestroyManager.GameData.Cards[n];t._itemjsoninfo.unit_type==r.unit_type&&(i=cc.color(253,142,0))}
this.m_pUnitlab.node.color=i}else
this.m_pUnitlab.node.active=!1,this.m_pEquipHeroLab.node.active&&this.m_pEquipHeroLab.node.setPosition(-115,-25);if(this.m_pJinlianLab.string=P.t("detail_023"),this.m_pJinglianContent.active=!1,this.m_pEquipLevel.string="LV."+this._simpleinfo.enhance_level,this._attrcount=0,this.RefreshEquipAttr(),0==t._itemjsoninfo.tier||null==t._itemjsoninfo.tier)
return void(this.m_pTaozhuangContent.active=!1);this.m_pTaozhuangContent.active=!0,this._tierscfg=DonotDestroyManager.GameData.Tiers[t._itemjsoninfo.tier];for(var s=this.GetHeroTiersData(),o=0;o<this._tierscfg.equips.length;++o)
if(o<this._tiersitemlist.length){this._tiersitemlist[o].active=!0,this._tiersitemlist[o].getComponent("StoreHouseTiersItem").ChangeData(this._tierscfg.equips[o],this._scriptname,s[this._tierscfg.equips[o]]),this._tiersitemlist[o].setPosition(120*o,0)}else{var c=cc.instantiate(this.m_pTierItem);this.m_pTiersParent.addChild(c),c.active=!0,c.getComponent("StoreHouseTiersItem").ChangeData(this._tierscfg.equips[o],this._scriptname,s[this._tierscfg.equips[o]]),c.setPosition(120*o,0),this._tiersitemlist.push(c)}
this.m_pTierAttrList[0].string=this.SetTierAttributeLab(0,this._tierscfg),this.m_pTierAttrList[1].string=this.SetTierAttributeLab(1,this._tierscfg),this.m_pTierAttrList[2].string=this.SetTierAttributeLab(2,this._tierscfg),this.SetTierAttributeJihuo()}else
this.m_pUnitlab.node.active=!1,this.m_pEquipHeroLab.node.active&&this.m_pEquipHeroLab.node.setPosition(-115,-25),this.m_pJinlianLab.string=P.t("detail_024"),this.m_pEquipLevel.string="+"+this._simpleinfo.enhance_level,this.m_pTaozhuangContent.active=!1,this.m_pJinglianContent.active=!0,this.RefreshTreasureAttr(),this.InitStarContent()},RefreshTreasureAttr:function(){var e=w.getStrengthPropAttr(this._simpleinfo.uuid),t=b(e,6),a=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],c=[r/100,s/100,o/100];s=c[1],o=c[2];var l=[];0!=(r=c[0])&&l.push(P.t("detail_027",{value:r})),0!=s&&l.push(P.t("detail_025",{value:s})),0!=o&&l.push(P.t("detail_026",{value:o})),0!=a&&l.push(P.t("detail_004",{value:a})),0!=n&&l.push(P.t("detail_005",{value:n})),0!=i&&l.push(P.t("detail_006",{value:i}));for(var h=w.getExtraPropAttr(this._simpleinfo.uuid),d=Object.keys(h),_=0;_<d.length;++_){var u=h[d[_]];if(null!=u&&0!=u){var m=B.getEquipAttrDes(B.getEquipAttrName(d[_]));l.push(m+u)}}
var p=0;cc.log(l.length);for(_=0;_<l.length;++_)
this.m_pAtrList[_].node.active=!0,this.m_pAtrList[_].string=l[_],++p;if(p<this.m_pAtrList.length)
for(_=p;_<this.m_pAtrList.length;++_)
this.m_pAtrList[_].node.active=!1;var f=DonotDestroyManager.GameData.Treasures[this._simpleinfo.template_id].unlocks,g=Object.keys(f),y=[];for(_=0;_<g.length;++_){var v=f[g[_]],M=parseInt(g[_]);if(v&&v.rate&&!(v.rate instanceof Array))
for(var S in v.rate){var C=v.rate[S]/100,D=B.getEquipAttrDes(B.getEquipAttrName(S));y.push([M,D+C+"%",this._simpleinfo.enhance_level>=M])}
if(v&&v.statics&&!(v.statics instanceof Array))
for(var S in v.statics){D=B.getEquipAttrDes(B.getEquipAttrName(S)),C=v.statics[S];y.push([M,D+C,this._simpleinfo.enhance_level>=M])}}
for(_=p=0;_<y.length;++_){var I=y[_][2];this.m_pJsAtrList[_].node.active=!0,this.m_pJsAtrList[_].node.color=I?L.getColorByIndex(7):L.getColorByIndex(5),this.m_pJsAtrList[_].string=y[_][1]+(I?"":P.t("sh_021",{value:y[_][0]})),++p}
if(p<this.m_pJsAtrList.length)
for(_=p;_<this.m_pJsAtrList.length;++_)
this.m_pJsAtrList[_].node.active=!1;this.RefreshRefineAttr()},RefreshRefineAttr:function(){var e=w.getTemperPropAttr(this._simpleinfo.uuid,!0,this._simpleinfo.stars),t=b(e,6),a=t[0],n=t[1],i=t[2];t[3],t[4],t[5];0!=a?(this.m_pRefineAttr.node.active=!0,this.m_pRefineAttr.string=P.t("detail_004",{value:a})):0!=n?(this.m_pRefineAttr.node.active=!0,this.m_pRefineAttr.string=P.t("detail_005",{value:n})):0!=i?(this.m_pRefineAttr.node.active=!0,this.m_pRefineAttr.string=P.t("detail_006",{value:i})):this.m_pRefineAttr.node.active=!1},RefreshEquipAttr:function(){var e=B.getEquipPropAttr(this._simpleinfo.uuid),t=b(e,3),a=t[0],n=t[1],i=t[2],r=[];if(0!=a&&r.push({attrtype:1,value:a}),0!=n&&r.push({attrtype:2,value:n}),0!=i&&r.push({attrtype:3,value:i}),null!=this._simpleinfo.attrEx&&0<this._simpleinfo.attrEx.length)
for(var s=0;s<this._simpleinfo.attrEx.length;++s)
0!=this._simpleinfo.attrEx[s].id&&0!=this._simpleinfo.attrEx[s].num&&r.push({attrtype:this._simpleinfo.attrEx[s].id,value:this._simpleinfo.attrEx[s].num});for(s=0;s<r.length;++s){this.m_pAtrList[s].node.active=!0;var o=B.getEquipAttrDes(r[s].attrtype);this.m_pAtrList[s].string=o+r[s].value}
if(r.length<this.m_pAtrList.length)
for(s=r.length;s<this.m_pAtrList.length;++s)
this.m_pAtrList[s].node.active=!1},InitStarContent:function(){for(var e=0;e<this.m_pStarList.length;++e)
e<this._simpleinfo.stars?this.m_pStarList[e].spriteFrame=this.m_pStarSprFrame[1]:this.m_pStarList[e].spriteFrame=this.m_pStarSprFrame[0],this.m_pStarList[e].node.setPosition(40*e,0)},ShowArrow:function(){if(this.m_pArrow1.setPosition(45,25),this.m_pArrow2.setPosition(45,25),this.m_pArrow1.active=!1,this.m_pArrow2.active=!1,this.m_pArrow1.stopAllActions(),this.m_pArrow2.stopAllActions(),null!=this._herobuffer&&!(null!=this._pos&&4<this._pos)){for(var e=MyPersistDataManager._playerData.bagMap[this._simpleinfo.uuid],t=DonotDestroyManager.GameData.Equips[e.template_id],a=B.getInstance().getEquipAll(),n=0;n<a.length;++n){var i=a[n];if(null==i.heroid){var r=DonotDestroyManager.GameData.Equips[i.template_id];if(r.position==t.position&&r.quality>t.quality){this.m_pArrow1.active=!0,this.m_pArrow1.runAction(cc.repeatForever(cc.sequence(cc.moveBy(.6,cc.p(0,10)),cc.moveBy(.6,cc.p(0,-10)))));break}}}
e.enhance_level<MyPersistDataManager._playerData.level&&(this.m_pArrow2.active=!0,this.m_pArrow2.runAction(cc.repeatForever(cc.sequence(cc.moveBy(.6,cc.p(0,10)),cc.moveBy(.6,cc.p(0,-10))))))}},SetTierAttributeJihuo:function(){var e=this._tiercount-1;e<=0&&(e=0);for(var t=0;t<e;++t)
this.m_pTierAttrList[t].node.color=cc.Color.GREEN;for(t=e;t<this.m_pTierAttrList.length;++t)
this.m_pTierAttrList[t].node.color=cc.Color.GRAY},GetHeroTiersData:function(){this._tiercount=0;var e={},t=B.getEquipTierId(this._simpleinfo.uuid);cc.log(" sáo trang id");for(var a=DonotDestroyManager.GameData.Tiers[t],n=0;n<a.equips.length;++n)
e[a.equips[n]]=!1;if(this._herobuffer)
for(n=0;n<this._herobuffer.equips.length;++n){var i=MyPersistDataManager._playerData.bagMap[this._herobuffer.equips[n]];null!=i&&(null!=e[i.template_id]&&(e[i.template_id]=!0,++this._tiercount))}
return e},SetTierAttributeLab:function(e,t){var a="";switch(e){case 0:a=P.t("sh_013",{value:t.attrs[1].def});break;case 1:a=P.t("sh_014",{value1:t.attrs[2].maxhp,value2:t.attrs[2].atk});break;case 2:a=P.t("sh_015",{value1:t.attrs[2].maxhp,value2:t.attrs[2].atk,value3:t.attrs[3].def})}
return a},SetAttributeLab:function(e,t){switch(this._attrindex){case 0:this.m_pAtrList[0].string=e+t;break;case 1:this.m_pAtrList[1].string=e+t}},getAddUnitAttr:function(e,t){if(0==t.id)
return"";var a={1:P.t("detail_028"),2:P.t("detail_029"),3:P.t("detail_030"),4:P.t("detail_031"),5:P.t("detail_032")},n={1:P.t("detail_033",{value:t.num}),2:P.t("detail_034",{value:t.num}),3:P.t("detail_035",{value:t.num}),4:P.t("detail_036",{value:t.num})};return t[t.id],P.t("detail_037")+a[e]+n[t.id]},Mask_OnClickHandler:function(e){s.playBtnCloseEffect(),this._cb&&this._cb(),this.node.removeFromParent(),this.node.destroy()},onDestroy:function(){this._tiersitemlist=[],this._equipbox=null},RemoveEquip_OnClickHandler:function(e){s.playBtnOpenEffect(),cc.log("Tháo trang bị"+this._pos),n.send_C2SCardTakeOffItem(DonotDestroyManager._gameSocket,this._herobuffer.template_id,this._pos)},Refine_OnClickHandler:function(){if(s.playBtnOpenEffect(),4<this._pos){var e=o.getFuncUnLockInfo(41),t=b(e,2),a=t[0],n=t[1];if(!a)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),n)}else{var i=o.getFuncUnLockInfo(40),r=b(i,2);a=r[0],n=r[1];if(!a)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),n)}
this.node.destroy(),4<this._pos?MyUiManager.Open(MyUiManager.PanelInfo.TreaRefineLayer,{buffer:this._simpleinfo,cb:this._panelindtance.getInstance().RefreshAttributes.bind(this._panelindtance.getInstance()),map:this._raw_assets}):MyUiManager.Open(MyUiManager.PanelInfo.EquipRefineLayer,{buffer:this._simpleinfo,cb:this._panelindtance.getInstance().RefreshAttributes.bind(this._panelindtance.getInstance()),map:this._raw_assets})},ReplaceEquip_OnClickHandler:function(e){s.playBtnOpenEffect(),this._panelindtance.getInstance()._equipview.Equip_OnClickHandler(e,this._pos)},Strengthen_OnClickHandler:function(e){s.playBtnOpenEffect(),this.node.destroy(),4<this._pos?MyUiManager.Open(MyUiManager.PanelInfo.TreasureStrengthen,{buffer:this._simpleinfo,cb:this._panelindtance.getInstance()._equipview.RefreshEquipInfo.bind(this._panelindtance.getInstance()._equipview),map:this._raw_assets,type:this._pos}):MyUiManager.Open(MyUiManager.PanelInfo.EquipStrengthLayer,{equipbuffer:this._simpleinfo,cb:this._panelindtance.getInstance()._equipview.RefreshEquipInfo.bind(this._panelindtance.getInstance()._equipview),map:this._raw_assets})},showGuide:function(){var t=this;i.showGuide("EquipInfoLayer",function(e){if(1==e)
return t.m_btnRefine})}}),cc._RF.pop()},{ColorUtil:"ColorUtil",EquipBufferMgr:"EquipBufferMgr",GuideBufferMgr:"GuideBufferMgr",ItemBufferMgr:"ItemBufferMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",TreasureBufferMgr:"TreasureBufferMgr",UnLockCfgMgr:"UnLockCfgMgr",i18n:"i18n"}],HeroEquipView:[function(e,t,a){"use strict";cc._RF.push(t,"486e0rE1kVLG57J2Idb/3Aq","HeroEquipView");var f=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=e("NetEvent"),i=e("MyEventDispatcher"),g=e("HeroBufferMgr"),l=e("EquipBufferMgr"),h=e("PropHintsEffect"),y=e("i18n"),v=e("ItemBufferMgr"),r=e("MyProtocols"),c=(e("GameUtils"),e("SoundUtil"));cc.Class({extends:cc.Component,properties:{m_pEquipParent:cc.Node,m_pitemparent:cc.Node,m_pEquipStren:cc.Prefab,m_pBannerTips:[cc.SpriteFrame],m_pNum4Atlas:cc.LabelAtlas,_equipitemnode:null,_herodetailview:null,_storehousepre:null,_equipList:[],_curselectequippos:-1,_equipinfopanel:null,_heroinfo:null,_curequipuuid:"",_allequipinfo:[]},onLoad:function(){this._herodetailview=this.node.getComponent("HeroDetailsPanel"),this.S2CCardTakeOnItem_auth_cb_func=this.S2CCardTakeOnItem_auth_cb.bind(this),i.addListener(n.S2CCardTakeOnItem,this.S2CCardTakeOnItem_auth_cb_func),this.S2CCardTakeOffItem_auth_cb_func=this.S2CCardTakeOffItem_auth_cb.bind(this),i.addListener(n.S2CCardTakeOffItem,this.S2CCardTakeOffItem_auth_cb_func),this.S2CEquipEnhanceAll_auth_cb_func=this.S2CEquipEnhanceAll_auth_cb.bind(this),i.addListener(n.S2CEquipEnhanceAll,this.S2CEquipEnhanceAll_auth_cb_func)},InitContent:function(e){this._heroinfo=e,this.CreateEquipItem()},RefreshEquipInfo:function(e){for(var t=0;t<this._equipList.length;++t){var a=this._equipList[t].getComponent("ItemBox");if(MyPersistDataManager._playerData.bagMap[e].template_id==a._itemId)
if(a._itemjsoninfo.position<5){a.ChangeItemLevel(MyPersistDataManager._playerData.bagMap[e].enhance_level);var n=this.CheckCanUplvorStr(e);a.ShowArrow(-1!=n,n)}else
a.ChangeItemLevel("+"+MyPersistDataManager._playerData.bagMap[e].enhance_level)}
this._herodetailview.RefreshAttributes()},RefreshAllEquip:function(){if(!(null==this._allequipinfo||this._allequipinfo.length<=0)){var e=this._allequipinfo[0];this._allequipinfo.splice(0,1);for(var t=0;t<this._equipList.length;++t){var a=this._equipList[t].getComponent("ItemBox");if(a._itemId==MyPersistDataManager._playerData.bagMap[e.itemId].template_id){this.RunEffect(e,a),a.ChangeItemLevel(e.enhance_level);var n=this.CheckCanUplvorStr(e.itemId);return void a.ShowArrow(-1!=n,n)}}}},RunEffect:function(e,t){var l=this,a=[],n=e.enhance_level-parseInt(t.m_pLevel.string);n<=0||(a.push(n),a.push(e.crit_count),this._allequipinfo.length<=0?this.playEquipAutoStrEffect(t.node,a,null,function(){var e=[],t=g.getHeroPropAttr(l._heroinfo.template_id),a=f(t,3),n=a[0],i=a[1],r=a[2],s=n-l._herodetailview._maxhp,o=i-l._herodetailview._atk,c=r-l._herodetailview._def;0!=s&&e.push([1,s]),0!=o&&e.push([2,o]),0!=c&&e.push([3,c]),h.runTextJumpHints(l.node,e,{x:30,y:0},function(){l._herodetailview.RefreshAttributes()},l._herodetailview._raw_assets)}):this.playEquipAutoStrEffect(t.node,a,function(){l.RefreshAllEquip()}))},playEquipAutoStrEffect:function(e,t,a,n){var i=this,r=cc.instantiate(this.m_pEquipStren);e.addChild(r),r.setPosition(0,0);var s=r.getComponent(dragonBones.ArmatureDisplay);s.armature().animation.fadeIn("equipment_strengthening",-1,-1,0,"normal"),s.addEventListener(dragonBones.EventObject.COMPLETE,function(){r.removeFromParent(),r.destroy(),i.showTips(e,t,a,n)},this)},showTips:function(e,a,t,n){var i=this;t&&t(),c.playEquipStrEffect();var r=(new cc.Node).addComponent(cc.Sprite);e.addChild(r.node,1001,1001);var s=new cc.Node;r.node.addChild(s,3,3);var o=1;this.moveTipsBanner(s,o,a[o-1],function e(){if(2<(o+=1))
return t=cc.callFunc(function(){null!=n&&n(),r.node.removeFromParent(),r.node.destroy()}),void r.node.runAction(cc.sequence(cc.delayTime(.4),cc.fadeOut(.3),t));var t;i.moveTipsBanner(s,o,a[o-1],e)})},moveTipsBanner:function(e,t,a,n){var i={1:{x:0,y:0},2:{x:0,y:-45}},r={1:{x:10,y:-5},2:{x:45,y:-5}},s=50+t,o=(new cc.Node).addComponent(cc.Sprite);e.addChild(o.node,s,s),o.spriteFrame=this.m_pBannerTips[t-1],o.node.setCascadeOpacityEnabled(!0),o.node.setPosition(cc.p(i[t].x,i[t].y));var c=(new cc.Node).addComponent(cc.Label);c.font=this.m_pNum4Atlas,c.fontSize=24,c.lineHeight=26,c.string=a,o.node.addChild(c.node,2,2),c.node.setAnchorPoint(.5,.5),c.node.setPosition(cc.p(r[t].x,r[t].y));var l=cc.moveBy(.3,cc.p(0,20*t)).easing(cc.easeExponentialOut()),h=cc.spawn(l,cc.callFunc(n));o.node.runAction(h)},S2CEquipEnhanceAll_auth_cb:function(e){cc.log(" nhất kiện cường hóa trang bị hồi điều "),this._allequipinfo=e.item_infos;for(var t=0;t<e.item_infos.length;++t)
MyPersistDataManager._playerData.bagMap[e.item_infos[t].itemId].enhance_level=e.item_infos[t].enhance_level;MyPersistDataManager._playerData.cardsMaplist[e.card_tpl_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_tpl_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_tpl_id].fight=e.fight,this.RefreshAllEquip(),this._herodetailview._refreshRedPoints()},S2CCardTakeOffItem_auth_cb:function(e){cc.log(" thoát trang bị hồi điều ");var t=MyPersistDataManager._playerData.cardsMaplist[this._heroinfo.template_id];t.fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(t.fight,e.fight),t.fight=e.fight,this._curequipuuid=e.item_uuid,this.RemoveEquip(e.cardId,e.position,e.item_uuid),g.updateHeroAddition1(t)},S2CCardTakeOnItem_auth_cb:function(e){cc.log(" mặc trang bị hồi điều "+this._curselectequippos),this._curequipuuid=e.item_uuid,null!=this._equipinfopanel&&this._equipinfopanel.destroy();var t=MyPersistDataManager._playerData.cardsMaplist[this._heroinfo.template_id];"0"!=t.equips[this._curselectequippos]&&(cc.log(" đây là đang tiến hành thay thao tác "),this._lastEquipuuid=t.equips[this._curselectequippos],MyPersistDataManager._playerData.bagMap[this._lastEquipuuid].heroid=null,l.unBindHeroForEquip(this._lastEquipuuid)),t.fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(t.fight,e.fight),MyPersistDataManager._playerData.bagMap[e.item_uuid].heroid=e.cardId,t.equips[this._curselectequippos]=e.item_uuid,t.fight=e.fight,l.bindHeroForEquip(this._curequipuuid,this._heroinfo.template_id),g.bindHeroEquipUid(t),g.updateHeroAddition1(t),this._herodetailview._refreshRedPoints(),this._herodetailview.UpdateFateView();var a=new cc.Node("sprLightIn").addComponent(cc.Sprite),n=new cc.Node("sprLightOut").addComponent(cc.Sprite),i=new cc.Node("spr3").addComponent(cc.Sprite),r=new cc.Node("spr4").addComponent(cc.Sprite);a.spriteFrame=this._herodetailview.m_pSideList[0],n.spriteFrame=this._herodetailview.m_pSideList[1],i.spriteFrame=this._herodetailview.m_pSideList[1],r.spriteFrame=this._herodetailview.m_pSideList[1],a.node.opacity=0,n.node.opacity=0,a.node.setScale(1.15,1.15),n.node.setScale(1.15,1.15),i.node.setScale(1.15,1.15),r.node.setScale(1.15,1.15),i.node.setPosition(-350.8,26.2),r.node.setPosition(-330.8,16.2),this.m_pitemparent.addChild(i.node),this.m_pitemparent.addChild(r.node),this._equipitemnode=cc.instantiate(this._herodetailview.m_pItemBox),this._equipitemnode.getComponent("ItemBox").ChangeItemInfo(MyPersistDataManager._playerData.bagMap[e.item_uuid].template_id,0),this.m_pitemparent.addChild(this._equipitemnode),this._equipitemnode.setPosition(-310.8,6.2),this._equipitemnode.addChild(a.node,-1),this._equipitemnode.addChild(n.node);var s=cc.callFunc(this.Equipitemdes,this,e.item_uuid),o=cc.sequence(cc.rotateBy(.1,10),cc.fadeTo(.05,150),cc.spawn(cc.fadeIn(.45),cc.moveTo(.45,this._equipList[this._curselectequippos].getPosition()).easing(cc.easeIn(.5)),cc.rotateBy(.45,-10)),cc.callFunc(function(e){e.destroy()}));i.node.opacity=0,r.node.opacity=0,i.node.runAction(o.clone()),r.node.runAction(o.clone()),n.node.runAction(cc.fadeIn(.15));var c=this;this._equipitemnode.runAction(cc.sequence(cc.rotateBy(.15,10),cc.spawn(cc.moveTo(.45,this._equipList[this._curselectequippos].getPosition()).easing(cc.easeIn(.5)),cc.rotateBy(.45,-10)),cc.callFunc(function(){n.node.runAction(cc.fadeOut(.15)),a.node.runAction(cc.sequence(cc.fadeIn(.15),cc.fadeOut(.25),cc.callFunc(function(){c._equipitemnode.removeFromParent()}),s))})))},RemoveEquip:function(e,t,a){null!=this._equipinfopanel&&this._equipinfopanel.destroy(),MyPersistDataManager._playerData.bagMap[a].heroid=null,MyPersistDataManager._playerData.cardsMaplist[this._heroinfo.template_id].equips[t-1]="0",l.unBindHeroForEquip(a);var n=this.Equip_OnClickHandler.bind(this),i=this._equipList[t-1].getComponent("ItemBox");i.SetCanEquipEmptyItem(t-1,1,1,n),i.ShowArrow(!0,0),this.SetChangeLabel(a,!1),g.bindHeroEquipUid(MyPersistDataManager._playerData.cardsMaplist[this._heroinfo.template_id]),this._herodetailview.UpdateFateView()},SetChangeLabel:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],a=this,n=g.getHeroPropAttr(this._heroinfo.template_id),i=f(n,3),r=i[0],s=i[1],o=i[2];this._herodetailview.m_pAttack.string=y.t("hd_001",{value:s}),this._herodetailview.m_pDefen.string=y.t("hd_002",{value:o}),this._herodetailview.m_pLife.string=y.t("hd_003",{value:r});var c=0,l=0,h=0;if(v.isEquipEntity(MyPersistDataManager._playerData.bagMap[e].template_id)){var d=g.getTierPropAttr(this._heroinfo,e),_=f(d,3);c=_[0],l=_[1],h=_[2]}
var u=r-this._herodetailview._maxhp-c,m=s-this._herodetailview._atk-l,p=o-this._herodetailview._def-h;this.playAnimationChangeProp(u,m,p,function(){t&&a.playTiersChangeProp(c,l,h)}),this._herodetailview.RefreshAttributes()},playAnimationChangeProp:function(e,t,a,n){var i=[];0!=e&&i.push([1,e]),0!=t&&i.push([2,t]),0!=a&&i.push([3,a]),h.runTextJumpHints(this.node,i,{x:50,y:50},n,this._herodetailview._raw_assets)},playTiersChangeProp:function(e,t,a){if(v.isEquipEntity(MyPersistDataManager._playerData.bagMap[this._curequipuuid].template_id)){var n=l.getEquipTierId(this._curequipuuid);if((0!=e||0!=t||0!=a)&&0!=n){var i=[];0!=e&&i.push([1,e]),0!=t&&i.push([2,t]),0!=a&&i.push([3,a]),h.runEquipTiersEffect(this.node,i,n,this._herodetailview._raw_assets)}}},CreateChangeLabelItem:function(e){var t=cc.instantiate(this._herodetailview.m_pAttrchangeinfo);this._herodetailview.m_pChangeLabelParent.addChild(t),t.getComponent("AttrChangeLabel").ChangeData(e)},Equipitemdes:function(e,t){null!=this._equipitemnode&&(this._equipitemnode.destroy(),this._equipitemnode=null),this.ChangeAppointEquip(t),this.SetChangeLabel(t),this._herodetailview.m_pMask.active=!1,this._herodetailview.showGuide()},CreateEquipItem:function(){for(var e=this.GetBagEquipList(),t=null,a=0;a<6;++a){var n=null;a<this._equipList.length?n=this._equipList[a]:(n=cc.instantiate(this._herodetailview.m_pItemBox),this.m_pEquipParent.addChild(n),this._equipList.push(n));var i=n.getComponent("ItemBox");if("0"!=this._heroinfo.equips[a]){t=this.EquipInfo_OnClickHandler.bind(this);var r={template_id:MyPersistDataManager._playerData.bagMap[this._heroinfo.equips[a]].template_id,level:MyPersistDataManager._playerData.bagMap[this._heroinfo.equips[a]].enhance_level,uuid:this._heroinfo.equips[a],pos:a+1,cb:t,showlv:!0};if(i.ChangeEquipInfo(r),this.SetEquipTiers(n),a<4){var s=this.CheckCanUplvorStr(this._heroinfo.equips[a]);-1!=s&&i.ShowArrow(!0,s)}}else
this.CheckHasEquip(e,a+1)?(t=this.Equip_OnClickHandler.bind(this),i.SetCanEquipEmptyItem(a,1,1,t),i.ShowArrow(!0,0)):i.SetCanEquipEmptyItem(a,1);n.setPosition(a%2*110,-110*parseInt(a/2))}},CheckCanUplvorStr:function(e){for(var t=MyPersistDataManager._playerData.bagMap[e],a=DonotDestroyManager.GameData.Equips[t.template_id],n=l.getInstance().getEquipAll(),i=0;i<n.length;++i){var r=n[i];if(null==r.heroid){var s=DonotDestroyManager.GameData.Equips[r.template_id];if(s.position==a.position&&s.quality>a.quality)
return 0}}
return t.enhance_level<MyPersistDataManager._playerData.level?1:-1},CheckHasEquip:function(e,t){var a=null;a=4<t?DonotDestroyManager.GameData.Treasures:DonotDestroyManager.GameData.Equips;for(var n=0;n<e.length;++n)
if(null!=a[e[n].template_id]&&a[e[n].template_id].position==t&&null==e[n].heroid)
return!0;return!1},GetBagEquipList:function(){for(var e=[],t=0;t<MyPersistDataManager._playerData.baglist.length;++t){var a=MyPersistDataManager._playerData.baglist[t];3199!=a.template_id&&3198!=a.template_id&&3099!=a.template_id&&3098!=a.template_id&&((v.isEquipEntity(a.template_id)||v.isTreasureEntity(a.template_id))&&e.push(a))}
return e},ChangeAppointEquip:function(e){var t=MyPersistDataManager._playerData.bagMap[e],a=this.EquipInfo_OnClickHandler.bind(this),n=this._equipList[this._curselectequippos].getComponent("ItemBox"),i={template_id:t.template_id,level:t.enhance_level,uuid:e,pos:this._curselectequippos+1,cb:a,showlv:!0};if(n.ChangeEquipInfo(i),this.SetEquipTiers(this._equipList[this._curselectequippos]),this._curselectequippos<4){var r=this.CheckCanUplvorStr(e);-1!=r&&n.ShowArrow(!0,r)}},SetEquipTiers:function(e){var t=e.getComponent("ItemBox");null!=t._itemjsoninfo.tier&&0<t._itemjsoninfo.tier&&(null==t._tiereffect?(t._tiereffect=cc.instantiate(this._herodetailview._tierseffect),t.node.addChild(t._tiereffect)):t._tiereffect.active=!0)},EquipInfo_OnClickHandler:function(e,t){this._equipinfopanel=cc.instantiate(this._herodetailview._raw_assets["Prefab/HeroDetailsPanel/HeroEquipInfo"]),cc.Canvas.instance.node.addChild(this._equipinfopanel);var a=t.pos,n={buffer:MyPersistDataManager._playerData.bagMap[this._heroinfo.equips[a-1]],herobuffer:this._heroinfo,map:this._herodetailview._raw_assets,pos:a,scriptname:"HeroDetailsPanel"};this._equipinfopanel.getComponent("HeroEquipInfo").ChangeData(n)},Equip_OnClickHandler:function(e,a){this._curselectequippos=parseInt(a)-1,cc.log("Mở kho"+a),this._herodetailview.m_pMask.active=!0,null!=this._herodetailview._shortMask_node?this._herodetailview._shortMask_node.active=!0:(this._herodetailview._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._herodetailview._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._herodetailview._shortMask_node));var n=this;null==this._storehousepre?cc.loader.loadRes("Prefab/StoreHousePanel/StoreHousePanel",function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),n._storehousepre=t,n.CreateStoreHousePanel(t,a)}):this.CreateStoreHousePanel(this._storehousepre,a)},EnhanceAll_OnClickHandler:function(){c.playBtnOpenEffect();for(var e=!1,t=0;t<4;++t)"0"!=this._heroinfo.equips[t]&&MyPersistDataManager._playerData.bagMap[this._heroinfo.equips[t]].enhance_level<MyPersistDataManager._playerData.level&&(e=!0);this.node.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){this._herodetailview.showGuide()},this))),e?r.send_C2SEquipEnhanceAll(DonotDestroyManager._gameSocket,this._heroinfo.template_id):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),y.t("detail_038"))},CreateStoreHousePanel:function(e,t){var a=cc.instantiate(e);cc.Canvas.instance.node.addChild(a);var n=a.getComponent("StoreHousePanel");n._equippos=t,n.setParams({additional:this._heroinfo.template_id,additionalcb:this.Closestorehousepanel.bind(this)}),this.node.active=!1,this._herodetailview._shortMask_node.active=!1},Closestorehousepanel:function(){this.node.active=!0,this._herodetailview.m_pMask.active=!1},onDestroy:function(){i.removeListener(n.S2CCardTakeOnItem,this.S2CCardTakeOnItem_auth_cb_func),i.removeListener(n.S2CCardTakeOffItem,this.S2CCardTakeOffItem_auth_cb_func),i.removeListener(n.S2CEquipEnhanceAll,this.S2CEquipEnhanceAll_auth_cb_func),this._storehousepre=null}}),cc._RF.pop()},{EquipBufferMgr:"EquipBufferMgr",GameUtils:"GameUtils",HeroBufferMgr:"HeroBufferMgr",ItemBufferMgr:"ItemBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",PropHintsEffect:"PropHintsEffect",SoundUtil:"SoundUtil",i18n:"i18n"}],HeroFragBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"2d219Rv6ixPx4IMVz+atzfu","HeroFragBufferMgr");var n=function(){this.mHeroFragList=[]};n.prototype.initHeroFragList=function(e){this.mHeroFragList=[];for(var t=0;t<e.length;++t)
e[t].heroFragCfg=DonotDestroyManager.GameData.CardFrags[e[t].template_id],e[t].heroCfg=DonotDestroyManager.GameData.Cards[e[t].heroFragCfg.card_id],e[t].isCanCompose=0,e[t].num>=e[t].heroFragCfg.craft_num&&(e[t].isCanCompose=1),this.mHeroFragList.push(e[t]);this.sortHeroFragList()},n.prototype.sortHeroFragList=function(){1<this.getHeroFragListCnt()&&this.mHeroFragList.sort(function(e,t){var a=e.heroFragCfg,n=t.heroFragCfg;return e.isCanCompose!=t.isCanCompose?t.isCanCompose-e.isCanCompose:a.quality!=n.quality?n.quality-a.quality:e.num!=t.num?t.num-e.num:t.template_id-e.template_id})},n.prototype.getHeroFragList=function(){return this.mHeroFragList},n.prototype.getHeroFragListCnt=function(){return this.mHeroFragList.length},n.prototype.getHeroFragNumByTid=function(e){var t=this.getHeroFragByTempId(e);return t?t.num:0},n.prototype.getHeroFragByIdx=function(e){return this.mHeroFragList[e]},n.prototype.addHeroFragNum=function(e,t){var a=this.getHeroFragByTempId(e);if(null==a)
return 0;a.num+=t;var n=a.num;return 0==a.num&&this.removeHeroFrag(e),n},n.prototype.addFragNumByTid=function(e,t){var a=this.getHeroFragByTempId(e);if(a){if(a.num=t,0==a.num&&this.removeHeroFrag(e),a.num<0)
throw new Error("addFragNumByTid fragEty.num < 0")}else;},n.prototype.removeHeroFrag=function(e){for(var t=0;t<this.mHeroFragList.length;++t)
if(this.mHeroFragList[t].template_id==e)
return void this.mHeroFragList.splice(t,1)},n.prototype.getHeroFragByTempId=function(e){for(var t=0;t<this.mHeroFragList.length;++t)
if(this.mHeroFragList[t].template_id==e)
return this.mHeroFragList[t]},n.prototype.addHeroFrag=function(e){for(var t=0;t<this.mHeroFragList.length;++t)
if(this.mHeroFragList[t].template_id==e.template_id)
return this.mHeroFragList[t].num=e.num,!1;return e.heroFragCfg=DonotDestroyManager.GameData.CardFrags[e.template_id],e.heroCfg=DonotDestroyManager.GameData.Cards[e.heroFragCfg.card_id],this.mHeroFragList.push(e),!0},n.prototype.getHeroFragStateList=function(){for(var e=[],t=[],a=0;a<this.mHeroFragList.length;++a)
this.mHeroFragList[a].num>=this.mHeroFragList[a].heroFragCfg.craft_num?e.push(this.mHeroFragList[a]):t.push(this.mHeroFragList[a]);return[e,t]},n.prototype.setComposeHeroId=function(e){this._Composeid=e},n.prototype.getComposeHeroId=function(){return this._Composeid},t.exports=new n,cc._RF.pop()},{}],HeroIconNameWidget:[function(e,t,a){"use strict";cc._RF.push(t,"6e1a5pPjJhGYKi9CMLfPqBU","HeroIconNameWidget");var s=e("HeroConfigMgr"),o=e("ColorUtil"),n=e("MyEventDispatcher"),i=e("MyUIEvent"),r=e("SoundUtil");cc.Class({extends:cc.Component,properties:{node_selected:cc.Node,spr_heroIcon:cc.Sprite,lab_heroName:cc.Label,default_head_frames:[cc.SpriteFrame],_my_index:0},onLoad:function(){},initData:function(e,t,a){if(this._my_index=e,a){var n=s.find(t);if(null!=n){var i=n.icon,r=this;cc.loader.loadRes("UI/Heros/"+i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r&&cc.isValid(r.spr_heroIcon)&&(r.spr_heroIcon.spriteFrame=t)}),this.lab_heroName.string=n.name,this.lab_heroName.node.color=o.getColorByQuality(n.quality)}}else
this.spr_heroIcon.spriteFrame=this.default_head_frames[t],this.lab_heroName.string="Thường"+(t+1),this.lab_heroName.node.color=cc.Color.WHITE},Click_hanlder:function(e,t){r.playBtnOpenEffect(),this.setSelected(!0),n.dispatchEvent(i.onHeroIconSelect,this.node)},setSelected:function(e){this.node_selected.active=!!e},start:function(){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",HeroConfigMgr:"HeroConfigMgr",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],HeroLvUpLayer:[function(e,t,a){"use strict";cc._RF.push(t,"09bdbKxOkBFb5Lc+z/a5c8z","HeroLvUpLayer");var _=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i="normal",u=e("HeroBufferMgr"),m=e("CardLevelsMgr"),n=e("BattleBufferMgr"),h=e("PropHintsEffect"),r=(e("ResLoaderManager"),e("GameUtils"),e("MyEventDispatcher")),o=e("MyProtocols"),s=e("NetEvent"),c=e("HeroDetailsPanel"),d=e("SoundUtil"),l=e("i18n"),p=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pheroTreaStr1:cc.Prefab,m_pheroTreaStr2:cc.Prefab,m_pherolvup:cc.Prefab,m_pLeftArrow:cc.Button,m_pRightArrow:cc.Button,m_pLeftItemparent:cc.Node,m_pRightItemparent:cc.Node,m_pHeroParent:cc.Node,m_pCurattrcontent:cc.Node,m_pNextattrContent:cc.Node,m_pHeroName:cc.Label,m_pCurlv:cc.Label,m_pCurhp:cc.Label,m_pCuratk:cc.Label,m_pCurdef:cc.Label,m_pNextlv:cc.Label,m_pNexthp:cc.Label,m_pNextatk:cc.Label,m_pNextdef:cc.Label,m_pNeedMoney:cc.Label,m_pExp:cc.Label,m_pgroupspr:cc.Sprite,m_psoldiertype:cc.Sprite,m_pQualityspr:cc.Sprite,m_pCurbar:cc.Sprite,m_pNextbar:cc.Sprite,m_pItemLight:cc.SpriteFrame,btnAutoAdd:cc.Node,btnStrengthen:cc.Node,m_pQualitysprlist:[cc.SpriteFrame],m_pSoldiersprlist:[cc.SpriteFrame],m_pgroupsprlist:[cc.SpriteFrame],_leftitemlist:[],_rightitemlist:[],_herobuffer:null,_herocfg:null,_heroid:-1,_heroLevelMax:-1,_index:-1,_heropre:null,_heroitem:null,_armature:null,_armatureDisplay:null,_rolebasepre:null,_rolebaseitem:null,_rolebasearmature:null,_rolebasearmatureDisplay:null,_iteminfolist:[],_selectitemlist:[],_selectitemmap:{default:{},type:Object},_raw_assets:{default:{},type:Object},_itemlight:null,_costCoin:-1,_cb:null,_oldpre:null,_curlevel:-1,_ischange:!1,_isLongPress:!1,_longPressStep:1,_useTplId:0,_useCount:0},onLoad:function(){this.S2CCardAddLevel_cb_func=this.S2CCardAddLevel_cb.bind(this),r.addListener(s.S2CCardAddLevel,this.S2CCardAddLevel_cb_func)},setParams:function(e){this._herobuffer=e.herobuffer,this._index=e.index,this._herocfg=DonotDestroyManager.GameData.Cards[this._herobuffer.template_id],this._cb=e.cb,this._raw_assets=e.map,this._oldpre=e.pre,this._curlevel=this._herobuffer.level,this._ischange=!1,this.Init(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},S2CCardAddLevel_cb:function(c){var l=this;this._ischange=!0,this._longPressStep=0,this._isLongPress=!1,this._useTplId=0,this._useCount=0,cc.log(" nhận anh hùng thăng cấp tin tức "),d.playHeroStrEffect(),this.RemoveLeftItem(),this.showHeroAnim(.5,function(){if(c.level>l._curlevel){var e=u.getHeroPropAttr(l._herobuffer.template_id,l._curlevel),t=_(e,3),a=t[0],n=t[1],i=t[2],r=u.getHeroPropAttr(l._herobuffer.template_id,c.level),s=_(r,3),o=[[1,s[0]-a],[2,s[1]-n],[3,s[2]-i]];h.runHeroPropEffect(l.node,{elemIdx:1,stateIdx:1,upgradeLv:c.level-l._curlevel},o,null,l._raw_assets),l._curlevel=c.level}}),this.showHeroLevelAnim(1),this.RefreshLeftLayout(),this.GetItemInfoList(),this.CreateRightItem()},Init:function(){this.CreateLeftItem(),this.GetItemInfoList(),this.InitContent(),this.CreateRolebase(),this.CreateHeroModel(),this.CreateRightItem(),this.SetHeroAttr()},InitContent:function(){this.m_pHeroName.string=this._herocfg.name,this.m_psoldiertype.spriteFrame=this.m_pSoldiersprlist[this._herocfg.unit_type-1],this.m_pQualityspr.spriteFrame=this.m_pQualitysprlist[this._herocfg.quality],this.m_pgroupspr.spriteFrame=this.m_pgroupsprlist[this._herocfg.group-1],this._costCoin=0,this.m_pNeedMoney.node.color=cc.Color.GREEN,this.m_pNeedMoney.string="x0",this.m_pExp.string="x0",this.m_pNextattrContent.active=!1;var e=m.getLevelCfg(this._herobuffer.heroCfg.potential,this._herobuffer.level+1);this.m_pCurbar.node.scaleX=1<this._herobuffer.exp/e[0]?1:this._herobuffer.exp/e[0],this.m_pNextbar.node.scaleX=0,this._heroLevelMax=m.getLevelMax(this._herocfg.potential),this._heroLevelMax>MyPersistDataManager._playerData.level&&(this._heroLevelMax=MyPersistDataManager._playerData.level),this.m_pLeftArrow.node.active=!0,this.m_pRightArrow.node.active=!0,this._index<=0&&(this.m_pLeftArrow.node.active=!1),this._index>=c.getInstance()._curHeroList.length-1&&(this.m_pRightArrow.node.active=!1)},IsFormation:function(e){var t=n.getFormationData(1);return null!=t&&(t.a==e||(t.b==e||(t.c==e||(t.d==e||(t.e==e||(t.f==e||(t.g==e||(t.h==e||(t.i==e||t.j==e)))))))))},GetItemInfoList:function(){this._iteminfolist=[];for(var e=DonotDestroyManager.GameData.Common.card_levelup_items_id,t=e.length-1;0<=t;t--)
null!=MyPersistDataManager._playerData.bagMap[e[t]]&&this._iteminfolist.push({template_id:MyPersistDataManager._playerData.bagMap[e[t]].template_id,num:MyPersistDataManager._playerData.bagMap[e[t]].num,type:0});for(t=0;t<MyPersistDataManager._playerData.cardslist.length;++t){var a=MyPersistDataManager._playerData.cardslist[t];a.heroCfg.quality<2&&a.template_id!=this._herobuffer.template_id&&!this.IsFormation(a.template_id)&&this._iteminfolist.push({template_id:a.template_id,num:a.num,type:1})}},CreateRightItem:function(){if(!(null==this._iteminfolist||this._iteminfolist.length<=0)){for(var e=0;e<this._iteminfolist.length;++e){var t=null;if(e<this._rightitemlist.length)
t=this._rightitemlist[e];else{var a=cc.instantiate(this._raw_assets["Prefab/ItemBox/ItemBox"]);this.m_pRightItemparent.addChild(a),t=a.getComponent("ItemBox"),this._rightitemlist.push(t),a.setScale(.85)}
t.node.active=!0,t.ChangeItemInfo(this._iteminfolist[e].template_id,this._iteminfolist[e].num,!0,this.Rightitem_OnClickHandler.bind(this),!1,this.LongPressHanlder.bind(this))}
if(this._iteminfolist.length<this._rightitemlist.length)
for(e=this._iteminfolist.length;e<this._rightitemlist.length;++e)
this._rightitemlist[e].node.active=!1}},AutoAddAction:function(e,t,a){var n=new cc.Node,i=n.addComponent(cc.Sprite);i.spriteFrame=this.m_pItemLight,i.node.setPosition(t,t),i.node.opacity=0,i.node.setTag(101),e.addChild(n),n.runAction(cc.sequence(cc.fadeIn(.1),cc.fadeOut(.2),cc.callFunc(a)))},CreateRolebase:function(){var a=this;null==this._rolebaseitem&&cc.loader.loadRes("Prefab/Heros/rolebase",function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load rolebase success!"),a._rolebasepre=t,a._rolebaseitem=cc.instantiate(t),a.m_pHeroParent.addChild(a._rolebaseitem),a._rolebasearmatureDisplay=a._rolebaseitem.getComponent(dragonBones.ArmatureDisplay),a._rolebasearmature=a._rolebasearmatureDisplay.armature(),a._rolebasearmature.animation.fadeIn("blue",-1,-1,0,i)})},CreateHeroModel:function(){var i=this;cc.loader.loadRes("Prefab/Heros/"+this._herocfg.icon,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load heroprefab success!"),null!=i._heroitem&&(i._heroitem.removeFromParent(),i._heroitem.destroy(),i._heroitem=null),null!=i._heropre&&i._heropre!=t&&i._oldpre!=i._heropre){for(var a=cc.loader.getDependsRecursively(i._heropre),n=0;n<a.length;n++)
cc.loader.release(a[n]);i._heropre=null}
i._heropre=t,i._heroitem=cc.instantiate(t),i.m_pHeroParent.addChild(i._heroitem),null!=i._herocfg.is_spine&&i._herocfg.is_spine||i._heroitem.setScale(-1,1),i._heroitem.getComponent(sp.Skeleton).setAnimation(0,"stand",!0)})},_animationEventHandler:function(e){if(cc.log("animation event!"+e.type),e.type===dragonBones.EventObject.COMPLETE||e.type===dragonBones.EventObject.LOOP_COMPLETE){if(cc.log("animation event complete!"),"entrance"===e.detail.animationState.name){var t=this;setTimeout(function(){t._armature.animation.fadeIn("stand",-1,-1,0,i)},20)}
this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,t._animationEventHandler,this)}},CreateLeftItem:function(){this._selectitemmap={};for(var e=0;e<5;++e){var t=null;if(e<this._leftitemlist.length)
t=this._leftitemlist[e];else{var a=cc.instantiate(this._raw_assets["Prefab/ItemBox/ItemBox"]);this.m_pLeftItemparent.addChild(a),t=a.getComponent("ItemBox"),this._leftitemlist.push(t),this._selectitemmap[e]=null}
t.node.active=!0,t.SetEmptyItem()}},RefreshLeftLayout:function(){this.SetHeroAttr();var e=this.GetAddExpData();this.refreshExpUi(e)},refreshExpUi:function(e){this._herobuffer.exp;var t=u.getHeroUpgradeLV(this._herobuffer.template_id,e),a=_(t,2),n=a[0],i=a[1];if(this._costCoin=u.getHeroStrengthReqCoin(this._herobuffer.template_id,n,i,e),this.m_pNeedMoney.string="x"+this._costCoin,this.m_pExp.string="x"+e,this._costCoin<MyPersistDataManager._playerData.gameMoney?this.m_pNeedMoney.node.color=cc.Color.GREEN:this.m_pNeedMoney.node.color=cc.Color.RED,cc.log("impLV=="+n+" reqExp"+i),n>this._herobuffer.level&&this._heroLevelMax!=this._herobuffer.level){this.m_pNextattrContent.active=!0;var r=u.getHeroPropAttr(this._herobuffer.template_id,n),s=_(r,3),o=s[0],c=s[1],l=s[2];this.m_pNextlv.string=n,this.m_pNextatk.string=c,this.m_pNextdef.string=l,this.m_pNexthp.string=o;var h=e+this._herobuffer.exp-i,d=m.getLevelCfg(this._herobuffer.heroCfg.potential,n+1);this.m_pCurbar.node.scaleX=1<h/d[0]?1:h/d[0],this.m_pNextbar.node.scaleX=1}else{this.m_pNextattrContent.active=!1;d=m.getLevelCfg(this._herobuffer.heroCfg.potential,this._herobuffer.level+1);this.m_pCurbar.node.scaleX=1<this._herobuffer.exp/d[0]?1:this._herobuffer.exp/d[0],this.m_pNextbar.node.scaleX=1<(this._herobuffer.exp+e)/d[0]?1:(this._herobuffer.exp+e)/d[0]}},showHeroAnim:function(e,a){var n=this;setTimeout(function(){var e=cc.instantiate(n.m_pheroTreaStr2);n.m_pHeroParent.addChild(e);var t=e.getComponent(dragonBones.ArmatureDisplay);t.armature().animation.fadeIn("heroTreaStr2",-1,-1,0,i),t.addEventListener(dragonBones.EventObject.COMPLETE,function(){e.removeFromParent(),e.destroy(),null!=a&&a()},n)},e)},showCellAnim:function(e,t){var a=cc.instantiate(this.m_pheroTreaStr1);e.addChild(a);var n=a.getComponent(dragonBones.ArmatureDisplay);n.armature().animation.fadeIn("heroTreaStr1",-1,-1,0,i),n.addEventListener(dragonBones.EventObject.COMPLETE,function(){a.removeFromParent(),a.destroy(),null!=t&&t()},this)},showHeroLevelAnim:function(e){var t=cc.instantiate(this.m_pherolvup);this.m_pCurbar.node.parent.addChild(t),t.setPosition(120,0);var a=t.getComponent(dragonBones.ArmatureDisplay);a.armature().animation.fadeIn("action1",-1,-1,0,i),a.addEventListener(dragonBones.EventObject.COMPLETE,function(){t.removeFromParent(),t.destroy()},this)},SetHeroAttr:function(){var e=u.getHeroPropAttr(this._herobuffer.template_id),t=_(e,3),a=t[0],n=t[1],i=t[2];this.m_pCurlv.string=l.t("detail_007",{value:this._herobuffer.level}),this.m_pCuratk.string=l.t("detail_005",{value:n}),this.m_pCurdef.string=l.t("detail_006",{value:i}),this.m_pCurhp.string=l.t("detail_004",{value:a})},GetAddExpData:function(){for(var e=DonotDestroyManager.GameData.Common.card_levelup_items,t=0,a=Object.keys(this._selectitemmap),n=0;n<a.length;++n){var i=this._selectitemmap[a[n]];if(null!=i)
if(1!=i.type)
null!=e[i.id]&&(t+=e[i.id]);else{var r=DonotDestroyManager.GameData.Cards[i.id];t+=m.getLevelExpTotal(r.potential,MyPersistDataManager._playerData.cardsMaplist[i.id].level)}}
return t},GetItemForId:function(e,t){if(null==e||e.length<=0)
return null;for(var a=0;a<e.length;++a)
if(t==e[a]._itemId)
return e[a];return null},RefreshLeftItemInfo:function(t,e,a){var n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],i=0,r=this;if(n){for(var s=0;s<this._leftitemlist.length;++s)
if(i<e&&this._leftitemlist[s]._isEmpty){this._leftitemlist[s];(function(e){r.AutoAddAction(r._leftitemlist[e].node,0,function(){r._leftitemlist[e].ChangeItemInfo(t,e,!1,r.Leftitem_OnClickHandler.bind(r))})})(s),++i,this._selectitemmap[s]={id:t,type:a}}}else
for(s=0;s<this._leftitemlist.length;++s)
t==this._leftitemlist[s]._itemId&&(this._leftitemlist[s].SetEmptyItem(),++i,this._selectitemmap[s]=null);return i},Rightitem_OnClickHandler:function(e,t){if(d.playBtnOpenEffect(),this._isLongPress&&0<this._useCount){var a=[{template_id:this._useTplId,count:this._useCount}];o.send_C2SCardAddLevel(DonotDestroyManager._gameSocket,this._herobuffer.template_id,[],a)}else if(this._herobuffer.level>=MyPersistDataManager._playerData.level)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),l.t("detail_039"));else{var n=parseInt(t[0]),i=this.GetItemForId(this._rightitemlist,n);if(i._isselect){var r=this.RefreshLeftItemInfo(n,0,i._itemType,!1);i.ChangeItemNum(i._itemCount+r),i.SetSelect(!i._isselect,1)}else{var s=this.RefreshLeftItemInfo(n,i._itemCount,i._itemType,!0);if(0==s)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),l.t("detail_040"));i.ChangeItemNum(i._itemCount-s),this.AutoAddAction(i.node,0,function(){i.SetSelect(!i._isselect,1)})}
this.RefreshLeftLayout()}},Leftitem_OnClickHandler:function(e,t){d.playBtnOpenEffect();var a=parseInt(t[0]),n=parseInt(t[1]);this._leftitemlist[n].SetEmptyItem(),this._selectitemmap[n]=null;var i=this.GetItemForId(this._rightitemlist,a);i.ChangeItemNum(i._itemCount+1),null==this.GetItemForId(this._leftitemlist,a)&&i.SetSelect(!1,1),this.RefreshLeftLayout()},Mask_OnClickHandler:function(e){MyUiManager.Back(),d.playBtnCloseEffect(),null!=this._cb&&this._cb(this._ischange,this._index)},UpLv_OnClickHandler:function(e){if(d.playBtnOpenEffect(),MyPersistDataManager._playerData.gameMoney<this._costCoin)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),l.t("129"));else{for(var t=[],a=[],n=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return a;return-1},i=Object.keys(this._selectitemmap),r=0;r<i.length;++r){var s;if(null!=this._selectitemmap[i[r]]&&0<this._selectitemmap[i[r]].id)
if(1!=this._selectitemmap[i[r]].type)
-1!=(s=n(t,this._selectitemmap[i[r]].id))?t[s].count+=1:t.push({template_id:this._selectitemmap[i[r]].id,count:1});else-1!=(s=n(a,this._selectitemmap[i[r]].id))?a[s].count+=1:a.push({template_id:this._selectitemmap[i[r]].id,count:1})}
(null==a||a.length<=0)&&(null==t||t.length<=0)?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),l.t("detail_041")):o.send_C2SCardAddLevel(DonotDestroyManager._gameSocket,this._herobuffer.template_id,a,t)}},SwitchHero:function(e){this._ischange=!0,this._herobuffer=e.herobuffer,this._index=e.index,this._herocfg=DonotDestroyManager.GameData.Cards[this._herobuffer.template_id],this._cb=e.cb,this._oldpre=e.pre,this._curlevel=this._herobuffer.level,this.Init()},SwitchHero_OnClickHandler:function(e,t){d.playPageEffect(),0!=parseInt(t)?this.SwitchHero({pre:this._oldpre,herobuffer:c.getInstance()._curHeroList[this._index+1],index:this._index+1,cb:c.getInstance().RefreshPanelInfo.bind(c.getInstance())}):this.SwitchHero({pre:this._oldpre,herobuffer:c.getInstance()._curHeroList[this._index-1],index:this._index-1,cb:c.getInstance().RefreshPanelInfo.bind(c.getInstance())})},RemoveLeftItem:function(){for(var t=this,e=0;e<this._leftitemlist.length;++e)
this._leftitemlist[e]._isEmpty||(function(e){t.showCellAnim(t._leftitemlist[e].node,function(){t._leftitemlist[e].SetEmptyItem()})}
(e),this._selectitemmap[e]=null)},GetEmptyItemCnt:function(){for(var e=0,t=0;t<this._leftitemlist.length;++t)
this._leftitemlist[t]._isEmpty&&++e;return e},Additem_OnClickHandler:function(e){if(d.playBtnOpenEffect(),this._herobuffer.level>=MyPersistDataManager._playerData.level)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),l.t("detail_039"));else{if(null==this._iteminfolist||this._iteminfolist.length<=0)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),l.t("detail_042"));else{var t=this.GetEmptyItemCnt();if(!(t<=0)){for(var a=[],n=t,i=this,r=0;r<this._rightitemlist.length&&(this._rightitemlist[r]._itemCount<=0||(this._rightitemlist[r]._itemCount<n?(a.push([this._rightitemlist[r]._itemId,this._rightitemlist[r]._itemCount,this._rightitemlist[r]._itemType]),n-=this._rightitemlist[r]._itemCount,this._rightitemlist[r].ChangeItemNum(0)):(a.push([this._rightitemlist[r]._itemId,n,this._rightitemlist[r]._itemType]),this._rightitemlist[r].ChangeItemNum(this._rightitemlist[r]._itemCount-n),n=0),function(e){i.AutoAddAction(i._rightitemlist[e].node,0,function(){i._rightitemlist[e].SetSelect(!0,1)})}
(r),!(n<=0)));++r);if(!(null==a||a.length<=0)){var s=0;for(r=0;r<this._leftitemlist.length;++r)
this._leftitemlist[r]._isEmpty&&function(e){i.AutoAddAction(i._leftitemlist[e].node,0,function(){s>=a.length||(i._leftitemlist[e].ChangeItemInfo(a[s][0],e,!1,i.Leftitem_OnClickHandler.bind(i)),--a[s][1],i._selectitemmap[e]={id:a[s][0],type:a[s][2]},a[s][1]<=0&&s++,s>=a.length&&i.RefreshLeftLayout())})}
(r);this.node.runAction(cc.sequence(cc.delayTime(.35),cc.callFunc(function(){this.showGuide()},this)))}}}}},onDestroy:function(){null!=this._armatureDisplay&&this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),r.removeListener(s.S2CCardAddLevel,this.S2CCardAddLevel_cb_func)},showGuide:function(){var t=this;p.showGuide("HeroStrengthLayer",function(e){return 1==e?t.btnAutoAdd:2==e?t.btnStrengthen:void 0})},LongPressHanlder:function(e,t){var a=t._itemId;if(2==e)
return t.ChangeItemNum(MyPersistDataManager._playerData.bagMap[a].num),this.refreshExpUi(0),this._isLongPress=!1,this._longPressStep=0,this._useTplId=0,void(this._useCount=0);if(-1!=DonotDestroyManager.GameData.Common.card_levelup_items_id.indexOf(a)){this._isLongPress=!0,this._useTplId=a,this._longPressStep<30&&(this._longPressStep+=.2),this._useCount+=parseInt(this._longPressStep);var n=DonotDestroyManager.GameData.Common.card_levelup_items[this._useTplId];this._useCount>=MyPersistDataManager._playerData.bagMap[a].num&&(this._useCount=MyPersistDataManager._playerData.bagMap[a].num);var i=u.getUpgradeTotalExp(this._herobuffer.template_id);n*this._useCount>i&&(this._useCount=parseInt(i/n)+1),MyPersistDataManager._playerData.gameMoney<n*this._useCount&&(this._useCount=parseInt(MyPersistDataManager._playerData.gameMoney/n),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),l.t("129"))),t.ChangeItemNum(MyPersistDataManager._playerData.bagMap[a].num-this._useCount),this.refreshExpUi(n*this._useCount),cc.log("use count:"+this._useCount+";unit exp:"+n),cc.log("sum exp:"+n*this._useCount)}}}),cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",CardLevelsMgr:"CardLevelsMgr",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",HeroBufferMgr:"HeroBufferMgr",HeroDetailsPanel:"HeroDetailsPanel",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",PropHintsEffect:"PropHintsEffect",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil",i18n:"i18n"}],HeroRuneLayer:[function(e,t,a){"use strict";cc._RF.push(t,"6c0d4VSKdNGC6/L67iXydnz","HeroRuneLayer");var c=e("MyProtocols"),l=(e("MailPanelManager"),e("i18n")),h=e("SoundUtil"),n=e("MyEventDispatcher"),i=e("NetEvent"),r=e("MyUIEvent"),o=e("RunesBufferMgr"),s=e("ColorUtil"),d=e("RuneUtil"),_=e("GuideBufferMgr"),u=e("HeroBufferMgr"),m=cc.Class({extends:cc.Component,properties:{_hero_template:null,_hero_entity:null,_unlock_rune_index:0,pre_rune_item:cc.Prefab,pre_rune_item_bag:cc.Prefab,node_fazheng:cc.Node,node_hammer:cc.Node,rune_container:cc.Node,choosen_border:cc.Node,node_left_rune_parent:cc.Node,lab_cooper_cost:cc.Label,lab_hero_name:cc.Label,lab_rune_effect:cc.Label,btnBack:cc.Node,btnPutup:cc.Node,_lock_rune_list:[],_rune_item_pool:cc.NodePool,_step1_rune_index:-1,_step2_rune_template:-1},statics:{instance:null},onLoad:function(){(m.instance=this)._rune_item_pool=new cc.NodePool("RuneItem"),this.lab_cooper_cost.string="0",this.S2CRuneUnlock_cb_func=this.S2CRuneUnlock_cb.bind(this),n.addListener(i.S2CRuneUnlock,this.S2CRuneUnlock_cb_func),this.S2CRunePutup_cb_func=this.S2CRunePutup_cb.bind(this),n.addListener(i.S2CRunePutup,this.S2CRunePutup_cb_func),this.onAniHammerFinish_cb_func=this.onAniHammerFinish_cb.bind(this),n.addListener(r.onAniHammerFinish,this.onAniHammerFinish_cb_func),this.onRuneItemSelect_cb_func=this.onRuneItemSelect_cb.bind(this),n.addListener(r.onRuneItemSelect,this.onRuneItemSelect_cb_func),this.onRuneItemBagSelect_cb_func=this.onRuneItemBagSelect_cb.bind(this),n.addListener(r.onRuneItemBagSelect,this.onRuneItemBagSelect_cb_func),this.onRuneTabSelect_cb_func=this.onRuneTabSelect_cb.bind(this),n.addListener(r.onRuneTabSelect,this.onRuneTabSelect_cb_func)},onRuneTabSelect_cb:function(e){this.initRuneBagList(e)},S2CRunePutup_cb:function(e){this._hero_entity.runePutup[e.pos_index]=e.rune_id,this._hero_entity.runeLevel[e.pos_index]=e.rune_level,MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight,u.updateHeroUnitNum(MyPersistDataManager._playerData.cardsMaplist[e.card_id]),h.playRobTreaEffect(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,150),l.t("rune005"),1e3);var t=DonotDestroyManager.GameData.Runes[this._step2_rune_template];this.initRuneBagList(t.func),null!=e.back_items&&0<e.back_items.length&&MyUiManager.Open(MyUiManager.PanelInfo.RuneBackPanel,e.back_items),this.refreshRuneEffect()},refreshRuneEffect:function(){for(var e={},t=0;t<this._hero_entity.runePutup.length;t++){var a=this._hero_entity.runePutup[t],n=this._hero_entity.runeLevel[t];0!=a&&this.updateRuneEffect(e,a,n)}
var i=d.getRuneDesc(e);this.lab_rune_effect.string=i},updateRuneEffect:function(e,t,a){for(var n=DonotDestroyManager.GameData.Runes[t],i=DonotDestroyManager.GameData.RuneLevel[n.quality],r=0<a?i.add_on[a-1]/100:0,s=n.addon_type.split("-"),o=0;o<s.length;o++){var c=parseInt(s[o]),l=d.getRuneAttriNameByAddonId(c);e[l]=null!=e[l]?e[l]+parseInt(n[l]*(1+r)):parseInt(n[l]*(1+r))}},onRuneItemBagSelect_cb:function(e){this._step2_rune_template=e[1],this.choosen_border.active=!0,this.choosen_border.parent=e[0],this.choosen_border.setLocalZOrder(-1),this.choosen_border.setPosition(0,0),this.refreshCooperCost()},refreshCooperCost:function(){var e=DonotDestroyManager.GameData.Runes[this._step2_rune_template],t=DonotDestroyManager.GameData.Common.rune_putup_cost[e.quality];this.lab_cooper_cost.string=t},onRuneItemSelect_cb:function(e){this._step1_rune_index=e,this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},initRuneBagList:function(e){var t=o.getRuneList(e,-1);t.sort(function(e,t){var a=DonotDestroyManager.GameData.Runes[e.template_id],n=DonotDestroyManager.GameData.Runes[t.template_id];return a.quality!=n.quality?n.quality-a.quality:t.template_id-e.template_id}),this.choosen_border.active=!1,this.choosen_border.parent=this.node;var a=this.rune_container.children;if(null!=a&&0<a.length)
for(var n=a.length-1;0<=n;n--)
this._rune_item_pool.put(a[n]);for(var i=0;i<t.length;i++){var r=t[i],s=this._rune_item_pool.get();null==s&&(s=cc.instantiate(this.pre_rune_item_bag)),this.rune_container.addChild(s),s.getComponent("RuneItemBag").changeData(r.template_id,r.num,!0),0==i&&(this._step2_rune_template=r.template_id,this.choosen_border.active=!0,this.choosen_border.parent=s,this.choosen_border.setLocalZOrder(-1),this.choosen_border.setPosition(0,0),this.refreshCooperCost())}
this.rune_container.getComponent(cc.Layout).updateLayout()},recycleRuneBagItems:function(){this.choosen_border.active=!1,this.choosen_border.parent=this.node;var e=this.rune_container.children;if(null!=e&&0<e.length)
for(var t=e.length-1;0<=t;t--)
this._rune_item_pool.put(e[t])},onAniHammerFinish_cb:function(){this._lock_rune_list[this._unlock_rune_index-2].getComponent("RuneItem").unlockRune()},S2CRuneUnlock_cb:function(e){var t=e.pos_index;this._hero_entity.runeUnlock.push(t),this._unlock_rune_index=t,this.node_hammer.setLocalZOrder(1e3);var a=this._lock_rune_list[t-2];this.node_hammer.setPosition(a.x+72,a.y+11),this.node_hammer.getComponent(cc.Animation).play()},setParams:function(e){this._hero_template=e.hero_template,this._hero_entity=e.hero_entity,this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},refreshUi:function(){for(var e=0;e<this.node_left_rune_parent.children.length;e++)
this.node_left_rune_parent.children[e].getComponent("RuneItem").refreshLevel(this._hero_entity.runeLevel[e]);n.dispatchEvent(r.onRuneTabSelect,1),this.refreshRuneEffect()},start:function(){this._lock_rune_list=[];var e=this.node_fazheng.position,t=79*Math.sqrt(3);this.createRuneItem(e.x-79,e.y+t,0),this.createRuneItem(e.x-158,e.y,1);var a=this.createRuneItem(e.x-79,e.y-t,2);this._lock_rune_list.push(a),a=this.createRuneItem(e.x+79,e.y+t,3),this._lock_rune_list.push(a),a=this.createRuneItem(e.x+158,e.y,4),this._lock_rune_list.push(a),a=this.createRuneItem(e.x+79,e.y-t,5),this._lock_rune_list.push(a),this.lab_hero_name.string=this._hero_template.name,this.lab_hero_name.node.color=s.getColorByQuality(this._hero_template.quality),n.dispatchEvent(r.onRuneTabSelect,1),this.refreshRuneEffect()},createRuneItem:function(e,t,a){var n=cc.instantiate(this.pre_rune_item);n.setPosition(e,t),this.node_left_rune_parent.addChild(n);var i=!0;return 1<a&&-1==this._hero_entity.runeUnlock.indexOf(a)&&(i=!1),n.getComponent("RuneItem").changeData(a,i,this._hero_entity.runePutup[a],this._hero_entity.runeLevel[a],this._hero_entity),n},showRuneHelpPanel:function(e,t){h.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.RuneHelpLayer,{})},clickRunePutupHanlder:function(e,t){if(this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this))),h.playBtnOpenEffect(),-1!=this._step1_rune_index)
if(-1!=this._step2_rune_template){var a=this.node_left_rune_parent.children[this._step1_rune_index],n=a.getComponent("RuneItem")._rune_tpl_id,i=a.getComponent("RuneItem")._rune_level;if(0<n){var r=DonotDestroyManager.GameData.Runes[n].name+"+"+i,s=DonotDestroyManager.GameData.Runes[this._step2_rune_template].name;this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer);var o=this;this._alert_layer.getComponent("AlertLayerManager").InitTwoBtnContent("Có đổi 【" +r+ "】thành\n【" +s+ "】?",function(){c.send_C2SRunePutup(DonotDestroyManager._gameSocket,o._hero_entity.template_id,o._step1_rune_index,o._step2_rune_template),o._alert_layer.destroy(),o._alert_layer=null},function(){o._alert_layer.destroy(),o._alert_layer=null},!0)}else
c.send_C2SRunePutup(DonotDestroyManager._gameSocket,this._hero_entity.template_id,this._step1_rune_index,this._step2_rune_template)}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,150),l.t("rune004"));else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,150),l.t("rune003"))},onDestroy:function(){m.instance=null,this._lock_rune_list=[],this._rune_item_pool.clear(),MyUiManager.CloseRuneTipsWidget(),null!=this._alert_layer&&(this._alert_layer.destroy(),this._alert_layer=null),n.removeListener(i.S2CRuneUnlock,this.S2CRuneUnlock_cb_func),n.removeListener(i.S2CRunePutup,this.S2CRunePutup_cb_func),n.removeListener(r.onAniHammerFinish,this.onAniHammerFinish_cb_func),n.removeListener(r.onRuneItemSelect,this.onRuneItemSelect_cb_func),n.removeListener(r.onRuneItemBagSelect,this.onRuneItemBagSelect_cb_func),n.removeListener(r.onRuneTabSelect,this.onRuneTabSelect_cb_func)},goBack:function(){h.playBtnCloseEffect(),MyUiManager.Back()},showGuide:function(){var t=this;_.showGuide("HeroRuneLayer",function(e){return 1==e?t.node_left_rune_parent.children[0]:2==e?t.btnPutup:3==e?t.btnBack:void 0})}});cc._RF.pop()},{ColorUtil:"ColorUtil",GuideBufferMgr:"GuideBufferMgr",HeroBufferMgr:"HeroBufferMgr",MailPanelManager:"MailPanelManager",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",RuneUtil:"RuneUtil",RunesBufferMgr:"RunesBufferMgr",SoundUtil:"SoundUtil",i18n:"i18n"}],HeroShowPanel:[function(e,t,a){"use strict";cc._RF.push(t,"886ccy+JV5DOqLykqnDZ4ex","HeroShowPanel");var l=e("ResLoaderManager"),d=e("ColorUtil"),n=(e("MyProtocols"),e("GuideBufferMgr"),e("RecruitAnimCtrl")),i=e("GetTenHeroPanel"),s=e("SoundUtil");cc.Class({extends:cc.Component,properties:{BgSprite:cc.Sprite,QualityLightNode:cc.Node,HeroNode:cc.Node,AnimNodeParent:cc.Node,heroLabelNode:cc.Node,heroNameFlash:cc.Node,heroInfomationNode:cc.Node,InfoNodeList:[cc.Node],HeroDes:cc.Label,BtnsNode:cc.Node,TenHeroBackBtn:cc.Node,_herojsoninfo:null,_heroItem:null,_raw_assets:Map,_recruitType:0},onLoad:function(){this._raw_assets=new Map},setParams:function(e){this._card_tpl_id=e.card_tpl_id,this.DoGetHeroAnim(this._card_tpl_id,3)},DoGetHeroAnim:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];this._recruitType=t,this._herojsoninfo=DonotDestroyManager.GameData.Cards[e];var n=this._herojsoninfo.quality,i=this;cc.loader.loadRes("UI/Recruit/recruitBg"+n,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=i&&cc.isValid(i.node)&&(i.BgSprite.spriteFrame=t)});this.BgSprite.node.opacity=1;var r=cc.fadeIn(.15).easing(cc.easeIn(.2));this.BgSprite.node.runAction(r),a&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),this._shortMask_node.getComponent("ShortLoadingMask").setText("141"),cc.Canvas.instance.node.addChild(this._shortMask_node)),this._raw_assets.set("Prefab/RecruitPanel/QualityLight/QualityLight"+n,cc.Prefab),this._raw_assets.set("Prefab/Heros/"+this._herojsoninfo.icon,cc.Prefab),this._raw_assets.set("UI/Heros/soldierType"+this._herojsoninfo.unit_type,cc.SpriteFrame),this._raw_assets.set("UI/Heros/group"+this._herojsoninfo.group,cc.SpriteFrame);var s=[];this._raw_assets.forEach(function(e,t){s.push(new Array(t,e))});var o=this._loadProgressCb.bind(this),c=this._loadFinishCb.bind(this);l.asyncLoadAll(s,o,c)},_loadProgressCb:function(){},_loadFinishCb:function(e,t){var a=this;t.forEach(function(e){a._raw_assets.set(e[0],e[1]),e=null}),null!=this._shortMask_node&&(this._shortMask_node.destroy(),this._shortMask_node=null),this.CreatHeroFunc()},CreatHeroFunc:function(){this.AnimNodeParent.active=!0;var e=cc.instantiate(this._raw_assets.get("Prefab/RecruitPanel/QualityLight/QualityLight"+this._herojsoninfo.quality));this.QualityLightNode.addChild(e),e.setPosition(0,0);var t=[];t=2==this._herojsoninfo.unit_type?[1.08,1.35]:[1.08,1.6],this._heroItem=cc.instantiate(this._raw_assets.get("Prefab/Heros/"+this._herojsoninfo.icon)),this.HeroNode.addChild(this._heroItem),this._heroItem.setPosition(0,0),this._heroItem.scale=t[0];var a=cc.callFunc(function(){this.heroLabelNode.active=!0;var e=this.heroLabelNode.children;e[1].getComponent(cc.Sprite).spriteFrame=this._raw_assets.get("UI/Heros/soldierType"+this._herojsoninfo.unit_type),e[2].getComponent(cc.Sprite).spriteFrame=this._raw_assets.get("UI/Heros/group"+this._herojsoninfo.group),e[3].getComponent(cc.Label).string=this._herojsoninfo.name,e[3].color=d.getColorByQuality(this._herojsoninfo.quality),e[3].scale=8;var t=cc.callFunc(function(){this.heroNameFlash.active=!0},this),a=cc.scaleTo(.15,1).easing(cc.easeIn(.2));a=cc.sequence(a,t),e[3].runAction(a)},this),n=cc.scaleTo(.2,t[1]);n=cc.sequence(n,a),this._heroItem.runAction(n);var i=null!=this._herojsoninfo.is_spine&&this._herojsoninfo.is_spine?this._herojsoninfo.skills[0][1]:"entrance",r=this._heroItem.getComponent(sp.Skeleton);r.setCompleteListener(this._heroEntranceComplete.bind(this)),r.setAnimation(0,i,!1),r.addAnimation(0,"stand",!0,0),3<=this._herojsoninfo.quality&&this.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){var e=this._herojsoninfo.sound?this._herojsoninfo.sound:this._herojsoninfo.icon;s.playHeroSound(e)},this)))},_heroEntranceComplete:function(e){var t=e.animation?e.animation.name:"";cc.log("animation event:"+t),"entrance"!=t&&"skill1"!=t&&"skill2"!=t&&"skill3"!=t&&"skill3_1"!=t&&"skill4"!=t||(this.heroInfomationNode.active=!0,this._showInfo())},_showInfo:function(){var e=this._herojsoninfo.des;this.HeroDes.string=e;var t=this._herojsoninfo.potential;this.InfoNodeList[1].children[1].getComponent(cc.Label).string=t;for(var a=this._herojsoninfo.skills,n=0;n<2;n++)
if(null!=a[n]){var i=a[n][0],r=DonotDestroyManager.GameData.Skills[i];this.InfoNodeList[2].children[n+1].children[0].getComponent(cc.Label).string=r.name,this.InfoNodeList[2].children[n+1].children[0].color=d.getColorByQuality(r.quality),this.InfoNodeList[2].children[n+1].children[1].getComponent(cc.Label).string=r.des}
var s=cc.callFunc(function(){this.InfoNodeList[0].children[1].runAction(cc.fadeIn(.5))},this);s=cc.sequence(cc.fadeIn(.2),s);var o=cc.callFunc(function(){this.InfoNodeList[1].children[1].runAction(cc.fadeIn(.5))},this);o=cc.sequence(cc.fadeIn(.2),o);var c=cc.callFunc(function(){var e=cc.sequence(cc.fadeIn(.4),cc.callFunc(function(){this.InfoNodeList[2].children[2].runAction(cc.fadeIn(.3))},this));this.InfoNodeList[2].children[1].runAction(e)},this);if(c=cc.sequence(cc.fadeIn(.2),c),this.InfoNodeList[0].runAction(s),this.InfoNodeList[1].runAction(o),this.InfoNodeList[2].runAction(c),this.InfoNodeList[3].runAction(cc.sequence(cc.delayTime(.2),cc.fadeIn(.2))),3!=this._recruitType&&4!=this._recruitType){var l=this;this.BtnsNode.active=!0,this.BtnsNode.opacity=0;var h=cc.sequence(cc.delayTime(1),cc.fadeIn(.2),cc.callFunc(function(){l.showGuide()}));this.BtnsNode.runAction(h)}else{this.TenHeroBackBtn.active=!0,this.TenHeroBackBtn.opacity=0;h=cc.sequence(cc.delayTime(.5),cc.fadeIn(.2));this.TenHeroBackBtn.runAction(h)}},closeSelf:function(){s.playBtnCloseEffect(),MyUiManager.Back()},fadeOut:function(){var e=cc.callFunc(function(){3==this._recruitType?(this._heroItem.removeFromParent(),i.getInstance().getPurpleHero(this._heroItem)):4==this._recruitType||n.getInstance().PlayPanelFadeInAnim()},this),t=cc.callFunc(function(){this.node.removeFromParent(),this.node.destroy()},this),a=cc.sequence(e,cc.fadeOut(.3),t);this.node.runAction(a)},onDestroy:function(){null!=this._raw_assets&&(this._raw_assets.clear(),this._raw_assets=null)},clickHanlder_addons:function(e,t){s.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.HeroAddonWidget,{hero_id:this._card_tpl_id})}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GetTenHeroPanel:"GetTenHeroPanel",GuideBufferMgr:"GuideBufferMgr",MyProtocols:"MyProtocols",RecruitAnimCtrl:"RecruitAnimCtrl",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil"}],HeroUnitsView:[function(e,t,a){"use strict";cc._RF.push(t,"f2aa89/x4RHAK40Nf7AZ4dV","HeroUnitsView");var s=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=(e("UnitConfigMgr"),e("NetEvent")),i=e("MyEventDispatcher"),r=e("UnitBufferMgr"),o=e("ColorUtil"),c=e("SoundUtil"),l=e("i18n"),h=e("UnLockCfgMgr");cc.Class({extends:cc.Component,properties:{m_pSoldierParent:cc.Node,m_pSoldierName:cc.Label,m_pBtnLab:cc.Label,m_pUnitEquipitem:cc.Node,m_pEquipparent:cc.Node,m_pItemparent:cc.Node,m_pUnitEquipMask:cc.SpriteFrame,m_punitUpgradeShine:cc.SpriteFrame,m_punitUpgradeEffect:cc.Prefab,_herodetailview:null,_soldieritem:null,_soldierPrefabPath:null,_soldierpre:null,_soldierjson:null,_soldieritemlist:[],_soldierpos:[],_equipitemlist:[],_unittype:-1,_unitgrade:-1,_curlevel:-1,_createcount:-1,_equipnode:null,_armyinfo:null,unitAllTexture:cc.SpriteFrame},onLoad:function(){this._herodetailview=this.node.getComponent("HeroDetailsPanel"),this._soldierjson=DonotDestroyManager.GameData.Units,this._soldierpos=new Array(cc.p(0,0),cc.p(-70,5),cc.p(-25,35),cc.p(-45,-30),cc.p(45,30),cc.p(20,-40),cc.p(65,-10)),this.S2CCardEquipUnit_auth_cb_func=this.S2CCardEquipUnit_auth_cb.bind(this),i.addListener(n.S2CCardEquipUnit,this.S2CCardEquipUnit_auth_cb_func),this.S2CCardUpgradeUnit_auth_cb_func=this.S2CCardUpgradeUnit_auth_cb.bind(this),i.addListener(n.S2CCardUpgradeUnit,this.S2CCardUpgradeUnit_auth_cb_func)},S2CCardEquipUnit_auth_cb:function(e){cc.log(" cấp tiểu binh mặc trang bị "),MyPersistDataManager._playerData.cardsMaplist[e.card_id].unitEquips[e.unit_position-1]=1e3,MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight,this.runEquipAction(e.unit_position-1),MyUiManager.Back(),this.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){this._herodetailview.showGuide()},this))),this._herodetailview._refreshRedPoints()},S2CCardUpgradeUnit_auth_cb:function(e){cc.log(" tiểu binh thăng giai tin tức nghe lén "),c.playSoldStageEffect(),this._herodetailview.m_pMask.active=!0,MyPersistDataManager._playerData.cardsMaplist[e.card_id].unitGrade=e.unit_grade,MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight;for(var t=0;t<MyPersistDataManager._playerData.cardsMaplist[e.card_id].unitEquips.length;++t)
MyPersistDataManager._playerData.cardsMaplist[e.card_id].unitEquips[t]=0;var a=MyPersistDataManager._playerData.cardsMaplist[e.card_id];this._armyinfo=r.getArmyInfo(a),this._unitgrade=this._armyinfo.grade,this._unittype=this._armyinfo._type,this._curlevel=this._armyinfo.level,MyUiManager.Back(),this.runUpgradeAction(),this.node.runAction(cc.sequence(cc.delayTime(.9),cc.callFunc(function(){this._herodetailview.showGuide()},this)))},InitContent:function(e){this._armyinfo=r.getArmyInfo(e),this._curlevel=this._armyinfo.level,this._unitgrade==this._armyinfo.grade&&this._unittype==this._armyinfo._type||this.CreateAllSoldier(this._armyinfo._type,this._armyinfo.grade),this._unitgrade=this._armyinfo.grade,this._unittype=this._armyinfo._type,this.CreateUnitEquipItem(),this.m_pSoldierName.string=this.GetSoldierName(),this.m_pSoldierName.node.color=o.getColorByQuality(this._armyinfo.quality),this._curlevel>=DonotDestroyManager.GameData.Units.cost[this._unittype-1][this._unitgrade-1].max_level?this.m_pBtnLab.string=l.t("detail_043"):this.m_pBtnLab.string=l.t("detail_044")},runEquipAction:function(e){var t=new cc.Node("sprLightIn").addComponent(cc.Sprite),a=new cc.Node("sprLightOut").addComponent(cc.Sprite),n=new cc.Node("sprOutTail1").addComponent(cc.Sprite),i=new cc.Node("sprOutTail2").addComponent(cc.Sprite);t.spriteFrame=this._herodetailview.m_pSideList[0],a.spriteFrame=this._herodetailview.m_pSideList[1],n.spriteFrame=this._herodetailview.m_pSideList[1],i.spriteFrame=this._herodetailview.m_pSideList[1],this._equipnode=cc.instantiate(this._herodetailview.m_pItemBox);var r=this._equipitemlist[e].getComponent("UnitEquipsItem");this._equipnode.getComponent("ItemBox").ChangeItemInfo(r._equipid,0);var s=cc.p(50,457.8);n.node.setPosition(s.x-40,s.y+20),i.node.setPosition(s.x-20,s.y+10),t.node.opacity=0,this._equipnode.addChild(t.node),a.node.opacity=0,this._equipnode.addChild(a.node),this.m_pItemparent.addChild(n.node),this.m_pItemparent.addChild(i.node),this.m_pItemparent.addChild(this._equipnode),this._equipnode.setPosition(s);var o=this._equipitemlist[e].getPosition(),c=cc.sequence(cc.rotateBy(.1,10),cc.fadeTo(.05,100),cc.spawn(cc.fadeIn(.45),cc.moveTo(.45,o).easing(cc.easeIn(.5)),cc.rotateBy(.45,-10)),cc.removeSelf());n.node.opacity=0,i.node.opacity=0,n.node.runAction(c.clone()),i.node.runAction(c.clone()),a.node.runAction(cc.fadeIn(.15));var l=this,h=cc.callFunc(this.CreateUnitEquipItem,this),d=cc.sequence(cc.rotateBy(.15,10),cc.spawn(cc.moveTo(.45,o).easing(cc.easeIn(.45)),cc.rotateBy(.45,-10),cc.callFunc(function(){a.node.runAction(cc.fadeOut(.15)),t.node.runAction(cc.sequence(cc.fadeIn(.15),cc.fadeOut(.25),cc.callFunc(function(){l._equipnode.destroy()}),h))})));this._equipnode.runAction(d)},runUpgradeAction:function(){var e=this.m_pSoldierParent.getPositionX(),t=this.m_pSoldierParent.getPositionY();t+=20;for(var a,n=this,i=0;i<5;++i){var r=this._equipitemlist[i].getComponent("UnitEquipsItem")._itembox.getComponent("ItemBox").m_pIcon.node,s=(this._equipitemlist[i].getPositionX(),this._equipitemlist[i].getPositionY(),new cc.Node("sprMask").addComponent(cc.Sprite));s.spriteFrame=this.m_pUnitEquipMask,s.node.setScale(1.2),s.node.opacity=0;var o=new cc.Node("sprLight").addComponent(cc.Sprite);o.spriteFrame=this.m_punitUpgradeShine,this.node.addChild(o.node),o.node.setPosition(e,t),o.node.setScale(.5),o.node.opacity=0,o.node.rotation=10*i,r.addChild(s.node),s.node.setPosition(0,0),s.node.runAction(cc.sequence(cc.delayTime(.2*(i-1)),cc.fadeIn(.3)));var c=r.convertToWorldSpace(cc.p(44,44)),l=this.m_pSoldierParent.convertToWorldSpace(cc.p(100,61.5)),h=cc.pSub(l,c);h=cc.p(h.x/.8,h.y/.8),a=i,n.EquipMoveAction(r,s,o,a,h)}},EquipMoveAction:function(e,t,a,n,i){var r=this;e.runAction(cc.sequence(cc.delayTime(.2*(n-1)),cc.rotateBy(.1,10),cc.spawn(cc.moveBy(.2,i).easing(cc.easeIn(.2)),cc.rotateBy(.2,-10)),cc.callFunc(function(){c.playSoldFlyEffect(),e.runAction(cc.sequence(cc.spawn(cc.scaleTo(.15,1.3),cc.fadeOut(.15)),cc.removeSelf())),t.node.runAction(cc.fadeOut(.1)),a.node.runAction(cc.sequence(cc.spawn(cc.scaleTo(.15,1),cc.fadeIn(.15)),cc.spawn(cc.scaleTo(.25,1.5),cc.fadeOut(.25)),cc.removeSelf(),cc.callFunc(function(){4==n&&(r.playUpgradePreEffect(),r.refreshArmyEquips())})))})))},refreshArmyEquips:function(){for(var e=this.GetUnitEquipsList(this._unittype,this._unitgrade),t=0;t<this._equipitemlist.length;++t)
this._equipitemlist[t].removeFromParent(),this._equipitemlist[t].destroy();this._equipitemlist=[];for(t=0;t<e.length;++t){var a=null;t<this._equipitemlist.length?a=this._equipitemlist[t]:(a=cc.instantiate(this.m_pUnitEquipitem),this.m_pEquipparent.addChild(a),this._equipitemlist.push(a)),a.active=!0,a.getComponent("UnitEquipsItem").ChangeData({index:t,equipinfo:e[t],level:this._curlevel,heroid:this._herodetailview._heroinfo.template_id})}},playUpgradePreEffect:function(){var e=this,t=cc.instantiate(this.m_punitUpgradeEffect);this.m_pSoldierParent.addChild(t);var a=t.getComponent(dragonBones.ArmatureDisplay).armature();t.setScale(.8),t.setPosition(0,-40),t.setLocalZOrder(1e3),a.animation.fadeIn("Action1",-1,-1,0,"normal"),c.playSoldStageEffect(),this.m_pSoldierParent.runAction(cc.sequence(cc.moveBy(.18,cc.p(0,-10)),cc.moveBy(.18,cc.p(0,30)),cc.moveBy(.25,cc.p(0,-20)),cc.callFunc(function(){e.displayUnitsArmatrue(),a.animation.fadeIn("Action2",-1,-1,0,"normal"),e.refreshArmyAttr()})));for(var n=0;n<7;++n){this._soldieritemlist[n].runAction(cc.sequence(cc.delayTime(.18),cc.fadeOut(.18)))}},displayUnitsArmatrue:function(){this.ClearSoldierItem();for(var e=0;e<7;++e)
this.CreateSoldierModel(e,this._unittype,this._unitgrade,this.playUpgradedEffect.bind(this))},refreshArmyAttr:function(){this.m_pSoldierName.string=this.GetSoldierName(),this.m_pSoldierName.node.color=o.getColorByQuality(this._armyinfo.quality),this._curlevel>=DonotDestroyManager.GameData.Units.cost[this._unittype-1][this._unitgrade-1].max_level?this.m_pBtnLab.string=l.t("detail_043"):this.m_pBtnLab.string=l.t("detail_044")},playUpgradedEffect:function(){for(var e=this,t=0;t<7;++t){var a=this._soldieritemlist[t],n=a.getPositionY()+20;a.setPositionY(n),a.opacity=0,a.runAction(cc.spawn(cc.fadeIn(.18),cc.moveBy(.18,cc.p(0,-20))))}
this.m_pSoldierParent.runAction(cc.sequence(cc.delayTime(.18),cc.moveBy(.33,cc.p(0,-10)),cc.moveBy(.33,cc.p(0,10)),cc.callFunc(function(){e.refreshArmyAttr()}))),this._herodetailview.m_pMask.active=!1},GetUnitEquipsList:function(e,t){for(var a=[],n=DonotDestroyManager.GameData.Units.cost[e-1][t-1],i=0;i<n.upgrade_item.length;++i){var r=n.upgrade_item[i];a.push(r)}
return a},CreateUnitEquipItem:function(){for(var e=this.GetUnitEquipsList(this._unittype,this._unitgrade),t=0;t<e.length;++t){var a=null;t<this._equipitemlist.length?a=this._equipitemlist[t]:(a=cc.instantiate(this.m_pUnitEquipitem),this.m_pEquipparent.addChild(a),this._equipitemlist.push(a)),a.active=!0,a.getComponent("UnitEquipsItem").ChangeData({index:t,equipinfo:e[t],level:this._curlevel,heroid:this._herodetailview._heroinfo.template_id})}},CreateAllSoldier:function(e,t){this.ClearSoldierItem();for(var a=0;a<7;++a)
this.CreateSoldierModel(a,e,t)},CreateSoldierModel:function(a,e,t){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=this;this._soldierPrefabPath="Prefab/battle/soldier/"+this._soldierjson.unit_types[e-1][t-1].icon+"_blue",cc.loader.loadRes(this._soldierPrefabPath,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),i._soldierpre=t,i._soldieritem=cc.instantiate(t),i.m_pSoldierParent.addChild(i._soldieritem,0,2e3+a),i._soldieritem.setPosition(i._soldierpos[a]),i._soldieritem.setScale(-1,1),i._soldieritemlist.push(i._soldieritem),i._soldieritem.getComponent(cc.Animation).play("stand"),++i._createcount,7==i._createcount&&null!=n&&n()})},ClearSoldierItem:function(){this._createcount=0;for(var e=this._soldieritemlist.length-1;0<=e;--e)
this._soldieritemlist[e].removeFromParent(),this._soldieritemlist[e].destroy();if(null!=this._soldierpre){this._soldierjson.unit_types[this._unittype-1][this._unitgrade-1].icon;this._soldierPrefabPath}
this._soldierpre=null,this._soldieritem=null,this._soldieritemlist=[]},GetSoldierName:function(e,t){return"Lv."+this._curlevel+" "+this._soldierjson.unit_types[this._unittype-1][this._unitgrade-1].name},RefreshUnitView:function(e){this.InitContent(MyPersistDataManager._playerData.cardsMaplist[e]),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this._herodetailview.showGuide()},this))),this._herodetailview._refreshRedPoints()},UpgradeDialog_OnClickHandler:function(e){c.playBtnOpenEffect();var t=h.getFuncUnLockInfo(17),a=s(t,2),n=a[0],i=a[1];if(n)
if(this._curlevel>=DonotDestroyManager.GameData.Units.cost[this._unittype-1][this._unitgrade-1].max_level){cc.log(" mở ra thăng giai mặt biên ");var r=this.armyUpLevelDialogCloseCb.bind(this);MyUiManager.Open(MyUiManager.PanelInfo.ArmyUpgradeDialog,{armyInfo:this._armyinfo,cb:r})}else
MyUiManager.Open(MyUiManager.PanelInfo.ArmyUplevelDialog,{lv:this._curlevel,type:this._unittype,grade:this._unitgrade,heroid:this._herodetailview._heroinfo.template_id,cb:this.RefreshUnitView.bind(this),map:this._herodetailview._raw_assets});else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),i)},armyUpLevelDialogCloseCb:function(){this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this._herodetailview.showGuide()},this))),this._herodetailview._refreshRedPoints()},onDestroy:function(){i.removeListener(n.S2CCardEquipUnit,this.S2CCardEquipUnit_auth_cb_func),i.removeListener(n.S2CCardUpgradeUnit,this.S2CCardUpgradeUnit_auth_cb_func),this._soldierpre,this._soldierpre=null,this._soldieritem=null},getCanEquipBtn:function(){this._herodetailview._heroinfo.template_id;for(var e=0;e<this._equipitemlist.length;e++){var t=this._equipitemlist[e];if(t.getComponent("UnitEquipsItem").checkCanEquip())
return t.getComponent("UnitEquipsItem")._itembox}
return null},isUnitEquipUpGradeAble:function(){return this._curlevel>=DonotDestroyManager.GameData.Units.cost[this._unittype-1][this._unitgrade-1].max_level}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",NetEvent:"NetEvent",SoundUtil:"SoundUtil",UnLockCfgMgr:"UnLockCfgMgr",UnitBufferMgr:"UnitBufferMgr",UnitConfigMgr:"UnitConfigMgr",i18n:"i18n"}],HeroUpgradeDialog:[function(e,t,a){"use strict";cc._RF.push(t,"8b265qDS95OpIOM0RvO54LR","HeroUpgradeDialog");var g=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},y=e("HeroBufferMgr"),v=e("HeroConfigMgr"),l=e("PropHintsEffect"),n=(e("ResLoaderManager"),e("MyProtocols")),i=e("NetEvent"),r=e("MyEventDispatcher"),s=e("MyUIEvent"),o=e("SoundUtil"),M=e("i18n"),c=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pAttrItem:cc.Prefab,m_pheroStageR:cc.Prefab,m_pUpgradeitem:cc.Node,m_pHeroparent:cc.Node,m_pItemparent:cc.Node,m_pAttrparent:cc.Node,m_pGroup:cc.Sprite,m_pQuality:cc.Sprite,m_pName:cc.Label,m_pDes:cc.Label,m_pNeedlv:cc.Label,m_pMoney:cc.Label,mHeroUpBtn:cc.Node,m_pStarList:[cc.Sprite],m_pStarsprlist:[cc.SpriteFrame],m_pGroupSprframe:[cc.SpriteFrame],m_pBanerSprframe:[cc.SpriteFrame],_herobuffer:null,_attritemlist:[],_createindex:-1,_isPlayEffect:!1,_stageupCost:null,_heroitem:null,_upgradeitemlist:[],_raw_assets:{default:{},type:Object}},onLoad:function(){this.S2CCardAddStar_auth_cb_func=this.S2CCardAddStar_auth_cb.bind(this),r.addListener(i.S2CCardAddStar,this.S2CCardAddStar_auth_cb_func)},S2CCardAddStar_auth_cb:function(e){cc.log(" anh hùng thăng giai tin tức "),o.playUpgradeEffect();var t=MyPersistDataManager._playerData.cardsMaplist[e.card_id];t.grade=e.new_star,t.num=e.num,this._herobuffer.grade=e.new_star,this._isPlayEffect=!0,this.RefreshAttrText(),this.RunheroStageRise(),this.RefreshUpgradeNeedItem(),t.fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(t.fight,e.fight),t.fight=e.fight},setParams:function(e){this._herobuffer=e.herobuffer,this._raw_assets=e.map,this.Init(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},Init:function(){this.CreateHeroItem(),this.RefreshAttrText(),this.RefreshUpgradeNeedItem(),this.m_pGroup.spriteFrame=this.m_pGroupSprframe[this._herobuffer.heroCfg.group-1],this.m_pQuality.spriteFrame=this.m_pBanerSprframe[this._herobuffer.heroCfg.quality]},CreateHeroItem:function(){var a=this;cc.loader.loadRes("Prefab/ItemBox/ItemBox",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),a._heroitem=cc.instantiate(t),a.m_pHeroparent.addChild(a._heroitem),a._heroitem.getComponent("ItemBox").ChangeItemInfo(a._herobuffer.template_id,0)})},RefreshUpgradeNeedItem:function(){var e=this._herobuffer.grade;this._herobuffer.grade==v.getTalentCnt(this._herobuffer.heroCfg.id)&&(e=this._herobuffer.grade-1);for(var t=DonotDestroyManager.GameData.CardUpgrades.costs[this._herobuffer.heroCfg.potential][e],a=[],n=0;n<t.items.length;++n)
a.push([t.items[n][0],t.items[n][1]]);0<t.cards&&a.push([this._herobuffer.template_id,t.cards]);for(n=0;n<a.length;++n){var i=null;n<this._upgradeitemlist.length?i=this._upgradeitemlist[n]:(i=cc.instantiate(this.m_pUpgradeitem),this.m_pItemparent.addChild(i),this._upgradeitemlist.push(i)),i.active=!0,i.getComponent("HeroUpgradeItem").ChangeData(a[n][0],a[n][1])}},RefreshAttrText:function(){this.m_pName.string=this._herobuffer.heroCfg.name;var e=this._herobuffer.grade+1,t=v.getTalentCnt(this._herobuffer.heroCfg.id);this._herobuffer.grade==t&&(e=this._herobuffer.grade);var a=y.getHeroPropAttr(this._herobuffer.template_id),n=g(a,3),i=n[0],r=n[1],s=n[2],o=y.getHeroPropAttr(this._herobuffer.template_id,this._herobuffer.level,e),c=g(o,3),l=c[0],h=c[1],d=c[2];if(this._createindex=0,this.AddAttr(M.t("detail_045",{value:this._herobuffer.grade}),e),this.AddAttr(M.t("detail_004",{value:i}),l),this.AddAttr(M.t("detail_005",{value:r}),h),this.AddAttr(M.t("detail_006",{value:s}),d),this.AddAttr(M.t("detail_046",{value:this._herobuffer.unit_num}),this._herobuffer.unit_num),this._herobuffer.grade<this._herobuffer.heroCfg.talents.length){var _=this._herobuffer.heroCfg.talents[this._herobuffer.grade],u=DonotDestroyManager.GameData.Talents[_-1];this.m_pDes.string=u.name+":"+u.des}else
this.m_pDes.string=M.t("detail_047");var m=this._herobuffer.grade<7&&this._herobuffer.grade+1||7,p=DonotDestroyManager.GameData.Common.card_upgrade_lvlimit[m-1],f="";f=0==p[0]?M.t("detail_048",{value:p[1]}):M.t("detail_049",{value:p[0],value1:p[1]}),this.m_pNeedlv.string=f,this._herobuffer.level<p[0]||this._herobuffer.unit_level<p[1]?this.m_pNeedlv.node.color=cc.Color.RED:this.m_pNeedlv.node.color=cc.Color.GREEN,this._stageupCost=DonotDestroyManager.GameData.CardUpgrades.costs[this._herobuffer.heroCfg.potential][e-1],this.m_pMoney.string=this._stageupCost.gamemoney,this.m_pMoney.node.color=this._stageupCost.gamemoney>MyPersistDataManager._playerData.gameMoney?cc.Color.RED:cc.Color.GREEN,this.RefreshStar()},RefreshStar:function(){for(var e=2==this._herobuffer.heroCfg.quality?5:7,t=5==e?-70:-105,a=0;a<this.m_pStarList.length;++a)
a<e?(this.m_pStarList[a].node.active=!0,this.m_pStarList[a].node.setPosition(t+35*a,0)):this.m_pStarList[a].node.active=!1,this._herobuffer.grade>a?this.m_pStarList[a].spriteFrame=this.m_pStarsprlist[1]:this.m_pStarList[a].spriteFrame=this.m_pStarsprlist[0]},RunheroStageRise:function(){var e=this,t=cc.instantiate(this.m_pheroStageR);this.m_pHeroparent.addChild(t),t.setPosition(0,0),t.setScale(1.5);var a=t.getComponent(dragonBones.ArmatureDisplay);a.armature().animation.fadeIn("heroStageRise",-1,-1,0,"normal"),a.addEventListener(dragonBones.EventObject.COMPLETE,function(){t.removeFromParent(),t.destroy(),e.runHeroPropEffect()},this)},runHeroPropEffect:function(){var e=this._herobuffer.grade-1,t=y.getHeroPropAttr(this._herobuffer.template_id,this._herobuffer.level,e),a=g(t,3),n=a[0],i=a[1],r=a[2],s=y.getHeroPropAttr(this._herobuffer.template_id),o=g(s,3),c=[[1,o[0]-n],[2,o[1]-i],[3,o[2]-r]];l.runHeroPropEffect(this.node.parent,{elemIdx:2,stateIdx:1,upgradeLv:1},c,null,this._raw_assets)},AddAttr:function(e,t){var a=null;this._createindex<this._attritemlist.length?a=this._attritemlist[this._createindex]:(a=cc.instantiate(this.m_pAttrItem),this.m_pAttrparent.addChild(a),this._attritemlist.push(a)),a.active=!0,a.getComponent("AttributeChangeItem").ChangeData(e,t,this._isPlayEffect),++this._createindex},Upgrade_OnClickHandler:function(e){var t=v.getTalentCnt(this._herobuffer.heroCfg.id);this._herobuffer.grade!=t?n.send_C2SCardAddStar(DonotDestroyManager._gameSocket,this._herobuffer.template_id):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),M.t("detail_050"))},Mask_OnClickHandler:function(e){MyUiManager.Back(),o.playBtnCloseEffect(),r.dispatchEvent(s.RefreshHeroUpgrade,{})},onDestroy:function(){r.removeListener(i.S2CCardAddStar,this.S2CCardAddStar_auth_cb_func)},showGuide:function(){var t=this;c.showGuide("HeroStageWidget",function(e){if(1==e)
return t.mHeroUpBtn})}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",HeroBufferMgr:"HeroBufferMgr",HeroConfigMgr:"HeroConfigMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",PropHintsEffect:"PropHintsEffect",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil",i18n:"i18n"}],HeroUpgradeItem:[function(e,t,a){"use strict";cc._RF.push(t,"2aec7QSogZI55QpeWwdg6yg","HeroUpgradeItem");var n=e("ItemBufferMgr"),i=e("UnLockCfgMgr"),r=e("i18n");cc.Class({extends:cc.Component,properties:{m_pItemparent:cc.Node,m_pNum:cc.Label,_itemid:-1,_Maxcnt:-1,_itemcnt:-1,_itembox:null,_alert_layer:null},onLoad:function(){},ChangeData:function(e,t){this._itemid=e,this._Maxcnt=t,this.Init()},Init:function(){this.CreateItemBox(),this.SetItemCount(),null!=MyPersistDataManager._playerData.bagMap[this._itemid]&&(this._itemcnt=MyPersistDataManager._playerData.bagMap[this._itemid].num),this.m_pNum.string=this._itemcnt+"/"+this._Maxcnt,this.m_pNum.node.color=this._itemcnt<this._Maxcnt?cc.Color.RED:cc.Color.GREEN},SetItemCount:function(){if(this._itemcnt=0,n.isTreasureEntity(this._itemid)||n.isEquipEntity(this._itemid))
for(var e=MyPersistDataManager._playerData.baglist,t=0;t<e.length;++t)
e[t].template_id!=this._itemid||null!=e[t].heroid&&0!=e[t].heroid||++this._itemcnt;else{if(null!=MyPersistDataManager._playerData.bagMap[this._itemid])
return void(this._itemcnt=MyPersistDataManager._playerData.bagMap[this._itemid].num);if(null!=MyPersistDataManager._playerData.cardsMaplist[this._itemid])
return void(this._itemcnt=MyPersistDataManager._playerData.cardsMaplist[this._itemid].num-1)}},CreateItemBox:function(){var a=this,n=null;1002==this._itemid&&(n=this.Item_OnClickHandler.bind(this)),null==this._itembox?cc.loader.loadRes("Prefab/ItemBox/ItemBox",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),a._itembox=cc.instantiate(t),a.m_pItemparent.addChild(a._itembox),a._itembox.getComponent("ItemBox").ChangeItemInfo(a._itemid,0,!1,n,!0)}):this._itembox.getComponent("ItemBox").ChangeItemInfo(this._itemid,0,!1,n,!0)},Item_OnClickHandler:function(){this._itemcnt>=this._Maxcnt||(this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent(r.t("detail_051"),this.Go_Heishi.bind(this),!0,r.t("detail_052")))},Go_Heishi:function(){cc.log(" khiêu biến thành đen thị ");DonotDestroyManager.GameData.HomeMap.bones.blackmart.unlock;var e=this;i.isUnlockCallBack(20,function(){MyUiManager.Open(MyUiManager.PanelInfo.BlackShop,{}),null!=e._alert_layer&&(e._alert_layer.removeFromParent(),e._alert_layer.destroy(),e._alert_layer=null)})}}),cc._RF.pop()},{ItemBufferMgr:"ItemBufferMgr",UnLockCfgMgr:"UnLockCfgMgr",i18n:"i18n"}],HeroesManager:[function(e,t,a){"use strict";cc._RF.push(t,"27463nAqL1Ly5CJetCHmUx/","HeroesManager");var n=e("MeleeHero"),i=e("RemoteHero"),r=e("BattleConstants"),s=function(){this.heroActors=[]};s.prototype.resetData=function(){this.heroActors=[]},s.prototype.createHero=function(e){var t;return e==r._ARMY_TYPE.Melee?t=new n:e==r._ARMY_TYPE.Remote&&(t=new i),cc.assert(t,"can not create hero atk type = %d",e),this.heroActors.push(t),t},s.prototype.onUpdate=function(e){for(var t=0;t<this.heroActors.length;t++)
this.heroActors[t].onUpdate(e)},s.prototype.pause=function(){for(var e=0;e<this.heroActors.length;e++){var t=this.heroActors[e];"Dead"!=t.getState()&&t.pause()}},s.prototype.resume=function(){for(var e=0;e<this.heroActors.length;e++){var t=this.heroActors[e];"Dead"!=t.getState()&&t.resume()}},t.exports=new s,cc._RF.pop()},{BattleConstants:"BattleConstants",MeleeHero:"MeleeHero",RemoteHero:"RemoteHero"}],Hero:[function(d,e,t){"use strict";cc._RF.push(e,"d237a0aZbJOWaO7SoHhsmYa","Hero");var _=d("BattleConstants"),u=d("HeroBufferMgr"),m=d("SkillsManager"),p=d("MyEventDispatcher"),a=d("GameUtils"),f=d("EnermyBufferMgr"),r=d("HeroDieManager"),n="normal",i=cc.Class({extends:d("Unit"),properties:{},ctor:function(){cc.log("Hero create!"),this.class="Hero",this.id=null,this.tid=null,this.cfg={},this.uCfg={},this.level=1,this.grade=1,this.uNum=0,this.skEnable=null,this.hit=0,this.dodge=0,this.deal=0,this.get=0,this.crit=0,this.critD=0,this.minD=0,this.maxD=0,this.speedup=1,this.bloodGet=0,this.treatment=1,this.anti_debuff=0,this.reduce_debuff=0,this.openSkilled=!1,this.skillTimes={},this.skillQueue=[],this.skillPreEv=null,this.isPauseAble=!0,this.eventHero=!1,this.keyPosition="",this.killedBy=null},initial:function(){this.basehp=this.init_basehp||this.hp,this.baseatk=this.atk,this.basedef=this.def;for(var e,a=function(e){for(var t=100/e[1],a=Math.ceil(180/t),n=[],i=1;i<=a;i++)
n.push(Math.ceil((i-1)*t+Math.random()*t));return n},s=this,t=0;t<this.cfg.skills.length;t++){var n=this.cfg.skills[t];if(e=t,s.skEnable?s.skEnable[e]:!(0<e)||s.cfg.quality<3||2<s.grade){var i=m.getCfgById(n[0]);s=this;i.tri[0]==_._SKILL_TRIGGER.Opening?(this.openSkilled=!0,function(e){s.openingSkill=function(){s.castSkill(s.cfg.skills[e][0],s.cfg.skills[e][1],function(){s.openSkilled=!1,s.skillPreEv?(s.doEvent(s.skillPreEv),s.skillPreEv=null):s.doEvent("Idle")})}}
(t)):i.tri[0]==_._SKILL_TRIGGER.Damage?(this.damageSkill=this.damageSkill||[],function(n){var e=s.cfg.skills[n],t=m.getCfgById(e[0]),i=a(t.tri),r=0;s.damageSkill.push(function(){if(r+=1,i[0]!=r)
for(var e=0;e<s.buffs.length;e++)
if(12==(t=s.buffs[e]).cfg.buff_type&&0<t.cfg.anger){r++;break}
if(i[0]==r){for(i.shift(),e=0;e<s.buffs.length;e++){var t;if(11==(t=s.buffs[e]).cfg.buff_type)
return;if(12==t.cfg.buff_type){var a=100+t.cfg.anger;if(100*Math.random()>a)
return}}
s.castSkill(s.cfg.skills[n][0],s.cfg.skills[n][1],function(){s.onSkillCastEnd()})}})}
(t)):i.tri[0]==_._SKILL_TRIGGER.HP_Perc?function(a){s.hpPercSkill=function(){s.hp,s.basehp;var e=s.cfg.skills[a],t=m.getCfgById(e[0]);0<t.tri[1]?s.hp/s.basehp*100>t.tri[1]&&s.castSkill(e[0],e[1],function(){s.onSkillCastEnd()}):t.tri[1]<0&&s.hp/s.basehp*100<-t.tri[1]&&s.castSkill(e[0],e[1],function(){s.onSkillCastEnd()})}}
(t):i.tri[0]==_._SKILL_TRIGGER.PreDead&&function(a){s.preDeadSkill=function(){var e=s.cfg.skills[a],t=m.getCfgById(e[0]);100*Math.random()<=t.tri[1]?s.castSkill(e[0],e[1],function(){s.doEvent("Dead")}):s.doEvent("Dead"),s.preDeadSkill=null}}
(t)}}
var r=d("BattleManager");if(this.army.side==_._BTL_SIDE.OUR&&this.id){var o=u.getExtraPropAttr(this.id);this.hit=o.hit_rate||0,this.dodge=o.dodge||0,this.deal=o.dmg_deal_static||0,this.get=o.dmg_get_static||0,this.crit=o.crit_rate||0,this.critD=o.crit_coef||0,this.minD=o.min_dmg||0,this.maxD=o.max_dmg||0,this.speedup=null!=o.speedup?1+o.speedup/1e3:1,this.bloodGet=null!=o.blood?o.blood/1e3:0,this.treatment=null!=o.treatment?1+o.treatment/1e3:1,this.anti_debuff=null!=o.anti_debuff?o.anti_debuff/1e3:0,this.reduce_debuff=null!=o.reduce_debuff?o.reduce_debuff/1e3:0}else if(this.id&&(3==r.type||4==r.type||6==r.type||8==r.type||9==r.type||11==r.type||12==r.type||13==r.type||14==r.type||15==r.type)){null!=(o=f.getInstance().getHeroExtraProp(this.id))&&(this.deal=o[0]||0,this.get=o[1]||0,this.hit=o[2]||0,this.dodge=o[3]||0,this.crit=o[4]||0,this.critD=o[5]||0,this.speedup=null!=o[6]?1+o[6]/1e3:1,this.bloodGet=null!=o[8]?o[8]/1e3:0,this.treatment=null!=o[9]?1+o[9]/1e3:1,this.anti_debuff=null!=o[10]?o[10]/1e3:0,this.reduce_debuff=null!=o[11]?o[11]/1e3:0)}
this.node=new cc.Node,this.node.setCascadeOpacityEnabled(!0);var c,l=d("BattleSceneMgr");this.dbShadow=cc.instantiate(l.getInstance()._raw_assets["Prefab/Heros/rolebase"]),this.dbShadow.setScale(.45),this.side()==_._BTL_SIDE.OUR?c=-.6:this.side()==_._BTL_SIDE.OTR&&(c=.6),this.node.addChild(this.dbShadow,_._BTL_ZORDER.U_SHADOW),this.amt=cc.instantiate(l.getInstance()._raw_assets["Prefab/Heros/"+this.cfg.icon]),this.amt.setScaleX(c),this.amt.setScaleY(.6),this.node.addChild(this.amt,_._BTL_ZORDER.U_ARMATURE);var h=this.side()==_._BTL_SIDE.OUR?"Green":"Red";this.bloodBar=cc.instantiate(l.getInstance()._raw_assets["Prefab/battle/widget/heroLifeBar"+h]),this.bloodBar.setPositionY(this.getHeight()-20),this.bloodBar.getComponent("BattleLifeBarMgr")._uClass="Hero",this.node.addChild(this.bloodBar,_._BTL_ZORDER.U_BLOOD),this.bloodBar.getComponent("BattleLifeBarMgr").setPercent(this.hp/this.basehp),this.onFightBeginEvt=this.onFightBeginEvtCb.bind(this),p.addListener("onFightBegin",this.onFightBeginEvt),this.onEventCastSkillEvt=this.onEventCastSkillEvtCb.bind(this),p.addListener("onEventCastSkill",this.onEventCastSkillEvt)},onDestroy:function(){p.removeListener("onFightBegin",this.onFightBeginEvt),p.removeListener("onEventCastSkill",this.onEventCastSkillEvt)},onFightBeginEvtCb:function(){this.openingSkill&&this.openingSkill()},onSkillCastEnd:function(){if(this.doEvent("Idle"),this.skill_dmg_free=!1,0<this.skillQueue.length){var e=this.skillQueue.shift();this.castSkill(e[0],e[1],e[2])}else
this.skillPreEv&&("Meet"==this.skillPreEv&&null==this.meet2Pos&&(this.meet2Pos=cc.p(this.getPosition())),this.doEvent(this.skillPreEv),this.skillPreEv=null)},onEventCastSkillEvtCb:function(e){if("Dead"!=this.getState()){var t=e[0],n=this,a=function(e){for(var t=0;t<n.cfg.skills.length;t++){var a=n.cfg.skills[t];if(a[0]==e){n.castSkill(a[0],a[1],function(){n.onSkillCastEnd()});break}}};if(1!=t||this.side()!=_._BTL_SIDE.OTR||this.eventHero)
if(2!=t||this.side()!=_._BTL_SIDE.OTR||this.eventHero){if(3==t&&this.side()==_._BTL_SIDE.OTR&&this.eventHero){e[1][0]==this.tid&&a(e[1][1])}else if(4==t&&this.side()==_._BTL_SIDE.OUR&&this.eventHero){e[1][0]==this.tid&&a(e[1][1])}}else{e[1][0]==this.keyPosition&&a(e[1][1])}
else
e[1][0]==this.tid&&a(e[1][1])}},add2Parent:function(e){var t;this._super(e),this.side()==_._BTL_SIDE.OUR?t="blue":this.side()==_._BTL_SIDE.OTR&&(t="red"),null!=this.dbShadow.getComponent("dragonBones.ArmatureDisplay").armature()?this.dbShadow.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn(t,-1,-1,0,n):a.callInNextTick(function(e){e.dbShadow.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn(t,-1,-1,0,n)},this)},playAnimation:function(e){cc.log("Hero=%s playAnimation=%s",this.name,e);var t=!0;"hurt2"!=e&&"die"!=e||(t=!1);var a=this.amt.getComponent(sp.Skeleton);a.timeScale=this.speedup,a.setAnimation(0,e,t)},getUnitSize:function(){var e=this.uCfg.size;return this.cfg.is_spine&&(e+=3),e},getHeight:function(){var e=0;return 2==this.cfg.unit_type&&(e=125),e=105,this.cfg.is_spine&&(e+=30),e},getAtkType:function(){return this.uCfg.atk_type},getAttackAniName:function(){var e=[];e=null==this.cfg.is_spine?["attack1","attack2","attack3"]:["attack1","attack2"];var t=parseInt(Math.random()*e.length);return e[t=t>=e.length?e.length-1:t]},pauseAnimation:function(){this.amt.getComponent(sp.Skeleton).paused=!0},resumeAnimation:function(){this.amt.getComponent(sp.Skeleton).paused=!1},castSkill:function(e,t,a){if(0!=this.skillTimes[e])
if("Skill"==this.getState()){var n=this.skillQueue[this.skillQueue.length-1];n&&n[0]==e||this.skillQueue.push([e,t,a])}else{var i=m.createSkill(this.cfg.id);if(i.id=e,i.origin=this,i.cfg=m.getCfgById(e),m.searchTargetsFor(i),0==i.targets.length)
return m.removeSkill(i),void a();i.setFSM();i.cfg.quality;this.skillTimes[e]=this.skillTimes[e]||i.cfg.cast_times,this.skillTimes[e]=this.skillTimes[e]-1,this.playAnimation(t),this.skillPreEv=this.skillPreEv||this.lastEv,this.doEvent("Skill"),1==i.cfg.dmg_free&&(this.skill_dmg_free=!0);this.amt.getComponent(sp.Skeleton);var r=this;this.amt.getComponent(sp.Skeleton).setCompleteListener(function(e){r.amt.getComponent(sp.Skeleton).setCompleteListener(function(){}),a()})}},isHitBy:function(e){var t=e.hit||0,a=e.level||1,n=this.level||1,i=100+(t-this.dodge)/150+a-n;return 0<this.dodge&&99<i&&(i=99),99*Math.random()<i},showDodge:function(){var e=d("EffectsManager").createEffect(),t=100;this.cfg.unit_type&&(t=140),e.id=16040001,e.cfg={file:"dodge",action:"action1",x:t/2,y:t,layer:2},e.target=this,e.setFSM()},showGet:function(){var e=d("EffectsManager").createEffect(),t="action2";1==this.getOrient()&&(t="action1"),e.id=16040002,e.cfg={file:"dmgdefend",action:t,x:0,y:0,layer:2},e.target=this,e.setFSM()},reduceHP:function(e,t){t&&"Hero"==t.class&&this.hp<e&&(this.killedBy=t.cfg.name),this._super(e,t),d("StagesEventManager").dispatchTrigger1(this),0<this.hp&&this.hpPercSkill&&this.hpPercSkill()},increaseHP:function(e){this._super(e),this.hpPercSkill&&this.hpPercSkill()},onbeforeDead:function(){this._super(),this.dbShadow.removeFromParent(),this.dbShadow.destroy(),this.dbShadow=null},onenterDead:function(){this.playAnimation("die");var e=d("BattleManager"),t=this;this.amt.getComponent(sp.Skeleton).setCompleteListener(function(e){"die"==(e.animation?e.animation.name:"")&&(null==t.cfg.is_spine&&t.playAnimation("dead"),t.node.opacity=150,t.amt.getComponent(sp.Skeleton).setCompleteListener(function(){}))}),this.side()==_._BTL_SIDE.OUR&&(e.ourside.heroDeadNum=e.ourside.heroDeadNum+1);var a=this.getPosition(),n=a.x,i=a.y;p.dispatchEvent("onHeroBeKilled",[this.cfg.name,this.side(),n,i,this.killedBy]),r.die1(this.side(),this.cfg.id)},pause:function(){if(cc.log("Hero=%s pause",this.name),this.isPauseAble){this._super();var e=this.dbShadow.getComponent("dragonBones.ArmatureDisplay");if(null!=e.armature()&&null!=e.armature().animation){var t=null;t=e.armature().animation.lastAnimationName,e.armature().animation.stop(t)}}},resume:function(){if(cc.log("Hero=%s resume",this.name),this.isPauseAble){this._super();var e=this.dbShadow.getComponent("dragonBones.ArmatureDisplay");if(null!=e.armature()&&null!=e.armature().animation){var t=null;t=e.armature().animation.lastAnimationName,e.armature().animation.fadeIn(t,-1,-1,0,n)}}},interruptAction:function(e,t,a){var n=this._super(e,t,a);if(null==n)
return null;var i=this;this.amt.getComponent(sp.Skeleton).setCompleteListener(function(e){i.amt.getComponent(sp.Skeleton).setCompleteListener(function(){}),n()})}});e.exports=i,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",EffectsManager:"EffectsManager",EnermyBufferMgr:"EnermyBufferMgr",GameUtils:"GameUtils",HeroBufferMgr:"HeroBufferMgr",HeroDieManager:"HeroDieManager",MyEventDispatcher:"MyEventDispatcher",SkillsManager:"SkillsManager",StagesEventManager:"StagesEventManager",Unit:"Unit"}],HotUpdate:[function(e,t,a){"use strict";cc._RF.push(t,"ea2acn+qbVI0K8bclFF1OLo","HotUpdate");e("md5");var r=e("GameUtils"),n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{progressBar_ctrl:{default:null,type:cc.ProgressBar},cursor_node:{default:null,type:cc.Node},lab_loading_tip:cc.Label,manifestUrl:cc.RawAsset,node_retry_btn:cc.Node},onLoad:function(){cc.sys.isNative&&(this._storagePath=(jsb.fileUtils?jsb.fileUtils.getWritablePath():"/")+"sango-remote-asset",cc.log("Storage path for remote asset : "+this._storagePath),this.versionCompareHandle=function(e,t){cc.log("JS Custom Version Compare: version A is "+e+", version B is "+t);for(var a=e.split("."),n=t.split("."),i=0;i<a.length;++i){var r=parseInt(a[i]),s=parseInt(n[i]||0);if(r!==s)
return r-s}
return n.length>a.length?-1:0},this._am=new jsb.AssetsManager(this.manifestUrl,this._storagePath,this.versionCompareHandle),cc.sys.ENABLE_GC_FOR_NATIVE_OBJECTS||this._am.retain(),this._am.setVerifyCallback(function(e,t){var a=t.compressed,n=(t.md5,t.path,t.size);return!!a||jsb.fileUtils.getFileSize(e)==n}),cc.sys.os===cc.sys.OS_ANDROID&&this._am.setMaxConcurrentTask(2),this.node_retry_btn.active=!1)},onDestroy:function(){this._updateListener&&(cc.eventManager.removeListener(this._updateListener),this._updateListener=null),this._am&&!cc.sys.ENABLE_GC_FOR_NATIVE_OBJECTS&&this._am.release()},start:function(){this.lab_loading_tip.string="Đang kiểm tra cập nhật,xin vui lòng đợi...",this.checkUpdate(null,null)},checkUpdate:function(e,t){null!=e&&n.playBtnOpenEffectRaw(),this._updating?this.lab_loading_tip.string="Checking or updating ...":(this._am.getState()===jsb.AssetsManager.State.UNINITED&&this._am.loadLocalManifest(this.manifestUrl),this._am.getLocalManifest()&&this._am.getLocalManifest().isLoaded()?(this._checkListener=new jsb.EventListenerAssetsManager(this._am,this.checkCb.bind(this)),cc.eventManager.addListener(this._checkListener,1),this._am.checkUpdate(),this._updating=!0,this.changeProgress(0)):this.lab_loading_tip.string="Failed to load local manifest ...")},hotUpdate:function(){cc.log("do hotUpdate#1"),this._am&&!this._updating&&(cc.log("do hotUpdate#2"),this._updateListener=new jsb.EventListenerAssetsManager(this._am,this.updateCb.bind(this)),cc.eventManager.addListener(this._updateListener,1),this._am.getState()===jsb.AssetsManager.State.UNINITED&&this._am.loadLocalManifest(this.manifestUrl),this._failCount=0,this._am.update(),this._updating=!0)},checkCb:function(e){cc.log("Code: "+e.getEventCode());var t=!1;switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:this.lab_loading_tip.string="Không tìm thấy file manifest bản địa,hủy bỏ cập nhật!",this.node_retry_btn.active=!0;break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:this.lab_loading_tip.string="Tải xuống file manifest thất bại,xin thử lại!",this.node_retry_btn.active=!0;break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:this.lab_loading_tip.string="Hiện tại là phiên bản mới nhất!",t=!0,this.node_retry_btn.active=!1;break;case jsb.EventAssetsManager.NEW_VERSION_FOUND:this.lab_loading_tip.string="Phát hiện phiên bản mới,bắt đầu cập nhật...",r.callInNext100ms(function(e){e.hotUpdate()},this);break;default:return}
cc.eventManager.removeListener(this._checkListener),this._checkListener=null,this._updating=!1,t&&r.callInNext100ms(function(){cc.director.loadScene("login")})},updateCb:function(e){cc.log("in updateCb");var t=!1,a=!1;switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:this.lab_loading_tip.string="Không tìm thấy file manifest bản địa,hủy bỏ cập nhật!",a=!0;break;case jsb.EventAssetsManager.UPDATE_PROGRESSION:this.changeProgress(e.getPercent()),this.lab_loading_tip.string=r.formatBytes(e.getDownloadedBytes())+" / "+r.formatBytes(e.getTotalBytes());break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:this.lab_loading_tip.string="Tải xuống file manifest thất bại,xin thử lại!",a=!0;break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:this.lab_loading_tip.string="Hiện tại là phiên bản mới nhất!",a=!0;break;case jsb.EventAssetsManager.UPDATE_FINISHED:this.lab_loading_tip.string="Hoàn tất cập nhật."+e.getMessage(),t=!0;break;case jsb.EventAssetsManager.UPDATE_FAILED:this.lab_loading_tip.string="Cập nhật thất bại. "+e.getMessage(),a=this.node_retry_btn.active=!0;break;case jsb.EventAssetsManager.ERROR_UPDATING:this.lab_loading_tip.string="asset Cập nhật thất bại:"+e.getAssetId()+", "+e.getMessage(),a=this.node_retry_btn.active=!0;break;case jsb.EventAssetsManager.ERROR_DECOMPRESS:this.lab_loading_tip.string=e.getMessage(),a=this.node_retry_btn.active=!0}
if(a&&(cc.eventManager.removeListener(this._updateListener),this._updateListener=null,this._updating=!1),t){cc.eventManager.removeListener(this._updateListener),this._updateListener=null;var n=jsb.fileUtils.getSearchPaths(),i=this._am.getLocalManifest().getSearchPaths();console.log(JSON.stringify(i)),Array.prototype.unshift(n,i),cc.sys.localStorage.setItem("HotUpdateSearchPaths",JSON.stringify(n)),jsb.fileUtils.setSearchPaths(n),cc.audioEngine.stopAll(),cc.game.restart()}},changeProgress:function(e){this.progressBar_ctrl.progress=e,this.cursor_node.x=700*e-350}}),cc._RF.pop()},{GameUtils:"GameUtils",SoundUtil:"SoundUtil",md5:"md5"}],IosOpenManager:[function(e,t,a){"use strict";cc._RF.push(t,"c0386e2I8xCj7uPE3AOS4zj","IosOpenManager");var i=e("MyEventDispatcher"),r=e("MyUIEvent"),s=e("GameUtils"),n=e("MyProtocols");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},loginSuccessXingTeng:function(e,t,a,n){cc.log(" tinh đằng iOS liên vận đăng ký thành công ！"),i.dispatchEvent(r.OpenLoginXingTeng,{userId:t,token:a,appId:e,appKey:n})},loginSuccessPingPing:function(e,t,a,n){cc.log(" Quảng Châu thường thường iOS liên vận đăng ký thành công ！"),i.dispatchEvent(r.OpenLoginPingPing,{game_id:e,user_code:t,login_token:a,game_key:n})},loginSuccess:function(e,t,a){cc.log("iOS liên vận đăng ký thành công ！"),i.dispatchEvent(r.OpenLoginSuccessJsbCallback,{userId:e,token:t,buildCode:a})},loginSuccessLiuye:function(e,t,a,n){cc.log("iOS liên vận đăng ký thành công - lưu diệp võng lạc ！"),DonotDestroyManager._packageId=n,i.dispatchEvent(r.OpenLoginSuccessJsbCallback,{userId:e,token:t,buildCode:a})},loginFail:function(){cc.log("iOS liên vận đăng ký thất bại ！"),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Đăng nhập thất bại,xin thử lại!")},doExit:function(){cc.director.end()},onLogout:function(){DonotDestroyManager.LOGIN_DATA_185sy=null,DonotDestroyManager.LOGIN_DATA_manv=null,s.restartGame()},paySuccess:function(e){n.send_C2SIosIAPVerify(DonotDestroyManager._gameSocket,e)},switchAccount:function(e,t){DonotDestroyManager.LOGIN_DATA_185sy={token:t,userId:e},s.restartGame()},switchAccountQuick:function(e,t,a,n){DonotDestroyManager.LOGIN_DATA_manv={token:a,userId:t,appKey:n,appId:e},s.restartGame()}}),cc._RF.pop()},{GameUtils:"GameUtils",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent"}],ItemBox:[function(e,t,a){"use strict";cc._RF.push(t,"415c5GnsJlKmKA2qMTqIzka","ItemBox");var n=e("ShaderUtil"),i=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pQuality:cc.Sprite,m_pIcon:cc.Sprite,m_pNum:cc.Label,m_pSelect:cc.Sprite,m_pEquipType:cc.Sprite,m_pSoilderType:cc.Sprite,m_pFrag:cc.Sprite,m_parrow:cc.Sprite,m_pAddspr:cc.Sprite,m_pLvBg:cc.Sprite,m_pLevel:cc.Label,m_pActionFrame:cc.Sprite,m_pArrowmindspr:[cc.SpriteFrame],m_pSelectSprFrame:[cc.SpriteFrame],m_pAddSprFrame:[cc.SpriteFrame],m_pEquipNormalFrame:[cc.SpriteFrame],m_pSoilderTypeFrame:[cc.SpriteFrame],m_pQualityFrame:[cc.SpriteFrame],m_pUnitFrame:[cc.SpriteFrame],m_pUnitNilBg:[cc.SpriteFrame],mUnitEquipFlashBg:[cc.SpriteFrame],Res_type_rune:cc.SpriteFrame,_itemId:0,_itemCount:0,_isEmpty:!0,_itemcfg:null,_itemjsoninfo:null,_cb:null,_tipNode:null,index:0,_uuid:null,_tiereffect:null,_itemType:0,_isselect:!1,_isLongPress:!1,_longPressTime:0,_longPressCb:null},onLoad:function(){},SetSelect:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this._isselect=e,this.m_pSelect.node.active=e,this.m_pSelect.spriteFrame=this.m_pSelectSprFrame[t]},ShowArrow:function(e,t){this.m_parrow.node.active=e,this.m_parrow.node.setPosition(41,35),this.m_parrow.node.stopAllActions(),e&&(this.m_parrow.node.setLocalZOrder(1e3),this.m_parrow.spriteFrame=this.m_pArrowmindspr[t],this.m_parrow.node.runAction(cc.repeatForever(cc.sequence(cc.moveBy(.6,cc.p(0,10)),cc.moveBy(.6,cc.p(0,-10))))))},ChangeItemNum:function(e){this.m_pNum.string=e,this._itemCount=e},ChangeItemLevel:function(e){this.m_pLevel.node.active=!0,this.m_pLevel.string=e},InitData:function(){this.m_pAddspr.node.active=!1,this.SetSelect(!1),this.ShowArrow(!1),null!=this._tiereffect&&this._tiereffect.active&&(this._tiereffect.active=!1),this.GetItemCfg(),this._isEmpty=!1,this._itemjsoninfo=this._itemcfg[this._itemId],this.SetFragment()},ChangeItemData:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];this._itemId=e.template_id,this._itemCount=e.num,this.InitData(),this._cb=t;this._uuid=e.uuid,this.m_pQuality.spriteFrame=this.m_pQualityFrame[this._itemjsoninfo.quality+1],a?(this.m_pNum.node.active=!0,this.m_pNum.string=e.num):this.m_pNum.node.active=!1,this.LoadIcon(),null!=e.heroid&&(this.m_pEquipType.node.active=!0);var n=new cc.Component.EventHandler;n.target=this.node,n.component="ItemBox",n.handler="OnClickHandler",n.customEventData=e,this.node.getComponent(cc.Button).clickEvents[0]=n},ChangeItemInfo:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=4<arguments.length&&void 0!==arguments[4]&&arguments[4],r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;this._cb=n;this._itemId=e,this._itemCount=t,this.InitData(),2==this._itemType?(this.m_pQuality.spriteFrame=this.m_pUnitFrame[this._itemjsoninfo.quality],this.m_pActionFrame.spriteFrame=this.mUnitEquipFlashBg[1]):(this.m_pQuality.spriteFrame=this.m_pQualityFrame[this._itemjsoninfo.quality+1],this.m_pActionFrame.spriteFrame=this.mUnitEquipFlashBg[0]),a?(this.m_pNum.node.active=!0,this.m_pNum.string=t):this.m_pNum.node.active=!1,this.LoadIcon(),4==this._itemType&&(this.m_pSoilderType.node.active=!0,this.m_pSoilderType.spriteFrame=this.Res_type_rune);var s=new cc.Component.EventHandler;s.target=this.node,s.component="ItemBox",s.handler="OnClickHandler",s.customEventData=[this._itemId,this._itemCount,this._itemjsoninfo],this.node.getComponent(cc.Button).clickEvents[0]=s,i&&(this.node.on("touchstart",this._showItemDetail,this),this.node.on("touchmove",this.touchMoveCb,this),this.node.on("touchend",this._closeItemDetail,this),this.node.on("touchcancel",this._closeItemDetail,this)),null!=r&&(this._longPressCb=r,this.node.on("touchstart",this._longPressStart,this),this.node.on("touchmove",this._longPressMove,this),this.node.on("touchend",this._longPressEnd,this),this.node.on("touchcancel",this._longPressCancel,this))},touchMoveCb:function(e){if(null!=this._tipNode){if(!cc.isValid(this._tipNode))
return void(this._tipNode=null);this._tipNode.getComponent("Tips").onTouchMove(e)}},ChangeEquipInfo:function(e){this._cb=e.cb;this._itemId=e.template_id,this._uuid=e.uuid;var t=null==e.pos?-1:e.pos,a=e.showlvbg||!1,n=e.shownum||!1,i=e.showlv||!1;this.InitData(),this.m_pNum.node.active=n,this.m_pLvBg.node.active=a,this.m_pLevel.node.active=i,n&&(this.m_pNum.string=e.num),i&&(this.m_pLevel.string=e.level,4<t&&(this.m_pLevel.string="+"+e.level)),this.m_pQuality.spriteFrame=this.m_pQualityFrame[this._itemjsoninfo.quality+1],this.LoadIcon(),this.SetUnitAttr(e.uuid);var r=new cc.Component.EventHandler;r.target=this.node,r.component="ItemBox",r.handler="OnClickHandler",r.customEventData={pos:t,id:e.template_id,lv:e.level,json:this._itemjsoninfo},this.node.getComponent(cc.Button).clickEvents[0]=r},ChangeHeroInfo:function(e,t,a){var n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=arguments[5];this._cb=i;this._itemId=e,this.InitData(),this.m_pQuality.spriteFrame=this.m_pQualityFrame[this._itemjsoninfo.quality+1],this.m_pNum.node.active=!1,this.m_pAddspr.node.active=!1,this.m_pLevel.node.active=!0,this.m_pLvBg.node.active=r||!1,n&&(this.m_pNum.node.active=!0,this.m_pNum.string=t),this.m_pLevel.string=a,this.LoadIcon();var s=new cc.Component.EventHandler;s.target=this.node,s.component="ItemBox",s.handler="OnClickHandler",s.customEventData={id:e,lv:a,num:t,json:this._itemjsoninfo},this.node.getComponent(cc.Button).clickEvents[0]=s},SetUnitAttr:function(e){if(""!=e){var t=MyPersistDataManager._playerData.bagMap[e];if(null!=t.unitAttr&&0!=t.unitAttr.id&&(this.m_pSoilderType.node.active=!0,this.m_pSoilderType.spriteFrame=this.m_pSoilderTypeFrame[this._itemjsoninfo.unit_type-1]),null!=t.heroid)
DonotDestroyManager.GameData.Cards[t.heroid].unit_type!=this._itemjsoninfo.unit_type?n.setGaryShader(this.m_pSoilderType.node):n.resetShader(this.m_pSoilderType.node);else
n.setGaryShader(this.m_pSoilderType.node)}else
this.m_pSoilderType.node.active=!1},LoadIcon:function(){var a=this,e="";switch(this._itemType){case 0:e="UI/Items/"+this._itemjsoninfo.icon.replace(".png","");break;case 1:e="UI/Heros/"+this._itemjsoninfo.icon.replace(".png","");break;case 2:e="UI/UnitsEquips/"+this._itemjsoninfo.icon.replace(".png","");break;case 3:e="UI/HeadFrame/"+this._itemjsoninfo.icon.replace(".png","");break;case 4:e="UI/Rune/"+this._itemjsoninfo.icon}
cc.loader.loadRes(e,cc.SpriteFrame,function(e,t){null==e?(cc.loader.setAutoReleaseRecursively(t,!0),a.m_pIcon.node.active||(a.m_pIcon.node.active=!0),a.m_pIcon.spriteFrame=t):cc.error(e.message)})},GetItemCfg:function(){this._itemType=0,null!=DonotDestroyManager.GameData.Consumes[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Consumes:null!=DonotDestroyManager.GameData.Boxes[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Boxes:null!=DonotDestroyManager.GameData.Items[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Items:null!=DonotDestroyManager.GameData.Equips[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Equips:null!=DonotDestroyManager.GameData.EquipFrags[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.EquipFrags:null!=DonotDestroyManager.GameData.Treasures[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Treasures:null!=DonotDestroyManager.GameData.CardFrags[this._itemId]?(this._itemcfg=DonotDestroyManager.GameData.CardFrags,this._itemType=1):null!=DonotDestroyManager.GameData.UnitsEquips[this._itemId]?(this._itemcfg=DonotDestroyManager.GameData.UnitsEquips,this._itemType=2):null!=DonotDestroyManager.GameData.TreasureFrags[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.TreasureFrags:null!=DonotDestroyManager.GameData.HeadFrameFrags[this._itemId]?(this._itemcfg=DonotDestroyManager.GameData.HeadFrameFrags,this._itemType=3):null!=DonotDestroyManager.GameData.Runes[this._itemId]?(this._itemcfg=DonotDestroyManager.GameData.Runes,this._itemType=4):null!=DonotDestroyManager.GameData.Cards[this._itemId]&&(this._itemcfg=DonotDestroyManager.GameData.Cards,this._itemType=1)},InitEmptyContent:function(){this._itemjsoninfo=null,this.SetFragment(),this.SetSelect(!1),this.ShowArrow(!1),null!=this._tiereffect&&this._tiereffect.active&&(this._tiereffect.active=!1),this._cb=null,this._itemId=0,this._itemCount=0,this._uuid="",this.m_pEquipType.node.active=!1,this.m_pSoilderType.node.active=!1,this.m_pLevel.node.active=!1,this.m_pIcon.node.active=!1,this.m_pNum.node.active=!1,this.m_pLvBg.node.active=!1,this._isEmpty=!0},SetEmptyItem:function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0],1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.InitEmptyContent(),this.SetSelect(!1),this.m_pQuality.spriteFrame=this.m_pQualityFrame[0]},SetCanEquipEmptyItem:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;switch(this.InitEmptyContent(),this._cb=n,t){case 1:this.m_pQuality.spriteFrame=this.m_pEquipNormalFrame[e];break;case 2:this.m_pQuality.spriteFrame=this.m_pUnitNilBg[e]}
0==a?this.m_pAddspr.node.active=!1:1==a?(this.m_pAddspr.spriteFrame=this.m_pAddSprFrame[0],this.m_pAddspr.node.active=!0):2==a&&(this.m_pAddspr.spriteFrame=this.m_pAddSprFrame[1],this.m_pAddspr.node.active=!0),null!=this._tiereffect&&this._tiereffect.active&&(this._tiereffect.active=!1);var i=new cc.Component.EventHandler;i.target=this.node,i.component="ItemBox",i.handler="OnClickHandler",i.customEventData=e+1,this.node.getComponent(cc.Button).clickEvents[0]=i},SetFragment:function(){this.m_pSoilderType.node.active&&(this.m_pSoilderType.node.active=!1),this.m_pEquipType.node.active&&(this.m_pEquipType.node.active=!1),this.m_pFrag.node.active&&(this.m_pFrag.node.active=!1),null!=this._itemjsoninfo&&(null!=this._itemjsoninfo.equip&&0<this._itemjsoninfo.equip?this.m_pFrag.node.active=!0:null!=this._itemjsoninfo.card_id&&0<this._itemjsoninfo.card_id&&(this.m_pFrag.node.active=!0))},OnClickHandler:function(e,t){i.playBtnOpenEffect(),null!=this._cb&&this._cb(e.target||e.currentTarget,t)},_showItemDetail:function(e){null!=this._tipNode&&(this._tipNode.removeFromParent(),this._tipNode.destroy(),this._tipNode=null),this._tipNode=cc.instantiate(DonotDestroyManager.DescribeTip),cc.Canvas.instance.node.addChild(this._tipNode),this._tipNode.getComponent("Tips").initItemData(this._itemId,this._itemjsoninfo);var t=cc.Canvas.instance.node.convertTouchToNodeSpaceAR(e.touch);t.x<-70?t.x+=500:t.x-=50,80<t.y?t.y-=250:t.y+=50,this._tipNode.setPosition(t)},_closeItemDetail:function(e){null!=this._tipNode&&(cc.log("close detail panel"+e),this._tipNode.removeFromParent(),this._tipNode.destroy(),this._tipNode=null)},_longPressStart:function(e){this._beganTouchPos=e.touch.getLocation(),this._isLongPress=!0,this._longPressTime=0},_longPressMove:function(e){var t=e.touch.getLocation();this._isLongPress&&40<cc.pDistance(this._beganTouchPos,t)&&(this._isLongPress=!1,this._longPressTime=0,this._longPressCb(2,this))},_longPressEnd:function(e){this._isLongPress=!1,this._longPressTime=0},_longPressCancel:function(e){this._isLongPress=!1,this._longPressTime=0,this._longPressCb(2,this)},update:function(e){this._isLongPress&&(this._longPressTime+=e,.5<=this._longPressTime&&cc.director.getTotalFrames()%3==0&&this._longPressCb(1,this))}}),cc._RF.pop()},{ShaderUtil:"ShaderUtil",SoundUtil:"SoundUtil"}],ItemBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"309f1mhsA1CuaXuZCI9O1Hq","ItemBufferMgr");var n=e("ItemsConfigMgr"),i=e("HeroFragBufferMgr"),r=e("EquipBufferMgr"),s=e("TreasureBufferMgr"),o=e("TreaFragBufferMgr"),c=e("RunesBufferMgr"),l=e("ConsumeBufferMgr"),h=e("EquipFragBufferMgr"),d=function(){this.resetData()};d.prototype.resetData=function(){this.g_itemList=[],this.is_init=!1},d.prototype.sortItemFunc=function(e,t){var a=e.itemCfg,n=t.itemCfg;return a.quality!=n.quality?n.quality-a.quality:a.itemType!=n.itemType?n.itemType-a.itemType:e.num!=t.num?t.num-e.num:t.template_id-e.template_id},d.prototype.sortItemList=function(){0<this.getItemListCnt()&&this.g_itemList.sort(this.sortItemFunc.bind(this))},d.prototype.getList=function(){return this.g_itemList},d.prototype.initItemList=function(e){if(!this.is_init){if(this.is_init=!0,0==e.length)
return this.g_itemList=[],i.initHeroFragList([]),r.getInstance().initEquipList([]),l.initList([]),h.initList([]),s.getInstance().initTreasureList([]),void o.initTreasureFragList([]);var t=this.processItems(e);i.initHeroFragList(t[0]),this.g_itemList=[];for(var a=0;a<t[1].length;++a)
0<t[1][a].num&&(t[1][a].itemCfg=n.getItemByItemId(t[1][a].template_id),this.g_itemList.push(t[1][a]));l.initList(t[2]),r.getInstance().initEquipList(t[3]),h.initList(t[4]),s.getInstance().initTreasureList(t[5]),o.initTreasureFragList(t[6]),c.initRuneList(t[8])}},d.prototype.processItems=function(e){for(var t=[],a=0;a<9;++a)
t.push([]);for(a=0;a<e.length;++a)
this.isheroFragEntity(e[a].template_id)?t[0].push(e[a]):this.isItemEntity(e[a].template_id)?t[1].push(e[a]):this.isConsumeEntity(e[a].template_id)?t[2].push(e[a]):this.isEquipEntity(e[a].template_id)?t[3].push(e[a]):this.isEquipFragEntity(e[a].template_id)?t[4].push(e[a]):this.isTreasureEntity(e[a].template_id)?t[5].push(e[a]):this.isTreasureFragEntity(e[a].template_id)?t[6].push(e[a]):this.isArmyEquitEntity(e[a].template_id)?t[7].push(e[a]):this.isRuneEntity(e[a].template_id)&&t[8].push(e[a]);return t},d.prototype.isHeroEntity=function(e){return 1<=e&&e<=499},d.prototype.isheroFragEntity=function(e){return 500<=e&&e<=999},d.prototype.isCommonItem=function(e){return 1450<=e&&e<=1455},d.prototype.isConsumeEntity=function(e){for(var t=n.getBoxKeyList(),a=0;a<t.length;++a)
if(t[a]==e)
return!0;return 1200<=e&&e<=1999},d.prototype.isBoxEntity=function(e){return 1600<=e&&e<=1999},d.prototype.isItemEntity=function(e){for(var t=n.getBoxKeyList(),a=0;a<t.length;++a)
if(t[a]==e)
return!1;return 1e3<=e&&e<=1199},d.prototype.isEquipEntity=function(e){return 2e3<=e&&e<=2499},d.prototype.isEquipFragEntity=function(e){return 2500<=e&&e<=2999},d.prototype.isTreasureEntity=function(e){return 3e3<=e&&e<=3499},d.prototype.isTreasureFragEntity=function(e){return 3500<=e&&e<=3999},d.prototype.isArmyEquitEntity=function(e){return 4e3<=e&&e<4500},d.prototype.isRuneEntity=function(e){return 5e3<=e&&e<5500},d.prototype.getItemListCnt=function(){return this.g_itemList.length},d.prototype.changeItemNumByTmpId=function(e,t){for(var a=null,n=0,i=0;i<this.g_itemList.length;++i){var r=this.g_itemList[i];r.template_id==e&&(a=r,n=i)}
null!=a&&t<=0&&this.g_itemList.splice(n,1)},d.prototype.AddItemEntity=function(e){for(var t=null,a=0;a<this.g_itemList.length;++a){var n=this.g_itemList[a];n.template_id==e.template_id&&(t=n)}
null!=t?t.num=e.num:this.g_itemList.push(e)},d.prototype.addItemNumByTmpId=function(e,t,a){this.isheroFragEntity(e)?i.addFragNumByTid(e,t):this.isItemEntity(e)?this.changeItemNumByTmpId(e,t):this.isConsumeEntity(e)?l.AddConsumeNum(e,t):this.isEquipEntity(e)&&t<=0?r.getInstance().removeEquip(a):this.isEquipFragEntity(e)?h.AddEquipFragNum(e,t):this.isTreasureEntity(e)&&t<=0?s.getInstance().removeTreasure(a):this.isTreasureFragEntity(e)?o.AddTreaFragNum(e,t):this.isRuneEntity(e)&&c.AddRuneNum(e,t)},d.prototype.addItem=function(e){if(this.isheroFragEntity(e.template_id))
return i.addHeroFrag(e);this.isItemEntity(e.template_id)?this.AddItemEntity(e):this.isConsumeEntity(e.template_id)?l.AddConsumeEntity(e):this.isEquipEntity(e.template_id)?r.getInstance().addEquipEntity(e):this.isEquipFragEntity(e.template_id)?h.AddEquipFragEntity(e):this.isTreasureEntity(e.template_id)?s.getInstance().addTreaEntity(e):this.isTreasureFragEntity(e.template_id)?o.AddTreaFragEntity(e):this.isRuneEntity(e.template_id)&&c.AddRuneEntity(e)},d.prototype.GetItemCfgById=function(e){var t=null;return null!=DonotDestroyManager.GameData.Consumes[e]?t=DonotDestroyManager.GameData.Consumes:DonotDestroyManager.GameData.Boxes[e]?t=DonotDestroyManager.GameData.Boxes:DonotDestroyManager.GameData.Items[e]?t=DonotDestroyManager.GameData.Items:DonotDestroyManager.GameData.Equips[e]?t=DonotDestroyManager.GameData.Equips:DonotDestroyManager.GameData.EquipFrags[e]?t=DonotDestroyManager.GameData.EquipFrags:DonotDestroyManager.GameData.Treasures[e]?t=DonotDestroyManager.GameData.Treasures:DonotDestroyManager.GameData.UnitsEquips[e]?t=DonotDestroyManager.GameData.UnitsEquips:DonotDestroyManager.GameData.TreasureFrags[e]?t=DonotDestroyManager.GameData.TreasureFrags:null!=DonotDestroyManager.GameData.CardFrags[e]?t=DonotDestroyManager.GameData.CardFrags:null!=DonotDestroyManager.GameData.Cards[e]&&(t=DonotDestroyManager.GameData.Cards),t[e]},t.exports=new d,cc._RF.pop()},{ConsumeBufferMgr:"ConsumeBufferMgr",EquipBufferMgr:"EquipBufferMgr",EquipFragBufferMgr:"EquipFragBufferMgr",HeroFragBufferMgr:"HeroFragBufferMgr",ItemsConfigMgr:"ItemsConfigMgr",RunesBufferMgr:"RunesBufferMgr",TreaFragBufferMgr:"TreaFragBufferMgr",TreasureBufferMgr:"TreasureBufferMgr"}],ItemCfgUtilMgr:[function(e,t,a){"use strict";cc._RF.push(t,"040e0w4hZJOHphlIFgho3ol","ItemCfgUtilMgr");var n=function(){};n.getItemInfoCfgById=function(e){var t,a;return null!=DonotDestroyManager.GameData.Consumes[e]?(a=DonotDestroyManager.GameData.Consumes[e],t=3):null!=DonotDestroyManager.GameData.Boxes[e]?(a=DonotDestroyManager.GameData.Boxes[e],t=9):null!=DonotDestroyManager.GameData.Items[e]?(a=DonotDestroyManager.GameData.Items[e],t=2):null!=DonotDestroyManager.GameData.Equips[e]?(a=DonotDestroyManager.GameData.Equips[e],t=4):null!=DonotDestroyManager.GameData.EquipFrags[e]?(a=DonotDestroyManager.GameData.EquipFrags[e],t=5):null!=DonotDestroyManager.GameData.Treasures[e]?(a=DonotDestroyManager.GameData.Treasures[e],t=6):null!=DonotDestroyManager.GameData.CardFrags[e]?(a=DonotDestroyManager.GameData.CardFrags[e],t=1):null!=DonotDestroyManager.GameData.UnitsEquips[e]?(a=DonotDestroyManager.GameData.UnitsEquips[e],t=8):null!=DonotDestroyManager.GameData.TreasureFrags[e]?(a=DonotDestroyManager.GameData.TreasureFrags[e],t=7):null!=DonotDestroyManager.GameData.Cards[e]&&(a=DonotDestroyManager.GameData.Cards[e],t=0),[t,a]},t.exports=n,cc._RF.pop()},{}],ItemsConfigMgr:[function(e,t,a){"use strict";cc._RF.push(t,"905c19plVNBF5gzxnRvsdMx","ItemsConfigMgr");var n=function(){};n.prototype.getBoxKeyList=function(){for(var e=[],t=Object.keys(DonotDestroyManager.GameData.Boxes),a=0;a<t.length;++a){var n=DonotDestroyManager.GameData.Boxes[t[a]].key[0];0<n&&e.push(n)}
return e},n.prototype.processItemCfg=function(e){var t=null;return null!=DonotDestroyManager.GameData.Consumes[e]?t=DonotDestroyManager.GameData.Consumes[e]:null!=DonotDestroyManager.GameData.Boxes[e]?t=DonotDestroyManager.GameData.Boxes[e]:null!=DonotDestroyManager.GameData.Items[e]?t=DonotDestroyManager.GameData.Items[e]:null!=DonotDestroyManager.GameData.Equips[e]?t=DonotDestroyManager.GameData.Equips[e]:null!=DonotDestroyManager.GameData.EquipFrags[e]?t=DonotDestroyManager.GameData.EquipFrags[e]:null!=DonotDestroyManager.GameData.Treasures[e]?t=DonotDestroyManager.GameData.Treasures[e]:null!=DonotDestroyManager.GameData.CardFrags[e]?t=DonotDestroyManager.GameData.CardFrags[e]:null!=DonotDestroyManager.GameData.UnitsEquips[e]?t=DonotDestroyManager.GameData.UnitsEquips[e]:null!=DonotDestroyManager.GameData.TreasureFrags[e]?t=DonotDestroyManager.GameData.TreasureFrags[e]:null!=DonotDestroyManager.GameData.HeadFrameFrags[e]?t=DonotDestroyManager.GameData.HeadFrameFrags[e]:null!=DonotDestroyManager.GameData.Runes[e]?t=DonotDestroyManager.GameData.Runes[e]:null!=DonotDestroyManager.GameData.Cards[e]&&(t=DonotDestroyManager.GameData.Cards[e]),t},n.prototype.getItemByItemId=function(e){return this.processItemCfg(e)},n.prototype.getItemCnt=function(){},t.exports=new n,cc._RF.pop()},{}],LabelLocalized:[function(e,t,a){"use strict";cc._RF.push(t,"736b2KMUMtPKbHcOBnkP/hc","LabelLocalized");var n=e("i18n");cc.Class({extends:cc.Label,properties:{textKey:{default:"TEXT_KEY",multiline:!0,tooltip:"Enter i18n key here",notify:function(){this._sgNode&&(this._sgNode.setString(this.string),this._updateNodeSize())}},string:{override:!0,tooltip:"Here shows the localized string of Text Key",get:function(){return n.t(this.textKey)},set:function(e){this.textKey=e,cc.warn("Please set label text key in Text Key property.")}}}}),cc._RF.pop()},{i18n:"i18n"}],LejiSocket:[function(e,t,a){"use strict";cc._RF.push(t,"a03c0E6mutMi5D+WUC1dB9u","LejiSocket");var r=e("WsDecoder"),s=(e("WsEncoder"),e("NetEvent")),o=e("MyEventDispatcher"),c=e("MyProtocols"),l=e("i18n"),n=function(e){this.host_addr=e,this._cache_msg=null,this.initWebSocket()};n.prototype.initWebSocket=function(){cc.log("websocket init,host="+this.host_addr),this._webSocket=new WebSocket(this.host_addr),this._webSocket.binaryType="arraybuffer",this._conn_status=-1;var a=this;this._webSocket.onopen=function(e){cc.log("WebSocket was opened."+e),a._conn_status=0};a=this;this._webSocket.onmessage=function(e){cc.log("WebSocket onmessage!");var t=e.data;a._decodeByteArray(t)},this._webSocket.onerror=function(e){cc.log("Websocket fired an error"+e),a._conn_status=1,o.dispatchEvent("NetWork-Error",this)},this._webSocket.onclose=function(e){cc.log("WebSocket instance closed."+e),a._conn_status=2,o.dispatchEvent("NetWork-Error",this)}},n.prototype._decodeByteArray=function(e){var t=r.alloc(e),a=t.readInt();if(cc.log("msgCode=%d",a),a==s.ErrorCode){var n=t.readInt();cc.error("error:%d %s",n,l.t(n)),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),l.t(n))}else if(null==c["get_"+a])
cc.error("proto:%d not defined!",a);else{var i=c["get_"+a].call(null,t);o.dispatchEvent(a,i)}
t.free()},n.prototype.sendMessage=function(e){if(0!=this._conn_status)
return cc.log("WebSocket instance wasn't ready..."),this._cache_msg=e,void o.dispatchEvent("NetWork-Error",this);var t=new Uint8Array(e);this._webSocket.send(t)},n.prototype.close=function(){this._webSocket.readyState===WebSocket.OPEN&&this._webSocket.close()},n.prototype.isConnected=function(){return 0==this._conn_status},n.prototype.isError=function(){return 1==this._conn_status||2==this._conn_status},n.prototype.reconnect=function(){1!=this._conn_status&&2!=this._conn_status&&null!=this._webSocket&&this._webSocket.close(),this._webSocket=null,this.initWebSocket()},n.prototype.clear=function(){this._webSocket=null,this._conn_status=-1,this._cache_msg=null},t.exports=n,cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",WsDecoder:"WsDecoder",WsEncoder:"WsEncoder",i18n:"i18n"}],LevelUpLayer:[function(e,t,a){"use strict";cc._RF.push(t,"19e1cUUaHFFRZsopMwD+qNS","LevelUpLayer");var l=e("LevelsCfgMgr"),h=e("PlayerBufferMgr"),n=e("UnLockCfgMgr"),i=e("SoundUtil");cc.Class({extends:cc.Component,properties:{mArmatureDisplay:sp.Skeleton,_showFinish:!1},setParams:function(e,t,a){this.initData(e,t,a),this.setDefUI(),this.initUI()},initData:function(e,t,a){this.mValueToList=new Array(3),this.mValueList=new Array(3),this.mTitleList=new Array(3),this.mArrowList=new Array(3),this.mCallback=a,this.mIsClose=!1;for(var n=l.getLevelInfo(t),i=h.getUserEnergy(),r=h.getUserStamina(),s=i,o=r,c=e+1;c<=t;c++){null!=(n=l.getLevelInfo(c))&&(s-=n.add_energy,o-=n.add_stamina)}
o=o<0?0:o,s=s<0?0:s,this.mData=[[e,t],[s,i],[o,r]]},setDefUI:function(){this.node.getChildByName("bg Sprite").on("touchstart",this.touchClick,this),this.Panel_Frame=this.node.getChildByName("Panel_Frame"),this.Panel_Frame.opacity=0;for(var e=1;e<=this.mData.length;e++){var t=this.node.getChildByName("Value_To_"+e);this.mValueToList[e-1]=t,this.mValueToList[e-1].opacity=0,this.mValueList[e-1]=this.node.getChildByName("Value_"+e),this.mValueList[e-1].opacity=0,this.mTitleList[e-1]=this.node.getChildByName("Label_"+e),this.mTitleList[e-1].opacity=0,this.mArrowList[e-1]=this.node.getChildByName("Image_"+e),this.mArrowList[e-1].opacity=0}
this.line=this.node.getChildByName("level_title2"),this.line.opacity=0,this.mUnLock=this.node.getChildByName("Value_4"),this.mUnLock.opacity=0,this.mUnLock.getComponent(cc.Label).string=this.getUnLockDes()},touchClick:function(e){this._showFinish&&(this.node.destroy(),null!=this.mCallback&&this.mCallback(),n.checkNewUnLockFunc())},initUI:function(){i.playLevelUpEffect();var s=this;this.playAmr(function(){s.runFadeAction(s.Panel_Frame,function(){var e=cc.callFunc(function(){for(var e=0;e<s.mTitleList.length;e++){var t=s.mTitleList[e];s.runFadeAction(t)}}),t=cc.callFunc(function(){for(var e=0;e<s.mValueList.length;e++){var t=s.mValueList[e];s.runFadeAction(t),t.getComponent(cc.Label).string=s.mData[e][0]}}),a=cc.callFunc(function(){for(var e=0;e<s.mArrowList.length;e++){var t=s.mArrowList[e];s.runFadeAction(t)}}),n=cc.callFunc(function(){for(var e=0;e<s.mValueToList.length;e++){var t=s.mValueToList[e];t.opacity=255,t.getComponent(cc.Label).string=s.mData[e][1]}}),i=cc.callFunc(function(){s.runFadeAction(s.line),s.runFadeAction(s.mUnLock,function(){s.initCloseBtn()})}),r=cc.delayTime(.2);s.node.runAction(cc.sequence(e,r,t,r,a,r,n,cc.delayTime(.1),i))})})},initCloseBtn:function(){this._showFinish=!0},playAmr:function(a){this.mArmatureDisplay.setAnimation(0,"LevelUp",!1),this.mArmatureDisplay.setEventListener(function(e,t){"show"==t.data.name&&a()})},getUnLockDes:function(){return n.getOpenLuckInfoByLevel(h.getUserLevel())},runFadeAction:function(e,t){null!=t?e.runAction(cc.sequence(cc.delayTime(.3),cc.fadeIn(.1),cc.callFunc(t))):e.runAction(cc.sequence(cc.delayTime(.3),cc.fadeIn(.1)))}}),cc._RF.pop()},{LevelsCfgMgr:"LevelsCfgMgr",PlayerBufferMgr:"PlayerBufferMgr",SoundUtil:"SoundUtil",UnLockCfgMgr:"UnLockCfgMgr"}],LevelsCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"7ffa834SZBNWZuaXf6RMPgc","LevelsCfgMgr");var n=function(){};n.getLevelInfo=function(e){return DonotDestroyManager.GameData.Levels[e-1]},t.exports=n,cc._RF.pop()},{}],LoadingLayerCtrl:[function(e,t,a){"use strict";cc._RF.push(t,"818e3cslVlEeY15Y3eCBDml","LoadingLayerCtrl"),cc.Class({extends:cc.Component,properties:{progressBar_ctrl:{default:null,type:cc.ProgressBar},cursor_node:{default:null,type:cc.Node}},onLoad:function(){},changeProgress:function(e){this.progressBar_ctrl.progress=e,this.cursor_node.x=700*e-350}}),cc._RF.pop()},{}],LoginEnterNamePwd:[function(n,e,t){"use strict";cc._RF.push(e,"d1b3eQ4ye5Iz6lPVzeDIJxp","LoginEnterNamePwd");n("WsEncoder");var a=n("NetEvent"),i=n("MyEventDispatcher"),r=n("SoundUtil"),s=n("MyProtocols"),o=n("MyUIEvent"),c=n("i18n");cc.Class({extends:cc.Component,properties:{name_input:cc.EditBox,pwd_input:cc.EditBox,test_login_group:cc.Node,_existInterval:null},onLoad:function(){this.node.on("touchstart",function(){});var t=this;t.node.opacity=0,setTimeout(function(){var e=cc.fadeIn(.2);t.node.runAction(e)},20),this._login_auth_cb_func=this._login_auth_cb.bind(this),i.addListener(a.S2CLogin,this._login_auth_cb_func),this.guest_login_auth_cb_func=this.guest_login_auth_cb.bind(this),i.addListener(a.S2CGuestLogin,this.guest_login_auth_cb_func),this.S2CH5OpenLogin_cb_func=this.S2CH5OpenLogin_cb.bind(this),i.addListener(a.S2CH5OpenLogin,this.S2CH5OpenLogin_cb_func),this.YiJieLoginSuccessJsbCallback_cb_func=this.YiJieLoginSuccessJsbCallback_cb.bind(this),i.addListener(o.YiJieLoginSuccessJsbCallback,this.YiJieLoginSuccessJsbCallback_cb_func)},start:function(){if(null!=window.open_platform)
switch(window.open_platform){case 1:this.test_login_group.active=!1,this.sendQunheiLogin();break;case 2:this.test_login_group.active=!1,this.sendWanbaLogin();break;case 3:this.test_login_group.active=!1,this.sendZhangMengLogin();break;case 4:this.test_login_group.active=!1,this.sendThree33Login();break;case 5:this.test_login_group.active=!1,this.sendChongchongLogin();break;case 6:this.test_login_group.active=!1,this.send4399Login()}},YiJieLoginSuccessJsbCallback_cb:function(e){this.sendYiJieLogin(e.appId,e.channelId,e.userId,e.token)},sendYiJieLogin:function(e,t,a,n){this.sendLogin2Server(function(){s.send_C2SYiJieLogin(DonotDestroyManager._loginSocket,e,t,a,n)})},send4399Login:function(){this.sendLogin2Server(function(){s.send_C2S4399Login(DonotDestroyManager._loginSocket,window.OPEN4399.gameId,window.OPEN4399.time,window.OPEN4399.userId,window.OPEN4399.userName,window.OPEN4399.sign)})},sendChongchongLogin:function(){this.sendLogin2Server(function(){s.send_C2SChongChongLogin(DonotDestroyManager._loginSocket,window.CHONGCHONG.userId,window.CHONGCHONG.time,window.CHONGCHONG.sign)})},sendThree33Login:function(){this.sendLogin2Server(function(){s.send_C2SThree33Login(DonotDestroyManager._loginSocket,window.THREE33.gameId,window.THREE33.time,window.THREE33.uid,window.THREE33.userName,window.THREE33.sign)})},sendZhangMengLogin:function(){this.sendLogin2Server(function(){s.send_C2SZhangMengLogin(DonotDestroyManager._loginSocket,window.ZMuserdata.uid,window.ZMuserdata.t,window.ZMuserdata.sign)})},sendWanbaLogin:function(){this.sendLogin2Server(function(){window.getOpenKey(function(e){s.send_C2SWanbaLogin(DonotDestroyManager._loginSocket,window.OPEN_DATA.appid,window.OPEN_DATA.openid,window.OPEN_DATA.openkey,window.OPEN_DATA.platform,window.OPEN_DATA.pf)})})},sendQunheiLogin:function(){this.sendLogin2Server(function(){var e=window.qunhei_uname,t=window.qunhei_serverid,a=window.qunhei_time,n=window.qunhei_isadult,i=window.qunhei_flag;s.send_C2SQunheiLogin(DonotDestroyManager._loginSocket,e,t,n,a,i)})},S2CH5OpenLogin_cb:function(e){MyUiManager.Back()},onDestroy:function(){i.removeListener(a.S2CLogin,this._login_auth_cb_func),i.removeListener(a.S2CGuestLogin,this.guest_login_auth_cb_func),i.removeListener(a.S2CH5OpenLogin,this.S2CH5OpenLogin_cb_func),i.removeListener(o.YiJieLoginSuccessJsbCallback,this.YiJieLoginSuccessJsbCallback_cb_func)},_login_auth_cb:function(e){var t=e.uid,a=e.session_id;n("LoginSceneManager").getInstance()._sessionid=a,cc.log("server return,uid=%d,session_id=%s",t,a),this.SendC2SServerList(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),c.t("login_success")),MyUiManager.Back(),s.send_C2SGetAnnounce(DonotDestroyManager._loginSocket)},guest_login_auth_cb:function(e){var t=e.uid,a=e.session_id;n("LoginSceneManager").getInstance()._sessionid=a,cc.sys.localStorage.setItem("guestUid",t),cc.log("guest login server return,uid=%d,session_id=%s",t,a),this.SendC2SServerList(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),c.t("login_success")),MyUiManager.Back(),s.send_C2SGetAnnounce(DonotDestroyManager._loginSocket)},SendC2SServerList:function(){cc.log(" gửi đi phục vụ khí liệt biểu tin tức "),s.send_C2SServerList(DonotDestroyManager._loginSocket)},doAuth:function(){if(r.playBtnOpenEffect(),null==window.open_platform){0;var e=this.name_input.string,t=this.pwd_input.string,xmlhttp;if(null==e||0==e.length||null==t||0==t.length)
return cc.log("error1!"),void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin hãy điền tên đăng nhập!");cc.log("do auth!,name=%s,pwd=%s",e,t),xmlhttp=new XMLHttpRequest();xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(xmlhttp.responseText!=1){return cc.log("error1!"),void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),xmlhttp.responseText);}else{s.send_C2SLogin(DonotDestroyManager._loginSocket,e,t)}}}
xmlhttp.open("GET","api.php?user="+e+"&pass="+t);xmlhttp.send();}else
switch(window.open_platform){case 1:this.sendQunheiLogin();break;case 2:this.sendWanbaLogin();break;case 3:this.sendZhangMengLogin();break;case 4:this.sendThree33Login();break;case 5:this.sendChongchongLogin();break;case 6:this.send4399Login()}},doGuestLogin:function(){return cc.log("error1!"),void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130)," cấm du khách đăng ký ！");},sendLogin2Server:function(e){null!=this._existInterval&&clearInterval(this._existInterval),this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node);var t=this,a=0;this._existInterval=setInterval(function(){cc.log("query login server status!"),DonotDestroyManager._loginSocket.isConnected()&&(null!=e&&e(),clearInterval(t._existInterval),(t._existInterval=null)!=t._shortMask_node&&(t._shortMask_node.removeFromParent(),t._shortMask_node.destroy(),t._shortMask_node=null)),(3e3<(a+=200)||DonotDestroyManager._loginSocket.isError())&&(cc.log("reconnect login socket!"),a=0,DonotDestroyManager._loginSocket.reconnect())},200)}}),cc._RF.pop()},{LoginSceneManager:"LoginSceneManager",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",WsEncoder:"WsEncoder",i18n:"i18n"}],LoginSceneManager:[function(e,t,a){"use strict";cc._RF.push(t,"0b362cAhhVKDKgWZb186KuT","LoginSceneManager");e("WsEncoder");var n=e("NetEvent"),i=e("MyEventDispatcher"),r=e("MyProtocols"),c=e("LejiSocket"),m=e("TeamSkillBufferMgr"),p=e("PlayerBufferMgr"),l=e("i18n"),s=e("SoundUtil"),o=e("GameUtils"),f=e("MarqueeBufferMgr"),h=e("MyUIEvent"),d=cc.Class({extends:cc.Component,properties:{logoAni:cc.Node,playerFlashAni:cc.Node,bottomNode:cc.Node,rightNode:cc.Node,btn_refresh:cc.Node,m_pServerName:cc.Label,m_pServerId:cc.Label,labelCopyright:cc.Label,prefab_announce:cc.Prefab,_curSelectServerInfo:null,_sessionid:null,_serverList:[],_shortMask_node:cc.Node,_announceContent:"",_existInterval:null,_ios_appstore_ret:null},onLoad:function(){cc.log("game onload!");var e=(d.instance=this).logoAni.getComponent(sp.Skeleton);(e.setCompleteListener(this._animationEventHandler.bind(this)),e.setAnimation(0,"start",!1),e.addAnimation(0,"loop",!0,0),setTimeout(function(e){var t=cc.moveBy(.3,cc.p(0,226));e.bottomNode.runAction(t),e.rightNode.runAction(cc.moveBy(.3,cc.p(-320,0)))},500,this),cc.sys.isBrowser&&null==window.open_platform&&0==DonotDestroyManager.jsbChannel&&MyUiManager.Open(MyUiManager.PanelInfo.LoginNamePwdPanel,null),null!=this.playerFlashAni)&&this.playerFlashAni.getComponent(sp.Skeleton).setAnimation(0,"start",!1);this._serverlist_auth_cb_func=this._serverlist_auth_cb.bind(this),i.addListener(n.S2CServerList,this._serverlist_auth_cb_func),this.S2CGetProtoVersion_cb_func=this.S2CGetProtoVersion_cb.bind(this),i.addListener(n.S2CGetProtoVersion,this.S2CGetProtoVersion_cb_func),this._S2CQueryHasRole_auth_cb_func=this._S2CQueryHasRole_auth_cb.bind(this),i.addListener(n.S2CQueryHasRole,this._S2CQueryHasRole_auth_cb_func),this._selectserver_auth_cb_func=this._selectserver_auth_cb.bind(this),i.addListener(n.S2CSelectServer,this._selectserver_auth_cb_func),this._entergame_auth_cb_func=this._entergame_auth_cb.bind(this),i.addListener(n.S2CEnterGame,this._entergame_auth_cb_func),this._userinfo_auth_cb_func=this._userinfo_auth_cb.bind(this),i.addListener(n.S2CUserInfoStruct,this._userinfo_auth_cb_func),this.S2COpenLogin_cb_func=this.S2COpenLogin_cb.bind(this),i.addListener(n.S2COpenLogin,this.S2COpenLogin_cb_func),this.S2CGetAnnounce_cb_func=this.S2CGetAnnounce_cb.bind(this),i.addListener(n.S2CGetAnnounce,this.S2CGetAnnounce_cb_func),this.S2CH5OpenLogin_cb_func=this.S2CH5OpenLogin_cb.bind(this),i.addListener(n.S2CH5OpenLogin,this.S2CH5OpenLogin_cb_func),this.YiJieLoginSuccessJsbCallback_cb_func=this.YiJieLoginSuccessJsbCallback_cb.bind(this),i.addListener(h.YiJieLoginSuccessJsbCallback,this.YiJieLoginSuccessJsbCallback_cb_func),this.OpenLoginSuccessJsbCallback_cb_func=this.OpenLoginSuccessJsbCallback_cb.bind(this),i.addListener(h.OpenLoginSuccessJsbCallback,this.OpenLoginSuccessJsbCallback_cb_func),this.OpenLoginXingTeng_cb_func=this.OpenLoginXingTeng_cb.bind(this),i.addListener(h.OpenLoginXingTeng,this.OpenLoginXingTeng_cb_func),this.OpenLoginPingPing_cb_func=this.OpenLoginPingPing_cb.bind(this),i.addListener(h.OpenLoginPingPing,this.OpenLoginPingPing_cb_func),this.initSoundConfig(),cc.loader.loadRes("sound/zjm_01",function(e,t){cc.log("load mp3 success!"+t),MyBgMusicManager.play(t)}),2==DonotDestroyManager.login_host&&(this.labelCopyright.string="login_copyright_wanba"),cc.director.setDisplayStats(!1)},statics:{instance:null,getInstance:function(){return d.instance}},start:function(){this.loginInit(),this.jsbLoginInit(!1)},loginInit:function(){if(null!=window.open_platform)
switch(window.open_platform){case 1:this.sendQunheiLogin();break;case 2:this.sendWanbaLogin();break;case 3:this.sendZhangMengLogin();break;case 4:this.sendThree33Login();break;case 5:this.sendChongchongLogin();break;case 6:this.send4399Login()}},jsbLoginInit:function(e){2==DonotDestroyManager.jsbChannel?window.webkit.messageHandlers.login.postMessage(null):3==DonotDestroyManager.jsbChannel&&e?cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("LejiRootViewController","login"):4==DonotDestroyManager.jsbChannel?cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("ShYunbeeOpenApi","login"):5==DonotDestroyManager.jsbChannel?cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("BjLiuyeOpenApi","login"):6==DonotDestroyManager.jsbChannel||7==DonotDestroyManager.jsbChannel?cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("CfXingTengOpenApi","login"):8==DonotDestroyManager.jsbChannel?cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("GzPingPingOpenApi","login"):9==DonotDestroyManager.jsbChannel?cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("DouWanOpenApi","login"):10==DonotDestroyManager.jsbChannel?jsb.reflection.callStaticMethod("MiaoRenOpenApi","login"):11==DonotDestroyManager.jsbChannel?null!=DonotDestroyManager.LOGIN_DATA_185sy?this.send185syLogin(DonotDestroyManager.LOGIN_DATA_185sy.userId,DonotDestroyManager.LOGIN_DATA_185sy.token):cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","login","()V"):jsb.reflection.callStaticMethod("SDKHandler","login"):12==DonotDestroyManager.jsbChannel&&(null!=DonotDestroyManager.LOGIN_DATA_manv?this.sendTianzhanManvLogin(DonotDestroyManager.LOGIN_DATA_manv.token,DonotDestroyManager.LOGIN_DATA_manv.appKey,DonotDestroyManager.LOGIN_DATA_manv.userId,DonotDestroyManager.LOGIN_DATA_manv.appId):cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","login","()V"):jsb.reflection.callStaticMethod("QuickSDKHandler","login"))},S2CGetProtoVersion_cb:function(e){if(e.hasNewVersion){null!=this._alert_layer&&cc.isValid(this._alert_layer)||(this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer));this._alert_layer.getComponent("AlertLayerManager").initContent(" trước mặt bản cũ quá thấp, thỉnh đi trước App Store hạ tái mới nhất bản cũ ！",function(){},!1)}else if(""!=e.newLoginHost){var t="ws://"+e.newLoginHost+":"+e.newLoginPort+"/ws";DonotDestroyManager._loginSocket.host_addr=t,DonotDestroyManager._loginSocket.reconnect();var a=this;this.sendLogin2Server(function(){3==DonotDestroyManager.jsbChannel?r.send_C2SgNetTopLogin(DonotDestroyManager._loginSocket,a._ios_appstore_ret.userId,a._ios_appstore_ret.token):4==DonotDestroyManager.jsbChannel?r.send_C2SYunbeeLogin(DonotDestroyManager._loginSocket,a._ios_appstore_ret.userId,a._ios_appstore_ret.token):5==DonotDestroyManager.jsbChannel&&(1==DonotDestroyManager._packageId?r.send_C2SLiuyeLogin1(DonotDestroyManager._loginSocket,a._ios_appstore_ret.userId,a._ios_appstore_ret.token):2==DonotDestroyManager._packageId&&r.send_C2SLiuyeLogin2(DonotDestroyManager._loginSocket,a._ios_appstore_ret.userId,a._ios_appstore_ret.token))})}else
3==DonotDestroyManager.jsbChannel?r.send_C2SgNetTopLogin(DonotDestroyManager._loginSocket,this._ios_appstore_ret.userId,this._ios_appstore_ret.token):4==DonotDestroyManager.jsbChannel?r.send_C2SYunbeeLogin(DonotDestroyManager._loginSocket,this._ios_appstore_ret.userId,this._ios_appstore_ret.token):5==DonotDestroyManager.jsbChannel&&(1==DonotDestroyManager._packageId?r.send_C2SLiuyeLogin1(DonotDestroyManager._loginSocket,this._ios_appstore_ret.userId,this._ios_appstore_ret.token):2==DonotDestroyManager._packageId&&r.send_C2SLiuyeLogin2(DonotDestroyManager._loginSocket,this._ios_appstore_ret.userId,this._ios_appstore_ret.token))},S2CH5OpenLogin_cb:function(e){var t=e.session_id;this._sessionid=t,cc.log("h5 open login server return,session_id=%s",t),cc.log(" gửi đi phục vụ khí liệt biểu tin tức , gửi đi thông cáo thỉnh cầu "),r.send_C2SServerList(DonotDestroyManager._loginSocket),r.send_C2SGetAnnounce(DonotDestroyManager._loginSocket),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),l.t("login_success"))},OpenLoginPingPing_cb:function(e){this.sendLogin2Server(function(){r.send_C2SPingPingLogin(DonotDestroyManager._loginSocket,e.game_id,e.user_code,e.login_token,e.game_key)})},OpenLoginXingTeng_cb:function(e){this.sendLogin2Server(function(){6==DonotDestroyManager.jsbChannel?r.send_C2SXingTengLogin2(DonotDestroyManager._loginSocket,e.appId,e.userId,e.token,e.appKey):7==DonotDestroyManager.jsbChannel?r.send_C2SChuangFuLogin(DonotDestroyManager._loginSocket,e.appId,e.userId,e.token,e.appKey):9==DonotDestroyManager.jsbChannel?r.send_C2SQuLeLeLogin(DonotDestroyManager._loginSocket,e.appId,e.userId,e.token):10==DonotDestroyManager.jsbChannel?r.send_C2SMiaoRenLogin(DonotDestroyManager._loginSocket,e.appId,e.userId,e.token):11==DonotDestroyManager.jsbChannel?(DonotDestroyManager.LOGIN_DATA_185sy={token:e.token,userId:e.userId},r.send_C2S185syLogin(DonotDestroyManager._loginSocket,e.token,e.userId)):12==DonotDestroyManager.jsbChannel&&(DonotDestroyManager.LOGIN_DATA_manv={token:e.token,userId:e.userId,appKey:e.appKey,appId:e.appId},r.send_C2SBaoFengLogin(DonotDestroyManager._loginSocket,e.token,e.appKey,e.userId,e.appId.toString()))})},OpenLoginSuccessJsbCallback_cb:function(e){this._ios_appstore_ret=e,this.sendOpenLogin(e.buildCode)},sendOpenLogin:function(e){this.sendLogin2Server(function(){r.send_C2SGetProtoVersion(DonotDestroyManager._loginSocket,e)})},YiJieLoginSuccessJsbCallback_cb:function(e){this.sendYiJieLogin(e.appId,e.channelId,e.userId,e.token)},sendYiJieLogin:function(e,t,a,n){this.sendLogin2Server(function(){r.send_C2SYiJieLogin(DonotDestroyManager._loginSocket,e,t,a,n)})},send185syLogin:function(e,t){this.sendLogin2Server(function(){r.send_C2S185syLogin(DonotDestroyManager._loginSocket,t,e)})},sendTianzhanManvLogin:function(e,t,a,n){this.sendLogin2Server(function(){r.send_C2SBaoFengLogin(DonotDestroyManager._loginSocket,e,t,a,n.toString())})},send4399Login:function(){this.sendLogin2Server(function(){r.send_C2S4399Login(DonotDestroyManager._loginSocket,window.OPEN4399.gameId,window.OPEN4399.time,window.OPEN4399.userId,window.OPEN4399.userName,window.OPEN4399.sign)})},sendChongchongLogin:function(){this.sendLogin2Server(function(){r.send_C2SChongChongLogin(DonotDestroyManager._loginSocket,window.CHONGCHONG.userId,window.CHONGCHONG.time,window.CHONGCHONG.sign)})},sendThree33Login:function(){this.sendLogin2Server(function(){r.send_C2SThree33Login(DonotDestroyManager._loginSocket,window.THREE33.gameId,window.THREE33.time,window.THREE33.uid,window.THREE33.userName,window.THREE33.sign)})},sendZhangMengLogin:function(){this.sendLogin2Server(function(){r.send_C2SZhangMengLogin(DonotDestroyManager._loginSocket,window.ZMuserdata.uid,window.ZMuserdata.t,window.ZMuserdata.sign)})},sendWanbaLogin:function(){this.sendLogin2Server(function(){window.getOpenKey(function(e){r.send_C2SWanbaLogin(DonotDestroyManager._loginSocket,window.OPEN_DATA.appid,window.OPEN_DATA.openid,window.OPEN_DATA.openkey,window.OPEN_DATA.platform,window.OPEN_DATA.pf)})})},sendQunheiLogin:function(){this.sendLogin2Server(function(){var e=window.qunhei_uname,t=window.qunhei_serverid,a=window.qunhei_time,n=window.qunhei_isadult,i=window.qunhei_flag;r.send_C2SQunheiLogin(DonotDestroyManager._loginSocket,e,t,n,a,i)})},sendLogin2Server:function(e){null!=this._existInterval&&clearInterval(this._existInterval),this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node);var t=this,a=0;this._existInterval=setInterval(function(){cc.log("query login server status!"),DonotDestroyManager._loginSocket.isConnected()&&(null!=e&&e(),clearInterval(t._existInterval),(t._existInterval=null)!=t._shortMask_node&&(t._shortMask_node.removeFromParent(),t._shortMask_node.destroy(),t._shortMask_node=null)),(3e3<(a+=200)||DonotDestroyManager._loginSocket.isError())&&(cc.log("reconnect login socket!"),a=0,DonotDestroyManager._loginSocket.reconnect())},200)},S2CGetAnnounce_cb:function(e){this._announceContent=e.content;var t=cc.instantiate(this.prefab_announce);cc.Canvas.instance.node.addChild(t),t.getComponent("AnnounceLayer").initContent(this._announceContent)},S2COpenLogin_cb:function(e){var t=e.session_id;this._sessionid=t,cc.log("open login server return,session_id=%s",t),cc.log(" gửi đi phục vụ khí liệt biểu tin tức "),r.send_C2SServerList(DonotDestroyManager._loginSocket);var a=cc.Canvas.instance.node.getChildByName("ShortLoadingLayer");null!=a&&(a.getComponent("ShortLoadingMask").finishCb(),a.destroy()),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),l.t("login_success"))},initSoundConfig:function(){var e=1;null!=cc.sys.localStorage.getItem("isSoundOpen")&&(e=cc.sys.localStorage.getItem("isSoundOpen")),MyPersistDataManager._playerData.musicVolume=1==e},_userinfo_auth_cb:function(e){cc.log(" nhận ngoạn gia tin tức "),MyPersistDataManager._playerData.id=e.id,MyPersistDataManager._playerData.account_id=e.account_id,MyPersistDataManager._playerData.name=e.name,MyPersistDataManager._playerData.sex=e.sex,MyPersistDataManager._playerData.icon=e.icon,MyPersistDataManager._playerData.head_frame=e.head_frame,MyPersistDataManager._playerData.level=e.level,MyPersistDataManager._playerData.level_exp=e.level_exp,MyPersistDataManager._playerData.fight=e.fight,MyPersistDataManager._playerData.money=e.money,MyPersistDataManager._playerData.gameMoney=e.gameMoney,MyPersistDataManager._playerData.energy=e.energy,MyPersistDataManager._playerData.vip_level=e.vip_level,MyPersistDataManager._playerData.vip_exp=e.vip_exp,MyPersistDataManager._playerData.honor=e.honor,MyPersistDataManager._playerData.stamina=e.stamina,MyPersistDataManager._playerData.server_id=e.server_id,MyPersistDataManager._playerData.nation_id=e.nation_id,MyPersistDataManager._playerData.formationSlots=e.formationSlots,MyPersistDataManager._offlineAwardInfo.offline_minutes=e.offline_minutes,MyPersistDataManager._offlineAwardInfo.offline_add_level=e.offline_add_level,MyPersistDataManager._offlineAwardInfo.offline_rewards=e.offline_rewards,MyPersistDataManager._wanba_gift=e.wanba_gift_ret,MyPersistDataManager._playerData._firstEnterHome=!0,p.initPlayerLevel(e.level),m.initWithTeamSkillList(e.team_skills),cc.log(" thêm tái ngoạn gia id==="+MyPersistDataManager._playerData.id);var t=0;if(null!=cc.sys.localStorage.getItem("lastloginserver")&&(t=parseInt(cc.sys.localStorage.getItem("lastloginserver"))),null!=window.TDGA){var a=null!=window.open_platform?window.open_platform:0;TDGA.Account({accountId:e.account_id,level:e.level,gameServer:"s"+t,accountType:10+a,accountName:e.name})}
null!=window.open_platform&&2==window.open_platform&&window.reportLogin();var n=" phục vụ khí #"+e.server_id;if(null!=DonotDestroyManager._gameServerInfo&&(n=DonotDestroyManager._gameServerInfo.server_name),null!=window.open_platform&&3==window.open_platform&&ZmSdk.getInstance().reportRoleStatus({datatype:"3",serverid:e.server_id,servername:n,roleid:e.id,rolename:e.name,rolelevel:e.level,fightvalue:e.fight}),2==DonotDestroyManager.jsbChannel){var i={roleId:MyPersistDataManager._playerData.id.toString(),roleName:MyPersistDataManager._playerData.name,roleLevel:MyPersistDataManager._playerData.level.toString(),zoneId:t.toString(),zoneName:n};window.webkit.messageHandlers.setRoleData.postMessage({param1:JSON.stringify(i)})}else if(8==DonotDestroyManager.jsbChannel){var r=MyPersistDataManager._playerData.account_id.substr(3),s=MyPersistDataManager._playerData.id+"",o=MyPersistDataManager._playerData.name,c=MyPersistDataManager._playerData.level.toString(),l=MyPersistDataManager._playerData.server_id.toString(),h=MyPersistDataManager._playerData.gameMoney.toString(),d=MyPersistDataManager._playerData.vip_level.toString(),_=MyPersistDataManager._playerData.money.toString(),u=MyPersistDataManager._playerData.fight.toString();jsb.reflection.callStaticMethod("GzPingPingOpenApi","userInfo:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:",r,"enterServer",s,o,c,l,n,h,d,_,u)}else
9==DonotDestroyManager.jsbChannel?jsb.reflection.callStaticMethod("DouWanOpenApi","setRoleInfo:and1:and2:and3:",MyPersistDataManager._playerData.server_id.toString(),MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.level.toString()):10==DonotDestroyManager.jsbChannel?jsb.reflection.callStaticMethod("MiaoRenOpenApi","submitRoleInfo:and1:and2:and3:and4:",MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.server_id.toString(),n):11==DonotDestroyManager.jsbChannel?cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","setData","(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;Ljava/lang/String;)V",3,MyPersistDataManager._playerData.money,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.server_id,n,MyPersistDataManager._playerData.vip_level.toString()):jsb.reflection.callStaticMethod("SDKHandler","submitData:and1:and2:and3:and4:and5:and6:and7:",3,MyPersistDataManager._playerData.server_id.toString(),n,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.money.toString(),MyPersistDataManager._playerData.vip_level.toString()):12==DonotDestroyManager.jsbChannel&&(cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","setUserInfo","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;I)V",MyPersistDataManager._playerData.server_id.toString(),n,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.money.toString(),0):jsb.reflection.callStaticMethod("QuickSDKHandler","updateRoleInfoWith:and1:and2:and3:and4:and5:and6:and7:",n,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.money.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.level.toString(),0));f.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"},_entergame_auth_cb:function(e){cc.log(" tiến vào trò chơi hồi điều "),MyUiManager.RemoveAllOpen(),MyPersistDataManager._playerData.in_game_session_id=e.in_game_session_id,MyPersistDataManager._hallInfo.has_qcjj_activity=e.has_qcjj_activity,MyPersistDataManager._hallInfo.has_qzyb_activity=e.has_qzyb_activity},_selectserver_auth_cb:function(e){cc.log(" lựa chọn phục vụ khí phản hồi ");var t=this;cc.sys.localStorage.setItem("lastloginserver",this._curSelectServerInfo.server_id.toString());var a=e.ret;if(0==a){cc.log("connect 2 gameserver!"),DonotDestroyManager._gameServerInfo=this._curSelectServerInfo;var n="wss://"+this._curSelectServerInfo.ip_addr+":"+this._curSelectServerInfo.port+"/ws";2!=DonotDestroyManager.login_host&&5!=DonotDestroyManager.login_host&&(n="ws://"+this._curSelectServerInfo.ip_addr+":"+this._curSelectServerInfo.port_nossl+"/ws"),DonotDestroyManager._gameSocket=new c(n),this._connect2GsCheck(),null!=window.open_platform&&3==window.open_platform&&ZmSdk.getInstance().reportRoleStatus({datatype:"1",serverid:this._curSelectServerInfo.server_id.toString(),servername:this._curSelectServerInfo.server_name,roleid:"-1",rolename:" tạm vô ",rolelevel:"1",fightvalue:"1"});var i=this._curSelectServerInfo.server_id.toString(),r=new Date,s=Math.round(r.getTime()/1e3).toString(),o={roleId:"1",roleName:"Không có",roleLevel:"1",zoneId:i,zoneName:this._curSelectServerInfo.server_name,balance:"0",vip:"1",partyName:" vô bang phái ",roleCTime:s,roleLevelMTime:s};2==DonotDestroyManager.jsbChannel?window.webkit.messageHandlers.setData.postMessage({param1:"enterServer",param2:JSON.stringify(o)}):11==DonotDestroyManager.jsbChannel&&(cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","setData","(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;Ljava/lang/String;)V",1,0,"0","","1",this._curSelectServerInfo.server_id,this._curSelectServerInfo.server_name,"0"):jsb.reflection.callStaticMethod("SDKHandler","submitData:and1:and2:and3:and4:and5:and6:and7:",1,this._curSelectServerInfo.server_id.toString(),this._curSelectServerInfo.server_name,"","0","1","0","0"))}else{l.t("gs_connect_fail_"+a);this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent("Kết nối thất bại,xin thử lại!",function(){t._alert_layer.removeFromParent(),t._alert_layer.destroy(),t._alert_layer=null})}},_connect2GsCheck:function(){this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node);var t=this,a=0,n=setInterval(function(){if(cc.log("query gs status!"),DonotDestroyManager._gameSocket.isConnected()){cc.log("send_C2SQueryHasRole gửi đi tin tức ");var e=null;null!=window.open_platform&&2==window.open_platform&&(e={wanba_gift_id:0,appid:window.OPEN_DATA.appid,openid:window.OPEN_DATA.openid,openkey:window.OPEN_DATA.openkey,pf:window.OPEN_DATA.pf}),r.send_C2SQueryHasRole(DonotDestroyManager._gameSocket,t._sessionid,e),clearInterval(n),null!=t._shortMask_node&&(t._shortMask_node.removeFromParent(),t._shortMask_node.destroy(),t._shortMask_node=null),null!=t._alert_layer&&(t._alert_layer.removeFromParent(),t._alert_layer.destroy(),t._alert_layer=null)}
(3e3<(a+=200)||DonotDestroyManager._gameSocket.isError())&&(clearInterval(n),null!=t._shortMask_node&&(t._shortMask_node.removeFromParent(),t._shortMask_node.destroy(),t._shortMask_node=null),t._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(t._alert_layer),t._alert_layer.getComponent("AlertLayerManager").initContent("Kết nối thất bại,xin thử lại!",function(){null!=t._alert_layer&&(t._alert_layer.removeFromParent(),t._alert_layer.destroy(),t._alert_layer=null),DonotDestroyManager._gameSocket.reconnect(),t._connect2GsCheck()}))},200)},_S2CQueryHasRole_auth_cb:function(e){if(cc.log(" hay không có được nhân vật tin tức phản hồi "+e.has_role),e.has_role){var t=null;null!=window.wanba_gift_id&&(t={wanba_gift_id:window.wanba_gift_id,appid:window.OPEN_DATA.appid,openid:window.OPEN_DATA.openid,openkey:window.OPEN_DATA.openkey,pf:window.OPEN_DATA.pf}),r.send_C2SEnterGame(DonotDestroyManager._gameSocket,this._sessionid,t)}else
MyUiManager.Open(MyUiManager.PanelInfo.CreateRolePanel,{sessionId:this._sessionid,nickname:e.qq_nickname})},_serverlist_auth_cb:function(e){this._serverList=[];var a=this,n=null;null!=cc.sys.localStorage.getItem("lastloginserver")&&(n=parseInt(cc.sys.localStorage.getItem("lastloginserver")));for(var t=-1,i=0;i<e.items.length;++i)
this._serverList.push({server_id:e.items[i].id,server_name:e.items[i].name,ip_addr:e.items[i].ip_addr,port:e.items[i].port,port_nossl:e.items[i].port_nossl,server_status:e.items[i].status}),t<e.items[i].id&&(t=e.items[i].id);null==n&&(n=t),this._serverList.forEach(function(e,t){n==e.server_id&&a.SetServerInfo(e)}),this.btn_refresh.active=!1},SetServerInfo:function(e){this.m_pServerId.string=e.server_id.toString()+" khu ",this.m_pServerName.string=e.server_name,this._curSelectServerInfo=e},onDestroy:function(){i.removeListener(n.S2CGetProtoVersion,this.S2CGetProtoVersion_cb_func),i.removeListener(n.S2CServerList,this._serverlist_auth_cb_func),i.removeListener(n.S2CQueryHasRole,this._S2CQueryHasRole_auth_cb_func),i.removeListener(n.S2CSelectServer,this._selectserver_auth_cb_func),i.removeListener(n.S2CEnterGame,this._entergame_auth_cb_func),i.removeListener(n.S2COpenLogin,this.S2COpenLogin_cb_func),i.removeListener(n.S2CGetAnnounce,this.S2CGetAnnounce_cb_func),i.removeListener(n.S2CUserInfoStruct,this._userinfo_auth_cb_func),i.removeListener(n.S2CH5OpenLogin,this.S2CH5OpenLogin_cb_func),i.removeListener(h.YiJieLoginSuccessJsbCallback,this.YiJieLoginSuccessJsbCallback_cb_func),i.removeListener(h.OpenLoginSuccessJsbCallback,this.OpenLoginSuccessJsbCallback_cb_func),i.removeListener(h.OpenLoginXingTeng,this.OpenLoginXingTeng_cb_func),i.removeListener(h.OpenLoginPingPing,this.OpenLoginPingPing_cb_func),d.instance=null},_animationEventHandler:function(e){var t=e.animation?e.animation.name:"";if(cc.log("animation event:"+t),"start"===t){var a=cc.moveBy(.3,cc.p(0,226));if(this.bottomNode.runAction(a),this.rightNode.runAction(cc.moveBy(.3,cc.p(-320,0))),cc.sys.isBrowser&&null==window.open_platform&&0==DonotDestroyManager.jsbChannel&&MyUiManager.Open(MyUiManager.PanelInfo.LoginNamePwdPanel,null),null!=this.playerFlashAni)
this.playerFlashAni.getComponent(sp.Skeleton).setAnimation(0,"loop",!0)}},selectserver:function(e){s.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.ServerListPanel,this._serverList)},enterHall:function(e){cc.log("send select server msg 2 LoginServer!"),s.playBtnOpenEffect(),null==this._curSelectServerInfo?(this.loginInit(),this.jsbLoginInit(!0)):r.send_C2SSelectServer(DonotDestroyManager._loginSocket,this._curSelectServerInfo.server_id)},showAnnounceHanlder:function(e,t){s.playBtnOpenEffect();var a=cc.instantiate(this.prefab_announce);cc.Canvas.instance.node.addChild(a),a.getComponent("AnnounceLayer").initContent(this._announceContent)},ClickRefreshHanlder:function(e,t){o.restartGame()}});cc._RF.pop()},{GameUtils:"GameUtils",LejiSocket:"LejiSocket",MarqueeBufferMgr:"MarqueeBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",PlayerBufferMgr:"PlayerBufferMgr",SoundUtil:"SoundUtil",TeamSkillBufferMgr:"TeamSkillBufferMgr",WsEncoder:"WsEncoder",i18n:"i18n"}],LuckRankItem:[function(e,t,a){"use strict";cc._RF.push(t,"79273mZz/dPRZqpgT3+WHdD","LuckRankItem"),cc.Class({extends:cc.Component,properties:{m_pBG:cc.Node,m_pRank:cc.Label,m_pName:cc.Label,m_pMoney:cc.Label,_rankinfo:null,_type:-1},onLoad:function(){},ChangeData:function(e){this._rankinfo=e.info,this._type=e.type,this._leftrank=e.leftrank,this.Init()},Init:function(){this.InitData()},InitData:function(){this.m_pRank.string=this._rankinfo.rank,this.m_pMoney.string=this._rankinfo.money,0==this._type?(this.m_pBG.width=351,this.m_pName.node.active=!0,this.m_pRank.node.setPosition(-140,0),this.m_pMoney.node.setPosition(140,0),this.m_pName.string=this._rankinfo.name):(this.m_pBG.width=225,this.m_pName.node.active=!1,this.m_pRank.node.setPosition(-70,0),this.m_pMoney.node.setPosition(70,0),null==this._leftrank?this.m_pRank.node.color=cc.Color.WHITE:this._rankinfo.rank>this._leftrank?this.m_pRank.node.color=cc.Color.RED:this._rankinfo.rank<this._leftrank?this.m_pRank.node.color=cc.Color.GREEN:this.m_pRank.node.color=cc.Color.WHITE)}}),cc._RF.pop()},{}],LuckRankLayer:[function(e,t,a){"use strict";cc._RF.push(t,"fa54baM9AtACbLjTiCRlpKX","LuckRankLayer");var n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pLuckRankItem:cc.Node,m_pLeftParent:cc.Node,m_pRightParent:cc.Node,_rankinfo:null,_haslastinfo:!1},onLoad:function(){},ChangeData:function(e){this._rankinfo=e,this.Init()},Init:function(){this.CreateLeftItem(),this.CreateRightItem()},CreateLeftItem:function(){if(null==this._rankinfo||null==this._rankinfo.prevInfos||this._rankinfo.prevInfos.length<=0)
this._haslastinfo=!1;else{this._haslastinfo=!0;for(var e=0;e<this._rankinfo.prevInfos.length;++e){var t=cc.instantiate(this.m_pLuckRankItem);this.m_pLeftParent.addChild(t),t.active=!0;var a={info:this._rankinfo.prevInfos[e],type:0};t.getComponent("LuckRankItem").ChangeData(a)}}},CreateRightItem:function(){if(null!=this._rankinfo&&null!=this._rankinfo.infos)
for(var e=0;e<this._rankinfo.infos.length;++e){var t=cc.instantiate(this.m_pLuckRankItem);this.m_pRightParent.addChild(t),t.active=!0;var a=this._haslastinfo?this._rankinfo.prevInfos[e].rank:null,n={info:this._rankinfo.infos[e],type:1,leftrank:a};t.getComponent("LuckRankItem").ChangeData(n)}},Mask_OnClickHandler:function(e){n.playBtnCloseEffect(),this.node.destroy()}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],MailDetail:[function(e,t,a){"use strict";cc._RF.push(t,"bb248Wx81RKw7bb2/pcA55O","MailDetail");var n=e("MyProtocols"),i=e("MailPanelManager"),s=e("i18n"),r=e("SoundUtil");cc.Class({extends:cc.Component,properties:{title:cc.Label,content:cc.Label,rewardContent:cc.Node,itemBox_prefab:cc.Prefab,panel_node:cc.Node,btn_node:cc.Button,btn_label:cc.Label,_mailData:null,_isRuningAction:!1,_btnType:0},onLoad:function(){},initData:function(e){switch((this._mailData=e).mail_type){case 0:this.title.string=e.title,this.content.string=e.content;break;case 1:var t=DonotDestroyManager.GameData.Mail,a=e.template_id;this.title.string=t[a].mail_title,this.content.string=t[a].mail_content}
var n=-1,i=0,r=this;e.mailParamMsg.forEach(function(e){switch(e.type!=n?(i=0,n=e.type):i++,e.type){case 0:break;case 1:var t=r.title.string.replace("{"+i+"}",e.value);r.title.string=t;break;case 2:t=r.content.string.replace("{"+i+"}",e.value);r.content.string=t}},this),this.createReward(e.attach),0==e.attach.length||null==e.attach?(this.btn_label.string=s.t("1110"),this._btnType=1):this._btnType=0},createReward:function(e){var a=this;e.forEach(function(e){var t=cc.instantiate(a.itemBox_prefab);a.rewardContent.addChild(t),t.getComponent("ItemBox").ChangeItemInfo(e.itemId,e.cnt,!0,null,!0)},this)},backHandler:function(){this.node.removeFromParent(),this.node.destroy()},getRewardHandler:function(e){switch(this._btnType){case 0:0<this._mailData.attach.length&&n.send_C2SGetAttach(DonotDestroyManager._gameSocket,this._mailData.mail_id);break;case 1:if(r.playBtnOpenEffect(),i.getInstance()._isDeletingMail)
return;if(null!=this._mailData.attach&&this._mailData.attach instanceof Array&&0<this._mailData.attach.length){var t=this,a=cc.instantiate(DonotDestroyManager.AlertLayer);cc.Canvas.instance.node.addChild(a),a.getComponent("AlertLayerManager").InitTwoBtnContent("Trong thư vẫn còn phụ kiện chưa nhận,\ncó tiếp tục xóa không?",function(){i.getInstance()._isDeletingMail=!0,n.send_C2SDelMail(DonotDestroyManager._gameSocket,[t._mailData.mail_id]),a.destroy()},function(){a.destroy()})}else
i.getInstance()._isDeletingMail=!0,n.send_C2SDelMail(DonotDestroyManager._gameSocket,[this._mailData.mail_id])}},fadeInStart:function(){this._isRuningAction=!0,this.initData(this._mailData),this.panel_node.scale=.5;var e=cc.scaleTo(.2,1),t=cc.callFunc(this._fadeInComplete,this);e=cc.sequence(e,t),this.panel_node.runAction(e)},_fadeInComplete:function(){this._isRuningAction=!1},fadeOutStart:function(){if(!this._isRuningAction){this._isRuningAction=!0,this.panel_node.stopAllActions();var e=cc.scaleTo(.2,.5),t=cc.callFunc(this._fadeOutComplete,this);e=cc.sequence(e,t),this.panel_node.runAction(e)}},_fadeOutComplete:function(){this._isRuningAction=!1,this.backHandler()}}),cc._RF.pop()},{MailPanelManager:"MailPanelManager",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",i18n:"i18n"}],MailItem:[function(e,t,a){"use strict";cc._RF.push(t,"976adCi+zxOzabjuMabT3XA","MailItem");var s=e("GameUtils"),n=e("MyProtocols"),o=e("MailPanelManager"),i=(e("i18n"),e("SoundUtil"));cc.Class({extends:cc.Component,properties:{title:cc.Label,from:cc.Label,rewardContent:cc.Node,sendTime:cc.Label,beReadSprite:cc.Sprite,rewardItem:cc.Prefab,_itemID:0},onLoad:function(){},updateItem:function(e){if(this._itemID=e,this._itemID>=MyPersistDataManager._playerData.maillist.length)
this.node.active=!1;else{this.node.active=!0;var t=MyPersistDataManager._playerData.maillist[this._itemID];switch(this.sendTime.string=this._formatDate(t.create_time),1==t.is_read?(this.node.getComponent(cc.Sprite).spriteFrame=o.getInstance().mailsprite[1],this.beReadSprite.spriteFrame=o.getInstance().mailsprite[0]):0==t.is_read&&(this.node.getComponent(cc.Sprite).spriteFrame=o.getInstance().mailsprite[3],this.beReadSprite.spriteFrame=o.getInstance().mailsprite[2]),t.mail_type){case 0:this.title.string=t.title,this.from.string=t.send_name;break;case 1:var a=DonotDestroyManager.GameData.Mail,n=t.template_id;this.title.string=a[n].mail_title,this.from.string=a[n].sender}
var i=-1,r=0;t.mailParamMsg.forEach(function(e){switch(e.type!=i?(r=0,i=e.type):r++,e.type){case 0:var t=this.from.string.replace("{"+r+"}",e.value);this.from.string=t;break;case 1:t=this.title.string.replace("{"+r+"}",e.value);this.title.string=t}},this),s.destroyAllChildren(this.rewardContent),t.attach.forEach(function(e,t){if(!(4<=t)){var a=cc.instantiate(this.rewardItem);this.rewardContent.addChild(a),a.getComponent("MailRewardItem").initData(e)}},this)}},_formatDate:function(e){var t=new Date(1e3*e),a=t.getDate(),n=t.getMonth()+1;return t.getFullYear()+"-"+n+"-"+a},readMailHandler:function(e){i.playBtnOpenEffect();var t=MyPersistDataManager._playerData.maillist[this._itemID],a=cc.instantiate(o.getInstance().mailDetail_prefab);cc.Canvas.instance.node.addChild(a),a.setPosition(0,0),a.getComponent("MailDetail")._mailData=t,a.getComponent("MailDetail").fadeInStart(),0==t.is_read&&n.send_C2SReadNewMailMsg(DonotDestroyManager._gameSocket,t.mail_id)},deleteMailHandler:function(e){if(i.playBtnOpenEffect(),!o.getInstance()._isDeletingMail){var t=MyPersistDataManager._playerData.maillist[this._itemID];if(null!=t.attach&&t.attach instanceof Array&&0<t.attach.length){var a=cc.instantiate(DonotDestroyManager.AlertLayer);cc.Canvas.instance.node.addChild(a),a.getComponent("AlertLayerManager").InitTwoBtnContent("Trong thư vẫn còn phụ kiện chưa nhận,\ncó tiếp tục xóa không?",function(){o.getInstance()._isDeletingMail=!0,n.send_C2SDelMail(DonotDestroyManager._gameSocket,[t.mail_id]),a.destroy()},function(){a.destroy()})}else
o.getInstance()._isDeletingMail=!0,n.send_C2SDelMail(DonotDestroyManager._gameSocket,[t.mail_id])}}}),cc._RF.pop()},{GameUtils:"GameUtils",MailPanelManager:"MailPanelManager",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",i18n:"i18n"}],MailPanelManager:[function(e,t,a){"use strict";cc._RF.push(t,"418b7RGpL5BaauQDGPCpcyd","MailPanelManager");var n=e("MyProtocols"),i=e("NetEvent"),r=e("MyEventDispatcher"),s=e("MyUIEvent"),o=e("SoundUtil"),c=(e("MainHomeManager"),e("i18n")),l=cc.Class({extends:cc.Component,properties:{noMail_label:cc.Label,mailContent:cc.Node,mailItem_prefab:cc.Prefab,mailDetail_prefab:cc.Prefab,getRewardPanel_prefab:cc.Prefab,mailsprite:[cc.SpriteFrame],moneySprFrame:[cc.SpriteFrame],_mailConfig:null,_isDeletingMail:!1,_mailMap:null,mScrollView:cc.ScrollView,itemTemplate:cc.Prefab,itemTemplateHeight:110,spawnCount:12,spacing:0,bufferZone:600},statics:{instance:null,getInstance:function(){return l.instance}},onLoad:function(){if(MyPersistDataManager._playerData.didOpenedMailBox=!0,(l.instance=this)._mailConfig=DonotDestroyManager.GameData.Mail,this.showMail_cb=this.showMail.bind(this),r.addListener(i.S2CListMail,this.showMail_cb),this.readNewMail_cb=this.readNewMail.bind(this),r.addListener(i.S2CReadNewMailMsg,this.readNewMail_cb),this.deleteMail_cb=this.deleteMail.bind(this),r.addListener(i.S2CDelMail,this.deleteMail_cb),this.getReward_cb=this.getReward.bind(this),r.addListener(i.S2CGetAttach,this.getReward_cb),this.S2CGetAttachAll_cb=this.S2CGetAttachAll_cb_handler.bind(this),r.addListener(i.S2CGetAttachAll,this.S2CGetAttachAll_cb),this.GetUIEventMessager_cb_func=this.GetUIEventMessager_cb.bind(this),r.addListener(s.SetRedPoint,this.GetUIEventMessager_cb_func),0==MyPersistDataManager._playerData.maillist.length)
n.send_C2SListMail(DonotDestroyManager._gameSocket,null);else{this._mailMap=new Object;var t=this;MyPersistDataManager._playerData.maillist.forEach(function(e){t._mailMap[""+e.mail_id]=e},this),this.refreshScrollView()}},onDestroy:function(){l.instance=null},GetUIEventMessager_cb:function(e){"mailBox"==e.name&&e.state&&this.refreshScrollView()},readNewMail:function(n){this.mailContent.children.forEach(function(e){var t=e.getComponent("MailItem")._itemID,a=MyPersistDataManager._playerData.maillist[t];null!=a&&a.mail_id==n.mail_id&&(1==n.is_del||0==n.is_del&&(cc.log(" thiết trí đã đọc "),a.is_read=1,e.getComponent("MailItem").updateItem(t)))},this)},deleteMail:function(e){for(var t=0;t<e.mail_id.length;t++){var a=-1,n=e.mail_id[t];MyPersistDataManager._playerData.maillist.forEach(function(e,t){e.mail_id==n&&(a=t)},this),-1!=a&&MyPersistDataManager._playerData.maillist.splice(a,1)}
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),c.t("1109"));MyPersistDataManager._playerData.maillist;this.refreshScrollView(),this._isDeletingMail=!1},showMail:function(e){cc.log("showMail"),MyPersistDataManager._playerData.maillist=e.mailInfoList;var t=this;this._mailMap=new Object,MyPersistDataManager._playerData.maillist.forEach(function(e){t._mailMap[""+e.mail_id]=e},this),MyPersistDataManager._playerData.maillist.length<=0||null==MyPersistDataManager._playerData.maillist?this.noMail_label.node.active=!0:this.noMail_label.node.active=!1,this.refreshScrollView(),this.mScrollView.stopAutoScroll(),this.mScrollView.scrollToTop(),r.dispatchEvent(s.SetRedPoint,{name:"mailBox",state:!1})},refreshScrollView:function(){if(this.content=this.mScrollView.content,this.content.height=MyPersistDataManager._playerData.maillist.length*(this.itemTemplateHeight+this.spacing)+this.spacing,0==this.content.children.length){this._spawnItems=[],this.updateTimer=0,this.updateInterval=.2;for(var e=this.lastContentPosY=0;e<this.spawnCount;++e){var t=cc.instantiate(this.itemTemplate);this.content.addChild(t),t.setPosition(0,-t.height*(.5+e)-this.spacing*(e+1)),t.getComponent("MailItem").updateItem(e),this._spawnItems.push(t)}}else
for(var a=this.updateTimer=0;a<this.spawnCount;++a){var n=this._spawnItems[a];n.setPosition(0,-n.height*(.5+a)-this.spacing*(a+1)),n.getComponent("MailItem").updateItem(a)}},getReward:function(a){var e=cc.instantiate(this.getRewardPanel_prefab);cc.Canvas.instance.node.addChild(e),e.getComponent("GetRewardPanel")._itemlist=this._mailMap[a.mail_id].attach,this._mailMap[a.mail_id].attach=[],this.mailContent.children.forEach(function(e){var t=e.getComponent("MailItem")._itemID;null!=MyPersistDataManager._playerData.maillist[t]&&MyPersistDataManager._playerData.maillist[t].mail_id==a.mail_id&&e.getComponent("MailItem").updateItem(t)},this)},S2CGetAttachAll_cb_handler:function(e){if(null!=e.attachs&&0<e.attachs.length){var t=cc.instantiate(this.getRewardPanel_prefab);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.attachs}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Nhận thành công")},getAttachAll:function(e){o.playBtnOpenEffect(),n.send_C2SGetAttachAll(DonotDestroyManager._gameSocket)},_getCurrentMailIdList:function(){var t=[];return MyPersistDataManager._playerData.maillist.forEach(function(e){t.push(e.mail_id)},this),t},setParams:function(e){this.closeCb=e.closeCb},fadeIn:function(){},fadeInComplete:function(){},fadeOut:function(){},fadeOutComplete:function(){},closeSelf:function(){r.removeListener(i.S2CListMail,this.showMail_cb),r.removeListener(i.S2CReadNewMailMsg,this.readNewMail_cb),r.removeListener(i.S2CDelMail,this.deleteMail_cb),r.removeListener(i.S2CGetAttach,this.getReward_cb),r.removeListener(i.S2CGetAttachAll,this.S2CGetAttachAll_cb),r.removeListener(s.SetRedPoint,this.GetUIEventMessager_cb_func),r.dispatchEvent(s.SetRedPoint,{name:"mailBox",state:!1}),o.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},getPositionInView:function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.mScrollView.node.convertToNodeSpaceAR(t)},update:function(e){if(this.updateTimer+=e,!(this.updateTimer<this.updateInterval)){this.updateTimer=0;var t=this._spawnItems;if(null!=t){for(var a=this.bufferZone,n=this.mScrollView.content.y<this.lastContentPosY,i=(this.itemTemplateHeight+this.spacing)*t.length,r=0;r<t.length;++r){var s=this.getPositionInView(t[r]);if(n){if(s.y<-a&&t[r].y+i<0){t[r].setPositionY(t[r].y+i);var o=t[r].getComponent("MailItem"),c=o._itemID-t.length;o.updateItem(c)}}else if(s.y>a&&t[r].y-i>-this.content.height){t[r].setPositionY(t[r].y-i);var l=t[r].getComponent("MailItem"),h=l._itemID+t.length;l.updateItem(h)}}
this.lastContentPosY=this.mScrollView.content.y}}}});cc._RF.pop()},{MainHomeManager:"MainHomeManager",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],MailRewardItem:[function(i,e,t){"use strict";cc._RF.push(e,"6021dGl5xBL7aOHMUFpKNNb","MailRewardItem");var r=i("ColorUtil"),s=i("ItemsConfigMgr"),o={1450:0,1453:1,1451:2,1455:3,1452:4,1454:5};cc.Class({extends:cc.Component,properties:{itemName:cc.Label,pic:cc.Sprite,count:cc.Label},onLoad:function(){},initData:function(e){var t=s.processItemCfg(e.itemId);if(this.count.string="x"+e.cnt,this._isNormalItem(e.itemId)){var a=i("MailPanelManager");this.pic.node.active=!0,this.pic.spriteFrame=a.getInstance().moneySprFrame[o[e.itemId]]}else if(null!=t){this.itemName.node.active=!0,this.itemName.string=t.name;var n=r.getColorByQuality(t.quality);this.itemName.node.color=n}},_isNormalItem:function(e){return void 0!==o[e]}}),cc._RF.pop()},{ColorUtil:"ColorUtil",ItemsConfigMgr:"ItemsConfigMgr",MailPanelManager:"MailPanelManager"}],MainButtonManager:[function(r,e,t){"use strict";cc._RF.push(e,"0c979AiG69Fj7u54J04pKJj","MainButtonManager");var a=r("MyEventDispatcher"),s=(r("MyUIEvent"),r("SoundUtil")),o=(r("PVEBattleManager"),r("BattleBufferMgr"),r("MyProtocols")),n=r("NetEvent"),c=r("UnLockCfgMgr"),i=r("OverComeBufferMgr"),l=r("GameUtils"),h=r("PkBufferMgr"),d=r("SecretBufferMgr"),_=r("BossBufferMgr"),u=r("GuozhanBufferMgr"),m=r("GuozhanFightBufferMgr"),p={mailbox:"Prefab/MailPanel/MailPanel",shopmall:"Prefab/RecruitPanel/RecruitPanel",maincity:"Prefab/StageMapPanel/StageMapPanel",labground:"Prefab/TeamSkillPanel/TeamSkillPanel",blackmart:"Prefab/ShopMallLayer/ShopMallLayer",smithy:"Prefab/EsMain/EsRoot",overcome:"Prefab/FightThroughLayer/FightThroughLayer",arena:"Prefab/ActivityLayer/ActivityLayer",guild:"Prefab/GuoZhan/GuoZhanMainPanel"},f=cc.Class({extends:cc.Component,properties:{animation_nodeParent:cc.Node,overcome_node:cc.Node,maincity_node:cc.Node,firstpay_node:cc.Node,firstpay_effect:cc.Node,desktopShortcut_node:cc.Node,wanbaFuli_node:cc.Node,qedj_node:cc.Node,mScrollView:cc.ScrollView,m_pScrollBg:cc.Node,m_pMainBtnParent:cc.Node,btnQcjj:cc.Node,btnQzyb:cc.Node,btnMrfx:cc.Node,m_pRewardPanel:cc.Prefab,nodes_top_guide:[cc.Node],_nodeList:[],_animConfig:null,_clickedBtnName:null,_perLoadPanelPrefab:null,_OpenFlag:0,_loaded_prefab:null,_forceOpenPanelAction:null},statics:{instance:null,getInstance:function(){return f.instance}},onLoad:function(){(f.instance=this)._nodeList=this.animation_nodeParent.children.concat(),this._nodeList.push(this.overcome_node),this._nodeList.push(this.maincity_node),this._animConfig=DonotDestroyManager.GameData.MainButtonAnima;this._nodeList.forEach(function(e){var t=e.getComponent(sp.Skeleton);t.setCompleteListener(this._animationEventHandler.bind(t));var a=this._animConfig[e.name].default;t.setAnimation(0,a,!1)},this),null!=MyPersistDataManager._playerData.chargeInfo&&1==MyPersistDataManager._playerData.chargeInfo.first_award_get&&(this.firstpay_node.active=!1,this.firstpay_effect.active=!1),null!=MyPersistDataManager._hallInfo.has_qcjj_activity&&1==MyPersistDataManager._hallInfo.has_qcjj_activity?this.btnQcjj.active=!0:this.btnQcjj.active=!1,cc.sys.isNative&&(this.btnMrfx.active=!1),null!=MyPersistDataManager._hallInfo.has_qzyb_activity&&1==MyPersistDataManager._hallInfo.has_qzyb_activity?this.btnQzyb.active=!0:this.btnQzyb.active=!1,null!=window.open_platform&&2==window.open_platform?(this.desktopShortcut_node.active=!0,this.wanbaFuli_node.active=!0):(this.desktopShortcut_node.active=!1,this.wanbaFuli_node.active=!1),null==window.OPEN_DATA||"wanba_ts.111"!==window.OPEN_DATA.pf&&"weixin.112"!==window.OPEN_DATA.pf?this.qedj_node.active=!1:this.qedj_node.active=!0,this.S2CListSign_auth_cb_func=this.S2CListSign_auth_cb.bind(this),a.addListener(n.S2CListSign,this.S2CListSign_auth_cb_func),this.S2CMineList_cb_func=this.S2CMineList_cb.bind(this),a.addListener(n.S2CMineList,this.S2CMineList_cb_func),this.S2CSecretView_cb_func=this.S2CSecretView_cb.bind(this),a.addListener(n.S2CSecretView,this.S2CSecretView_cb_func),this.S2CGuozhanView_cb_func=this.S2CGuozhanView_cb.bind(this),a.addListener(n.S2CGuozhanView,this.S2CGuozhanView_cb_func),this.S2CRankView_cb_func=this.S2CRankView_cb.bind(this),a.addListener(n.S2CRankView,this.S2CRankView_cb_func),this.S2CQedjList_cb_func=this.S2CQedjList_cb.bind(this),a.addListener(n.S2CQedjList,this.S2CQedjList_cb_func),this.TeamSkillList_auth_cb_func=this.TeamSkillList_auth_cb.bind(this),a.addListener(n.S2CTeamSkillList,this.TeamSkillList_auth_cb_func),this.OvercomeInfoAll_auth_cb_func=this.OvercomeInfoAll_auth_cb.bind(this),a.addListener(n.S2COvercomeInfoAll,this.OvercomeInfoAll_auth_cb_func),this.S2CGetQunheiWxShareAward_cb_func=this.S2CGetQunheiWxShareAward_cb.bind(this),a.addListener(n.S2CGetQunheiWxShareAward,this.S2CGetQunheiWxShareAward_cb_func),this.S2CAddDesktopShortcutAward_cb_func=this.S2CAddDesktopShortcutAward_cb.bind(this),a.addListener(n.S2CAddDesktopShortcutAward,this.S2CAddDesktopShortcutAward_cb_func),this.S2CQiZhenYiBaoView_cb_func=this.S2CQiZhenYiBaoView_cb.bind(this),a.addListener(n.S2CQiZhenYiBaoView,this.S2CQiZhenYiBaoView_cb_func),this.registWeixinShareHandler(),null!=window.open_platform&&2==window.open_platform&&mqq.invoke("ui","setOnShareHandler",function(e){mqq.invoke("ui","shareMessage",{title:" tam quốc quân đoàn chiến ",desc:" mau tới thể nghiệm thiên quân vạn mã chém giết tam quốc chiến trường đi ！",share_type:e,share_url:window.OPEN_DATA.shareurl,image_url:window.OPEN_DATA.appicon,back:!0},function(e){e&&0==e.retCode&&o.send_C2SGetQunheiWxShareAward(DonotDestroyManager._gameSocket)})})},onEnable:function(){this.S2CBossView_cb_func=this.S2CBossView_cb.bind(this),a.addListener(n.S2CBossView,this.S2CBossView_cb_func),this.S2CGuozhanFightView_cb_func=this.S2CGuozhanFightView_cb.bind(this),a.addListener(n.S2CGuozhanFightView,this.S2CGuozhanFightView_cb_func)},onDisable:function(){this._clickedBtnName=null,this._OpenFlag=0,a.removeListener(n.S2CBossView,this.S2CBossView_cb_func),a.removeListener(n.S2CGuozhanFightView,this.S2CGuozhanFightView_cb_func)},S2CQiZhenYiBaoView_cb:function(e){MyUiManager.Open(MyUiManager.PanelInfo.ActivityQiZhenYiBaoPanel,{info:e,closeCb:this.getCloseCb})},S2CMineList_cb:function(e){r("MainHomeManager").getInstance().BlackMaskFadeIn(function(){MyUiManager.Open(MyUiManager.PanelInfo.MineMainPanel,{netData:e,closeCb:this.getCloseCb})}.bind(this))},S2CGuozhanView_cb:function(e){u.initNetData(e);r("MainHomeManager").getInstance().BlackMaskFadeIn(function(){MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanMainPanel,{netData:e,closeCb:this.getCloseCb})}.bind(this))},S2CGuozhanFightView_cb:function(e){m.initNetData(e),u.initNetData(e);r("MainHomeManager").getInstance().BlackMaskFadeIn(function(){MyUiManager.Open(MyUiManager.PanelInfo.GuoZhanFightPanel,{netData:e,closeCb:this.getCloseCb})}.bind(this))},S2CSecretView_cb:function(e){d.initNetData(e);r("MainHomeManager").getInstance().BlackMaskFadeIn(function(){MyUiManager.Open(MyUiManager.PanelInfo.SecretMainPanel,{netData:e,closeCb:this.getCloseCb})}.bind(this))},S2CBossView_cb:function(e){_.initNetData(e);r("MainHomeManager").getInstance().BlackMaskFadeIn(function(){MyUiManager.Open(MyUiManager.PanelInfo.BossMainPanel,{netData:e,closeCb:this.getCloseCb})}.bind(this))},S2CAddDesktopShortcutAward_cb:function(e){if(null!=e.rewards&&0<e.rewards.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.rewards}},S2CGetQunheiWxShareAward_cb:function(e){if(null!=e.rewards&&0<e.rewards.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.rewards}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Chia sẻ thành công!")},registWeixinShareHandler:function(){window.onmessage=function(e){"shareok"==(e=e||event).data&&o.send_C2SGetQunheiWxShareAward(DonotDestroyManager._gameSocket)}},getCloseCb:function(){MyUiManager.isAllClosed()&&l.back2Hall()},OvercomeInfoAll_auth_cb:function(e){e.closeCb=this.getCloseCb,i.rand_key=e.rand_key,i.initBuffer(e),i.initOtrHerosHpdatas(e),MyUiManager.Open(MyUiManager.PanelInfo.FightThroughLayer,e,this._perLoadPanelPrefab)},TeamSkillList_auth_cb:function(e){cc.log(" nhận phục vụ khí quân đoàn kỹ năng tin tức "),e.closeCb=this.getCloseCb,MyUiManager.Open(MyUiManager.PanelInfo.TeamSkillPanel,e,this._perLoadPanelPrefab)},S2CListSign_auth_cb:function(e){MyUiManager.Open(MyUiManager.PanelInfo.SignInLayer,{info:e,closeCb:this.getCloseCb}),r("MainHomeManager").getInstance().BlackMaskFadeIn(null)},S2CRankView_cb:function(e){h.setWinLooseInfo(e.pkWinLoose),MyUiManager.Open(MyUiManager.PanelInfo.RankLayer,{info:e,closeCb:this.getCloseCb}),r("MainHomeManager").getInstance().BlackMaskFadeIn(null)},S2CQedjList_cb:function(e){MyUiManager.Open(MyUiManager.PanelInfo.QedjFuliPanel,{info:e,closeCb:this.getCloseCb})},_animationEventHandler:function(e,t){if(cc.isValid(this)&&cc.isValid(this.node)){var a=e.animation?e.animation.name:"",n=this.node.name,i=f.getInstance();if(0!=i._animConfig[n].loop.length){n==i._clickedBtnName&&a==i._animConfig[n].click&&i.clickAnimaComplete();var r=i._getAnimaByName(n),s=i._randomPick(i._animConfig[n].loop);r.setAnimation(0,s,!1)}}else
cc.warn("i'am onDestroy!")},_getAnimaByName:function(t){var a;return this._nodeList.forEach(function(e){e.name==t&&(a=e.getComponent(sp.Skeleton))},this),a},_randomPick:function(e){var t=e.length,a=Math.random(),n=parseInt(a*t);return e[n=t<=n?t-1:n]},clickHandler:function(e,t){cc.log("clickHandler,this._clickedBtnName:"+this._clickedBtnName);var a=this._getAnimaByName(t),n=this._animConfig[t].click;if(null==this._clickedBtnName){s.playBtnOpenEffect(),a.setAnimation(0,n,!1);var i=this,r=DonotDestroyManager.GameData.HomeMap.bones[t].unlock;"mailbox"==t||"shopmall"==t||"blackmart"==t?c.isUnlockCallBack(r,function(){i._clickedBtnName=t,i.clickAnimaStart(t)}):"labground"==t||"smithy"==t||"overcome"==t||"guild"==t?c.unlockTipsCb(r,function(){i._clickedBtnName=t,i.clickAnimaStart(t)}):(this._clickedBtnName=t,this.clickAnimaStart(t))}},clickHandlerStatic:function(e,t){s.playBtnOpenEffect(),"mine"==t?c.unlockTipsCb(44,function(){for(var e=MyPersistDataManager._playerData.level,t=DonotDestroyManager.GameData.Common.mine_levels,a=0,n=0;n<t.length-1&&e>=t[n];n++)
a=n;o.send_C2SMineList(DonotDestroyManager._gameSocket,a,0)}):"secret"==t&&c.unlockTipsCb(45,function(){o.send_C2SSecretView(DonotDestroyManager._gameSocket)})},HeadTabPanel_OnClickHandler:function(e,t){var a=parseInt(t);switch(s.playBtnOpenEffect(),a){case 0:MyUiManager.Open(MyUiManager.PanelInfo.BuyGameMoney,{closeCb:this.getCloseCb});break;case 1:MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:this.getCloseCb,state:-1}),r("MainHomeManager").getInstance().BlackMaskFadeIn(null);break;case 2:MyUiManager.Open(MyUiManager.PanelInfo.BuyEnergy,{closeCb:this.getCloseCb});break;case 3:MyUiManager.Open(MyUiManager.PanelInfo.UserDetailInfoLayer,{closeCb:this.getCloseCb})}},BattleTestBtn_OnClickHandler:function(e,t){},clickAnimaStart:function(a){var n=this;if(p[a]){if(!cc.sys.isNative)
if(null==cc.Canvas.instance.node.getChildByName("ShortLoadingLayer")){var e=cc.instantiate(DonotDestroyManager.ShortLoadingLayer);e.name="ShortLoadingLayer",e.active=!1,e.getComponent("ShortLoadingMask").setText("133"),cc.Canvas.instance.node.addChild(e)}
cc.loader.loadRes(p[a],cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),n._perLoadPanelPrefab=t,n.openPanel(),n._forceOpenPanelAction=n.node.runAction(cc.sequence(cc.delayTime(1.1),cc.callFunc(function(){1==this._OpenFlag&&(cc.warn(" cưỡng chế thêm tái ！panel=%s",a),this.openPanel())},n)))})}else
this.openPanel()},clickAnimaComplete:function(){var e=cc.Canvas.instance.node.getChildByName("ShortLoadingLayer");null!=e&&(e.active=!0);this.openPanel()},openPanel:function(){if(this._OpenFlag++,cc.log("openPanel,this._OpenFlag=%d",this._OpenFlag),2!=this._OpenFlag)
return!1;if(null==this._perLoadPanelPrefab)
return this._OpenFlag=0,this._clickedBtnName=null,cc.log("openPanel,reset _clickedBtnName"),!1;var e=function(){var e=this._clickedBtnName;switch(this._OpenFlag=0,(this._clickedBtnName=null)!=this._forceOpenPanelAction&&this.node.stopAction(this._forceOpenPanelAction),e){case"mailbox":MyUiManager.Open(MyUiManager.PanelInfo.MailPanel,{closeCb:this.getCloseCb},this._perLoadPanelPrefab);break;case"shopmall":MyUiManager.Open(MyUiManager.PanelInfo.RecruitPanel,{closeCb:this.getCloseCb},this._perLoadPanelPrefab);break;case"maincity":MyUiManager.Open(MyUiManager.PanelInfo.StageMapPanel,{closeCb:this.getCloseCb,iselite:!1},this._perLoadPanelPrefab);break;case"labground":o.send_C2STeamSkillList(DonotDestroyManager._gameSocket);break;case"blackmart":MyUiManager.Open(MyUiManager.PanelInfo.ShopMallLayer,{closeCb:this.getCloseCb},this._perLoadPanelPrefab);break;case"smithy":MyUiManager.Open(MyUiManager.PanelInfo.EsRoot,{closeCb:this.getCloseCb},this._perLoadPanelPrefab);break;case"overcome":o.send_C2SOvercomeInfoAll(DonotDestroyManager._gameSocket,0);break;case"arena":MyUiManager.Open(MyUiManager.PanelInfo.ActivityLayer,{closeCb:this.getCloseCb},this._perLoadPanelPrefab);break;case"guild":o.send_C2SGuozhanView(DonotDestroyManager._gameSocket);break;default:var t=cc.instantiate(this._perLoadPanelPrefab);cc.Canvas.instance.node.addChild(t),t.setPosition(0,0)}};"guild"!=this._clickedBtnName?r("MainHomeManager").getInstance().BlackMaskFadeIn(e.bind(this)):e.call(this);return!0},TopBtnPanel_OnClickHandler:function(e,t){var a=this,n=parseInt(t);s.playBtnOpenEffect();var i=r("MainHomeManager");switch(n){case 0:c.isUnlockCallBack(14,function(){o.send_C2SListSign(DonotDestroyManager._gameSocket),i.getInstance().BlackMaskFadeIn(null)});break;case 1:MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:this.getCloseCb}),i.getInstance().BlackMaskFadeIn(null);break;case 2:MyUiManager.Open(MyUiManager.PanelInfo.TestActivityLayer,{closeCb:this.getCloseCb,targetActId:16}),i.getInstance().BlackMaskFadeIn(null);break;case 3:MyUiManager.Open(MyUiManager.PanelInfo.FirstPayPanel,{closeCb:this.getCloseCb}),i.getInstance().BlackMaskFadeIn(null);break;case 4:c.isUnlockCallBack(20,function(){MyUiManager.Open(MyUiManager.PanelInfo.BlackShop,{closeCb:a.getCloseCb}),i.getInstance().BlackMaskFadeIn(null)});break;case 5:o.send_C2SRankView(DonotDestroyManager._gameSocket,1);break;case 6:if(null!=window.open_platform)
switch(window.open_platform){case 1:case 2:case 3:case 6:MyUiManager.Open(MyUiManager.PanelInfo.DailySharePanel,{})}
else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,180),"Chưa thực hiện!",1e3);break;case 7:MyUiManager.Open(MyUiManager.PanelInfo.TestActivityLayer,{closeCb:this.getCloseCb,targetActId:128}),i.getInstance().BlackMaskFadeIn(null);break;case 8:mqq.ui.addShortcut({action:"web",title:" tam quốc quân đoàn chiến ",icon:window.OPEN_DATA.appicon,url:window.OPEN_DATA.jumpurl,callback:function(e){}}),this.node.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){o.send_C2SAddDesktopShortcutAward(DonotDestroyManager._gameSocket)})));break;case 9:MyUiManager.Open(MyUiManager.PanelInfo.WanbaFuliLayer,{closeCb:this.getCloseCb});break;case 10:c.unlockTipsCb(46,function(){var e=_.getMyLevelIndex();o.send_C2SBossView(DonotDestroyManager._gameSocket,e)});break;case 11:o.send_C2SQedjList(DonotDestroyManager._gameSocket);break;case 12:o.send_C2SQiZhenYiBaoView(DonotDestroyManager._gameSocket)}},releasePreloadPrefab:function(){null!=this._perLoadPanelPrefab&&(this._perLoadPanelPrefab=null)},onDestroy:function(){this._nodeList=[],a.removeListener(n.S2CListSign,this.S2CListSign_auth_cb_func),a.removeListener(n.S2CRankView,this.S2CRankView_cb_func),a.removeListener(n.S2CTeamSkillList,this.TeamSkillList_auth_cb_func),a.removeListener(n.S2COvercomeInfoAll,this.OvercomeInfoAll_auth_cb_func),a.removeListener(n.S2CGetQunheiWxShareAward,this.S2CGetQunheiWxShareAward_cb_func),a.removeListener(n.S2CAddDesktopShortcutAward,this.S2CAddDesktopShortcutAward_cb_func),a.removeListener(n.S2CMineList,this.S2CMineList_cb_func),a.removeListener(n.S2CSecretView,this.S2CSecretView_cb_func),a.removeListener(n.S2CGuozhanView,this.S2CGuozhanView_cb_func),a.removeListener(n.S2CQedjList,this.S2CQedjList_cb_func),a.removeListener(n.S2CQiZhenYiBaoView,this.S2CQiZhenYiBaoView_cb_func),f.instance=null,window.onmessage=null},showGuide:function(){var e=r("GuideBufferMgr"),a=this;e.showGuide("HomeMainLayer",function(e){var t=r("MainHomeManager").getInstance()._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar");switch(e){case 1:return t._openCallback=function(){a.showGuide()},t.mControlBtn;case 2:return t.mMenuItemTable[0];case 3:return t.mMenuItemTable[1];case 4:return t.mMenuItemTable[2];case 5:return t.mMenuItemTable[3];case 6:return t.mMenuItemTable[4];case 7:return a.mScrollView.scrollToPercentHorizontal(.3),a.m_pMainBtnParent.getChildByName("shopmall");case 8:return a.mScrollView.scrollToPercentHorizontal(.2),a.m_pMainBtnParent.getChildByName("arena");case 9:return a.mScrollView.scrollToPercentHorizontal(.3),a.m_pMainBtnParent.getChildByName("shopmall");case 10:return a.mScrollView.scrollToPercentHorizontal(.2),a.m_pMainBtnParent.getChildByName("arena");case 11:return a.mScrollView.scrollToPercentHorizontal(.6),a.m_pMainBtnParent.getChildByName("labground");case 12:return a.mScrollView.scrollToPercentHorizontal(.9),a.m_pMainBtnParent.getChildByName("smithy");case 13:return a.mScrollView.scrollToPercentHorizontal(0),a.m_pMainBtnParent.getChildByName("citygate");case 14:return a.mScrollView.scrollToPercentHorizontal(0),a.nodes_top_guide[0];case 15:return a.mScrollView.scrollToPercentHorizontal(0),a.nodes_top_guide[1]}},null)}});cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",BossBufferMgr:"BossBufferMgr",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",GuozhanBufferMgr:"GuozhanBufferMgr",GuozhanFightBufferMgr:"GuozhanFightBufferMgr",MainHomeManager:"MainHomeManager",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",OverComeBufferMgr:"OverComeBufferMgr",PVEBattleManager:"PVEBattleManager",PkBufferMgr:"PkBufferMgr",SecretBufferMgr:"SecretBufferMgr",SoundUtil:"SoundUtil",UnLockCfgMgr:"UnLockCfgMgr"}],MainHomeManager:[function(i,e,t){"use strict";cc._RF.push(e,"bc7bfrbegRGcbQOC5o4RqsI","MainHomeManager");var a=i("MainButtonManager"),n=i("MyEventDispatcher"),r=i("MyUIEvent"),s=i("MyProtocols"),o=i("NetEvent"),c=i("GuideBufferMgr"),l=cc.Class({extends:cc.Component,properties:{BlackMask:cc.Node,FunctionBtnBar:cc.Prefab,UI_parent:cc.Node,RedPoint_mail:cc.Node,RedPoint_pub:cc.Node,RedPoint_teamskill:cc.Node,RedPoint_sign:cc.Node,RedPoint_stage:cc.Node,RedPoint_activity:cc.Node,RedPoint_tieJiangPu:cc.Node,RedPoint_mine:cc.Node,RedPoint_secret:cc.Node,RedPoint_gz:cc.Node,_functionBarNode:cc.Node},statics:{instance:null,getInstance:function(){return l.instance}},onLoad:function(){(l.instance=this).BlackMask.opacity=0;var e=cc.instantiate(this.FunctionBtnBar);this._functionBarNode=e,this.UI_parent.addChild(e),e.setPosition(cc.p(0,0)),e.setSiblingIndex(1),this.BlackMaskFadeOut(),this.S2CListRedPoints_cb_func=this.S2CListRedPoints_cb.bind(this),n.addListener(o.S2CListRedPoints,this.S2CListRedPoints_cb_func)},S2CListRedPoints_cb:function(e){null!=e.has_redpoint&&(-1<e.has_redpoint.indexOf(1)?this.RedPoint_mail.active=!0:this.RedPoint_mail.active=!1,-1<e.has_redpoint.indexOf(2)?this.RedPoint_pub.active=!0:this.RedPoint_pub.active=!1,-1<e.has_redpoint.indexOf(3)?this.RedPoint_teamskill.active=!0:this.RedPoint_teamskill.active=!1,-1<e.has_redpoint.indexOf(4)?this.RedPoint_sign.active=!0:this.RedPoint_sign.active=!1,-1<e.has_redpoint.indexOf(5)?this._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").SetRedPoint(5,!0):this._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").SetRedPoint(5,!1),-1<e.has_redpoint.indexOf(6)?this._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").SetRedPoint(6,!0):this._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").SetRedPoint(6,!1),-1<e.has_redpoint.indexOf(14)?this._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").SetRedPoint(14,!0):this._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").SetRedPoint(14,!1),-1<e.has_redpoint.indexOf(7)?this.RedPoint_stage.active=!0:this.RedPoint_stage.active=!1,0<e.activity_redpoints.length?this.RedPoint_activity.active=!0:this.RedPoint_activity.active=!1,-1<e.has_redpoint.indexOf(9)||-1<e.has_redpoint.indexOf(10)?this.RedPoint_tieJiangPu.active=!0:this.RedPoint_tieJiangPu.active=!1,-1<e.has_redpoint.indexOf(11)?this.RedPoint_mine.active=!0:this.RedPoint_mine.active=!1,-1<e.has_redpoint.indexOf(12)?this.RedPoint_secret.active=!0:this.RedPoint_secret.active=!1,-1<e.has_redpoint.indexOf(13)?this.RedPoint_gz.active=!0:this.RedPoint_gz.active=!1,MyPersistDataManager._playerData.RedPoint=e.has_redpoint,MyPersistDataManager._playerData.RedPointActivity=e.activity_redpoints,n.dispatchEvent(r.redPointsRefresh))},BlackMaskFadeIn:function(e){this.BlackMask.stopAllActions(),this.BlackMask.opacity=0;var t=cc.callFunc(function(){null!=e&&e(),this.active=!1,i("ChatPanel").getInstance().node.active=!1},this.node),a=cc.fadeIn(.2),n=cc.sequence(a,t);this.BlackMask.runAction(n)},BlackMaskFadeOut:function(){this.BlackMask.stopAllActions(),this.node.active=!0;var e=i("ChatPanel");null!=e.getInstance()&&(e.getInstance().node.active=!0),this.BlackMask.opacity=255;var t=this;this.BlackMask.runAction(cc.sequence(cc.fadeOut(.2),cc.callFunc(function(){t.fadeOutCb()}))),null!=a.getInstance()&&null!=a.getInstance()._perLoadPanelPrefab&&a.getInstance().releasePreloadPrefab(),this.CheckRedPoiot(),c.hasHomeFirstGuide(MyPersistDataManager._playerData._firstEnterHome)?this._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").changeStatus(0):this._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").changeStatus(1)},fadeOutCb:function(){var n=this.fadeOutCb.bind(this);if(null==MyPersistDataManager._wanba_gift||null==MyPersistDataManager._wanba_gift.wanba_gift_id)
if(null!=MyPersistDataManager._offlineAwardInfo&&null!=MyPersistDataManager._offlineAwardInfo.offline_rewards&&0<MyPersistDataManager._offlineAwardInfo.offline_rewards.length){null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node));var i=this;cc.loader.loadRes("Prefab/UserDetailInfo/OfflineRewardWidget",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=i._shortMask_node&&(i._shortMask_node.destroy(),i._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("OfflineRewardsWidget").changeData(n)})}else{c.offlineRewardFix();i=this;var e=!1,t=cc.sys.localStorage.getItem("ActivityTodayNoShow");if(null!=t&&1==parseInt(t))
parseInt(cc.sys.localStorage.getItem("ActivityTodayNoShow-day"))!=(new Date).getDate()?cc.sys.localStorage.setItem("ActivityTodayNoShow",0):e=!0;MyPersistDataManager._playerData._firstEnterHome&&5<MyPersistDataManager._playerData.level&&!e?MyUiManager.Open(MyUiManager.PanelInfo.TestActivityLayer,{closeCb:function(){i.BlackMaskFadeOut(),MyPersistDataManager._playerData._firstEnterHome=!1,a.getInstance().showGuide()},targetActId:16}):(MyPersistDataManager._playerData._firstEnterHome=!1,a.getInstance().showGuide())}
else
MyUiManager.Open(MyUiManager.PanelInfo.WanbaLibaoGetLayer,{closeCb:n,netData:MyPersistDataManager._wanba_gift})},CheckRedPoiot:function(){s.send_C2SListRedPoints(DonotDestroyManager._gameSocket)},onEnable:function(){},onDestroy:function(){l.instance=null,n.removeListener(o.S2CListRedPoints,this.S2CListRedPoints_cb_func)}});cc._RF.pop()},{ChatPanel:"ChatPanel",GuideBufferMgr:"GuideBufferMgr",MainButtonManager:"MainButtonManager",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent"}],MainHomeSceneManager:[function(e,t,a){"use strict";cc._RF.push(t,"a6a78yrOjxO0q1T3WgO/8d1","MainHomeSceneManager");var n=e("ResLoaderManager"),i=e("HeroBufferMgr"),r=(e("EquipBufferMgr"),e("ItemBufferMgr")),s=e("GuideBufferMgr"),o=(e("PropHitsRes"),e("GameUtils")),c=(e("MainHomeManager"),e("MarqueeBufferMgr")),l=e("MyUIEvent"),h=e("MyEventDispatcher"),d=[{url:"/Prefab/ui/mainhome/scenePrefab",type:cc.Prefab},{url:"/Prefab/Guide/GuideLayer",type:cc.Prefab},{url:"/Prefab/ChatPanel/ChatPanel",type:cc.Prefab},{url:"sound/zjm_01",type:cc.AudioClip},{url:"/Prefab/ui/common/Tip",type:cc.Prefab},{url:"/battle/battleunits",type:cc.SpriteFrame},{url:"/Prefab/UserDetailInfo/MarqueeWidget",type:cc.Prefab}],_=cc.Class({extends:cc.Component,properties:{_raw_assets:Map,_loadingLayer:null,_gameDataList:null,_sceneNode:null},statics:{instance:null,getInstance:function(){return _.instance}},onLoad:function(){cc.sys.garbageCollect(),this._sceneNode=null,(_.instance=this)._loadingLayer=cc.instantiate(DonotDestroyManager.loadingLayer),this._loadingLayer.setPosition(0,0),cc.Canvas.instance.node.addChild(this._loadingLayer,100),this._raw_assets=new Map;var t=[];d.forEach(function(e){"/Prefab/ui/common/Tip"==e.url&&null!=DonotDestroyManager.DescribeTip||"/Prefab/Guide/GuideLayer"==e.url&&null!=DonotDestroyManager.GuideLayer||"/battle/battleunits"==e.url&&null!=DonotDestroyManager.BattleUnitPic||"/Prefab/UserDetailInfo/MarqueeWidget"==e.url&&null!=DonotDestroyManager.MarqueeWidget||t.push([e.url,e.type])},this),null==DonotDestroyManager.GameData&&t.push(["data/designAll",cc.TestAsset]);var e=this._loadProgressCb.bind(this),a=this._loadFinishCb.bind(this);n.asyncLoadAll(t,e,a),this.onUiInstancePrefab_cb_func=this.onUiInstancePrefab_cb.bind(this),h.addListener(l.onUiInstancePrefab,this.onUiInstancePrefab_cb_func)},onDestroy:function(){(_.instance=null)!=this._raw_assets&&(this._raw_assets.clear(),this._raw_assets=null),h.removeListener(l.onUiInstancePrefab,this.onUiInstancePrefab_cb_func)},onUiInstancePrefab_cb:function(e){null!=this._loadingLayer&&(this._loadingLayer.destroy(),this._loadingLayer=null),h.removeListener(l.onUiInstancePrefab,this.onUiInstancePrefab_cb_func),e||o.back2Hall()},_loadProgressCb:function(e){this._loadingLayer.getComponent("LoadingLayerCtrl").changeProgress(e)},_loadFinishCb:function(e,t){var a=this;if(null==DonotDestroyManager.GameData&&(DonotDestroyManager.GameData=new Object),t.forEach(function(e){0<=e[0].indexOf("data")?DonotDestroyManager.GameData=e[1]:"/Prefab/ui/common/Tip"==e[0]?null==DonotDestroyManager.DescribeTip&&(DonotDestroyManager.DescribeTip=e[1]):"/Prefab/Guide/GuideLayer"==e[0]?null==DonotDestroyManager.GuideLayer&&(DonotDestroyManager.GuideLayer=e[1]):"/battle/battleunits"==e[0]?null==DonotDestroyManager.BattleUnitPic&&(DonotDestroyManager.BattleUnitPic=e[1]):"/Prefab/UserDetailInfo/MarqueeWidget"==e[0]?null==DonotDestroyManager.MarqueeWidget&&(DonotDestroyManager.MarqueeWidget=e[1]):a._raw_assets.set(e[0],e[1]),e=null}),null!=MyPersistDataManager._playerData.baglist&&r.initItemList(MyPersistDataManager._playerData.baglist),null!=MyPersistDataManager._playerData.cardslist&&i.initHeroList(MyPersistDataManager._playerData.cardslist),null!=MyPersistDataManager._playerData.guideList&&s.initGuideBufferMgr(MyPersistDataManager._playerData.guideList),!s.isGuideBattlePass())
return c.setMarqueeCanPlay(!0),void MyUiManager.Open(MyUiManager.PanelInfo.GameStoryLayer,{sex:MyPersistDataManager._playerData.sex});MyBgMusicManager.play(this._raw_assets.get("sound/zjm_01")),0<MyUiManager.BackList.length?s.hasHomeFirstGuide(!1)?(MyUiManager.clearBackList(),this.instanceSceneNode(),this._loadingLayer.destroy(),this._loadingLayer=null):MyUiManager.Back():(this.instanceSceneNode(),this._loadingLayer.destroy(),this._loadingLayer=null),c.setMarqueeCanPlay(!0),c.checkHasMsg()&&c.doPlay()},instanceSceneNode:function(){this._sceneNode=cc.instantiate(this._raw_assets.get("/Prefab/ui/mainhome/scenePrefab")),this._sceneNode.setPosition(0,0),cc.Canvas.instance.node.addChild(this._sceneNode);var e=cc.instantiate(this._raw_assets.get("/Prefab/ChatPanel/ChatPanel"));cc.Canvas.instance.node.addChild(e);var i=this;1==DonotDestroyManager.isGm&&cc.loader.loadRes("/Prefab/GmPanel/gmbtn",function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);i._sceneNode.addChild(a);var n=new cc.Component.EventHandler;n.target=i.node,n.component="MainHomeSceneManager",n.handler="Gm_OnClickHandler",a.getComponent(cc.Button).clickEvents[0]=n})},Gm_OnClickHandler:function(e){MyUiManager.Open(MyUiManager.PanelInfo.GmPanel,"")}});cc._RF.pop()},{EquipBufferMgr:"EquipBufferMgr",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",HeroBufferMgr:"HeroBufferMgr",ItemBufferMgr:"ItemBufferMgr",MainHomeManager:"MainHomeManager",MarqueeBufferMgr:"MarqueeBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",PropHitsRes:"PropHitsRes",ResLoaderManager:"ResLoaderManager"}],MainMenuFuncBtnBar:[function(r,e,t){"use strict";cc._RF.push(e,"017b9f/xUxGt4kffRqSZVFy","MainMenuFuncBtnBar");var s=r("SoundUtil"),o=r("UnLockCfgMgr"),a=r("GameUtils");cc.Class({extends:cc.Component,properties:{RootSpriteBtnList:[cc.SpriteFrame],mControlBtn:cc.Node,mBgSpr:cc.Node,mMenuItemTable:[cc.Node],_isOpen:!1,_openCallback:null,mSprRedTask:cc.Node,mSprRedDailyTask:cc.Node,node_red_bag:cc.Node},onLoad:function(){this._isOpen=!1,this.mControlBtn.getComponent(cc.Sprite).spriteFrame=this.RootSpriteBtnList[0],this.initRedPoints()},initRedPoints:function(){null!=MyPersistDataManager._playerData&&null!=MyPersistDataManager._playerData.RedPoint&&(-1<MyPersistDataManager._playerData.RedPoint.indexOf(5)?this.SetRedPoint(5,!0):this.SetRedPoint(5,!1),-1<MyPersistDataManager._playerData.RedPoint.indexOf(6)?this.SetRedPoint(6,!0):this.SetRedPoint(6,!1),-1<MyPersistDataManager._playerData.RedPoint.indexOf(14)?this.SetRedPoint(14,!0):this.SetRedPoint(14,!1))},changeStatus:function(e){if(1==e){this._isOpen=!0,this.mControlBtn.getComponent(cc.Sprite).spriteFrame=this.RootSpriteBtnList[1],this.mBgSpr.height=562;for(var t=0;t<this.mMenuItemTable.length;t++)
this.mMenuItemTable[t].active=!0,this.mMenuItemTable[t].opacity=255}else{this._isOpen=!1,this.mControlBtn.getComponent(cc.Sprite).spriteFrame=this.RootSpriteBtnList[0];for(t=this.mBgSpr.height=0;t<this.mMenuItemTable.length;t++)
this.mMenuItemTable[t].active=!1}},FunctionBarHandler:function(){s.playBtnOpenEffect();var e=this.getComponent(cc.Animation);this._isOpen?e.play("FunctionBtnBar"):e.play("FunctionBtnBarOpen")},PlayInit:function(){},onBarCloseFinish:function(){this._isOpen=!1,this.mControlBtn.getComponent(cc.Sprite).spriteFrame=this.RootSpriteBtnList[0]},onBarOpenFinish:function(){this._isOpen=!0,null!=this._openCallback&&this._openCallback(),this.mControlBtn.getComponent(cc.Sprite).spriteFrame=this.RootSpriteBtnList[1]},SetRedPoint:function(e,t){switch(e){case 5:this.mSprRedTask.active=t;break;case 6:this.mSprRedDailyTask.active=t;break;case 14:this.node_red_bag.active=t}},RightBtn_OnClickHandler:function(e,t){var a=parseInt(t),n=this;s.playBtnOpenEffect();var i=r("MainHomeManager");switch(a){case 0:o.isUnlockCallBack(5,function(){MyUiManager.Open(MyUiManager.PanelInfo.ArmyPanel,{closeCb:n.getCloseCb.bind(n)}),null!=i.getInstance()&&i.getInstance().BlackMaskFadeIn(null)});break;case 1:o.isUnlockCallBack(2,function(){MyUiManager.Open(MyUiManager.PanelInfo.StoreHousePanel,{closeCb:n.getCloseCb.bind(n)}),null!=i.getInstance()&&i.getInstance().BlackMaskFadeIn(null)});break;case 2:o.unlockTipsCb(20,function(){MyUiManager.Open(MyUiManager.PanelInfo.SmelterMain,{closeCb:n.getCloseCb.bind(n)}),null!=i.getInstance()&&i.getInstance().BlackMaskFadeIn(null)});break;case 3:o.unlockTipsCb(7,function(){MyUiManager.Open(MyUiManager.PanelInfo.MissionLayer,{closeCb:n.getCloseCb.bind(n)}),null!=i.getInstance()&&i.getInstance().BlackMaskFadeIn(null)});break;case 4:o.unlockTipsCb(13,function(){MyUiManager.Open(MyUiManager.PanelInfo.DayActivityLayer,{closeCb:n.getCloseCb.bind(n)}),null!=i.getInstance()&&i.getInstance().BlackMaskFadeIn(null)})}},getCloseCb:function(){MyUiManager.isAllClosed()&&a.back2Hall()}}),cc._RF.pop()},{GameUtils:"GameUtils",MainHomeManager:"MainHomeManager",SoundUtil:"SoundUtil",UnLockCfgMgr:"UnLockCfgMgr"}],MarqueeBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"2006f4g4WJCVqCE1E3FuxDz","MarqueeBufferMgr");var n=function(){this.msgList=[],this.currentLoopCount=0,this.marqueeCanPlay=!1};n.prototype.insertMsgContent=function(e){this.msgList.push(e)},n.prototype.doPlay=function(){if(this.marqueeCanPlay&&null==cc.Canvas.instance.node.getChildByName("MarqueeWidget")){var e=cc.instantiate(DonotDestroyManager.MarqueeWidget);e.name="MarqueeWidget",e.setLocalZOrder(1e4),cc.Canvas.instance.node.addChild(e)}},n.prototype.addPlayCount=function(){if(this.currentLoopCount++,0!=this.msgList.length){var e=this.msgList[0];this.currentLoopCount>=e.count&&(this.msgList.shift(),this.currentLoopCount=0)}},n.prototype.setMarqueeCanPlay=function(e){this.marqueeCanPlay=e},n.prototype.getPlayingMsg=function(){return 0==this.msgList.length?null:this.msgList[0]},n.prototype.checkHasMsg=function(){return 0<this.msgList.length},t.exports=new n,cc._RF.pop()},{}],MarqueeWidget:[function(e,t,a){"use strict";cc._RF.push(t,"6f5804lJIxJ67Fjc+U5pHvB","MarqueeWidget");var n=e("MarqueeBufferMgr");cc.Class({extends:cc.Component,properties:{msgContentLabel:cc.Label},onLoad:function(){var e=n.getPlayingMsg();this.msgContentLabel.string=this.format2PlayMsg(e),this.msgContentLabel.node.x=240,this.node.opacity=0},format2PlayMsg:function(e){if(-1==e.template_id)
return e.content;var t=DonotDestroyManager.GameData.Marquee[e.template_id],a=e.parameters[1];if(0==e.template_id||1==e.template_id||2==e.template_id||24==e.template_id){var n=e.parameters[1];a=DonotDestroyManager.GameData.Cards[n].name}else if(13==e.template_id){var i=e.parameters[1];a=DonotDestroyManager.GameData.Equips[i].name}else if(14==e.template_id){var r=e.parameters[1];a=DonotDestroyManager.GameData.Treasures[r].name}
return 2==e.parameters.length?cc.js.formatStr(t.text[0],e.parameters[0],a):3==e.parameters.length?cc.js.formatStr(t.text[0],e.parameters[0],a,e.parameters[2]):cc.js.formatStr(t.text[0],e.parameters)},start:function(){this.node.runAction(cc.fadeIn(.2))},update:function(e){this.msgContentLabel.node.x-=100*e,this.msgContentLabel.node.x<-(this.msgContentLabel.node.width+280)&&this.playNext()},playNext:function(){n.addPlayCount();var e=n.getPlayingMsg();null==e?this.node.runAction(cc.sequence(cc.fadeOut(.2),cc.callFunc(function(){this.node.destroy()},this))):(this.msgContentLabel.string=this.format2PlayMsg(e),this.msgContentLabel.node.x=280)}}),cc._RF.pop()},{MarqueeBufferMgr:"MarqueeBufferMgr"}],MeleeArmy:[function(o,e,t){"use strict";cc._RF.push(e,"46d5dKUBHlP54zp62NZJe2K","MeleeArmy");var c=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=o("state-machine"),l=o("SoundUtil"),s=o("BattleConstants"),n=cc.Class({extends:o("Army"),properties:{},ctor:function(){cc.log("MeleeArmy create!"),this.assaultRange=0,this.chargeST=null},setFSM:function(){var e=this;this.fsm=a.create({initial:"Idle",events:[{name:"Idle",from:["Charge","Move","Meet","Arrange","Strategy"],to:"Idle"},{name:"Charge",from:["Idle","Move","Arrange"],to:"Charge"},{name:"Move",from:"Idle",to:"Move"},{name:"Meet",from:["Idle","Move","Arrange"],to:"Meet"},{name:"Victory",from:"Idle",to:"Victory"},{name:"Destory",from:["Idle","Charge","Move","Meet","Arrange"],to:"Destory"},{name:"Arrange",from:["Charge","Move","Meet"],to:"Arrange"},{name:"Strategy",from:"Idle",to:"Strategy"}],callbacks:{onenterstate:function(e,t,a){},onafterDead:function(){e.onafterDead()},onenterIdle:function(){e.onenterIdle()},onenterMove:function(){e.onenterMove()},onleaveMove:function(){e.onleaveMove()},onenterArrange:function(){e.onenterArrange()},onleaveArrange:function(){e.onleaveArrange()},onleaveMeet:function(){e.onleaveMeet()},onenterDestory:function(){e.onenterDestory()},onenterVictory:function(){e.onenterVictory()},onenterStrategy:function(){e.onenterStrategy()},onleaveStrategy:function(){e.onleaveStrategy()},onenterCharge:function(){e.onenterCharge()},onleaveCharge:function(){e.onleaveCharge()},onenterMeet:function(){e.onenterMeet()}}}),this.hero?this.assaultRange=e.hero.uCfg.assault_range:this.assaultRange=e.soldiers[0].cfg.assault_range},isChargeAble:function(){return 0<this.target.slotsNum&&this.getDistance2Target(this.target)<this.assaultRange},isTargetAble:function(){return this.target&&0<this.target.slotsNum&&"Destory"!=this.target.getState()&&"Strategy"!=this.target.getState()},onenterCharge:function(){this.slotsNum=this.slotsNum-1,this.target.slotsNum=this.target.slotsNum-1,this.target.target!=this&&this.target.fsm.can("Meet")&&(this.target.target=this),this.target.doEvent("Meet"),this.meetTime=2;var e=o("BattleManager"),t=this.getArmyType();if(10!=t){var a=l.getBattleSound("assault",t),n=c(a,2),i=n[0],r=n[1],s=2==t?1:0;e.chargeSE[s]||(this.chargeST=r,e.chargeSE[s]=l.playEffect(i))}},onleaveCharge:function(){var e=o("BattleManager");if(this.slotsNum=this.slotsNum+1,this.target.slotsNum=this.target.slotsNum+1,this.chargeST){for(var t=0;t<e.chargeSE.length;t++){var a=e.chargeSE[t];l.stopEffect(a)}
this.chargeST=null}},onenterMeet:function(){if(0<this.meetTime){var e,t,a=0<this.getVector2Target().x?1:-1;if(this.hero&&"Dead"!=this.hero.getState()){var n=this.hero.getPosition();e=n.x,t=n.y,this.hero.meet2Pos=cc.p(e+30*a,t),this.hero.doEvent("Meet")}
for(var i=0;i<this.soldiers.length;i++){var r=this.soldiers[i],s=Math.floor(i/5),o=i%5,c=r.getPosition();e=c.x,t=c.y,e=e+(150+40*s)*a-25*Math.abs(o-2)*a,t=t+20*s*(s%2==0?1:-1)-10*(o-2),r.meet2Pos=cc.p(e,t),r.doEvent("Meet")}}},switchAttackTarget:function(){var e=o("ArmiesManager").searchTargetForMelee(this);e&&e!=this.target&&(this.target=e)},onUpdate:function(e){var t=o("BattleManager");if(t.btlState!=s._BTL_STATE.INIT){this._super(e);var a=this.getState(),n=o("ArmiesManager");if("Idle"!=a||this.hero&&this.hero.openSkilled)
if("Charge"==a)
if("Destory"!=this.target.getState()||null!=this.hero&&"Skill"==this.hero.getState()){n.searchChargeForUnits(this),this.hero&&this.hero.isTargetAble()&&this.hero.isChargeAble()&&this.hero.doEvent("Charge");for(var i=0;i<this.soldiers.length;i++){(r=this.soldiers[i]).isTargetAble()&&r.isChargeAble()?r.doEvent("Charge"):r.isWanderAble()&&r.doEvent("Wander")}}else
this.slotsNum<1?this.doEvent("Idle"):this.doEvent("Arrange");else if("Move"==a)"Destory"==this.target.getState()?this.doEvent("Arrange"):this.getDistance2Target(this.target)>this.assaultRange?(this.setMoveVector(),cc.director.getTotalFrames()%40==0&&this.switchAttackTarget(),cc.director.getTotalFrames()%23==0&&this.hero&&"Idle"==this.hero.getState()&&this.hero.doEvent("Move")):0<this.target.slotsNum?this.doEvent("Charge"):this.doEvent("Arrange");else if("Meet"==a)
if("Destory"!=this.target.getState()||null!=this.hero&&"Skill"==this.hero.getState())
if(this.meetTime<0){n.searchChargeForUnits(this),this.hero&&this.hero.isTargetAble()&&this.hero.isChargeAble()&&this.hero.doEvent("Charge");for(i=0;i<this.soldiers.length;i++){var r;(r=this.soldiers[i]).isTargetAble()&&r.isChargeAble()?r.doEvent("Charge"):r.isWanderAble()&&r.doEvent("Wander")}}else
this.meetTime=this.meetTime-e;else
this.slotsNum<2?this.doEvent("Idle"):this.doEvent("Arrange");else"Arrange"==a?this.isArranged()?this.doEvent("Idle"):(cc.director.getTotalFrames()%48==0&&this.switchAttackTarget(),this.isTargetAble()&&this.getDistance2Target(this.target)<this.assaultRange&&0<this.target.slotsNum&&this.doEvent("Charge")):"Strategy"==a&&this.updateStrategy(e);else{if(0<this.delayMove)
return void(this.delayMove=this.delayMove-e);t.btlState==s._BTL_STATE.CHEER?this.doEvent("Victory"):(this.target=n.searchTargetForMelee(this),this.isTargetAble()&&(this.isChargeAble()?"Charge"==this.target.getState()&&this.target.target==this?(this.doEvent("Meet"),this.meetTime=0):this.doEvent("Charge"):this.doEvent("Move")))}}}});e.exports=n,cc._RF.pop()},{ArmiesManager:"ArmiesManager",Army:"Army",BattleConstants:"BattleConstants",BattleManager:"BattleManager",SoundUtil:"SoundUtil","state-machine":"state-machine"}],MeleeHero:[function(e,t,a){"use strict";cc._RF.push(t,"e57fcCi6BNC3LjrHWklJBuT","MeleeHero");var n=e("state-machine"),l=e("BattleConstants"),i=e("DamageLogic"),r=cc.Class({extends:e("Hero"),properties:{},ctor:function(){cc.log("MeleeHero create!")},setFSM:function(){var e=this;this.fsm=n.create({initial:"Idle",events:[{name:"Idle",from:["Charge","Move","Meet","Attack","Stun","Frozen","Skill"],to:"Idle"},{name:"Charge",from:["Idle","Move"],to:"Charge"},{name:"Move",from:"Idle",to:"Move"},{name:"Meet",from:["Idle","Move"],to:"Meet"},{name:"Attack",from:["Idle","Charge","Skill"],to:"Attack"},{name:"Skill",from:"*",to:"Skill"},{name:"Dead",from:"*",to:"Dead"},{name:"Cheer",from:"Idle",to:"Cheer"},{name:"Stun",from:["Idle","Charge","Move","Meet","Attack","Skill","Frozen"],to:"Stun"},{name:"Frozen",from:["Idle","Charge","Move","Meet","Attack","Skill","Stun"],to:"Frozen"}],callbacks:{onenterstate:function(e,t,a){},onbeforeDead:function(){e.onbeforeDead()},onenterDead:function(){e.onenterDead()},onafterDead:function(){e.onafterDead()},onenterIdle:function(){e.onenterIdle()},onenterCharge:function(){e.onenterCharge()},onenterMeet:function(){e.onenterMeet()},onenterAttack:function(){e.onenterAttack()},onleaveAttack:function(){e.onleaveAttack()},onenterCheer:function(){e.onenterCheer()},onenterMove:function(){e.onenterMove()}}})},isChargeAble:function(){return this.fsm.can("Charge")},setTarget:function(e){if(this.lSlot&&"Dead"!=this.lSlot.getState())
this.target=this.lSlot;else if(this.rSlot&&"Dead"!=this.rSlot.getState())
this.target=this.rSlot;else if(e&&"Dead"!=e.getState())
if(e.lSlot==this||e.rSlot==this)
this.target=e;else if(e.target&&e.target.slot3V1==e)"left"!=e.target.side3V1||e.lSlot?"right"!=e.target.side3V1||e.rSlot||((e.rSlot=this).target=e,this.lSlot=e):((e.lSlot=this).target=e,this.rSlot=e);else if(e.target&&e.target.slot4V1==e)"left"!=e.target.side4V1||e.lSlot?"right"!=e.target.side4V1||e.rSlot||((e.rSlot=this).target=e,this.lSlot=e):((e.lSlot=this).target=e,this.rSlot=e);else{this.getPosition().x<e.getPosition().x?e.lSlot?e.rSlot||((e.rSlot=this).target=e,this.lSlot=e):((e.lSlot=this).target=e,this.rSlot=e):e.rSlot?e.lSlot||((e.lSlot=this).target=e,this.rSlot=e):((e.rSlot=this).target=e,this.lSlot=e),this.isTargetAble()||(e.slot3V1?e.slot4V1||((this.target=e).slot4V1=this,"left"==e.side3V1?e.side4V1="right":"right"==e.side3V1&&(e.side4V1="left")):((this.target=e).slot3V1=this,e.target&&"Hero"==e.target.class?e.target==e.lSlot?e.side3V1="right":e.target==e.rSlot&&(e.side3V1="left"):e.target&&"Soldier"==e.target.class&&(e.target==e.lSlot?e.side3V1="left":e.target==e.rSlot&&(e.side3V1="right"))))}},getVector2Target:function(){var e=this.target.getPosition(),t=e.x,a=e.y;this.target.lSlot==this?t=t-this.getUnitSize()-this.target.getUnitSize():this.target.rSlot==this?t=t+this.getUnitSize()+this.target.getUnitSize():this.target.slot3V1==this?"left"==this.target.side3V1?t=t-this.getUnitSize()-this.target.getUnitSize():"right"==this.target.side3V1&&(t=t+this.getUnitSize()+this.target.getUnitSize()):this.target.slot4V1==this&&("left"==this.target.side4V1?t=t-this.getUnitSize()-this.target.getUnitSize():"right"==this.target.side4V1&&(t=t+this.getUnitSize()+this.target.getUnitSize()));var n=this.getPosition(),i=n.x,r=n.y;return cc.pSub(cc.p(t,a),cc.p(i,r))},getDistance2Target:function(){return cc.pLength(this.getVector2Target())},switchSlot:function(e){this._super(e),this.switchCheckTarget()},setFace2Slot:function(){var e=Math.abs(this.amt.scaleX);1==this.cfg.is_spine&&(e*=-1),this.target==this.lSlot?this.amt.scaleX=e:this.target==this.rSlot?this.amt.scaleX=-e:this.target.slot3V1==this?"left"==this.target.side3V1?this.amt.scaleX=-e:"right"==this.target.side3V1&&(this.amt.scaleX=e):this.target.slot4V1==this&&("left"==this.target.side4V1?this.amt.scaleX=-e:"right"==this.target.side4V1&&(this.amt.scaleX=e))},onenterCharge:function(){null==this.cfg.is_spine?this.playAnimation("assault"):this.playAnimation("move")},onenterMeet:function(){null==this.cfg.is_spine?this.playAnimation("assault"):this.playAnimation("move"),this.disVector=cc.pSub(this.meet2Pos,cc.p(this.getPosition()))},onenterAttack:function(){this.setFace2Slot();var e=this.getAttackAniName();this.playAnimation(e),this.amt.getComponent(sp.Skeleton).setCompleteListener(this.atkAnimationCb.bind(this)),this.amt.getComponent(sp.Skeleton).setEventListener(this.fireAnimationCb.bind(this)),this.atkDelay=this.uCfg.atk_speed},onleaveAttack:function(){this.amt.getComponent(sp.Skeleton).setCompleteListener(function(){}),this.amt.getComponent(sp.Skeleton).setEventListener(function(){})},atkAnimationCb:function(e){"Attack"==this.getState()&&(this.nextEv?(this.doEvent(this.nextEv),"Idle"==this.nextEv&&(this.move2Pos?this.doEvent("Move"):this.meet2Pos&&this.doEvent("Meet")),this.nextEv=null):this.playAnimation("stand"))},fireAnimationCb:function(e,t){e.animation&&e.animation.name;if("fire"==t.data.name){var a=0;if(null!=this.cfg.hp_perc_dmg){var n=this.hp/this.basehp;a=(1-(n=1<=(n=n<=0?0:n)?1:n))*this.cfg.hp_perc_dmg}
i.commonDamage(this,this.target,a)}},onUpdate:function(e){this._super(e);var t=this.uCfg.assault_speed;this.cfg.is_spine&&(t*=1.1);var a=this.getState();if("Charge"==a)
if(this.disVector=this.getVector2Target(),cc.pLength(this.disVector)<t*e){var n=this.target.getPosition(),i=n.x,r=n.y;this.target.lSlot==this||this.target.slot3V1==this&&"left"==this.target.side3V1||this.target.slot4V1==this&&"left"==this.target.side4V1?i=i-this.getUnitSize()-this.target.getUnitSize():(this.target.rSlot==this||this.target.slot3V1==this&&"right"==this.target.side3V1||this.target.slot4V1==this&&"right"==this.target.side4V1)&&(i=i+this.getUnitSize()+this.target.getUnitSize()),this.setPosition(i,r),this.doEvent("Attack"),this.target.getAtkType()==l._ARMY_TYPE.Remote?this.target.switchTarget(this):this.target.target||(this.target.target=this).target.doEvent("Attack")}else
e*=cc.director.getScheduler().getTimeScale()*this.speedup,this.move(t,e);else if("Move"==a)
this.updateMove(e,this.uCfg.mv_speed*this.speedup);else if("Attack"==a)
0<this.atkDelay?this.atkDelay=this.atkDelay-e*cc.director.getScheduler().getTimeScale()*this.speedup:this.isTargetAble()&&this.getDistance2Target()<t*e?(this.setFace2Slot(),this.atkDelay=this.uCfg.atk_speed,this.playAnimation(this.getAttackAniName())):(this.doEvent("Idle"),this.move2Pos&&this.doEvent("Move"));else if("Meet"==a){var s=this.getPosition(),o=s.x,c=s.y;cc.pDistance(this.meet2Pos,cc.p(o,c))<t*e?this.doEvent("Idle"):this.move(t,e)}}});t.exports=r,cc._RF.pop()},{BattleConstants:"BattleConstants",DamageLogic:"DamageLogic",Hero:"Hero","state-machine":"state-machine"}],MeleeSoldier:[function(e,t,a){"use strict";cc._RF.push(t,"b354alkBHxCM4HArhfUT7Xw","MeleeSoldier");var n=e("state-machine"),l=e("BattleConstants"),i=e("DamageLogic"),h=[{x:0,y:75},{x:53,y:53},{x:75,y:0},{x:53,y:-53},{x:0,y:-75},{x:-53,y:-53},{x:-75,y:0},{x:-53,y:53}],r=cc.Class({extends:e("Soldier"),properties:{},ctor:function(){cc.log("MeleeSoldier create!"),this.wanderTarget=null,this.wander2Position=null},setFSM:function(){var e=this;this.fsm=n.create({initial:"Idle",events:[{name:"Idle",from:["Charge","Move","Meet","Attack","Stun","Frozen","Wander"],to:"Idle"},{name:"Charge",from:["Idle","Move","Wander"],to:"Charge"},{name:"Move",from:"Idle",to:"Move"},{name:"Meet",from:["Idle","Move"],to:"Meet"},{name:"Attack",from:["Idle","Charge"],to:"Attack"},{name:"Wander",from:["Idle","Move","Charge"],to:"Wander"},{name:"Dead",from:"*",to:"Dead"},{name:"Cheer",from:"Idle",to:"Cheer"},{name:"Stun",from:["Idle","Charge","Move","Meet","Attack","Wander","Frozen"],to:"Stun"},{name:"Frozen",from:["Idle","Charge","Move","Meet","Attack","Wander","Stun"],to:"Frozen"}],callbacks:{onenterstate:function(e,t,a){},onenterDead:function(){e.onenterDead()},onafterDead:function(){e.onafterDead()},onenterIdle:function(){e.onenterIdle()},onenterCharge:function(){e.onenterCharge()},onenterMeet:function(){e.onenterMeet()},onenterAttack:function(){e.onenterAttack()},onleaveAttack:function(){e.onleaveAttack()},onenterWander:function(){e.onenterWander()},onenterMove:function(){e.onenterMove()},onenterCheer:function(){e.onenterCheer()}}})},isChargeAble:function(){return this.fsm.can("Charge")},isWanderAble:function(){return!this.lSlot&&!this.rSlot&&this.fsm.can("Wander")},setTarget:function(e,t){if(this.lSlot&&"Dead"!=this.lSlot.getState())
this.target=this.lSlot;else if(this.rSlot&&"Dead"!=this.rSlot.getState())
this.target=this.rSlot;else if(e&&"Dead"!=e.getState())
if(e.lSlot==this||e.rSlot==this)
this.target=e;else if(e.target&&e.target.slot3V1==e)"left"!=e.target.side3V1||e.lSlot?"right"!=e.target.side3V1||e.rSlot||((e.rSlot=this).target=e,this.lSlot=e):((e.lSlot=this).target=e,this.rSlot=e);else if(e.target&&e.target.slot4V1==e)"left"!=e.target.side4V1||e.lSlot?"right"!=e.target.side4V1||e.rSlot||((e.rSlot=this).target=e,this.lSlot=e):((e.lSlot=this).target=e,this.rSlot=e);else if(1==t){var a=this.getPosition().x,n=e.getPosition().x;a<n&&!e.lSlot?((e.lSlot=this).target=e,this.rSlot=e):n<a&&!e.rSlot&&((e.rSlot=this).target=e,this.lSlot=e)}else
2==t&&(e.lSlot?e.rSlot||((e.rSlot=this).target=e,this.lSlot=e):((e.lSlot=this).target=e,this.rSlot=e))},getVector2Target:function(){var e=this.target.getPosition(),t=e.x,a=e.y,n=this.getPosition(),i=n.x,r=n.y;return this.target.lSlot==this?t=t-this.getUnitSize()-this.target.getUnitSize():this.target.rSlot==this&&(t=t+this.getUnitSize()+this.target.getUnitSize()),cc.pSub(cc.p(t,a),cc.p(i,r))},getDistance2Target:function(){return cc.pLength(this.getVector2Target())},setPosition2Wander:function(e,t){var a,n,i,r=e.soldiers.length;e.hero&&"Dead"!=e.hero.getState()?(a=t%(r+1),n=Math.floor(t/(r+1)),i=e.soldiers[a]||e.hero):0<r&&(a=t%r,n=Math.floor(t/r),i=e.soldiers[a]);var s=this.getPosition(),o=0;null!=i&&(s=i.getPosition(),o=i.getUnitSize());var c=s.x,l=s.y;this.wander2Position=n%2==1?cc.p(c+this.getUnitSize()+o,l):cc.p(c-this.getUnitSize()-o,l),this.wanderTarget=i},getDistance2Wander:function(){return cc.pDistance(this.getPosition(),this.wander2Position)},switchSlot:function(e){this._super(e),this.switchCheckTarget()},onenterCharge:function(){this.playAnimation("assault"),this.moveRandom=(49*Math.random()+1)/100},onenterMeet:function(){this.playAnimation("assault"),this.disVector=cc.pSub(this.meet2Pos,cc.p(this.getPosition()))},onenterAttack:function(){this.setFace2Slot(),this.playAttackAnimation(),this.atkDelay=this.cfg.atk_speed},fireAnimationCb:function(e){i.commonDamage(this,this.target,0)},onleaveAttack:function(){},onenterWander:function(){this.playAnimation("assault")},onUpdate:function(e){this._super(e);var t=this.getState();if("Charge"==t)
if(this.disVector=this.getVector2Target(),cc.pLength(this.disVector)<this.cfg.assault_speed*e){var a=this.target.getPosition(),n=a.x,i=a.y;this.target.lSlot==this?n=n-this.getUnitSize()-this.target.getUnitSize():this.target.rSlot==this&&(n=n+this.getUnitSize()+this.target.getUnitSize()),this.setPosition(n,i),this.doEvent("Attack"),this.target.getAtkType()==l._ARMY_TYPE.Remote?this.target.switchTarget(this):this.target.target||(this.target.target=this).target.doEvent("Attack")}else
e*=cc.director.getScheduler().getTimeScale(),this.move(this.cfg.assault_speed,e,"assault");else if("Move"==t)
this.updateMove(e,this.cfg.mv_speed);else if("Attack"==t)
0<this.atkDelay?this.atkDelay=this.atkDelay-e*cc.director.getScheduler().getTimeScale():this.isTargetAble()&&this.getDistance2Target()<this.cfg.assault_speed*e?(this.setFace2Slot(),this.atkDelay=this.cfg.atk_speed,this.playAttackAnimation()):(this.doEvent("Idle"),this.move2Pos&&this.doEvent("Move"));else if("Meet"==t){var r=this.getPosition(),s=r.x,o=r.y;cc.pDistance(this.meet2Pos,cc.p(s,o))<1.1*this.cfg.assault_speed*e?this.doEvent("Idle"):this.move(1.1*this.cfg.assault_speed,e)}else if("Wander"==t)
if(this.lSlot||this.rSlot||!this.wanderTarget||"Dead"==this.wanderTarget.getState())
this.doEvent("Idle");else if(this.getDistance2Wander()<1*this.cfg.mv_speed*e){var c=cc.p(this.wanderTarget.getPosition());this.wander2Position=cc.pAdd(c,h[parseInt(8*Math.random())])}else
this.disVector=cc.pSub(this.wander2Position,cc.p(this.getPosition())),this.move(.8*this.cfg.assault_speed,e)}});t.exports=r,cc._RF.pop()},{BattleConstants:"BattleConstants",DamageLogic:"DamageLogic",Soldier:"Soldier","state-machine":"state-machine"}],MineBattleManager:[function(o,e,t){"use strict";cc._RF.push(e,"c006cJRutVNS4C3pKq2Tzv+","MineBattleManager");o("TeamDataUtil");var u=o("BattleDataManager"),n=o("BattleUtil"),m=o("HeroConfigMgr"),a=o("MyProtocols"),d=o("PlayerBufferMgr"),_=o("HeroBufferMgr"),p=o("BattleBufferMgr"),c=(o("PkBufferMgr"),o("BattleManager")),i=function(){};i.prototype.init=function(e,t,a){var n=DonotDestroyManager.GameData.StageMobs;this.leftData=this.getLeftData(),this.rightData=this.getRightData(e),this.leftData.fightVal=t,this.rightData.fightVal=a,this.background=n[101].battleground,this.mEmenyData=e},i.prototype.enterBattlefield=function(){var e=DonotDestroyManager.GameData.TeamSkillsAI,t={background:this.background,teamAiCfg:e[4],type:9},a=this;n.createBattlefield(this.leftData,this.rightData,t,function(){a.onSuccess()},function(){a.onFailure()}),n.enterRealScene()},i.prototype.onSuccess=function(){var e=this.mEmenyData.rand_key-MyPersistDataManager._playerData.id;a.send_C2SMineBattleCalculate(DonotDestroyManager._gameSocket,this.mEmenyData.level_index,this.mEmenyData.point_index,1,e)},i.prototype.onFailure=function(){var e=this.mEmenyData.rand_key-MyPersistDataManager._playerData.id;a.send_C2SMineBattleCalculate(DonotDestroyManager._gameSocket,this.mEmenyData.level_index,this.mEmenyData.point_index,0,e)},i.prototype.calculateS2cCb=function(e){var t=o("BattleSceneMgr");if(0!=e.result){var a=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/MineWinPanel"]);cc.Canvas.instance.node.addChild(a);var n={info:e,enemy_name:this.rightData.name};a.getComponent("MineWinPanel").ChangeData(n),a.getComponent("MineWinPanel").setStatistics(this.leftData,this.rightData,c.statistics);var i=e.mine_point_detail;MyUiManager.updateUiParams(71,{netData:i})}else{var r=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(r);var s=DonotDestroyManager.GameData.Common.mine_energy_cost[1];r.getComponent("BattleFailMgr").initUi(9,{cost_energy:s,staticData:c.statistics})}},i.prototype.getLeftData=function(){var e={side:"left"};e.name=d.getNickName(),e.level=d.getUserLevel();var t=p.getFormationData(2);e.formation=t.formationId,e.forward=t.forward,e.flip=t.flip;for(var a=u.create(e),n=Object.keys(t),i=0;i<n.length;++i){var r=n[i];if("fid"!=r&&"formationId"!=r&&"forward"!=r&&"flip"!=r&&"0"!=r){var s=t[r],o=_.getHeroByUid(s);o&&(delete o.hpPerc,delete o.atkPerc,a.addCardWithPosition(o,r))}}
for(var c=0;c<a.teams.length;c++){var l=a.teams[c],h=_.getExtraPropAttr(l.hero.heroId);l.hero.extraAttr=cc.clone(h)}
return a},i.prototype.getRightData=function(n){var e={side:"right"},t=n.base_info.nickname;""==t&&(t="Vệ Sĩ Khoáng "),e.name=t,e.level=n.base_info.level,e.fightVal=n.base_info.fight,e.formation=n.formation.formationId,e.forward=n.formation.forward,e.flip=n.formation.flip;for(var a=u.create(e),i=n.formation,r=[i.a,i.b,i.c,i.d,i.e,i.f,i.g,i.h,i.i,i.j],s=function(e){for(var t=Object.keys(n.formation),a=0;a<t.length;++a){if("fid"!=t[a]&&"formationId"!=t[a]&&"forward"!=t[a]&&"flip"!=t[a])
if(e==n.formation[t[a]])
return t[a]}},o=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a]},c=DonotDestroyManager.GameData.Common,l=0;l<r.length;++l){var h=r[l];if(!c.FIGHT_CONTROL_ENEMY[3]&&0!=h){var d=o(n.cards,h);if(null!=d){var _={hero:{}};_.hero.id=d.template_id,_.hero.heroId=d.template_id,_.hero.level=d.level,_.hero.grade=d.grade,_.unit_level=d.unitLevel,_.unit_grade=d.unitGrade,_.unit_num=m.getHeroUnitNum(_.hero.grade,_.hero.id),a.addHeroWithPosition(_,s(_.hero.id))}}}
return a},e.exports=new i,cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleUtil:"BattleUtil",HeroBufferMgr:"HeroBufferMgr",HeroConfigMgr:"HeroConfigMgr",MyProtocols:"MyProtocols",PkBufferMgr:"PkBufferMgr",PlayerBufferMgr:"PlayerBufferMgr",TeamDataUtil:"TeamDataUtil"}],MineBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"fa5d5xdy7RLZKxyBhYrpbB/","MineBufferMgr");var n=e("EnermyBufferMgr"),i=function(){};i.prototype.initBuffer=function(e){this.mArenainfo=e,this.mEnemyList=e.enemys,this.mRankList=e.ranks,this.mExchangeList=e.items,this.setEmBattleLastPage(2),this.mOriRank=e.my_rank,e.prevStaminaTime},i.prototype.setRightHero=function(e){n.getInstance().initEnermyData(e),this.mEnemyInfo=e},i.prototype.getRightHero=function(){return this.mEnemyInfo},i.prototype.setK=function(e){this.kval=e},i.prototype.getK=function(){return this.kval},i.prototype.setWinLooseInfo=function(e){this.winLooseInfo=e},i.prototype.getWinLooseInfo=function(){return this.winLooseInfo},i.prototype.setRightIndex=function(e){this.mRightIndex=e},i.prototype.getRightIndex=function(){return this.mRightIndex},i.prototype.setEmBattleLastPage=function(e){this.lastPage=e},i.prototype.isInOtherDefenceFormation=function(e){return null!=this.exclude_cards&&-1<this.exclude_cards.indexOf(e)},i.prototype.setOtherDefenceFormation=function(e){this.exclude_cards=e},t.exports=new i,cc._RF.pop()},{EnermyBufferMgr:"EnermyBufferMgr"}],MineCoinOutput:[function(e,t,a){"use strict";cc._RF.push(t,"bc359hWht9IjLJ1yB6rC0n0","MineCoinOutput"),cc.Class({extends:cc.Component,properties:{lab_add_coin:cc.Label},start:function(){this.node.runAction(cc.sequence(cc.scaleTo(.15,1.2).easing(cc.easeOut(3)),cc.scaleTo(.08,1).easing(cc.easeIn(3)),cc.delayTime(.5),cc.spawn(cc.moveBy(1,cc.p(0,70)),cc.fadeTo(1,100)),cc.callFunc(function(e){e.destroy()})))},setData:function(e){this.lab_add_coin.string="+"+e}}),cc._RF.pop()},{}],MineConstants:[function(e,t,a){"use strict";cc._RF.push(t,"904e22JOr9LoYJslosyddqZ","MineConstants"),t.exports={PAGE_SIZE:4,POINTS_PER_PAGE:12,MAX_OWN_SIZE:2},cc._RF.pop()},{}],MineHistoryRecrod:[function(e,t,a){"use strict";cc._RF.push(t,"435betgXhlAlpJ6Hc44xsKw","MineHistoryRecrod");e("MineMainPanel");var n=e("SoundUtil"),o=e("MineConstants"),c=e("i18n"),l=e("GameUtils"),h=["Sơ", "Trung", "Cao"],d=["Tiểu", "Trung", "Đại"],_=["Ngụy","Thục","Ngô","Quần"];cc.Class({extends:cc.Component,properties:{node_item_container:cc.Node,pre_history_item:cc.Prefab},start:function(){if(null==this.panelType)
for(var e=0;e<this._netData.records.length;e++){var t=this._netData.records[e],a=cc.instantiate(this.pre_history_item);this.node_item_container.addChild(a),this.processNodeString(t,a)}
else if(2==this.panelType)
for(var n=0;n<this._netData.records.length;n++){var i=this._netData.records[n],r=cc.instantiate(this.pre_history_item);this.node_item_container.addChild(r),this.processGuozhanString(i,r)}},processGuozhanString:function(e,t){var a=l.formatDate2(e.add_time);switch(e.action_type){case 1:var n="guozhan009",i=e.params[0];0<i&&(n="guozhan010");var r=e.params[1],s=e.params[2],o=DonotDestroyManager.GameData.CityList[s].ChengName;t.getComponent(cc.RichText).string=c.t(n,{nationName:_[r-1],cityName:o,enemySize:i,enemyName:e.target_player_name,dateval:a});break;case 2:i=e.params[0],r=e.params[1],s=e.params[2],o=DonotDestroyManager.GameData.CityList[s].ChengName,t.getComponent(cc.RichText).string=c.t("guozhan011",{nationName:_[r-1],cityName:o,enemySize:i,enemyName:e.target_player_name,dateval:a});break;case 3:r=e.params[0],s=e.params[1],o=DonotDestroyManager.GameData.CityList[s].ChengName,t.getComponent(cc.RichText).string=c.t("guozhan012",{nationName:_[r-1],cityName:o,enemyName:e.target_player_name,dateval:a});break;case 4:r=e.params[0],s=e.params[1],o=DonotDestroyManager.GameData.CityList[s].ChengName,t.getComponent(cc.RichText).string=c.t("guozhan013",{nationName:_[r-1],cityName:o,enemyName:e.target_player_name,dateval:a});break;case 5:r=e.params[0],s=e.params[1],o=DonotDestroyManager.GameData.CityList[s].ChengName,t.getComponent(cc.RichText).string=c.t("guozhan014",{nationName:_[r-1],cityName:o,enemyName:e.target_player_name,dateval:a})}},processNodeString:function(e,t){var a=e.mine_point,n=parseInt(a/100),i=a%100%o.POINTS_PER_PAGE,r=0;0==i?r=2:i<4&&(r=1);var s=h[n]+" Khu Khoáng-"+d[r]+" Khoáng";2==e.type?t.getComponent(cc.RichText).string=c.t("mine006",{pointName:s,coinVal:e.gain[0],goldVal:e.gain[1]}):e.is_positive?0<e.target_player_id?t.getComponent(cc.RichText).string=c.t("mine009",{pointName:s,targetName:e.target_player_name,coinVal:e.gain[0],goldVal:e.gain[1]}):t.getComponent(cc.RichText).string=c.t("mine010",{pointName:s,targetName:e.target_player_name,coinVal:e.gain[0],goldVal:e.gain[1]}):e.is_success?t.getComponent(cc.RichText).string=c.t("mine007",{pointName:s,targetName:e.target_player_name}):t.getComponent(cc.RichText).string=c.t("mine008",{pointName:s,targetName:e.target_player_name,coinVal:e.gain[0],goldVal:e.gain[1]})},setParams:function(e){this.panelType=e.panelType,this.closeCb=e.closeCb,this._netData=e.netData},goBack:function(){n.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()}}),cc._RF.pop()},{GameUtils:"GameUtils",MineConstants:"MineConstants",MineMainPanel:"MineMainPanel",SoundUtil:"SoundUtil",i18n:"i18n"}],MineMainPanel:[function(e,t,a){"use strict";cc._RF.push(t,"c68fcn/yJNO+ogEggbXLr8A","MineMainPanel");var o=e("SoundUtil"),c=e("i18n"),l=e("MineConstants"),n=e("NetEvent"),i=e("MyEventDispatcher"),h=e("MyProtocols"),r=e("TimeUtil"),s=["Sơ ", "Trung ", "Cao "],d=cc.Class({extends:cc.Component,properties:{_closeCb:null,_netData:null,pre_mine_point:cc.Prefab,pre_mine_scene:cc.Prefab,lab_gain_gold:cc.Label,lab_gain_coins:cc.Label,lab_mine_title:cc.Label,node_arrow_left:cc.Node,node_arrow_right:cc.Node,node_red_mind:cc.Node,m_pRewardPanel:cc.Prefab,list_level_btn:[cc.Sprite],list_level_label:[cc.Label],list_cd_tips:[cc.Node],res_level_btn:[cc.SpriteFrame],_node_mine_scene:cc.Node,_node_mine_scene_copy:cc.Node,_mine_point_pool:cc.NodePool,_item_box_pool:cc.NodePool,_mine_scene_width:0,_mine_scene_height:0,_dt_sum:0},statics:{instance:null},onLoad:function(){(d.instance=this)._mine_point_pool=new cc.NodePool("MinePoint"),this._item_box_pool=new cc.NodePool("ItemBox"),this.S2CMineList_cb_func=this.S2CMineList_cb.bind(this),i.addListener(n.S2CMineList,this.S2CMineList_cb_func),this.S2CMineEnemyDetail_cb_func=this.S2CMineEnemyDetail_cb.bind(this),i.addListener(n.S2CMineEnemyDetail,this.S2CMineEnemyDetail_cb_func),this.S2CMineGetAward_cb_func=this.S2CMineGetAward_cb.bind(this),i.addListener(n.S2CMineGetAward,this.S2CMineGetAward_cb_func),this.S2CMineHistory_cb_func=this.S2CMineHistory_cb.bind(this),i.addListener(n.S2CMineHistory,this.S2CMineHistory_cb_func)},onDestroy:function(){d.instance=null,this._mine_point_pool.clear(),this._item_box_pool.clear(),i.removeListener(n.S2CMineList,this.S2CMineList_cb_func),i.removeListener(n.S2CMineEnemyDetail,this.S2CMineEnemyDetail_cb_func),i.removeListener(n.S2CMineGetAward,this.S2CMineGetAward_cb_func),i.removeListener(n.S2CMineHistory,this.S2CMineHistory_cb_func)},S2CMineHistory_cb:function(e){MyUiManager.Open(MyUiManager.PanelInfo.MineHistoryRecrod,{netData:e,closeCb:this.sendCurrentPageList.bind(this)})},S2CMineGetAward_cb:function(e){if(null!=e.gain&&0<e.gain.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.gain,t.getComponent("GetRewardPanel")._closeCb=this.awardCloseCb.bind(this)}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,220),"Nhận thành công",1e3)},awardCloseCb:function(){this.sendCurrentPageList()},sendCurrentPageList:function(){h.send_C2SMineList(DonotDestroyManager._gameSocket,this._netData.level_index,this._netData.page_index)},S2CMineEnemyDetail_cb:function(e){MyUiManager.Open(MyUiManager.PanelInfo.MinePointDetail,{netData:e})},S2CMineList_cb:function(e){var t=this._netData.level_index,a=this._netData.page_index;this._netData=e;var n=this._netData.page_index,i=this._netData.level_index;if(t!=i){var r=t<i?1:-1;0==this._mine_scene_height&&(this._mine_scene_height=cc.Canvas.instance.designResolution.height),this._node_mine_scene_copy=cc.instantiate(this.pre_mine_scene),this._node_mine_scene_copy.setPosition(0,this._mine_scene_height* -r),this._node_mine_scene_copy.width=cc.Canvas.instance.designResolution.width,this._node_mine_scene_copy.height=cc.Canvas.instance.designResolution.height,this._node_mine_scene_copy.name="MineScene-copy",this.node.addChild(this._node_mine_scene_copy,-1),this._node_mine_scene_copy.getComponent("MineScene").changeData(this._netData.level_index,this._netData.page_index,this._netData.mine_points),this._node_mine_scene.runAction(cc.moveTo(.3,cc.v2(0,this._mine_scene_height*r))),this._node_mine_scene_copy.runAction(cc.sequence(cc.moveTo(.3,cc.v2(0,0)),cc.callFunc(function(e){this._node_mine_scene.getComponent("MineScene").reuseMinePointEntity(),this._node_mine_scene.destroy(),this._node_mine_scene=this._node_mine_scene_copy,this._node_mine_scene_copy=null},this))),this.refreshUiScroll()}else if(a!=n){var s=a<n?-1:1;0==this._mine_scene_width&&(this._mine_scene_width=cc.Canvas.instance.designResolution.width),this._node_mine_scene_copy=cc.instantiate(this.pre_mine_scene),this._node_mine_scene_copy.setPosition(this._mine_scene_width* -s,0),this._node_mine_scene_copy.width=cc.Canvas.instance.designResolution.width,this._node_mine_scene_copy.height=cc.Canvas.instance.designResolution.height,this._node_mine_scene_copy.name="MineScene-copy",this.node.addChild(this._node_mine_scene_copy,-1),this._node_mine_scene_copy.getComponent("MineScene").changeData(this._netData.level_index,this._netData.page_index,this._netData.mine_points),this._node_mine_scene.runAction(cc.moveTo(.3,cc.v2(this._mine_scene_width*s,0))),this._node_mine_scene_copy.runAction(cc.sequence(cc.moveTo(.3,cc.v2(0,0)),cc.callFunc(function(e){this._node_mine_scene.getComponent("MineScene").reuseMinePointEntity(),this._node_mine_scene.destroy(),this._node_mine_scene=this._node_mine_scene_copy,this._node_mine_scene_copy=null},this))),this.refreshUiScroll()}else
null!=this._node_mine_scene&&this._node_mine_scene.getComponent("MineScene").reuseMinePointEntity(),this.refreshUi();MyUiManager.updateUiParams(70,{netData:e,closeCb:this.closeCb})},setParams:function(e){this.closeCb=e.closeCb,this._netData=e.netData},goBack:function(){o.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},start:function(){for(var e=DonotDestroyManager.GameData.Common.mine_levels,t=0;t<e.length-1;t++)
this.list_level_label[t].string=e[t]+"-"+e[t+1]+" cấp";this.refreshUi(),this._node_mine_scene.width=this.node.width,this._node_mine_scene.height=this.node.height},refreshUi:function(){this.refreshMinePoints(),this.lab_gain_gold.string="+"+this._netData.my_income[1],this.lab_gain_coins.string="+"+this._netData.my_income[0],null!=this._netData.my_income[1]&&0<this._netData.my_income[1]||null!=this._netData.my_income[0]&&0<this._netData.my_income[0]?this.node_red_mind.active=!0:this.node_red_mind.active=!1;for(var e=this._netData.my_hold.length,t=0;t<e;t++){this.list_cd_tips[t].getChildByName("jiantou").active=!0;var a=this._netData.my_cd_time[t],n=r.secondToTime(a);this.list_cd_tips[t].getChildByName("cdLabel").getComponent(cc.Label).string=n}
for(var i=e;i<2;i++)
this.list_cd_tips[i].getChildByName("jiantou").active=!1,this.list_cd_tips[i].getChildByName("cdLabel").getComponent(cc.Label).string="Trống";this.refreshUiScroll()},refreshUiScroll:function(){var e=this._netData.level_index;this.lab_mine_title.string=c.t("mine001",{mineLevel:s[e],pageIdx:this._netData.page_index+1,pageSum:l.PAGE_SIZE});for(var t=0;t<this.list_level_btn.length;t++)
this.list_level_btn[t].spriteFrame=t==e?this.res_level_btn[1]:this.res_level_btn[0];this.node_arrow_left.active=!0,this.node_arrow_right.active=!0,0==this._netData.page_index?this.node_arrow_left.active=!1:this._netData.page_index==l.PAGE_SIZE-1&&(this.node_arrow_right.active=!1)},refreshMinePoints:function(){null==this._node_mine_scene&&(this._node_mine_scene=cc.instantiate(this.pre_mine_scene),this.node.addChild(this._node_mine_scene,-1)),this._node_mine_scene.getComponent("MineScene").changeData(this._netData.level_index,this._netData.page_index,this._netData.mine_points)},clickHandlerLevel:function(e,t){o.playBtnOpenEffect();var a=parseInt(t);this._netData.level_index!=a&&h.send_C2SMineList(DonotDestroyManager._gameSocket,a,0)},clickHandlerPageScroll:function(e,t){o.playBtnOpenEffect();var a=parseInt(t);h.send_C2SMineList(DonotDestroyManager._gameSocket,this._netData.level_index,this._netData.page_index+a)},clickHandlerJump2MyMinePoint:function(e,t){o.playBtnOpenEffect();var a=parseInt(t);if(a>=this._netData.my_hold.length)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,220),c.t("mine002"),1e3);else{var n=this._netData.my_hold[a],i=parseInt(n/100),r=n%100,s=parseInt(r/l.POINTS_PER_PAGE);i==this._netData.level_index&&s==this._netData.page_index?h.send_C2SMineEnemyDetail(DonotDestroyManager._gameSocket,i,r):(h.send_C2SMineList(DonotDestroyManager._gameSocket,i,s),this.node.runAction(cc.sequence(cc.delayTime(.4),cc.callFunc(function(){h.send_C2SMineEnemyDetail(DonotDestroyManager._gameSocket,i,r)}))))}},clickHalderGetAward:function(e,t){o.playBtnOpenEffect(),0==this._netData.my_income.length||0==this._netData.my_income[0]&&0==this._netData.my_income[1]?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,220),c.t("mine005"),1e3):h.send_C2SMineGetAward(DonotDestroyManager._gameSocket)},clickHanlderHistoryRecord:function(){o.playBtnOpenEffect(),h.send_C2SMineHistory(DonotDestroyManager._gameSocket)},update:function(e){if(this._dt_sum+=e,1<=this._dt_sum){for(var t=this._netData.my_hold.length,a=0;a<t;a++){this._netData.my_cd_time[a]--;var n=this._netData.my_cd_time[a];if(n<=0)
this.list_cd_tips[a].getChildByName("cdLabel").getComponent(cc.Label).string="Trống";else{var i=r.secondToTime(n);this.list_cd_tips[a].getChildByName("cdLabel").getComponent(cc.Label).string=i}}
this._dt_sum=0}}});cc._RF.pop()},{MineConstants:"MineConstants",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",TimeUtil:"TimeUtil",i18n:"i18n"}],MinePointDetail:[function(e,t,a){"use strict";cc._RF.push(t,"b9caeFlLOFCG5ug0J+PREdo","MinePointDetail");var i=e("SoundUtil"),p=e("MineConstants"),f=e("MineMainPanel"),g=e("NPCFightCfgMgr"),r=e("MineBufferMgr"),n=e("MyProtocols"),y=e("HeroConfigMgr"),v=e("TimeUtil"),s=e("i18n"),o=e("BattleBufferMgr"),c=e("MyUIEvent"),l=e("MyEventDispatcher"),M=["Tiểu ", "Trung ", "Đại "];cc.Class({extends:cc.Component,properties:{lab_mine_point_title:cc.Label,lab_gold_output:cc.Label,lab_coins_output:cc.Label,lab_enemy_name:cc.Label,lab_enemy_level:cc.Label,lab_enemy_fight:cc.Label,lab_cd_time:cc.Label,spr_head_icon:cc.Sprite,spr_head_frame:cc.Sprite,node_hero_container:cc.Node,lab_fight_btn:cc.Label,node_cost_stamina:cc.Node,node_cost_stamina_txt:cc.Node,m_pIconSpriteFrames:[cc.SpriteFrame],pre_item_box:cc.Prefab,_netData:null,_targetFight:0,_dt_sum:0},reuseItembox:function(){for(var e=this.node_hero_container.children,t=e.length-1;0<=t;t--)
f.instance._item_box_pool.put(e[t])},onLoad:function(){null==MyPersistDataManager._playerData.pvpformation&&n.send_C2SArenaFormation(DonotDestroyManager._gameSocket),this.onMinePointDetailChange_cb_func=this.onMinePointDetailChange_cb.bind(this),l.addListener(c.onMinePointDetailChange,this.onMinePointDetailChange_cb_func)},onDestroy:function(){l.removeListener(c.onMinePointDetailChange,this.onMinePointDetailChange_cb_func)},onMinePointDetailChange_cb:function(e){this._netData=e,this.reuseItembox(),this.refreshUi()},start:function(){this.refreshUi()},refreshUi:function(){var e=DonotDestroyManager.GameData.Common.mine_hour_coins[this._netData.level_index],t=this._netData.point_index%p.POINTS_PER_PAGE,a=0;0==t?a=2:t<4&&(a=1),this.lab_coins_output.string="+"+10*e[a];var n=DonotDestroyManager.GameData.Common.mine_hour_gold[this._netData.level_index];if(this.lab_gold_output.string="+"+parseInt(10*n[a]),this.lab_mine_point_title.string=M[a]+"Khoáng ",0==this._netData.base_info.id?this.lab_enemy_name.string="Chiếm bởi: Vệ Sĩ Khoáng":this.lab_enemy_name.string="Chiếm bởi: "+this._netData.base_info.nickname,this.lab_enemy_level.string=this._netData.base_info.level,0==this._netData.base_info.id)
this._targetFight=g.getRobotFightVal(this._netData.cards),this.lab_enemy_fight.string=this._targetFight;else{for(var i=0,r=0;r<this._netData.cards.length;r++)
i+=this._netData.cards[r].fight;this._targetFight=i,this.lab_enemy_fight.string=i}
if(0<this._netData.base_info.id&&0<this._netData.base_info.cd_time){var s=v.secondToTime(this._netData.base_info.cd_time);this.lab_cd_time.string=s}else
this.lab_cd_time.string="Trống";this._netData.base_info.id==MyPersistDataManager._playerData.id&&0<this._netData.base_info.cd_time?(this.lab_fight_btn.string="Thay đổi đội hình phòng thủ",this.node_cost_stamina.active=!1,this.node_cost_stamina_txt.active=!1):(this.lab_fight_btn.string="Cướp",this.node_cost_stamina.active=!0,this.node_cost_stamina_txt.active=!0);for(var o=0;o<this._netData.cards.length;o++){var c=this._netData.cards[o],l=f.instance._item_box_pool.get();null==l&&(l=cc.instantiate(this.pre_item_box)),this.node_hero_container.addChild(l),l.getComponent("HeroBox").ChangeHeroInfo(c.template_id,c.level,c.grade)}
if(this._netData.base_info.icon<10)
this.spr_head_icon.spriteFrame=this.m_pIconSpriteFrames[this._netData.base_info.icon-1];else{var h=this._netData.base_info.icon-10,d=y.find(h);if(null!=d){var _=d.icon,u=this;cc.loader.loadRes("UI/Heros/"+_,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=u&&cc.isValid(u.node)&&(u.spr_head_icon.spriteFrame=t,u.spr_head_icon.node.width=87,u.spr_head_icon.node.height=87)})}}
var m=DonotDestroyManager.GameData.HeadFrame[this._netData.base_info.head_frame_id-1];u=this;cc.loader.loadRes("UI/HeadFrame/"+m.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=u&&cc.isValid(u.node)&&(u.spr_head_frame.spriteFrame=t)})},setParams:function(e){this._netData=e.netData},changeData:function(e){},goBack:function(){this.reuseItembox(),i.playBtnCloseEffect(),f.instance.sendCurrentPageList(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},clickHanlderFight:function(e,t){if(i.playBtnOpenEffect(),this._netData.base_info.id!=MyPersistDataManager._playerData.id){var a=DonotDestroyManager.GameData.Common.mine_energy_cost[0];if(MyPersistDataManager._playerData.energy<a)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,180),s.t("mine003"),1e3);if(f.instance._netData.my_hold.length>=p.MAX_OWN_SIZE)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,180),s.t("mine004",{val:p.MAX_OWN_SIZE}),1e3);r.setRightHero(this._netData),this.OpenFormationLayer(this._netData)}else{o.setFormationData(100,this._netData.formation),r.setOtherDefenceFormation(this._netData.exclude_cards);var n={fid:100,level_index:this._netData.level_index,point_index:this._netData.point_index};MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:{name:"Thay đổi đội hình phòng thủ",fight:0,formation:1,flip:0,forward:0,Teams:[],id:0},panelinfo:n,battletype:10})}},OpenFormationLayer:function(e){var t=e.base_info.nickname;""==t&&(t="Vệ Sĩ Khoáng ");var a={name:t+"LV."+e.base_info.level,fight:this._targetFight,formation:e.formation.formationId,flip:e.formation.flip,forward:e.formation.forward,Teams:this.GetEnemyTeams(e),id:0};MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:a,panelinfo:{fid:2},battletype:9})},GetEnemyTeams:function(e){var t=[],a=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a].level;return 0};if(0<e.formation.a){var n=a(e.cards,e.formation.a);t.push({id:e.formation.a,level:n,position:"a"})}
if(0<e.formation.b){n=a(e.cards,e.formation.b);t.push({id:e.formation.b,level:n,position:"b"})}
if(0<e.formation.c){n=a(e.cards,e.formation.c);t.push({id:e.formation.c,level:n,position:"c"})}
if(0<e.formation.d){n=a(e.cards,e.formation.d);t.push({id:e.formation.d,level:n,position:"d"})}
if(0<e.formation.e){n=a(e.cards,e.formation.e);t.push({id:e.formation.e,level:n,position:"e"})}
if(0<e.formation.f){n=a(e.cards,e.formation.f);t.push({id:e.formation.f,level:n,position:"f"})}
if(0<e.formation.g){n=a(e.cards,e.formation.g);t.push({id:e.formation.g,level:n,position:"g"})}
if(0<e.formation.h){n=a(e.cards,e.formation.h);t.push({id:e.formation.h,level:n,position:"h"})}
if(0<e.formation.i){n=a(e.cards,e.formation.i);t.push({id:e.formation.i,level:n,position:"i"})}
if(0<e.formation.j){n=a(e.cards,e.formation.j);t.push({id:e.formation.j,level:n,position:"j"})}
return t},update:function(e){if(this._dt_sum+=e,1<=this._dt_sum){if(0<this._netData.base_info.id&&0<this._netData.base_info.cd_time){this._netData.base_info.cd_time--;var t=v.secondToTime(this._netData.base_info.cd_time);this.lab_cd_time.string=t}else
this.lab_cd_time.string="Trống";this._dt_sum=0}}}),cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",HeroConfigMgr:"HeroConfigMgr",MineBufferMgr:"MineBufferMgr",MineConstants:"MineConstants",MineMainPanel:"MineMainPanel",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NPCFightCfgMgr:"NPCFightCfgMgr",SoundUtil:"SoundUtil",TimeUtil:"TimeUtil",i18n:"i18n"}],MinePoint:[function(e,t,a){"use strict";cc._RF.push(t,"9a55dX1K4JMxa9+hVdZj4Bb","MinePoint");var n=e("SoundUtil"),i=e("MyProtocols"),r=e("MineConstants"),o=e("HeroConfigMgr");cc.Class({extends:cc.Component,properties:{node_occupy:cc.Node,spr_mine_title:cc.Sprite,spr_mine:cc.Sprite,spr_head_frame:cc.Sprite,spr_head_icon:cc.Sprite,lab_level:cc.Label,res_mine_point:[cc.SpriteFrame],res_mine_title:[cc.SpriteFrame],m_pIconSpriteFrames:[cc.SpriteFrame],pre_coin_output:cc.Prefab,_level_index:0,_page_index:0,_point_per_page_index:0,_holder_entity:null,_dt_sum:0},changeData:function(e,t,a,n){this._level_index=e,this._page_index=t,this._point_per_page_index=a,null==n.hold_player?this.setMineEmpty(a):this.setMineHold(a,n.hold_player),this._holder_entity=n.hold_player},setMineEmpty:function(e){this.node_occupy.active=!1,this.spr_mine_title.node.active=!0,this.spr_mine_title.spriteFrame=0==e?this.res_mine_title[2]:e<4?this.res_mine_title[1]:this.res_mine_title[0],this.spr_mine.spriteFrame=this.res_mine_point[0]},setMineHold:function(e,t){if(this.node_occupy.active=!0,this.spr_mine_title.node.active=!1,this.spr_mine.spriteFrame=0==e?this.res_mine_point[3]:e<4?this.res_mine_point[2]:this.res_mine_point[1],this.lab_level.string=t.level,t.icon<10)
this.spr_head_icon.spriteFrame=this.m_pIconSpriteFrames[t.icon-1];else{var a=t.icon-10,n=o.find(a);if(null!=n){var i=n.icon,r=this;cc.loader.loadRes("UI/Heros/"+i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r&&cc.isValid(r.node)&&(r.spr_head_icon.spriteFrame=t,r.spr_head_icon.node.width=87,r.spr_head_icon.node.height=87)})}}
var s=DonotDestroyManager.GameData.HeadFrame[t.head_frame_id-1];r=this;cc.loader.loadRes("UI/HeadFrame/"+s.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r&&cc.isValid(r.node)&&(r.spr_head_frame.spriteFrame=t)}),this._dt_sum=1.6},start:function(){},clickHanlderShowDetail:function(e,t){n.playBtnOpenEffect(),i.send_C2SMineEnemyDetail(DonotDestroyManager._gameSocket,this._level_index,this._page_index*r.POINTS_PER_PAGE+this._point_per_page_index)},showCoinOutput:function(){var e=cc.instantiate(this.pre_coin_output),t=this.node.convertToWorldSpaceAR(cc.v2(0,0)),a=this.node.parent.parent.convertToNodeSpaceAR(t);e.setPosition(a),this.node.parent.parent.addChild(e);var n=DonotDestroyManager.GameData.Common.mine_hour_coins[this._level_index],i=0;0==this._point_per_page_index?i=2:this._point_per_page_index<4&&(i=1);var r=parseInt(n[i]/1800);e.getComponent("MineCoinOutput").setData(r)},update:function(e){null!=this._holder_entity&&this._holder_entity.id==MyPersistDataManager._playerData.id&&(this._dt_sum+=e,2<=this._dt_sum&&(this.showCoinOutput(),this._dt_sum=0))}}),cc._RF.pop()},{HeroConfigMgr:"HeroConfigMgr",MineConstants:"MineConstants",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil"}],MineScene:[function(e,t,a){"use strict";cc._RF.push(t,"fc892DsmDhICIIXFDtbYCwu","MineScene");var s=e("MineMainPanel"),o=[cc.v2(-41,48),cc.v2(-180,-18),cc.v2(-27,-117),cc.v2(132,-39),cc.v2(-178,136),cc.v2(-331,65),cc.v2(-317,-88),cc.v2(-162,-184),cc.v2(146,-206),cc.v2(302,-129),cc.v2(279,34),cc.v2(119,121)];cc.Class({extends:cc.Component,properties:{node_mine_point_lists:cc.Node,pre_mine_point:cc.Prefab},start:function(){},reuseMinePointEntity:function(){for(var e=this.node_mine_point_lists.children,t=e.length-1;0<=t;t--)
s.instance._mine_point_pool.put(e[t])},changeData:function(e,t,a){for(var n=0;n<a.length;n++){var i=a[n],r=s.instance._mine_point_pool.get();null==r&&(r=cc.instantiate(this.pre_mine_point)),r.setPosition(cc.v2(o[n])),this.node_mine_point_lists.addChild(r),r.getComponent("MinePoint").changeData(e,t,n,i)}}}),cc._RF.pop()},{MineMainPanel:"MineMainPanel"}],MineWinPanel:[function(e,t,a){"use strict";cc._RF.push(t,"95987KSTBdBR4HZW4TG+8vK","MineWinPanel");e("GameUtils");var n=e("SoundUtil"),i=(e("GuideBufferMgr"),e("MarqueeBufferMgr")),r=e("MineConstants"),s=["Sơ ", "Trung ", "Cao "],o=["Tiểu ", "Trung ", "Đại "];cc.Class({extends:cc.Component,properties:{m_pwinpre:cc.Prefab,node_uiAll:cc.Node,_recvdata:null,m_pRewardContent:cc.Node,m_pItemBoxPrefab:cc.Prefab,lab_enemy_name:cc.Label,lab_mine_point_name:cc.Label,_iscanclick:!1},onLoad:function(){},ChangeData:function(e){this._recvdata=e.info,this.Init(),this.lab_enemy_name.string=e.enemy_name;var t=this._recvdata.point_index%r.POINTS_PER_PAGE,a=0;0==t?a=2:t<4&&(a=1),this.lab_mine_point_name.string=s[this._recvdata.level_index]+" Khu Khoáng-"+o[a]+"Khoáng "},Init:function(){this.InitData(),this.CreateWinarmature()},InitData:function(){this._iscanclick=!1,this.node_uiAll.active=!1;for(var e=0;e<this._recvdata.gain.length;++e){var t=cc.instantiate(this.m_pItemBoxPrefab);t.getComponent("ItemBox").ChangeItemInfo(this._recvdata.gain[e].itemId,this._recvdata.gain[e].cnt,!0,null,!0),this.m_pRewardContent.addChild(t)}},CreateWinarmature:function(){var t=this,e=cc.instantiate(this.m_pwinpre);this.node.addChild(e),e.setPosition(0,-50);var a=e.getComponent(sp.Skeleton);a.setAnimation(0,"action3",!1),a.setCompleteListener(function(e){t.showResultUi()})},showResultUi:function(){cc.log(" truyền phát tin thưởng cho động họa "),this._iscanclick=!0,this.node_uiAll.active=!0},Mask_OnClickHandler:function(e){this._iscanclick&&(n.playBtnCloseEffect(),MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),i.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome")},setStatistics:function(e,t,a){this.statistics={left:e,right:t,data:a};var n={damage:-1};a.teams.forEach(function(e,t){e.damage>n.damage&&"left"==e.data.hero.side&&(n=e)})},BattleDetail_onClickHandler:function(){var n=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/BattleDetailLayer/BattleDetailLayer",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.node)){null!=n._shortMask_node&&(n._shortMask_node.destroy(),n._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("BattleDetailLayer").ChangeData(n.statistics.data)}})}}),cc._RF.pop()},{GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",MarqueeBufferMgr:"MarqueeBufferMgr",MineConstants:"MineConstants",SoundUtil:"SoundUtil"}],MissionDifficult:[function(e,t,a){"use strict";cc._RF.push(t,"56410n2Oh9P7rDcnQ9b6TW+","MissionDifficult");var i=e("SoundUtil"),l=e("SelectMissionLayer"),o=e("MyProtocols");cc.Class({extends:cc.Component,properties:{m_pItemSprite:cc.Sprite,m_pItemBtn:cc.Button,m_pDisFrame:[cc.SpriteFrame],m_pNormalFrame:[cc.SpriteFrame],m_pSelectFrame:[cc.SpriteFrame],m_pStarSprite:[cc.Sprite],m_pStarFrame:[cc.SpriteFrame],m_pDifficultSprite:cc.Sprite,m_pDifficultFrame:[cc.SpriteFrame],m_pDifficultUnlockLevel:cc.Label,m_pStarNode:cc.Node,m_pUnlockIcon:cc.Sprite,m_pUnlockEffect:cc.Node,m_pBoxActionNode:cc.Node,m_pBoxActionBtn:cc.Button,m_pRewardPanel:cc.Prefab,_diffState:-1,_isSelect:!1,_unlock:!1,_actionstate:""},onLoad:function(){},ChangeData:function(e,t,a){this._unlock=e;var n=l.getInstance(),i=DonotDestroyManager.GameData.Activities.battles[n._battleState][n._stateIndex].diffs[this._diffState];if(-1!=this._diffState){var r=this.m_pItemBtn.clickEvents[0];r.customEventData=this._diffState;n=l.getInstance();if(MyPersistDataManager._playerData.level<(i=DonotDestroyManager.GameData.Activities.battles[n._battleState][n._stateIndex].diffs[this._diffState]).level_limit?this._unlock=!1:this._unlock=!0,this._unlock){if(r.handler="Selected_onClickHandler",this.m_pStarNode.active=!0,this.m_pUnlockIcon.node.active=!1,this.m_pItemSprite.spriteFrame=this.m_pNormalFrame[this._diffState],this.m_pDifficultSprite.spriteFrame=this.m_pDifficultFrame[this._diffState],this.m_pDifficultSprite.node.active=!0,this.m_pDifficultUnlockLevel.node.active=!1,0!=t)
for(var s=0;s<t;++s)
this.m_pStarSprite[s].spriteFrame=this.m_pStarFrame[1]}else
r.handler="CreatTips",this.m_pStarNode.active=!1,this.m_pUnlockIcon.node.active=!0,this.m_pItemSprite.spriteFrame=this.m_pDisFrame[this._diffState],this.m_pDifficultSprite.node.active=!1,this.m_pDifficultUnlockLevel.node.active=!0,this.m_pDifficultUnlockLevel.string=i.level_limit+" cấp mở khóa";if(a){this.m_pBoxActionBtn.node.active=!0;var o=this.m_pBoxActionNode.getComponent(sp.Skeleton);switch(this._diffState){case 0:this._actionstate="mu";break;case 1:this._actionstate="green";break;case 2:this._actionstate="blue";break;case 3:this._actionstate="purple";break;case 4:this._actionstate="gold"}
var c="Action1_"+this._actionstate;o.setAnimation(0,c,!0)}}},GetBoxReward_onClickHandler:function(e,t){i.playTreasureBoxEffect();var r=l.getInstance(),s=this;this.m_pBoxActionBtn.enabled=!1;var a=this.m_pBoxActionNode.getComponent(sp.Skeleton),n="Action2_"+this._actionstate;this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){a.setAnimation(0,n,!1),a.setCompleteListener(function(e){o.send_C2SActivitiesClaimAward(DonotDestroyManager._gameSocket,r._battleState+1,r._stateIndex+1,s._diffState);for(var t=[],a=DonotDestroyManager.GameData.Activities.battles[r._battleState][r._stateIndex].diffs[s._diffState].rewards.three_stars,n=0;n<a.length;++n)
t.push({itemId:a[n][0],cnt:a[n][1]});var i=cc.instantiate(s.m_pRewardPanel);cc.Canvas.instance.node.addChild(i),i.getComponent("GetRewardPanel")._itemlist=t,s.m_pBoxActionBtn.node.active=!1})})))},Selected_onClickHandler:function(e,t){l.getInstance().ClearDiffs(),l.getInstance().ChangeRewardInfo(this._diffState),l.getInstance().updateSweepBtn(),this.m_pItemSprite.spriteFrame=this.m_pSelectFrame[this._diffState]},CreatTips:function(e,t){var a=l.getInstance(),n=MyPersistDataManager._playerData.level,i=DonotDestroyManager.GameData.Activities.battles[a._battleState][a._stateIndex].diffs[this._diffState];n<i.level_limit?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Lv "+i.level_limit+" mở khóa ải này"):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin vượt ải trước đó")},PlayUnlockEffect:function(){i.playUnlockLevelEffect();var e=this;this.m_pUnlockIcon.node.active=!1,this.m_pUnlockEffect.active=!0;var t=this.m_pUnlockEffect.getComponent(dragonBones.ArmatureDisplay),a=t.armature();a.animation.fadeIn("action2",-1,1,0,"normal"),this.node.runAction(cc.sequence(cc.delayTime(.7),cc.callFunc(function(){i.playUnlockLevelEffect(),a.animation.fadeIn("action1",-1,1,0,"normal"),StageBufferMgr.setStageIdUnLock(0),t.addEventListener(dragonBones.EventObject.COMPLETE,function(){e.m_pUnlockEffect.active=!1},e)})))}}),cc._RF.pop()},{MyProtocols:"MyProtocols",SelectMissionLayer:"SelectMissionLayer",SoundUtil:"SoundUtil"}],MissionItemAward1:[function(e,t,a){"use strict";cc._RF.push(t,"3e1deV93rRFuIxrTDc3YJv+","MissionItemAward1"),cc.Class({extends:cc.Component,properties:{itemImage:cc.Sprite,itemImageFrame:[cc.SpriteFrame],itemMoneyNum:cc.Label,_isGameMoney:!1},onLoad:function(){},ChangeData:function(e){this._isGameMoney?this.itemImage.spriteFrame=this.itemImageFrame[0]:this.itemImage.spriteFrame=this.itemImageFrame[1],this.itemMoneyNum.string="x"+e}}),cc._RF.pop()},{}],MissionItem:[function(e,t,a){"use strict";cc._RF.push(t,"104eawGcgNAWY11eYnF8XbC","MissionItem");var r=e("ColorUtil"),n=e("MyProtocols"),i=(e("NetEvent"),e("MyEventDispatcher"),e("i18n")),s=e("MissionLayer"),o=e("GameUtils");cc.Class({extends:cc.Component,properties:{missionName:cc.Label,missionDes:cc.Label,missionImage:cc.Sprite,imageSpriteAtlas:cc.SpriteAtlas,missionPro:cc.Label,missionRewardPrefabs:[cc.Prefab],rewardContent:cc.Node,missionItemBg:[cc.SpriteFrame],ItemBgSprite:cc.Sprite,awardBtn:cc.Button,_missionId:0,_missionPro:null,_itemId:0,_itemcfg:null,_itemID:0},onLoad:function(){},onDestroy:function(){},updateItem:function(e){this._itemID=e,this.Init()},Init:function(){var e=s.getInstance()._showList;e.length>this._itemID?(this.node.active=!0,this._missionId=e[this._itemID].missionId,this._missionPro=e[this._itemID].progress,this.ReadInfo()):this.node.active=!1},ReadInfo:function(){var e=DonotDestroyManager.GameData.Missions[this._missionId];this.missionName.string=e.name,this.missionDes.string=e.des;var t="Mission-"+e.icon.replace(/.png/,"");this.missionImage.spriteFrame=this.imageSpriteAtlas.getSpriteFrame(t),1300==e.root_id?this._missionPro<=e.mission_require[2]?(this.missionPro.node.active=!1,this.awardBtn.node.active=!0,this.ItemBgSprite.spriteFrame=this.missionItemBg[1]):(this.missionPro.node.active=!0,this.awardBtn.node.active=!1,this.ItemBgSprite.spriteFrame=this.missionItemBg[0],this.missionPro.string=i.t("mission_003",{value1:this._missionPro})):this._missionPro>=e.mission_require[2]?(this.missionPro.node.active=!1,this.awardBtn.node.active=!0,this.ItemBgSprite.spriteFrame=this.missionItemBg[1]):(this.missionPro.node.active=!0,this.awardBtn.node.active=!1,this.ItemBgSprite.spriteFrame=this.missionItemBg[0],this.missionPro.string=i.t("mission_002",{value1:this._missionPro,value2:e.mission_require[2]})),this.GetRewardInfo(e)},GetRewardInfo:function(e){if(0<this.rewardContent.children.length&&o.destroyAllChildren(this.rewardContent),0<e.rewards.gamemoney){var t=cc.instantiate(this.missionRewardPrefabs[0]),a=t.getComponent("MissionItemAward1");a._isGameMoney=!0,a.ChangeData(e.rewards.gamemoney),this.rewardContent.addChild(t)}
if(0<e.rewards.money&&((a=(t=cc.instantiate(this.missionRewardPrefabs[0])).getComponent("MissionItemAward1"))._isGameMoney=!1,a.ChangeData(e.rewards.money),this.rewardContent.addChild(t)),0<e.rewards.items.length)
for(var n=0;n<e.rewards.items.length;++n){var i=(t=cc.instantiate(this.missionRewardPrefabs[1])).getComponent(cc.Label);this._itemId=e.rewards.items[n][0],this.GetItemCfg(),i.node.color=r.getColorByQuality(this._itemcfg[this._itemId].quality),i.string=this._itemcfg[this._itemId].name+"x"+e.rewards.items[n][1],this.rewardContent.addChild(t)}},GetItemCfg:function(){null!=DonotDestroyManager.GameData.Consumes[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Consumes:null!=DonotDestroyManager.GameData.Boxes[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Boxes:null!=DonotDestroyManager.GameData.Items[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Items:null!=DonotDestroyManager.GameData.Equips[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Equips:null!=DonotDestroyManager.GameData.EquipFrags[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.EquipFrags:null!=DonotDestroyManager.GameData.Treasures[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.Treasures:null!=DonotDestroyManager.GameData.CardFrags[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.CardFrags:null!=DonotDestroyManager.GameData.UnitsEquips[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.UnitsEquips:null!=DonotDestroyManager.GameData.TreasureFrags[this._itemId]?this._itemcfg=DonotDestroyManager.GameData.TreasureFrags:null!=DonotDestroyManager.GameData.Cards[this._itemId]&&(this._itemcfg=DonotDestroyManager.GameData.Cards)},AwardBtn_onClickHandler:function(){n.send_C2SMissionGetAward(DonotDestroyManager._gameSocket,this._missionId)}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GameUtils:"GameUtils",MissionLayer:"MissionLayer",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",i18n:"i18n"}],MissionLayer:[function(e,t,a){"use strict";cc._RF.push(t,"dbb9eESVwlJjJglKjRTQNnN","MissionLayer");var n=e("SoundUtil"),i=e("MyProtocols"),r=e("NetEvent"),s=e("MyEventDispatcher"),o=(e("GameUtils"),e("GuideBufferMgr")),c=e("PlayerBufferMgr"),l=cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pMissionItemPrefab:cc.Prefab,m_pItemContent:cc.Node,m_pRewardPanel:cc.Prefab,FunctionBtnBar:cc.Prefab,btnClose:cc.Node,_showList:[],mScrollView:cc.ScrollView,itemTemplate:cc.Prefab,itemTemplateHeight:110,spawnCount:12,spacing:0,bufferZone:600},statics:{instance:null,getInstance:function(){return l.instance}},onLoad:function(){(l.instance=this).MissionList_auth_cb_func=this.MissionList_auth_cb.bind(this),s.addListener(r.S2CMissionList,this.MissionList_auth_cb_func),this.S2CMissionGetAwardAll_cb_func=this.S2CMissionGetAwardAll_cb.bind(this),s.addListener(r.S2CMissionGetAwardAll,this.S2CMissionGetAwardAll_cb_func),this.MissionGetAward_auth_cb_func=this.MissionGetAward_auth_cb.bind(this),s.addListener(r.S2CMissionGetAward,this.MissionGetAward_auth_cb_func);var e=cc.instantiate(this.FunctionBtnBar);this.node.addChild(e),e.setPosition(cc.p(0,0)),e.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").changeStatus(0)},onDestroy:function(){s.removeListener(r.S2CMissionList,this.MissionList_auth_cb_func),s.removeListener(r.S2CMissionGetAwardAll,this.S2CMissionGetAwardAll_cb_func),s.removeListener(r.S2CMissionGetAward,this.MissionGetAward_auth_cb_func),this._showList=[],l.instance=null},MissionList_auth_cb:function(e){cc.log(" nhiệm vụ liệt biểu ");var t=e.missions;MyPersistDataManager._playerData.missionslist=e.missions,this.SetMissionItem(t),this.mScrollView.stopAutoScroll(),this.mScrollView.scrollToTop(),this.node.runAction(cc.sequence(cc.delayTime(.25),cc.callFunc(function(){this.showGuide()},this)))},S2CMissionGetAwardAll_cb:function(e){if(null!=e.attachs&&0<e.attachs.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.attachs,t.getComponent("GetRewardPanel")._closeCb=this.awardCloseCb.bind(this)}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Nhận thành công")},MissionGetAward_auth_cb:function(e){var t=DonotDestroyManager.GameData.Missions[e.missionId],a=[];if(0<t.rewards.gamemoney&&a.push({itemId:1450,cnt:t.rewards.gamemoney}),0<t.rewards.money&&a.push({itemId:1451,cnt:t.rewards.money}),0<t.rewards.items.length)
for(var n=0;n<t.rewards.items.length;++n)
a.push({itemId:t.rewards.items[n][0],cnt:t.rewards.items[n][1]});var i=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(i);var r=i.getComponent("GetRewardPanel");r._itemlist=a,r._closeCb=this.awardCloseCb.bind(this),this._showList=[];var s=MyPersistDataManager._playerData.missionslist;for(n=0;n<s.length;++n)
if(s[n].missionId==e.missionId){if(0!=e.nextMissionId){s[n]={missionId:e.nextMissionId,progress:e.nextProgress},this.SetMissionItem(s);break}
s.splice(n,1),this.SetMissionItem(s);break}},awardCloseCb:function(){if(c.isLevelUpAble()){var n=this;cc.loader.loadRes("Prefab/ui/mainhome/LevelUpLayer",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);c.showLevelUpLayer(a,function(){n.showGuide()})})}else
this.showGuide()},setParams:function(e){this.closeCb=e.closeCb,this.ScaleToLarge(),0==MyPersistDataManager._playerData.missionslist.length?i.send_C2SMissionList(DonotDestroyManager._gameSocket):(this.SetMissionItem(MyPersistDataManager._playerData.missionslist),this.node.runAction(cc.sequence(cc.delayTime(.3),cc.callFunc(function(){this.showGuide()},this))))},SetMissionItem:function(e){this._showList=MyPersistDataManager._playerData.missionslist.concat();for(var t=e.length-1;0<=t;--t){var a=DonotDestroyManager.GameData.Missions[e[t].missionId];if(1300!=a.root_id&&e[t].progress>=a.mission_require[2]||1300==a.root_id&&e[t].progress<=a.mission_require[2])
for(var n=0;n<this._showList.length;++n)
if(this._showList[n].missionId==e[t].missionId){var i=this._showList[n];this._showList.splice(n,1),this._showList.unshift(i)}}
if(this.content=this.mScrollView.content,this.content.height=this._showList.length*(this.itemTemplateHeight+this.spacing)+this.spacing,0==this.content.children.length){this._spawnItems=[],this.updateTimer=0,this.updateInterval=.2;for(var r=this.lastContentPosY=0;r<this.spawnCount;++r){var s=cc.instantiate(this.itemTemplate);this.content.addChild(s),s.setPosition(0,-s.height*(.5+r)-this.spacing*(r+1)),s.getComponent("MissionItem").updateItem(r),this._spawnItems.push(s)}}else
for(var o=this.updateTimer=0;o<this.spawnCount;++o){var c=this._spawnItems[o];c.setPosition(0,-c.height*(.5+o)-this.spacing*(o+1)),c.getComponent("MissionItem").updateItem(o)}},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},showGuide:function(){var t=this;o.showGuide("MissionLayer",function(e){return 1==e?t.m_pItemContent.children[0].getComponent("MissionItem").awardBtn.node:2==e?t.btnClose:void 0})},getRewardAll:function(e){n.playBtnOpenEffect(),i.send_C2SMissionGetAwardAll(DonotDestroyManager._gameSocket)},getPositionInView:function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.mScrollView.node.convertToNodeSpaceAR(t)},update:function(e){if(this.updateTimer+=e,!(this.updateTimer<this.updateInterval)){this.updateTimer=0;var t=this._spawnItems;if(null!=t){for(var a=this.bufferZone,n=this.mScrollView.content.y<this.lastContentPosY,i=(this.itemTemplateHeight+this.spacing)*t.length,r=0;r<t.length;++r){var s=this.getPositionInView(t[r]);if(n){if(s.y<-a&&t[r].y+i<0){t[r].y=t[r].y+i;var o=t[r].getComponent("MissionItem"),c=o._itemID-t.length;o.updateItem(c)}}else if(s.y>a&&t[r].y-i>-this.content.height){t[r].y=t[r].y-i;var l=t[r].getComponent("MissionItem"),h=l._itemID+t.length;l.updateItem(h)}}
this.lastContentPosY=this.mScrollView.content.y}}}});cc._RF.pop()},{GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",PlayerBufferMgr:"PlayerBufferMgr",SoundUtil:"SoundUtil"}],MovePage:[function(e,t,a){"use strict";cc._RF.push(t,"5cbe3fyDVNFLLYRi+mokVrJ","MovePage");var n=e("SoundUtil"),i=e("MyProtocols"),r=e("NetEvent"),s=e("MyEventDispatcher");cc.Class({extends:cc.Component,properties:{itemPrefab:cc.Prefab,itemsParent:cc.Node,labelPrefab:cc.Prefab,labelContent:cc.Node,leftScroll:cc.ScrollView,itemEffect:cc.Prefab,awardMask:cc.Sprite,getVipPacksBtn:cc.Button,m_pRewardPanel:cc.Prefab,rollingEffectPrefab:cc.Prefab,_itemId:0,_itemNum:0,_indexVip:0},onLoad:function(){this.GetVipGift_auth_cb_func=this.GetVipGift_auth_cb.bind(this),s.addListener(r.S2CGetVipGift,this.GetVipGift_auth_cb_func)},onDestroy:function(){s.removeListener(r.S2CGetVipGift,this.GetVipGift_auth_cb_func)},GetVipGift_auth_cb:function(e){this.getVipPacksBtn.node.active=!1,this.awardMask.node.active=!0,MyPersistDataManager._playerData.chargeInfo.vip_gift_get.push(e.vip_level);for(var t=DonotDestroyManager.GameData.Charge.packs[e.vip_level].items,a=[],n=0;n<t.length;++n)
a.push({itemId:t[n][0],cnt:t[n][1]});var i=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(i),i.getComponent("GetRewardPanel")._itemlist=a},ChangeData:function(e){this._indexVip=e,this.ReadInfo(),this.ShowAwardItems()},ReadInfo:function(){this.leftScroll.scrollToTop();for(var e=DonotDestroyManager.GameData.Charge.vip_levels[this._indexVip].text,t=0;t<e.length;++t){var a=cc.instantiate(this.labelPrefab);a.getComponent("VipLabel").ChangeData(e,t),this.labelContent.addChild(a)}},ShowAwardItems:function(){MyPersistDataManager._playerData.vip_level>=this._indexVip&&(this.JudgeVipPacks()?(this.getVipPacksBtn.node.active=!1,this.awardMask.node.active=!0):(this.getVipPacksBtn.node.active=!0,this.awardMask.node.active=!1));for(var e=DonotDestroyManager.GameData.Charge.packs[this._indexVip],t=0;t<e.items.length;++t){this._itemId=e.items[t][0],this._itemNum=e.items[t][1];var a=cc.instantiate(this.itemPrefab),n=a.getComponent("ItemBox");if(n.ChangeItemInfo(this._itemId,this._itemNum,!0,null,!0),null!=n._itemjsoninfo.tier&&0<n._itemjsoninfo.tier&&(n._tiereffect=cc.instantiate(this.itemEffect),a.addChild(n._tiereffect)),null!=DonotDestroyManager.GameData.Cards[this._itemId])
if(100<=DonotDestroyManager.GameData.Cards[this._itemId].potential){var i=cc.instantiate(this.rollingEffectPrefab);a.addChild(i)}
this.itemsParent.addChild(a)}},JudgeVipPacks:function(){for(var e=MyPersistDataManager._playerData.chargeInfo.vip_gift_get,t=0;t<e.length;++t)
if(e[t]==this._indexVip)
return!0;return!1},GetPacks_onClickHandler:function(e,t){n.playBtnOpenEffect(),i.send_C2SGetVipGift(DonotDestroyManager._gameSocket,this._indexVip)}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],MoveSlow:[function(e,t,a){"use strict";cc._RF.push(t,"acba1zT6S5Ch4uujqDk453g","MoveSlow"),cc.Class({extends:cc.Component,properties:{offset_pos:[cc.Integer]},onEnable:function(){var e=cc.moveBy(.5,cc.p(this.offset_pos[0],this.offset_pos[1]));this.node.runAction(cc.repeatForever(cc.sequence(e,e.reverse())))},onDisable:function(){this.node.stopAllActions()},start:function(){}}),cc._RF.pop()},{}],MyEventDispatcher:[function(e,t,a){"use strict";cc._RF.push(t,"b7421PvkVZDNJIoiPJN7djZ","MyEventDispatcher");var n={_listenerMap:{},addListener:function(e,t){if(t&&e){var a=this._listenerMap[e];a||(a=this._listenerMap[e]=new Array);for(var n=0;n<a.length;n++)
if(a[n]==t)
return;a.push(t)}},removeListener:function(e,t){if(t&&e){var a=this._listenerMap[e];if(a)
for(var n=0;n<a.length;n++)
if(a[n]==t){a.splice(n,1);break}}},removeEvent:function(e){var t=this._listenerMap[e];t&&(delete this._listenerMap[e],t=[])},dispatchEvent:function(e,t){if(this._listenerMap[e])
for(var a=this._listenerMap[e],n=0;n<a.length;n++)
a[n](t)}};t.exports=n,cc._RF.pop()},{}],MyProtocols:[function(e,t,a){"use strict";cc._RF.push(t,"acb744DxuxELYvpSevLaObo","MyProtocols");var h=e("WsEncoder"),n={send_C2SActivityList:function(e){var t=h.alloc();t.writeInt(5401);var a=t.end();t.free(),e.sendMessage(a)},get_5402:function(e){var t={fixed_activities:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.fixed_activities[n]={},t.fixed_activities[n].id=e.readInt(),t.fixed_activities[n].level_index=e.readInt(),t.fixed_activities[n].progress=e.readInt(),t.fixed_activities[n].can_get_award=e.readBool();t.dynamic_activities=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++){t.dynamic_activities[n]={},t.dynamic_activities[n].activeBigID=e.readInt(),t.dynamic_activities[n].priority=e.readInt(),t.dynamic_activities[n].des=e.readString(),t.dynamic_activities[n].StartTime=e.readInt(),t.dynamic_activities[n].EndTime=e.readInt(),t.dynamic_activities[n].nComplete=e.readInt(),t.dynamic_activities[n].sub_activities=[];var r=e.readInt();if(0<r)
for(var s=0;s<r;s++){t.dynamic_activities[n].sub_activities[s]={},t.dynamic_activities[n].sub_activities[s].nSubCount=e.readInt(),t.dynamic_activities[n].sub_activities[s].nNeedLevel=e.readInt(),t.dynamic_activities[n].sub_activities[s].nNeedVipLevel=e.readInt(),t.dynamic_activities[n].sub_activities[s].nNeedPassNoChapID=e.readInt(),t.dynamic_activities[n].sub_activities[s].nState=e.readInt(),t.dynamic_activities[n].sub_activities[s].nComplete=e.readInt(),t.dynamic_activities[n].sub_activities[s].szSubDes=e.readString(),t.dynamic_activities[n].sub_activities[s].reward=[];var o=e.readInt();if(0<o)
for(var c=0;c<o;c++)
t.dynamic_activities[n].sub_activities[s].reward[c]={},t.dynamic_activities[n].sub_activities[s].reward[c].nID=e.readInt(),t.dynamic_activities[n].sub_activities[s].reward[c].nNum=e.readInt()}
t.dynamic_activities[n].hero_libao_config=[];var l=e.readInt();if(0<l)
for(var h=0;h<l;h++){t.dynamic_activities[n].hero_libao_config[h]={},t.dynamic_activities[n].hero_libao_config[h].buy_count=e.readInt(),t.dynamic_activities[n].hero_libao_config[h].buy_count_total=e.readInt(),t.dynamic_activities[n].hero_libao_config[h].favor_rate=e.readInt(),t.dynamic_activities[n].hero_libao_config[h].price=e.readInt(),t.dynamic_activities[n].hero_libao_config[h].recharge_id=e.readInt(),t.dynamic_activities[n].hero_libao_config[h].extra_diamond=e.readInt(),t.dynamic_activities[n].hero_libao_config[h].reward=[];var d=e.readInt();if(0<d)
for(c=0;c<d;c++)
t.dynamic_activities[n].hero_libao_config[h].reward[c]={},t.dynamic_activities[n].hero_libao_config[h].reward[c].nID=e.readInt(),t.dynamic_activities[n].hero_libao_config[h].reward[c].nNum=e.readInt()}
if(1==e.readBool()){t.dynamic_activities[n].lottery_wheel_config={},t.dynamic_activities[n].lottery_wheel_config.my_free_count=e.readInt(),t.dynamic_activities[n].lottery_wheel_config.my_pay_count=e.readInt(),t.dynamic_activities[n].lottery_wheel_config.daily_free_count=e.readInt(),t.dynamic_activities[n].lottery_wheel_config.pay_count=e.readInt(),t.dynamic_activities[n].lottery_wheel_config.pay_price=e.readInt(),t.dynamic_activities[n].lottery_wheel_config.reward=[];var _=e.readInt();if(0<_)
for(c=0;c<_;c++)
t.dynamic_activities[n].lottery_wheel_config.reward[c]={},t.dynamic_activities[n].lottery_wheel_config.reward[c].nID=e.readInt(),t.dynamic_activities[n].lottery_wheel_config.reward[c].nNum=e.readInt()}}
return t},send_C2SActivitiesGetAward:function(e,t,a){var n=h.alloc();n.writeInt(5403),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_5404:function(e){var t={};t.activeIdType=e.readInt(),t.item_index=e.readInt(),t.gain=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain[n]={},t.gain[n].nID=e.readInt(),t.gain[n].nNum=e.readInt();return t.lottery_is_pay=e.readBool(),t},get_5406:function(e){var t={};return t.activeIdType=e.readInt(),t.progress=e.readInt(),t},send_C2SQiZhenYiBaoView:function(e){var t=h.alloc();t.writeInt(5407);var a=t.end();t.free(),e.sendMessage(a)},get_5408:function(e){var t={fixed_award:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.fixed_award[n]={},t.fixed_award[n].nID=e.readInt(),t.fixed_award[n].nNum=e.readInt();1==e.readBool()&&(t.big_award={},t.big_award.nID=e.readInt(),t.big_award.nNum=e.readInt()),t.my_count=e.readInt(),t.end_cd_time=e.readInt(),t.player_count_kaijiang=e.readInt(),t.cost_diamond=e.readInt(),t.big_award_value=e.readInt(),t.players=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.players[n]={},t.players[n].player_id=e.readInt(),t.players[n].player_name=e.readString(),t.players[n].count=e.readInt();t.history_players=[];var r=e.readInt();if(0<r)
for(n=0;n<r;n++)
t.history_players[n]={},t.history_players[n].player_id=e.readInt(),t.history_players[n].player_name=e.readString(),t.history_players[n].count=e.readInt();return t},send_C2SQiZhenYiBaoJoin:function(e){var t=h.alloc();t.writeInt(5409);var a=t.end();t.free(),e.sendMessage(a)},get_5410:function(e){return{}},get_5412:function(e){var t={};return 1==e.readBool()&&(t.award_player={},t.award_player.player_id=e.readInt(),t.award_player.player_name=e.readString(),t.award_player.count=e.readInt()),t.hero_tpl_id=e.readInt(),t},send_C2SActivitiesView:function(e,t){var a=h.alloc();a.writeInt(5201),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_5202:function(e){var t={};t.module_id=e.readInt(),t.attack_count=e.readInt(),t.buy_count=e.readInt(),t.info=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.info[n]={},t.info[n].activity_type=e.readInt(),t.info[n].boxAwardCanGet=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.info[n].boxAwardCanGet[r]=e.readBool();t.info[n].star=[];var s=e.readInt();if(0<s)
for(var o=0;o<s;o++)
t.info[n].star[o]=e.readInt()}
return t},send_C2SActivitiesBattlePass:function(e,t,a,n,i,r,s){var o=h.alloc();o.writeInt(5203),o.writeInt(t),o.writeInt(a),o.writeInt(n),o.writeInt(i),o.writeInt(r),o.writeInt(s);var c=o.end();o.free(),e.sendMessage(c)},get_5204:function(e){var t={};t.module_id=e.readInt(),t.activity_type=e.readInt(),t.level_index=e.readInt(),t.gain=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain[n]={},t.gain[n].item_template_id=e.readInt(),t.gain[n].item_count=e.readInt();return t.star=e.readInt(),t.attack_count=e.readInt(),t.boxAwardCanGet=e.readBool(),t},send_C2SActivitiesClaimAward:function(e,t,a,n){var i=h.alloc();i.writeInt(5205),i.writeInt(t),i.writeInt(a),i.writeInt(n);var r=i.end();i.free(),e.sendMessage(r)},get_5206:function(e){var t={};return t.module_id=e.readInt(),t.activity_type=e.readInt(),t.level_index=e.readInt(),t},send_C2SActivitiesBattleBuyTicket:function(e,t){var a=h.alloc();a.writeInt(5207),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_5208:function(e){var t={};return t.module_id=e.readInt(),t.buyTimes=e.readInt(),t.costMoney=e.readInt(),t},send_C2SActivitiesBattleFormation:function(e,t){var a=h.alloc();a.writeInt(5209),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_5210:function(e){var t={};return t.exist=e.readBool(),1==e.readBool()&&(t.formation={},t.formation.fid=e.readInt(),t.formation.formationId=e.readInt(),t.formation.forward=e.readInt(),t.formation.flip=e.readInt(),t.formation.a=e.readInt(),t.formation.b=e.readInt(),t.formation.c=e.readInt(),t.formation.d=e.readInt(),t.formation.e=e.readInt(),t.formation.f=e.readInt(),t.formation.g=e.readInt(),t.formation.h=e.readInt(),t.formation.i=e.readInt(),t.formation.j=e.readInt()),t},send_C2SActivitiesBattleSweep:function(e,t,a,n){var i=h.alloc();i.writeInt(5211),i.writeInt(t),i.writeInt(a),i.writeInt(n);var r=i.end();i.free(),e.sendMessage(r)},get_5212:function(e){var t={};t.module_id=e.readInt(),t.activity_type=e.readInt(),t.level_index=e.readInt(),t.gain=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain[n]={},t.gain[n].item_template_id=e.readInt(),t.gain[n].item_count=e.readInt();return t.attack_count=e.readInt(),t.boxAwardCanGet=e.readBool(),t},send_C2SArenaExchangeList:function(e){var t=h.alloc();t.writeInt(3801);var a=t.end();t.free(),e.sendMessage(a)},get_3802:function(e){var t={buy_count:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.buy_count[n]=e.readInt();return t},send_C2SArenaExchange:function(e,t,a){var n=h.alloc();n.writeInt(3803),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_3804:function(e){var t={};return t.slot_index=e.readInt(),t.buy_count=e.readInt(),1==e.readBool()&&(t.rewards={},t.rewards.item_template_id=e.readInt(),t.rewards.item_count=e.readInt()),t},send_C2SArenaView:function(e,t){var a=h.alloc();a.writeInt(3805),a.writeBool(t);var n=a.end();a.free(),e.sendMessage(n)},get_3806:function(e){var t={};t.my_rank=e.readInt(),t.enemys=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.enemys[n]={},t.enemys[n].sexId=e.readInt(),t.enemys[n].playerId=e.readInt(),t.enemys[n].level=e.readInt(),t.enemys[n].rank=e.readInt(),t.enemys[n].fight=e.readInt(),t.enemys[n].nickname=e.readString();t.top_ranks=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.top_ranks[n]={},t.top_ranks[n].sexId=e.readInt(),t.top_ranks[n].playerId=e.readInt(),t.top_ranks[n].level=e.readInt(),t.top_ranks[n].rank=e.readInt(),t.top_ranks[n].fight=e.readInt(),t.top_ranks[n].nickname=e.readString();return t.guideReq=e.readBool(),t},send_C2SArenaEnemyDetail:function(e,t){var a=h.alloc();a.writeInt(3807),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3808:function(e){var t={};t.enemy_index=e.readInt(),1==e.readBool()&&(t.base_info={},t.base_info.sexId=e.readInt(),t.base_info.playerId=e.readInt(),t.base_info.level=e.readInt(),t.base_info.rank=e.readInt(),t.base_info.fight=e.readInt(),t.base_info.nickname=e.readString()),1==e.readBool()&&(t.formation={},t.formation.fid=e.readInt(),t.formation.formationId=e.readInt(),t.formation.forward=e.readInt(),t.formation.flip=e.readInt(),t.formation.a=e.readInt(),t.formation.b=e.readInt(),t.formation.c=e.readInt(),t.formation.d=e.readInt(),t.formation.e=e.readInt(),t.formation.f=e.readInt(),t.formation.g=e.readInt(),t.formation.h=e.readInt(),t.formation.i=e.readInt(),t.formation.j=e.readInt()),t.cards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.cards[n]={},t.cards[n].template_id=e.readInt(),t.cards[n].level=e.readInt(),t.cards[n].exp=e.readInt(),t.cards[n].grade=e.readInt(),t.cards[n].unitLevel=e.readInt(),t.cards[n].unitGrade=e.readInt(),t.cards[n].maxhp=e.readInt(),t.cards[n].atk=e.readInt(),t.cards[n].def=e.readInt(),t.cards[n].unitMaxhp=e.readInt(),t.cards[n].unitAtk=e.readInt(),t.cards[n].unitDef=e.readInt(),t.cards[n].unitNum=e.readInt(),t.cards[n].fight=e.readInt(),t.cards[n].extra_props=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.cards[n].extra_props[r]=e.readInt()}
return t},send_C2SArenaRefreshEnemy:function(e){var t=h.alloc();t.writeInt(3809);var a=t.end();t.free(),e.sendMessage(a)},get_3810:function(e){var t={enemys:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.enemys[n]={},t.enemys[n].sexId=e.readInt(),t.enemys[n].playerId=e.readInt(),t.enemys[n].level=e.readInt(),t.enemys[n].rank=e.readInt(),t.enemys[n].fight=e.readInt(),t.enemys[n].nickname=e.readString();return t},send_C2SArenaBattleStart:function(e,t){var a=h.alloc();a.writeInt(3811),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3812:function(e){var t={};return t.result=e.readBool(),t.rand_key=e.readLong(),t},send_C2SArenaBattleCalculate:function(e,t,a,n){var i=h.alloc();i.writeInt(3813),i.writeInt(t),i.writeInt(a),i.writeLong(n);var r=i.end();i.free(),e.sendMessage(r)},get_3814:function(e){var t={};t.result=e.readInt(),t.gain=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain[n]={},t.gain[n].item_template_id=e.readInt(),t.gain[n].item_count=e.readInt();1==e.readBool()&&(t.dirtyItems={},t.dirtyItems.item_template_id=e.readInt(),t.dirtyItems.item_count=e.readInt()),t.new_rank=e.readInt(),t.enemys=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.enemys[n]={},t.enemys[n].sexId=e.readInt(),t.enemys[n].playerId=e.readInt(),t.enemys[n].level=e.readInt(),t.enemys[n].rank=e.readInt(),t.enemys[n].fight=e.readInt(),t.enemys[n].nickname=e.readString();return t.maxRank=e.readInt(),t.rankImproveMoney=e.readInt(),t},send_C2SLuckyRankInfo:function(e){var t=h.alloc();t.writeInt(3815);var a=t.end();t.free(),e.sendMessage(a)},get_3816:function(e){var t={prevInfos:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.prevInfos[n]={},t.prevInfos[n].rank=e.readInt(),t.prevInfos[n].name=e.readString(),t.prevInfos[n].money=e.readInt();t.infos=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.infos[n]={},t.infos[n].rank=e.readInt(),t.infos[n].name=e.readString(),t.infos[n].money=e.readInt();return t},send_C2SArenaBattleRecord:function(e){var t=h.alloc();t.writeInt(3817);var a=t.end();t.free(),e.sendMessage(a)},get_3818:function(e){var t={reports:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.reports[n]={},t.reports[n].nickname=e.readString(),t.reports[n].type=e.readInt(),t.reports[n].rankChange=e.readInt(),t.reports[n].rank=e.readInt(),t.reports[n].result=e.readInt(),t.reports[n].time=e.readInt();return t},send_C2SArenaFormation:function(e){var t=h.alloc();t.writeInt(3819);var a=t.end();t.free(),e.sendMessage(a)},get_3820:function(e){var t={};return 1==e.readBool()&&(t.formation={},t.formation.fid=e.readInt(),t.formation.formationId=e.readInt(),t.formation.forward=e.readInt(),t.formation.flip=e.readInt(),t.formation.a=e.readInt(),t.formation.b=e.readInt(),t.formation.c=e.readInt(),t.formation.d=e.readInt(),t.formation.e=e.readInt(),t.formation.f=e.readInt(),t.formation.g=e.readInt(),t.formation.h=e.readInt(),t.formation.i=e.readInt(),t.formation.j=e.readInt()),t},send_C2SArenaPlayerDetail:function(e,t){var a=h.alloc();a.writeInt(3821),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3822:function(e){var t={};t.player_id=e.readInt(),t.cards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.cards[n]={},t.cards[n].template_id=e.readInt(),t.cards[n].level=e.readInt(),t.cards[n].exp=e.readInt(),t.cards[n].grade=e.readInt(),t.cards[n].unitLevel=e.readInt(),t.cards[n].unitGrade=e.readInt(),t.cards[n].maxhp=e.readInt(),t.cards[n].atk=e.readInt(),t.cards[n].def=e.readInt(),t.cards[n].unitMaxhp=e.readInt(),t.cards[n].unitAtk=e.readInt(),t.cards[n].unitDef=e.readInt(),t.cards[n].unitNum=e.readInt(),t.cards[n].fight=e.readInt(),t.cards[n].extra_props=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.cards[n].extra_props[r]=e.readInt()}
return t},send_C2SArenaTopRankView:function(e){var t=h.alloc();t.writeInt(3823);var a=t.end();t.free(),e.sendMessage(a)},get_3824:function(e){var t={top_ranks:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.top_ranks[n]={},t.top_ranks[n].sexId=e.readInt(),t.top_ranks[n].playerId=e.readInt(),t.top_ranks[n].level=e.readInt(),t.top_ranks[n].rank=e.readInt(),t.top_ranks[n].fight=e.readInt(),t.top_ranks[n].nickname=e.readString();return t},send_C2SPkEnemyFormation:function(e,t){var a=h.alloc();a.writeInt(3825),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3826:function(e){var t={};t.target_player_id=e.readInt(),1==e.readBool()&&(t.base_info={},t.base_info.sexId=e.readInt(),t.base_info.playerId=e.readInt(),t.base_info.level=e.readInt(),t.base_info.rank=e.readInt(),t.base_info.fight=e.readInt(),t.base_info.nickname=e.readString()),1==e.readBool()&&(t.formation={},t.formation.fid=e.readInt(),t.formation.formationId=e.readInt(),t.formation.forward=e.readInt(),t.formation.flip=e.readInt(),t.formation.a=e.readInt(),t.formation.b=e.readInt(),t.formation.c=e.readInt(),t.formation.d=e.readInt(),t.formation.e=e.readInt(),t.formation.f=e.readInt(),t.formation.g=e.readInt(),t.formation.h=e.readInt(),t.formation.i=e.readInt(),t.formation.j=e.readInt()),t.cards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.cards[n]={},t.cards[n].template_id=e.readInt(),t.cards[n].level=e.readInt(),t.cards[n].exp=e.readInt(),t.cards[n].grade=e.readInt(),t.cards[n].unitLevel=e.readInt(),t.cards[n].unitGrade=e.readInt(),t.cards[n].maxhp=e.readInt(),t.cards[n].atk=e.readInt(),t.cards[n].def=e.readInt(),t.cards[n].unitMaxhp=e.readInt(),t.cards[n].unitAtk=e.readInt(),t.cards[n].unitDef=e.readInt(),t.cards[n].unitNum=e.readInt(),t.cards[n].fight=e.readInt(),t.cards[n].extra_props=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.cards[n].extra_props[r]=e.readInt()}
return t.rand_key=e.readLong(),t},send_C2SPkBattleCalculate:function(e,t,a,n){var i=h.alloc();i.writeInt(3827),i.writeInt(t),i.writeInt(a),i.writeLong(n);var r=i.end();i.free(),e.sendMessage(r)},get_3828:function(e){var t={};t.target_player_id=e.readInt(),t.result=e.readInt(),t.winLooseCount=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.winLooseCount[n]=e.readInt();t.gain=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.gain[n]={},t.gain[n].item_template_id=e.readInt(),t.gain[n].item_count=e.readInt();return t.rand_key=e.readLong(),t},send_C2SListSign:function(e){var t=h.alloc();t.writeInt(3601);var a=t.end();t.free(),e.sendMessage(a)},get_3602:function(e){var t={};return t.signed_day_num=e.readInt(),t.today_day_num=e.readInt(),t},send_C2SGetSignAward:function(e){var t=h.alloc();t.writeInt(3603);var a=t.end();t.free(),e.sendMessage(a)},get_3604:function(e){return{}},send_C2SListOnlineAward:function(e){var t=h.alloc();t.writeInt(3611);var a=t.end();t.free(),e.sendMessage(a)},get_3612:function(e){var t={};t.curr_time=e.readInt(),t.online_time=e.readInt(),t.award_temp=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.award_temp[n]=e.readInt();return t},send_C2SOnlineTime:function(e){var t=h.alloc();t.writeInt(3613);var a=t.end();t.free(),e.sendMessage(a)},get_3614:function(e){var t={};return t.online_time=e.readInt(),t},send_C2SGetOnlineAward:function(e,t){var a=h.alloc();a.writeInt(3615),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3616:function(e){var t={};return t.template_id=e.readInt(),t},send_C2SKeyConvert:function(e,t){var a=h.alloc();a.writeInt(3621),a.writeString(t);var n=a.end();a.free(),e.sendMessage(n)},get_3622:function(e){var t={};t.result_id=e.readInt(),t.reward_item=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.reward_item[n]={},t.reward_item[n].itemId=e.readInt(),t.reward_item[n].cnt=e.readInt();return t},send_C2SBagItems:function(e){var t=h.alloc();t.writeInt(10301);var a=t.end();t.free(),e.sendMessage(a)},get_10302:function(e){var t={item_list:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.item_list[n]={},t.item_list[n].uuid=e.readString(),t.item_list[n].template_id=e.readInt(),t.item_list[n].enhance_level=e.readInt(),t.item_list[n].stars=e.readInt(),t.item_list[n].num=e.readInt(),t.item_list[n].bagId=e.readInt(),t.item_list[n].hpEx=e.readInt(),t.item_list[n].atkEx=e.readInt(),t.item_list[n].defEx=e.readInt(),t.item_list[n].attrEx=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.item_list[n].attrEx[r]={},t.item_list[n].attrEx[r].id=e.readInt(),t.item_list[n].attrEx[r].num=e.readInt();1==e.readBool()&&(t.item_list[n].unitAttr={},t.item_list[n].unitAttr.id=e.readInt(),t.item_list[n].unitAttr.num=e.readInt()),t.item_list[n].exp=e.readInt()}
t.expand_info=[];var s=e.readInt();if(0<s)
for(n=0;n<s;n++)
t.expand_info[n]={},t.expand_info[n].bag_id=e.readInt(),t.expand_info[n].expand_count=e.readInt();return t},send_C2SSellItem:function(e,t,a,n){var i=h.alloc();i.writeInt(10303),i.writeInt(t),i.writeInt(a),i.writeInt(n);var r=i.end();i.free(),e.sendMessage(r)},get_10304:function(e){return{}},send_C2SUseItem:function(e,t){var a=h.alloc();a.writeInt(10305),null==t?a.writeInt(0):(a.writeInt(t.length),t.forEach(function(e){a.writeInt(e.template_id),a.writeInt(e.count)}));var n=a.end();a.free(),e.sendMessage(n)},get_10306:function(e){var t={reward_item:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.reward_item[n]={},t.reward_item[n].template_id=e.readInt(),t.reward_item[n].bagId=e.readInt(),t.reward_item[n].num=e.readInt();return t},get_10308:function(e){var t={};if(1==e.readBool()){t.item_info={},t.item_info.uuid=e.readString(),t.item_info.template_id=e.readInt(),t.item_info.enhance_level=e.readInt(),t.item_info.stars=e.readInt(),t.item_info.num=e.readInt(),t.item_info.bagId=e.readInt(),t.item_info.hpEx=e.readInt(),t.item_info.atkEx=e.readInt(),t.item_info.defEx=e.readInt(),t.item_info.attrEx=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.item_info.attrEx[n]={},t.item_info.attrEx[n].id=e.readInt(),t.item_info.attrEx[n].num=e.readInt();1==e.readBool()&&(t.item_info.unitAttr={},t.item_info.unitAttr.id=e.readInt(),t.item_info.unitAttr.num=e.readInt()),t.item_info.exp=e.readInt()}
return t},send_C2SExpandBag:function(e,t){var a=h.alloc();a.writeInt(10309),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10310:function(e){var t={};return t.bag_id=e.readInt(),t.expand_count=e.readInt(),t},send_C2SEquipEnhance:function(e,t){var a=h.alloc();a.writeInt(10311),a.writeString(t);var n=a.end();a.free(),e.sendMessage(n)},get_10312:function(e){var t={};return t.equip_uuid=e.readString(),t.enhance_level=e.readInt(),t.card_id=e.readInt(),t.fight=e.readInt(),t},send_C2SEquipEnhanceAuto:function(e,t){var a=h.alloc();a.writeInt(10313),a.writeString(t);var n=a.end();a.free(),e.sendMessage(n)},get_10314:function(e){var t={};t.equip_uuid=e.readString(),t.infos=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.infos[n]={},t.infos[n].x=e.readInt(),t.infos[n].level=e.readInt();return t.enhance_level=e.readInt(),t.card_id=e.readInt(),t.fight=e.readInt(),t},send_C2SEquipEnhanceAll:function(e,t){var a=h.alloc();a.writeInt(10315),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10316:function(e){var t={};t.card_tpl_id=e.readInt(),t.item_infos=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.item_infos[n]={},t.item_infos[n].itemId=e.readString(),t.item_infos[n].enhance_level=e.readInt(),t.item_infos[n].crit_count=e.readInt();return t.fight=e.readInt(),t},send_C2SEquipRefresh:function(e,t,a,n){var i=h.alloc();i.writeInt(10317),i.writeString(t),i.writeInt(a),i.writeInt(n);var r=i.end();i.free(),e.sendMessage(r)},get_10318:function(e){var t={};t.equip_uuid=e.readString(),t.hpEx=e.readInt(),t.atkEx=e.readInt(),t.defEx=e.readInt(),t.attrEx=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.attrEx[n]={},t.attrEx[n].id=e.readInt(),t.attrEx[n].num=e.readInt();return t},send_C2SEquipRefreshSave:function(e,t){var a=h.alloc();a.writeInt(10319),a.writeString(t);var n=a.end();a.free(),e.sendMessage(n)},get_10320:function(e){var t={};t.equip_uuid=e.readString(),t.hpEx=e.readInt(),t.atkEx=e.readInt(),t.defEx=e.readInt(),t.attrEx=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.attrEx[n]={},t.attrEx[n].id=e.readInt(),t.attrEx[n].num=e.readInt();return t.card_id=e.readInt(),t.fight=e.readInt(),t},send_C2STreasureEnhance:function(e,t,a){var n=h.alloc();n.writeInt(10321),n.writeString(t),null==a?n.writeInt(0):(n.writeInt(a.length),a.forEach(function(e){n.writeString(e)}));var i=n.end();n.free(),e.sendMessage(i)},get_10322:function(e){var t={};return t.treasure_uuid=e.readString(),t.exp=e.readInt(),t.enhance_level=e.readInt(),t.card_id=e.readInt(),t.fight=e.readInt(),t},send_C2STreasureRefresh:function(e,t,a){var n=h.alloc();n.writeInt(10323),n.writeString(t),null==a?n.writeInt(0):(n.writeInt(a.length),a.forEach(function(e){n.writeString(e)}));var i=n.end();n.free(),e.sendMessage(i)},get_10324:function(e){var t={};return t.treasure_uuid=e.readString(),t.stars=e.readInt(),t.card_id=e.readInt(),t.fight=e.readInt(),t},send_C2STreasureFragCompose:function(e,t,a){var n=h.alloc();n.writeInt(10325),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_10326:function(e){var t={};return t.templateId=e.readInt(),t.treasure_uuid=e.readString(),t},send_C2SEquipFragCompose:function(e,t){var a=h.alloc();a.writeInt(10327),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10328:function(e){var t={};if(1==e.readBool()){t.item={},t.item.uuid=e.readString(),t.item.template_id=e.readInt(),t.item.enhance_level=e.readInt(),t.item.stars=e.readInt(),t.item.num=e.readInt(),t.item.bagId=e.readInt(),t.item.hpEx=e.readInt(),t.item.atkEx=e.readInt(),t.item.defEx=e.readInt(),t.item.attrEx=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.item.attrEx[n]={},t.item.attrEx[n].id=e.readInt(),t.item.attrEx[n].num=e.readInt();1==e.readBool()&&(t.item.unitAttr={},t.item.unitAttr.id=e.readInt(),t.item.unitAttr.num=e.readInt()),t.item.exp=e.readInt()}
return t},send_C2SMineList:function(e,t,a){var n=h.alloc();n.writeInt(3101),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_3102:function(e){var t={};t.level_index=e.readInt(),t.page_index=e.readInt(),t.my_income=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.my_income[n]=e.readInt();t.my_hold=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.my_hold[n]=e.readInt();t.my_cd_time=[];var r=e.readInt();if(0<r)
for(n=0;n<r;n++)
t.my_cd_time[n]=e.readInt();t.mine_points=[];var s=e.readInt();if(0<s)
for(n=0;n<s;n++){t.mine_points[n]={},1==e.readBool()&&(t.mine_points[n].hold_player={},t.mine_points[n].hold_player.id=e.readInt(),t.mine_points[n].hold_player.nickname=e.readString(),t.mine_points[n].hold_player.level=e.readInt(),t.mine_points[n].hold_player.icon=e.readInt(),t.mine_points[n].hold_player.head_frame_id=e.readInt(),t.mine_points[n].hold_player.fight=e.readInt(),t.mine_points[n].hold_player.cd_time=e.readInt())}
return t},send_C2SMineEnemyDetail:function(e,t,a){var n=h.alloc();n.writeInt(3103),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_3104:function(e){var t={};t.level_index=e.readInt(),t.point_index=e.readInt(),1==e.readBool()&&(t.base_info={},t.base_info.id=e.readInt(),t.base_info.nickname=e.readString(),t.base_info.level=e.readInt(),t.base_info.icon=e.readInt(),t.base_info.head_frame_id=e.readInt(),t.base_info.fight=e.readInt(),t.base_info.cd_time=e.readInt()),1==e.readBool()&&(t.formation={},t.formation.fid=e.readInt(),t.formation.formationId=e.readInt(),t.formation.forward=e.readInt(),t.formation.flip=e.readInt(),t.formation.a=e.readInt(),t.formation.b=e.readInt(),t.formation.c=e.readInt(),t.formation.d=e.readInt(),t.formation.e=e.readInt(),t.formation.f=e.readInt(),t.formation.g=e.readInt(),t.formation.h=e.readInt(),t.formation.i=e.readInt(),t.formation.j=e.readInt()),t.cards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.cards[n]={},t.cards[n].template_id=e.readInt(),t.cards[n].level=e.readInt(),t.cards[n].exp=e.readInt(),t.cards[n].grade=e.readInt(),t.cards[n].unitLevel=e.readInt(),t.cards[n].unitGrade=e.readInt(),t.cards[n].maxhp=e.readInt(),t.cards[n].atk=e.readInt(),t.cards[n].def=e.readInt(),t.cards[n].unitMaxhp=e.readInt(),t.cards[n].unitAtk=e.readInt(),t.cards[n].unitDef=e.readInt(),t.cards[n].unitNum=e.readInt(),t.cards[n].fight=e.readInt(),t.cards[n].extra_props=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.cards[n].extra_props[r]=e.readInt()}
t.exclude_cards=[];var s=e.readInt();if(0<s)
for(n=0;n<s;n++)
t.exclude_cards[n]=e.readInt();return t.rand_key=e.readLong(),t},send_C2SMineBattleCalculate:function(e,t,a,n,i){var r=h.alloc();r.writeInt(3105),r.writeInt(t),r.writeInt(a),r.writeInt(n),r.writeLong(i);var s=r.end();r.free(),e.sendMessage(s)},get_3106:function(e){var t={};t.level_index=e.readInt(),t.point_index=e.readInt(),t.result=e.readInt(),t.gain=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain[n]={},t.gain[n].itemId=e.readInt(),t.gain[n].cnt=e.readInt();if(1==e.readBool()){t.mine_point_detail={},t.mine_point_detail.level_index=e.readInt(),t.mine_point_detail.point_index=e.readInt(),1==e.readBool()&&(t.mine_point_detail.base_info={},t.mine_point_detail.base_info.id=e.readInt(),t.mine_point_detail.base_info.nickname=e.readString(),t.mine_point_detail.base_info.level=e.readInt(),t.mine_point_detail.base_info.icon=e.readInt(),t.mine_point_detail.base_info.head_frame_id=e.readInt(),t.mine_point_detail.base_info.fight=e.readInt(),t.mine_point_detail.base_info.cd_time=e.readInt()),1==e.readBool()&&(t.mine_point_detail.formation={},t.mine_point_detail.formation.fid=e.readInt(),t.mine_point_detail.formation.formationId=e.readInt(),t.mine_point_detail.formation.forward=e.readInt(),t.mine_point_detail.formation.flip=e.readInt(),t.mine_point_detail.formation.a=e.readInt(),t.mine_point_detail.formation.b=e.readInt(),t.mine_point_detail.formation.c=e.readInt(),t.mine_point_detail.formation.d=e.readInt(),t.mine_point_detail.formation.e=e.readInt(),t.mine_point_detail.formation.f=e.readInt(),t.mine_point_detail.formation.g=e.readInt(),t.mine_point_detail.formation.h=e.readInt(),t.mine_point_detail.formation.i=e.readInt(),t.mine_point_detail.formation.j=e.readInt()),t.mine_point_detail.cards=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++){t.mine_point_detail.cards[r]={},t.mine_point_detail.cards[r].template_id=e.readInt(),t.mine_point_detail.cards[r].level=e.readInt(),t.mine_point_detail.cards[r].exp=e.readInt(),t.mine_point_detail.cards[r].grade=e.readInt(),t.mine_point_detail.cards[r].unitLevel=e.readInt(),t.mine_point_detail.cards[r].unitGrade=e.readInt(),t.mine_point_detail.cards[r].maxhp=e.readInt(),t.mine_point_detail.cards[r].atk=e.readInt(),t.mine_point_detail.cards[r].def=e.readInt(),t.mine_point_detail.cards[r].unitMaxhp=e.readInt(),t.mine_point_detail.cards[r].unitAtk=e.readInt(),t.mine_point_detail.cards[r].unitDef=e.readInt(),t.mine_point_detail.cards[r].unitNum=e.readInt(),t.mine_point_detail.cards[r].fight=e.readInt(),t.mine_point_detail.cards[r].extra_props=[];var s=e.readInt();if(0<s)
for(var o=0;o<s;o++)
t.mine_point_detail.cards[r].extra_props[o]=e.readInt()}
t.mine_point_detail.exclude_cards=[];var c=e.readInt();if(0<c)
for(var l=0;l<c;l++)
t.mine_point_detail.exclude_cards[l]=e.readInt();t.mine_point_detail.rand_key=e.readLong()}
return t},get_3108:function(e){var t={};t.level_index=e.readInt(),t.point_index=e.readInt(),t.target_player_id=e.readInt(),t.target_player_name=e.readString(),t.loose_items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.loose_items[n]={},t.loose_items[n].itemId=e.readInt(),t.loose_items[n].cnt=e.readInt();return t},send_C2SMineGetAward:function(e){var t=h.alloc();t.writeInt(3109);var a=t.end();t.free(),e.sendMessage(a)},get_3110:function(e){var t={gain:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain[n]={},t.gain[n].itemId=e.readInt(),t.gain[n].cnt=e.readInt();return t},send_C2SMineHistory:function(e){var t=h.alloc();t.writeInt(3111);var a=t.end();t.free(),e.sendMessage(a)},get_3112:function(e){var t={records:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.records[n]={},t.records[n].target_player_id=e.readInt(),t.records[n].target_player_name=e.readString(),t.records[n].is_positive=e.readBool(),t.records[n].is_success=e.readInt(),t.records[n].mine_point=e.readInt(),t.records[n].type=e.readInt(),t.records[n].add_time=e.readInt(),t.records[n].gain=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.records[n].gain[r]=e.readInt()}
return t},send_C2SMineDefFormationSave:function(e,t,a,n){var i=h.alloc();i.writeInt(3113),i.writeInt(t),i.writeInt(a),null==n?i.writeBool(!1):(i.writeBool(!0),i.writeInt(n.fid),i.writeInt(n.formationId),i.writeInt(n.forward),i.writeInt(n.flip),i.writeInt(n.a),i.writeInt(n.b),i.writeInt(n.c),i.writeInt(n.d),i.writeInt(n.e),i.writeInt(n.f),i.writeInt(n.g),i.writeInt(n.h),i.writeInt(n.i),i.writeInt(n.j));var r=i.end();i.free(),e.sendMessage(r)},get_3114:function(e){var t={};if(1==e.readBool()){t.mine_point_detail={},t.mine_point_detail.level_index=e.readInt(),t.mine_point_detail.point_index=e.readInt(),1==e.readBool()&&(t.mine_point_detail.base_info={},t.mine_point_detail.base_info.id=e.readInt(),t.mine_point_detail.base_info.nickname=e.readString(),t.mine_point_detail.base_info.level=e.readInt(),t.mine_point_detail.base_info.icon=e.readInt(),t.mine_point_detail.base_info.head_frame_id=e.readInt(),t.mine_point_detail.base_info.fight=e.readInt(),t.mine_point_detail.base_info.cd_time=e.readInt()),1==e.readBool()&&(t.mine_point_detail.formation={},t.mine_point_detail.formation.fid=e.readInt(),t.mine_point_detail.formation.formationId=e.readInt(),t.mine_point_detail.formation.forward=e.readInt(),t.mine_point_detail.formation.flip=e.readInt(),t.mine_point_detail.formation.a=e.readInt(),t.mine_point_detail.formation.b=e.readInt(),t.mine_point_detail.formation.c=e.readInt(),t.mine_point_detail.formation.d=e.readInt(),t.mine_point_detail.formation.e=e.readInt(),t.mine_point_detail.formation.f=e.readInt(),t.mine_point_detail.formation.g=e.readInt(),t.mine_point_detail.formation.h=e.readInt(),t.mine_point_detail.formation.i=e.readInt(),t.mine_point_detail.formation.j=e.readInt()),t.mine_point_detail.cards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.mine_point_detail.cards[n]={},t.mine_point_detail.cards[n].template_id=e.readInt(),t.mine_point_detail.cards[n].level=e.readInt(),t.mine_point_detail.cards[n].exp=e.readInt(),t.mine_point_detail.cards[n].grade=e.readInt(),t.mine_point_detail.cards[n].unitLevel=e.readInt(),t.mine_point_detail.cards[n].unitGrade=e.readInt(),t.mine_point_detail.cards[n].maxhp=e.readInt(),t.mine_point_detail.cards[n].atk=e.readInt(),t.mine_point_detail.cards[n].def=e.readInt(),t.mine_point_detail.cards[n].unitMaxhp=e.readInt(),t.mine_point_detail.cards[n].unitAtk=e.readInt(),t.mine_point_detail.cards[n].unitDef=e.readInt(),t.mine_point_detail.cards[n].unitNum=e.readInt(),t.mine_point_detail.cards[n].fight=e.readInt(),t.mine_point_detail.cards[n].extra_props=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.mine_point_detail.cards[n].extra_props[r]=e.readInt()}
t.mine_point_detail.exclude_cards=[];var s=e.readInt();if(0<s)
for(var o=0;o<s;o++)
t.mine_point_detail.exclude_cards[o]=e.readInt();t.mine_point_detail.rand_key=e.readLong()}
return t},send_C2SBlackMarketInfo:function(e){var t=h.alloc();t.writeInt(4401);var a=t.end();t.free(),e.sendMessage(a)},get_4402:function(e){var t={};t.refreshTimestamp=e.readInt(),t.refreshTimes=e.readInt(),t.items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.items[n]={},t.items[n].itemTemplateId=e.readInt(),t.items[n].num=e.readInt(),t.items[n].price=e.readInt(),t.items[n].is_buy=e.readBool();return t},send_C2SBlackMarketBuy:function(e,t){var a=h.alloc();a.writeInt(4403),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_4404:function(e){var t={};return t.slot_index=e.readInt(),1==e.readBool()&&(t.gain={},t.gain.item_template_id=e.readInt(),t.gain.item_count=e.readInt()),t},send_C2SBlackMarketRefresh:function(e){var t=h.alloc();t.writeInt(4405);var a=t.end();t.free(),e.sendMessage(a)},get_4406:function(e){return{}},send_C2SBossView:function(e,t){var a=h.alloc();a.writeInt(3351),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3352:function(e){var t={};t.level_index=e.readInt(),t.my_level_index=e.readInt(),t.my_rank=e.readInt(),t.my_damage_sum=e.readLong(),t.top_rank_list=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.top_rank_list[n]={},t.top_rank_list[n].playerId=e.readInt(),t.top_rank_list[n].nickname=e.readString(),t.top_rank_list[n].icon=e.readInt(),t.top_rank_list[n].head_frame=e.readInt(),t.top_rank_list[n].level=e.readInt(),t.top_rank_list[n].fight=e.readInt(),t.top_rank_list[n].vipLevel=e.readInt(),t.top_rank_list[n].damage_val=e.readLong();return t.boss_hp=e.readInt(),t.is_in_battle=e.readBool(),t.battle_cd_time=e.readInt(),t.attack_count=e.readInt(),t.damage_reward_get=e.readBool(),t.rank_reward_get=e.readBool(),t.is_buff=e.readBool(),t},send_C2SBossHurt:function(e,t,a){var n=h.alloc();n.writeInt(3353),n.writeInt(t),n.writeLong(a);var i=n.end();n.free(),e.sendMessage(i)},get_3354:function(e){var t={};return t.hurt_val=e.readInt(),t.boss_hp=e.readInt(),t},send_C2SBossGetAward:function(e,t){var a=h.alloc();a.writeInt(3355),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3356:function(e){var t={};t.type=e.readInt(),t.rewards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].itemId=e.readInt(),t.rewards[n].cnt=e.readInt();return t},send_C2SBossBattleStart:function(e,t){var a=h.alloc();a.writeInt(3357),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3358:function(e){var t={};return t.level_index=e.readInt(),t.r=e.readLong(),t},get_3360:function(e){var t={};return t.status=e.readInt(),t.level_index=e.readInt(),t.is_by_damage=e.readBool(),t},send_C2SBossGuwu:function(e,t){var a=h.alloc();a.writeInt(3361),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3362:function(e){return{}},send_C2SCardList:function(e){var t=h.alloc();t.writeInt(2001);var a=t.end();t.free(),e.sendMessage(a)},get_2002:function(e){var t={cards:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.cards[n]={},t.cards[n].id=e.readString(),t.cards[n].template_id=e.readInt(),t.cards[n].level=e.readInt(),t.cards[n].num=e.readInt(),t.cards[n].exp=e.readInt(),t.cards[n].grade=e.readInt(),t.cards[n].unit_level=e.readInt(),t.cards[n].unitGrade=e.readInt(),t.cards[n].equips=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.cards[n].equips[r]=e.readString();t.cards[n].unitEquips=[];var s=e.readInt();if(0<s)
for(var o=0;o<s;o++)
t.cards[n].unitEquips[o]=e.readInt();t.cards[n].fight=e.readInt(),t.cards[n].runeUnlock=[];var c=e.readInt();if(0<c)
for(var l=0;l<c;l++)
t.cards[n].runeUnlock[l]=e.readInt();t.cards[n].runePutup=[];var h=e.readInt();if(0<h)
for(var d=0;d<h;d++)
t.cards[n].runePutup[d]=e.readInt();t.cards[n].runeLevel=[];var _=e.readInt();if(0<_)
for(var u=0;u<_;u++)
t.cards[n].runeLevel[u]=e.readInt()}
return t},get_2004:function(e){var t={};if(1==e.readBool()){t.card_info={},t.card_info.id=e.readString(),t.card_info.template_id=e.readInt(),t.card_info.level=e.readInt(),t.card_info.num=e.readInt(),t.card_info.exp=e.readInt(),t.card_info.grade=e.readInt(),t.card_info.unit_level=e.readInt(),t.card_info.unitGrade=e.readInt(),t.card_info.equips=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.card_info.equips[n]=e.readString();t.card_info.unitEquips=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.card_info.unitEquips[r]=e.readInt();t.card_info.fight=e.readInt(),t.card_info.runeUnlock=[];var s=e.readInt();if(0<s)
for(var o=0;o<s;o++)
t.card_info.runeUnlock[o]=e.readInt();t.card_info.runePutup=[];var c=e.readInt();if(0<c)
for(var l=0;l<c;l++)
t.card_info.runePutup[l]=e.readInt();t.card_info.runeLevel=[];var h=e.readInt();if(0<h)
for(var d=0;d<h;d++)
t.card_info.runeLevel[d]=e.readInt()}
return t},send_C2SCardTakeOnItem:function(e,t,a){var n=h.alloc();n.writeInt(2005),n.writeInt(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},get_2006:function(e){var t={};return t.cardId=e.readInt(),t.item_uuid=e.readString(),t.fight=e.readInt(),t},send_C2SCardTakeOffItem:function(e,t,a){var n=h.alloc();n.writeInt(2007),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_2008:function(e){var t={};return t.cardId=e.readInt(),t.position=e.readInt(),t.item_uuid=e.readString(),t.fight=e.readInt(),t},send_C2SCardAddLevel:function(e,t,a,n){var i=h.alloc();i.writeInt(2009),i.writeInt(t),null==a?i.writeInt(0):(i.writeInt(a.length),a.forEach(function(e){i.writeInt(e.template_id),i.writeInt(e.count)})),null==n?i.writeInt(0):(i.writeInt(n.length),n.forEach(function(e){i.writeInt(e.template_id),i.writeInt(e.count)}));var r=i.end();i.free(),e.sendMessage(r)},get_2010:function(e){var t={};return t.card_id=e.readInt(),t.level=e.readInt(),t.level_exp=e.readInt(),t},send_C2SCardAddStar:function(e,t){var a=h.alloc();a.writeInt(2011),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_2012:function(e){var t={};return t.card_id=e.readInt(),t.new_star=e.readInt(),t.fight=e.readInt(),t.num=e.readInt(),t},send_C2SCardTrain:function(e,t){var a=h.alloc();a.writeInt(2013),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_2014:function(e){var t={};return t.card_id=e.readInt(),t.itemNum=e.readInt(),t.unit_level=e.readInt(),t.fight=e.readInt(),t},send_C2SCardAutoTrain:function(e,t){var a=h.alloc();a.writeInt(2015),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_2016:function(e){var t={};return t.card_id=e.readInt(),t.itemNum=e.readInt(),t.unit_level=e.readInt(),t.fight=e.readInt(),t},send_C2SCardUpgradeUnit:function(e,t){var a=h.alloc();a.writeInt(2017),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_2018:function(e){var t={};return t.card_id=e.readInt(),t.unit_grade=e.readInt(),t.fight=e.readInt(),t},send_C2SCardCompose:function(e,t){var a=h.alloc();a.writeInt(2019),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_2020:function(e){return{}},send_C2SCardEquipUnit:function(e,t,a){var n=h.alloc();n.writeInt(2021),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_2022:function(e){var t={};return t.card_id=e.readInt(),t.unit_position=e.readInt(),t.fight=e.readInt(),t},get_2024:function(e){var t={};return t.card_id=e.readInt(),t.level=e.readInt(),t.level_exp=e.readInt(),t.new_fight=e.readInt(),t},send_C2SRuneUnlock:function(e,t,a){var n=h.alloc();n.writeInt(2025),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_2026:function(e){var t={};return t.card_id=e.readInt(),t.pos_index=e.readInt(),t},send_C2SRunePutup:function(e,t,a,n){var i=h.alloc();i.writeInt(2027),i.writeInt(t),i.writeInt(a),i.writeInt(n);var r=i.end();i.free(),e.sendMessage(r)},get_2028:function(e){var t={};t.card_id=e.readInt(),t.pos_index=e.readInt(),t.rune_id=e.readInt(),t.rune_level=e.readInt(),t.back_items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.back_items[n]={},t.back_items[n].template_id=e.readInt(),t.back_items[n].count=e.readInt();return t.fight=e.readInt(),t},send_C2SItemBuy:function(e,t,a){var n=h.alloc();n.writeInt(2029),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_2030:function(e){var t={};return t.template_id=e.readInt(),t.cur_size=e.readInt(),t},send_C2SRuneCombine:function(e,t,a,n){var i=h.alloc();i.writeInt(2031),i.writeInt(t),null==a?i.writeInt(0):(i.writeInt(a.length),a.forEach(function(e){i.writeInt(e.template_id),i.writeInt(e.count)})),null==n?i.writeInt(0):(i.writeInt(n.length),n.forEach(function(e){i.writeInt(e.template_id),i.writeInt(e.count)}));var r=i.end();i.free(),e.sendMessage(r)},get_2032:function(e){var t={};t.is_success=e.readBool(),t.new_rune_id=e.readInt(),t.back_items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.back_items[n]={},t.back_items[n].template_id=e.readInt(),t.back_items[n].count=e.readInt();return t.success_rate=e.readInt(),t},send_C2SRuneLevelup:function(e,t,a,n){var i=h.alloc();i.writeInt(2033),i.writeInt(t),i.writeInt(a),null==n?i.writeInt(0):(i.writeInt(n.length),n.forEach(function(e){i.writeInt(e.template_id),i.writeInt(e.count)}));var r=i.end();i.free(),e.sendMessage(r)},get_2034:function(e){var t={};return t.card_id=e.readInt(),t.rune_pos_index=e.readInt(),t.rune_level=e.readInt(),t.fight=e.readInt(),t},send_C2SChat:function(e,t,a,n){var i=h.alloc();i.writeInt(10401),i.writeInt(t),i.writeInt(a),i.writeString(n);var r=i.end();i.free(),e.sendMessage(r)},get_10402:function(e){return{}},get_10404:function(e){var t={};return t.sender_uid=e.readInt(),t.sender_name=e.readString(),t.icon=e.readInt(),t.head_frame_id=e.readInt(),t.level=e.readInt(),t.vip_level=e.readInt(),t.office_index=e.readInt(),t.content=e.readString(),t.chat_type=e.readInt(),t.timestamp=e.readInt(),t.receiver_name=e.readString(),t},send_C2SChatView:function(e,t){var a=h.alloc();a.writeInt(10405),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10406:function(e){var t={};t.chat_type=e.readInt(),t.chat_content=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.chat_content[n]={},t.chat_content[n].sender_uid=e.readInt(),t.chat_content[n].sender_name=e.readString(),t.chat_content[n].icon=e.readInt(),t.chat_content[n].head_frame_id=e.readInt(),t.chat_content[n].level=e.readInt(),t.chat_content[n].vip_level=e.readInt(),t.chat_content[n].office_index=e.readInt(),t.chat_content[n].content=e.readString(),t.chat_content[n].chat_type=e.readInt(),t.chat_content[n].timestamp=e.readInt(),t.chat_content[n].receiver_name=e.readString();t.new_msg_list=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.new_msg_list[n]=e.readBool();return t},send_C2SChatVisit:function(e){var t=h.alloc();t.writeInt(10407);var a=t.end();t.free(),e.sendMessage(a)},get_10408:function(e){return{}},send_C2SDailyMissionList:function(e){var t=h.alloc();t.writeInt(3401);var a=t.end();t.free(),e.sendMessage(a)},get_3402:function(e){var t={missions:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.missions[n]={},t.missions[n].mission_tpl_id=e.readInt(),t.missions[n].progress=e.readInt();return t},send_C2SDailyMissionGetAward:function(e,t){var a=h.alloc();a.writeInt(3403),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3404:function(e){var t={};return t.mission_tpl_id=e.readInt(),t},get_3406:function(e){var t={};return t.mission_tpl_id=e.readInt(),t.progress=e.readInt(),t},send_C2SDailyMissionGetAwardAll:function(e){var t=h.alloc();t.writeInt(3407);var a=t.end();t.free(),e.sendMessage(a)},get_3408:function(e){var t={attachs:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.attachs[n]={},t.attachs[n].itemId=e.readInt(),t.attachs[n].cnt=e.readInt();return t},send_C2SForge:function(e,t,a,n){var i=h.alloc();i.writeInt(4601),null==t?i.writeInt(0):(i.writeInt(t.length),t.forEach(function(e){i.writeInt(e.cardTemplateId),i.writeString(e.treasure_uuid),i.writeInt(e.count)})),null==a?i.writeInt(0):(i.writeInt(a.length),a.forEach(function(e){i.writeInt(e.cardTemplateId),i.writeString(e.treasure_uuid),i.writeInt(e.count)})),null==n?i.writeInt(0):(i.writeInt(n.length),n.forEach(function(e){i.writeInt(e.cardTemplateId),i.writeString(e.treasure_uuid),i.writeInt(e.count)}));var r=i.end();i.free(),e.sendMessage(r)},get_4602:function(e){var t={gain:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain[n]={},t.gain[n].item_template_id=e.readInt(),t.gain[n].item_count=e.readInt();return t},send_C2SEquipCompose:function(e,t,a){var n=h.alloc();n.writeInt(4603),null==t?n.writeInt(0):(n.writeInt(t.length),t.forEach(function(e){n.writeString(e)})),n.writeBool(a);var i=n.end();n.free(),e.sendMessage(i)},get_4604:function(e){var t={};1==e.readBool()&&(t.gain={},t.gain.item_template_id=e.readInt(),t.gain.item_count=e.readInt()),t.gainGameMoney=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gainGameMoney[n]=e.readInt();t.costItems=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.costItems[n]=e.readString();t.keepItems=[];var r=e.readInt();if(0<r)
for(n=0;n<r;n++)
t.keepItems[n]=e.readString();return t.guideReq=e.readBool(),t},send_C2SRuneSuccessRate:function(e){var t=h.alloc();t.writeInt(4605);var a=t.end();t.free(),e.sendMessage(a)},get_4606:function(e){var t={};return t.success_rate=e.readInt(),t},send_C2SGuozhanView:function(e){var t=h.alloc();t.writeInt(3451);var a=t.end();t.free(),e.sendMessage(a)},get_3452:function(e){var t={pass_city_index:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.pass_city_index[n]=e.readInt();return t.player_city_index=e.readInt(),t.my_nation=e.readInt(),t.change_nation_cd=e.readInt(),t.my_office=e.readInt(),t},send_C2SGuozhanBattleStart:function(e,t){var a=h.alloc();a.writeInt(3453),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3454:function(e){var t={};t.city_index=e.readInt(),t.ret=e.readInt(),t.r=e.readLong(),t.enemy_level=e.readInt(),1==e.readBool()&&(t.formation={},t.formation.fid=e.readInt(),t.formation.formationId=e.readInt(),t.formation.forward=e.readInt(),t.formation.flip=e.readInt(),t.formation.a=e.readInt(),t.formation.b=e.readInt(),t.formation.c=e.readInt(),t.formation.d=e.readInt(),t.formation.e=e.readInt(),t.formation.f=e.readInt(),t.formation.g=e.readInt(),t.formation.h=e.readInt(),t.formation.i=e.readInt(),t.formation.j=e.readInt()),t.cards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.cards[n]={},t.cards[n].template_id=e.readInt(),t.cards[n].level=e.readInt(),t.cards[n].exp=e.readInt(),t.cards[n].grade=e.readInt(),t.cards[n].unitLevel=e.readInt(),t.cards[n].unitGrade=e.readInt(),t.cards[n].maxhp=e.readInt(),t.cards[n].atk=e.readInt(),t.cards[n].def=e.readInt(),t.cards[n].unitMaxhp=e.readInt(),t.cards[n].unitAtk=e.readInt(),t.cards[n].unitDef=e.readInt(),t.cards[n].unitNum=e.readInt(),t.cards[n].fight=e.readInt(),t.cards[n].extra_props=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.cards[n].extra_props[r]=e.readInt()}
return t},send_C2SGuozhanBattleEnd:function(e,t,a,n){var i=h.alloc();i.writeInt(3455),i.writeInt(t),i.writeInt(a),i.writeLong(n);var r=i.end();i.free(),e.sendMessage(r)},get_3456:function(e){var t={};t.city_index=e.readInt(),t.ret=e.readInt(),t.rewards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].itemId=e.readInt(),t.rewards[n].cnt=e.readInt();return t},send_C2SGuozhanMove:function(e,t){var a=h.alloc();a.writeInt(3457),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3458:function(e){var t={};return t.city_index=e.readInt(),t},send_C2SGuozhanChangeNation:function(e,t){var a=h.alloc();a.writeInt(3459),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3460:function(e){var t={};return t.old_nation=e.readInt(),t.target_nation=e.readInt(),t.change_nation_cd=e.readInt(),t},send_C2SGuozhanOfficeView:function(e){var t=h.alloc();t.writeInt(3461);var a=t.end();t.free(),e.sendMessage(a)},get_3462:function(e){var t={player_list:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.player_list[n]={},t.player_list[n].office_index=e.readInt(),t.player_list[n].id=e.readInt(),t.player_list[n].nickname=e.readString(),t.player_list[n].level=e.readInt(),t.player_list[n].icon=e.readInt(),t.player_list[n].head_frame_id=e.readInt(),t.player_list[n].fight=e.readInt(),t.player_list[n].hp_perc=e.readInt();return t},send_C2SGuozhanOfficeDetail:function(e,t){var a=h.alloc();a.writeInt(3463),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3464:function(e){var t={};t.office_index=e.readInt(),1==e.readBool()&&(t.base_info={},t.base_info.office_index=e.readInt(),t.base_info.id=e.readInt(),t.base_info.nickname=e.readString(),t.base_info.level=e.readInt(),t.base_info.icon=e.readInt(),t.base_info.head_frame_id=e.readInt(),t.base_info.fight=e.readInt(),t.base_info.hp_perc=e.readInt()),1==e.readBool()&&(t.formation={},t.formation.fid=e.readInt(),t.formation.formationId=e.readInt(),t.formation.forward=e.readInt(),t.formation.flip=e.readInt(),t.formation.a=e.readInt(),t.formation.b=e.readInt(),t.formation.c=e.readInt(),t.formation.d=e.readInt(),t.formation.e=e.readInt(),t.formation.f=e.readInt(),t.formation.g=e.readInt(),t.formation.h=e.readInt(),t.formation.i=e.readInt(),t.formation.j=e.readInt()),t.cards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.cards[n]={},t.cards[n].template_id=e.readInt(),t.cards[n].level=e.readInt(),t.cards[n].exp=e.readInt(),t.cards[n].grade=e.readInt(),t.cards[n].unitLevel=e.readInt(),t.cards[n].unitGrade=e.readInt(),t.cards[n].maxhp=e.readInt(),t.cards[n].atk=e.readInt(),t.cards[n].def=e.readInt(),t.cards[n].unitMaxhp=e.readInt(),t.cards[n].unitAtk=e.readInt(),t.cards[n].unitDef=e.readInt(),t.cards[n].unitNum=e.readInt(),t.cards[n].fight=e.readInt(),t.cards[n].extra_props=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.cards[n].extra_props[r]=e.readInt()}
return t},send_C2SGuozhanOfficeStart:function(e,t){var a=h.alloc();a.writeInt(3465),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3466:function(e){var t={};return t.office_index=e.readInt(),t.rand_key=e.readLong(),t},send_C2SGuozhanOfficCalculate:function(e,t,a,n){var i=h.alloc();i.writeInt(3467),i.writeInt(t),i.writeInt(a),i.writeLong(n);var r=i.end();i.free(),e.sendMessage(r)},get_3468:function(e){var t={};t.office_index=e.readInt(),t.ret=e.readInt(),t.rewards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].itemId=e.readInt(),t.rewards[n].cnt=e.readInt();t.player_list=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.player_list[n]={},t.player_list[n].office_index=e.readInt(),t.player_list[n].id=e.readInt(),t.player_list[n].nickname=e.readString(),t.player_list[n].level=e.readInt(),t.player_list[n].icon=e.readInt(),t.player_list[n].head_frame_id=e.readInt(),t.player_list[n].fight=e.readInt(),t.player_list[n].hp_perc=e.readInt();return t},send_C2SGuozhanFightView:function(e){var t=h.alloc();t.writeInt(3471);var a=t.end();t.free(),e.sendMessage(a)},get_3472:function(e){var t={city_list:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.city_list[n]={},t.city_list[n].player_name=e.readString(),t.city_list[n].player_size=e.readInt(),t.city_list[n].nation_id=e.readInt(),t.city_list[n].in_battle=e.readBool();t.my_city_index=e.readInt(),t.move_step=e.readInt(),t.nation_city_count=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.nation_city_count[n]=e.readInt();return t.hp_perc=e.readInt(),t.my_nation=e.readInt(),t.change_nation_cd=e.readInt(),t.my_office=e.readInt(),t},send_C2SGuoZhanCityDetail:function(e,t){var a=h.alloc();a.writeInt(3473),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3474:function(e){var t={};t.city_index=e.readInt(),t.players=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.players[n]={},t.players[n].office_index=e.readInt(),t.players[n].id=e.readInt(),t.players[n].nickname=e.readString(),t.players[n].level=e.readInt(),t.players[n].icon=e.readInt(),t.players[n].head_frame_id=e.readInt(),t.players[n].fight=e.readInt(),t.players[n].hp_perc=e.readInt();return t},send_C2SGuoZhanCityMove:function(e,t){var a=h.alloc();a.writeInt(3475),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3476:function(e){var t={};t.city_index=e.readInt(),t.ret=e.readInt(),t.r=e.readLong(),t.move_step=e.readInt(),t.players=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.players[n]={},1==e.readBool()&&(t.players[n].base_info={},t.players[n].base_info.office_index=e.readInt(),t.players[n].base_info.id=e.readInt(),t.players[n].base_info.nickname=e.readString(),t.players[n].base_info.level=e.readInt(),t.players[n].base_info.icon=e.readInt(),t.players[n].base_info.head_frame_id=e.readInt(),t.players[n].base_info.fight=e.readInt(),t.players[n].base_info.hp_perc=e.readInt()),1==e.readBool()&&(t.players[n].formation={},t.players[n].formation.fid=e.readInt(),t.players[n].formation.formationId=e.readInt(),t.players[n].formation.forward=e.readInt(),t.players[n].formation.flip=e.readInt(),t.players[n].formation.a=e.readInt(),t.players[n].formation.b=e.readInt(),t.players[n].formation.c=e.readInt(),t.players[n].formation.d=e.readInt(),t.players[n].formation.e=e.readInt(),t.players[n].formation.f=e.readInt(),t.players[n].formation.g=e.readInt(),t.players[n].formation.h=e.readInt(),t.players[n].formation.i=e.readInt(),t.players[n].formation.j=e.readInt()),t.players[n].cards=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++){t.players[n].cards[r]={},t.players[n].cards[r].template_id=e.readInt(),t.players[n].cards[r].level=e.readInt(),t.players[n].cards[r].exp=e.readInt(),t.players[n].cards[r].grade=e.readInt(),t.players[n].cards[r].unitLevel=e.readInt(),t.players[n].cards[r].unitGrade=e.readInt(),t.players[n].cards[r].maxhp=e.readInt(),t.players[n].cards[r].atk=e.readInt(),t.players[n].cards[r].def=e.readInt(),t.players[n].cards[r].unitMaxhp=e.readInt(),t.players[n].cards[r].unitAtk=e.readInt(),t.players[n].cards[r].unitDef=e.readInt(),t.players[n].cards[r].unitNum=e.readInt(),t.players[n].cards[r].fight=e.readInt(),t.players[n].cards[r].extra_props=[];var s=e.readInt();if(0<s)
for(var o=0;o<s;o++)
t.players[n].cards[r].extra_props[o]=e.readInt()}}
return t},send_C2SGuozhanCityCalculate:function(e,t,a,n){var i=h.alloc();i.writeInt(3477),i.writeInt(t),null==a?i.writeInt(0):(i.writeInt(a.length),a.forEach(function(e){i.writeInt(e)})),i.writeLong(n);var r=i.end();i.free(),e.sendMessage(r)},get_3478:function(e){var t={};t.city_index=e.readInt(),t.ret=e.readInt(),t.rewards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].itemId=e.readInt(),t.rewards[n].cnt=e.readInt();return t.move_step=e.readInt(),t},get_3480:function(e){var t={};return t.nation_id=e.readInt(),t},send_C2SGuozhanHistory:function(e){var t=h.alloc();t.writeInt(3481);var a=t.end();t.free(),e.sendMessage(a)},get_3482:function(e){var t={records:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.records[n]={},t.records[n].action_type=e.readInt(),t.records[n].target_player_name=e.readString(),t.records[n].params=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.records[n].params[r]=e.readInt();t.records[n].add_time=e.readInt()}
return t},send_C2SGmCmd:function(e,t){var a=h.alloc();a.writeInt(101),a.writeString(t);var n=a.end();a.free(),e.sendMessage(n)},get_102:function(e){var t={};return t.ret_code=e.readInt(),t},get_10000:function(e){var t={};return t.ret_code=e.readInt(),t},send_C2SQueryHasRole:function(e,t,a){var n=h.alloc();n.writeInt(10101),n.writeString(t),null==a?n.writeBool(!1):(n.writeBool(!0),n.writeInt(a.wanba_gift_id),n.writeString(a.appid),n.writeString(a.openid),n.writeString(a.openkey),n.writeString(a.pf));var i=n.end();n.free(),e.sendMessage(i)},get_10102:function(e){var t={};return t.has_role=e.readBool(),t.qq_nickname=e.readString(),t},send_C2SCreateCharacter:function(e,t,a,n){var i=h.alloc();i.writeInt(10103),i.writeInt(t),i.writeString(a),i.writeString(n);var r=i.end();i.free(),e.sendMessage(r)},get_10104:function(e){var t={};return t.ret=e.readInt(),t.character_id=e.readInt(),t},send_C2SEnterGame:function(e,t,a){var n=h.alloc();n.writeInt(10105),n.writeString(t),null==a?n.writeBool(!1):(n.writeBool(!0),n.writeInt(a.wanba_gift_id),n.writeString(a.appid),n.writeString(a.openid),n.writeString(a.openkey),n.writeString(a.pf));var i=n.end();n.free(),e.sendMessage(i)},get_10106:function(e){var t={};return t.current_time_seconds=e.readInt(),t.in_game_session_id=e.readString(),t.has_qcjj_activity=e.readBool(),t.has_qzyb_activity=e.readBool(),t},get_10108:function(e){var t={};t.id=e.readInt(),t.account_id=e.readString(),t.server_id=e.readInt(),t.name=e.readString(),t.sex=e.readInt(),t.level=e.readInt(),t.icon=e.readInt(),t.head_frame=e.readInt(),t.level_exp=e.readInt(),t.fight=e.readInt(),t.money=e.readInt(),t.gameMoney=e.readInt(),t.energy=e.readInt(),t.vip_level=e.readInt(),t.vip_exp=e.readInt(),t.honor=e.readInt(),t.stamina=e.readInt(),t.nation_id=e.readInt(),t.formationSlots=e.readInt(),t.formationStatus=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.formationStatus[n]=e.readInt();t.team_skills=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.team_skills[n]=e.readInt();t.offline_minutes=e.readInt(),t.offline_add_level=e.readInt(),t.offline_rewards=[];var r=e.readInt();if(0<r)
for(n=0;n<r;n++)
t.offline_rewards[n]={},t.offline_rewards[n].itemId=e.readInt(),t.offline_rewards[n].cnt=e.readInt();return 1==e.readBool()&&(t.wanba_gift_ret={},t.wanba_gift_ret.wanba_gift_id=e.readInt(),t.wanba_gift_ret.status=e.readInt()),t},get_10114:function(e){return{}},get_10116:function(e){var t={};return t.type=e.readInt(),t.value=e.readInt(),t},get_10118:function(e){var t={guideInfo:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.guideInfo[n]={},t.guideInfo[n].module=e.readInt(),t.guideInfo[n].step=e.readInt();return t},send_C2SGuideStepSet:function(e,t,a){var n=h.alloc();n.writeInt(10119),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_10120:function(e){return{}},get_10122:function(e){var t={};t.is_first_pay=e.readBool(),t.first_award_get=e.readBool(),t.payment_level=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.payment_level[n]=e.readInt();t.vip_gift_get=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.vip_gift_get[n]=e.readInt();return t.is_long_yueka=e.readBool(),t.long_yueka_get=e.readBool(),t.yueka_left_day=e.readInt(),t.yueka_get=e.readBool(),t},send_C2SGetFirstPayAward:function(e){var t=h.alloc();t.writeInt(10123);var a=t.end();t.free(),e.sendMessage(a)},get_10124:function(e){return{}},send_C2SGetVipGift:function(e,t){var a=h.alloc();a.writeInt(10125),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10126:function(e){var t={};return t.vip_level=e.readInt(),t},send_C2SDownlineReconnect:function(e,t){var a=h.alloc();a.writeInt(10127),a.writeString(t);var n=a.end();a.free(),e.sendMessage(n)},get_10128:function(e){var t={};return t.ret=e.readInt(),t},send_C2SListRedPoints:function(e){var t=h.alloc();t.writeInt(10129);var a=t.end();t.free(),e.sendMessage(a)},get_10130:function(e){var t={has_redpoint:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.has_redpoint[n]=e.readInt();t.activity_redpoints=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.activity_redpoints[n]=e.readInt();return t},send_C2SQunheiPayPre:function(e,t,a){var n=h.alloc();n.writeInt(10131),n.writeInt(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},get_10132:function(e){var t={};return t.charge_index=e.readInt(),t.ext=e.readString(),t.sign=e.readString(),t.goodsName=e.readString(),t.rmb=e.readInt(),t},get_10134:function(e){var t={};return t.type=e.readInt(),t.yuanbao=e.readInt(),t.product_id=e.readInt(),t},get_10136:function(e){return{}},send_C2SGetYuekaAward:function(e,t){var a=h.alloc();a.writeInt(10137),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10138:function(e){var t={};return t.type=e.readInt(),t.yuanbao=e.readInt(),t},send_C2SGetQunheiWxShareAward:function(e){var t=h.alloc();t.writeInt(10139);var a=t.end();t.free(),e.sendMessage(a)},get_10140:function(e){var t={rewards:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].itemId=e.readInt(),t.rewards[n].cnt=e.readInt();return t},get_10142:function(e){var t={};t.template_id=e.readInt(),t.order=e.readInt(),t.parameters=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.parameters[n]=e.readString();return t.content=e.readString(),t.count=e.readInt(),t},send_C2SRankView:function(e,t){var a=h.alloc();a.writeInt(10143),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10144:function(e){var t={};t.my_rank=e.readInt(),t.my_rank_change=e.readInt(),t.rank_type=e.readInt(),t.items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.items[n]={},t.items[n].playerId=e.readInt(),t.items[n].nickname=e.readString(),t.items[n].sexId=e.readInt(),t.items[n].icon=e.readInt(),t.items[n].head_frame=e.readInt(),t.items[n].level=e.readInt(),t.items[n].fight=e.readInt(),t.items[n].vipLevel=e.readInt(),t.items[n].rank_change=e.readInt(),t.items[n].hero_count=e.readInt(),t.items[n].hero_stars=e.readInt(),t.items[n].win_count=e.readInt(),t.items[n].like_count=e.readInt();t.today_my_like_players=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.today_my_like_players[n]=e.readInt();t.pkWinLoose=[];var r=e.readInt();if(0<r)
for(n=0;n<r;n++)
t.pkWinLoose[n]=e.readInt();return t},send_C2SRankPlayerDetail:function(e,t,a){var n=h.alloc();n.writeInt(10145),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_10146:function(e){var t={};t.rank_type=e.readInt(),1==e.readBool()&&(t.rank_player={},t.rank_player.playerId=e.readInt(),t.rank_player.nickname=e.readString(),t.rank_player.sexId=e.readInt(),t.rank_player.icon=e.readInt(),t.rank_player.head_frame=e.readInt(),t.rank_player.level=e.readInt(),t.rank_player.fight=e.readInt(),t.rank_player.vipLevel=e.readInt(),t.rank_player.rank_change=e.readInt(),t.rank_player.hero_count=e.readInt(),t.rank_player.hero_stars=e.readInt(),t.rank_player.win_count=e.readInt(),t.rank_player.like_count=e.readInt()),t.cardlist=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.cardlist[n]={},t.cardlist[n].template_id=e.readInt(),t.cardlist[n].level=e.readInt(),t.cardlist[n].exp=e.readInt(),t.cardlist[n].grade=e.readInt(),t.cardlist[n].unitLevel=e.readInt(),t.cardlist[n].unitGrade=e.readInt(),t.cardlist[n].maxhp=e.readInt(),t.cardlist[n].atk=e.readInt(),t.cardlist[n].def=e.readInt(),t.cardlist[n].unitMaxhp=e.readInt(),t.cardlist[n].unitAtk=e.readInt(),t.cardlist[n].unitDef=e.readInt(),t.cardlist[n].unitNum=e.readInt(),t.cardlist[n].fight=e.readInt(),t.cardlist[n].equips=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.cardlist[n].equips[r]=e.readInt();t.cardlist[n].runes=[];var s=e.readInt();if(0<s)
for(var o=0;o<s;o++)
t.cardlist[n].runes[o]=e.readInt()}
t.pkWinLoose=[];var c=e.readInt();if(0<c)
for(n=0;n<c;n++)
t.pkWinLoose[n]=e.readInt();return t},send_C2SZMPayCheck:function(e,t,a){var n=h.alloc();n.writeInt(10147),n.writeInt(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},get_10148:function(e){var t={};return t.fee_id=e.readString(),t.check=e.readString(),t.extradata=e.readString(),t.goodsName=e.readString(),t.rmb=e.readInt(),t},send_C2SOfflineAwardDouble:function(e){var t=h.alloc();t.writeInt(10149);var a=t.end();t.free(),e.sendMessage(a)},get_10150:function(e){var t={};return t.add_level=e.readInt(),t},send_C2S333PayPre:function(e,t,a,n){var i=h.alloc();i.writeInt(10151),i.writeInt(t),i.writeString(a),i.writeInt(n);var r=i.end();i.free(),e.sendMessage(r)},get_10152:function(e){var t={};return t.time=e.readInt(),t.server=e.readString(),t.role=e.readString(),t.goodsId=e.readString(),t.goodsName=e.readString(),t.money=e.readInt(),t.cpOrderId=e.readString(),t.sign=e.readString(),t},send_C2SChongChongPayPre:function(e,t,a){var n=h.alloc();n.writeInt(10153),n.writeInt(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},get_10154:function(e){var t={};return t.goodsId=e.readInt(),t.egretOrderId=e.readString(),t.money=e.readInt(),t.ext=e.readString(),t.goodsName=e.readString(),t},send_C2S4399PayPre:function(e,t,a){var n=h.alloc();n.writeInt(10155),n.writeInt(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},get_10156:function(e){var t={};return t.goodsId=e.readInt(),t.rmb=e.readInt(),t.cpOrderId=e.readString(),t.extra=e.readString(),t.goodsName=e.readString(),t},send_C2SRankLike:function(e,t){var a=h.alloc();a.writeInt(10157),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10158:function(e){var t={};t.targetPlayerId=e.readInt(),t.likeCount=e.readInt(),t.rewards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].itemId=e.readInt(),t.rewards[n].cnt=e.readInt();return t},get_10160:function(e){var t={};return t.colorType=e.readInt(),t.content=e.readString(),t},send_C2SWanBaGetBalance:function(e,t,a,n,i,r,s,o){var c=h.alloc();c.writeInt(10161),c.writeString(t),c.writeString(a),c.writeString(n),c.writeString(i),c.writeInt(r),c.writeInt(s),c.writeString(o);var l=c.end();c.free(),e.sendMessage(l)},get_10162:function(e){var t={};return t.is_balance_enough=e.readBool(),t.defaultScore=e.readInt(),t.itemid=e.readInt(),t.cpOrderId=e.readString(),t.goodsName=e.readString(),t},send_C2SWanBaPay:function(e,t,a,n,i,r,s){var o=h.alloc();o.writeInt(10163),o.writeString(t),o.writeString(a),o.writeString(n),o.writeString(i),o.writeInt(r),o.writeInt(s);var c=o.end();o.free(),e.sendMessage(c)},send_C2SAddDesktopShortcutAward:function(e){var t=h.alloc();t.writeInt(10165);var a=t.end();t.free(),e.sendMessage(a)},get_10166:function(e){var t={rewards:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].itemId=e.readInt(),t.rewards[n].cnt=e.readInt();return t},send_C2SChangeName:function(e,t){var a=h.alloc();a.writeInt(10167),a.writeString(t);var n=a.end();a.free(),e.sendMessage(n)},get_10168:function(e){var t={};return t.name=e.readString(),t},send_C2SChangeIcon:function(e,t){var a=h.alloc();a.writeInt(10169),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10170:function(e){var t={};return t.iconId=e.readInt(),t},send_C2SListHeadFrame:function(e){var t=h.alloc();t.writeInt(10171);var a=t.end();t.free(),e.sendMessage(a)},get_10172:function(e){var t={frags_count:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.frags_count[n]=e.readInt();return t},send_C2SChangeHeadFrame:function(e,t){var a=h.alloc();a.writeInt(10173),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10174:function(e){var t={};return t.head_frame_id=e.readInt(),t},send_C2SIosIAPVerify:function(e,t){var a=h.alloc();a.writeInt(10175),a.writeString(t);var n=a.end();a.free(),e.sendMessage(n)},get_10176:function(e){return{}},get_10178:function(e){var t={};return t.ret=e.readInt(),t},send_C2SQedjList:function(e){var t=h.alloc();t.writeInt(10179);var a=t.end();t.free(),e.sendMessage(a)},get_10180:function(e){var t={};t.is_award_get=e.readBool(),t.rewards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].itemId=e.readInt(),t.rewards[n].cnt=e.readInt();return t},send_C2SQedjAward:function(e){var t=h.alloc();t.writeInt(10181);var a=t.end();t.free(),e.sendMessage(a)},get_10182:function(e){var t={rewards:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].itemId=e.readInt(),t.rewards[n].cnt=e.readInt();return t},send_C2SGetProtoVersion:function(e,t){var a=h.alloc();a.writeInt(10007),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10008:function(e){var t={};return t.hasNewVersion=e.readBool(),t.newLoginHost=e.readString(),t.newLoginPort=e.readInt(),t},send_C2SLogin:function(e,t,a){var n=h.alloc();n.writeInt(10013),n.writeString(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},get_10014:function(e){var t={};return t.uid=e.readInt(),t.session_id=e.readString(),t},send_C2SServerList:function(e){var t=h.alloc();t.writeInt(10005);var a=t.end();t.free(),e.sendMessage(a)},get_10006:function(e){var t={items:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.items[n]={},t.items[n].id=e.readInt(),t.items[n].name=e.readString(),t.items[n].ip_addr=e.readString(),t.items[n].port=e.readInt(),t.items[n].status=e.readInt(),t.items[n].port_nossl=e.readInt();return t},send_C2SGetAnnounce:function(e){var t=h.alloc();t.writeInt(10027);var a=t.end();t.free(),e.sendMessage(a)},get_10028:function(e){var t={};return t.content=e.readString(),t},send_C2SSelectServer:function(e,t){var a=h.alloc();a.writeInt(10019),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10020:function(e){var t={};return t.ret=e.readInt(),t},send_C2SGuestLogin:function(e,t){var a=h.alloc();a.writeInt(10015),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_10016:function(e){var t={};return t.uid=e.readInt(),t.session_id=e.readString(),t},send_C2SOpenLogin:function(e,t,a,n){var i=h.alloc();i.writeInt(10017),i.writeString(t),i.writeString(a),i.writeInt(n);var r=i.end();i.free(),e.sendMessage(r)},get_10018:function(e){var t={};return t.open_id=e.readString(),t.session_id=e.readString(),t.platform_type=e.readInt(),t},send_C2SQunheiLogin:function(e,t,a,n,i,r){var s=h.alloc();s.writeInt(10031),s.writeString(t),s.writeInt(a),s.writeInt(n),s.writeInt(i),s.writeString(r);var o=s.end();s.free(),e.sendMessage(o)},get_10032:function(e){var t={};return t.session_id=e.readString(),t},send_C2SWanbaLogin:function(e,t,a,n,i,r){var s=h.alloc();s.writeInt(10033),s.writeString(t),s.writeString(a),s.writeString(n),s.writeInt(i),s.writeString(r);var o=s.end();s.free(),e.sendMessage(o)},send_C2SZhangMengLogin:function(e,t,a,n){var i=h.alloc();i.writeInt(10035),i.writeString(t),i.writeString(a),i.writeString(n);var r=i.end();i.free(),e.sendMessage(r)},send_C2SThree33Login:function(e,t,a,n,i,r){var s=h.alloc();s.writeInt(10037),s.writeInt(t),s.writeInt(a),s.writeInt(n),s.writeString(i),s.writeString(r);var o=s.end();s.free(),e.sendMessage(o)},send_C2SChongChongLogin:function(e,t,a,n){var i=h.alloc();i.writeInt(10039),i.writeString(t),i.writeString(a),i.writeString(n);var r=i.end();i.free(),e.sendMessage(r)},send_C2S4399Login:function(e,t,a,n,i,r){var s=h.alloc();s.writeInt(10041),s.writeInt(t),s.writeInt(a),s.writeString(n),s.writeString(i),s.writeString(r);var o=s.end();s.free(),e.sendMessage(o)},send_C2SYiJieLogin:function(e,t,a,n,i){var r=h.alloc();r.writeInt(10043),r.writeString(t),r.writeString(a),r.writeString(n),r.writeString(i);var s=r.end();r.free(),e.sendMessage(s)},send_C2SgNetTopLogin:function(e,t,a){var n=h.alloc();n.writeInt(10045),n.writeString(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},send_C2SYunbeeLogin:function(e,t,a){var n=h.alloc();n.writeInt(10047),n.writeString(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},send_C2SLiuyeLogin1:function(e,t,a){var n=h.alloc();n.writeInt(10049),n.writeString(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},send_C2SLiuyeLogin2:function(e,t,a){var n=h.alloc();n.writeInt(10051),n.writeString(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},send_C2SPingPingLogin:function(e,t,a,n,i){var r=h.alloc();r.writeInt(10053),r.writeString(t),r.writeString(a),r.writeString(n),r.writeString(i);var s=r.end();r.free(),e.sendMessage(s)},send_C2SXingTengLogin:function(e,t,a,n){var i=h.alloc();i.writeInt(10055),i.writeString(t),i.writeString(a),i.writeString(n);var r=i.end();i.free(),e.sendMessage(r)},send_C2SXingTengLogin2:function(e,t,a,n,i){var r=h.alloc();r.writeInt(10057),r.writeString(t),r.writeString(a),r.writeString(n),r.writeString(i);var s=r.end();r.free(),e.sendMessage(s)},send_C2SChuangFuLogin:function(e,t,a,n,i){var r=h.alloc();r.writeInt(10059),r.writeString(t),r.writeString(a),r.writeString(n),r.writeString(i);var s=r.end();r.free(),e.sendMessage(s)},send_C2SQuLeLeLogin:function(e,t,a,n){var i=h.alloc();i.writeInt(10061),i.writeString(t),i.writeString(a),i.writeString(n);var r=i.end();i.free(),e.sendMessage(r)},send_C2SMiaoRenLogin:function(e,t,a,n){var i=h.alloc();i.writeInt(10063),i.writeString(t),i.writeString(a),i.writeString(n);var r=i.end();i.free(),e.sendMessage(r)},send_C2SBaoFengLogin:function(e,t,a,n,i){var r=h.alloc();r.writeInt(10065),r.writeString(t),r.writeString(a),r.writeString(n),r.writeString(i);var s=r.end();r.free(),e.sendMessage(s)},send_C2S185syLogin:function(e,t,a){var n=h.alloc();n.writeInt(10067),n.writeString(t),n.writeString(a);var i=n.end();n.free(),e.sendMessage(i)},send_C2SListMail:function(e,t){var a=h.alloc();a.writeInt(40001),null==t?a.writeInt(0):(a.writeInt(t.length),t.forEach(function(e){a.writeInt(e)}));var n=a.end();a.free(),e.sendMessage(n)},get_40002:function(e){var t={mailInfoList:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.mailInfoList[n]={},t.mailInfoList[n].mail_id=e.readInt(),t.mailInfoList[n].mail_type=e.readInt(),t.mailInfoList[n].template_id=e.readInt(),t.mailInfoList[n].send_name=e.readString(),t.mailInfoList[n].title=e.readString(),t.mailInfoList[n].content=e.readString(),t.mailInfoList[n].attach=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.mailInfoList[n].attach[r]={},t.mailInfoList[n].attach[r].itemId=e.readInt(),t.mailInfoList[n].attach[r].cnt=e.readInt();t.mailInfoList[n].create_time=e.readInt(),t.mailInfoList[n].is_read=e.readInt(),t.mailInfoList[n].mailParamMsg=[];var s=e.readInt();if(0<s)
for(var o=0;o<s;o++)
t.mailInfoList[n].mailParamMsg[o]={},t.mailInfoList[n].mailParamMsg[o].type=e.readInt(),t.mailInfoList[n].mailParamMsg[o].value=e.readString()}
return t},send_C2SGetAttach:function(e,t){var a=h.alloc();a.writeInt(40003),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_40004:function(e){var t={};return t.mail_id=e.readInt(),t.is_del=e.readInt(),t},send_C2SReadNewMailMsg:function(e,t){var a=h.alloc();a.writeInt(40005),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_40006:function(e){var t={};return t.mail_id=e.readInt(),t.is_del=e.readInt(),t},send_C2SDelMail:function(e,t){var a=h.alloc();a.writeInt(40009),null==t?a.writeInt(0):(a.writeInt(t.length),t.forEach(function(e){a.writeInt(e)}));var n=a.end();a.free(),e.sendMessage(n)},get_40010:function(e){var t={mail_id:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.mail_id[n]=e.readInt();return t},get_40012:function(e){var t={};if(1==e.readBool()){t.mail_info={},t.mail_info.mail_id=e.readInt(),t.mail_info.mail_type=e.readInt(),t.mail_info.template_id=e.readInt(),t.mail_info.send_name=e.readString(),t.mail_info.title=e.readString(),t.mail_info.content=e.readString(),t.mail_info.attach=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.mail_info.attach[n]={},t.mail_info.attach[n].itemId=e.readInt(),t.mail_info.attach[n].cnt=e.readInt();t.mail_info.create_time=e.readInt(),t.mail_info.is_read=e.readInt(),t.mail_info.mailParamMsg=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.mail_info.mailParamMsg[r]={},t.mail_info.mailParamMsg[r].type=e.readInt(),t.mail_info.mailParamMsg[r].value=e.readString()}
return t},send_C2SGetAttachAll:function(e){var t=h.alloc();t.writeInt(40013);var a=t.end();t.free(),e.sendMessage(a)},get_40014:function(e){var t={attachs:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.attachs[n]={},t.attachs[n].itemId=e.readInt(),t.attachs[n].cnt=e.readInt();return t},send_C2SMissionList:function(e){var t=h.alloc();t.writeInt(2201);var a=t.end();t.free(),e.sendMessage(a)},get_2202:function(e){var t={missions:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.missions[n]={},t.missions[n].missionId=e.readInt(),t.missions[n].progress=e.readInt();return t},send_C2SMissionGetAward:function(e,t){var a=h.alloc();a.writeInt(2203),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_2204:function(e){var t={};return t.missionId=e.readInt(),t.nextMissionId=e.readInt(),t.nextProgress=e.readInt(),t},get_2206:function(e){var t={};return t.missionId=e.readInt(),t.progress=e.readInt(),t},send_C2SMissionGetAwardAll:function(e){var t=h.alloc();t.writeInt(2207);var a=t.end();t.free(),e.sendMessage(a)},get_2208:function(e){var t={attachs:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.attachs[n]={},t.attachs[n].itemId=e.readInt(),t.attachs[n].cnt=e.readInt();return t},send_C2SOvercomeInfoAll:function(e,t){var a=h.alloc();a.writeInt(5001),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_5002:function(e){var t={};t.stage_index=e.readInt(),t.haveReward=e.readBool(),t.todayResets=e.readInt(),t.heroHpData=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.heroHpData[n]={},t.heroHpData[n].heroId=e.readInt(),t.heroHpData[n].hp=e.readInt(),t.heroHpData[n].unitNum=e.readInt();t.enemyHpData=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.enemyHpData[n]={},t.enemyHpData[n].heroId=e.readInt(),t.enemyHpData[n].hp=e.readInt(),t.enemyHpData[n].unitNum=e.readInt();if(1==e.readBool()){t.current_enemy={},t.current_enemy.sexId=e.readInt(),t.current_enemy.playerId=e.readInt(),t.current_enemy.level=e.readInt(),t.current_enemy.rank=e.readInt(),t.current_enemy.fight=e.readInt(),t.current_enemy.nickname=e.readString(),1==e.readBool()&&(t.current_enemy.formation={},t.current_enemy.formation.fid=e.readInt(),t.current_enemy.formation.formationId=e.readInt(),t.current_enemy.formation.forward=e.readInt(),t.current_enemy.formation.flip=e.readInt(),t.current_enemy.formation.a=e.readInt(),t.current_enemy.formation.b=e.readInt(),t.current_enemy.formation.c=e.readInt(),t.current_enemy.formation.d=e.readInt(),t.current_enemy.formation.e=e.readInt(),t.current_enemy.formation.f=e.readInt(),t.current_enemy.formation.g=e.readInt(),t.current_enemy.formation.h=e.readInt(),t.current_enemy.formation.i=e.readInt(),t.current_enemy.formation.j=e.readInt()),t.current_enemy.cards=[];var r=e.readInt();if(0<r)
for(var s=0;s<r;s++)
t.current_enemy.cards[s]={},t.current_enemy.cards[s].template_id=e.readInt(),t.current_enemy.cards[s].level=e.readInt(),t.current_enemy.cards[s].exp=e.readInt(),t.current_enemy.cards[s].grade=e.readInt(),t.current_enemy.cards[s].unitLevel=e.readInt(),t.current_enemy.cards[s].unitGrade=e.readInt(),t.current_enemy.cards[s].maxhp=e.readInt(),t.current_enemy.cards[s].atk=e.readInt(),t.current_enemy.cards[s].def=e.readInt(),t.current_enemy.cards[s].unitMaxhp=e.readInt(),t.current_enemy.cards[s].unitAtk=e.readInt(),t.current_enemy.cards[s].unitDef=e.readInt(),t.current_enemy.cards[s].unitNum=e.readInt(),t.current_enemy.cards[s].fight=e.readInt()}
return t.rand_key=e.readLong(),t},send_C2SUserOvercomePassStage:function(e,t,a,n){var i=h.alloc();i.writeInt(5005),i.writeBool(t),null==a?i.writeInt(0):(i.writeInt(a.length),a.forEach(function(e){i.writeInt(e.heroId),i.writeInt(e.hp),i.writeInt(e.unitNum)})),i.writeLong(n);var r=i.end();i.free(),e.sendMessage(r)},get_5006:function(e){var t={};t.is_win=e.readBool(),t.heroHpData=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.heroHpData[n]={},t.heroHpData[n].heroId=e.readInt(),t.heroHpData[n].hp=e.readInt(),t.heroHpData[n].unitNum=e.readInt();return t.rand_key=e.readLong(),t},send_C2SOvercomeClaimReward:function(e,t){var a=h.alloc();a.writeInt(5007),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_5008:function(e){var t={gain:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain[n]={},t.gain[n].item_template_id=e.readInt(),t.gain[n].item_count=e.readInt();if(1==e.readBool()){t.current_enemy={},t.current_enemy.sexId=e.readInt(),t.current_enemy.playerId=e.readInt(),t.current_enemy.level=e.readInt(),t.current_enemy.rank=e.readInt(),t.current_enemy.fight=e.readInt(),t.current_enemy.nickname=e.readString(),1==e.readBool()&&(t.current_enemy.formation={},t.current_enemy.formation.fid=e.readInt(),t.current_enemy.formation.formationId=e.readInt(),t.current_enemy.formation.forward=e.readInt(),t.current_enemy.formation.flip=e.readInt(),t.current_enemy.formation.a=e.readInt(),t.current_enemy.formation.b=e.readInt(),t.current_enemy.formation.c=e.readInt(),t.current_enemy.formation.d=e.readInt(),t.current_enemy.formation.e=e.readInt(),t.current_enemy.formation.f=e.readInt(),t.current_enemy.formation.g=e.readInt(),t.current_enemy.formation.h=e.readInt(),t.current_enemy.formation.i=e.readInt(),t.current_enemy.formation.j=e.readInt()),t.current_enemy.cards=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.current_enemy.cards[r]={},t.current_enemy.cards[r].template_id=e.readInt(),t.current_enemy.cards[r].level=e.readInt(),t.current_enemy.cards[r].exp=e.readInt(),t.current_enemy.cards[r].grade=e.readInt(),t.current_enemy.cards[r].unitLevel=e.readInt(),t.current_enemy.cards[r].unitGrade=e.readInt(),t.current_enemy.cards[r].maxhp=e.readInt(),t.current_enemy.cards[r].atk=e.readInt(),t.current_enemy.cards[r].def=e.readInt(),t.current_enemy.cards[r].unitMaxhp=e.readInt(),t.current_enemy.cards[r].unitAtk=e.readInt(),t.current_enemy.cards[r].unitDef=e.readInt(),t.current_enemy.cards[r].unitNum=e.readInt(),t.current_enemy.cards[r].fight=e.readInt()}
return t},send_C2SOvercomeReset:function(e,t){var a=h.alloc();a.writeInt(5009),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_5010:function(e){var t={};if(t.todayResets=e.readInt(),1==e.readBool()){t.current_enemy={},t.current_enemy.sexId=e.readInt(),t.current_enemy.playerId=e.readInt(),t.current_enemy.level=e.readInt(),t.current_enemy.rank=e.readInt(),t.current_enemy.fight=e.readInt(),t.current_enemy.nickname=e.readString(),1==e.readBool()&&(t.current_enemy.formation={},t.current_enemy.formation.fid=e.readInt(),t.current_enemy.formation.formationId=e.readInt(),t.current_enemy.formation.forward=e.readInt(),t.current_enemy.formation.flip=e.readInt(),t.current_enemy.formation.a=e.readInt(),t.current_enemy.formation.b=e.readInt(),t.current_enemy.formation.c=e.readInt(),t.current_enemy.formation.d=e.readInt(),t.current_enemy.formation.e=e.readInt(),t.current_enemy.formation.f=e.readInt(),t.current_enemy.formation.g=e.readInt(),t.current_enemy.formation.h=e.readInt(),t.current_enemy.formation.i=e.readInt(),t.current_enemy.formation.j=e.readInt()),t.current_enemy.cards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.current_enemy.cards[n]={},t.current_enemy.cards[n].template_id=e.readInt(),t.current_enemy.cards[n].level=e.readInt(),t.current_enemy.cards[n].exp=e.readInt(),t.current_enemy.cards[n].grade=e.readInt(),t.current_enemy.cards[n].unitLevel=e.readInt(),t.current_enemy.cards[n].unitGrade=e.readInt(),t.current_enemy.cards[n].maxhp=e.readInt(),t.current_enemy.cards[n].atk=e.readInt(),t.current_enemy.cards[n].def=e.readInt(),t.current_enemy.cards[n].unitMaxhp=e.readInt(),t.current_enemy.cards[n].unitAtk=e.readInt(),t.current_enemy.cards[n].unitDef=e.readInt(),t.current_enemy.cards[n].unitNum=e.readInt(),t.current_enemy.cards[n].fight=e.readInt()}
return t},send_C2SOvercomeItemList:function(e){var t=h.alloc();t.writeInt(5011);var a=t.end();t.free(),e.sendMessage(a)},get_5012:function(e){var t={};t.refreshTimes=e.readInt(),t.itemsList=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.itemsList[n]={},t.itemsList[n].exchangeIndex=e.readInt(),t.itemsList[n].itemId=e.readInt(),t.itemsList[n].num=e.readInt(),t.itemsList[n].cost=e.readInt(),t.itemsList[n].times=e.readInt();return t},send_C2SOvercomeExchangeListRefresh:function(e){var t=h.alloc();t.writeInt(5013);var a=t.end();t.free(),e.sendMessage(a)},get_5014:function(e){var t={};t.refreshTimes=e.readInt(),t.itemsList=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.itemsList[n]={},t.itemsList[n].exchangeIndex=e.readInt(),t.itemsList[n].itemId=e.readInt(),t.itemsList[n].num=e.readInt(),t.itemsList[n].cost=e.readInt(),t.itemsList[n].times=e.readInt();return t},send_C2SOvercomeExchange:function(e,t){var a=h.alloc();a.writeInt(5015),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_5016:function(e){var t={};return t.exchange_index=e.readInt(),1==e.readBool()&&(t.gain={},t.gain.item_template_id=e.readInt(),t.gain.item_count=e.readInt()),t},send_C2SPaymentGetInfo:function(e){var t=h.alloc();t.writeInt(4201);var a=t.end();t.free(),e.sendMessage(a)},get_4202:function(e){var t={};return t.gamemoneyTimes=e.readInt(),t.energyTimes=e.readInt(),t},send_C2SPaymentBuyMoney:function(e){var t=h.alloc();t.writeInt(4203);var a=t.end();t.free(),e.sendMessage(a)},get_4204:function(e){var t={};return t.add_gamemoney=e.readInt(),t.multiple=e.readInt(),t.gamemoneyTimes=e.readInt(),t},send_C2SPaymentBuyEnergy:function(e){var t=h.alloc();t.writeInt(4205);var a=t.end();t.free(),e.sendMessage(a)},get_4206:function(e){var t={};return t.current_energy=e.readInt(),t.energyTimes=e.readInt(),t.prevEnergyTime=e.readInt(),t},send_C2SSecretView:function(e){var t=h.alloc();t.writeInt(3301);var a=t.end();t.free(),e.sendMessage(a)},get_3302:function(e){var t={};t.map_id=e.readInt(),t.progress=e.readInt(),t.could_reset=e.readBool(),t.boxAward=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.boxAward[n]={},t.boxAward[n].stage_index=e.readInt(),t.boxAward[n].award_list=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.boxAward[n].award_list[r]={},t.boxAward[n].award_list[r].itemId=e.readInt(),t.boxAward[n].award_list[r].cnt=e.readInt();t.boxAward[n].is_get=e.readInt()}
t.my_cost=[];var s=e.readInt();if(0<s)
for(n=0;n<s;n++)
t.my_cost[n]={},t.my_cost[n].hero_type=e.readInt(),t.my_cost[n].hero_id=e.readInt(),t.my_cost[n].hp_percent=e.readInt();t.enemy_cost=[];var o=e.readInt();if(0<o)
for(n=0;n<o;n++)
t.enemy_cost[n]={},t.enemy_cost[n].hero_type=e.readInt(),t.enemy_cost[n].hero_id=e.readInt(),t.enemy_cost[n].hp_percent=e.readInt();t.online_formation=[];var c=e.readInt();if(0<c)
for(n=0;n<c;n++)
t.online_formation[n]={},t.online_formation[n].hero_type=e.readInt(),t.online_formation[n].hero_id=e.readInt(),t.online_formation[n].hp_percent=e.readInt();return t.revive_count=e.readInt(),t},send_C2SSecretBattleStart:function(e,t,a){var n=h.alloc();n.writeInt(3303),n.writeInt(t),null==a?n.writeInt(0):(n.writeInt(a.length),a.forEach(function(e){n.writeInt(e.hero_type),n.writeInt(e.hero_id),n.writeInt(e.hp_percent)}));var i=n.end();n.free(),e.sendMessage(i)},get_3304:function(e){var t={};t.map_id=e.readInt(),t.online_formation=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.online_formation[n]={},t.online_formation[n].hero_type=e.readInt(),t.online_formation[n].hero_id=e.readInt(),t.online_formation[n].hp_percent=e.readInt();return t.is_reset=e.readInt(),t},send_C2SSecretBattleEnd:function(e,t,a,n,i){var r=h.alloc();r.writeInt(3305),r.writeBool(t),null==a?r.writeInt(0):(r.writeInt(a.length),a.forEach(function(e){r.writeInt(e.hero_type),r.writeInt(e.hero_id),r.writeInt(e.hp_percent)})),null==n?r.writeInt(0):(r.writeInt(n.length),n.forEach(function(e){r.writeInt(e.hero_type),r.writeInt(e.hero_id),r.writeInt(e.hp_percent)})),r.writeBool(i);var s=r.end();r.free(),e.sendMessage(s)},get_3306:function(e){var t={};t.is_win=e.readBool(),t.reward_items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.reward_items[n]={},t.reward_items[n].itemId=e.readInt(),t.reward_items[n].cnt=e.readInt();t.is_interrupt=e.readBool(),t.map_id=e.readInt(),t.progress=e.readInt(),t.boxAward=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++){t.boxAward[n]={},t.boxAward[n].stage_index=e.readInt(),t.boxAward[n].award_list=[];var r=e.readInt();if(0<r)
for(var s=0;s<r;s++)
t.boxAward[n].award_list[s]={},t.boxAward[n].award_list[s].itemId=e.readInt(),t.boxAward[n].award_list[s].cnt=e.readInt();t.boxAward[n].is_get=e.readInt()}
t.my_cost=[];var o=e.readInt();if(0<o)
for(n=0;n<o;n++)
t.my_cost[n]={},t.my_cost[n].hero_type=e.readInt(),t.my_cost[n].hero_id=e.readInt(),t.my_cost[n].hp_percent=e.readInt();t.enemy_cost=[];var c=e.readInt();if(0<c)
for(n=0;n<c;n++)
t.enemy_cost[n]={},t.enemy_cost[n].hero_type=e.readInt(),t.enemy_cost[n].hero_id=e.readInt(),t.enemy_cost[n].hp_percent=e.readInt();t.online_formation=[];var l=e.readInt();if(0<l)
for(n=0;n<l;n++)
t.online_formation[n]={},t.online_formation[n].hero_type=e.readInt(),t.online_formation[n].hero_id=e.readInt(),t.online_formation[n].hp_percent=e.readInt();return t},send_C2SSecretGetAward:function(e,t){var a=h.alloc();a.writeInt(3307),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3308:function(e){var t={};t.stage_index=e.readInt(),t.reward_items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.reward_items[n]={},t.reward_items[n].itemId=e.readInt(),t.reward_items[n].cnt=e.readInt();return t},send_C2SSecretSoldierRevive:function(e,t){var a=h.alloc();a.writeInt(3309),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3310:function(e){var t={};return t.hero_id=e.readInt(),t},send_C2SSecretReset:function(e){var t=h.alloc();t.writeInt(3311);var a=t.end();t.free(),e.sendMessage(a)},get_3312:function(e){return{}},send_C2SPubView:function(e){var t=h.alloc();t.writeInt(1041);var a=t.end();t.free(),e.sendMessage(a)},get_1042:function(e){var t={};return t.free_time2=e.readInt(),t.purple_times=e.readInt(),t},send_C2SPubBuy:function(e,t){var a=h.alloc();a.writeInt(1043),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_1044:function(e){var t={};t.cost_type=e.readInt(),t.free_time2=e.readInt(),t.purple_times=e.readInt(),t.cards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.cards[n]={},t.cards[n].id=e.readString(),t.cards[n].template_id=e.readInt(),t.cards[n].level=e.readInt(),t.cards[n].num=e.readInt(),t.cards[n].exp=e.readInt(),t.cards[n].grade=e.readInt(),t.cards[n].unit_level=e.readInt(),t.cards[n].unitGrade=e.readInt(),t.cards[n].equip1=e.readString(),t.cards[n].equip2=e.readString(),t.cards[n].equip3=e.readString(),t.cards[n].equip4=e.readString(),t.cards[n].equip5=e.readString(),t.cards[n].equip6=e.readString(),t.cards[n].unitEquips=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.cards[n].unitEquips[r]=e.readInt()}
return t},send_C2SMallList:function(e){var t=h.alloc();t.writeInt(1045);var a=t.end();t.free(),e.sendMessage(a)},get_1046:function(e){var t={items:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.items[n]={},t.items[n].slot_index=e.readInt(),t.items[n].buyNum=e.readInt();t.packs=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.packs[n]=e.readInt();return t},send_C2SArmyShopItemList:function(e){var t=h.alloc();t.writeInt(1047);var a=t.end();t.free(),e.sendMessage(a)},get_1048:function(e){var t={};t.refreshTimestamp=e.readInt(),t.freeTimes=e.readInt(),t.feeRefreshTimes=e.readInt(),t.items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.items[n]={},t.items[n].itemTemplateId=e.readInt(),t.items[n].num=e.readInt(),t.items[n].gamemoney=e.readInt(),t.items[n].money=e.readInt(),t.items[n].times=e.readInt();return t},send_C2SArmyShopBuy:function(e,t){var a=h.alloc();a.writeInt(1049),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_1050:function(e){var t={};t.slot_index=e.readInt(),t.gain_items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain_items[n]={},t.gain_items[n].itemTemplateId=e.readInt(),t.gain_items[n].num=e.readInt();return t},send_C2SArmyShopRefresh:function(e){var t=h.alloc();t.writeInt(1051);var a=t.end();t.free(),e.sendMessage(a)},get_1052:function(e){return{}},send_C2SVipPackBuy:function(e,t){var a=h.alloc();a.writeInt(1053),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_1054:function(e){var t={};t.vip_level=e.readInt(),t.gain_items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain_items[n]={},t.gain_items[n].itemTemplateId=e.readInt(),t.gain_items[n].num=e.readInt();return t},send_C2SMallBuy:function(e,t,a){var n=h.alloc();n.writeInt(1055),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_1056:function(e){var t={};t.slot_index=e.readInt(),1==e.readBool()&&(t.item_info={},t.item_info.slot_index=e.readInt(),t.item_info.buyNum=e.readInt()),t.gain_items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.gain_items[n]={},t.gain_items[n].itemTemplateId=e.readInt(),t.gain_items[n].num=e.readInt();return t},send_C2SStageList:function(e){var t=h.alloc();t.writeInt(3001);var a=t.end();t.free(),e.sendMessage(a)},get_3002:function(e){var t={chapters:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.chapters[n]={},t.chapters[n].stages=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.chapters[n].stages[r]={},t.chapters[n].stages[r].star=e.readInt(),t.chapters[n].stages[r].times=e.readInt(),t.chapters[n].stages[r].is_get_award=e.readBool();t.chapters[n].star_award=[];var s=e.readInt();if(0<s)
for(var o=0;o<s;o++)
t.chapters[n].star_award[o]=e.readBool()}
t.chapters_elite=[];var c=e.readInt();if(0<c)
for(n=0;n<c;n++){t.chapters_elite[n]={},t.chapters_elite[n].stages=[];var l=e.readInt();if(0<l)
for(r=0;r<l;r++)
t.chapters_elite[n].stages[r]={},t.chapters_elite[n].stages[r].star=e.readInt(),t.chapters_elite[n].stages[r].times=e.readInt(),t.chapters_elite[n].stages[r].is_get_award=e.readBool();t.chapters_elite[n].star_award=[];var h=e.readInt();if(0<h)
for(o=0;o<h;o++)
t.chapters_elite[n].star_award[o]=e.readBool()}
return 1==e.readBool()&&(t.formation={},t.formation.fid=e.readInt(),t.formation.formationId=e.readInt(),t.formation.forward=e.readInt(),t.formation.flip=e.readInt(),t.formation.a=e.readInt(),t.formation.b=e.readInt(),t.formation.c=e.readInt(),t.formation.d=e.readInt(),t.formation.e=e.readInt(),t.formation.f=e.readInt(),t.formation.g=e.readInt(),t.formation.h=e.readInt(),t.formation.i=e.readInt(),t.formation.j=e.readInt()),t.elite_count=e.readInt(),t.crawl_state=e.readInt(),t},send_C2SStageEnd:function(e,t,a,n,i,r,s){var o=h.alloc();o.writeInt(3003),o.writeInt(t),o.writeInt(a),o.writeBool(n),o.writeInt(i),o.writeInt(r),o.writeInt(s);var c=o.end();o.free(),e.sendMessage(c)},get_3004:function(e){var t={};t.group_index=e.readInt(),t.stage_index=e.readInt(),t.is_win=e.readBool(),t.star=e.readInt(),t.times=e.readInt(),t.rewards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].template_id=e.readInt(),t.rewards[n].num=e.readInt();return t},send_C2SBattleFormationSave:function(e,t){var a=h.alloc();a.writeInt(3005),null==t?a.writeBool(!1):(a.writeBool(!0),a.writeInt(t.fid),a.writeInt(t.formationId),a.writeInt(t.forward),a.writeInt(t.flip),a.writeInt(t.a),a.writeInt(t.b),a.writeInt(t.c),a.writeInt(t.d),a.writeInt(t.e),a.writeInt(t.f),a.writeInt(t.g),a.writeInt(t.h),a.writeInt(t.i),a.writeInt(t.j));var n=a.end();a.free(),e.sendMessage(n)},get_3006:function(e){var t={};return 1==e.readBool()&&(t.formation={},t.formation.fid=e.readInt(),t.formation.formationId=e.readInt(),t.formation.forward=e.readInt(),t.formation.flip=e.readInt(),t.formation.a=e.readInt(),t.formation.b=e.readInt(),t.formation.c=e.readInt(),t.formation.d=e.readInt(),t.formation.e=e.readInt(),t.formation.f=e.readInt(),t.formation.g=e.readInt(),t.formation.h=e.readInt(),t.formation.i=e.readInt(),t.formation.j=e.readInt()),t},send_C2SBoxAwardGet:function(e,t,a){var n=h.alloc();n.writeInt(3007),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_3008:function(e){var t={};return t.group_index=e.readInt(),t.box_index=e.readInt(),t},send_C2SEliteStageEnd:function(e,t,a,n,i,r,s){var o=h.alloc();o.writeInt(3009),o.writeInt(t),o.writeInt(a),o.writeBool(n),o.writeInt(i),o.writeInt(r),o.writeInt(s);var c=o.end();o.free(),e.sendMessage(c)},get_3010:function(e){var t={};t.group_index=e.readInt(),t.stage_index=e.readInt(),t.is_win=e.readBool(),t.star=e.readInt(),t.rewards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.rewards[n]={},t.rewards[n].template_id=e.readInt(),t.rewards[n].num=e.readInt();return t},send_C2SEliteBoxAwardGet:function(e,t,a){var n=h.alloc();n.writeInt(3011),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_3012:function(e){var t={};return t.group_index=e.readInt(),t.box_index=e.readInt(),t},send_C2SElitePointAwardGet:function(e,t,a){var n=h.alloc();n.writeInt(3013),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_3014:function(e){var t={};return t.group_index=e.readInt(),t.stage_index=e.readInt(),t},send_C2SSweepStage:function(e,t,a,n,i){var r=h.alloc();r.writeInt(3015),r.writeInt(t),r.writeInt(a),r.writeInt(n),r.writeInt(i);var s=r.end();r.free(),e.sendMessage(s)},get_3016:function(e){var t={};t.group_index=e.readInt(),t.stage_index=e.readInt(),t.times=e.readInt(),t.result=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++){t.result[n]={},t.result[n].sweep1=[];var i=e.readInt();if(0<i)
for(var r=0;r<i;r++)
t.result[n].sweep1[r]={},t.result[n].sweep1[r].template_id=e.readInt(),t.result[n].sweep1[r].num=e.readInt()}
return t},send_C2SSaveCrawl:function(e,t){var a=h.alloc();a.writeInt(3017),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3018:function(e){return{}},send_C2STeamSkillList:function(e){var t=h.alloc();t.writeInt(3201);var a=t.end();t.free(),e.sendMessage(a)},get_3202:function(e){var t={skill_level:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.skill_level[n]=e.readInt();return t.points=e.readInt(),t},send_C2STeamSkillUpgrade:function(e,t){var a=h.alloc();a.writeInt(3203),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_3204:function(e){var t={};t.skill_index=e.readInt(),t.skill_level=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.skill_level[n]=e.readInt();return t.points=e.readInt(),t},get_3206:function(e){var t={};return t.unlock_index=e.readInt(),t},send_C2STreasureRobList:function(e,t,a,n){var i=h.alloc();i.writeInt(4801),i.writeInt(t),i.writeBool(a),i.writeInt(n);var r=i.end();i.free(),e.sendMessage(r)},get_4802:function(e){var t={enemys:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.enemys[n]={},t.enemys[n].sexId=e.readInt(),t.enemys[n].rank=e.readInt(),t.enemys[n].playerId=e.readInt(),t.enemys[n].level=e.readInt(),t.enemys[n].fight=e.readInt(),t.enemys[n].nickname=e.readString(),t.enemys[n].prob=e.readInt();return t.guideReq=e.readBool(),t},send_C2STreasureRobEnemyDetail:function(e,t,a){var n=h.alloc();n.writeInt(4803),n.writeInt(t),n.writeBool(a);var i=n.end();n.free(),e.sendMessage(i)},get_4804:function(e){var t={};t.sexId=e.readInt(),t.playerId=e.readInt(),t.level=e.readInt(),t.rank=e.readInt(),t.fight=e.readInt(),t.nickname=e.readString(),1==e.readBool()&&(t.formation={},t.formation.fid=e.readInt(),t.formation.formationId=e.readInt(),t.formation.forward=e.readInt(),t.formation.flip=e.readInt(),t.formation.a=e.readInt(),t.formation.b=e.readInt(),t.formation.c=e.readInt(),t.formation.d=e.readInt(),t.formation.e=e.readInt(),t.formation.f=e.readInt(),t.formation.g=e.readInt(),t.formation.h=e.readInt(),t.formation.i=e.readInt(),t.formation.j=e.readInt()),t.cards=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.cards[n]={},t.cards[n].template_id=e.readInt(),t.cards[n].level=e.readInt(),t.cards[n].exp=e.readInt(),t.cards[n].grade=e.readInt(),t.cards[n].unitLevel=e.readInt(),t.cards[n].unitGrade=e.readInt(),t.cards[n].maxhp=e.readInt(),t.cards[n].atk=e.readInt(),t.cards[n].def=e.readInt(),t.cards[n].unitMaxhp=e.readInt(),t.cards[n].unitAtk=e.readInt(),t.cards[n].unitDef=e.readInt(),t.cards[n].unitNum=e.readInt(),t.cards[n].fight=e.readInt();return t.guideReq=e.readBool(),t},send_C2STreasureRobCalculate:function(e,t,a,n,i){var r=h.alloc();r.writeInt(4805),r.writeInt(t),r.writeInt(a),r.writeBool(n),r.writeLong(i);var s=r.end();r.free(),e.sendMessage(s)},get_4806:function(e){var t={};t.result=e.readInt(),t.achieveGameMoney=e.readInt(),t.achieveExp=e.readInt(),t.frags=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.frags[n]={},t.frags[n].item_template_id=e.readInt(),t.frags[n].item_count=e.readInt();t.items=[];var i=e.readInt();if(0<i)
for(n=0;n<i;n++)
t.items[n]={},t.items[n].item_template_id=e.readInt(),t.items[n].item_count=e.readInt();t.achieveFragsNum=e.readInt(),t.dirtyItems=[];var r=e.readInt();if(0<r)
for(n=0;n<r;n++)
t.dirtyItems[n]={},t.dirtyItems[n].item_template_id=e.readInt(),t.dirtyItems[n].item_count=e.readInt();return t.guideReq=e.readBool(),t.rand_key=e.readLong(),t},send_C2STreasureAvoidRob:function(e,t){var a=h.alloc();a.writeInt(4807),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_4808:function(e){var t={};return t.timeStamp=e.readInt(),t},send_C2STreasureAvoidRobTime:function(e){var t=h.alloc();t.writeInt(4809);var a=t.end();t.free(),e.sendMessage(a)},get_4810:function(e){var t={};return t.timeStamp=e.readInt(),t},send_C2STreasureRobBattleStart:function(e,t){var a=h.alloc();a.writeInt(4811),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_4812:function(e){var t={};return t.result=e.readInt(),t.rand_key=e.readLong(),t},send_C2STreasureAutoRob:function(e,t,a){var n=h.alloc();n.writeInt(4813),n.writeInt(t),n.writeInt(a);var i=n.end();n.free(),e.sendMessage(i)},get_4814:function(e){var t={};t.result=e.readInt(),t.status=e.readInt(),t.items=[];var a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.items[n]={},t.items[n].item_template_id=e.readInt(),t.items[n].item_count=e.readInt();return t},send_C2STreasureRobReport:function(e){var t=h.alloc();t.writeInt(4815);var a=t.end();t.free(),e.sendMessage(a)},get_4816:function(e){var t={reports:[]},a=e.readInt();if(0<a)
for(var n=0;n<a;n++)
t.reports[n]={},t.reports[n].enemy=e.readInt(),t.reports[n].nickname=e.readString(),t.reports[n].fight=e.readInt(),t.reports[n].templateId=e.readInt(),t.reports[n].time=e.readInt(),t.reports[n].canRob=e.readBool();return t},send_C2STreasureRobGrab:function(e,t){var a=h.alloc();a.writeInt(4817),a.writeInt(t);var n=a.end();a.free(),e.sendMessage(n)},get_4818:function(e){var t={};return t.result=e.readInt(),t}};t.exports=n,cc._RF.pop()},{WsEncoder:"WsEncoder"}],MyUIEvent:[function(e,t,a){"use strict";cc._RF.push(t,"5a3d6/sCI9AuqQ5EUdTSfsL","MyUIEvent");var n=function(){};n.SetRedPoint="SetRedPoint",n.onCooperChange="onCooperChange",n.onGoldChange="onGoldChange",n.onVipLevelChange="onVipLevelChange",n.onVipExpChange="onVipExpChange",n.onNameChange="onNameChange",n.onIconChange="onIconChange",n.onHeadFrameChange="onHeadFrameChange",n.RefreshHeroUpgrade="RefreshHeroUpgrade",n.SnatchRefreshView="SnatchRefreshView",n.onChargeInfo="onChargeInfo",n.onDayMissionChange="onDayMissionChange",n.redPointsRefresh="redPointsRefresh",n.ActivityProgressUpdate="ActivityProgressUpdate",n.onHeroIconSelect="onHeroIconSelect",n.onHeadFrameSelect="onHeadFrameSelect",n.onRuneUnlockItemSelect="onRuneUnlockItemSelect",n.onNetRuneUnlock="onNetRuneUnlock",n.onAniHammerFinish="onAniHammerFinish",n.onRuneItemSelect="onRuneItemSelect",n.onRuneItemBagSelect="onRuneItemBagSelect",n.onRuneTabSelect="onRuneTabSelect",n.initRuneTabSelect="initRuneTabSelect",n.onRuneRemove="onRuneRemove",n.onRuneInlay="onRuneInlay",n.onRuneOilSelect="onRuneOilSelect",n.onOilUseChange="onOilUseChange",n.onRuneBagItemSizeChange="onRuneBagItemSizeChange",n.onRuneBagItemSizeChange1="onRuneBagItemSizeChange1",n.onMinePointDetailChange="onMinePointDetailChange",n.onHeroBoxSelect="onHeroBoxSelect",n.onHeroBoxUnSelect="onHeroBoxUnSelect",n.onJumpBattleFormation="onJumpBattleFormation",n.onBossRewardGet="onBossRewardGet",n.onUiInstancePrefab="onUiInstancePrefab",n.onGuozhanMove="onGuozhanMove",n.S2CTreasureEnhance="S2CTreasureEnhance",n.onJumpHeroShow="onJumpHeroShow",n.OpenLoginXingTeng="OpenLoginXingTeng",n.OpenLoginPingPing="OpenLoginPingPing",n.onGuoZhanNationChange="onGuoZhanNationChange",n.YiJieLoginSuccessJsbCallback="YiJieLoginSuccessJsbCallback",n.OpenLoginSuccessJsbCallback="OpenLoginSuccessJsbCallback",t.exports=n,cc._RF.pop()},{}],NPCFightCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"07ac07pQixMbIvpoKNS80BQ","NPCFightCfgMgr");var c=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},g=e("HeroConfigMgr"),y=e("CardUpgradesMgr"),l=e("UnitConfigMgr"),v=function(){};v.getNPCFightVal=function(e){var t=0;if(null==e.teams)
return t;for(var a=0;a<e.teams.length;++a){var n=e.teams[a];t+=v.getNPCVal(n)}
return t},v.getRobotFightVal=function(e){var t=0;if(null==e||0==e.length)
return t;for(var a=0;a<e.length;++a){var n=e[a];t+=v.getRobotVal(n)}
return t},v.getRobotVal=function(e){var t=e.template_id,a=g.find(t);return Math.floor(.05*e.maxhp+e.atk+e.def)+v.getUnitFightVal(a.unit_type,e.unitGrade,e.unitLevel)},v.getNPCStageFight=function(e,t){var a=e,n=g.find(a),i=[n.ori_attrs.maxhp,n.ori_attrs.atk,n.ori_attrs.def],r=i[0],s=i[1],o=i[2],c=t.level,l=t.card_grade,h=y.getCoefs(n.potential,l),d=0,_=0,u=0,m=0,p=0,f=0;return d=t.add_attrs.statics.maxhp||d,_=t.add_attrs.statics.atk||_,u=t.add_attrs.statics.def||u,m=t.add_attrs.rates.maxhp||m,p=t.add_attrs.rates.atk||p,f=t.add_attrs.rates.def||f,r=r+(c-1+h.maxhp)*n.add_attrs.maxhp+d,s=s+(c-1+h.atk)*n.add_attrs.atk+_,o=o+(c-1+h.def)*n.add_attrs.def+u,r*=1+m/100,s*=1+p/100,o*=1+f/100,Math.floor(.05*r+s+o)+v.getUnitFightVal(n.unit_type,t.unit_grade,t.unit_level)},v.getNPCVal=function(e){var t=e.hero.id,a=g.find(t),n=[a.ori_attrs.maxhp,a.ori_attrs.atk,a.ori_attrs.def],i=n[0],r=n[1],s=n[2],o=e.hero.level,c=e.hero.grade,l=y.getCoefs(a.potential,c),h=0,d=0,_=0,u=0,m=0,p=0;return h=e.hero.static_maxhp||h,d=e.hero.static_atk||d,_=e.hero.static_def||_,u=e.hero.rates_maxhp||u,m=e.hero.rates_atk||m,p=e.hero.rates_def||p,i=i+(o-1+l.maxhp)*a.add_attrs.maxhp+h,r=r+(o-1+l.atk)*a.add_attrs.atk+d,s=s+(o-1+l.def)*a.add_attrs.def+_,i*=1+u/100,r*=1+m/100,s*=1+p/100,Math.floor(.05*i+r+s)+v.getUnitFightVal(a.unit_type,e.unit_grade,e.unit_level)},v.getUnitFightVal=function(e,t,a){var n=l.getUnitPropAttr(e,t,a),i=c(n,3),r=i[0],s=i[1],o=i[2];return Math.floor(1*(.05*r+s+o)/3)},v.getPVEHeroPropAttr=function(e,t,a,n){var i=[e.ori_attrs.maxhp,e.ori_attrs.atk,e.ori_attrs.def],r=i[0],s=i[1],o=i[2],c=0,l=0,h=0,d=0,_=0,u=0;if(n&&n.rates_maxhp){var m=[n.static_maxhp,n.static_atk,n.static_def];c=m[0],l=m[1],h=m[2];var p=[n.rates_maxhp,n.rates_atk,n.rates_def];d=p[0],_=p[1],u=p[2]}
var f=y.getCoefs(e.potential,a);return r=r+(t-1+f.maxhp)*e.add_attrs.maxhp+c,s=s+(t-1+f.atk)*e.add_attrs.atk+l,o=o+(t-1+f.def)*e.add_attrs.def+h,[r*=1+d/100,s*=1+_/100,o*=1+u/100]},t.exports=v,cc._RF.pop()},{CardUpgradesMgr:"CardUpgradesMgr",HeroConfigMgr:"HeroConfigMgr",UnitConfigMgr:"UnitConfigMgr"}],NameDescTipWidget:[function(e,t,a){"use strict";cc._RF.push(t,"b3adajB/JVA+rASlm1MSYfx","NameDescTipWidget");var d=e("ColorUtil"),_=e("RuneUtil");cc.Class({extends:cc.Component,properties:{lab_name:cc.Label,lab_desc:cc.RichText},SetInfo:function(e,t){var a=DonotDestroyManager.GameData.Runes[e];this.lab_name.node.color=d.getColorByQuality(a.quality);var n=DonotDestroyManager.GameData.RuneLevel[a.quality],i=0<t?n.add_on[t-1]/100:0;this.lab_name.string=a.name;for(var r=[],s=a.addon_type.split("-"),o=0;o<s.length;o++){var c=parseInt(s[o]),l=_.getRuneAttriNameByAddonId(c);_.isPercent(c)?r.push(_.getRuneAttriChiName(l)+"：<color=#00ff00>+"+parseInt(a[l]/10*(1+i))+"%</c>"):r.push(_.getRuneAttriChiName(l)+"：<color=#00ff00>+"+parseInt(a[l]*(1+i))+"</c>")}
var h=r.join("\n");this.lab_desc.string=h},onLoad:function(){}});cc._RF.pop()},{ColorUtil:"ColorUtil",RuneUtil:"RuneUtil"}],NetEvent:[function(e,t,a){"use strict";cc._RF.push(t,"aaeddaqHNdFTo2JCYYa6zXS","NetEvent");var n=function(){};n.C2SAssetBundleList=10045,n.S2CGetProtoVersion=10008,n.C2SLogin=10013,n.C2SServerList=10005,n.C2SSelectServer=10019,n.C2SGetAnnounce=10027,n.C2SQueryHasRole=10101,n.C2SCreateCharacter=10103,n.C2SEnterGame=10105,n.C2SChat=10401,n.C2SChatView=10405,n.C2SBagItems=10301,n.C2SSellItem=10303,n.C2SUseItem=10305,n.C2SExpandBag=10309,n.C2SEquipEnhance=10311,n.C2SEquipEnhanceAuto=10313,n.C2SEquipEnhanceAll=10315,n.C2SEquipRefresh=10317,n.C2SEquipRefreshSave=10319,n.C2STreasureEnhance=10321,n.C2STreasureRefresh=10323,n.C2STreasureFragCompose=10325,n.C2SEquipFragCompose=10327,n.C2SGmCmd=101,n.C2SListMail=40001,n.C2SGetAttach=40003,n.C2SReadNewMailMsg=40005,n.C2SDelMail=40009,n.C2SCardList=2001,n.C2SPubView=1041,n.C2SPubBuy=1043,n.C2SCardTakeOnItem=2005,n.C2SCardTakeOffItem=2007,n.C2SStageList=3001,n.C2SStageEnd=3003,n.C2SBattleFormationSave=3005,n.C2SBoxAwardGet=3007,n.S2CMineList=3102,n.S2CMineEnemyDetail=3104,n.S2CMineBattleCalculate=3106,n.S2CMineGetAward=3110,n.S2CMineHistory=3112,n.S2CMineDefFormationSave=3114,n.S2CSecretView=3302,n.S2CSecretBattleStart=3304,n.S2CSecretBattleEnd=3306,n.S2CSecretGetAward=3308,n.S2CSecretSoldierRevive=3310,n.S2CSecretReset=3312,n.S2CBossView=3352,n.S2CBossGetAward=3356,n.S2CBossBattleStart=3358,n.PushBossBattleStatus=3360,n.S2CBossGuwu=3362,n.C2SListSign=3601,n.C2SGetSignAward=3603,n.C2STeamSkillList=3201,n.C2STeamSkillUpgrade=3203,n.C2SMallList=1045,n.C2SArmyShopItemList=1047,n.C2SArmyShopBuy=1049,n.C2SArmyShopRefresh=1051,n.C2SMallBuy=1055,n.C2SMissionList=2201,n.C2SMissionGetAward=2203,n.C2SEliteBoxAwardGet=3011,n.C2SElitePointAwardGet=3013,n.C2SDailyMissionList=3401,n.C2SDailyMissionGetAward=3403,n.C2SCardAddLevel=2009,n.C2SCardAddStar=2011,n.C2SPaymentGetInfo=4201,n.C2SPaymentBuyMoney=4203,n.C2SPaymentBuyEnergy=4205,n.C2SCardTrain=2013,n.C2SCardAutoTrain=2015,n.C2SCardUpgradeUnit=2017,n.C2SCardCompose=2019,n.C2SCardEquipUnit=2021,n.C2SForge=4601,n.C2SEquipCompose=4603,n.C2SGuideStepSet=10119,n.C2SBlackMarketInfo=4401,n.C2SBlackMarketBuy=4403,n.C2SBlackMarketRefresh=4405,n.C2SSweepStage=3015,n.C2SGetFirstPayAward=10123,n.C2SGetVipGift=10125,n.C2SOvercomeItemList=5011,n.C2SOvercomeExchangeListRefresh=5013,n.C2SOvercomeExchange=5015,n.C2SArenaExchangeList=3801,n.C2SArenaFormation=3819,n.C2SArenaPlayerDetail=3821,n.C2SArenaExchange=3803,n.C2SArenaView=3805,n.C2SArenaEnemyDetail=3807,n.C2SArenaRefreshEnemy=3809,n.C2SArenaBattleStart=3811,n.C2SArenaBattleCalculate=3813,n.C2SLuckyRankInfo=3815,n.C2SArenaBattleRecord=3817,n.C2SArenaTopRankView=3823,n.C2SOvercomeInfoAll=5001,n.C2SUserOvercomePassStage=5005,n.C2SOvercomeClaimReward=5007,n.C2SOvercomeReset=5009,n.C2SActivitiesView=5201,n.C2SActivitiesBattlePass=5203,n.C2SActivitiesClaimAward=5205,n.C2SActivitiesBattleBuyTicket=5207,n.C2SActivitiesBattleFormation=5209,n.C2STreasureRobList=4801,n.C2STreasureRobEnemyDetail=4803,n.C2STreasureRobCalculate=4805,n.C2STreasureAvoidRob=4807,n.C2STreasureAvoidRobTime=4809,n.C2STreasureRobBattleStart=4811,n.C2STreasureAutoRob=4813,n.C2STreasureRobReport=4815,n.C2STreasureRobGrab=4817,n.C2SActivityList=5401,n.C2SActivitiesGetAward=5403,n.ErrorCode=1e4,n.S2CLogin=10014,n.S2CGuestLogin=10016,n.S2COpenLogin=10018,n.S2CH5OpenLogin=10032,n.S2CAssetBundleList=10046,n.S2CServerList=10006,n.S2CSelectServer=10020,n.S2CGetAnnounce=10028,n.S2CQueryHasRole=10102,n.S2CCreateCharacter=10104,n.S2CEnterGame=10106,n.S2CUserInfoStruct=10108,n.S2CChat=10402,n.S2CChatPush=10404,n.S2CChatView=10406,n.S2CPlayerKickOff=10114,n.S2CBagItems=10302,n.S2CSellItem=10304,n.S2CUseItem=10306,n.PushItemChange=10308,n.S2CExpandBag=10310,n.S2CEquipEnhance=10312,n.S2CEquipEnhanceAuto=10314,n.S2CEquipEnhanceAll=10316,n.S2CEquipRefresh=10318,n.S2CEquipRefreshSave=10320,n.S2CTreasureEnhance=10322,n.S2CTreasureRefresh=10324,n.S2CTreasureFragCompose=10326,n.S2CEquipFragCompose=10328,n.S2CGmCmd=102,n.S2CListMail=40002,n.S2CGetAttach=40004,n.S2CReadNewMailMsg=40006,n.S2CDelMail=40010,n.S2CGetAttachAll=40014,n.PushPropertyChange=10116,n.PushNewMail=40012,n.S2CCardList=2002,n.PushAddCard=2004,n.S2CPubView=1042,n.S2CPubBuy=1044,n.S2CCardTakeOnItem=2006,n.S2CCardTakeOffItem=2008,n.S2CStageList=3002,n.S2CStageEnd=3004,n.S2CBattleFormationSave=3006,n.S2CBoxAwardGet=3008,n.S2CEliteStageEnd=3010,n.S2CListSign=3602,n.S2CGetSignAward=3604,n.S2CKeyConvert=3622,n.S2CTeamSkillList=3202,n.S2CTeamSkillUpgrade=3204,n.PushTeamSkillUnlock=3206,n.S2CMallList=1046,n.S2CArmyShopItemList=1048,n.S2CArmyShopBuy=1050,n.S2CArmyShopRefresh=1052,n.S2CMallBuy=1056,n.S2CMissionList=2202,n.S2CMissionGetAward=2204,n.PushMissionChange=2206,n.S2CMissionGetAwardAll=2208,n.S2CEliteBoxAwardGet=3012,n.S2CElitePointAwardGet=3014,n.S2CDailyMissionList=3402,n.S2CDailyMissionGetAward=3404,n.PushDailyMissionChange=3406,n.S2CDailyMissionGetAwardAll=3408,n.S2CGuozhanView=3452,n.S2CGuozhanBattleStart=3454,n.S2CGuozhanBattleEnd=3456,n.S2CGuozhanMove=3458,n.S2CGuozhanChangeNation=3460,n.S2CGuozhanOfficeView=3462,n.S2CGuozhanOfficeDetail=3464,n.S2CGuozhanOfficeStart=3466,n.S2CGuozhanOfficCalculate=3468,n.S2CGuozhanFightView=3472,n.S2CGuoZhanCityDetail=3474,n.S2CGuoZhanCityMove=3476,n.S2CGuozhanCityCalculate=3478,n.PushGuoZhanPass=3480,n.S2CGuozhanHistory=3482,n.S2CCardAddLevel=2010,n.S2CCardAddStar=2012,n.S2CPaymentGetInfo=4202,n.S2CPaymentBuyMoney=4204,n.S2CPaymentBuyEnergy=4206,n.S2CCardTrain=2014,n.S2CCardAutoTrain=2016,n.S2CCardUpgradeUnit=2018,n.S2CCardCompose=2020,n.S2CCardEquipUnit=2022,n.PushCardAddLevel=2024,n.S2CRuneUnlock=2026,n.S2CRunePutup=2028,n.S2CRuneHammerBuy=2030,n.S2CRuneCombine=2032,n.S2CRuneLevelup=2034,n.S2CForge=4602,n.S2CEquipCompose=4604,n.S2CRuneSuccessRate=4606,n.PushGuideInfo=10118,n.S2CBlackMarketInfo=4402,n.S2CBlackMarketBuy=4404,n.S2CBlackMarketRefresh=4406,n.S2CDownlineReconnect=10128,n.S2CListRedPoints=10130,n.S2CQunheiPayPre=10132,n.PushPaymentResult=10134,n.PushFirstPay=10136,n.S2CGetYuekaAward=10138,n.S2CGetQunheiWxShareAward=10140,n.PushMarquee=10142,n.S2CRankView=10144,n.S2CRankPlayerDetail=10146,n.S2CZMPayCheck=10148,n.S2COfflineAwardDouble=10150,n.S2C333PayPre=10152,n.S2CChongChongPayPre=10154,n.S2C4399PayPre=10156,n.S2CRankLike=10158,n.PushSmallTips=10160,n.S2CWanBaGetBalance=10162,n.S2CAddDesktopShortcutAward=10166,n.S2CChangeName=10168,n.S2CChangeIcon=10170,n.S2CListHeadFrame=10172,n.S2CChangeHeadFrame=10174,n.PushIosIAPVerify=10178,n.S2CSweepStage=3016,n.S2CChargeInfo=10122,n.S2CGetFirstPayAward=10124,n.S2CGetVipGift=10126,n.S2COvercomeItemList=5012,n.S2COvercomeExchangeListRefresh=5014,n.S2COvercomeExchange=5016,n.S2CArenaExchangeList=3802,n.S2CArenaExchange=3804,n.S2CArenaView=3806,n.S2CArenaEnemyDetail=3808,n.S2CArenaRefreshEnemy=3810,n.S2CArenaBattleStart=3812,n.S2CArenaBattleCalculate=3814,n.S2CLuckyRankInfo=3816,n.S2CArenaBattleRecord=3818,n.S2CArenaFormation=3820,n.S2CArenaPlayerDetail=3822,n.S2CArenaTopRankView=3824,n.S2CPkEnemyFormation=3826,n.S2CPkBattleCalculate=3828,n.S2COvercomeInfoAll=5002,n.S2CUserOvercomePassStage=5006,n.S2COvercomeClaimReward=5008,n.S2COvercomeReset=5010,n.S2CActivitiesView=5202,n.S2CActivitiesBattlePass=5204,n.S2CActivitiesClaimAward=5206,n.S2CActivitiesBattleBuyTicket=5208,n.S2CActivitiesBattleFormation=5210,n.S2CActivitiesBattleSweep=5212,n.S2CTreasureRobList=4802,n.S2CTreasureRobEnemyDetail=4804,n.S2CTreasureRobCalculate=4806,n.S2CTreasureAvoidRob=4808,n.S2CTreasureAvoidRobTime=4810,n.S2CTreasureRobBattleStart=4812,n.S2CTreasureAutoRob=4814,n.S2CTreasureRobReport=4816,n.S2CTreasureRobGrab=4818,n.S2CActivityList=5402,n.S2CActivitiesGetAward=5404,n.PushActivityProgressUpdate=5406,n.S2CQiZhenYiBaoView=5408,n.S2CQiZhenYiBaoJoin=5410,n.PushQiZhenYiBaoKaiJiang=5412,n.S2CQedjList=10180,n.S2CQedjAward=10182,t.exports=n,cc._RF.pop()},{}],NetMessageManager:[function(p,e,t){"use strict";cc._RF.push(e,"878ccjK0s9Doq/7NrLibkjd","NetMessageManager");var f=p("MyEventDispatcher"),a=p("NetEvent"),g=p("MyUIEvent"),n=(p("EquipBufferMgr"),p("HeroBufferMgr")),i=p("MyProtocols"),r=p("BattleBufferMgr"),s=p("ItemBufferMgr"),o=p("GuideBufferMgr"),c=p("TeamSkillBufferMgr"),y=(p("LejiSocket"),p("PlayerBufferMgr")),l=p("StageBufferMgr"),h=p("MarqueeBufferMgr"),d=p("GameUtils"),_=p("i18n"),u=p("SoundUtil"),m=p("SnatchBattleManager"),v=p("MineBattleManager"),M=p("AreanBattleManager"),S=p("GuozhanBufferMgr"),C=p("PkBattleManager"),D=p("BossBufferMgr"),I=p("OverComeBufferMgr"),b=p("GuozhanFightBufferMgr");cc.Class({extends:cc.Component,properties:{},onLoad:function(){if(this.PlayerKickOff_auth_cb_func=this.PlayerKickOff_auth_cb.bind(this),f.addListener(a.S2CPlayerKickOff,this.PlayerKickOff_auth_cb_func),this.BagItems_auth_cb_func=this.BagItems_auth_cb.bind(this),f.addListener(a.S2CBagItems,this.BagItems_auth_cb_func),this.PushItemChange_auth_cb_func=this.PushItemChange_auth_cb.bind(this),f.addListener(a.PushItemChange,this.PushItemChange_auth_cb_func),this.PushPropertyChange_auth_cb_func=this.PushPropertyChange_auth_cb.bind(this),f.addListener(a.PushPropertyChange,this.PushPropertyChange_auth_cb_func),this.GetNewMail_auth_cb_func=this.GetNewMail_auth_cb.bind(this),f.addListener(a.PushNewMail,this.GetNewMail_auth_cb_func),this.CardList_auth_cb_func=this.CardList_auth_cb.bind(this),f.addListener(a.S2CCardList,this.CardList_auth_cb_func),this.PushAddCard_auth_cb_func=this.PushAddCard_auth_cb.bind(this),f.addListener(a.PushAddCard,this.PushAddCard_auth_cb_func),this.S2CStageList_auth_cb_func=this.S2CStageList_auth_cb.bind(this),f.addListener(a.S2CStageList,this.S2CStageList_auth_cb_func),this.MissionChange_auth_cb_func=this.MissionChange_auth_cb.bind(this),f.addListener(a.PushMissionChange,this.MissionChange_auth_cb_func),this.DailyMissionChange_auth_cb_func=this.DailyMissionChange_auth_cb.bind(this),f.addListener(a.PushDailyMissionChange,this.DailyMissionChange_auth_cb_func),this.PushGuideInfo_cb_func=this.PushGuideInfo_auth_cb.bind(this),f.addListener(a.PushGuideInfo,this.PushGuideInfo_cb_func),this.NetworkError_cb_func=this.NetworkError_auth_cb.bind(this),f.addListener("NetWork-Error",this.NetworkError_cb_func),this.S2CDownlineReconnect_cb_func=this.S2CDownlineReconnect_auth_cb.bind(this),f.addListener(a.S2CDownlineReconnect,this.S2CDownlineReconnect_cb_func),this.S2CChargeInfo_cb_func=this.S2CChargeInfo_auth_cb.bind(this),f.addListener(a.S2CChargeInfo,this.S2CChargeInfo_cb_func),this.PushPaymentResult_cb_func=this.PushPaymentResult_cb.bind(this),f.addListener(a.PushPaymentResult,this.PushPaymentResult_cb_func),this.PushIosIAPVerify_cb_func=this.PushIosIAPVerify_cb.bind(this),f.addListener(a.PushIosIAPVerify,this.PushIosIAPVerify_cb_func),this.PushFirstPay_cb_func=this.PushFirstPay_cb.bind(this),f.addListener(a.PushFirstPay,this.PushFirstPay_cb_func),this.PushTeamSkillUnlock_cb_func=this.PushTeamSkillUnlock_auth_cb.bind(this),f.addListener(a.PushTeamSkillUnlock,this.PushTeamSkillUnlock_cb_func),this.PushMarquee_cb_func=this.PushMarquee_cb.bind(this),f.addListener(a.PushMarquee,this.PushMarquee_cb_func),this.PushSmallTips_cb_func=this.PushSmallTips_cb.bind(this),f.addListener(a.PushSmallTips,this.PushSmallTips_cb_func),this.PushCardAddLevel_cb_func=this.PushCardAddLevel_cb.bind(this),f.addListener(a.PushCardAddLevel,this.PushCardAddLevel_cb_func),this.S2CMineDefFormationSave_cb_func=this.S2CMineDefFormationSave_cb.bind(this),f.addListener(a.S2CMineDefFormationSave,this.S2CMineDefFormationSave_cb_func),window.onbeforeunload=function(){if(null!=window.TDGA&&TDGA.onPageLeave(),null!=window.open_platform&&3==window.open_platform&&null!=MyPersistDataManager._playerData){var e=" phục vụ khí #"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(e=DonotDestroyManager._gameServerInfo.server_name),ZmSdk.getInstance().reportRoleStatus({datatype:"5",serverid:MyPersistDataManager._playerData.server_id,servername:e,roleid:MyPersistDataManager._playerData.id,rolename:MyPersistDataManager._playerData.name,rolelevel:MyPersistDataManager._playerData.level,fightvalue:MyPersistDataManager._playerData.fight})}},null!=window.open_platform&&2==window.open_platform&&(window.__paySuccess=function(){MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),_.t("pay_success")),i.send_C2SWanBaPay(DonotDestroyManager._gameSocket,window.OPEN_DATA.appid,window.OPEN_DATA.openid,window.OPEN_DATA.openkey,window.OPEN_DATA.pf,window.OPEN_DATA.platform,window.OPEN_DATA.itemid)},window.__payError=function(){MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),_.t("pay_fail"))},window.__payClose=function(){MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),_.t("pay_cancel"))}),null!=window.open_platform&&2==window.open_platform){mqq.invoke("ui","setOnAddShortcutHandler",{callback:mqq.callback(function(){mqq.ui.addShortcut({action:"web",title:" tam quốc quân đoàn chiến ",icon:window.OPEN_DATA.appicon,url:window.OPEN_DATA.jumpurl})},!1,!0)})}
null!=window.open_platform&&3==window.open_platform&&ZmSdk.getInstance().isSupportMethod("setShareInfo")&&ZmSdk.getInstance().setShareInfo({title:"Tam quốc quân đoàn chiến",content:" mau tới thể nghiệm thiên quân vạn mã chém giết tam quốc chiến trường đi ！",imgurl:"http://cdn.lejigames.com/icon/100x100px.png",ext:""},function(e){null!=e&&"ok"==e.success&&i.send_C2SGetQunheiWxShareAward(DonotDestroyManager._gameSocket)}),this.S2CQunheiPayPre_cb_func=this.S2CQunheiPayPre_cb.bind(this),f.addListener(a.S2CQunheiPayPre,this.S2CQunheiPayPre_cb_func),this.S2CZMPayCheck_cb_func=this.S2CZMPayCheck_cb.bind(this),f.addListener(a.S2CZMPayCheck,this.S2CZMPayCheck_cb_func),this.S2C333PayPre_cb_func=this.S2C333PayPre_cb.bind(this),f.addListener(a.S2C333PayPre,this.S2C333PayPre_cb_func),this.S2CChongChongPayPre_cb_func=this.S2CChongChongPayPre_cb.bind(this),f.addListener(a.S2CChongChongPayPre,this.S2CChongChongPayPre_cb_func),this.S2C4399PayPre_cb_func=this.S2C4399PayPre_cb.bind(this),f.addListener(a.S2C4399PayPre,this.S2C4399PayPre_cb_func),this.YiJieLoginSuccessJsbCallback_cb_func=this.YiJieLoginSuccessJsbCallback_cb.bind(this),f.addListener(g.YiJieLoginSuccessJsbCallback,this.YiJieLoginSuccessJsbCallback_cb_func),this.S2CWanBaGetBalance_cb_func=this.S2CWanBaGetBalance_cb.bind(this),f.addListener(a.S2CWanBaGetBalance,this.S2CWanBaGetBalance_cb_func),this.S2CArenaBattleStart_cb_func=this.S2CArenaBattleStart_cb.bind(this),f.addListener(a.S2CArenaBattleStart,this.S2CArenaBattleStart_cb_func),this.S2CTreasureRobBattleStart_cb_func=this.S2CTreasureRobBattleStart_cb.bind(this),f.addListener(a.S2CTreasureRobBattleStart,this.S2CTreasureRobBattleStart_cb_func),this.S2CMineEnemyDetail_cb_func=this.S2CMineEnemyDetail_cb.bind(this),f.addListener(a.S2CMineEnemyDetail,this.S2CMineEnemyDetail_cb_func),this.S2CGuozhanBattleStart_cb_func=this.S2CGuozhanBattleStart_cb.bind(this),f.addListener(a.S2CGuozhanBattleStart,this.S2CGuozhanBattleStart_cb_func),this.S2CGuozhanOfficeStart_cb_func=this.S2CGuozhanOfficeStart_cb.bind(this),f.addListener(a.S2CGuozhanOfficeStart,this.S2CGuozhanOfficeStart_cb_func),this.OvercomeInfoAll_auth_cb_func=this.OvercomeInfoAll_auth_cb.bind(this),f.addListener(a.S2COvercomeInfoAll,this.OvercomeInfoAll_auth_cb_func),this.S2CPkEnemyFormation_cb_func=this.S2CPkEnemyFormation_cb.bind(this),f.addListener(a.S2CPkEnemyFormation,this.S2CPkEnemyFormation_cb_func),this.S2CBossBattleStart_cb_func=this.S2CBossBattleStart_cb.bind(this),f.addListener(a.S2CBossBattleStart,this.S2CBossBattleStart_cb_func),this.S2CGuoZhanCityMove_cb_func=this.S2CGuoZhanCityMove_cb.bind(this),f.addListener(a.S2CGuoZhanCityMove,this.S2CGuoZhanCityMove_cb_func)},S2CGuoZhanCityMove_cb:function(e){b.updateR(e.r)},S2CBossBattleStart_cb:function(e){D.updateR(e.r)},S2CPkEnemyFormation_cb:function(e){null!=C&&null!=C.mEmenyData&&(C.mEmenyData.rand_key=e.rand_key)},OvercomeInfoAll_auth_cb:function(e){I.rand_key=e.rand_key},S2CGuozhanOfficeStart_cb:function(e){S.updateR(e.rand_key)},S2CGuozhanBattleStart_cb:function(e){null!=S._enemyInfo&&(S._enemyInfo.r=e.r)},S2CMineEnemyDetail_cb:function(e){null!=v&&null!=v.mEmenyData&&(v.mEmenyData.rand_key=e.rand_key)},S2CTreasureRobBattleStart_cb:function(e){m.rand_key=e.rand_key},S2CArenaBattleStart_cb:function(e){M.randkey=e.rand_key},PushIosIAPVerify_cb:function(e){var t=e.ret;if(0<t){null!=this._alert_layer&&cc.isValid(this._alert_layer)||(this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer));var a=this;this._alert_layer.getComponent("AlertLayerManager").initContent(_.t(t+""),function(){a._alert_layer.destroy(),a._alert_layer=null})}},S2CMineDefFormationSave_cb:function(e){var t=e.mine_point_detail;MyUiManager.updateUiParams(71,{netData:t}),f.dispatchEvent(g.onMinePointDetailChange,t)},S2CWanBaGetBalance_cb:function(e){if(e.is_balance_enough)
i.send_C2SWanBaPay(DonotDestroyManager._gameSocket,window.OPEN_DATA.appid,window.OPEN_DATA.openid,window.OPEN_DATA.openkey,window.OPEN_DATA.pf,window.OPEN_DATA.platform,e.itemid);else{if(null!=window.TDGA){var t={orderId:e.cpOrderId,iapId:e.goodsName,currencyAmount:e.defaultScore/10,currencyType:"CNY",virtualCurrencyAmount:e.defaultScore,paymentType:"WANBA_PAY"};MyPersistDataManager._tmpTdPaymentData=t}
cc.sys.os,cc.sys.OS_IOS;window.OPEN_DATA.itemid=e.itemid,window.popPayTips({version:"v2",defaultScore:e.defaultScore,appid:window.OPEN_DATA.appid}),null!=window.TDGA&&TDGA.onChargeRequest(MyPersistDataManager._tmpTdPaymentData)}},YiJieLoginSuccessJsbCallback_cb:function(e){"login"!=cc.director.getScene().name&&(DonotDestroyManager._YiJieSwitchAccountInfo=e,d.restartGame())},S2C4399PayPre_cb:function(e){e.goodsId;var t=e.cpOrderId,a=e.extra,n=e.rmb,i=e.goodsName;if(null!=window.TDGA){var r={orderId:t,iapId:i,currencyAmount:n,currencyType:"CNY",virtualCurrencyAmount:10*n,paymentType:"4399-pay"};MyPersistDataManager._tmpTdPaymentData=r}
window.H5API.openPay(n,t,MyPersistDataManager._playerData.server_id+"",a),null!=window.TDGA&&TDGA.onChargeRequest(MyPersistDataManager._tmpTdPaymentData)},S2CChongChongPayPre_cb:function(e){var t=e.goodsId,a=e.egretOrderId,n=e.ext,i=e.money,r=e.goodsName;if(r=r.replace("+"," cùng "),null!=window.TDGA){var s={orderId:a,iapId:r,currencyAmount:i,currencyType:"CNY",virtualCurrencyAmount:10*i,paymentType:"chongchong-pay"};MyPersistDataManager._tmpTdPaymentData=s}
payForCCplay(window.CHONGCHONG.userId,window.CHONGCHONG.userName,"25384_cn.lejigame.sangocard",t,r,i,a,"",n,"",0,""),null!=window.TDGA&&TDGA.onChargeRequest(MyPersistDataManager._tmpTdPaymentData)},S2C333PayPre_cb:function(e){var t=window.CY_GAME_SDK,a={gameId:window.THREE33.gameId,share:{success:function(){alert("Chia sẻ thành công!")}},pay:{success:function(){}}};if(t.config(a),null!=window.TDGA){var n={orderId:e.cpOrderId,iapId:e.goodsName,currencyAmount:e.money,currencyType:"CNY",virtualCurrencyAmount:10*e.money,paymentType:"333pay"};MyPersistDataManager._tmpTdPaymentData=n}
t.pay({gameId:window.THREE33.gameId,uid:window.THREE33.uid,time:e.time,server:e.server,role:e.role,goodsId:e.goodsId,goodsName:e.goodsName,money:e.money,cpOrderId:e.cpOrderId,ext:"",sign:e.sign,signType:"md5"}),null!=window.TDGA&&TDGA.onChargeRequest(MyPersistDataManager._tmpTdPaymentData)},S2CZMPayCheck_cb:function(e){var t=e.fee_id,a=e.check,n=e.extradata,i=e.goodsName,r=e.rmb,s=MyPersistDataManager._playerData.id,o=MyPersistDataManager._playerData.name,c=MyPersistDataManager._playerData.server_id,l={check:a,feeid:t,fee:100*r,feename:i,extradata:n,serverid:""+c,rolename:o,roleid:""+s,servername:"S#"+c};if(null!=window.TDGA){var h={orderId:a,iapId:i,currencyAmount:r,currencyType:"CNY",virtualCurrencyAmount:10*r,paymentType:" chưởng minh pay"};MyPersistDataManager._tmpTdPaymentData=h}
ZmSdk.getInstance().pay(l,function(e){2==e.retcode&&MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),_.t("pay_cancel"))}),null!=window.TDGA&&TDGA.onChargeRequest(MyPersistDataManager._tmpTdPaymentData)},S2CQunheiPayPre_cb:function(e){var t=e.ext,a=e.sign,n=e.charge_index,i=e.goodsName,r=e.rmb,s={userId:MyPersistDataManager._playerData.account_id,gid:"3790",roleName:MyPersistDataManager._playerData.name,goodsId:"pay"+n,goodsName:i,money:r,ext:t,serverId:MyPersistDataManager._playerData.server_id,sign:a};if(null!=window.TDGA){var o={orderId:t,iapId:i,currencyAmount:r,currencyType:"CNY",virtualCurrencyAmount:10*r,paymentType:" đàn hắc pay"};MyPersistDataManager._tmpTdPaymentData=o}
qhsdk.pay(s,function(e,t){}),null!=window.TDGA&&TDGA.onChargeRequest(MyPersistDataManager._tmpTdPaymentData)},PushCardAddLevel_cb:function(e){MyPersistDataManager._playerData.cardsMaplist[e.card_id].level=e.level,MyPersistDataManager._playerData.cardsMaplist[e.card_id].exp=e.level_exp,MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.new_fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.new_fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.new_fight},PushMarquee_cb:function(e){h.insertMsgContent(e),h.doPlay()},PushSmallTips_cb:function(e){h.marqueeCanPlay&&MyUiManager.OpenSmallTipsWidget(e.colorType,e.content)},PushFirstPay_cb:function(e){MyPersistDataManager._playerData.chargeInfo.is_first_pay=!0},PushPaymentResult_cb:function(e){if(u.playGainGoodsEffectNew(),0<e.yuanbao){null!=this._alert_layer&&cc.isValid(this._alert_layer)||(this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer));var t=this;this._alert_layer.getComponent("AlertLayerManager").initContent("Nạp thành công, nhận 【"+e.yuanbao+"】 vàng!\nCập nhật lại trang",function(){t._alert_layer.destroy(),t._alert_layer=null})}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),_.t("pay_success"));if(null!=window.TDGA){var a=MyPersistDataManager._tmpTdPaymentData;TDGA.onChargeSuccess({orderId:a.orderId,iapId:a.iapId,currencyAmount:a.currencyAmount,currencyType:a.currencyType,virtualCurrencyAmount:a.virtualCurrencyAmount,paymentType:a.paymentType})}},PushTeamSkillUnlock_auth_cb:function(e){cc.log("receive push team skill unlock!");var t=e.unlock_index;c.unlockTeamSkill(t),t==c.tmpSkillIndex&&(c.tmpSkillIndex=-1),MyPersistDataManager._playerData.RedPoint.push({name:"labground",state:!0})},S2CChargeInfo_auth_cb:function(e){cc.log(" nhận tiền trả tin tức thành công "),MyPersistDataManager._playerData.chargeInfo=e,f.dispatchEvent(g.onChargeInfo,e)},S2CDownlineReconnect_auth_cb:function(e){cc.log(" cắt đứt quan hệ trọng gắn bó công ！ret=%d",e.ret),0==e.ret||2==e.ret?DonotDestroyManager._gameSocket.sendMessage(DonotDestroyManager._gameSocket._cache_msg):(null!=this._alert_layer&&cc.isValid(this._alert_layer)||(this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer)),this._alert_layer.getComponent("AlertLayerManager").initContent("Đăng nhập lại thất bại#"+e.ret+",quay lại giao diện đăng nhập!",function(){d.restartGame()},!1))},NetworkError_auth_cb:function(e){e===DonotDestroyManager._gameSocket&&-1!=e._conn_status&&(e.reconnect(),this._connect2GsCheck())},_connect2GsCheck:function(){null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node));var e=this,t=0,a=setInterval(function(){cc.log("query gs status!"),DonotDestroyManager._gameSocket.isConnected()&&(cc.log("send_Downline reconnect gửi đi tin tức "),i.send_C2SDownlineReconnect(DonotDestroyManager._gameSocket,MyPersistDataManager._playerData.in_game_session_id),clearInterval(a),null!=e._shortMask_node&&(e._shortMask_node.removeFromParent(),e._shortMask_node.destroy(),e._shortMask_node=null),null!=e._alert_layer&&(e._alert_layer.removeFromParent(),e._alert_layer.destroy(),e._alert_layer=null)),(4e3<(t+=200)||DonotDestroyManager._gameSocket.isError())&&(clearInterval(a),null!=e._shortMask_node&&(e._shortMask_node.removeFromParent(),e._shortMask_node.destroy(),e._shortMask_node=null),null!=e._alert_layer&&cc.isValid(this._alert_layer)||(e._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(e._alert_layer)),e._alert_layer.getComponent("AlertLayerManager").initContent("Kết nối thất bại,xin thử lại!",function(){null!=e._alert_layer&&(e._alert_layer.removeFromParent(),e._alert_layer.destroy(),e._alert_layer=null),DonotDestroyManager._gameSocket.reconnect(),e._connect2GsCheck()},!1))},200)},PushGuideInfo_auth_cb:function(e){null!=DonotDestroyManager.GameData&&null!=DonotDestroyManager.GameData.Guide?o.initGuideBufferMgr(e.guideInfo):MyPersistDataManager._playerData.guideList=e.guideInfo},DailyMissionChange_auth_cb:function(e){var t=MyPersistDataManager._playerData.daymissionlist;if(0!=t.length){for(var a=!1,n=0;n<t.length;++n)
if(t[n].mission_tpl_id==e.mission_tpl_id){t[n].progress=e.progress,a=!0;break}
var i={mission_tpl_id:e.mission_tpl_id,progress:e.progress};a||MyPersistDataManager._playerData.daymissionlist.push(i),f.dispatchEvent(g.onDayMissionChange,e)}},MissionChange_auth_cb:function(e){var t=MyPersistDataManager._playerData.missionslist;if(0!=t.length){for(var a=!1,n=0;n<t.length;++n)
if(t[n].missionId==e.missionId)
return t[n].progress=e.progress,void(a=!0);var i={missionId:e.missionId,progress:e.progress};a||MyPersistDataManager._playerData.missionslist.push(i)}},S2CStageList_auth_cb:function(e){cc.log(" tiếp đã bị quan tạp tin tức "),MyPersistDataManager._playerData.chapterslist=e.chapters,MyPersistDataManager._playerData.formation=e.formation,MyPersistDataManager._playerData.elite_count=e.elite_count,MyPersistDataManager._playerData.chapterslist.forEach(function(e,t){MyPersistDataManager._playerData.chaptersMaplist[t+1]=e}),null!=e.formation&&r.setFormationData(1,e.formation),MyPersistDataManager._playerData.chapterselitelist=e.chapters_elite,MyPersistDataManager._playerData.chapterselitelist.forEach(function(e,t){MyPersistDataManager._playerData.chapterseliteMap[t+1]=e}),l.initCrawlState(e.crawl_state)},PushAddCard_auth_cb:function(e){if(null==MyPersistDataManager._playerData.cardsMaplist[e.card_info.template_id]){if(MyPersistDataManager._playerData.cardsMaplist[e.card_info.template_id]=e.card_info,null==MyPersistDataManager._playerData.cardslist)
return;return MyPersistDataManager._playerData.cardslist.push(e.card_info),void n.init1Hero(e.card_info)}
if(MyPersistDataManager._playerData.cardsMaplist[e.card_info.template_id].num=e.card_info.num,MyPersistDataManager._playerData.cardsMaplist[e.card_info.template_id].num<=0){n.removeHero(e.card_info.template_id),r.removeFormationCard(e.card_info.template_id),delete MyPersistDataManager._playerData.cardsMaplist[e.card_info.template_id];for(var t=-1,a=MyPersistDataManager._playerData.cardslist.length-1;0<=a;--a)
if(MyPersistDataManager._playerData.cardslist[a].template_id==e.card_info.template_id){t=a;break}
if(-1==t)
return;MyPersistDataManager._playerData.cardslist.splice(t,1)}},CardList_auth_cb:function(e){cc.log(" tiếp đã bị anh hùng liệt biểu tin tức "+e.cards.length),MyPersistDataManager._playerData.cardslist=e.cards,MyPersistDataManager._playerData.cardslist.forEach(function(e,t){MyPersistDataManager._playerData.cardsMaplist[e.template_id]=e;for(var a=0;a<e.equips.length;++a)"0"!=e.equips[a]&&(MyPersistDataManager._playerData.bagMap[e.equips[a]].heroid=e.template_id)}),null!=DonotDestroyManager.GameData&&null!=DonotDestroyManager.GameData.Cards&&n.initHeroList(MyPersistDataManager._playerData.cardslist)},GetNewMail_auth_cb:function(e){null!=e.mail_info&&(MyPersistDataManager._playerData.didOpenedMailBox&&MyPersistDataManager._playerData.maillist.unshift(e.mail_info),f.dispatchEvent(g.SetRedPoint,{name:"mailBox",state:!0}))},PushPropertyChange_auth_cb:function(a){switch(cc.log(" ngoạn gia số liệu thay đổi ===="+a.type+" giá trị ==="+a.value),a.type){case 1:MyPersistDataManager._playerData.gameMoney=a.value,f.dispatchEvent(g.onCooperChange,a.value);break;case 2:MyPersistDataManager._playerData.money=a.value,f.dispatchEvent(g.onGoldChange,a.value);break;case 3:if(MyPersistDataManager._playerData.level=a.value,null==DonotDestroyManager.GameData)
return;DonotDestroyManager.GameData.Formation.forEach(function(e,t){e.unlock.level==a.value&&cc.sys.localStorage.setItem(MyPersistDataManager._playerData.server_id+"newformation"+MyPersistDataManager._playerData.id,e.id)}),y.setLevelUpAble(a.value),null!=window.TDGA&&TDGA.Account.setLevel(a.value);var e=" phục vụ khí #"+MyPersistDataManager._playerData.server_id;if(null!=DonotDestroyManager._gameServerInfo&&(e=DonotDestroyManager._gameServerInfo.server_name),null!=window.open_platform&&3==window.open_platform&&ZmSdk.getInstance().reportRoleStatus({datatype:"4",serverid:MyPersistDataManager._playerData.server_id,servername:e,roleid:MyPersistDataManager._playerData.id,rolename:MyPersistDataManager._playerData.name,rolelevel:MyPersistDataManager._playerData.level,fightvalue:MyPersistDataManager._playerData.fight}),2==DonotDestroyManager.jsbChannel){var t=new Date,n=Math.round(t.getTime()/1e3).toString(),i={roleId:MyPersistDataManager._playerData.id.toString(),roleName:MyPersistDataManager._playerData.name,roleLevel:MyPersistDataManager._playerData.level.toString(),zoneId:MyPersistDataManager._playerData.server_id.toString(),zoneName:e,balance:MyPersistDataManager._playerData.money.toString(),vip:MyPersistDataManager._playerData.vip_level.toString(),partyName:" vô bang phái ",roleCTime:n,roleLevelMTime:n};window.webkit.messageHandlers.setData.postMessage({param1:"levelup",param2:JSON.stringify(i)})}else if(8==DonotDestroyManager.jsbChannel){var r=MyPersistDataManager._playerData.account_id.substr(3),s=MyPersistDataManager._playerData.id+"",o=MyPersistDataManager._playerData.name,c=MyPersistDataManager._playerData.level.toString(),l=MyPersistDataManager._playerData.server_id.toString(),h=MyPersistDataManager._playerData.gameMoney.toString(),d=MyPersistDataManager._playerData.vip_level.toString(),_=MyPersistDataManager._playerData.money.toString(),u=MyPersistDataManager._playerData.fight.toString();jsb.reflection.callStaticMethod("QbsgzPingPingOpenApi","userInfo:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:",r,"levelUp",s,o,c,l,e,h,d,_,u)}else
9==DonotDestroyManager.jsbChannel?jsb.reflection.callStaticMethod("DouWanOpenApi","setRoleInfo:and1:and2:and3:",MyPersistDataManager._playerData.server_id.toString(),MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.level.toString()):11==DonotDestroyManager.jsbChannel?cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","setData","(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;Ljava/lang/String;)V",4,MyPersistDataManager._playerData.money,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.server_id,e,MyPersistDataManager._playerData.vip_level.toString()):jsb.reflection.callStaticMethod("SDKHandler","submitData:and1:and2:and3:and4:and5:and6:and7:",4,MyPersistDataManager._playerData.server_id.toString(),e,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.money.toString(),MyPersistDataManager._playerData.vip_level.toString()):12==DonotDestroyManager.jsbChannel&&(cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","setUserInfo","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;I)V",MyPersistDataManager._playerData.server_id.toString(),e,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.money.toString(),0):jsb.reflection.callStaticMethod("QuickSDKHandler","updateRoleInfoWith:and1:and2:and3:and4:and5:and6:and7:",e,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.money.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.level.toString(),0));break;case 4:MyPersistDataManager._playerData.energy=a.value;break;case 5:break;case 6:MyPersistDataManager._playerData.level_exp=a.value;break;case 7:MyPersistDataManager._playerData.vip_level=a.value,f.dispatchEvent(g.onVipLevelChange,a.value);break;case 8:MyPersistDataManager._playerData.vip_exp=a.value,f.dispatchEvent(g.onVipExpChange,a.value);break;case 9:MyPersistDataManager._playerData.stamina=a.value;break;case 10:MyPersistDataManager._playerData.honor=a.value;break;case 11:MyPersistDataManager._playerData.formationSlots=a.value;break;case 12:MyPersistDataManager._playerData.fight=a.value}
var m=p("PlayerDataManager");null!=m.getInstance()&&m.getInstance().refreshData()},PushItemChange_auth_cb:function(e){var t=null;if(t=""!=e.item_info.uuid?e.item_info.uuid:e.item_info.template_id,null!=MyPersistDataManager._playerData.bagMap){if(null==MyPersistDataManager._playerData.bagMap[t])
return MyPersistDataManager._playerData.bagMap[t]=e.item_info,MyPersistDataManager._playerData.baglist.push(e.item_info),void s.addItem(e.item_info);var a=MyPersistDataManager._playerData.bagMap[t];if(null!=a&&a.num>e.item_info.num&&null!=window.TDGA&&TDGA.onItemUse({item:e.item_info.template_id,itemNumber:a.num-e.item_info.num}),s.addItemNumByTmpId(e.item_info.template_id,e.item_info.num,e.item_info.uuid),MyPersistDataManager._playerData.bagMap[t].uuid=e.item_info.uuid,MyPersistDataManager._playerData.bagMap[t].template_id=e.item_info.template_id,MyPersistDataManager._playerData.bagMap[t].num=e.item_info.num,MyPersistDataManager._playerData.bagMap[t].bagId=e.item_info.bagId,null!=e.item_info.uuid&&""!=e.item_info.uuid&&(MyPersistDataManager._playerData.bagMap[t].enhance_level=e.item_info.enhance_level,MyPersistDataManager._playerData.bagMap[t].stars=e.item_info.stars,MyPersistDataManager._playerData.bagMap[t].hpEx=e.item_info.hpEx,MyPersistDataManager._playerData.bagMap[t].atkEx=e.item_info.atkEx,MyPersistDataManager._playerData.bagMap[t].defEx=e.item_info.defEx,MyPersistDataManager._playerData.bagMap[t].attrEx=e.item_info.attrEx,MyPersistDataManager._playerData.bagMap[t].unitAttr=e.item_info.unitAttr,MyPersistDataManager._playerData.bagMap[t].exp=0),MyPersistDataManager._playerData.bagMap[t].num<=0){delete MyPersistDataManager._playerData.bagMap[t];for(var n=-1,i=MyPersistDataManager._playerData.baglist.length-1;0<=i;--i)
if(""!=e.item_info.uuid)
MyPersistDataManager._playerData.baglist[i].uuid==e.item_info.uuid&&(n=i);else if(MyPersistDataManager._playerData.baglist[i].template_id==e.item_info.template_id){n=i;break}
if(-1==n)
return;MyPersistDataManager._playerData.baglist.splice(n,1)}}},BagItems_auth_cb:function(e){MyPersistDataManager._playerData.baglist=e.item_list,MyPersistDataManager._playerData.bagMap={},MyPersistDataManager._playerData.expand_info=e.expand_info,MyPersistDataManager._playerData.baglist.forEach(function(e,t){""!=e.uuid?MyPersistDataManager._playerData.bagMap[e.uuid]=e:MyPersistDataManager._playerData.bagMap[e.template_id]=e}),null!=DonotDestroyManager.GameData&&null!=DonotDestroyManager.GameData.Items&&s.initItemList(e.item_list)},PlayerKickOff_auth_cb:function(e){null!=this._alert_layer&&cc.isValid(this._alert_layer)||(this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer));this._alert_layer.getComponent("AlertLayerManager").initContent("Đang nạp hoặc nhận giftcode vui lòng làm mới lại game!",function(){null!=window.open_platform&&6==window.open_platform?window.H5API.logout():(2==DonotDestroyManager.jsbChannel?window.webkit.messageHandlers.logout.postMessage(null):11==DonotDestroyManager.jsbChannel?cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","logout","()V"):jsb.reflection.callStaticMethod("SDKHandler","logOut"):12==DonotDestroyManager.jsbChannel&&(cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","logout","()V"):jsb.reflection.callStaticMethod("QuickSDKHandler","logOut")),d.restartGame())},!1)},onDestroy:function(){f.removeListener(a.S2CPlayerKickOff,this.PlayerKickOff_auth_cb_func),f.removeListener(a.S2CBagItems,this.BagItems_auth_cb_func),f.removeListener(a.PushItemChange,this.PushItemChange_auth_cb_func),f.removeListener(a.PushPropertyChange,this.PushPropertyChange_auth_cb_func),f.removeListener(a.PushNewMail,this.GetNewMail_auth_cb_func),f.removeListener(a.S2CCardList,this.CardList_auth_cb_func),f.removeListener(a.PushAddCard,this.PushAddCard_auth_cb_func),f.removeListener(a.S2CStageList,this.S2CStageList_auth_cb_func),f.removeListener(a.PushMissionChange,this.MissionChange_auth_cb_func),f.removeListener(a.PushDailyMissionChange,this.DailyMissionChange_auth_cb_func),f.removeListener(a.PushGuideInfo,this.PushGuideInfo_cb_func),f.removeListener("NetWork-Error",this.NetworkError_cb_func),f.removeListener(a.S2CDownlineReconnect,this.S2CDownlineReconnect_cb_func),f.removeListener(a.S2CChargeInfo,this.S2CChargeInfo_cb_func),f.removeListener(a.PushPaymentResult,this.PushPaymentResult_cb_func),f.removeListener(a.PushFirstPay,this.PushFirstPay_cb_func),f.removeListener(a.PushMarquee,this.PushMarquee_cb_func),f.removeListener(a.PushSmallTips,this.PushSmallTips_cb_func),f.removeListener(a.PushTeamSkillUnlock,this.PushTeamSkillUnlock_cb_func),f.removeListener(a.PushCardAddLevel,this.PushCardAddLevel_cb_func),f.removeListener(a.S2CMineDefFormationSave,this.S2CMineDefFormationSave_cb_func),f.removeListener(a.S2CQunheiPayPre,this.S2CQunheiPayPre_cb_func),f.removeListener(a.S2CZMPayCheck,this.S2CZMPayCheck_cb_func),f.removeListener(a.S2C333PayPre,this.S2C333PayPre_cb_func),f.removeListener(a.S2CChongChongPayPre,this.S2CChongChongPayPre_cb_func),f.removeListener(a.S2C4399PayPre,this.S2C4399PayPre_cb_func),f.removeListener(a.S2CWanBaGetBalance,this.S2CWanBaGetBalance_cb_func),f.removeListener(a.PushIosIAPVerify,this.PushIosIAPVerify_cb_func),f.removeListener(g.YiJieLoginSuccessJsbCallback,this.YiJieLoginSuccessJsbCallback_cb_func),f.removeListener(a.S2CArenaBattleStart,this.S2CArenaBattleStart_cb_func),f.removeListener(a.S2CTreasureRobBattleStart,this.S2CTreasureRobBattleStart_cb_func),f.removeListener(a.S2CMineEnemyDetail,this.S2CMineEnemyDetail_cb_func),f.removeListener(a.S2CGuozhanBattleStart,this.S2CGuozhanBattleStart_cb_func),f.removeListener(a.S2CGuozhanOfficeStart,this.S2CGuozhanOfficeStart_cb_func),f.removeListener(a.S2COvercomeInfoAll,this.OvercomeInfoAll_auth_cb_func),f.removeListener(a.S2CPkEnemyFormation,this.S2CPkEnemyFormation_cb_func),f.removeListener(a.S2CBossBattleStart,this.S2CBossBattleStart_cb_func),f.removeListener(a.S2CGuoZhanCityMove,this.S2CGuoZhanCityMove_cb_func)}}),cc._RF.pop()},{AreanBattleManager:"AreanBattleManager",BattleBufferMgr:"BattleBufferMgr",BossBufferMgr:"BossBufferMgr",EquipBufferMgr:"EquipBufferMgr",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",GuozhanBufferMgr:"GuozhanBufferMgr",GuozhanFightBufferMgr:"GuozhanFightBufferMgr",HeroBufferMgr:"HeroBufferMgr",ItemBufferMgr:"ItemBufferMgr",LejiSocket:"LejiSocket",MarqueeBufferMgr:"MarqueeBufferMgr",MineBattleManager:"MineBattleManager",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",OverComeBufferMgr:"OverComeBufferMgr",PkBattleManager:"PkBattleManager",PlayerBufferMgr:"PlayerBufferMgr",PlayerDataManager:"PlayerDataManager",SnatchBattleManager:"SnatchBattleManager",SoundUtil:"SoundUtil",StageBufferMgr:"StageBufferMgr",TeamSkillBufferMgr:"TeamSkillBufferMgr",i18n:"i18n"}],NewScript:[function(e,t,a){"use strict";cc._RF.push(t,"72ae9VGzQZCnaxkQ1ZfyuB9","NewScript");var n=e("ShaderUtil");cc.Class({extends:cc.Component,properties:{my_zorder:cc.Integer},onLoad:function(){this.node.setLocalZOrder(this.node.getPosition().y),n.setGaryShader(this.node)}}),cc._RF.pop()},{ShaderUtil:"ShaderUtil"}],OfflineRewardsWidget:[function(e,t,a){"use strict";cc._RF.push(t,"ff019Cw6/hLabLX+yblr/En","OfflineRewardsWidget");var n=e("SoundUtil"),i=e("NetEvent"),r=e("MyEventDispatcher"),s=e("MyProtocols"),o=e("i18n"),c=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{lab_offline_time:cc.Label,lab_level_up:cc.RichText,node_itemBoxRoot:cc.Node,lab_exp:cc.Label,lab_copper:cc.Label,lab_energy:cc.Label,lab_stamina:cc.Label,lab_doubleGet:cc.Label,btn_doubleGet:cc.Node,lab_costJinkuai:cc.Label,node_tips:cc.Node,node_confirm:cc.Node,first_guide_node:cc.Node,_costJinKuai:0,m_pItemBoxPrefab:cc.Prefab,m_pItemEffect:cc.Prefab,pre_rollFrame:cc.Prefab,_propAddInfo:[]},onLoad:function(){this.S2COfflineAwardDouble_cb_func=this.S2COfflineAwardDouble_cb.bind(this),r.addListener(i.S2COfflineAwardDouble,this.S2COfflineAwardDouble_cb_func),this.node_tips.on("touchstart",this.onTipsTouchBegan,this),this.node_tips.on("touchcancel",this.onTipsTouchEnded,this),this.node_tips.on("touchend",this.onTipsTouchEnded,this)},onTipsTouchBegan:function(){var e=this.node_tips.convertToWorldSpaceAR(cc.v2(70,70));MyUiManager.OpenTextTipsWidget(e,"Trường hợp túi đồ đầy, trang bị hoặc vật phẩm thừa sẽ tự động chuyển thành Xu!")},onTipsTouchEnded:function(){MyUiManager.CloseTextTipsWidget()},onDestroy:function(){r.removeListener(i.S2COfflineAwardDouble,this.S2COfflineAwardDouble_cb_func)},S2COfflineAwardDouble_cb:function(e){if(MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),o.t("offline_award001")),0<MyPersistDataManager._offlineAwardInfo.offline_add_level+e.add_level){var t=cc.js.formatStr("tăng lv: lv hiện tại <color=#00ff00>%d</c>, tăng <color=#00ff00>%d</color> cấp",MyPersistDataManager._playerData.level,MyPersistDataManager._offlineAwardInfo.offline_add_level+e.add_level);this.lab_level_up.string=t}else
this.lab_level_up.string="";var a=MyPersistDataManager._offlineAwardInfo.offline_rewards;0<this._propAddInfo[0]&&(this.lab_exp.string="x"+2*this._propAddInfo[0]),0<this._propAddInfo[1]&&(this.lab_copper.string="x"+2*this._propAddInfo[1]),0<this._propAddInfo[2]&&(this.lab_energy.string="x"+2*this._propAddInfo[2]),0<this._propAddInfo[3]&&(this.lab_stamina.string="x"+2*this._propAddInfo[3]);for(var n=0;n<a.length;n++){var i=a[n];this.node_itemBoxRoot.children[n].getComponent("ItemBox").ChangeItemNum(2*i.cnt)}
this.lab_doubleGet.node.active=!1,this.btn_doubleGet.active=!1},changeData:function(e){this._closeCb=e;var t=MyPersistDataManager._offlineAwardInfo.offline_minutes,a=t/1440,n="Thời gian offline: ";1<=a&&(n+=Math.ceil(a)+" ngày ");var i=(t%=1440)/60;1<=i&&(n+=Math.ceil(i)+" tiếng ");var r=t%60;if(n+=Math.ceil(r)+" phút ",this.lab_offline_time.string=n,0<MyPersistDataManager._offlineAwardInfo.offline_add_level){var s=cc.js.formatStr("tăng lv: lv hiện tại <color=#00ff00>%d</c>, tăng <color=#00ff00>%d</color> cấp",MyPersistDataManager._playerData.level,MyPersistDataManager._offlineAwardInfo.offline_add_level);this.lab_level_up.string=s}else
this.lab_level_up.string="";var o=MyPersistDataManager._offlineAwardInfo.offline_rewards;this._propAddInfo=[0,0,0,0];for(var c=o.length-1;0<=c;c--){1452==(h=o[c]).itemId?(this.lab_exp.string="x"+h.cnt,o.splice(c,1),this._propAddInfo[0]=h.cnt):1450==h.itemId?(this.lab_copper.string="x"+h.cnt,o.splice(c,1),this._propAddInfo[1]=h.cnt):1453==h.itemId?(this.lab_energy.string="x"+h.cnt,o.splice(c,1),this._propAddInfo[2]=h.cnt):1454==h.itemId&&(this.lab_stamina.string="x"+h.cnt,o.splice(c,1),this._propAddInfo[3]=h.cnt)}
o.sort(function(e,t){return e.itemId-t.itemId});for(var l=0;l<o.length;l++){var h=o[l];this.CreateItemBox(h.itemId,h.cnt)}
this._costJinKuai=10*MyPersistDataManager._offlineAwardInfo.offline_minutes,this.lab_costJinkuai.string=cc.js.formatStr("x%d",this._costJinKuai)},CreateItemBox:function(e,t){var a=cc.instantiate(this.m_pItemBoxPrefab);this.node_itemBoxRoot.addChild(a);var n=a.getComponent("ItemBox");if(n.ChangeItemInfo(e,t,!0,null,!0),null!=n._itemjsoninfo.tier&&0<n._itemjsoninfo.tier&&(n._tiereffect=cc.instantiate(this.m_pItemEffect),a.addChild(n._tiereffect)),null!=DonotDestroyManager.GameData.Cards[e]&&3<=DonotDestroyManager.GameData.Cards[e].quality){var i=cc.instantiate(this.pre_rollFrame);a.addChild(i)}},CloseHander:function(e,t){n.playBtnCloseEffect(),this.node.destroy(),(MyPersistDataManager._offlineAwardInfo=null)!=this._closeCb&&this._closeCb()},GetDoubleHandler:function(e,t){if(n.playBtnOpenEffect(),MyPersistDataManager._playerData.money<this._costJinKuai){var a=this;this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent("Không đủ Vàng, bấm đến giao diện nạp",function(){a._alert_layer.removeFromParent(),a._alert_layer.destroy(),a._alert_layer=null,MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1})})}else{this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer);a=this;this._alert_layer.getComponent("AlertLayerManager").initContent("Có tiêu 【"+this._costJinKuai+"】 vàng nhận thưởng x2?",function(){a._alert_layer.removeFromParent(),a._alert_layer.destroy(),a._alert_layer=null,s.send_C2SOfflineAwardDouble(DonotDestroyManager._gameSocket)})}},start:function(){this.node.runAction(cc.sequence(cc.delayTime(.25),cc.callFunc(function(){this.showGuide()},this))),1<MyPersistDataManager._playerData.level&&(this.first_guide_node.active=!1)},update:function(e){},showGuide:function(){var t=this;c.showGuide("OfflineRewardsWidget",function(e){if(1==e)
return t.node_confirm})}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],OverComeBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"cbe1a7OqUpE5IqpOkuHxyTq","OverComeBufferMgr");var r=e("HeroBufferMgr"),i=e("HeroConfigMgr"),s=e("EnermyBufferMgr"),n=function(){this.ocBattle=!1,this.mOurHerosHpdatas={},this.mOverComeBuffer=null};n.prototype.initBuffer=function(e){this.mOverComeBuffer=e,this.mEnemys=e.current_enemy,this.mStage=e.stage_index<=0?0:e.stage_index,this.mPassStage=0==e.haveReward?this.mStage:this.mStage-1,this.mHaveReward=e.haveReward,this.mTodayResets=e.todayResets,this.mOurHerosHpdatas={};for(var t=0;t<e.heroHpData.length;++t){var a=e.heroHpData[t];(this.mOurHerosHpdatas[a.heroId]=a).hp=-1==a.hp?100:a.hp,a.unitNum=(a.unitNum,a.unitNum)}},n.prototype.initHpdataBuffer=function(e){for(var t=0;t<e.length;++t){var a=e[t];this.mOurHerosHpdatas[a.heroId]=a}},n.prototype.initOtrHerosHpdatas=function(e){if(s.getInstance().initEnermyData(e.current_enemy),this.mOtrHerosHpdatas={},null!=e.enemyHpData)
for(var t=0;t<e.enemyHpData.length;++t){var a=e.enemyHpData[t];if((this.mOtrHerosHpdatas[a.heroId]=a).hp=-1==a.hp?100:a.hp,-1==a.unitNum){var n=s.getInstance().getHeroByUid(a.heroId);a.unitNum=i.getHeroUnitNum(n.unitGrade,n.template_id)}}
null!=e.current_enemy&&(this.mRightHerosList=e.current_enemy.cards,this.mRightEmemyInfo=e.current_enemy)},n.prototype.getOtrHerosHpData=function(e){if(null==this.mOtrHerosHpdatas||null==this.mOtrHerosHpdatas[e]){var t=s.getInstance().getHeroByUid(e);return[100,i.getHeroUnitNum(t.unitGrade,t.template_id)]}
return[this.mOtrHerosHpdatas[e].hp,this.mOtrHerosHpdatas[e].unitNum]},n.prototype.setOverComeBattleModel=function(e){this.ocBattle=e},n.prototype.isOurHeroLive=function(e){var t=this.mOurHerosHpdatas[e];return!t||0!=t.hp},n.prototype.isOtrHeroLive=function(e){var t=this.mOtrHerosHpdatas[e];return!t||0!=t.hp},n.prototype.getCanResetTimes=function(){return DonotDestroyManager.GameData.Overcome.daily_reset_times[MyPersistDataManager._playerData.vip_level]-this.mOverComeBuffer.todayResets},n.prototype.getOurHeroHpdata=function(e){var t=this.mOurHerosHpdatas[e];if(t){if(t.hp=-1==t.hp?100:t.hp,-1==t.unitNum){var a=r.getHeroByUid(e);t.unitNum=r.getHeroUnitNum(a)}
return[t.hp,t.unitNum]}
a=r.getHeroByUid(e);return[100,r.getHeroUnitNum(a)]},n.prototype.getOurHp=function(e){var t=this.mOurHerosHpdatas[e];return t?t.hp:100},n.prototype.getOtrEmemyInfo=function(){return this.mRightEmemyInfo},n.prototype.resetCurStage=function(){this.mStage=0,this.mPassStage=0,this.mOverComeBuffer.stage_index=0},n.prototype.getCurStage=function(){return this.mStage},n.prototype.getFight=function(){for(var e=MyPersistDataManager._playerData.formation,t=Object.keys(e),a=0,n=0;n<t.length;++n){var i=t[n];if("formationId"!=i&&"forward"!=i&&"flip"!=i&&"fid"!=i)
if(0<e[i])
a+=r.getHeroFightVal(e[i])}
return a},t.exports=new n,cc._RF.pop()},{EnermyBufferMgr:"EnermyBufferMgr",HeroBufferMgr:"HeroBufferMgr",HeroConfigMgr:"HeroConfigMgr"}],OverComeCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"a8fd91jNapAhqbB/hLzhYI6","OverComeCfgMgr");var o=e("UnLockCfgMgr"),n=function(){};n.getPerDayResetCount=function(){var e=DonotDestroyManager.GameData.Overcome,t=MyPersistDataManager._playerData.vip_level;return null==e.daily_reset_times[t]&&print("vip thu hoạch trọng trí số lần phát sinh sai lầm ；vip=",t),e.daily_reset_times[t]},n.getDropGameMoney=function(e){var t=DonotDestroyManager.GameData.Overcome,a=1+t.gamemoney_percentage/100,n=MyPersistDataManager._playerData.level-o.getFTUnLockLevel(),i=Math.pow(a,n),r=t.gamemoney_base,s=t.battles[e].gamemoney_coef;return Math.ceil(i*r*s)},t.exports=n,cc._RF.pop()},{UnLockCfgMgr:"UnLockCfgMgr"}],OverComeTips:[function(e,t,a){"use strict";cc._RF.push(t,"81fc9DvcixH+ZEXEu7ONFQD","OverComeTips");var n=e("SoundUtil"),i=e("i18n"),r=e("MyProtocols");cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,tipsText:cc.RichText,_times:0,_canBuy:!1},onLoad:function(){},changeData:function(e){var t=0;null!=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.Common.overcome_exchange_item]&&(t=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.Common.overcome_exchange_item].num);var a=this._times=e;9<e&&(a=9);var n=DonotDestroyManager.GameData.Common.overcome_exchange_refresh_item[a][1];this.tipsText.string=i.t("shopmall_014",{value1:n,value2:e}),this._canBuy=n<=t},Refresh_onClickHandler:function(e,t){n.playBtnOpenEffect(),this._canBuy?(r.send_C2SOvercomeExchangeListRefresh(DonotDestroyManager._gameSocket),this.node.removeFromParent(),this.node.destroy()):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("shopmall_018"))},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Back_onClickHandler:function(){n.playBtnCloseEffect(),this.node.removeFromParent(),this.node.destroy()}}),cc._RF.pop()},{MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",i18n:"i18n"}],PVEBattleManager:[function(g,e,t){"use strict";cc._RF.push(e,"b861eYIIJlK1qYQSVpDG7cJ","PVEBattleManager");var y=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=g("BattleUtil"),i=g("TeamDataUtil"),u=g("BattleDataManager"),c=g("StageEventCfgMgr"),v=g("StagesConfigMgr"),M=g("BattleManager"),r=g("MyProtocols"),S=g("StageBufferMgr"),n=function(){};n.prototype.init=function(e,t,a){this.stageId=e,this.leftData=i.getLeftData(),this.leftData.fightVal=t,this.rightData=this.getPVERightData(e),this.rightData.fightVal=a,this.extraBattleTeam(),this.extraBattleBuff(),this.background=v.getStageBackground(e),this.mCrossGroup=!1;var n=v.getStageByStageId(e);this.mCostEnergy=n.energy_cost,this.mStageTag="PVE_NORMAL_"+this.stageId},n.prototype.extraBattleTeam=function(){for(var e=this.rightData.stage_event,t=c.getEvtTeamList(e),a=0;a<t.length;a++)
for(var n=t[a],i=0;i<n.length;i++){var r=n[i];if("left"==r.side)
for(var s=0;s<r.list.length;s++){var o=r.list[s];this.leftData.extraTeams.push(o)}
else if("right"==r.side)
for(s=0;s<r.list.length;s++){o=r.list[s];this.rightData.extraTeams.push(o)}}},n.prototype.extraBattleBuff=function(){for(var e=this.rightData.stage_event,t=c.getEvtBuffList(e),a=0;a<t.length;a++){var n=t[a];this.rightData.extraBuffs.push(n)}},n.prototype.getPVERightData=function(e){var t=v.getStageByStageId(e),a=DonotDestroyManager.GameData.StageMobs[e],n={};n.name=" đệ "+e%100+" quan ",n.side="right",n.level=t.require_level,n.formation=a.formation,n.forward=a.forward,n.flip=a.flip;var i=u.create(n);i.stageId=e,i.stage_event=t.stage_event,i.isMobHero=!0,i.stars=t.stars;for(var r=Object.keys(a),s=0;s<r.length;s++){var o=r[s];if("formation"!==o&&"forward"!==o&&"flip"!==o&&"battleground"!==o){var c=a[o];if(!DonotDestroyManager.GameData.Common.FIGHT_CONTROL_ENEMY[0]){var l={},h=t.attrs[c.mob_type-1];if(l.hero={},l.hero.id=c.mob_id,l.hero.level=h.level,l.hero.grade=h.card_grade,c.skill_enable){l.hero.skill_enable=[];for(var d=0;d<c.skill_enable.length;d++){var _=c.skill_enable[d];l.hero.skill_enable.push(_)}}
h.add_attrs.rates&&(l.hero.rates_maxhp=h.add_attrs.rates.maxhp,l.hero.rates_atk=h.add_attrs.rates.atk,l.hero.rates_def=h.add_attrs.rates.def),h.add_attrs.statics&&(l.hero.static_maxhp=h.add_attrs.statics.maxhp,l.hero.static_atk=h.add_attrs.statics.atk,l.hero.static_def=h.add_attrs.statics.def),l.unit_num=h.unit_num,l.unit_grade=h.unit_grade,l.unit_level=h.unit_level,i.addHeroWithPosition(l,c.position)}}}
return i},n.prototype.enterBattlefield=function(){var e={background:this.background,teamAiCfg:DonotDestroyManager.GameData.TeamSkillsAI[1][this.stageId],type:1},t=this;a.createBattlefield(this.leftData,this.rightData,e,function(){t.onSuccess()},function(){t.onFailure()}),null!=window.TDGA&&TDGA.onMissionBegin(this.stageId),a.enterRealScene()},n.prototype.onSuccess=function(){var e=v.getGroupIdByStage(this.stageId),t=v.getStageIndex(this.stageId),a=M.getFightTime(),n=M.getOurHPPercent(),i=M.getOurHeroDeadNum();r.send_C2SStageEnd(DonotDestroyManager._gameSocket,e-1,t,!0,a,n,i)},n.prototype.onSuccessCb=function(e){var t=DonotDestroyManager.GameData.Stages[e.group_index].stage[e.stage_index];if(null==MyPersistDataManager._playerData.chaptersMaplist[e.group_index+1]){var a={stages:[],star_award:[]};a.stages.push({star:e.star,times:e.times}),MyPersistDataManager._playerData.chaptersMaplist[e.group_index+1]=a,MyPersistDataManager._playerData.chapterslist.push(a);var n=t.id,i=v.getNextStage(n);S.setStageIdUnLock(i)}else{var r=MyPersistDataManager._playerData.chaptersMaplist[e.group_index+1].stages[e.stage_index];if(null==r){MyPersistDataManager._playerData.chaptersMaplist[e.group_index+1].stages[e.stage_index]={star:e.star,times:e.times};n=t.id,i=v.getNextStage(n);if(S.setStageIdUnLock(i),v.isLastStageIdInGroup(n)){var s=S.getCurChapGroupStageId(),o=y(s,2),c=(o[0],o[1]),l=v.getNextGroupId(c);S.setGroupUnlock(l),MyUiManager.RemoveBackList(MyUiManager.PanelInfo.StageSelectPanel.type)}}else
r.times=e.times,e.star>r.star&&(r.star=e.star)}
if(null!=window.TDGA&&TDGA.onMissionCompleted(t.id),M.btlWin){var h=M.getFightTime(),d=M.getOurHPPercent(),_=M.getOurHeroDeadNum();cc.log("PVEBattleManager ----------- %d,%d,%d",h,d,_);var u=g("BattleSceneMgr"),m=cc.instantiate(u.getInstance()._raw_assets["Prefab/ui/battle/battleWinPanel"]);cc.Canvas.instance.node.addChild(m);var p=m.getComponent("BattleWinMgr");e.addexp=t.exp,e.addGmoney=t.gamemoney,p.ChangeData(e),p.setStatistics(this.leftData,this.rightData,M.statistics),p.setStarCfg(t),p.sequencePlay()}else{u=g("BattleSceneMgr");var f=cc.instantiate(u.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(f),f.getComponent("BattleFailMgr").initUi(0,{staticData:M.statistics})}},n.prototype.onFailure=function(){var e=g("BattleSceneMgr"),t=cc.instantiate(e.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(t),t.getComponent("BattleFailMgr").initUi(0,{staticData:M.statistics}),null!=window.TDGA&&TDGA.onMissionFailed(this.stageId)},e.exports=new n,cc._RF.pop()},{BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleUtil:"BattleUtil",MyProtocols:"MyProtocols",StageBufferMgr:"StageBufferMgr",StageEventCfgMgr:"StageEventCfgMgr",StagesConfigMgr:"StagesConfigMgr",TeamDataUtil:"TeamDataUtil"}],PersistDataManager:[function(e,t,a){"use strict";cc._RF.push(t,"e02ecx456lCHIVURK0hZu1b","PersistDataManager");e("BattleManager");cc.Class({extends:cc.Component,properties:{_battleManager:Object,_playerData:Object,_tmpTdPaymentData:Object,_offlineAwardInfo:Object},onLoad:function(){this.resetData()},resetData:function(){this._playerData={id:0,in_game_session_id:"",account_id:"",name:"",sex:0,icon:1,head_frame:1,level:0,level_exp:0,fight:0,money:0,gameMoney:0,energy:0,vip_level:0,vip_exp:0,honor:0,stamina:0,server_id:0,nation_id:0,formationSlots:0,chargeInfo:null,baglist:null,expand_info:[],bagMap:null,cardslist:null,cardsMaplist:{},maillist:[],didOpenedMailBox:!1,chapterslist:[],chaptersMaplist:{},chapterselitelist:[],chapterseliteMap:{},formation:null,pvpformation:null,epicformation0:null,epicformation1:null,epicformation2:null,epicformation3:null,epicformation4:null,epicformation5:null,activityView1:null,activityView2:null,shopMallInfo:null,armyShopInfo:null,arenaShopInfo:null,overComeInfo:null,missionslist:[],daymissionlist:[],gamemoneyTimes:0,energyTimes:0,musicVolume:1,guideList:null,RedPoint:[],RedPointActivity:[],_firstEnterHome:!0},this._offlineAwardInfo={},this._hallInfo={},this._wanba_gift=null}}),cc._RF.pop()},{BattleManager:"BattleManager"}],PkBattleManager:[function(r,e,t){"use strict";cc._RF.push(e,"3e4f5hwYqxPL6M6Luf2igVN","PkBattleManager");r("TeamDataUtil");var _=r("BattleDataManager"),n=r("BattleUtil"),u=r("HeroConfigMgr"),a=r("MyProtocols"),d=r("PlayerBufferMgr"),m=r("HeroBufferMgr"),p=r("BattleBufferMgr"),s=r("PkBufferMgr"),o=r("BattleManager"),i=function(){};i.prototype.init=function(e,t,a){var n=DonotDestroyManager.GameData.StageMobs;this.leftData=this.getLeftData(),this.rightData=this.getRightData(e),this.leftData.fightVal=t,this.rightData.fightVal=a,this.background=n[101].battleground,this.mEmenyData=e},i.prototype.enterBattlefield=function(){var e=DonotDestroyManager.GameData.TeamSkillsAI,t={background:this.background,teamAiCfg:e[4],type:8},a=this;n.createBattlefield(this.leftData,this.rightData,t,function(){a.onSuccess()},function(){a.onFailure()}),n.enterRealScene()},i.prototype.onSuccess=function(){var e=this.mEmenyData.rand_key-MyPersistDataManager._playerData.id;a.send_C2SPkBattleCalculate(DonotDestroyManager._gameSocket,this.mEmenyData.target_player_id,1,e)},i.prototype.onFailure=function(){var e=this.mEmenyData.rand_key-MyPersistDataManager._playerData.id;a.send_C2SPkBattleCalculate(DonotDestroyManager._gameSocket,this.mEmenyData.target_player_id,0,e)},i.prototype.calculateS2cCb=function(e){s.setWinLooseInfo(e.winLooseCount);var t=r("BattleSceneMgr");if(0!=e.result){var a=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/PkWinPanel"]);cc.Canvas.instance.node.addChild(a);var n={info:e,leftinfo:this.leftData,rightinfo:this.rightData};a.getComponent("PkWinPanel").ChangeData(n),a.getComponent("PkWinPanel").setStatistics(this.leftData,this.rightData,o.statistics)}else{var i=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(i),i.getComponent("BattleFailMgr").initUi(8,{win_count:e.winLooseCount[0],loose_count:e.winLooseCount[1],staticData:o.statistics})}},i.prototype.getLeftData=function(){var e={side:"left"};e.name=d.getNickName(),e.level=d.getUserLevel();var t=p.getFormationData(2);e.formation=t.formationId,e.forward=t.forward,e.flip=t.flip;for(var a=_.create(e),n=Object.keys(t),i=0;i<n.length;++i){var r=n[i];if("fid"!=r&&"formationId"!=r&&"forward"!=r&&"flip"!=r&&"0"!=r){var s=t[r],o=m.getHeroByUid(s);o&&(delete o.hpPerc,delete o.atkPerc,a.addCardWithPosition(o,r))}}
for(var c=0;c<a.teams.length;c++){var l=a.teams[c],h=m.getExtraPropAttr(l.hero.heroId);l.hero.extraAttr=cc.clone(h)}
return a},i.prototype.getRightData=function(n){var e={side:"right"};e.name=n.base_info.nickname,e.level=n.base_info.level,e.fightVal=n.base_info.fight,e.formation=n.formation.formationId,e.forward=n.formation.forward,e.flip=n.formation.flip;for(var t=_.create(e),a=n.formation,i=[a.a,a.b,a.c,a.d,a.e,a.f,a.g,a.h,a.i,a.j],r=function(e){for(var t=Object.keys(n.formation),a=0;a<t.length;++a){if("fid"!=t[a]&&"formationId"!=t[a]&&"forward"!=t[a]&&"flip"!=t[a])
if(e==n.formation[t[a]])
return t[a]}},s=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a]},o=DonotDestroyManager.GameData.Common,c=0;c<i.length;++c){var l=i[c];if(!o.FIGHT_CONTROL_ENEMY[3]&&0!=l){var h=s(n.cards,l);if(null!=h){var d={hero:{}};d.hero.id=h.template_id,d.hero.heroId=h.template_id,d.hero.level=h.level,d.hero.grade=h.grade,d.unit_level=h.unitLevel,d.unit_grade=h.unitGrade,d.unit_num=u.getHeroUnitNum(d.hero.grade,d.hero.id),t.addHeroWithPosition(d,r(d.hero.id))}}}
return t},e.exports=new i,cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleUtil:"BattleUtil",HeroBufferMgr:"HeroBufferMgr",HeroConfigMgr:"HeroConfigMgr",MyProtocols:"MyProtocols",PkBufferMgr:"PkBufferMgr",PlayerBufferMgr:"PlayerBufferMgr",TeamDataUtil:"TeamDataUtil"}],PkBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"ffceeHIkglHvoqllNjUdu5N","PkBufferMgr");var n=e("EnermyBufferMgr"),i=function(){};i.prototype.initBuffer=function(e){this.mArenainfo=e,this.mEnemyList=e.enemys,this.mRankList=e.ranks,this.mExchangeList=e.items,this.setEmBattleLastPage(2),this.mOriRank=e.my_rank,e.prevStaminaTime},i.prototype.setRightHero=function(e){n.getInstance().initEnermyData(e),this.mEnemyInfo=e},i.prototype.getRightHero=function(){return this.mEnemyInfo},i.prototype.setWinLooseInfo=function(e){this.winLooseInfo=e},i.prototype.getWinLooseInfo=function(){return this.winLooseInfo},i.prototype.setRightIndex=function(e){this.mRightIndex=e},i.prototype.getRightIndex=function(){return this.mRightIndex},i.prototype.setEmBattleLastPage=function(e){this.lastPage=e},t.exports=new i,cc._RF.pop()},{EnermyBufferMgr:"EnermyBufferMgr"}],PkWinPanel:[function(e,t,a){"use strict";cc._RF.push(t,"8b49fWHLzxA6qTGa475Kg9X","PkWinPanel");e("GameUtils");var n=e("SoundUtil"),i=(e("GuideBufferMgr"),e("MarqueeBufferMgr"));cc.Class({extends:cc.Component,properties:{m_pwinpre:cc.Prefab,lab_winCount:cc.Label,lab_looseCount:cc.Label,node_uiAll:cc.Node,_recvdata:null,m_pRewardContent:cc.Node,m_pItemBoxPrefab:cc.Prefab,_mGetCardFinish:!1,_iscanclick:!1},onLoad:function(){},ChangeData:function(e){this._recvdata=e.info,this.Init()},Init:function(){this.InitData(),this.CreateWinarmature()},InitData:function(){this._iscanclick=!1,this._mGetCardFinish=!1,this.lab_winCount.string="Thắng:"+this._recvdata.winLooseCount[0],this.lab_looseCount.string="Bại:"+this._recvdata.winLooseCount[1],this.node_uiAll.active=!1;for(var e=0;e<this._recvdata.gain.length;++e){var t=cc.instantiate(this.m_pItemBoxPrefab);t.getComponent("ItemBox").ChangeItemInfo(this._recvdata.gain[e].item_template_id,this._recvdata.gain[e].item_count,!0,null,!0),this.m_pRewardContent.addChild(t)}},CreateWinarmature:function(){var t=this,e=cc.instantiate(this.m_pwinpre);this.node.addChild(e),e.setPosition(0,-50);var a=e.getComponent(sp.Skeleton);a.setAnimation(0,"action2",!1),a.setCompleteListener(function(e){t.showResultUi()})},showResultUi:function(){cc.log(" truyền phát tin thưởng cho động họa "),this._iscanclick=!0,this.node_uiAll.active=!0},Mask_OnClickHandler:function(e){this._iscanclick&&(n.playBtnCloseEffect(),MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),i.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome")},setStatistics:function(e,t,a){this.statistics={left:e,right:t,data:a};var n={damage:-1};a.teams.forEach(function(e,t){e.damage>n.damage&&"left"==e.data.hero.side&&(n=e)})},BattleDetail_onClickHandler:function(){var n=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/BattleDetailLayer/BattleDetailLayer",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.node)){null!=n._shortMask_node&&(n._shortMask_node.destroy(),n._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("BattleDetailLayer").ChangeData(n.statistics.data)}})}}),cc._RF.pop()},{GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",MarqueeBufferMgr:"MarqueeBufferMgr",SoundUtil:"SoundUtil"}],PlayerBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"ea48f8yi2dDVZBkX3a21s7h","PlayerBufferMgr");var n=function(){this.isShowAble=!1,this.fromLevel=1,this.toLevel=1};n.prototype.initPlayerLevel=function(e){this.fromLevel=e,this.toLevel=e},n.prototype.getUserId=function(){return MyPersistDataManager._playerData.id},n.prototype.getUserLevel=function(){return MyPersistDataManager._playerData.level},n.prototype.getUserGameVip=function(){return MyPersistDataManager._playerData.vip_level},n.prototype.getUserEnergy=function(){return MyPersistDataManager._playerData.energy},n.prototype.getUserStamina=function(){return MyPersistDataManager._playerData.stamina},n.prototype.getFormations=function(){return MyPersistDataManager._playerData.formationSlots},n.prototype.getNickName=function(){return MyPersistDataManager._playerData.name},n.prototype.getRoleID=function(){return MyPersistDataManager._playerData.sex},n.prototype.showLevelUpLayer=function(e,t){cc.Canvas.instance.node.addChild(e),e.getComponent("LevelUpLayer").setParams(this.fromLevel,this.toLevel,t),this.isShowAble=!1,this.fromLevel=this.toLevel},n.prototype.isLevelUpAble=function(){return this.isShowAble},n.prototype.setLevelUpAble=function(e){this.toLevel=e,this.isShowAble=!0},t.exports=new n,cc._RF.pop()},{}],PlayerDataManager:[function(e,t,a){"use strict";cc._RF.push(t,"b94c1aGueBLzKoeNhZeiEIZ","PlayerDataManager");var n=e("MyUIEvent"),i=(e("NetEvent"),e("MyEventDispatcher")),r=e("HeroConfigMgr"),s=cc.Class({extends:cc.Component,properties:{pname:cc.Label,level:cc.Label,money:cc.Label,gameMoney:cc.Label,energy:cc.Label,vip_level:cc.Label,headIcon:cc.Sprite,headIconSpriteFrame:[cc.SpriteFrame],spr_head_frame:cc.Sprite,lab_fight:cc.Label},statics:{instance:null,getInstance:function(){return s.instance}},onLoad:function(){(s.instance=this).refreshData(),this.onNameChange_cb_func=this.onNameChange_cb.bind(this),i.addListener(n.onNameChange,this.onNameChange_cb_func),this.onIconChange_cb_func=this.onIconChange_cb.bind(this),i.addListener(n.onIconChange,this.onIconChange_cb_func),this.onHeadFrameChange_cb_func=this.onHeadFrameChange_cb.bind(this),i.addListener(n.onHeadFrameChange,this.onHeadFrameChange_cb_func)},onHeadFrameChange_cb:function(e){this.doSetHeadFrame()},onNameChange_cb:function(e){this.pname.string=e},onIconChange_cb:function(e){this.doSetIcon()},refreshData:function(){this.pname.string=MyPersistDataManager._playerData.name,this.level.string=MyPersistDataManager._playerData.level,this.money.string=MyPersistDataManager._playerData.money,this.gameMoney.string=MyPersistDataManager._playerData.gameMoney,this.energy.string=MyPersistDataManager._playerData.energy+"/"+DonotDestroyManager.GameData.Levels[MyPersistDataManager._playerData.level-1].max_energy,this.vip_level.string=MyPersistDataManager._playerData.vip_level,this.lab_fight.string=MyPersistDataManager._playerData.fight,this.doSetIcon(),this.doSetHeadFrame()},doSetHeadFrame:function(){var e=DonotDestroyManager.GameData.HeadFrame[MyPersistDataManager._playerData.head_frame-1],a=this;cc.loader.loadRes("UI/HeadFrame/"+e.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=a&&cc.isValid(a.node)&&(a.spr_head_frame.spriteFrame=t)})},doSetIcon:function(){if(MyPersistDataManager._playerData.icon<10)
this.headIcon.spriteFrame=this.headIconSpriteFrame[MyPersistDataManager._playerData.icon-1];else{var e=MyPersistDataManager._playerData.icon-10,t=r.find(e);if(null!=t){var a=t.icon,n=this;cc.loader.loadRes("UI/Heros/"+a,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.headIcon)&&(n.headIcon.spriteFrame=t,n.headIcon.node.width=88,n.headIcon.node.height=88)})}}},onDestroy:function(){s.instance=null,i.removeListener(n.onNameChange,this.onNameChange_cb_func),i.removeListener(n.onIconChange,this.onIconChange_cb_func),i.removeListener(n.onHeadFrameChange,this.onHeadFrameChange_cb_func)}});cc._RF.pop()},{HeroConfigMgr:"HeroConfigMgr",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent"}],PropHintsEffect:[function(e,t,a){"use strict";cc._RF.push(t,"c1605wu3MBHgLNLo+31Vhm5","PropHintsEffect");var E=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},k=function(){};k.g_ScreenSize=[1334,750],k.hintsLeftPosX=null,k.hintsTopPosY=null,k.propLeftPosX=null,k.propTopPosY=null,k.defaultHintsTag=2e3,k.mesPropResPath="UI/PropHints/",k.isBlackLayer=null,k.textSize={0:[33,47],1:[40,64],2:[40,61]},k.getPropHintRes=function(e){return k.mesPropResPath+e},k.setBasePos=function(e,t,a,n){k.hintsLeftPosX=e,k.hintsTopPosY=t,k.propLeftPosX=a,k.propTopPosY=n},k.getNumValBit=function(e){var t=0;for(e=Math.floor(Math.abs(e));0!=e;)
t+=1,e=Math.floor(e/10);return t},k.cutNumTailVal=function(e){var t=Math.floor(100*e);return 0==t%10&&(t/=10),t},k.appendMathNumLabel=function(e,t,a,n,i){var r,s=20+(n.offset||0),o=cc.p(s,5);r=i[n.numPath];var c=new cc.Node,l=c.addComponent(cc.Label);if(l.font=r,c.setAnchorPoint(0,.5),c.setPosition(o),Math.abs(t)<1){var h=100*t;h=h.toFixed(2),l.string=Math.floor(h);var d=k.getNumValBit(h),_=s+(d=0==d?1:d)*a[0],u=k.CreateSprite(n.percPath,i);e.node.addChild(u.node,1,1),u.node.setPosition(_,5),u.node.setAnchorPoint(0,.5);var m=h-Math.floor(h);if(0<m){var p=k.CreateSprite(n.dotPath,i);p.node.setPosition(_,5),p.node.setAnchorPoint(0,1),e.node.addChild(p.node,1,1),_+=15;var f=i[n.numPath],g=new cc.Node,y=g.addComponent(cc.Label);y.font=f,g.setAnchorPoint(0,.5),y.string=k.cutNumTailVal(m),g.setPosition(_,5),e.node.addChild(g,1,1),_+=k.getNumValBit(k.cutNumTailVal(m))*a[0],u.node.setPosition(cc.p(_,5))}}else
l.string=Math.floor(t);e.node.addChild(c,2,2),cc.log(" vị trí ===="+c.getPosition())},k.fadeInAction=function(){return cc.sequence(cc.delayTime(.2),cc.fadeIn(1))},k.slowFadeInOut=function(e){return cc.sequence(cc.callFunc(function(){e.node.opacity=255}),cc.fadeOut(1.3),cc.callFunc(function(){e.node.opacity=0}))},k.movePropBanner=function(e,t,a,n,i,r){k.isBlackLayer&&(k.propLeftPosX=0,k.propTopPosY=-140,i());var s=50+t,o=cc.p(0,30),c=k.getPropHintRes("propTitle"+a),l=k.getPropHintRes("mask_propTitle"+a),h=k.getPropHintRes("med_add"),d=k.getPropHintRes("mask_med_add"),_=k.getPropHintRes("number_1"),u=k.getPropHintRes("mask_number_1"),m=k.getPropHintRes("dot"),p=k.getPropHintRes("mask_dot"),f=k.getPropHintRes("percent"),g=k.getPropHintRes("mask_percent");n<0&&(c=k.getPropHintRes("propTitleSub"+a),l=k.getPropHintRes("mask_propTitleSub"+a),h=k.getPropHintRes("med_sub"),d=k.getPropHintRes("mask_med_sub"),_=k.getPropHintRes("numberSub_1"),u=k.getPropHintRes("mask_numberSub_1"));var y=-30,v=0;14<=a&&a<=21&&(y+=v=70,o.x=o.x+v);var M=k.CreateSprite(null,r);M.node.setCascadeOpacityEnabled(!0);var S=k.CreateSprite(null,r),C=k.CreateSprite(c,r);C.node.setCascadeOpacityEnabled(!0),C.node.setAnchorPoint(1,.5),C.node.setPosition(cc.p(y,0)),M.node.addChild(C.node);var D=k.CreateSprite(l,r);D.node.setAnchorPoint(1,.5),D.node.setPosition(cc.p(-30,0)),S.node.addChild(D.node,9,9),D.node.opacity=100,S.node.setCascadeOpacityEnabled(!0);var I=k.CreateSprite(h,r);I.node.setPosition(o.x,0),I.node.setAnchorPoint(.5,.5),M.node.addChild(I.node,1,1);var b=k.CreateSprite(d,r);if(b.node.setPosition(o.x,0),S.node.addChild(b.node,1,1),k.appendMathNumLabel(M,n,k.textSize[0],{numPath:_,dotPath:m,percPath:f,offset:v},r),k.appendMathNumLabel(S,n,k.textSize[0],{numPath:u,dotPath:p,percPath:g,offset:v},r),e.addChild(M.node,s,s),M.node.setPosition(cc.p(k.propLeftPosX,k.propTopPosY-53*t)),k.isBlackLayer)
M.node.runAction(cc.sequence(cc.delayTime(1.2),cc.fadeOut(.15),cc.callFunc(function(){M.node.opacity=0})));else{var P=cc.sequence(cc.moveBy(.15,cc.p(0,15)).easing(cc.easeIn(.6)),cc.spawn(cc.sequence(cc.moveBy(.6,cc.p(0,30)),cc.spawn(cc.moveBy(.4,cc.p(0,17)),cc.fadeOut(.4))),cc.sequence(cc.delayTime(.15),cc.callFunc(function(){k.isBlackLayer||i()}))));S.node.opacity=0;var L=cc.sequence(cc.callFunc(function(){S.node.opacity=255}),cc.fadeOut(.3),cc.callFunc(function(){S.node.opacity=0}));M.node.runAction(P),S.node.runAction(L)}
cc.log("propCtn======="+M.node.getPosition())},k.createLvImg=function(o,e){if(o<=0)
return null;var t=function(e,t,a){var n=k.CreateSprite(e,a);n.node.setCascadeOpacityEnabled(!0),n.node.setAnchorPoint(.5,.5);var i=a[t],r=new cc.Node,s=r.addComponent(cc.Label);return s.font=i,s.string=o,r.setPosition(cc.p(35,0)),n.node.addChild(r,1,1),n},a=k.getPropHintRes("upgradeTips"),n=k.getPropHintRes("upgradeTipsMask"),i=k.getPropHintRes("number_2"),r=k.getPropHintRes("number_2");1<o&&(i=k.getPropHintRes("number_3"),r=k.getPropHintRes("number_3"));var s=t(a,i,e),c=t(n,r,e);return s.node.runAction(k.fadeInAction()),c.node.runAction(k.slowFadeInOut(c)),s.node.setPosition(cc.p(0,-78)),c.node.setPosition(cc.p(0,-78)),[s,c]},k.runStateNodeFunc=function(t,a,n,i){var r=1,s=a.length,o=new cc.Node;o.setCascadeOpacityEnabled(!0),t.addChild(o,3,3);var c=.6,l=.5;k.isBlackLayer&&(c=1.2,l=.15);var h=function(e){t.runAction(cc.sequence(cc.delayTime(c),cc.fadeOut(l),cc.callFunc(function(){t.removeFromParent(),t.destroy(),t=null,n&&n()})))};a.length<1?h():k.movePropBanner(o,r,a[r-1][0],a[r-1][1],function e(){if(s<(r+=1)){var t=cc.callFunc(h);o.runAction(t)}else
k.movePropBanner(o,r,a[r-1][0],a[r-1][1],e,i)},i)},k.setBlackBg=function(e){k.isBlackLayer=e},k.isBlackBg=function(){return k.isBlackLayer},k.addBlackLayer=function(e,t){k.setBlackBg(!0);var a=k.CreateSprite("",t);a.node.width=k.g_ScreenSize[0],a.node.height=k.g_ScreenSize[1],a.node.color=cc.Color.BLACK,a.node.setScale(100,100);var n=30;a.node.opacity=n;var i=cc.repeat(cc.sequence(cc.delayTime(.01),cc.callFunc(function(){220<(n+=10)&&(n=0,a.node.stopAllActions()),a.node.opacity=n})),30);a.node.runAction(i),e.addChild(a.node,0,0)},k.delayRunStateNodeFunc=function(e,t,a,n){k.runStateNodeFunc(e,t,a,n)},k.runRemoveHints=function(e){e.removeFromParent(),e.destroy(),e=null},k.modifyPropListDebug=function(e){propInfo={elemIdx:1,stateIdx:1,upgradeLv:1}},k.fixPropListVal=function(e){for(var t=[],a=0;a<e.length;++a)
0!=e[a][1]&&t.push(e[a]);return t},k.createFallWordAct=function(e){return cc.sequence(cc.scaleTo(.1,1).easing(cc.easeIn(.8)),cc.callFunc(e))},k.runHeroPropEffect=function(a,e,n,i,r){n=k.fixPropListVal(n);var t=e.elemIdx||1,s=e.stateIdx||1,o=e.upgradeLv||1,c=e.isRemove||!0,l=k.g_ScreenSize[0]/2,h=k.g_ScreenSize[1],d=l-80,_=h-120,u=l-80,m=h-270;if(e.propPos){var p=e.propPos;u=null!=p.x?p.x:u,m=null!=p.y?p.y:m}
if(e.tipPos){var f=e.tipPos;d=null!=f.x?f.x:d,_=null!=f.y?f.y:_}
k.setBasePos(d,_,u,m);var g=a.getChildByTag(k.defaultHintsTag);g&&c&&k.runRemoveHints(g);var y=k.CreateSprite(null,r);y.node.setCascadeOpacityEnabled(!0);var v=function(e,t,a,n,i){var r=k.CreateSprite(null,i),s=k.CreateSprite(e,i);s.node.setCascadeOpacityEnabled(!0),s.node.setPosition(a),s.node.setAnchorPoint(1,.5);var o=k.CreateSprite(t,i);return o.node.setPosition(n),o.node.setAnchorPoint(0,.5),r.node.addChild(o.node,0,0),r.node.addChild(s.node,1,1),r.node.setAnchorPoint(.5,.5),r.node.setCascadeOpacityEnabled(!0),r},M=k.getPropHintRes("elemHints"+t),S=k.getPropHintRes("elemHints"+t+"Mask"),C=k.getPropHintRes("stateHints"+s),D=k.getPropHintRes("stateHints"+s+"Mask"),I=v(M,C,cc.p(0,0),cc.p(0,0),r),b=v(S,D,cc.p(0,0),cc.p(0,0),r);b.node.opacity=0,I.node.runAction(k.fadeInAction()),b.node.runAction(k.slowFadeInOut(b)),k.addBlackLayer(y.node,r),y.node.addChild(I.node,1,1),y.node.addChild(b.node,2,2);var P=k.createLvImg(o,r),L=E(P,2),B=L[0],w=L[1];B&&(y.node.addChild(B.node,2,2),y.node.addChild(w.node,2,2));y.node.setPosition(0,200),y.node.setAnchorPoint(.5,.5),y.node.setScale(2.5),y.node.runAction(k.createFallWordAct(function(){var e=r["Prefab/effect/propHints"],t=cc.instantiate(e);t.setPosition(0,0),a.addChild(t,k.defaultHintsTag+1,k.defaultHintsTag+1),t.getComponent(dragonBones.ArmatureDisplay).armature().animation.fadeIn("hintsHighlight",-1,-1,0,"normal"),k.delayRunStateNodeFunc(y.node,n,i,r)})),a.addChild(y.node,k.defaultHintsTag,k.defaultHintsTag)},k.runTextJumpHints=function(e,t,a,n,i){t=k.fixPropListVal(t);var r=k.g_ScreenSize[0]/2,s=k.g_ScreenSize[1],o=r-200,c=s-120,l=r-230,h=s-280;l=null!=a.x?a.x:l,h=null!=a.y?a.y:h,k.setBasePos(o,c,l,h);var d=e.getChildByTag(k.defaultHintsTag);d&&k.runRemoveHints(d),k.setBlackBg(!1);var _=k.CreateSprite(null,i);_.node.setCascadeOpacityEnabled(!0),k.delayRunStateNodeFunc(_.node,t,n,i),e.addChild(_.node,k.defaultHintsTag,k.defaultHintsTag)},k.runEquipPropEffect=function(a,e,n,i,o){if(1!=e.upgradeLv){n=k.fixPropListVal(n);var t=e.isRemove||!0,r=-60,s=-120,c=-60,l=-270;if(e.propPos){var h=e.propPos;c=null!=h.x&&h.x||c,l=null!=h.y&&h.y||l}
if(e.tipPos){var d=e.tipPos;r=null!=d.x&&d.x||r,s=null!=d.y&&d.y||s}
k.setBasePos(r,s,c,l);var _=a.getChildByTag(k.defaultHintsTag);_&&t&&k.runRemoveHints(_);var u=k.CreateSprite(null,o);u.node.setCascadeOpacityEnabled(!0);var m=function(e,t,a,n){var i=k.CreateSprite(null,o),r=k.CreateSprite(e,o);r.node.setCascadeOpacityEnabled(!0),r.node.setPosition(a),r.node.setAnchorPoint(1,.5);var s=k.CreateSprite(t,o);return s.node.setPosition(n),s.node.setAnchorPoint(0,.5),i.node.addChild(s.node,0,0),i.node.addChild(r.node,1,1),i.node.setAnchorPoint(.5,.5),i.node.setCascadeOpacityEnabled(!0),i},p=k.getPropHintRes("tipsFront1"),f=k.getPropHintRes("tipsFront1Mask"),g=k.getPropHintRes("tipsFront2"),y=k.getPropHintRes("tipsFront2Mask"),v=m(p,g,cc.p(-70,0),cc.p(-70,0)),M=m(f,y,cc.p(-70,0),cc.p(-70,0));v.node.addChild(M.node,2,2),M.node.opacity=0,v.node.runAction(k.fadeInAction()),M.node.runAction(k.slowFadeInOut(M)),k.addBlackLayer(u.node,o),u.node.addChild(v.node,1,1);var S=k.createLvImg(e.upgradeLv,o),C=E(S,2),D=C[0],I=C[1];D&&(u.node.addChild(D.node),u.node.addChild(I.node));u.node.setPosition(0,200),u.node.setAnchorPoint(.5,.5),u.node.setScale(2.5),u.node.runAction(k.createFallWordAct(function(){var e=o["Prefab/effect/propHints"],t=cc.instantiate(e);t.setPosition(0,0),a.addChild(t,k.defaultHintsTag+1,k.defaultHintsTag+1),t.getComponent(dragonBones.ArmatureDisplay).armature().animation.fadeIn("hintsHighlight",-1,-1,0,"normal"),k.delayRunStateNodeFunc(u.node,n,i,o)})),a.addChild(u.node,k.defaultHintsTag,k.defaultHintsTag)}else
k.runHeroPropEffect(a,e,n,i,o)},k.runEquipTiersEffect=function(e,t,a,n){t=k.fixPropListVal(t);var i=k.g_ScreenSize[0]/2,r=k.g_ScreenSize[1];k.setBasePos(i+50,r-198,50,0);var s=e.getChildByTag(k.defaultHintsTag);s&&k.runRemoveHints(s),k.setBlackBg(!1);var o=k.CreateSprite(null,n);o.node.setCascadeOpacityEnabled(!0);var c=k.getPropHintRes("tier"+a),l=k.CreateSprite(c,n);l.node.setCascadeOpacityEnabled(!0),l.node.setPosition(cc.p(-10,150));var h=k.getPropHintRes("activate_hint"),d=k.CreateSprite(h,n);d.node.setPosition(cc.p(120,0)),l.node.addChild(d.node,0,0),o.node.addChild(l.node,0,0),k.delayRunStateNodeFunc(o.node,t,null,n),e.addChild(o.node,k.defaultHintsTag,k.defaultHintsTag)},k.CreateSprite=function(a,n){var i=(new cc.Node).addComponent(cc.Sprite);return null==a||""==a||(null!=n[a]?i.spriteFrame=n[a]:cc.loader.loadRes(a,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),i.spriteFrame=t,null!=n&&null==n[a]&&(n[a]=t)})),i},t.exports=k,cc._RF.pop()},{}],PropHitsRes:[function(e,t,a){"use strict";cc._RF.push(t,"8d3591Xd/xKA6FUfL2VWGsG","PropHitsRes");t.exports=["UI/PropHints/activate_hint","UI/PropHints/activate_hintMask","UI/PropHints/dot","UI/PropHints/elemHints1","UI/PropHints/elemHints1Mask","UI/PropHints/elemHints2","UI/PropHints/elemHints2Mask","UI/PropHints/elemHints3","UI/PropHints/elemHints3Mask","UI/PropHints/elemHints4","UI/PropHints/elemHints4Mask","UI/PropHints/elemHints5","UI/PropHints/elemHints5Mask","UI/PropHints/elemHints6","UI/PropHints/elemHints6Mask","UI/PropHints/elemHints7","UI/PropHints/elemHints7Mask","UI/PropHints/mask_dot","UI/PropHints/mask_med_add","UI/PropHints/mask_med_sub","UI/PropHints/mask_numberSub_1","UI/PropHints/mask_number_1","UI/PropHints/mask_percent","UI/PropHints/mask_percentSub","UI/PropHints/mask_propTitle1","UI/PropHints/mask_propTitle14","UI/PropHints/mask_propTitle15","UI/PropHints/mask_propTitle16","UI/PropHints/mask_propTitle17","UI/PropHints/mask_propTitle18","UI/PropHints/mask_propTitle19","UI/PropHints/mask_propTitle2","UI/PropHints/mask_propTitle20","UI/PropHints/mask_propTitle21","UI/PropHints/mask_propTitle3","UI/PropHints/mask_propTitle4","UI/PropHints/mask_propTitle5","UI/PropHints/mask_propTitle6","UI/PropHints/mask_propTitle7","UI/PropHints/mask_propTitle8","UI/PropHints/mask_propTitleSub1","UI/PropHints/mask_propTitleSub14","UI/PropHints/mask_propTitleSub15","UI/PropHints/mask_propTitleSub16","UI/PropHints/mask_propTitleSub17","UI/PropHints/mask_propTitleSub18","UI/PropHints/mask_propTitleSub19","UI/PropHints/mask_propTitleSub2","UI/PropHints/mask_propTitleSub20","UI/PropHints/mask_propTitleSub21","UI/PropHints/mask_propTitleSub3","UI/PropHints/med_add","UI/PropHints/med_sub","UI/PropHints/numberSub_1","UI/PropHints/number_1","UI/PropHints/number_2","UI/PropHints/number_3","UI/PropHints/number_4","UI/PropHints/percent","UI/PropHints/percentSub","UI/PropHints/propTitle1","UI/PropHints/propTitle14","UI/PropHints/propTitle15","UI/PropHints/propTitle16","UI/PropHints/propTitle17","UI/PropHints/propTitle18","UI/PropHints/propTitle19","UI/PropHints/propTitle2","UI/PropHints/propTitle20","UI/PropHints/propTitle21","UI/PropHints/propTitle3","UI/PropHints/propTitle4","UI/PropHints/propTitle5","UI/PropHints/propTitle6","UI/PropHints/propTitle7","UI/PropHints/propTitle8","UI/PropHints/propTitleSub1","UI/PropHints/propTitleSub14","UI/PropHints/propTitleSub15","UI/PropHints/propTitleSub16","UI/PropHints/propTitleSub17","UI/PropHints/propTitleSub18","UI/PropHints/propTitleSub19","UI/PropHints/propTitleSub2","UI/PropHints/propTitleSub21","UI/PropHints/propTitleSub22","UI/PropHints/propTitleSub3","UI/PropHints/stateHints1","UI/PropHints/stateHints1Mask","UI/PropHints/tier4500","UI/PropHints/tier4505","UI/PropHints/tier4506","UI/PropHints/tier4507","UI/PropHints/tier4508","UI/PropHints/tier4509","UI/PropHints/tier4510","UI/PropHints/tier4520","UI/PropHints/tier4530","UI/PropHints/tier4540","UI/PropHints/tier4550","UI/PropHints/tipsFront1","UI/PropHints/tipsFront1Mask","UI/PropHints/tipsFront2","UI/PropHints/tipsFront2Mask","UI/PropHints/upgradeTips","UI/PropHints/upgradeTipsMask"],cc._RF.pop()},{}],QieDjWidget:[function(e,t,a){"use strict";cc._RF.push(t,"09cf6m8GwpG65SQa4lk+pBw","QieDjWidget");var n=e("SoundUtil"),i=e("MyEventDispatcher"),r=e("NetEvent"),s=e("MyProtocols");cc.Class({extends:cc.Component,properties:{back_item_container:cc.Node,pre_rune_item_bag:cc.Prefab,lab_btn:cc.Label,m_pRewardPanel:cc.Prefab},onLoad:function(){this.S2CQedjAward_cb_func=this.S2CQedjAward_cb.bind(this),i.addListener(r.S2CQedjAward,this.S2CQedjAward_cb_func)},onDestroy:function(){i.removeListener(r.S2CQedjAward,this.S2CQedjAward_cb_func)},S2CQedjAward_cb:function(e){if(null!=e.rewards&&0<e.rewards.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.rewards}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Nhận thành công");this._netData.is_award_get=!0,this.lab_btn.string="Hôm nay đã nhận"},setParams:function(e){this._netData=e.info,this.closeCb=e.closeCb},start:function(){this.node.scale=.7,this.node.runAction(cc.sequence(cc.scaleTo(.15,1.2).easing(cc.easeOut(3)),cc.scaleTo(.08,1).easing(cc.easeIn(3))));for(var e=0;e<this._netData.rewards.length;e++){var t=this._netData.rewards[e],a=cc.instantiate(this.pre_rune_item_bag);this.back_item_container.addChild(a),a.getComponent("ItemBox").ChangeItemInfo(t.itemId,t.cnt,!0,null,!0)}
this._netData.is_award_get&&(this.lab_btn.string="Hôm nay đã nhận")},update:function(e){},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back()},jump_onClickHanlder:function(e,t){n.playBtnOpenEffect(),cc.sys.openURL("https://m.egame.qq.com/download/app?adtag=lmxldy")},reward_onClickHanlder:function(e,t){n.playBtnOpenEffect(),s.send_C2SQedjAward(DonotDestroyManager._gameSocket)}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],RankHeroItem:[function(e,t,a){"use strict";cc._RF.push(t,"544043G6GlKhpUk/FME439w","RankHeroItem");e("RankLayer"),e("MyProtocols"),e("SoundUtil"),e("i18n"),e("HeroConfigMgr");var d=e("ColorUtil");cc.Class({extends:cc.Component,properties:{_itemID:0,m_pLevel:cc.Label,m_pName:cc.Label,m_pSoilderType:cc.Sprite,m_pQuality:cc.Sprite,m_pHeroIcon:cc.Sprite,m_pBaner:cc.Sprite,m_pFight:cc.Label,lab_star:cc.Label,node_equip_layout:cc.Node,node_rune_layout:cc.Node,pre_eqip_item:cc.Prefab,pre_rune_item:cc.Prefab,rollingEffectPrefab:cc.Prefab,m_pBanerList:[cc.SpriteFrame],m_pUnitTypeSprList:[cc.SpriteFrame],m_pQualitySprList:[cc.SpriteFrame]},changeData:function(e,t){if(this._heroid=e.id,this._herojsoninfo=DonotDestroyManager.GameData.Cards[e.template_id],this.m_pLevel.string=e.level,this.m_pFight.string=e.fight,this.m_pQuality.spriteFrame=this.m_pQualitySprList[this._herojsoninfo.quality],this.m_pHeroIcon.spriteFrame=t["UI/Heros/"+this._herojsoninfo.icon],this.m_pSoilderType.spriteFrame=this.m_pUnitTypeSprList[this._herojsoninfo.unit_type-1],this.m_pBaner.spriteFrame=this.m_pBanerList[this._herojsoninfo.quality],this.m_pName.string=this._herojsoninfo.name,this.lab_star.string="+"+e.grade,null!=e.equips)
for(var a=0;a<e.equips.length;a++){var n=e.equips[a],i=0;null!=DonotDestroyManager.GameData.Equips[n]?i=DonotDestroyManager.GameData.Equips[n].quality:null!=DonotDestroyManager.GameData.Treasures[n]&&(i=DonotDestroyManager.GameData.Treasures[n].quality);var r=cc.instantiate(this.pre_eqip_item);this.node_equip_layout.addChild(r),r.children[0].color=d.getColorByQuality(i)}
if(null!=e.runes)
for(var s=0;s<e.runes.length;s++){var o=e.runes[s],c=DonotDestroyManager.GameData.Runes[o].quality,l=cc.instantiate(this.pre_rune_item);this.node_rune_layout.addChild(l),l.children[0].color=d.getColorByQuality(c)}
if(100<=this._herojsoninfo.potential){var h=cc.instantiate(this.rollingEffectPrefab);h.setScale(1.2),this.m_pHeroIcon.node.addChild(h)}},start:function(){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",HeroConfigMgr:"HeroConfigMgr",MyProtocols:"MyProtocols",RankLayer:"RankLayer",SoundUtil:"SoundUtil",i18n:"i18n"}],RankItem:[function(e,t,a){"use strict";cc._RF.push(t,"58b79lJThJLmIvrhTEzqd0e","RankItem");var o=e("RankLayer"),n=e("MyProtocols"),i=e("SoundUtil"),r=e("i18n"),c=e("HeroConfigMgr");cc.Class({extends:cc.Component,properties:{_itemID:0,spr_head_icon:cc.Sprite,spr_nead_frame:cc.Sprite,spr_bg_frame:cc.Sprite,res_head_icon:[cc.SpriteFrame],res_bg_frame:[cc.SpriteFrame],res_rank_icon:[cc.SpriteFrame],lab_player_name:cc.Label,lab_rank:cc.Label,lab_fight:cc.Label,lab_vip:cc.Label,lab_level:cc.Label,lab_custom_data:cc.Label,lab_likeCount:cc.Label,sprite_LikeIcon:cc.Sprite},updateItem:function(e){this._itemID=e,this._itemID>=o.getInstance()._netData.items.length?this.node.active=!1:(this.node.active=!0,this.showUI(o.getInstance()._netData.items[this._itemID]))},showUI:function(e){if(e.icon<10)
this.spr_head_icon.spriteFrame=this.res_head_icon[e.icon-1];else{var t=e.icon-10,a=c.find(t);if(null!=a){var n=a.icon,i=this;cc.loader.loadRes("UI/Heros/"+n,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=i&&cc.isValid(i.spr_head_icon)&&(i.spr_head_icon.spriteFrame=t,i.spr_head_icon.node.width=87,i.spr_head_icon.node.height=87)})}}
var r=DonotDestroyManager.GameData.HeadFrame[e.head_frame-1];i=this;cc.loader.loadRes("UI/HeadFrame/"+r.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=i&&cc.isValid(i.node)&&(i.spr_nead_frame.spriteFrame=t)}),this.lab_player_name.string=e.nickname,this.lab_rank.string=this._itemID+1,this.lab_fight.string=e.fight,this.lab_vip.string="VIP"+e.vipLevel,this.lab_level.string="Lv."+e.level,this.lab_likeCount.string=e.like_count;var s="";switch(o.getInstance()._netData.rank_type){case 2:s="Số lần thắng:"+e.win_count;break;case 4:s="Số Tướng Tím:"+e.hero_count;break;case 5:s="Tổng sao Tướng:"+e.hero_stars;break;case 6:s="Xếp hạng đấu trường:"+e.win_count}
this.lab_custom_data.string=s,e.playerId==MyPersistDataManager._playerData.id?this.spr_bg_frame.spriteFrame=this.res_bg_frame[1]:this.spr_bg_frame.spriteFrame=this.res_bg_frame[0],null!=o.getInstance()._netData.today_my_like_players&&-1<o.getInstance()._netData.today_my_like_players.indexOf(e.playerId)?this.sprite_LikeIcon.spriteFrame=this.res_rank_icon[1]:this.sprite_LikeIcon.spriteFrame=this.res_rank_icon[0]},ZR_clickHander:function(e,t){i.playBtnOpenEffect(),n.send_C2SRankPlayerDetail(DonotDestroyManager._gameSocket,o.getInstance()._netData.rank_type,o.getInstance()._netData.items[this._itemID].playerId)},PK_clickHander:function(e,t){i.playBtnOpenEffect(),o.getInstance()._netData.items[this._itemID].playerId!=MyPersistDataManager._playerData.id?n.send_C2SPkEnemyFormation(DonotDestroyManager._gameSocket,o.getInstance()._netData.items[this._itemID].playerId):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),r.t("pk001"))},likeClickHandler:function(e,t){i.playBtnOpenEffect(),null!=o.getInstance()._netData.today_my_like_players&&3<=o.getInstance()._netData.today_my_like_players.length?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),r.t("207")):n.send_C2SRankLike(DonotDestroyManager._gameSocket,o.getInstance()._netData.items[this._itemID].playerId)},updateLikeCount:function(e,t){o.getInstance()._netData.items[this._itemID].playerId==e&&(o.getInstance()._netData.items[this._itemID].like_count=t,this.lab_likeCount.string=t,this.sprite_LikeIcon.spriteFrame=this.res_rank_icon[1])},flashLikeIcon:function(){this.sprite_LikeIcon.node.runAction(cc.sequence(cc.delayTime(Math.random()),cc.scaleTo(.15,1.2).easing(cc.easeOut(3)),cc.scaleTo(.08,1).easing(cc.easeIn(3))))},start:function(){}}),cc._RF.pop()},{HeroConfigMgr:"HeroConfigMgr",MyProtocols:"MyProtocols",RankLayer:"RankLayer",SoundUtil:"SoundUtil",i18n:"i18n"}],RankLayer:[function(e,t,a){"use strict";cc._RF.push(t,"7e8cdyaQR9OLpkcifOofRtY","RankLayer");var n=e("SoundUtil"),i=e("MyProtocols"),r=e("MyEventDispatcher"),s=e("NetEvent"),o=e("PkBufferMgr"),c=e("BattleBufferMgr"),l=cc.Class({extends:cc.Component,properties:{lab_my_name:cc.Label,lab_my_level:cc.Label,lab_my_fight:cc.Label,lab_my_rank:cc.Label,lab_my_change:cc.Label,lab_pk_win:cc.Label,lab_pk_loose:cc.Label,m_playerDetailPrefab:cc.Prefab,m_pRewardPanel:cc.Prefab,m_pTabMenuNormalList:[cc.Sprite],res_tab_spr:[cc.SpriteFrame],_netData:null,_lastSelectTabMunuIndex:-1,_curSelectTabMenuIndex:-1,mScrollView:cc.ScrollView,itemTemplate:cc.Prefab,itemTemplateHeight:110,spawnCount:12,spacing:0,bufferZone:600},statics:{instance:null,getInstance:function(){return l.instance}},setParams:function(e){this._netData=e.info,this._closeCb=e.closeCb,this.SetSelectTabMenu(1),this.lab_my_name.string=MyPersistDataManager._playerData.name,this.lab_my_level.string="Lv."+MyPersistDataManager._playerData.level,this.lab_my_fight.string=MyPersistDataManager._playerData.fight,this.showMyRankStatus(),null==MyPersistDataManager._playerData.pvpformation&&i.send_C2SArenaFormation(DonotDestroyManager._gameSocket);var t=o.getWinLooseInfo();this.lab_pk_win.string="Thắng:"+t[0],this.lab_pk_loose.string="Thua:"+t[1]},showMyRankStatus:function(){this.lab_my_rank.string=this._netData.my_rank,0<this._netData.my_rank_change?(this.lab_my_change.string="+"+this._netData.my_rank_change,this.lab_my_change.node.color=cc.Color.GREEN):this._netData.my_rank_change<0?(this.lab_my_change.string=this._netData.my_rank_change,this.lab_my_change.node.color=cc.Color.RED):this.lab_my_change.string="Không có"},SetSelectTabMenu:function(e){this._curSelectTabMenuIndex!=e&&(-1!=this._lastSelectTabMunuIndex&&(this.m_pTabMenuNormalList[this._lastSelectTabMunuIndex-1].spriteFrame=this.res_tab_spr[0]),this._curSelectTabMenuIndex=e,this.m_pTabMenuNormalList[this._curSelectTabMenuIndex-1].spriteFrame=this.res_tab_spr[1],this._lastSelectTabMunuIndex=this._curSelectTabMenuIndex,this.CreateItemForGroup(e),this.mScrollView.stopAutoScroll(),this.mScrollView.scrollToTop())},CreateItemForGroup:function(e){if(this.content=this.mScrollView.content,this.content.height=this._netData.items.length*(this.itemTemplateHeight+this.spacing)+this.spacing,0==this.content.children.length){this._spawnItems=[],this.updateTimer=0,this.updateInterval=.2;for(var t=this.lastContentPosY=0;t<this.spawnCount;++t){var a=cc.instantiate(this.itemTemplate);this.content.addChild(a),a.setPosition(0,-a.height*(.5+t)-this.spacing*(t+1)),a.getComponent("RankItem").updateItem(t),a.getComponent("RankItem").flashLikeIcon(),this._spawnItems.push(a)}}else
for(var n=this.updateTimer=0;n<this.spawnCount;++n){var i=this._spawnItems[n];i.setPosition(0,-i.height*(.5+n)-this.spacing*(n+1)),i.getComponent("RankItem").updateItem(n)}},onLoad:function(){(l.instance=this).S2CRankView_cb_func=this.S2CRankView_cb.bind(this),r.addListener(s.S2CRankView,this.S2CRankView_cb_func),this.S2CRankPlayerDetail_cb_func=this.S2CRankPlayerDetail_cb.bind(this),r.addListener(s.S2CRankPlayerDetail,this.S2CRankPlayerDetail_cb_func),this.S2CPkEnemyFormation_cb_func=this.S2CPkEnemyFormation_cb.bind(this),r.addListener(s.S2CPkEnemyFormation,this.S2CPkEnemyFormation_cb_func),this.S2CRankLike_cb_func=this.S2CRankLike_cb.bind(this),r.addListener(s.S2CRankLike,this.S2CRankLike_cb_func),this.S2CArenaFormation_cb_func=this.S2CArenaFormation_cb.bind(this),r.addListener(s.S2CArenaFormation,this.S2CArenaFormation_cb_func)},S2CArenaFormation_cb:function(e){cc.log(" tiếp thu pvp đội hình tin tức "),MyPersistDataManager._playerData.pvpformation=e.formation,null!=e.formation&&c.setFormationData(2,e.formation)},S2CPkEnemyFormation_cb:function(e){cc.log(" chiến đấu tin tức tiếp thu "),o.setRightHero(e),this.OpenFormationLayer(e)},OpenFormationLayer:function(e){var t={name:e.base_info.nickname+"LV."+e.base_info.level,fight:e.base_info.fight,formation:e.formation.formationId,flip:e.formation.flip,forward:e.formation.forward,Teams:this.GetEnemyTeams(e),id:0};MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:t,panelinfo:{fid:2},battletype:8})},GetEnemyTeams:function(e){var t=[],a=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a].level;return 0};if(0<e.formation.a){var n=a(e.cards,e.formation.a);t.push({id:e.formation.a,level:n,position:"a"})}
if(0<e.formation.b){n=a(e.cards,e.formation.b);t.push({id:e.formation.b,level:n,position:"b"})}
if(0<e.formation.c){n=a(e.cards,e.formation.c);t.push({id:e.formation.c,level:n,position:"c"})}
if(0<e.formation.d){n=a(e.cards,e.formation.d);t.push({id:e.formation.d,level:n,position:"d"})}
if(0<e.formation.e){n=a(e.cards,e.formation.e);t.push({id:e.formation.e,level:n,position:"e"})}
if(0<e.formation.f){n=a(e.cards,e.formation.f);t.push({id:e.formation.f,level:n,position:"f"})}
if(0<e.formation.g){n=a(e.cards,e.formation.g);t.push({id:e.formation.g,level:n,position:"g"})}
if(0<e.formation.h){n=a(e.cards,e.formation.h);t.push({id:e.formation.h,level:n,position:"h"})}
if(0<e.formation.i){n=a(e.cards,e.formation.i);t.push({id:e.formation.i,level:n,position:"i"})}
if(0<e.formation.j){n=a(e.cards,e.formation.j);t.push({id:e.formation.j,level:n,position:"j"})}
return t},S2CRankLike_cb:function(e){if(null!=e.rewards&&0<e.rewards.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.rewards}
null==this._netData.today_my_like_players&&(this._netData.today_my_like_players=[]),this._netData.today_my_like_players.push(e.targetPlayerId);for(var a=0;a<this.spawnCount;++a){this._spawnItems[a].getComponent("RankItem").updateLikeCount(e.targetPlayerId,e.likeCount)}},S2CRankView_cb:function(e){this._netData=e,this.SetSelectTabMenu(e.rank_type),this.showMyRankStatus()},S2CRankPlayerDetail_cb:function(e){cc.log(" ngoạn gia anh hùng đội hình tin tức tiếp thu ");var t=cc.instantiate(this.m_playerDetailPrefab);cc.Canvas.instance.node.addChild(t),t.getComponent("RankPlayerDetail").ChangeData(e)},onDestroy:function(){l.instance=null,r.removeListener(s.S2CRankView,this.S2CRankView_cb_func),r.removeListener(s.S2CRankPlayerDetail,this.S2CRankPlayerDetail_cb_func),r.removeListener(s.S2CRankLike,this.S2CRankLike_cb_func),r.removeListener(s.S2CPkEnemyFormation,this.S2CPkEnemyFormation_cb_func),r.removeListener(s.S2CArenaFormation,this.S2CArenaFormation_cb_func)},start:function(){},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),null!=this._closeCb&&this._closeCb()},getPositionInView:function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.mScrollView.node.convertToNodeSpaceAR(t)},update:function(e){if(this.updateTimer+=e,!(this.updateTimer<this.updateInterval)){this.updateTimer=0;var t=this._spawnItems;if(null!=t){for(var a=this.bufferZone,n=this.mScrollView.content.y<this.lastContentPosY,i=(this.itemTemplateHeight+this.spacing)*t.length,r=0;r<t.length;++r){var s=this.getPositionInView(t[r]);if(n){if(s.y<-a&&t[r].y+i<0){t[r].setPositionY(t[r].y+i);var o=t[r].getComponent("RankItem"),c=o._itemID-t.length;o.updateItem(c)}}else if(s.y>a&&t[r].y-i>-this.content.height){t[r].setPositionY(t[r].y-i);var l=t[r].getComponent("RankItem"),h=l._itemID+t.length;l.updateItem(h)}}
this.lastContentPosY=this.mScrollView.content.y}}},LeftTabClickHander:function(e,t){n.playBtnOpenEffect();var a=parseInt(t);this._curSelectTabMenuIndex!=a&&i.send_C2SRankView(DonotDestroyManager._gameSocket,a)}});cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",PkBufferMgr:"PkBufferMgr",SoundUtil:"SoundUtil"}],RankPlayerDetail:[function(e,t,a){"use strict";cc._RF.push(t,"0f8725rMLxP9Im29YlkXCMR","RankPlayerDetail");e("RankLayer");var i=e("ResLoaderManager"),n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{spr_player_level:cc.Label,spr_player_name:cc.Label,spr_player_fight:cc.Label,m_pArmyItem:cc.Prefab,m_pItemParent:cc.Node,_raw_assets:{default:{},type:Object},lab_pk:cc.RichText},LoadRes:function(){this.toLoadResList=[],this._raw_assets={};for(var e=0;e<this._playerinfo.cardlist.length;++e){var t=DonotDestroyManager.GameData.Cards[this._playerinfo.cardlist[e].template_id];this.toLoadResList.push(["UI/Heros/"+t.icon,cc.SpriteFrame])}
var a=this._loadProgressCb.bind(this),n=this._loadFinishCb.bind(this);i.asyncLoadAll(this.toLoadResList,a,n)},_loadProgressCb:function(e){},_loadFinishCb:function(e,t){cc.log("load teamskill resources finish!"),t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this),this.Init()},ChangeData:function(e){this._playerinfo=e,this.LoadRes()},Init:function(){this.spr_player_name.string=this._playerinfo.rank_player.nickname,this.spr_player_level.string="LV."+this._playerinfo.rank_player.level,this.spr_player_fight.string=this._playerinfo.rank_player.fight,this.lab_pk.string="<color=#00ff00>"+this._playerinfo.pkWinLoose[0]+"</c> / <color=#ff0000>"+this._playerinfo.pkWinLoose[1]+"</color>",this.CreateArmyItem()},CreateArmyItem:function(){for(var e=0;e<this._playerinfo.cardlist.length;++e){var t=cc.instantiate(this.m_pArmyItem);this.m_pItemParent.addChild(t),t.getComponent("RankHeroItem").changeData(this._playerinfo.cardlist[e],this._raw_assets)}},Mask_OnClickHandler:function(e){n.playBtnCloseEffect(),this.node.destroy()},start:function(){}}),cc._RF.pop()},{RankLayer:"RankLayer",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil"}],RecruitAnimCtrl:[function(e,t,a){"use strict";cc._RF.push(t,"67c2f434etAjqvzgQnuCqPH","RecruitAnimCtrl");e("MainHomeManager"),e("SoundUtil");var i="normal",n=["RecruitBg","BarDesk","ShaoJiu","DuKangJiu","DuKangX10"],r=cc.Class({extends:cc.Component,properties:{AnimationList:[dragonBones.ArmatureDisplay],ClickMaskNode:cc.Node,RedLight:cc.Node,_isBuying:!1,_RecruitAnimConfig:null,_isFadeInComplete:!1,_closeSelf:!1},statics:{instance:null,getInstance:function(){return r.instance}},onLoad:function(){(r.instance=this)._RecruitAnimConfig=DonotDestroyManager.GameData.RecruitAnim,this.AnimationList[0].addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._BgAnimEventHandler,this),this.AnimationList[1].addEventListener(dragonBones.EventObject.COMPLETE,this._BarDeskActionHandler,this);for(var e=2;e<=4;e++)
this.AnimationList[e].addEventListener(dragonBones.EventObject.COMPLETE,this._BtnClickEnd,this);this.PlayPanelFadeInAnim()},onDestroy:function(){r.instance=null},setParams:function(e){this.closeCb=e.closeCb},_BtnClickEnd:function(e){var t=e.detail.animationState.name,a=e.detail.armature.name;if(this._RecruitAnimConfig[a].click==t){var n=this._getIndexByName(a);this.AnimationList[n].armature().animation.fadeIn(this._getActionName(a,"default"),.1,-1,0,i),this.node.getComponent("RecruitManager").BuyCardAnimaCb(n-1),cc.log(a+"----"+t)}},_getIndexByName:function(e){for(var t=0;t<n.length;t++)
if(n[t]==e)
return t;return null},_BarDeskActionHandler:function(e){var t=e.detail.animationState.name;switch(e.type){case dragonBones.EventObject.COMPLETE:t==this._RecruitAnimConfig.BarDesk.fadeOut?this._closeSelf&&(cc.log("Ok!Iam ready to destroy myself"),MyUiManager.Back(),this.closeCb&&this.closeCb()):t==this._RecruitAnimConfig.BarDesk.fadeIn&&(this.PlayDefaultAnim(),this._isFadeInComplete=!0,this.ClickMaskNode.active=!1);break;case dragonBones.EventObject.LOOP_COMPLETE:cc.log("Loop")}},_BgAnimEventHandler:function(e){var t=e.detail.animationState.name;if(this._RecruitAnimConfig.RecruitBg.recruitEpic==t||this._RecruitAnimConfig.RecruitBg.recruitNormal==t){this.node.getComponent("RecruitManager").CreatGetHeroPanel(),this._isBuying=!1,this.ClickMaskNode.active=!1;var a=this.PlayDefaultAnim.bind(this);setTimeout(a,2),this.node.active=!1}},PlayHeroComingAnim:function(e){this.PlayPanelFadeOutAnim(),3==e?this.AnimationList[0].armature().animation.fadeIn(this._getActionName(n[0],"recruitEpic"),.1,-1,0,i):this.AnimationList[0].armature().animation.fadeIn(this._getActionName(n[0],"recruitNormal"),.1,-1,0,i)},_getActionName:function(e,t){return this._RecruitAnimConfig[e][t]},PlayPanelFadeInAnim:function(){this.node.active=!0,this.RedLight.active=!0,this.ClickMaskNode.active=!0;for(var e=0;e<5;e++)
this.AnimationList[e].armature().animation.fadeIn(this._getActionName(n[e],"fadeIn"),.1,-1,0,i);this.node.getComponent("RecruitManager").UIFadeIn()},PlayPanelFadeOutAnim:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.RedLight.active=!1,this.ClickMaskNode.active=!0,this._closeSelf=e;for(var t=0;t<5;t++){var a=this._getActionName(n[t],"fadeOut");null!=a&&this.AnimationList[t].armature().animation.fadeIn(a,.1,-1,0,i)}
this.node.getComponent("RecruitManager").UIFadeOut()},PlayDefaultAnim:function(){for(var e=0;e<5;e++){var t=this._getActionName(n[e],"default");null!=t&&this.AnimationList[e].armature().animation.fadeIn(t,.1,-1,0,i)}},PlayerClickAnima:function(e){if(!this._isBuying&&this._isFadeInComplete){var t=this._getActionName(n[e],"click");null!=t&&(this.AnimationList[e].armature().animation.fadeIn(t,.1,-1,0,i),this.ClickMaskNode.active=!0,this._isBuying=!0),this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){var e=this.AnimationList[0].armature().animation,t=e.lastAnimationName;"action3"!=t&&"action4"!=t&&(this.ClickMaskNode.active=!1,this._isBuying=!1)},this)))}}});cc._RF.pop()},{MainHomeManager:"MainHomeManager",SoundUtil:"SoundUtil"}],RecruitManager:[function(e,t,a){"use strict";cc._RF.push(t,"2b308jyQB5HbpHY37iah1aj","RecruitManager");var i=e("MyProtocols"),n=e("NetEvent"),r=e("MyEventDispatcher"),s=e("SoundUtil"),o=e("ColorUtil"),c=e("MainHomeSceneManager"),l=e("GuideBufferMgr"),h=e("MyUIEvent"),d=cc.Class({extends:cc.Component,properties:{m_pBtnParent:cc.Node,m_pBack:cc.Node,DuKangTimeClockNode:cc.Node,DuKangTimeCount:cc.Label,jinKuaiLabel:cc.Label,FreeCardNodeList:[cc.Node],CanGetFreeCardLabel:cc.Node,UINode:cc.Node,GetHeroPanelPrefab:cc.Prefab,GetTenHeroPanelPrefab:cc.Prefab,ShaoJiuCount:cc.Label,DuKangNodeList:[cc.Node],JinKuaiNodeList:[cc.Node],_getHeroId:null,_getHeroIdList:null,_recruitType:0,_assetList:[]},statics:{instance:null,getInstance:function(){return d.instance}},onLoad:function(){(d.instance=this).UINode.opacity=0,this.RefreshFreeCardData_cb=this.RefreshFreeCardData.bind(this),r.addListener(n.S2CPubView,this.RefreshFreeCardData_cb),this.BuyCard_cb=this.BuyCard.bind(this),r.addListener(n.S2CPubBuy,this.BuyCard_cb),i.send_C2SPubView(DonotDestroyManager._gameSocket);var a=this;cc.loader.loadRes("sound/UI_jg",function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),MyBgMusicManager.play(t),a._assetList.push(t)}),this.jinKuaiLabel.string=MyPersistDataManager._playerData.money,this.MoneyChange_auth_cb_func=this.MoneyChange_auth_cb.bind(this),r.addListener(h.onGoldChange,this.MoneyChange_auth_cb_func)},MoneyChange_auth_cb:function(e){this.jinKuaiLabel.string=e},ResetCostItemCount:function(){var e=this._getItemNum(0),t=this._getItemNum(1),a=0<this.DuKangTimeClockNode.getComponent("TimeClock")._remainSeconds;0<t?(this.DuKangNodeList[0].active=a,this.DuKangNodeList[1].active=a,this.JinKuaiNodeList[0].active=!1,this.JinKuaiNodeList[1].active=!1,this.DuKangNodeList[1].getComponent(cc.Label).string="x1/"+t):(this.DuKangNodeList[0].active=!1,this.DuKangNodeList[1].active=!1,this.JinKuaiNodeList[0].active=a,this.JinKuaiNodeList[1].active=a),this.ShaoJiuCount.string=e,this.ShaoJiuCount.node.color=0==e?o.getColorByIndex(2):o.getColorByIndex(3)},jinKuai_OnClickHandler:function(e){s.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1})},RefreshFreeCardData:function(e){this.DuKangTimeCount.string=e.purple_times;var t=e.free_time2;if(0==t)
this.FreeCardNodeList.forEach(function(e){e.active=!1},this),this.CanGetFreeCardLabel.active=!0;else{this.FreeCardNodeList.forEach(function(e){e.active=!0},this),this.CanGetFreeCardLabel.active=!1;var a=function(){this.FreeCardNodeList.forEach(function(e){e.active=!1},this),i.send_C2SPubView(DonotDestroyManager._gameSocket)}.bind(this);this.DuKangTimeClockNode.getComponent("TimeClock").startCheckTime(t,a)}
this.ResetCostItemCount(),this.showGuide()},BuyCard:function(e){var t=e.cost_type;if(this._recruitType=e.cost_type,0==e.cards.length)
return this.node.getComponent("RecruitAnimCtrl").ClickMaskNode.active=!1,this.node.getComponent("RecruitAnimCtrl")._isBuying=!1,void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Chẳng rút được gì:(");if(2==t){this._getHeroId=e.cards[0].template_id;var a=DonotDestroyManager.GameData.Cards[this._getHeroId].quality;this.node.getComponent("RecruitAnimCtrl").PlayHeroComingAnim(a),this.DuKangTimeCount.string=e.purple_times,this.DuKangTimeClockNode.getComponent("TimeClock").startCheckTime(e.free_time2),this.ResetCostItemCount(),this.CanGetFreeCardLabel.activeInHierarchy&&i.send_C2SPubView(DonotDestroyManager._gameSocket)}else if(3==t){this._getHeroIdList=[];for(var n=0;n<e.cards.length;n++)
this._getHeroIdList.push(e.cards[n].template_id);a=3;this.node.getComponent("RecruitAnimCtrl").PlayHeroComingAnim(a)}else if(1==t){this._getHeroId=e.cards[0].template_id;a=DonotDestroyManager.GameData.Cards[this._getHeroId].quality;this.node.getComponent("RecruitAnimCtrl").PlayHeroComingAnim(a),this.ResetCostItemCount()}},CreatGetHeroPanel:function(){if(3!=this._recruitType){if(null==this._getHeroId)
return;var e=cc.instantiate(this.GetHeroPanelPrefab);cc.Canvas.instance.node.addChild(e),e.getComponent("GetHeroPanel").DoGetHeroAnim(this._getHeroId,this._recruitType)}else{if(null==this._getHeroIdList||0==this._getHeroIdList.length)
return;var t=cc.instantiate(this.GetTenHeroPanelPrefab);cc.Canvas.instance.node.addChild(t),t.getComponent("GetTenHeroPanel").DoAction(this._getHeroIdList)}},_getItemNum:function(e){var t=DonotDestroyManager.GameData.Common.recruit_hero_cost;return MyPersistDataManager._playerData.bagMap[t[e]]?MyPersistDataManager._playerData.bagMap[t[e]].num:0},BuyCardBtnHandler:function(e,t){s.playBtnOpenEffect();var a=parseInt(t),n=this.node.getComponent("RecruitAnimCtrl");switch(a){case 0:0<this._getItemNum(0)?n.PlayerClickAnima(a+2):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không đủ trà, mau đi đánh Phó Bản");break;case 1:if(0<this._getItemNum(1))
n.PlayerClickAnima(a+2);else if(this.CanGetFreeCardLabel.activeInHierarchy)
n.PlayerClickAnima(a+2);else if(1688<MyPersistDataManager._playerData.money)
n.PlayerClickAnima(a+2);else{var i=this;this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent("Không đủ Vàng, bấm đến giao diện nạp",function(){i._alert_layer.removeFromParent(),i._alert_layer.destroy(),i._alert_layer=null,MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1})})}
break;case 2:if(13888<MyPersistDataManager._playerData.money)
n.PlayerClickAnima(a+2);else{i=this;this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent("Không đủ Vàng, bấm đến giao diện nạp",function(){i._alert_layer.removeFromParent(),i._alert_layer.destroy(),i._alert_layer=null,MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1})})}}},BuyCardAnimaCb:function(e){i.send_C2SPubBuy(DonotDestroyManager._gameSocket,e),null==window.TDGA||2!=e&&3!=e||TDGA.onItemPurchase({item:"PUB#"+e,itemNumber:1,priceInVirtualCurrency:2==e?1600:13888})},UIFadeIn:function(){this.UINode.opacity=1;var e=this;this.UINode.runAction(cc.sequence(cc.fadeIn(.5),cc.callFunc(function(){e.showGuide()})))},UIFadeOut:function(){this.UINode.opacity=255,this.UINode.runAction(cc.fadeOut(.3))},clickHanlder_tujian:function(){s.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.TuJianPanel,{})},onDestroy:function(){r.removeListener(n.S2CPubView,this.RefreshFreeCardData_cb),r.removeListener(n.S2CPubBuy,this.BuyCard_cb),this._assetList=[],d.instance=null;var e=c.getInstance()._raw_assets.get("sound/zjm_01");MyBgMusicManager.play(e),r.removeListener(h.onGoldChange,this.MoneyChange_auth_cb_func)},BackBtn:function(e){s.playBtnCloseEffect(),this.node.getComponent("RecruitAnimCtrl").PlayPanelFadeOutAnim(!0)},showGuide:function(){var t=this;l.showGuide("RecruitManager",function(e){return 1==e?t.m_pBtnParent.getChildByName("btn0"):2==e?t.m_pBtnParent.getChildByName("btn1"):3==e?t.m_pBack:void 0})}});cc._RF.pop()},{ColorUtil:"ColorUtil",GuideBufferMgr:"GuideBufferMgr",MainHomeSceneManager:"MainHomeSceneManager",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],RegisterCharacterPanel:[function(e,t,a){"use strict";cc._RF.push(t,"ef0c37n1DVPia2kJ+FDanqS","RegisterCharacterPanel");var n=e("SelectRoleInfo"),d=e("MyProtocols"),i=e("NetEvent"),r=e("MyEventDispatcher"),s=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pName:cc.EditBox,m_pMan:cc.Sprite,m_pWoman:cc.Sprite,m_pManSpr:[cc.SpriteFrame],m_pWomanSpr:[cc.SpriteFrame],_curSelecttarget:null,_sessionid:null,_sex:null,_tmpName:""},start:function(){null==this._tmpName||""==this._tmpName?this.m_pName.string=n():this.m_pName.string=this._tmpName},setParams:function(e){this._sessionid=e.sessionId,this._tmpName=e.nickname,this._sex=1,this._createrole_auth_cb_func=this._createrole_auth_cb.bind(this),r.addListener(i.S2CCreateCharacter,this._createrole_auth_cb_func)},onDestroy:function(){r.removeListener(i.S2CCreateCharacter,this._createrole_auth_cb_func)},BtnOk_OnClickHandler:function(e){s.playBtnOpenEffect(),this._tmpName=this.m_pName.string,d.send_C2SCreateCharacter(DonotDestroyManager._gameSocket,this._sex,this.m_pName.string,this._sessionid)},_createrole_auth_cb:function(e){var t=e.character_id;cc.log(" sáng tạo nhân vật hồi điều ,roleid=%d",t);var a=null;if(null!=window.wanba_gift_id&&(a={wanba_gift_id:window.wanba_gift_id,appid:window.OPEN_DATA.appid,openid:window.OPEN_DATA.openid,openkey:window.OPEN_DATA.openkey,pf:window.OPEN_DATA.pf}),d.send_C2SEnterGame(DonotDestroyManager._gameSocket,this._sessionid,a),null!=window.open_platform)
switch(window.open_platform){case 1:var n={act:"1",serverid:i=cc.sys.localStorage.getItem("lastloginserver"),rolename:this._tmpName,roleid:t,level:"1"};qhsdk.role(n);break;case 2:window.reportRegister();break;case 3:var i,r=" phục vụ khí #"+(i=cc.sys.localStorage.getItem("lastloginserver"));null!=DonotDestroyManager._gameServerInfo&&(r=DonotDestroyManager._gameServerInfo.server_name),ZmSdk.getInstance().reportRoleStatus({datatype:"2",serverid:i.toString(),servername:r,roleid:t,rolename:this._tmpName,rolelevel:"1",fightvalue:"1"})}
if(2==DonotDestroyManager.jsbChannel){var s=cc.sys.localStorage.getItem("lastloginserver"),o=" phục vụ khí #"+s;null!=DonotDestroyManager._gameServerInfo&&(o=DonotDestroyManager._gameServerInfo.server_name);var c=new Date,l=Math.round(c.getTime()/1e3).toString(),h={roleId:t.toString(),roleName:this._tmpName,roleLevel:"1",zoneId:s,zoneName:o,balance:"0",vip:"0",partyName:" vô bang phái ",roleCTime:l,roleLevelMTime:l};window.webkit.messageHandlers.setData.postMessage({param1:"createrole",param2:JSON.stringify(h)})}
null!=window.TDGA&&window.TDGA.Account.setAccountName(this._tmpName)},RandomName_OnClickHandler:function(e){s.playBtnOpenEffect(),this.m_pName.string=n()},Man_OnClickHandler:function(e){this._curSelecttarget!=this.m_pMan&&(s.playBtnOpenEffect(),this.m_pWoman.spriteFrame=this.m_pWomanSpr[0],this.m_pMan.spriteFrame=this.m_pManSpr[1],this._curSelecttarget=this.m_pMan,this._sex=1)},WoMan_OnClickHandler:function(e){this._curSelecttarget!=this.m_pWoman&&(s.playBtnOpenEffect(),this.m_pWoman.spriteFrame=this.m_pWomanSpr[1],this.m_pMan.spriteFrame=this.m_pManSpr[0],this._curSelecttarget=this.m_pWoman,this._sex=2)}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SelectRoleInfo:"SelectRoleInfo",SoundUtil:"SoundUtil"}],ReinForceCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"6f771XULWxKR42u/ciAZ8Gv","ReinForceCfgMgr");var h=e("HeroConfigMgr");t.exports={getReinForceCfg:function(e){return DonotDestroyManager.GameData.Reinforce[e]},getTeamCfgList:function(e){var t=this.getReinForceCfg(e);if(null!=t){for(var a=t.troops,n=t.attrs,i=[],r=0;r<a.length;r++){var s=a[r],o={},c=n[s.mob_type-1];if(o.hero={},s.skill_enable){o.hero.skill_enable=[];for(r=0;r<s.skill_enable.length;r++){var l=s.skill_enable[r];o.hero.skill_enable.push(l)}}
o.hero.id=s.mob_id,o.hero.level=c.level,o.hero.grade=c.card_grade,o.hero.icon=h.find(s.mob_id).icon,o.unit_level=c.unit_level,o.unit_grade=c.unit_grade,o.unit_num=c.unit_num,o.row=s.position[1]-1,o.col=s.position[0]-1,o.delayMove=t.delayMove||0,i.push(o)}
return i}
cc.error("getTeamCfgList error,reinId=%d",e)}},cc._RF.pop()},{HeroConfigMgr:"HeroConfigMgr"}],RemoteArmy:[function(i,e,t){"use strict";cc._RF.push(e,"06b0ftz/3NPvpSUcg9vV/c9","RemoteArmy");var a=i("state-machine"),r=i("BattleConstants"),n=cc.Class({extends:i("Army"),properties:{},ctor:function(){cc.log("RemoteArmy create!")},setFSM:function(){var i=this;this.fsm=a.create({initial:"Idle",events:[{name:"Idle",from:["Move","Meet","Arrange","Strategy"],to:"Idle"},{name:"Move",from:"Idle",to:"Move"},{name:"Meet",from:["Idle","Move","Arrange"],to:"Meet"},{name:"Victory",from:"Idle",to:"Victory"},{name:"Destory",from:["Idle","Move","Meet","Arrange"],to:"Destory"},{name:"Arrange",from:["Move","Meet"],to:"Arrange"},{name:"Strategy",from:"Idle",to:"Strategy"}],callbacks:{onenterstate:function(e,t,a){},onenterFly:function(e,t,a,n){i.onenterFly(e,t,a,n)},onafterDead:function(){i.onafterDead()},onenterIdle:function(){i.onenterIdle()},onenterMove:function(){i.onenterMove()},onleaveMove:function(){i.onleaveMove()},onenterArrange:function(){i.onenterArrange()},onleaveArrange:function(){i.onleaveArrange()},onenterMeet:function(){i.onenterMeet()},onleaveMeet:function(){i.onleaveMeet()},onenterDestory:function(){i.onenterDestory()},onenterVictory:function(){i.onenterVictory()},onenterStrategy:function(){i.onenterStrategy()},onleaveStrategy:function(){i.onleaveStrategy()}}})},isAttackAble:function(){var e;return e=this.hero?this.hero.uCfg.atk_range:this.soldiers[0].cfg.atk_range,this.getDistance2Target(this.target)<e},isTargetAble:function(){return this.target&&"Destory"!=this.target.getState()&&"Strategy"!=this.target.getState()},onenterMeet:function(){var e,t,a,n;if(n=0<this.getVector2Target().x?1:-1,this.hero&&"Dead"!=this.hero.getState()){a=this.hero.getState();var i=this.hero.getPosition();e=i.x,t=i.y,this.hero.meet2Pos=cc.p(e+10*n,t),"Attack"!=a?this.hero.doEvent("Meet"):this.hero.nextEv="Idle"}
for(var r=0;r<this.soldiers.length;r++){var s=this.soldiers[r];a=s.getState();var o=Math.floor(r/5),c=r%5,l=s.getPosition();e=l.x,t=l.y,e=e+(70+35*o)*n+30*Math.abs(c-2)*n-15*Math.abs(o-2)*n,t=t+18*o*(o%2==0?1:-1)-17*(c-2),s.meet2Pos=cc.p(e,t),"Attack"!=a?s.doEvent("Meet"):s.nextEv="Idle"}},switchAttackTarget:function(){var e=i("ArmiesManager").searchTargetForRemote(this);if(e!=this.target){this.hero&&this.hero.target&&(this.hero.target.remoteAtkedNum=this.hero.target.remoteAtkedNum-1,this.hero.target=null);for(var t=0;t<this.soldiers.length;t++){var a=this.soldiers[t];a.target&&(a.target.remoteAtkedNum=a.target.remoteAtkedNum-1,11==a.uType&&a.target.bSight&&(a.target.bSight.doEvent("End"),a.target.bSight=null),a.target=null)}
this.target=e}},onUpdate:function(e){var t=i("BattleManager");if(t.btlState!=r._BTL_STATE.INIT){this._super(e);var a=i("ArmiesManager"),n=this.getState();if("Idle"!=n||this.hero&&this.hero.openSkilled)"Move"==n?"Destory"==this.target.getState()?this.doEvent("Idle"):(cc.director.getTotalFrames()%32==0&&this.switchAttackTarget(),this.isAttackAble()?this.doEvent("Meet"):this.setMoveVector()):"Meet"==n?"Destory"==this.target.getState()?this.slotsNum<2?this.doEvent("Idle"):this.doEvent("Arrange"):(cc.director.getTotalFrames()%64==0&&this.switchAttackTarget(),a.searchAttackForUnits(this),this.hero&&this.hero.isTargetAble()&&this.hero.isMeetAble()&&this.hero.doEvent("Meet")):"Arrange"==n?this.isArranged()?this.doEvent("Idle"):(this.target=a.searchTargetForRemote(this),this.isTargetAble()&&this.isAttackAble()&&this.doEvent("Meet")):"Strategy"==n&&this.updateStrategy(e);else{if(0<this.delayMove)
return void(this.delayMove=this.delayMove-e);t.btlState==r._BTL_STATE.CHEER?this.doEvent("Victory"):(this.target=a.searchTargetForRemote(this),this.isTargetAble()&&this.doEvent("Move"))}}}});e.exports=n,cc._RF.pop()},{ArmiesManager:"ArmiesManager",Army:"Army",BattleConstants:"BattleConstants",BattleManager:"BattleManager","state-machine":"state-machine"}],RemoteHero:[function(n,e,t){"use strict";cc._RF.push(e,"4a61cWfLFFN9plH5JDgrqmG","RemoteHero");var a=n("state-machine"),i=n("BattleConstants"),r=cc.Class({extends:n("Hero"),properties:{},ctor:function(){cc.log("RemoteHero create!")},setFSM:function(){var e=this;this.fsm=a.create({initial:"Idle",events:[{name:"Idle",from:["Move","Meet","Attack","Stun","Frozen","Skill"],to:"Idle"},{name:"Move",from:"Idle",to:"Move"},{name:"Meet",from:["Idle","Move"],to:"Meet"},{name:"Attack",from:["Idle","Meet","Skill"],to:"Attack"},{name:"Skill",from:"*",to:"Skill"},{name:"Dead",from:"*",to:"Dead"},{name:"Cheer",from:"Idle",to:"Cheer"},{name:"Stun",from:["Idle","Move","Meet","Attack","Skill","Frozen"],to:"Stun"},{name:"Frozen",from:["Idle","Move","Meet","Attack","Skill","Stun"],to:"Frozen"}],callbacks:{onenterstate:function(e,t,a){},onbeforeDead:function(){e.onbeforeDead()},onenterDead:function(){e.onenterDead()},onafterDead:function(){e.onafterDead()},onenterIdle:function(){e.onenterIdle()},onenterCharge:function(){e.onenterCharge()},onenterMeet:function(){e.onenterMeet()},onenterAttack:function(){e.onenterAttack()},onleaveAttack:function(){e.onleaveAttack()},onenterCheer:function(){e.onenterCheer()},onenterMove:function(){e.onenterMove()}}})},isAttackAble:function(){return this.fsm.can("Attack")},isMeetAble:function(){return"Idle"==this.getState()||"Move"==this.getState()},setTarget:function(e,t){e&&"Dead"!=e.getState()&&(e.remoteAtkedNum=e.remoteAtkedNum+1,this.target=e)},switchTarget:function(e){if(this.target!=e)
if(this.target){if(this.target.getAtkType()==i._ARMY_TYPE.Melee&&this.target.target==this)
return;this.target.remoteAtkedNum=e.remoteAtkedNum-1,this.setTarget(e)}else
this.setTarget(e),this.target.doEvent("Attack")},onenterMeet:function(){this.playAnimation("move"),this.disVector=cc.pSub(this.meet2Pos,cc.p(this.getPosition()))},onenterAttack:function(){this.setFace2Target();var e=this.getAttackAniName();this.playAnimation(e),this.amt.getComponent(sp.Skeleton).setCompleteListener(this.atkAnimationCb.bind(this)),this.amt.getComponent(sp.Skeleton).setEventListener(this.fireAnimationCb.bind(this)),this.atkDelay=this.uCfg.atk_speed},atkAnimationCb:function(e){"Attack"==this.getState()&&(this.nextEv?(this.doEvent(this.nextEv),"Idle"==this.nextEv&&(this.move2Pos?this.doEvent("Move"):this.meet2Pos&&this.doEvent("Meet")),this.nextEv=null):this.playAnimation("stand"))},fireAnimationCb:function(e,t){e.animation&&e.animation.name;if("fire"==t.data.name&&this.isTargetAble()){var a=n("ArrowsManager").createArrow();a.id=this.cfg.arrow,a.from=this,a.to=this.target,a.setFSM()}},onleaveAttack:function(){this.amt.getComponent(sp.Skeleton).setCompleteListener(function(){}),this.amt.getComponent(sp.Skeleton).setEventListener(function(){})},onenterDead:function(){this._super(),this.target&&(this.target.remoteAtkedNum=this.target.remoteAtkedNum-1)},onUpdate:function(e){this._super(e);var t=this.getState();if("Move"==t)
this.updateMove(e,this.uCfg.mv_speed*this.speedup);else if("Attack"==t)
0<this.atkDelay?this.atkDelay=this.atkDelay-e*cc.director.getScheduler().getTimeScale()*this.speedup:this.isTargetAble()?(this.atkDelay=this.uCfg.atk_speed,this.setFace2Target(),this.playAnimation(this.getAttackAniName())):(this.doEvent("Idle"),this.move2Pos&&this.doEvent("Move"));else if("Meet"==t){var a=this.getPosition(),n=a.x,i=a.y;cc.pDistance(this.meet2Pos,cc.p(n,i))<1.1*this.uCfg.mv_speed*e?this.doEvent("Attack"):this.move(1.1*this.uCfg.mv_speed,e)}}});e.exports=r,cc._RF.pop()},{ArrowsManager:"ArrowsManager",BattleConstants:"BattleConstants",Hero:"Hero","state-machine":"state-machine"}],RemoteSoldier:[function(a,e,t){"use strict";cc._RF.push(e,"daeb5EfwnJCNrZV4yCIR16L","RemoteSoldier");var n=a("state-machine"),i=a("BattleConstants"),r=cc.Class({extends:a("Soldier"),properties:{},ctor:function(){cc.log("RemoteSoldier create!")},setFSM:function(){var e=this;this.fsm=n.create({initial:"Idle",events:[{name:"Idle",from:["Move","Meet","Attack","Stun","Frozen","Skill"],to:"Idle"},{name:"Move",from:"Idle",to:"Move"},{name:"Meet",from:["Idle","Move"],to:"Meet"},{name:"Attack",from:["Idle","Meet"],to:"Attack"},{name:"Dead",from:"*",to:"Dead"},{name:"Cheer",from:"Idle",to:"Cheer"},{name:"Stun",from:["Idle","Move","Meet","Attack","Frozen"],to:"Stun"},{name:"Frozen",from:["Idle","Move","Meet","Attack","Stun"],to:"Frozen"}],callbacks:{onenterstate:function(e,t,a){},onenterDead:function(){e.onenterDead()},onafterDead:function(){e.onafterDead()},onenterIdle:function(){e.onenterIdle()},onenterCharge:function(){e.onenterCharge()},onenterMeet:function(){e.onenterMeet()},onenterAttack:function(){e.onenterAttack()},onleaveAttack:function(){e.onleaveAttack()},onenterWander:function(){e.onenterWander()},onenterMove:function(){e.onenterMove()},onenterCheer:function(){e.onenterCheer()}}})},isAttackAble:function(){return this.fsm.can("Attack")},setTarget:function(e,t){e&&"Dead"!=e.getState()&&(e.remoteAtkedNum=e.remoteAtkedNum+1,this.target=e)},switchTarget:function(e){if(this.target!=e)
if(this.target){if(this.target.getAtkType()==i._ARMY_TYPE.Melee&&this.target.target==this)
return;this.target.bSight&&(this.target.bSight.doEvent("End"),this.target.bSight=null),this.target.remoteAtkedNum=e.remoteAtkedNum-1,this.setTarget(e)}else
this.setTarget(e),this.target.doEvent("Attack")},switchSlot:function(e){},onenterMeet:function(){this.playAnimation("move"),this.disVector=cc.pSub(this.meet2Pos,cc.p(this.getPosition()))},onenterAttack:function(){this.setFace2Target(),this.playAttackAnimation(),this.atkDelay=this.cfg.atk_speed},fireAnimationCb:function(e){if(this.isTargetAble()){var t=a("ArrowsManager").createArrow();t.id=this.cfg.arrow,t.from=this,t.to=this.target,t.setFSM(),11==this.uType&&this.target.showBallistaFocus()}},onleaveAttack:function(){},onenterDead:function(){this._super(),this.target&&"Dead"!=this.target.getState()&&(this.target.remoteAtkedNum=this.target.remoteAtkedNum-1,11==this.uType&&this.target.bSight&&(this.target.bSight.doEvent("End"),this.target.bSight=null))},onUpdate:function(e){this._super(e);var t=this.getState();if("Move"==t)
this.updateMove(e,this.cfg.mv_speed);else if("Attack"==t)
0<this.atkDelay?this.atkDelay=this.atkDelay-e*cc.director.getScheduler().getTimeScale():this.isTargetAble()?(this.atkDelay=this.cfg.atk_speed,"Attack"!=this.target.getState()||this.target!=this.lSlot&&this.target!=this.rSlot?this.playAttackAnimation():(this.setFace2Target(),this.playAnimation("counterattack"))):(this.doEvent("Idle"),this.move2Pos&&this.doEvent("Move"));else if("Meet"==t){cc.pDistance(this.meet2Pos,cc.p(this.getPosition()))<1.5*this.cfg.mv_speed*e?this.doEvent("Attack"):this.move(1.5*this.cfg.mv_speed,e)}}});e.exports=r,cc._RF.pop()},{ArrowsManager:"ArrowsManager",BattleConstants:"BattleConstants",Soldier:"Soldier","state-machine":"state-machine"}],ReplaceFormationInfo:[function(e,t,a){"use strict";cc._RF.push(t,"39cc2e7vAhAyYkLz7FvXiPm","ReplaceFormationInfo");var o=e("BattleFormationPanel"),n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pReplaceFormationItem:cc.Node,m_pFormationParent:cc.Node,_formationJson:null,_curFormation:-1,_formationlist:[],_curselectformation:-1,_lastselectformation:-1},onLoad:function(){},ChangeData:function(e){this._formationJson=DonotDestroyManager.GameData.Formation,this._curFormation=e,this._curselectformation=this._curFormation,this.Init()},Init:function(){this.CreateAllFormation()},CreateAllFormation:function(){for(var e=0;e<this._formationJson.length;++e)
null!=this._formationlist&&e<this._formationlist.length?this.CreateSingleFormation(this._formationJson[e],!0,e):this.CreateSingleFormation(this._formationJson[e])},CreateSingleFormation:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,n=null;t?n=this._formationlist[a]:(n=cc.instantiate(this.m_pReplaceFormationItem),this.m_pFormationParent.addChild(n),this._formationlist.push(n)),n.active=!0;var i=n.getComponent("ReplaceFormationItem"),r=this.Formation_OnClickHandler.bind(this);if(i.ChangeData(e,r),this._curFormation==e.id&&(i.SetSelect(!0),this._lastselectformation=this._curFormation),null!=o.getInstance()._Embattlemanager._neweffectinfo){var s=parseInt(o.getInstance()._Embattlemanager._neweffectinfo);e.id==s&&(i.CreateNewFormationEffect(),cc.sys.localStorage.removeItem(MyPersistDataManager._playerData.server_id+"newformation"+MyPersistDataManager._playerData.id))}},Formation_OnClickHandler:function(e,t){n.playBtnOpenEffect(),-1!=this._lastselectformation&&this._formationlist[this._lastselectformation-1].getComponent("ReplaceFormationItem").SetSelect(!1);var a=parseInt(t);this._curselectformation=a,this._formationlist[this._curselectformation-1].getComponent("ReplaceFormationItem").SetSelect(!0),this._lastselectformation=this._curselectformation},BtnOk_OnClickHandler:function(e){n.playBtnOpenEffect(),this.node.active=!1,this._curselectformation!=this._curFormation&&o.getInstance().ChangeFormation(this._curselectformation)},Mask_OnClickHandler:function(e){n.playBtnCloseEffect(),this.node.active=!1,o.getInstance().RemoveNewFormationEffect()}}),cc._RF.pop()},{BattleFormationPanel:"BattleFormationPanel",SoundUtil:"SoundUtil"}],ReplaceFormationItem:[function(e,t,a){"use strict";cc._RF.push(t,"179604pFz1CsJI5zXbu5ZTO","ReplaceFormationItem"),cc.Class({extends:cc.Component,properties:{m_pFormationParent:cc.Node,m_pAttr1:cc.RichText,m_pAttr2:cc.RichText,m_pDes:cc.Label,m_pFormationName:cc.Sprite,m_pFormationSpr:cc.Sprite,m_pNewEffect:cc.Prefab,m_pMask:cc.Node,m_pSelect:cc.Node,m_pLockContent:cc.Node,m_pUnLockLevel:cc.Label,m_pNewEffectparent:cc.Node,m_pFormationNamelist:[cc.SpriteFrame],_formationID:-1,_formationJson:null,_formationlist:[],_cb:null,_NewEffectItem:null,_islock:!1},onLoad:function(){},ChangeData:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._formationJson=e,this._cb=t,this.Init()},Init:function(){this.m_pMask.active=!1,this.m_pSelect.active=!1,this._islock=!1,this.m_pAttr1.string="<color=#ffffff>"+this._formationJson.des1[0]+"</c> <color=#ffff00>"+this._formationJson.des1[1]+"</color>",this.m_pAttr2.string="<color=#ffffff>"+this._formationJson.des2[0]+"</c> <color=#ffff00>"+this._formationJson.des2[1]+"</color>",this.m_pDes.string=this._formationJson.des,this.m_pFormationName.spriteFrame=this.m_pFormationNamelist[this._formationJson.id-1],MyPersistDataManager._playerData.level<this._formationJson.unlock.level&&(this.m_pLockContent.active=!0,this.m_pMask.active=!0,this._islock=!0),this.m_pUnLockLevel.string=this._formationJson.unlock.level+" cấp mở khóa",this.CreateFormation();var e=new cc.Component.EventHandler;e.target=this.node,e.component="ReplaceFormationItem",e.handler="Formation_OnClickHandler",e.customEventData=this._formationJson.id,this.node.getComponent(cc.Button).clickEvents[0]=e,this.RemoveNewFormationEffect()},CreateFormation:function(){for(var e=Object.keys(this._formationJson.positions),t=0;t<e.length;t++){var a=null;null!=this._formationlist&&t<this._formationlist.length?a=this._formationlist[t]:(a=cc.instantiate(this.m_pFormationSpr.node),this.m_pFormationParent.addChild(a),this._formationlist.push(a)),a.active=!0,a.setPosition(25*(this._formationJson.positions[e[t]][0]-1),25*(this._formationJson.positions[e[t]][1]-1))}},CreateNewFormationEffect:function(){this._NewEffectItem=cc.instantiate(this.m_pNewEffect),this.m_pNewEffectparent.addChild(this._NewEffectItem)},RemoveNewFormationEffect:function(){null!=this._NewEffectItem&&(this._NewEffectItem.removeFromParent(),this._NewEffectItem.destroy(),this._NewEffectItem=null)},SetSelect:function(e){this.m_pMask.active=e,this.m_pSelect.active=e},Formation_OnClickHandler:function(e,t){this._islock||null!=this._cb&&this._cb(e,t)}}),cc._RF.pop()},{}],ResLoaderManager:[function(e,t,a){"use strict";cc._RF.push(t,"0e1b3A0qqJN+ZM4PX9UawdI","ResLoaderManager");var n={preload:function(r,s,e){var o=r.length;if(0==o)
return s(!0,1,null,null);var c=this;if(e){var t=!1;(t=function n(){var e=r.shift(),i=e[0],t=e[1];c.load(i,t,function(e,t){var a=r.length;if(0==a)
return s(!0,1,i,t);s(!1,(o-a)/o,i,t),setTimeout(function(){n()},0)})})()}else{var n=0;t=function(e){var a=e[0],t=e[1];c.load(a,t,function(e,t){if(++n==o)
return s(!0,1,a,t);s(!1,n/o,a,t)})};for(var a in r)
r[a]&&t(r[a])}},load:function(e,t,a){cc.loader.loadRes(e,t,a)},asyncLoadAll:function(e,n,o){var c=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];if(0==(e instanceof Map?e.size:e.length))
return n(!0,1,null,null);var l=[],h={};e instanceof Map?e.forEach(function(e,t){var a=t,n=e,i=cc.loader._getResUuid(a,n);l.push({type:"uuid",uuid:i}),h[i]=a}):e.forEach(function(e){var t=e[0],a=e[1],n=cc.loader._getResUuid(t,a);l.push({type:"uuid",uuid:n}),h[n]=t}),cc.loader.load(l,function(e,t,a){0<t&&n(e/t)},function(e,t){for(var a=[],n=0;n<l.length;++n){var i=l[n].uuid,r=this._getReferenceKey(i),s=t.getContent(r);s&&(cc.loader.setAutoReleaseRecursively(i,c),a.push([h[i],s]))}
h=null,o(e,a)})}};t.exports=n,cc._RF.pop()},{}],RuneBackPanel:[function(e,t,a){"use strict";cc._RF.push(t,"92d257Xwx1LgLH/uMx095Xp","RuneBackPanel");var n=e("SoundUtil");e("ColorUtil"),e("MyUIEvent"),e("MyEventDispatcher"),e("NetEvent"),e("MyProtocols"),e("i18n");cc.Class({extends:cc.Component,properties:{back_item_container:cc.Node,_backItemList:[],pre_rune_item_bag:cc.Prefab},onLoad:function(){},setParams:function(e){this._backItemList=e},start:function(){for(var e=0;e<this._backItemList.length;e++){var t=this._backItemList[e],a=cc.instantiate(this.pre_rune_item_bag);this.back_item_container.addChild(a),a.getComponent("RuneItemBag").changeData(t.template_id,t.count,!1)}},goBack:function(){n.playBtnCloseEffect(),MyUiManager.Back()},onDestroy:function(){},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],RuneCombinePanel:[function(e,t,a){"use strict";cc._RF.push(t,"19eedJZau9DRaWCyBx59bNL","RuneCombinePanel");var S=e("SoundUtil"),C=(e("ColorUtil"),e("i18n")),D=e("MyProtocols"),I=e("MyEventDispatcher"),n=e("NetEvent"),b=e("MyUIEvent"),_=e("RunesBufferMgr"),i=e("GuideBufferMgr"),s={2:[cc.v2(-160,0),cc.v2(160,0)],4:[cc.v2(-113.1,113.1),cc.v2(-113.1,-113.1),cc.v2(113.1,113.1),cc.v2(113.1,-113.1)],6:[cc.v2(-160,0),cc.v2(160,0),cc.v2(-80,138.6),cc.v2(-80,-138.6),cc.v2(80,138.6),cc.v2(80,-138.6)]};cc.Class({extends:cc.Component,properties:{node_color_tab:cc.Node,lab_success_rate:cc.Label,node_success_percent:cc.Node,lab_combine_cost_copper:cc.Label,lab_rate_cd:cc.Label,lab_combine_btn:cc.Label,node_rune_left_list:cc.Node,pre_rule_left_container:cc.Prefab,node_rune_bag_list:cc.Node,pre_rune_combine_item:cc.Prefab,node_success_parent:cc.Node,node_run_oil_list:cc.Node,btnBack:cc.Node,btnDoCombine:cc.Node,node_copper:cc.Node,node_cost_copper:cc.Node,_selected_color:1,_selected_func:-1,_server_add_rate:0,_selected_rune_func:0,_sum_time:0,_selected_oil_id:-1,_rune_left_item_pool:cc.NodePool,_rune_right_bag_pool:cc.NodePool},onLoad:function(){this.S2CRuneSuccessRate_cb_func=this.S2CRuneSuccessRate_cb.bind(this),I.addListener(n.S2CRuneSuccessRate,this.S2CRuneSuccessRate_cb_func),this.S2CRuneCombine_cb_func=this.S2CRuneCombine_cb.bind(this),I.addListener(n.S2CRuneCombine,this.S2CRuneCombine_cb_func),this.onRuneTabSelect_cb_func=this.onRuneTabSelect_cb.bind(this),I.addListener(b.onRuneTabSelect,this.onRuneTabSelect_cb_func),this.onRuneItemBagSelect_cb_func=this.onRuneItemBagSelect_cb.bind(this),I.addListener(b.onRuneItemBagSelect,this.onRuneItemBagSelect_cb_func),this.onRuneRemove_cb_func=this.onRuneRemove_cb.bind(this),I.addListener(b.onRuneRemove,this.onRuneRemove_cb_func),this.onRuneOilSelect_cb_func=this.onRuneOilSelect_cb.bind(this),I.addListener(b.onRuneOilSelect,this.onRuneOilSelect_cb_func),this.onOilUseChange_cb_func=this.onOilUseChange_cb.bind(this),I.addListener(b.onOilUseChange,this.onOilUseChange_cb_func),this._rune_left_item_pool=new cc.NodePool("LeftRuneItem"),this._rune_right_bag_pool=new cc.NodePool("RightRuneItem"),this.updateCdTimeStr()},onOilUseChange_cb:function(){this.refreshSuccessRate(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},onRuneOilSelect_cb:function(e){this._selected_oil_id=e},S2CRuneCombine_cb:function(e){if(e.is_success){MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,150),C.t("rune010"),1e3),S.playRobTreaEffect();var t=this._rune_left_item_pool.get();null==t&&(t=cc.instantiate(this.pre_rule_left_container)),t.setPosition(0,0),this.node_success_parent.addChild(t),t.getComponent("RuneLeftItem").changeDataStatic(e.new_rune_id),t.opacity=0,t.runAction(cc.sequence(cc.fadeIn(.2),cc.delayTime(3),cc.callFunc(function(e){e.destroy(),MyUiManager.CloseRuneTipsWidget()},t)))}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,150),C.t("rune011"),1e3);var a=this.node_rune_left_list.children;if(null!=a&&0<a.length)
for(var n=a.length-1;0<=n;n--)
a[n].getComponent("RuneLeftItem").changeData(this._selected_color-1);this.initRuneBagList(this._selected_func),null!=e.back_items&&0<e.back_items.length&&MyUiManager.Open(MyUiManager.PanelInfo.RuneBackPanel,e.back_items),this.checkInlayFull(),this._server_add_rate=e.success_rate,this.clearOilUseNum(),this.refreshSuccessRate(),this.node.runAction(cc.sequence(cc.delayTime(.25),cc.callFunc(function(){this.showGuide()},this))),this.node.parent.getComponent("EsRoot").checkRedPoints()},removeCombinedNode:function(){var e=this.node_success_parent.children;null!=e&&0<e.length&&e[0].destroy()},onRuneRemove_cb:function(e){this.checkInlayFull()},onRuneItemBagSelect_cb:function(e){for(var t=this.node_rune_left_list.children,a=0;a<t.length;a++){var n=t[a].getComponent("RuneLeftItem");if(0==n._rune_tpl_id){n.insertRune(e),I.dispatchEvent(b.onRuneInlay,e);break}}
this.checkInlayFull(),this.removeCombinedNode()},onDestroy:function(){I.removeListener(n.S2CRuneSuccessRate,this.S2CRuneSuccessRate_cb_func),I.removeListener(b.onRuneTabSelect,this.onRuneTabSelect_cb_func),I.removeListener(b.onRuneItemBagSelect,this.onRuneItemBagSelect_cb_func),I.removeListener(b.onRuneRemove,this.onRuneRemove_cb_func),I.removeListener(n.S2CRuneCombine,this.S2CRuneCombine_cb_func),I.removeListener(b.onRuneOilSelect,this.onRuneOilSelect_cb_func),I.removeListener(b.onOilUseChange,this.onOilUseChange_cb_func),this._rune_left_item_pool.clear(),this._rune_right_bag_pool.clear(),MyUiManager.CloseRuneTipsWidget()},onRuneTabSelect_cb:function(e){this._selected_func=e,this.initRuneBagList(e)},initRuneBagList:function(e){var t=_.getRuneList(e,this._selected_color-1),a=this.node_rune_bag_list.children;if(null!=a&&0<a.length)
for(var n=a.length-1;0<=n;n--)
this._rune_right_bag_pool.put(a[n]);for(var i=this.node_rune_left_list.children,r={},s=i.length-1;0<=s;s--){var o=i[s].getComponent("RuneLeftItem");0<o._rune_tpl_id&&(null==r[o._rune_tpl_id]?r[o._rune_tpl_id]=1:r[o._rune_tpl_id]++)}
for(var c=0;c<t.length;c++){var l=t[c],h=this._rune_right_bag_pool.get();null==h&&(h=cc.instantiate(this.pre_rune_combine_item)),this.node_rune_bag_list.addChild(h);var d=r[l.template_id];h.getComponent("RuneItemBagCombine").changeData(l.template_id,l.num,null==d?0:d,!0)}},S2CRuneSuccessRate_cb:function(e){this._server_add_rate=e.success_rate,this.refreshSuccessRate()},changeData:function(e){this._server_add_rate=e,this._selected_color=1,this._selected_func=-1,this.node_color_tab.setPosition(-331,293),I.dispatchEvent(b.initRuneTabSelect,-1),this.doColorSelect(),this.lab_combine_btn.string=C.t("rune008"),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},doColorSelect:function(){var e=DonotDestroyManager.GameData.RuneCombine[this._selected_color];this.lab_combine_cost_copper.string=e.coins;var t=this.node_rune_left_list.children;if(null!=t&&0<t.length)
for(var a=t.length-1;0<=a;a--)
this._rune_left_item_pool.put(t[a]);for(var n=s[e.num],i=0;i<e.num;i++){var r=this._rune_left_item_pool.get();null==r&&(r=cc.instantiate(this.pre_rule_left_container)),r.setPosition(n[i]),this.node_rune_left_list.addChild(r),r.getComponent("RuneLeftItem").changeData(this._selected_color-1)}
this.initRuneBagList(this._selected_func),this.checkInlayFull(),this.removeCombinedNode(),this.clearOilUseNum(),this.refreshSuccessRate()},refreshSuccessRate:function(){for(var e=0,t=this.node_run_oil_list.children,a=0;a<t.length;a++){var n=t[a].getComponent("RuneOilCtrl");if(!(n._use_num<=0))
e+=DonotDestroyManager.GameData.Items[n.oil_template_id].addon*n._use_num}
var i=DonotDestroyManager.GameData.RuneCombine[this._selected_color].base_success_rate+this._server_add_rate+e;i=1e3<i?1e3:i,this.lab_success_rate.string=C.t("rune006",{value:parseInt(i/10)}),this.node_success_percent.width=430*i/1e3},ClickHanlderColorTab:function(e,t){S.playBtnOpenEffect();var a=parseInt(t);if(this._selected_color!=a){var n=e.target;this.node_color_tab.runAction(cc.moveTo(.2,cc.p(n.x,this.node_color_tab.y))),this._selected_color=a,this.doColorSelect()}},update:function(e){this._sum_time+=e,1<=this._sum_time&&(this.updateCdTimeStr(),this._sum_time=0)},start:function(){},ClickHanlderOnekeyInlay:function(e,t){if(S.playBtnOpenEffect(),this.checkInlayFull()){for(var a=this.node_rune_left_list.children,n={},i=a.length-1;0<=i;i--){var r=a[i].getComponent("RuneLeftItem");0<r._rune_tpl_id&&(null==n[r._rune_tpl_id]?n[r._rune_tpl_id]=1:n[r._rune_tpl_id]++)}
for(var s=[],o=this.node_run_oil_list.children,c=0;c<o.length;c++){var l=o[c].getComponent("RuneOilCtrl");l._use_num<=0||s.push({template_id:l.oil_template_id,count:l._use_num})}
for(var h=[],d=Object.keys(n),_=0;_<d.length;_++){var u=d[_],m=n[u];h.push({template_id:parseInt(u),count:m})}
D.send_C2SRuneCombine(DonotDestroyManager._gameSocket,this._selected_color,s,h)}else{for(var p=this.node_rune_left_list.children,f=this.node_rune_bag_list.children,g=0,y=0;g<p.length&&y<f.length;){var v=p[g].getComponent("RuneLeftItem");if(0<v._rune_tpl_id)
g++;else{var M=f[y].getComponent("RuneItemBagCombine");M._rune_num<=0?y++:(v.insertRune(M._rune_template_id),I.dispatchEvent(b.onRuneInlay,M._rune_template_id))}}
0==f.length&&MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,180),C.t("rune017"),1e3),this.checkInlayFull(),this.removeCombinedNode(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))}},checkInlayFull:function(){for(var e=!0,t=this.node_rune_left_list.children,a=0;a<t.length;a++){if(0==t[a].getComponent("RuneLeftItem")._rune_tpl_id){e=!1;break}}
return e?(this.lab_combine_btn.string=C.t("rune009"),this.node_copper.active=!0,this.node_cost_copper.active=!0):(this.lab_combine_btn.string=C.t("rune008"),this.node_copper.active=!1,this.node_cost_copper.active=!1),e},updateCdTimeStr:function(){var e=new Date,t=e.getMinutes(),a=e.getSeconds();0==t&&2==a&&D.send_C2SRuneSuccessRate(DonotDestroyManager._gameSocket);var n=29-t%30,i=60-a;this.lab_rate_cd.string=C.t("rune007",{min:n,sec:i})},ClickHanlderBuyOil:function(e,t){S.playBtnOpenEffect(),-1!=this._selected_oil_id?(this.buyOilPanelCloseCb=this.buyOilPanelCloseHandler.bind(this),MyUiManager.Open(MyUiManager.PanelInfo.RuneOilBuyPanel,[this._selected_oil_id,this.buyOilPanelCloseCb])):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,150),C.t("rune012"),1e3)},buyOilPanelCloseHandler:function(){for(var e=this.node_run_oil_list.children,t=0;t<e.length;t++)
e[t].getComponent("RuneOilCtrl").showOilNum()},clearOilUseNum:function(){for(var e=this.node_run_oil_list.children,t=0;t<e.length;t++)
e[t].getComponent("RuneOilCtrl").clearUseNum()},showGuide:function(){var t=this;i.showGuide("RuneCombinePanel",function(e){return 1==e?t.btnDoCombine:2==e?t.node_run_oil_list.children[2].getChildByName("btn_add_yellow1"):3==e?t.btnBack:void 0})}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",RunesBufferMgr:"RunesBufferMgr",SoundUtil:"SoundUtil",i18n:"i18n"}],RuneCombineTab:[function(e,t,a){"use strict";cc._RF.push(t,"b4b9fErTudE7L9Bkxjzk2+p","RuneCombineTab");var n=e("SoundUtil"),i=(e("ColorUtil"),e("MyUIEvent")),r=e("MyEventDispatcher");cc.Class({extends:cc.Component,properties:{res_selected_sprite:[cc.SpriteFrame],sprite_selected:cc.Sprite,my_rune_func:0},onLoad:function(){this.onRuneTabSelect_cb_func=this.onRuneTabSelect_cb.bind(this),r.addListener(i.onRuneTabSelect,this.onRuneTabSelect_cb_func),this.initRuneTabSelect_cb_func=this.initRuneTabSelect_cb.bind(this),r.addListener(i.initRuneTabSelect,this.initRuneTabSelect_cb_func),this.onRuneTabSelect_cb(-1)},initRuneTabSelect_cb:function(e){this.onRuneTabSelect_cb(e)},onRuneTabSelect_cb:function(e){e==this.my_rune_func?this.sprite_selected.spriteFrame=this.res_selected_sprite[1]:this.sprite_selected.spriteFrame=this.res_selected_sprite[0]},start:function(){},onDestroy:function(){r.removeListener(i.onRuneTabSelect,this.onRuneTabSelect_cb_func),r.removeListener(i.initRuneTabSelect,this.initRuneTabSelect_cb_func)},clickHanlder:function(e,t){n.playBtnOpenEffect(),r.dispatchEvent(i.onRuneTabSelect,this.my_rune_func)},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],RuneItemBagCombine:[function(e,t,a){"use strict";cc._RF.push(t,"0886f/SMNFHFYk6khOftf/P","RuneItemBagCombine");var n=e("SoundUtil"),s=e("ColorUtil"),i=e("MyUIEvent"),r=e("MyEventDispatcher");cc.Class({extends:cc.Component,properties:{spr_rune:cc.Sprite,spr_border:cc.Node,lab_count:cc.Label,node_selected:cc.Node,_rune_template_id:-1,_rune_init_num:0,_rune_num:0,_is_click_enable:!0},onLoad:function(){this.onRuneInlay_cb_func=this.onRuneInlay_cb.bind(this),r.addListener(i.onRuneInlay,this.onRuneInlay_cb_func),this.onRuneRemove_cb_func=this.onRuneRemove_cb.bind(this),r.addListener(i.onRuneRemove,this.onRuneRemove_cb_func),this.spr_rune.node.on("touchstart",this.onTipsTouchBegan,this),this.spr_rune.node.on("touchcancel",this.onTipsTouchEnded,this),this.spr_rune.node.on("touchend",this.onTipsTouchEnded,this)},onTipsTouchBegan:function(){var e=this.spr_rune.node.convertToWorldSpaceAR(cc.v2(30,30));600<e.y&&(e.y-=220),0<this._rune_template_id&&MyUiManager.OpenRuneTipsWidget(e,this._rune_template_id,0)},onTipsTouchEnded:function(){MyUiManager.CloseRuneTipsWidget()},onRuneRemove_cb:function(e){this.node.activeInHierarchy&&e==this._rune_template_id&&(this._rune_num++,this.changeRuneNum())},onRuneInlay_cb:function(e){this.node.activeInHierarchy&&e==this._rune_template_id&&(this._rune_num--,this.changeRuneNum())},changeRuneNum:function(){this.lab_count.string=this._rune_num,this._rune_num==this._rune_init_num?this.node_selected.active=!1:this.node_selected.active=!0},changeData:function(e,t,a,n){this._is_click_enable=n,this._rune_template_id=e,this._rune_num=t-a,this._rune_init_num=t,this.changeRuneNum();var i=DonotDestroyManager.GameData.Runes[e];this.spr_border.color=s.getColorByQuality(i.quality);var r=this;cc.loader.loadRes("UI/Rune/"+i.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r.node&&cc.isValid(r.node)&&(r.spr_rune.spriteFrame=t)})},OnClickHander:function(e,t){this._is_click_enable&&(n.playBtnOpenEffect(),this._rune_num<=0||r.dispatchEvent(i.onRuneItemBagSelect,this._rune_template_id))},onDestroy:function(){r.removeListener(i.onRuneInlay,this.onRuneInlay_cb_func),r.removeListener(i.onRuneRemove,this.onRuneRemove_cb_func)},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],RuneItemBag:[function(e,t,a){"use strict";cc._RF.push(t,"cd046Mwf7tLJ71FtIdQgAUU","RuneItemBag");var n=e("SoundUtil"),s=e("ColorUtil"),i=e("MyUIEvent"),r=e("MyEventDispatcher");cc.Class({extends:cc.Component,properties:{spr_rune:cc.Sprite,spr_border:cc.Node,lab_count:cc.Label,node_add:cc.Node,node_sub:cc.Node,_rune_template_id:-1,_is_click_enable:!0,_use_num:0,_origin_num:0},onLoad:function(){this.spr_rune.node.on("touchstart",this.onTipsTouchBegan,this),this.spr_rune.node.on("touchcancel",this.onTipsTouchEnded,this),this.spr_rune.node.on("touchend",this.onTipsTouchEnded,this)},onTipsTouchBegan:function(){var e=this.spr_rune.node.convertToWorldSpaceAR(cc.v2(30,30));MyUiManager.OpenRuneTipsWidget(e,this._rune_template_id,0)},onTipsTouchEnded:function(){MyUiManager.CloseRuneTipsWidget()},changeData:function(e,t,a){this.node_add.active=!1,this.node_sub.active=!1,this._is_click_enable=a,this._rune_template_id=e;var n=DonotDestroyManager.GameData.Runes[e],i="";i=null!=n?"UI/Rune/"+n.icon:"UI/Items/"+(n=DonotDestroyManager.GameData.Items[e]).icon,this.spr_border.color=s.getColorByQuality(n.quality);var r=this;cc.loader.loadRes(i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r.node&&cc.isValid(r.node)&&(r.spr_rune.spriteFrame=t)}),this.lab_count.string=t},changeDataRuneLevelup:function(e,t){this._use_num=0,this._origin_num=t,this.updateAddSubView(),this._is_click_enable=!1,this._rune_template_id=e;var a=DonotDestroyManager.GameData.Runes[e],n="";n=null!=a?"UI/Rune/"+a.icon:"UI/Items/"+(a=DonotDestroyManager.GameData.Items[e]).icon,this.spr_border.color=s.getColorByQuality(a.quality);var i=this;cc.loader.loadRes(n,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=i.node&&cc.isValid(i.node)&&(i.spr_rune.spriteFrame=t)})},updateAddSubView:function(){0<this._origin_num-this._use_num?this.node_add.active=!0:this.node_add.active=!1,0<this._use_num?this.node_sub.active=!0:this.node_sub.active=!1,this.lab_count.string=this._origin_num-this._use_num},OnClickHander:function(e,t){this._is_click_enable&&(n.playBtnOpenEffect(),r.dispatchEvent(i.onRuneItemBagSelect,[this.node,this._rune_template_id]))},clickChangeUseNum:function(e,t){n.playBtnOpenEffect();var a=parseInt(t);r.dispatchEvent(i.onRuneBagItemSizeChange,[a,this])},confirmChangeVal:function(e){this._use_num+=e,this.updateAddSubView()},onDestroy:function(){},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],RuneItem:[function(e,t,a){"use strict";cc._RF.push(t,"d165dcb/YFLMIJc4lBfAXUU","RuneItem");var n=e("SoundUtil"),o=e("ColorUtil"),i=e("MyUIEvent"),r=e("NetEvent"),s=e("MyEventDispatcher"),c=e("RunesBufferMgr");cc.Class({extends:cc.Component,properties:{_rune_index:0,_is_unlock:!1,_rune_tpl_id:0,_rune_level:0,_hero_entity:null,node_selected:cc.Node,node_fuwen:cc.Node,node_empty_add:cc.Node,spr_fuwen:cc.Sprite,node_border:cc.Node,node_lock:cc.Node,node_high_grade_rune_tip:cc.Node,node_addLevel:cc.Node,lab_level:cc.Label},onLoad:function(){this.onRuneItemSelect_cb_func=this.onRuneItemSelect_cb.bind(this),s.addListener(i.onRuneItemSelect,this.onRuneItemSelect_cb_func),this.S2CRunePutup_cb_func=this.S2CRunePutup_cb.bind(this),s.addListener(r.S2CRunePutup,this.S2CRunePutup_cb_func),this.node_fuwen.on("touchstart",this.onTipsTouchBegan,this),this.node_fuwen.on("touchcancel",this.onTipsTouchEnded,this),this.node_fuwen.on("touchend",this.onTipsTouchEnded,this)},onTipsTouchBegan:function(){var e=this.node_fuwen.convertToWorldSpaceAR(cc.v2(30,30));600<e.y&&(e.y-=220),0<this._rune_tpl_id&&MyUiManager.OpenRuneTipsWidget(e,this._rune_tpl_id,this._rune_level)},onTipsTouchEnded:function(){MyUiManager.CloseRuneTipsWidget()},S2CRunePutup_cb:function(e){if(this._rune_index==e.pos_index){this.node_fuwen.active=!0,this.node_border.active=!0;var t=e.rune_id;this.showRune(t,e.rune_level)}},changeStaticShow:function(e,t){null!=this.node_empty_add&&(this.node_empty_add.active=!1),null!=this.node_high_grade_rune_tip&&(this.node_high_grade_rune_tip.active=!1),this.node_fuwen.active=!0,this.node_border.active=!0,this.showRune(e,t,!1),this.node_addLevel.active=!1,null!=this.node.getComponent(cc.Button)&&this.node.getComponent(cc.Button).destroy()},showRune:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];null!=this.node_empty_add&&(this.node_empty_add.active=!1),this._rune_tpl_id=e,this._rune_level=t;var n=DonotDestroyManager.GameData.Runes[e];this.node_border.color=o.getColorByQuality(n.quality);var i=this;cc.loader.loadRes("UI/Rune/"+n.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=i.node&&cc.isValid(i.node)&&(i.spr_fuwen.spriteFrame=t)});var r=DonotDestroyManager.GameData.RuneLevel[n.quality].cost_runes.length;this.node_addLevel.active=t<r,this.lab_level.node.active=!0,this.lab_level.string="+"+t;var s=0;(t<=2||(s=t<=5?1:t<=8?2:3),this.lab_level.node.color=o.getColorByQuality(s),a)&&(0<c.getRuneList(-1,n.quality+1).length?this.node_high_grade_rune_tip.active=!0:this.node_high_grade_rune_tip.active=!1)},onRuneItemSelect_cb:function(e){this._is_unlock&&(this._rune_index==e?this.node_selected.active=!0:this.node_selected.active=!1)},changeData:function(e,t,a,n,i){this._rune_index=e,this._is_unlock=t,this._rune_tpl_id=a,this._rune_level=n,this._hero_entity=i,this.node_lock.active=!t,0<a?(this.node_fuwen.active=!0,this.node_border.active=!0,this.showRune(a,n)):(this.node_fuwen.active=!1,this.node_border.active=!1,this.node_addLevel.active=!1,this.lab_level.node.active=!1,c.hasRune()&&t?this.node_empty_add.active=!0:this.node_empty_add.active=!1,this.node_high_grade_rune_tip.active=!1)},refreshLevel:function(e){this._rune_level=e,0<this._rune_tpl_id&&this.showRune(this._rune_tpl_id,e)},unlockRune:function(){this._is_unlock=!0,this.node_lock.runAction(cc.sequence(cc.fadeOut(.6),cc.hide())),c.hasRune()?this.node_empty_add.active=!0:this.node_empty_add.active=!1},clickRuneContainer:function(e,t){n.playBtnOpenEffect(),this._is_unlock?s.dispatchEvent(i.onRuneItemSelect,this._rune_index):MyUiManager.Open(MyUiManager.PanelInfo.RuneUnlockPanel,{rune_index:this._rune_index,hero_entity:this._hero_entity})},clickRuneAddLevel:function(e,t){n.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.RuneLevelupPanel,{rune_index:this._rune_index,hero_entity:this._hero_entity})},onDestroy:function(){s.removeListener(i.onRuneItemSelect,this.onRuneItemSelect_cb_func),s.removeListener(r.S2CRunePutup,this.S2CRunePutup_cb_func)},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",RunesBufferMgr:"RunesBufferMgr",SoundUtil:"SoundUtil"}],RuneLeftItem:[function(e,t,a){"use strict";cc._RF.push(t,"66e65Nf+NNMZ59BJ1TdrGec","RuneLeftItem");var n=e("SoundUtil"),i=e("MyEventDispatcher"),r=(e("MyProtocols"),e("NetEvent"),e("ColorUtil")),s=e("MyUIEvent");cc.Class({extends:cc.Component,properties:{spr_rune:cc.Sprite,node_border:cc.Node,node_jian:cc.Node,_target_quality:0,_rune_tpl_id:0},changeData:function(e){this._target_quality=e,this.node_border.color=r.getColorByQuality(e),this._rune_tpl_id=0,this.spr_rune.spriteFrame=null,this.node_jian.active=!1},changeDataStatic:function(e){this._rune_tpl_id=e;var t=DonotDestroyManager.GameData.Runes[this._rune_tpl_id];this.node_border.color=r.getColorByQuality(t.quality);var a=this;cc.loader.loadRes("UI/Rune/"+t.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=a.node&&cc.isValid(a.node)&&(a.spr_rune.spriteFrame=t)}),this.node_jian.active=!1},insertRune:function(e){this._rune_tpl_id=e;var t=DonotDestroyManager.GameData.Runes[this._rune_tpl_id],a=this;cc.loader.loadRes("UI/Rune/"+t.icon,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=a.node&&cc.isValid(a.node)&&(a.spr_rune.spriteFrame=t)}),this.node_jian.active=!0},ClickHanderRemoveRune:function(e,t){if(n.playBtnOpenEffect(),0!=this._rune_tpl_id){var a=this._rune_tpl_id;this._rune_tpl_id=0,this.spr_rune.spriteFrame=null,this.node_jian.active=!1,i.dispatchEvent(s.onRuneRemove,a)}},onLoad:function(){this.spr_rune.node.on("touchstart",this.onTipsTouchBegan,this),this.spr_rune.node.on("touchcancel",this.onTipsTouchEnded,this),this.spr_rune.node.on("touchend",this.onTipsTouchEnded,this)},onTipsTouchBegan:function(){var e=this.spr_rune.node.convertToWorldSpaceAR(cc.v2(30,30));600<e.y&&(e.y-=220),0<this._rune_tpl_id&&MyUiManager.OpenRuneTipsWidget(e,this._rune_tpl_id,0)},onTipsTouchEnded:function(){MyUiManager.CloseRuneTipsWidget()},onDestroy:function(){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],RuneLevelupLayer:[function(e,t,a){"use strict";cc._RF.push(t,"6856aynZrNMqqlPzIWpIGM8","RuneLevelupLayer");var o=e("SoundUtil"),n=(e("ColorUtil"),e("MyUIEvent")),i=e("NetEvent"),r=e("MyEventDispatcher"),l=e("RuneUtil"),c=e("HeroRuneLayer"),h=e("RunesBufferMgr"),d=e("i18n"),_=e("MyProtocols"),s=e("HeroBufferMgr");cc.Class({extends:cc.Component,properties:{_rune_index:0,_hero_entity:null,node_prop_list_level:cc.Node,node_prop_list1:cc.Node,node_prop_list2:cc.Node,lab_cost_coins:cc.Label,node_exp_progress:cc.Node,lab_exp_progress:cc.Label,pre_rune_item_bag:cc.Prefab,rune_bag_container:cc.Node,rune_item_ctrl:cc.Node,_exp_item_num:0,_cost_rune_num:0},setParams:function(e){this._rune_index=e.rune_index,this._hero_entity=e.hero_entity,this.refreshUi()},refreshUi:function(){var e=this._hero_entity.runePutup[this._rune_index],t=this._hero_entity.runeLevel[this._rune_index];this.rune_item_ctrl.getComponent("RuneItem").changeStaticShow(e,t),this.node_prop_list_level.getChildByName("OriginPropLabel").getComponent(cc.Label).string=" cấp bậc ："+t,this.node_prop_list_level.getChildByName("ImprovePropLabel").getComponent(cc.Label).string=t+1+"(+1)";var a=DonotDestroyManager.GameData.Runes[e],n=a.quality,i=DonotDestroyManager.GameData.RuneLevel[n],r=0<t?i.add_on[t-1]:0,s=l.getRuneDescList(a,r/100),o=i.add_on[t],c=l.getRuneDescPair(a,o/100,(o-r)/100);this.node_prop_list1.getChildByName("OriginPropLabel").getComponent(cc.Label).string=s[0],this.node_prop_list1.getChildByName("ImprovePropLabel").getComponent(cc.Label).string=c[0],2==s.length&&(this.node_prop_list2.active=!0,this.node_prop_list2.getChildByName("OriginPropLabel").getComponent(cc.Label).string=s[1],this.node_prop_list2.getChildByName("ImprovePropLabel").getComponent(cc.Label).string=c[1]),this.lab_cost_coins.string=i.cost_coins[t],this._exp_item_num=0,this._cost_rune_num=i.cost_runes[t],this.refreshExpView(),this.refreshBagItems(a.quality)},refreshExpView:function(){var e=this._exp_item_num/this._cost_rune_num;this.node_exp_progress.width=430*e,this.lab_exp_progress.string="Tiến độ: "+parseInt(100*e)+"%"},refreshBagItems:function(e){c.instance.recycleRuneBagItems();var t=h.getRuneList(-1,e),a=this.rune_bag_container.children;if(null!=a&&0<a.length)
for(var n=a.length-1;0<=n;n--)
c.instance._rune_item_pool.put(a[n]);for(var i=0;i<t.length;i++){var r=t[i],s=c.instance._rune_item_pool.get();null==s&&(s=cc.instantiate(this.pre_rune_item_bag)),this.rune_bag_container.addChild(s),s.getComponent("RuneItemBag").changeDataRuneLevelup(r.template_id,r.num)}},goBack:function(){var e=this.rune_bag_container.children;if(null!=e&&0<e.length)
for(var t=e.length-1;0<=t;t--)
c.instance._rune_item_pool.put(e[t]);o.playBtnCloseEffect(),MyUiManager.Back(),c.instance.refreshUi()},onLoad:function(){this.onRuneBagItemSizeChange_cb_func=this.onRuneBagItemSizeChange_cb.bind(this),r.addListener(n.onRuneBagItemSizeChange,this.onRuneBagItemSizeChange_cb_func),this.S2CRuneLevelup_cb_func=this.S2CRuneLevelup_cb.bind(this),r.addListener(i.S2CRuneLevelup,this.S2CRuneLevelup_cb_func)},onDestroy:function(){r.removeListener(n.onRuneBagItemSizeChange,this.onRuneBagItemSizeChange_cb_func),r.removeListener(i.S2CRuneLevelup,this.S2CRuneLevelup_cb_func)},S2CRuneLevelup_cb:function(e){this._hero_entity.runeLevel[e.rune_pos_index]=e.rune_level,MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight,s.updateHeroUnitNum(MyPersistDataManager._playerData.cardsMaplist[e.card_id]),o.playTreaRefineEffect();var t=this._hero_entity.runePutup[this._rune_index],a=DonotDestroyManager.GameData.Runes[t].quality,n=DonotDestroyManager.GameData.RuneLevel[a];if(e.rune_level>=n.add_on.length)
return MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,150),d.t("rune015")),void this.goBack();MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,150),d.t("rune016")),this.refreshUi()},onRuneBagItemSizeChange_cb:function(e){var t=e[0];this._exp_item_num<=0&&t<0||(this._exp_item_num>=this._cost_rune_num&&0<t||(this._exp_item_num+=t,this.refreshExpView(),e[1].confirmChangeVal(t)))},clickHanderUpgrade:function(e,t){if(o.playBtnOpenEffect(),this._exp_item_num==this._cost_rune_num){for(var a=this.rune_bag_container.children,n=[],i=0;i<a.length;i++){var r=a[i].getComponent("RuneItemBag")._use_num;if(0<r){var s=a[i].getComponent("RuneItemBag")._rune_template_id;n.push({template_id:s,count:r})}}
_.send_C2SRuneLevelup(DonotDestroyManager._gameSocket,this._hero_entity.template_id,this._rune_index,n)}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,150),d.t("rune014"))},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",HeroBufferMgr:"HeroBufferMgr",HeroRuneLayer:"HeroRuneLayer",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",RuneUtil:"RuneUtil",RunesBufferMgr:"RunesBufferMgr",SoundUtil:"SoundUtil",i18n:"i18n"}],RuneOilBuyPanel:[function(e,t,a){"use strict";cc._RF.push(t,"82b8crvR39CpYS/3iqyf5Fr","RuneOilBuyPanel");var n=e("SoundUtil"),i=e("ColorUtil"),r=(e("MyUIEvent"),e("MyEventDispatcher")),s=e("NetEvent"),o=e("MyProtocols"),c=e("i18n"),l={1061:0,1062:1,1063:2};cc.Class({extends:cc.Component,properties:{_oil_tpl_id:0,_rune_index:0,_hero_entity:0,_buy_key_count:0,label_own_key:cc.Label,label_cost_jinkuai:cc.Label,editBox_key_num:cc.EditBox,spr_border:cc.Node,spr_rune:cc.Sprite,res_rune_sprites:[cc.SpriteFrame]},onLoad:function(){this.S2CRuneHammerBuy_cb_func=this.S2CRuneHammerBuy_cb.bind(this),r.addListener(s.S2CRuneHammerBuy,this.S2CRuneHammerBuy_cb_func)},S2CRuneHammerBuy_cb:function(e){n.playGainGoodsEffect(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,160),c.t("rune013")),this.refreshUi()},setParams:function(e){this._oil_tpl_id=e[0],this.closeCb=e[1]},start:function(){this.refreshUi(),this._buy_key_count=5,this.refreshJinKuaiNum();var e=DonotDestroyManager.GameData.Items[this._oil_tpl_id];this.spr_border.color=i.getColorByQuality(e.quality),this.spr_rune.spriteFrame=this.res_rune_sprites[l[this._oil_tpl_id]]},refreshUi:function(){var e=0;null!=MyPersistDataManager._playerData.bagMap[this._oil_tpl_id]&&(e=MyPersistDataManager._playerData.bagMap[this._oil_tpl_id].num),this.label_own_key.string=e},refreshJinKuaiNum:function(){this.editBox_key_num.string=this._buy_key_count,this.label_cost_jinkuai.string="x"+this._buy_key_count*DonotDestroyManager.GameData.Common.rune_bless_oil[l[this._oil_tpl_id]]},ClickHanlderFixedCount:function(e,t){n.playBtnOpenEffect(),this._buy_key_count=parseInt(t),this.refreshJinKuaiNum()},ClickHandlerCountAdd:function(e,t){n.playBtnOpenEffect(),this._buy_key_count+=parseInt(t),this._buy_key_count<0&&(this._buy_key_count=0),this.refreshJinKuaiNum()},EditHanlderChangeBuyCount:function(e,t){this._buy_key_count=parseInt(this.editBox_key_num.string),this.refreshJinKuaiNum()},ClickHanlderBuyOil:function(e,t){if(n.playBtnOpenEffect(),0<this._buy_key_count)
if(MyPersistDataManager._playerData.money<this._buy_key_count*DonotDestroyManager.GameData.Common.rune_bless_oil[l[this._oil_tpl_id]]){var a=this;this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent("Không đủ Vàng, bấm đến giao diện nạp",function(){a._alert_layer.removeFromParent(),a._alert_layer.destroy(),a._alert_layer=null,MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1})})}else
o.send_C2SItemBuy(DonotDestroyManager._gameSocket,this._oil_tpl_id,this._buy_key_count);else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin nhập số lượng mua!")},goBack:function(){n.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},onDestroy:function(){r.removeListener(s.S2CRuneHammerBuy,this.S2CRuneHammerBuy_cb_func)},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],RuneOilCtrl:[function(e,t,a){"use strict";cc._RF.push(t,"53ad3ZDH9xAVL/iyh3xkprb","RuneOilCtrl");var n=e("SoundUtil"),i=e("MyEventDispatcher"),r=(e("MyProtocols"),e("ColorUtil")),s=e("MyUIEvent");cc.Class({extends:cc.Component,properties:{node_add:cc.Node,node_sub:cc.Node,lab_num:cc.Label,spr_border:cc.Node,choosed_border:cc.Node,oil_template_id:0,_use_num:0},start:function(){this.showOilNum();var e=DonotDestroyManager.GameData.Items[this.oil_template_id];this.spr_border.color=r.getColorByQuality(e.quality),this.choosed_border.active=!1},showOilNum:function(){var e=0;null!=MyPersistDataManager._playerData.bagMap[this.oil_template_id]&&(e=MyPersistDataManager._playerData.bagMap[this.oil_template_id].num);var t=e-this._use_num;this.lab_num.string=t,this.node_add.active=0<t,0<this._use_num?this.node_sub.active=!0:this.node_sub.active=!1},clearUseNum:function(){this._use_num=0,this.showOilNum()},clickHanlderOil:function(e,t){n.playBtnOpenEffect(),i.dispatchEvent(s.onRuneOilSelect,this.oil_template_id)},clickHanlderAdd:function(e,t){n.playBtnOpenEffect();var a=0;null!=MyPersistDataManager._playerData.bagMap[this.oil_template_id]&&(a=MyPersistDataManager._playerData.bagMap[this.oil_template_id].num),this._use_num<a&&(this._use_num++,i.dispatchEvent(s.onOilUseChange)),this.showOilNum()},clickHanlderSub:function(e,t){n.playBtnOpenEffect(),0<this._use_num&&(this._use_num--,i.dispatchEvent(s.onOilUseChange)),this.showOilNum()},onLoad:function(){this.onRuneOilSelect_cb_func=this.onRuneOilSelect_cb.bind(this),i.addListener(s.onRuneOilSelect,this.onRuneOilSelect_cb_func)},onRuneOilSelect_cb:function(e){this.oil_template_id==e?this.choosed_border.active=!0:this.choosed_border.active=!1},onDestroy:function(){i.removeListener(s.onRuneOilSelect,this.onRuneOilSelect_cb_func)}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],RuneSmallTip:[function(e,t,a){"use strict";cc._RF.push(t,"3617ewow65K0p2Fe2llzxP6","RuneSmallTip");e("SoundUtil");var n=e("ColorUtil");e("MyUIEvent"),e("MyEventDispatcher");cc.Class({extends:cc.Component,properties:{spr_border:cc.Node},onLoad:function(){},changeData:function(e){var t=DonotDestroyManager.GameData.Runes[e];this.spr_border.color=n.getColorByQuality(t.quality)},onDestroy:function(){},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],RuneTab:[function(e,t,a){"use strict";cc._RF.push(t,"013f44WXcNP670dEQjqBItG","RuneTab");var n=e("SoundUtil"),i=(e("ColorUtil"),e("MyUIEvent")),r=e("MyEventDispatcher");cc.Class({extends:cc.Component,properties:{res_selected_sprite:[cc.SpriteFrame],sprite_selected:cc.Sprite,my_rune_func:0},onLoad:function(){this.onRuneTabSelect_cb_func=this.onRuneTabSelect_cb.bind(this),r.addListener(i.onRuneTabSelect,this.onRuneTabSelect_cb_func)},onRuneTabSelect_cb:function(e){e==this.my_rune_func?this.sprite_selected.spriteFrame=this.res_selected_sprite[1]:this.sprite_selected.spriteFrame=this.res_selected_sprite[0]},start:function(){},onDestroy:function(){r.removeListener(i.onRuneTabSelect,this.onRuneTabSelect_cb_func)},clickHanlder:function(e,t){n.playBtnOpenEffect(),r.dispatchEvent(i.onRuneTabSelect,this.my_rune_func)},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],RuneUnlockItem:[function(e,t,a){"use strict";cc._RF.push(t,"0e40cjYjF1GzK29PEq2C/r9","RuneUnlockItem");var n=e("SoundUtil"),i=(e("ColorUtil"),e("MyEventDispatcher")),r=e("MyUIEvent");n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{_rune_index:0,label_rune_type:cc.Label,node_rune_selected:cc.Node},onLoad:function(){this.onRuneUnlockItemSelect=this.onRuneUnlockItemSelect_cb_func.bind(this),i.addListener(r.onRuneUnlockItemSelect,this.onRuneUnlockItemSelect)},onRuneUnlockItemSelect_cb_func:function(e){e==this._rune_index?this.node_rune_selected.active=!0:this.node_rune_selected.active=!1},changeData:function(e,t){this._rune_index=e,this._rune_selected=t},start:function(){var e="";switch(this._rune_index){case 3:e="Công";break;case 4:e="Phòng";break;case 5:e="Trợ"}
this.label_rune_type.string=e,this._rune_selected==this._rune_index?this.node_rune_selected.active=!0:this.node_rune_selected.active=!1},onUnlockItemSelect:function(e,t){n.playBtnOpenEffect(),i.dispatchEvent("onRuneUnlockItemSelect",this._rune_index)},onDestroy:function(){i.removeListener(r.onRuneUnlockItemSelect,this.onRuneUnlockItemSelect)},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],RuneUnlockWidget:[function(e,t,a){"use strict";cc._RF.push(t,"4ff54PyqlVA+b01MHpzuUnx","RuneUnlockWidget");var n=e("SoundUtil"),i=(e("ColorUtil"),e("MyUIEvent")),r=e("MyEventDispatcher"),s=e("NetEvent"),o=e("MyProtocols"),c=e("i18n");cc.Class({extends:cc.Component,properties:{_rune_index:0,_hero_entity:0,_buy_key_count:0,prefab_rune_unlock_item:cc.Prefab,label_own_key:cc.RichText,label_cost_jinkuai:cc.Label,editBox_key_num:cc.EditBox},onLoad:function(){this.onRuneUnlockItemSelect=this.onRuneUnlockItemSelect_cb_func.bind(this),r.addListener(i.onRuneUnlockItemSelect,this.onRuneUnlockItemSelect),this.S2CRuneHammerBuy_cb_func=this.S2CRuneHammerBuy_cb.bind(this),r.addListener(s.S2CRuneHammerBuy,this.S2CRuneHammerBuy_cb_func),this.S2CRuneUnlock_cb_func=this.S2CRuneUnlock_cb.bind(this),r.addListener(s.S2CRuneUnlock,this.S2CRuneUnlock_cb_func)},S2CRuneUnlock_cb:function(e){MyUiManager.Back()},S2CRuneHammerBuy_cb:function(e){n.playGainGoodsEffect(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),c.t("rune001")),this.refreshUi()},onRuneUnlockItemSelect_cb_func:function(e){cc.log(" lựa chọn ký hiệu khuông :"+e),this._rune_index=e},setParams:function(e){this._rune_index=e.rune_index,this._hero_entity=e.hero_entity},start:function(){0<4-this._hero_entity.runeUnlock.length&&this.refreshUi()},refreshUi:function(){var e=4-this._hero_entity.runeUnlock.length;if(0<e){var t=4-e,a=DonotDestroyManager.GameData.Common.rune_cost_hammer[t],n=0,i=MyPersistDataManager._playerData.bagMap[1060];null!=i&&(n=i.num);var r="";r=n<a?"#ff0000":"#00ff00",this.label_own_key.string=cc.js.formatStr("<color=%s>%d</c><color=#ffffff>/%d</color>",r,n,a);var s=0;n<a&&(s=a-n),this._buy_key_count=s,this.editBox_key_num.string=s,this.label_cost_jinkuai.string="x"+s*DonotDestroyManager.GameData.Common.rune_hammer_price}},buyKeyCountClickHanlder:function(e,t){n.playBtnOpenEffect(),this._buy_key_count=parseInt(t),this.editBox_key_num.string=t,this.label_cost_jinkuai.string="x"+t*DonotDestroyManager.GameData.Common.rune_hammer_price},buyKeyCountAddHanlder:function(e,t){n.playBtnOpenEffect(),this._buy_key_count+=parseInt(t),this._buy_key_count<0&&(this._buy_key_count=0),this.editBox_key_num.string=this._buy_key_count,this.label_cost_jinkuai.string="x"+this._buy_key_count*DonotDestroyManager.GameData.Common.rune_hammer_price},buyKeyCountEditHanlder:function(e,t){this._buy_key_count=parseInt(this.editBox_key_num.string),this.label_cost_jinkuai.string="x"+this._buy_key_count*DonotDestroyManager.GameData.Common.rune_hammer_price},buyHammerHanlder:function(e,t){if(n.playBtnOpenEffect(),0<this._buy_key_count)
if(MyPersistDataManager._playerData.money<this._buy_key_count*DonotDestroyManager.GameData.Common.rune_hammer_price){var a=this;this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent("Không đủ Vàng, bấm đến giao diện nạp",function(){a._alert_layer.removeFromParent(),a._alert_layer.destroy(),a._alert_layer=null,MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1})})}else
o.send_C2SItemBuy(DonotDestroyManager._gameSocket,1060,this._buy_key_count);else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin nhập số lượng mua!")},unlockRuneHanlder:function(e,t){var a=4-this._hero_entity.runeUnlock.length;if(0<a){var n=4-a,i=DonotDestroyManager.GameData.Common.rune_cost_hammer[n],r=0,s=MyPersistDataManager._playerData.bagMap[1060];null!=s&&(r=s.num),r<i?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không đủ Búa! Cần "+i+" cái!"):o.send_C2SRuneUnlock(DonotDestroyManager._gameSocket,this._hero_entity.template_id,this._rune_index)}},goBack:function(){n.playBtnCloseEffect(),MyUiManager.Back()},onDestroy:function(){r.removeListener(i.onRuneUnlockItemSelect,this.onRuneUnlockItemSelect),r.removeListener(s.S2CRuneHammerBuy,this.S2CRuneHammerBuy_cb_func),r.removeListener(s.S2CRuneUnlock,this.S2CRuneUnlock_cb_func)},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],RuneUtil:[function(e,t,a){"use strict";cc._RF.push(t,"45638gFqhVHJarF4U1iuzAg","RuneUtil");var s=["maxhp","atk","def","dmg_deal_static","dmg_get_static","hit_rate","dodge","crit_rate","crit_coef","speedup","unit_num","blood","treatment","anti_debuff","reduce_debuff"],n={maxhp:"HP",atk:"Công",def:"Phòng",dmg_deal_static:"Phá Giáp",dmg_get_static:"Miễn Thương",hit_rate:"Mệnh Trung",dodge:"Né Tránh",crit_rate:"Bạo Kích",crit_coef:"Bạo Thương",speedup:"Tốc độ",unit_num:"Số binh",blood:"Hút HP",treatment:"Hiệu quả trị liệu",anti_debuff:"Kháng hiệu ứng phụ",reduce_debuff:"Giảm hiệu ứng phụ"};t.exports={getRuneDesc:function(e){return this.getRuneDescList(e,0).join("\n")},getRuneDescList:function(e,t){for(var a=[],n=0;n<s.length;n++){var i=s[n],r=e[i];null!=r&&(this.isPercent(n+1)?a.push(this.getRuneAttriChiName(i)+":+"+parseInt(r/10*(1+t))+"%"):a.push(this.getRuneAttriChiName(i)+":+"+parseInt(r*(1+t))))}
return a},getRuneDescPair:function(e,t,a){for(var n=[],i=e.addon_type.split("-"),r=0;r<i.length;r++){var s=parseInt(i[r]),o=this.getRuneAttriNameByAddonId(s);if(this.isPercent(s)){var c=parseInt(e[o]/10*t),l=parseInt(e[o]/10*a);n.push(e[o]/10+c+"%(+"+l+"%)")}else{var h=parseInt(e[o]*t),d=parseInt(e[o]*a);n.push(e[o]+h+"(+"+d+")")}}
return n},getRuneAttriNameByAddonId:function(e){return s[e-1]},getRuneAttriChiName:function(e){return n[e]},isPercent:function(e){var t=!1;return 10!=e&&12!=e&&13!=e&&14!=e&&15!=e||(t=!0),t}},cc._RF.pop()},{}],RunesBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"51ebeGWVFhEap52SLZUsObr","RunesBufferMgr");var n=function(){this.mRuneList=[]};n.prototype.initRuneList=function(e){e.length<=0?this.mRuneList=[]:this.mRuneList=e},n.prototype.AddRuneEntity=function(e){for(var t=null,a=0;a<this.mRuneList.length;++a){var n=this.mRuneList[a];n.template_id==e.template_id&&(t=n)}
null!=t?t.num=e.num:this.mRuneList.push(e)},n.prototype.AddRuneNum=function(e,t){for(var a=null,n=0,i=0;i<this.mRuneList.length;++i){var r=this.mRuneList[i];r.template_id==e&&(a=r,n=i)}
null!=a&&t<=0&&this.mRuneList.splice(n,1)},n.prototype.getRuneList=function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,a=[],n=0;n<this.mRuneList.length;++n){var i=this.mRuneList[n],r=i.template_id,s=DonotDestroyManager.GameData.Runes[r];-1<e&&s.func!=e||(-1<t&&s.quality!=t||a.push(i))}
return a},n.prototype.hasRune=function(){return 0<this.mRuneList.length},n.prototype.checkRuneCombineRedPoint=function(){for(var e=!1,t=new Array(4),a=0;a<this.mRuneList.length;++a){var n=this.mRuneList[a],i=n.template_id,r=DonotDestroyManager.GameData.Runes[i];null!=t[r.quality]?t[r.quality]+=n.num:t[r.quality]=n.num}
for(var s=DonotDestroyManager.GameData.RuneCombine,o=Object.keys(s),c=0;c<o.length;c++){var l=s[o[c]],h=l.quality-1;if(null!=t[h]&&t[h]>=l.num){e=!0;break}}
return e},t.exports=new n,cc._RF.pop()},{}],SecretBattleManager:[function(r,e,t){"use strict";cc._RF.push(e,"69edc9aos1Fvoy94H31ncrc","SecretBattleManager");var a=r("BattleUtil"),g=(r("TeamDataUtil"),r("BattleDataManager")),c=r("StageEventCfgMgr"),p=r("StagesConfigMgr"),m=r("EliteStagesConfigMgr"),o=r("BattleManager"),l=r("MyProtocols"),y=(r("StageBufferMgr"),r("BattleBufferMgr")),v=r("HeroBufferMgr"),M=r("SecretBufferMgr"),n=function(){};n.prototype.init=function(e,t,a){this.stageId=e,this.leftData=this.getLeftData(),this.leftData.fightVal=t,this.rightData=this.getElitePVERightData(e),this.rightData.fightVal=a,this.extraBattleTeam(),this.extraBattleBuff(),this.background=p.getStageBackground(e),this.mCrossGroup=!1;var n=p.getStageByStageId(e);this.mCostEnergy=n.energy_cost,this.mStageTag="PVE_NORMAL_"+this.stageId},n.prototype.getLeftData=function(){var e={side:"left"};e.name=MyPersistDataManager._playerData.name,e.level=MyPersistDataManager._playerData.level;var t=y.getFormationData(101);e.formation=t.formationId,e.forward=t.forward,e.flip=t.flip;for(var a=g.create(e),n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];if("fid"!=r&&"formationId"!=r&&"forward"!=r&&"flip"!=r){var s=t[r];if("0"!=r){var o=v.getHeroByUid(s);if(null!=o){var c=M.getMyHpPercent(s);o.hpPerc=c/10,a.addCardWithPosition(o,r)}else if(0<s){var l={},h=DonotDestroyManager.GameData.SecretSoldiers,d=MyPersistDataManager._playerData.level,_=h.levels[d];l.hero={},l.hero.id=s,l.hero.level=_.level,l.hero.grade=_.card_grade,l.hero.skill_enable=[1,1,1,1],_.add_attrs.rates&&(l.hero.rates_maxhp=_.add_attrs.rates.maxhp,l.hero.rates_atk=_.add_attrs.rates.atk,l.hero.rates_def=_.add_attrs.rates.def),_.add_attrs.statics&&(l.hero.static_maxhp=_.add_attrs.statics.maxhp,l.hero.static_atk=_.add_attrs.statics.atk,l.hero.static_def=_.add_attrs.statics.def),l.unit_num=_.unit_num,l.unit_grade=_.unit_grade,l.unit_level=_.unit_level,delete l.atkPerc;var u=M.getMobIndexByCardTplId(s),m=M.getMyHpPercent(-u)/10;l.hpPerc=m,a.addHeroWithPosition(l,r)}}}}
for(var p=0;p<a.teams.length;p++){l=a.teams[p];if(v.isHasHeroByTid(l.hero.heroId)){var f=v.getExtraPropAttr(l.hero.heroId);l.hero.extraAttr=cc.clone(f)}}
return a},n.prototype.extraBattleTeam=function(){for(var e=this.rightData.stage_event,t=c.getEvtTeamList(e),a=0;a<t.length;a++)
for(var n=t[a],i=0;i<n.length;i++){var r=n[i];if("left"==r.side)
for(var s=0;s<r.list.length;s++){var o=r.list[s];this.leftData.extraTeams.push(o)}
else if("right"==r.side)
for(s=0;s<r.list.length;s++){o=r.list[s];this.rightData.extraTeams.push(o)}}},n.prototype.extraBattleBuff=function(){for(var e=this.rightData.stage_event,t=c.getEvtBuffList(e),a=0;a<t.length;a++){var n=t[a];this.rightData.extraBuffs.push(n)}},n.prototype.getPVERightData=function(e){var t=p.getStageByStageId(e),a=DonotDestroyManager.GameData.StageMobs[e],n={};n.name="Ải "+e%100+" ",n.side="right",n.level=t.require_level,n.formation=a.formation,n.forward=a.forward,n.flip=a.flip;var i=g.create(n);i.stageId=e,i.stage_event=t.stage_event,i.isMobHero=!0,i.stars=t.stars;for(var r=Object.keys(a),s=0,o=0;o<r.length;o++){var c=r[o];if("formation"!==c&&"forward"!==c&&"flip"!==c&&"battleground"!==c){var l=a[c];if(!DonotDestroyManager.GameData.Common.FIGHT_CONTROL_ENEMY[0]){if(0==M.getEnemyHpPercent(-s)){s++;continue}
var h={},d=t.attrs[l.mob_type-1];if(h.hero={},h.hero.id=l.mob_id,h.hero.level=d.level,h.hero.grade=d.card_grade,l.skill_enable){h.hero.skill_enable=[];for(var _=0;_<l.skill_enable.length;_++){var u=l.skill_enable[_];h.hero.skill_enable.push(u)}}
d.add_attrs.rates&&(h.hero.rates_maxhp=d.add_attrs.rates.maxhp,h.hero.rates_atk=d.add_attrs.rates.atk,h.hero.rates_def=d.add_attrs.rates.def),d.add_attrs.statics&&(h.hero.static_maxhp=d.add_attrs.statics.maxhp,h.hero.static_atk=d.add_attrs.statics.atk,h.hero.static_def=d.add_attrs.statics.def),h.unit_num=d.unit_num,h.unit_grade=d.unit_grade,h.unit_level=d.unit_level;var m=M.getEnemyHpPercent(-s)/10;h.hpPerc=m,i.addHeroWithPosition(h,l.position)}
s++}}
return i},n.prototype.getElitePVERightData=function(e){var t=m.getStageByStageId(e),a=m.getEliteGroup(e),n=DonotDestroyManager.GameData.EliteStageMobs[e],i={};i.name=cc.js.formatStr("Cứ Điểm %d",e%100),t.isboss&&(i.name=a.name),i.side="right",i.level=30,i.formation=n.formation,i.forward=n.forward,i.flip=n.flip;var r=g.create(i);r.stageId=e,r.stage_event=t.stage_event,r.isMobHero=!0,r.stars=t.stars;for(var s=Object.keys(n),o=0,c=0;c<s.length;c++){var l=s[c];if("formation"!==l&&"forward"!==l&&"flip"!==l&&"battleground"!==l){var h=n[l];if(!DonotDestroyManager.GameData.Common.FIGHT_CONTROL_ENEMY[4]){if(0==M.getEnemyHpPercent(-o)){o++;continue}
var d={},_=t.attrs[h.mob_type-1];d.hero={},d.hero.id=h.mob_id,d.hero.level=_.level,d.hero.grade=_.card_grade,_.add_attrs.rates&&(d.hero.rates_maxhp=_.add_attrs.rates.maxhp,d.hero.rates_atk=_.add_attrs.rates.atk,d.hero.rates_def=_.add_attrs.rates.def),_.add_attrs.statics&&(d.hero.static_maxhp=_.add_attrs.statics.maxhp,d.hero.static_atk=_.add_attrs.statics.atk,d.hero.static_def=_.add_attrs.statics.def),d.unit_num=_.unit_num,d.unit_grade=_.unit_grade,d.unit_level=_.unit_level;var u=M.getEnemyHpPercent(-o)/10;d.hpPerc=u,r.addHeroWithPosition(d,h.position)}
o++}}
return r},n.prototype.enterBattlefield=function(){var e={background:this.background,teamAiCfg:DonotDestroyManager.GameData.TeamSkillsAI[1][this.stageId],type:11},t=this;a.createBattlefield(this.leftData,this.rightData,e,function(){t.onSuccess()},function(){t.onFailure()}),a.enterRealScene()},n.prototype.onSuccess=function(){for(var e=[],t=0;t<o.ourside.armies.length;++t){var a=o.ourside.armies[t];if(null!=a.hero){var n={},i=0;"Dead"!=a.hero.getState()&&(i=parseInt(1e3*a.hero.hp/a.hero.basehp)),i<=0?i=0:1e3<(i+=200)&&(i=1e3),n.hp_percent=i;var r=a.hero.id;if(v.isHasHeroByTid(r))
n.hero_type=1,n.hero_id=r;else{n.hero_type=2;var s=DonotDestroyManager.GameData.SecretSoldiers.mob_id.indexOf(r);n.hero_id=s}
e.push(n)}}
l.send_C2SSecretBattleEnd(DonotDestroyManager._gameSocket,!0,e,[],!1)},n.prototype.calculateS2cCb=function(e){var t=r("BattleSceneMgr");if(1==e.is_win){var a=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/SecretWinPanel"]);cc.Canvas.instance.node.addChild(a),a.getComponent("SecretWinPanel").ChangeData(e),a.getComponent("SecretWinPanel").setStatistics(this.leftData,this.rightData,o.statistics)}else{var n=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(n);var i=DonotDestroyManager.GameData.Secret[0].loose_strength[0];n.getComponent("BattleFailMgr").initUi(11,{cost_energy:i,staticData:o.statistics})}
M.updateNetData(e)},n.prototype.onFailure=function(){cc.log("faied==============");for(var e=[],t=0;t<o.otrside.armies.length;++t){var a=o.otrside.armies[t];if(null!=a.hero){var n={},i=0;"Dead"!=a.hero.getState()&&(i=1e3*a.hero.hp/a.hero.basehp,i=parseInt(i)),0<i&&(i+=200),i=1e3<(i=i<0?0:i)?1e3:i,n.hero_type=2,n.hp_percent=i,n.hero_id=t,e.push(n)}}
l.send_C2SSecretBattleEnd(DonotDestroyManager._gameSocket,!1,[],e,!1)},e.exports=new n,cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleUtil:"BattleUtil",EliteStagesConfigMgr:"EliteStagesConfigMgr",HeroBufferMgr:"HeroBufferMgr",MyProtocols:"MyProtocols",SecretBufferMgr:"SecretBufferMgr",StageBufferMgr:"StageBufferMgr",StageEventCfgMgr:"StageEventCfgMgr",StagesConfigMgr:"StagesConfigMgr",TeamDataUtil:"TeamDataUtil"}],SecretBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"c8c2eMA9edBa58YkY/ZCRbc","SecretBufferMgr");var n=function(){};n.prototype.initNetData=function(e){this._netData=e,this.prepareData()},n.prototype.updateNetData=function(e){this._netData.map_id=e.map_id,this._netData.progress=e.progress,this._netData.boxAward=e.boxAward,this._netData.my_cost=e.my_cost,this._netData.enemy_cost=e.enemy_cost,this._netData.online_formation=e.online_formation,this.prepareData()},n.prototype.prepareData=function(){if(this._netData.my_cost_map={},0<this._netData.my_cost.length)
for(var e=0;e<this._netData.my_cost.length;e++){var t=this._netData.my_cost[e];this._netData.my_cost_map[t.hero_id]=t.hp_percent}
if(this._netData.enemy_cost_map={},0<this._netData.enemy_cost.length)
for(var a=0;a<this._netData.enemy_cost.length;a++){var n=this._netData.enemy_cost[a];this._netData.enemy_cost_map[n.hero_id]=n.hp_percent}},n.prototype.resetMyCost=function(e){delete this._netData.my_cost_map[e]},n.prototype.resetData=function(){this._netData.map_id=0,this._netData.progress=0,this._netData.could_reset=!1,this._netData.boxAward=[],this._netData.my_cost=[],this._netData.enemy_cost=[],this._netData.online_formation=[],this._netData.revive_count=0,this.prepareData()},n.prototype.getReviveCount=function(){return this._netData.revive_count},n.prototype.addReviveCount=function(e){this._netData.revive_count+=e},n.prototype.getMobIndexByCardTplId=function(e){return DonotDestroyManager.GameData.SecretSoldiers.mob_id.indexOf(e)},n.prototype.getMyHpPercent=function(e){var t=1e3;return null!=this._netData.my_cost_map[e]&&(t=this._netData.my_cost_map[e]),t},n.prototype.getEnemyHpPercent=function(e){var t=1e3;return null!=this._netData.enemy_cost_map[e]&&(t=this._netData.enemy_cost_map[e]),t},n.prototype.setMapId=function(e){this.mapId=e},n.prototype.getMapId=function(){return this.mapId},n.prototype.setOnlineFormation=function(e){this.heroIdList=e},n.prototype.getOnlineFormation=function(){for(var e=[],t=0;t<this.heroIdList.length;t++){var a=this.heroIdList[t];0<a?e.push({hero_type:1,hero_id:a,hp_percent:1e3}):e.push({hero_type:2,hero_id:-a,hp_percent:1e3})}
return e},n.prototype.getNetOnlineFormation=function(){for(var e=this._netData.online_formation,t=[],a=e.length-1;0<=a;a--){var n=e[a],i=n.hero_id;0<this.getMyHpPercent(i)&&t.push(n)}
return t},t.exports=new n,cc._RF.pop()},{}],SecretMainPanel:[function(e,t,a){"use strict";cc._RF.push(t,"12f61MUIIBJfqdl6De7nVph","SecretMainPanel");var r=e("SoundUtil"),s=e("i18n"),n=e("MyEventDispatcher"),i=e("MyProtocols"),o=e("NetEvent"),c=e("SecretBufferMgr"),l=e("BattleBufferMgr");cc.Class({extends:cc.Component,properties:{node_arrow_tip:cc.Node,node_chest_parent:cc.Node,node_point_parent:cc.Node,lab_secret_title:cc.Label,node_red_mind_icon:cc.Node,m_pRewardPanel:cc.Prefab,_map_index:0,_tmpStageIndex:0},setParams:function(e){this.closeCb=e.closeCb,this._netData=e.netData},goBack:function(){r.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},showHelpPanel:function(e,t){r.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.SecretHelpPanel,{})},onLoad:function(){this.S2CSecretGetAward_cb_func=this.S2CSecretGetAward_cb.bind(this),n.addListener(o.S2CSecretGetAward,this.S2CSecretGetAward_cb_func),this.S2CSecretReset_cb_func=this.S2CSecretReset_cb.bind(this),n.addListener(o.S2CSecretReset,this.S2CSecretReset_cb_func),this.ActivitiesBattleFormation_auth_cb_func=this.ActivitiesBattleFormation_auth_cb.bind(this),n.addListener(o.S2CActivitiesBattleFormation,this.ActivitiesBattleFormation_auth_cb_func)},onDestroy:function(){n.removeListener(o.S2CSecretGetAward,this.S2CSecretGetAward_cb_func),n.removeListener(o.S2CSecretReset,this.S2CSecretReset_cb_func),n.removeListener(o.S2CActivitiesBattleFormation,this.ActivitiesBattleFormation_auth_cb_func)},ActivitiesBattleFormation_auth_cb:function(e){null!=e.formation&&l.setFormationData(e.formation.fid,e.formation)},S2CSecretReset_cb:function(){MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Reset thành công!"),c.resetData(),this.refreshUI()},S2CSecretGetAward_cb:function(e){var t=e.stage_index;if(this._tmpStageIndex=t,null!=e.reward_items&&0<e.reward_items.length){var a=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(a),a.getComponent("GetRewardPanel")._itemlist=e.reward_items,a.getComponent("GetRewardPanel")._closeCb=this.awardCloseCb.bind(this)}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Nhận thành công");this._netData.boxAward[t].is_get=1,this._netData.boxAward[t].award_list=e.reward_items},awardCloseCb:function(){this.node_chest_parent.children[this._tmpStageIndex].getComponent(cc.Animation).destroy()},start:function(){this.refreshUI();l.isHasFidFormation(101)||i.send_C2SActivitiesBattleFormation(DonotDestroyManager._gameSocket,101)},refreshUI:function(){if(0==this._netData.map_id){for(var e=DonotDestroyManager.GameData.Secret,t=MyPersistDataManager._playerData.level,a=null,n=0;n<e.length;n++){var i=e[n];if(n==e.length-1)
a=i;else if(t>=i.lv&&t<e[n+1].lv){a=i;break}}
this._map_index=a.id-1,this.displayTitle()}else
this._map_index=this._netData.map_id-1,this.displayTitle();this.refreshPointAndChest()},refreshPointAndChest:function(){for(var e=0;e<=this._netData.progress;e++)
e<this.node_point_parent.children.length&&(this.node_point_parent.children[e].active=!0),0<=e-1&&(this.node_chest_parent.children[e-1].active=!0);for(;e<=this.node_chest_parent.children.length;e++)
e<this.node_point_parent.children.length&&(this.node_point_parent.children[e].active=!1),0<=e-1&&(this.node_chest_parent.children[e-1].active=!1);for(var t=0;t<this._netData.boxAward.length;t++){var a=this.node_chest_parent.children[t];0<this._netData.boxAward[t].is_get&&a.getComponent(cc.Animation).destroy()}
var n=this._netData.progress;n<this.node_point_parent.children.length?(this.node_arrow_tip.active=!0,this.node_arrow_tip.parent=this.node_point_parent.children[n],this.node_arrow_tip.setPosition(0,91)):this.node_arrow_tip.active=!1,1==this._netData.could_reset?this.node_red_mind_icon.active=!0:this.node_red_mind_icon.active=!1},displayTitle:function(){var e=DonotDestroyManager.GameData.Secret,t=e[this._map_index],a=this._map_index==e.length-1?100:e[this._map_index+1].lv,n=cc.js.formatStr("Căn Cứ Bí Mật%d:lv%d-%d",this._map_index+1,t.lv,a);this.lab_secret_title.string=n},clickHanlderSwitchMap:function(e,t){r.playBtnOpenEffect();var a=parseInt(t),n=DonotDestroyManager.GameData.Secret;if(!(1==a&&this._map_index==n.length-1||-1==a&&0==this._map_index)){var i=n[this._map_index+a];MyPersistDataManager._playerData.level<i.lv?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,180),s.t("secret001")):0<this._netData.progress?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,180),s.t("609")):(this._map_index+=a,this.displayTitle())}},clickHanlderPointDetail:function(e,t){var a=parseInt(t);r.playBtnOpenEffect(),this._netData.progress>a?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,180),s.t("secret006")):MyUiManager.Open(MyUiManager.PanelInfo.SecretPointPanel,{mapIndex:this._map_index,pointIndex:a})},clickHanlderChestOpen:function(e,t){var a=parseInt(t);(r.playBtnOpenEffect(),this._netData.progress<=a)?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,180),s.t("secret005")):0<this._netData.boxAward[a].is_get?MyUiManager.Open(MyUiManager.PanelInfo.SecretRewardPanel,{reward_list:this._netData.boxAward[a].award_list}):i.send_C2SSecretGetAward(DonotDestroyManager._gameSocket,a)},clickHanlderReset:function(e,t){if(r.playBtnOpenEffect(),1==this._netData.could_reset){var a=this;this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent("Có reset Căn Cứ Bí Mật không?Toàn bộ lịch sử sẽ bị xóa!",function(){a._alert_layer.destroy(),a._alert_layer=null,i.send_C2SSecretReset(DonotDestroyManager._gameSocket)})}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,180),s.t("secret007"))}}),cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SecretBufferMgr:"SecretBufferMgr",SoundUtil:"SoundUtil",i18n:"i18n"}],SecretPointPanel:[function(v,e,t){"use strict";cc._RF.push(e,"dadf3jJ+LdI84il9g9lCIV3","SecretPointPanel");var M=v("SoundUtil"),a=v("MyEventDispatcher"),n=v("MyUIEvent"),r=v("NetEvent"),S=v("i18n"),C=v("StagesConfigMgr"),D=v("BattleBufferMgr"),I=v("NPCFightCfgMgr"),b=v("SecretBufferMgr"),s=[[-273,145],[-133,145],[98,145],[224,145],[-273,-73],[-133,-73],[98,-73],[224,-73]],o=cc.Class({extends:cc.Component,properties:{node_hero_parent:cc.Node,node_soldier_parent:cc.Node,nodes_tab:[cc.Node],pre_hero_box:cc.Prefab,node_heros:cc.Node,node_soldiers:cc.Node,node_selected_hero:cc.Node,node_guide:cc.Node,res_tab_bg:[cc.SpriteFrame],_tab_selected_index:0,_selected_hero_pool:cc.NodePool,_selected_heros:[]},statics:{Instance:null},onLoad:function(){(o.Instance=this)._selected_hero_pool=new cc.NodePool,this._selected_heros=[],this.onHeroBoxSelect_cb_func=this.onHeroBoxSelect_cb.bind(this),a.addListener(n.onHeroBoxSelect,this.onHeroBoxSelect_cb_func),this.onHeroBoxUnSelect_cb_func=this.onHeroBoxUnSelect_cb.bind(this),a.addListener(n.onHeroBoxUnSelect,this.onHeroBoxUnSelect_cb_func),this.S2CSecretSoldierRevive_cb_func=this.S2CSecretSoldierRevive_cb.bind(this),a.addListener(r.S2CSecretSoldierRevive,this.S2CSecretSoldierRevive_cb_func)},onDestroy:function(){o.Instance=null,this._selected_hero_pool.clear(),a.removeListener(n.onHeroBoxSelect,this.onHeroBoxSelect_cb_func),a.removeListener(n.onHeroBoxUnSelect,this.onHeroBoxUnSelect_cb_func),a.removeListener(r.S2CSecretSoldierRevive,this.S2CSecretSoldierRevive_cb_func)},S2CSecretSoldierRevive_cb:function(e){M.playGainGoodsEffectNew(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Hồi HP thành công!");var t=e.hero_id;b.resetMyCost(t),b.addReviveCount(1)},isOnlineFormation:function(e){return-1<this._selected_heros.indexOf(e)},onHeroBoxUnSelect_cb:function(e){var t=this._selected_heros.indexOf(e);this._selected_heros.splice(t,1),this.refreshSelectedHeroList()},onHeroBoxSelect_cb:function(e){var t=e._mob_id,a=this._selected_heros.indexOf(t);if(-1<a)
e.setSelect(!1),this._selected_heros.splice(a,1);else{var n=MyPersistDataManager._playerData.formationSlots;if(n=8<n?8:n,this._selected_heros.length>=n)
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),S.t("secret002"));for(var i=0,r=0;r<this._selected_heros.length;r++)
0<this._selected_heros[r]&&i++;if(3<=i&&0<t)
return MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),S.t("secret003")),this.node_guide.active=!0,this.node_guide.stopAllActions(),void this.node_guide.runAction(cc.sequence(cc.show(),cc.delayTime(2),cc.hide()));e.setSelect(!0),this._selected_heros.push(t)}
this.refreshSelectedHeroList()},refreshSelectedHeroList:function(){for(var e=0;e<this.node_selected_hero.children.length;e++){var t=this.node_selected_hero.children[e].getChildByName("HeroBoxSelect");null!=t&&this._selected_hero_pool.put(t)}
for(var a=0;a<this.node_selected_hero.children.length&&a<this._selected_heros.length;a++){var n=this.node_selected_hero.children[a],i=this._selected_hero_pool.get();null==i&&(i=cc.instantiate(this.pre_hero_box)).setPosition(0,-29),n.addChild(i);var r=this._selected_heros[a];if(0<r){var s=MyPersistDataManager._playerData.cardsMaplist[r];i.getComponent("HeroBoxSelect").ChangeHeroInfoFormation(s.template_id,s.template_id,s.level,s.grade)}else{var o=DonotDestroyManager.GameData.SecretSoldiers,c=MyPersistDataManager._playerData.level,l=o.levels[c],h=o.mob_id[-r];i.getComponent("HeroBoxSelect").ChangeHeroInfoFormation(r,h,c,l.card_grade)}}},setParams:function(e){this.closeCb=e.closeCb,this._point_index=e.pointIndex,this._map_index=e.mapIndex},goBack:function(){M.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},start:function(){this.initOnlineFormation();this._tab_selected_index=0,this.changeSelectedTab(0),this.node_heros.active=!0,this.node_soldiers.active=!1,this.initHeroList();var e=MyPersistDataManager._playerData.formationSlots;e=8<e?8:e;for(var t=0;t<this.node_selected_hero.children.length;t++){var a=this.node_selected_hero.children[t];3<=t&&(a.getChildByName("unlocked").active=e<t+1)}},initHeroList:function(){if(!(0<this.node_hero_parent.children.length))
for(var e=MyPersistDataManager._playerData.cardslist,t=0;t<e.length;t++){var a=e[t],n=cc.instantiate(this.pre_hero_box);this.node_hero_parent.addChild(n),n.getComponent("HeroBoxSelect").ChangeHeroInfo(a.template_id,a.template_id,a.level,a.grade)}},initOnlineFormation:function(){for(var e=b.getNetOnlineFormation(),t=0;t<e.length;t++){var a=e[t];this._selected_heros.push(a.hero_id)}
this.refreshSelectedHeroList()},initSoldierList:function(){if(!(0<this.node_soldier_parent.children.length))
for(var e=DonotDestroyManager.GameData.SecretSoldiers,t=MyPersistDataManager._playerData.level,a=e.levels[t],n=0;n<e.mob_id.length;n++){var i=e.mob_id[n],r=cc.instantiate(this.pre_hero_box);this.node_soldier_parent.addChild(r),r.setPosition(s[n][0],s[n][1]),r.getComponent("HeroBoxSelect").ChangeHeroInfo(-n,i,t,a.card_grade)}},changeSelectedTab:function(e){for(i=0;i<this.nodes_tab.length;i++){var t=this.nodes_tab[i];i==e?t.getChildByName("tabNormal").getComponent(cc.Sprite).spriteFrame=this.res_tab_bg[1]:t.getChildByName("tabNormal").getComponent(cc.Sprite).spriteFrame=this.res_tab_bg[0]}},clickHanlderTabSwitch:function(e,t){M.playBtnOpenEffect();var a=parseInt(t);a!=this._tab_selected_index&&(this._tab_selected_index=a,this.changeSelectedTab(a),0==a?(this.node_heros.active=!0,this.node_soldiers.active=!1,this.initHeroList()):(this.node_heros.active=!1,this.node_soldiers.active=!0,this.initSoldierList()))},clickHanlderFight:function(e,t){M.playBtnOpenEffect();var a=DonotDestroyManager.GameData.Secret,n=a[this._map_index].win_strength[this._point_index];if(MyPersistDataManager._playerData.energy<n)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,180),S.t("mine003"),1e3);else if(0!=this._selected_heros.length){b.setMapId(this._map_index+1),b.setOnlineFormation(this._selected_heros);var i={},r=MyPersistDataManager._playerData.level,s=["a","b","c","d","e","f","g","h"],o=D.getFormationData(101);D.resetFormationCard(o);for(var c=0;c<this._selected_heros.length;c++){var l=this._selected_heros[c];if(l<=0){var h=-l;l=DonotDestroyManager.GameData.SecretSoldiers.mob_id[h];var d=DonotDestroyManager.GameData.SecretSoldiers.levels[r],_=I.getNPCStageFight(l,d);i[l]=_}
o[s[c]]=l}
D.setFormationData(101,o);var u=a[this._map_index].stage_list[this._point_index],m=DonotDestroyManager.GameData.StageMobs[u],p=C.getStageByStageId(u),f={name:"Vệ Sĩ Căn Cứ LV"+p.require_level,fight:0,formation:m.formation,Teams:this.GetEnemyTeams(p),id:u,forward:m.forward,flip:m.flip},g={energy_cost:n,fid:101},y=v("SecretBattleManager");y.init(f.id),f.teams=y.rightData.teams,MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:i,rightinfo:f,panelinfo:g,battletype:11})}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),S.t("secret004"))},GetEnemyTeams:function(e){for(var t=DonotDestroyManager.GameData.StageMobs[e.id],a=1,n=[];null!=t[a];){if(0!=b.getEnemyHpPercent(1-a)){var i={};i.id=t[a].mob_id,i.level=e.attrs[t[a].mob_type-1].level,i.position=t[a].position,n.push(i),++a}else
a++}
return n}});cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",NPCFightCfgMgr:"NPCFightCfgMgr",NetEvent:"NetEvent",SecretBattleManager:"SecretBattleManager",SecretBufferMgr:"SecretBufferMgr",SoundUtil:"SoundUtil",StagesConfigMgr:"StagesConfigMgr",i18n:"i18n"}],SecretRewardPanel:[function(e,t,a){"use strict";cc._RF.push(t,"3a841qY0zlOd5OMwMspYwSf","SecretRewardPanel");var n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{pre_item_box:cc.Prefab,node_item_parent:cc.Node},setParams:function(e){this.reward_list=e.reward_list,this.closeCb=e.closeCb},goBack:function(e,t){n.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},start:function(){for(var e=0;e<this.reward_list.length;e++){var t=cc.instantiate(this.pre_item_box);this.node_item_parent.addChild(t);var a=this.reward_list[e];t.getComponent("ItemBox").ChangeItemInfo(a.itemId,a.cnt,!0,null,!0)}}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],SecretWinPanel:[function(e,t,a){"use strict";cc._RF.push(t,"a7403tbskZF1aaeRn3Qres1","SecretWinPanel");e("GameUtils");var n=e("SoundUtil"),i=(e("GuideBufferMgr"),e("MarqueeBufferMgr"));e("MineConstants");cc.Class({extends:cc.Component,properties:{m_pwinpre:cc.Prefab,node_uiAll:cc.Node,_recvdata:null,m_pRewardContent:cc.Node,m_pItemBoxPrefab:cc.Prefab,lab_exp_add:cc.Label,lab_cooper_add:cc.Label,lab_energy_cost:cc.Label,_iscanclick:!1},onLoad:function(){},ChangeData:function(e){this._recvdata=e;for(var t=this._recvdata.reward_items.length-1;0<t;t--){var a=this._recvdata.reward_items[t].itemId;1452==a?(this.lab_exp_add.string="+"+this._recvdata.reward_items[t].cnt,this._recvdata.reward_items.splice(t,1)):1450==a&&(this.lab_cooper_add.string="+"+this._recvdata.reward_items[t].cnt,this._recvdata.reward_items.splice(t,1))}
var n=DonotDestroyManager.GameData.Secret;this.lab_energy_cost.string="-"+n[0].win_strength[0],this.Init()},Init:function(){this.InitData(),this.CreateWinarmature()},InitData:function(){this._iscanclick=!1,this.node_uiAll.active=!1;for(var e=0;e<this._recvdata.reward_items.length;++e){var t=cc.instantiate(this.m_pItemBoxPrefab);t.getComponent("ItemBox").ChangeItemInfo(this._recvdata.reward_items[e].itemId,this._recvdata.reward_items[e].cnt,!0,null,!0),this.m_pRewardContent.addChild(t)}},CreateWinarmature:function(){var t=this,e=cc.instantiate(this.m_pwinpre);this.node.addChild(e),e.setPosition(0,-50);var a=e.getComponent(sp.Skeleton);a.setAnimation(0,"action3",!1),a.setCompleteListener(function(e){t.showResultUi()})},showResultUi:function(){cc.log(" truyền phát tin thưởng cho động họa "),this._iscanclick=!0,this.node_uiAll.active=!0},Mask_OnClickHandler:function(e){this._iscanclick&&(n.playBtnCloseEffect(),MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),i.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome")},setStatistics:function(e,t,a){this.statistics={left:e,right:t,data:a};var n={damage:-1};a.teams.forEach(function(e,t){e.damage>n.damage&&"left"==e.data.hero.side&&(n=e)})},BattleDetail_onClickHandler:function(){var n=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/BattleDetailLayer/BattleDetailLayer",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.node)){null!=n._shortMask_node&&(n._shortMask_node.destroy(),n._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("BattleDetailLayer").ChangeData(n.statistics.data)}})}}),cc._RF.pop()},{GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",MarqueeBufferMgr:"MarqueeBufferMgr",MineConstants:"MineConstants",SoundUtil:"SoundUtil"}],SelectHeroPanel:[function(e,t,a){"use strict";cc._RF.push(t,"2bbd5u0LQdEuZ+71I87WIWT","SelectHeroPanel");var i=e("ResLoaderManager"),n=(e("GameUtils"),e("HeroBufferMgr")),c=e("ActivityBufferMgr"),r=e("SoundUtil"),s=e("GuideBufferMgr"),o=(r=e("SoundUtil"),cc.Class({extends:cc.Component,properties:{m_pFighting:cc.Label,m_pHeroParent:cc.Node,m_pWarpNode:cc.Node,m_btnBack:cc.Node,m_pInformationItem:cc.Node,m_PUnLockViewInfo:cc.Node,_unlockFormation:-1,_infomationitemlist:[],_curSelectCount:-1,_heroExchangeInfos:null,_hlimit:null,_unlockLevels:{default:{},type:Object},_heromodelmap:{default:{},type:Object},_heroformationlist:[],_cb:null,_selfpre:null,_raw_assets:{default:{},type:Object},_battletype:-1,_heroList:[],mScrollView:cc.ScrollView,itemTemplate:cc.Prefab,itemTemplateHeight:110,spawnCount:12,spacing:0,bufferZone:600},statics:{instance:null,getInstance:function(){return o.instance}},onLoad:function(){this.LoadRes(),o.instance=this},ChangeData:function(e){this._cb=e.cb,this._battletype=e.battletype,this.GetHeroIdlist(e.formationmap),this._curSelectCount=0,this._hlimit=DonotDestroyManager.GameData.Common.hero_num_limit,this._heroExchangeInfos=DonotDestroyManager.GameData.Arena.exchange},LoadRes:function(){this.toLoadResList=[],this._raw_assets={};for(var e=0;e<MyPersistDataManager._playerData.cardslist.length;++e){var t=DonotDestroyManager.GameData.Cards[MyPersistDataManager._playerData.cardslist[e].template_id];this.toLoadResList.push(["UI/Heros/"+t.icon,cc.SpriteFrame])}
var a=this._loadProgressCb.bind(this),n=this._loadFinishCb.bind(this);i.asyncLoadAll(this.toLoadResList,a,n)},_loadProgressCb:function(e){},_loadFinishCb:function(e,t){cc.log("load teamskill resources finish!"),t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this),this.Init()},GetHeroIdlist:function(e){if(null!=e)
for(var t=Object.keys(e),a=0;a<t.length;++a)
0<e[t[a]]&&this._heroformationlist.push(e[t[a]]);else
this._heroformationlist=[]},RefreshFight:function(){var e=0;if(0<this._heroformationlist.length)
for(var t=0;t<this._heroformationlist.length;++t){e+=n.getHeroByUid(this._heroformationlist[t]).fight}
this.m_pFighting.string=e},Init:function(){this.GetUnLockLevel(),this._unlockFormation=MyPersistDataManager._playerData.formationSlots,this._unlockFormation<3&&(this._unlockFormation=3),this.SortHeroList(),this.InitWarpContent(),this.CreateInformationItem(),this.CreateHeroModel(),this.RefreshFight(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},CreateHeroModel:function(){for(var e=0;e<this._heroformationlist.length;++e){this.GetInFormation().AddHero(this._heroformationlist[e])}},GetUnLockLevel:function(){for(var e=0;e<this._hlimit.length;++e)
this._unlockLevels[this._hlimit[e][1]]=this._heroExchangeInfos[this._hlimit[e][1]+9997],cc.log("id ===="+(this._hlimit[e][1]+9997))},CreateInformationItem:function(){for(var e=0;e<10;++e){var t=cc.instantiate(this.m_pInformationItem);this.m_pHeroParent.addChild(t),t.active=!0,this._infomationitemlist.push(t);var a=t.getComponent("SelectInFormationItem");e<this._unlockFormation?(a.SetUnLock(),a.ChangeData(e)):(a.ChangeData(e,this._unlockLevels[e+1]),MyPersistDataManager._playerData.level>=this._unlockLevels[e+1][4]&&e==this._unlockFormation?a.SetCanUnLock():a.SetUnLock(!1))}},SetInformationUnLock:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];e>=this._infomationitemlist.length||this._infomationitemlist[e].getComponent("SelectInFormationItem").SetUnLock(t)},InitWarpContent:function(){this._heroList=MyPersistDataManager._playerData.cardslist.concat();for(var e=this._heroList.length-1;0<=e;e--){var t=DonotDestroyManager.GameData.Cards[this._heroList[e].template_id];if(5==this._battletype){var a=c.judgeHeroGroup();t.group!=a&&5!=a&&this._heroList.splice(e,1)}}
var n=this._heroList.length%2==0?this._heroList.length/2:parseInt(this._heroList.length/2+1);if(this.content=this.mScrollView.content,this.content.height=n*(this.itemTemplateHeight+this.spacing)+this.spacing,0==this.content.children.length){this._spawnItems=[],this.updateTimer=0,this.updateInterval=.2;for(var i=this.lastContentPosY=0;i<this.spawnCount;++i){var r=cc.instantiate(this.itemTemplate);this.content.addChild(r),r.setPosition(0,-r.height*(.5+i)-this.spacing*(i+1)),r.getComponent("SelectHeroWrapInfo").updateItem(i),this._spawnItems.push(r)}}else
for(var s=this.updateTimer=0;s<this.spawnCount;++s){var o=this._spawnItems[s];o.setPosition(0,-o.height*(.5+s)-this.spacing*(s+1)),o.getComponent("SelectHeroWrapInfo").updateItem(s)}},SortHeroList:function(){MyPersistDataManager._playerData.cardslist.sort(function(e,t){return DonotDestroyManager.GameData.Cards[t.template_id].quality!=DonotDestroyManager.GameData.Cards[e.template_id].quality?DonotDestroyManager.GameData.Cards[t.template_id].quality-DonotDestroyManager.GameData.Cards[e.template_id].quality:e.fight!=t.fight?t.fight-e.fight:t.level-e.level})},HeroClickHandler:function(e,t){if(cc.log(t.custom.template_id+"for warp info"),r.playBtnOpenEffect(),!(t.self._isSelect&&this._heroformationlist.length<=1))
if(this._heroformationlist.length>=this._unlockFormation&&!t.self._isSelect)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Số Tướng ra trận đã max");else{if(t.self.SetSelect(),t.self._isSelect){this._heroformationlist.push(t.custom.template_id),this.GetInFormation().AddHero(t.custom.template_id);var a=DonotDestroyManager.GameData.Cards[t.custom.template_id];if(3<=a.quality){var n=a.sound?a.sound:a.icon;r.playHeroSound(n)}}else{this.DesInFormationId(t.custom.template_id),this.GetInFormation(t.custom.template_id).DesHero()}
this.RefreshFight(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))}},DesInFormationId:function(e){for(var t=0;t<this._heroformationlist.length;++t)
this._heroformationlist[t]==e&&this._heroformationlist.splice(t,1)},GetInFormation:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,t=0;t<this._infomationitemlist.length;++t){var a=this._infomationitemlist[t].getComponent("SelectInFormationItem");if(-1==e){if(a._isunlock&&-1==a._heroid)
return a}else if(a._heroid==e)
return a}
return null},Back_OnClickHandler:function(e){r.playBtnCloseEffect(),null!=this._cb&&this._cb(this._heroformationlist),this.node.removeFromParent(),this.node.destroy()},onDestroy:function(){(o.instance=null)!=this._raw_assets&&(this._raw_assets={})},showGuide:function(){var t=this;s.showGuide("HeroOnLineLayer",function(e){switch(e){case 1:return t.m_pWarpNode.children[0].children[0];case 2:return t.m_pWarpNode.children[0].children[1];case 3:return t.m_pWarpNode.children[0].children[2];case 4:return t.m_pWarpNode.children[0].children[3];case 6:return t.m_btnBack;case 7:return t.m_pWarpNode.children[0].children[1]}})},getPositionInView:function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.mScrollView.node.convertToNodeSpaceAR(t)},update:function(e){if(this.updateTimer+=e,!(this.updateTimer<this.updateInterval)){this.updateTimer=0;var t=this._spawnItems;if(null!=t){for(var a=this.bufferZone,n=this.mScrollView.content.y<this.lastContentPosY,i=(this.itemTemplateHeight+this.spacing)*t.length,r=0;r<t.length;++r){var s=this.getPositionInView(t[r]);if(n){if(s.y<-a&&t[r].y+i<0){t[r].setPositionY(t[r].y+i);var o=t[r].getComponent("SelectHeroWrapInfo"),c=o._itemID-t.length;o.updateItem(c)}}else if(s.y>a&&t[r].y-i>-this.content.height){t[r].setPositionY(t[r].y-i);var l=t[r].getComponent("SelectHeroWrapInfo"),h=l._itemID+t.length;l.updateItem(h)}}
this.lastContentPosY=this.mScrollView.content.y}}}}));cc._RF.pop()},{ActivityBufferMgr:"ActivityBufferMgr",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",HeroBufferMgr:"HeroBufferMgr",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil"}],SelectHeroWrapInfo:[function(e,t,a){"use strict";cc._RF.push(t,"b1462W69gdH/7MQfytqo9w5","SelectHeroWrapInfo");var r=e("SelectHeroPanel");cc.Class({extends:cc.Component,properties:{m_pArmyHeroItem:cc.Prefab,_armyitemlist:[],_itemID:0},onLoad:function(){},updateItem:function(e){this._itemID=e,this.Init()},Init:function(){for(var e=-1,t=0;t<2;++t)
if(e=2*this._itemID+t,t<this._armyitemlist.length)
if(e<r.getInstance()._heroList.length){this._armyitemlist[t].active=!0;var a=r.getInstance().HeroClickHandler.bind(r.getInstance()),n=this._armyitemlist[t].getComponent("ArmyItem");3==r.getInstance()._battletype?n.ChangeFTData(r.getInstance()._heroList[e],e,a,!1,!1,r.getInstance()._raw_assets):10==r.getInstance()._battletype?n.ChangeMineDefenceData(r.getInstance()._heroList[e],e,a,!1,!1,r.getInstance()._raw_assets):n.ChangeData(r.getInstance()._heroList[e],e,a,!1,!1,r.getInstance()._raw_assets),this._armyitemlist[t].setPosition(410*t-205,0),this.CheckIsSelect(n._cardinfo.template_id)&&n.SetSelect()}else
this._armyitemlist[t].active=!1;else
e<r.getInstance()._heroList.length&&this.CreateArmyItem(t,r.getInstance()._heroList[e])},CreateArmyItem:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=cc.instantiate(this.m_pArmyHeroItem),i=n.getComponent("ArmyItem");a=r.getInstance().HeroClickHandler.bind(r.getInstance());3==r.getInstance()._battletype?i.ChangeFTData(t,2*this._itemID+e,a,!1,!1,r.getInstance()._raw_assets):10==r.getInstance()._battletype?i.ChangeMineDefenceData(t,2*this._itemID+e,a,!1,!1,r.getInstance()._raw_assets):i.ChangeData(t,2*this._itemID+e,a,!1,!1,r.getInstance()._raw_assets),this.node.addChild(n),n.setPosition(410*e-205,0),this._armyitemlist.push(n),this.CheckIsSelect(i._cardinfo.template_id)&&i.SetSelect()},CheckIsSelect:function(e){for(var t=!1,a=0;a<r.getInstance()._heroformationlist.length;++a)
r.getInstance()._heroformationlist[a]==e&&(t=!0);return t},onDestroy:function(){}}),cc._RF.pop()},{SelectHeroPanel:"SelectHeroPanel"}],SelectInFormationItem:[function(e,t,a){"use strict";cc._RF.push(t,"94a89ohI1BHFKI+kRJ25keD","SelectInFormationItem");var i=e("SelectHeroPanel"),n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pUnLockSpr:cc.Sprite,m_pBottombgSpr:cc.Sprite,m_pUnLockLevel:cc.Label,m_pUnLockContent:cc.Node,node_level_tip:[cc.Node],m_pHeroModelParent:cc.Node,m_plockSprFrame:[cc.SpriteFrame],m_pTZSprFrame:[cc.SpriteFrame],_index:-1,_isunlock:!1,_isCanUnLock:!1,_heroid:-1,_exchange:null,_herojsoninfo:null,_heropre:null,_heroitem:null},onLoad:function(){},ChangeData:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1;this._index=e,this._exchange=t,this._heroid=a,this.Init()},Init:function(){if(null!=this._exchange&&(this.m_pUnLockLevel.string=this._exchange[4]+" mở",MyPersistDataManager._playerData.level>=this._exchange[4]))
for(var e=0;e<this.node_level_tip.length;e++){this.node_level_tip[e].active=!1}},AddHero:function(e){this._heroid=e,this._herojsoninfo=DonotDestroyManager.GameData.Cards[this._heroid],this.CreateHeroModel()},DesHero:function(){this._heroid=-1,this._herojsoninfo=null,this.DestroyHeroModel()},CreateHeroModel:function(){var a=this;cc.loader.loadRes("Prefab/Heros/"+this._herojsoninfo.icon,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load heroprefab success!"),a._heropre=t,a._heroitem=cc.instantiate(t),a.m_pHeroModelParent.addChild(a._heroitem),null!=a._herojsoninfo.is_spine&&a._herojsoninfo.is_spine||a._heroitem.setScale(-1,1),a._heroitem.getComponent(sp.Skeleton).setAnimation(0,"stand",!0)})},DestroyHeroModel:function(){null!=this._heropre&&(this._heropre=null),null!=this._heroitem&&(this._heroitem.removeFromParent(),this._heroitem.destroy(),this._heroitem=null)},SetUnLock:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.m_pUnLockContent.active=!e;var t=(this._isunlock=e)?1:0;this.m_pUnLockSpr.spriteFrame=this.m_plockSprFrame[t],this.m_pBottombgSpr.spriteFrame=this.m_pTZSprFrame[t]},SetCanUnLock:function(){this.m_pUnLockContent.active=!0,this._isunlock=!1,this._isCanUnLock=!0,this.m_pUnLockSpr.spriteFrame=this.m_plockSprFrame[1],this.m_pBottombgSpr.spriteFrame=this.m_pTZSprFrame[0],this.StackView()},StackView:function(){var e=cc.sequence(cc.rotateBy(.05,10),cc.rotateBy(.05,-10),cc.rotateBy(.05,-10),cc.rotateBy(.05,10),cc.delayTime(1));this.m_pUnLockSpr.node.runAction(cc.repeatForever(e))},GetHeroItem:function(){for(var e=i.getInstance().m_pWarpNode,t=0;t<e.children.length;++t)
for(var a=e.children[t].getComponent("SelectHeroWrapInfo"),n=0;n<a._armyitemlist.length;++n)
if(a._armyitemlist[n].getComponent("ArmyItem")._cardinfo.template_id==this._heroid)
return a._armyitemlist[n];return null},OnClickHandler:function(e){if(cc.log("Nhấn "+this._heroid),n.playBtnOpenEffect(),this._isCanUnLock&&(i.getInstance().m_PUnLockViewInfo.active=!0,i.getInstance().m_PUnLockViewInfo.getComponent("UnLockViewInfo").ChangeData(this._exchange)),this._isunlock)
if(-1!=this._heroid){var t=this.GetHeroItem();null!=t&&t.getComponent("ArmyItem").SetSelect(),i.getInstance().DesInFormationId(this._heroid),this.DesHero(),n.playBtnCloseEffect(),i.getInstance().RefreshFight()}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin chọn Tướng ra trận!")},onDestroy:function(){null!=this._heropre&&(this._heropre=null)}}),cc._RF.pop()},{SelectHeroPanel:"SelectHeroPanel",SoundUtil:"SoundUtil"}],SelectMissionLayer:[function(e,t,a){"use strict";cc._RF.push(t,"cee95WgUN5Cw7OI4iUbqyCo","SelectMissionLayer");var h=e("SoundUtil"),d=e("i18n"),_=e("MyProtocols"),n=e("NetEvent"),i=e("MyEventDispatcher"),u=e("ActivityBufferMgr"),r=e("BattleBufferMgr"),m=e("ActivityBattleManager"),s=e("GuideBufferMgr"),o=cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pMissionDes:cc.RichText,m_pRewardContent:cc.Node,m_pDiffContent:cc.Node,m_pTimes:cc.Label,m_pDifficultPrefab:cc.Prefab,m_pItemBoxPrefab:cc.Prefab,m_pScrollView:cc.ScrollView,m_pTipPrefab:cc.Prefab,mBtnFight:cc.Node,btn_sweep:[cc.Node],m_pRewardPanel:cc.Prefab,_battleState:0,_stateIndex:0,_selectedIndex:0,_unlockIndex:0,_green:"",_red:"",_end:"",_diffScript:[],_itemScript:[]},statics:{instance:null,getInstance:function(){return o.instance}},onLoad:function(){(o.instance=this)._green="<color=#8cea00>",this._red="<color=#ff8000>",this._end="</c>",this.ActivitiesView_auth_cb_func=this.ActivitiesView_auth_cb.bind(this),i.addListener(n.S2CActivitiesView,this.ActivitiesView_auth_cb_func),this.ActivitiesBattleFormation_auth_cb_func=this.ActivitiesBattleFormation_auth_cb.bind(this),i.addListener(n.S2CActivitiesBattleFormation,this.ActivitiesBattleFormation_auth_cb_func),this.ActivitiesBattleBuyTicket_auth_cb_func=this.ActivitiesBattleBuyTicket_auth_cb.bind(this),i.addListener(n.S2CActivitiesBattleBuyTicket,this.ActivitiesBattleBuyTicket_auth_cb_func),this.ActivitiesClaimAward_auth_cb_func=this.ActivitiesClaimAward_auth_cb.bind(this),i.addListener(n.S2CActivitiesClaimAward,this.ActivitiesClaimAward_auth_cb_func),this.PushPropertyChange_auth_cb_func=this.PushPropertyChange_auth_cb.bind(this),i.addListener(n.PushPropertyChange,this.PushPropertyChange_auth_cb_func),this.S2CActivitiesBattleSweep_cb_func=this.S2CActivitiesBattleSweep_cb.bind(this),i.addListener(n.S2CActivitiesBattleSweep,this.S2CActivitiesBattleSweep_cb_func)},onDestroy:function(){i.removeListener(n.S2CActivitiesView,this.ActivitiesView_auth_cb_func),i.removeListener(n.S2CActivitiesBattleFormation,this.ActivitiesBattleFormation_auth_cb_func),i.removeListener(n.S2CActivitiesBattleBuyTicket,this.ActivitiesBattleBuyTicket_auth_cb_func),i.removeListener(n.S2CActivitiesClaimAward,this.ActivitiesClaimAward_auth_cb_func),i.removeListener(n.PushPropertyChange,this.PushPropertyChange_auth_cb_func),i.removeListener(n.S2CActivitiesBattleSweep,this.S2CActivitiesBattleSweep_cb_func),o.instance=null},S2CActivitiesBattleSweep_cb:function(e){if((1==e.module_id?MyPersistDataManager._playerData.activityView1:MyPersistDataManager._playerData.activityView2).attack_count=e.attack_count,null!=e.gain&&0<e.gain.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.gain}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,230),"Quét thành công!");var a=null;0==this._battleState?a=MyPersistDataManager._playerData.activityView1:1==this._battleState&&(a=MyPersistDataManager._playerData.activityView2),this.ReadInfo(a),this.updateSweepBtn()},PushPropertyChange_auth_cb:function(e){3==e.type&&u.missionUnlock(this._battleState,this._stateIndex,this._selectedIndex,e.value)},ActivitiesClaimAward_auth_cb:function(e){var t=u.getRetObj(this._battleState),a=u.JudgeType(t.info,e.activity_type);null!=a&&(a.boxAwardCanGet[e.level_index]=!1)},ActivitiesBattleBuyTicket_auth_cb:function(e){var t=u.getRetObj(this._battleState);t.buy_count=e.buyTimes,t.attack_count=0,this.ReadInfo(t),h.playGainGoodsEffectNew(),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),d.t("week_013")),this.updateSweepBtn()},ActivitiesBattleFormation_auth_cb:function(e){switch(this._stateIndex){case 0:MyPersistDataManager._playerData.epicformation0=e.formation;break;case 1:MyPersistDataManager._playerData.epicformation1=e.formation;break;case 2:MyPersistDataManager._playerData.epicformation2=e.formation;break;case 3:MyPersistDataManager._playerData.epicformation3=e.formation;break;case 4:MyPersistDataManager._playerData.epicformation4=e.formation;break;case 5:MyPersistDataManager._playerData.epicformation5=e.formation}
null!=e.formation&&r.setFormationData(e.formation.fid,e.formation)},ActivitiesView_auth_cb:function(e){0==this._battleState?MyPersistDataManager._playerData.activityView1=e:1==this._battleState&&(MyPersistDataManager._playerData.activityView2=e),this.ReadInfo(e),this.SetDiffs(e)},setParams:function(e){switch(this._battleState=e.state,this._stateIndex=e.index,0==this._battleState?null==MyPersistDataManager._playerData.activityView1?_.send_C2SActivitiesView(DonotDestroyManager._gameSocket,this._battleState+1):(this.ReadInfo(MyPersistDataManager._playerData.activityView1),this.SetDiffs(MyPersistDataManager._playerData.activityView1)):1==this._battleState&&(null==MyPersistDataManager._playerData.activityView2?_.send_C2SActivitiesView(DonotDestroyManager._gameSocket,this._battleState+1):(this.ReadInfo(MyPersistDataManager._playerData.activityView2),this.SetDiffs(MyPersistDataManager._playerData.activityView2))),this._stateIndex){case 0:null==MyPersistDataManager._playerData.epicformation0&&_.send_C2SActivitiesBattleFormation(DonotDestroyManager._gameSocket,3+this._stateIndex);break;case 1:null==MyPersistDataManager._playerData.epicformation1&&_.send_C2SActivitiesBattleFormation(DonotDestroyManager._gameSocket,3+this._stateIndex);break;case 2:null==MyPersistDataManager._playerData.epicformation2&&_.send_C2SActivitiesBattleFormation(DonotDestroyManager._gameSocket,3+this._stateIndex);break;case 3:null==MyPersistDataManager._playerData.epicformation3&&_.send_C2SActivitiesBattleFormation(DonotDestroyManager._gameSocket,3+this._stateIndex);break;case 4:null==MyPersistDataManager._playerData.epicformation4&&_.send_C2SActivitiesBattleFormation(DonotDestroyManager._gameSocket,3+this._stateIndex);break;case 5:null==MyPersistDataManager._playerData.epicformation5&&_.send_C2SActivitiesBattleFormation(DonotDestroyManager._gameSocket,3+this._stateIndex)}
this.ChangeData(),this.ScaleToLarge()},ReadInfo:function(e){var t=u.getActivityTimes(this._battleState,this._stateIndex),a=u.getBuyTimes(this._battleState);0<t?(this.m_pTimes.node.color=new cc.Color(6,252,0),this.m_pTimes.string=d.t("week_008",{value:t})):0<a.buyTimes?(this.m_pTimes.node.color=new cc.Color(6,252,0),this.m_pTimes.string=d.t("week_014",{value:a.buyTimes})):(this.m_pTimes.node.color=new cc.Color(255,0,0),this.m_pTimes.string=d.t("week_008",{value:t}))},SetDiffs:function(e){var t=this.GetInfo(e.info);this._selectedIndex=this.CheckSelect(),this._unlockIndex=this._selectedIndex;for(var a=0;a<5;++a){var n=cc.instantiate(this.m_pDifficultPrefab);this.m_pDiffContent.addChild(n);var i=n.getComponent("MissionDifficult");i._diffState=a;var r=!0;0==e.info.length&&0<a?r=!1:0!=e.info.length&&this._selectedIndex<0&&(this._selectedIndex=5);var s=0,o=!1;0!=e.info.length&&-1!=t&&(s=e.info[t].star[a],o=e.info[t].boxAwardCanGet[a]),i.ChangeData(r,s,o),this._diffScript.push(i)}
this._diffScript[this._selectedIndex].m_pItemSprite.spriteFrame=this._diffScript[this._selectedIndex].m_pSelectFrame[this._selectedIndex],this.ChangeRewardInfo(this._selectedIndex),this.updateSweepBtn(),this._selectedIndex==DonotDestroyManager.GameData.Activities.battles[this._battleState][this._stateIndex].diffs.length-1&&this.m_pScrollView.scrollToRight()},GetInfo:function(e){for(var t=0;t<e.length;++t)
if(e[t].activity_type==this._stateIndex+1)
return t;return-1},CheckSelect:function(){for(var e=DonotDestroyManager.GameData.Activities.battles[this._battleState][this._stateIndex].diffs,t=MyPersistDataManager._playerData.level,a=0;a<e.length;++a)
if(t<e[a].level_limit)
return a-1;return e.length-1},ClearDiffs:function(){for(var e=0;e<this._unlockIndex+1;++e)
this._diffScript[e].m_pItemSprite.spriteFrame=this._diffScript[e].m_pNormalFrame[e]},ChangeData:function(){var e=DonotDestroyManager.GameData.Activities.battles[this._battleState][this._stateIndex];this.m_pMissionDes.string="";for(var t=0;t<e.des.length;++t)
if("green"==e.des[t]){var a=t+1;this.m_pMissionDes.string+=this._green}else if("red"==e.des[t]){a=t+1;this.m_pMissionDes.string+=this._red}else
this.m_pMissionDes.string+=e.des[t],a==t&&(this.m_pMissionDes.string+=this._end)},ChangeRewardInfo:function(e){if(this._selectedIndex=e,0==this._battleState){var t=DonotDestroyManager.GameData.Activities.battles[this._battleState][this._stateIndex].diffs[e].rewards.drops[0][0],a=DonotDestroyManager.GameData.Activities.battles[this._battleState][this._stateIndex].droplists[t-1];if(0==this._itemScript.length)
for(var n=0;n<a.length;++n){(o=(s=cc.instantiate(this.m_pItemBoxPrefab)).getComponent("ItemBox")).ChangeItemInfo(a[n][0],0,!1,null,!0),this.m_pRewardContent.addChild(s),this._itemScript.push(o)}
else
for(n=0;n<a.length;++n)
this._itemScript[n].ChangeItemInfo(a[n][0],0,!1,null,!0)}else if(1==this._battleState){a=DonotDestroyManager.GameData.Activities.battles[this._battleState][this._stateIndex].diffs[e].rewards.drops;var i=[];for(n=0;n<a.length;++n){var r=DonotDestroyManager.GameData.Activities.battles[this._battleState][this._stateIndex].droplists[a[n][0]];null!=r&&(this.JudgeHave(i,r[0][0])||i.push(r[0][0]))}
if(i.sort(function(e,t){return e-t}),this._itemScript.length<i.length)
for(e=this._itemScript.length,n=0;n<i.length-e;++n){var s,o=(s=cc.instantiate(this.m_pItemBoxPrefab)).getComponent("ItemBox");this.m_pRewardContent.addChild(s),this._itemScript.push(o)}
else
for(n=this._itemScript.length-1;n>=i.length;n--)
this._itemScript[n].node.removeFromParent(),this._itemScript[n].node.destroy(),this._itemScript.splice(n,1);for(n=0;n<this._itemScript.length;++n)
this._itemScript[n].ChangeItemInfo(i[n],0,!1,null,!0)}},updateSweepBtn:function(){var e=0,t=null;0==this._battleState?t=MyPersistDataManager._playerData.activityView1:1==this._battleState&&(t=MyPersistDataManager._playerData.activityView2);var a=this.GetInfo(t.info);0!=t.info.length&&-1!=a&&(e=t.info[a].star[this._selectedIndex]);var n=u.getActivityTimes(this._battleState,this._stateIndex);if(3==e&&0<n)
for(var i=0;i<this.btn_sweep.length;i++){this.btn_sweep[i].active=!0}
else
for(var r=0;r<this.btn_sweep.length;r++){this.btn_sweep[r].active=!1}},JudgeHave:function(e,t){for(var a=0;a<e.length;++a)
if(e[a]==t)
return!0;return!1},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Back_onClickHandler:function(){h.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},OpenFormationLayer:function(){h.playBtnOpenEffect();var e=this;if(0<u.getActivityTimes(this._battleState,this._stateIndex)){var t=DonotDestroyManager.GameData.Activities.battles[this._battleState][this._stateIndex],a={name:t.name+"LV."+t.diffs[this._selectedIndex].level,fight:0,formation:t.diffs[this._selectedIndex].mobs.formation,flip:t.diffs[this._selectedIndex].mobs.flip,forward:t.diffs[this._selectedIndex].mobs.forward,Teams:this.GetEnemyTeams(),id:1},n=3+this._stateIndex;1==this._battleState&&(n=1);var i={fid:n};m.init(),a.teams=m.rightData.teams,MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:a,panelinfo:i,battletype:5})}else{var r=u.getBuyTimes(this._battleState);if(0==this._battleState)
var s=d.t("week_009");else
s=d.t("week_010");if(0<r.buyTimes){var o=cc.instantiate(this.m_pTipPrefab),c=o.getComponent("AlertLayerManager"),l=d.t("week_011",{value1:r.buyTimes,value2:s,value3:r.cost});c.initContent(l,function(){o.removeFromParent(),o.destroy(),MyPersistDataManager._playerData.money<r.cost?(e._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(e._alert_layer),e._alert_layer.getComponent("AlertLayerManager").initContent("Không đủ Vàng, bấm đến giao diện nạp",function(){e._alert_layer.removeFromParent(),e._alert_layer.destroy(),e._alert_layer=null,MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1})})):_.send_C2SActivitiesBattleBuyTicket(DonotDestroyManager._gameSocket,e._battleState+1)}),cc.Canvas.instance.node.addChild(o)}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),d.t("week_012"))}},GetEnemyTeams:function(){var e=DonotDestroyManager.GameData.Activities.battles[this._battleState][this._stateIndex].diffs[this._selectedIndex];u.changeData(this._battleState,this._stateIndex,this._selectedIndex,this._diffScript),m.changeData(this._battleState,this._stateIndex,this._selectedIndex);for(var t=[],a=1;a<=8;++a)
if(null!=e.mobs[a]){var n=e.mobs[a].mob_type-1,i=e.attrs[n].level;t.push({id:e.mobs[a].mob_id,level:i,position:e.mobs[a].position})}
return t},clickHanlder_sweep:function(e,t){h.playBtnOpenEffect(),_.send_C2SActivitiesBattleSweep(DonotDestroyManager._gameSocket,this._battleState+1,this._stateIndex+1,this._selectedIndex)},SwichPage_onClickHandler:function(e,t){h.playPageEffect();var a=parseInt(t);this.m_pScrollView.scrollToPercentHorizontal(a,.5,!0)},start:function(){this.showGuide()},showGuide:function(e){function t(){return e.apply(this,arguments)}
return t.toString=function(){return e.toString()},t}
(function(){var t=this,a=null;s.showGuide("SelectMissionsLayer",function(e){if(1==e)
return a=e,t.mBtnFight},function(){null==a&&showGuide()})})});cc._RF.pop()},{ActivityBattleManager:"ActivityBattleManager",ActivityBufferMgr:"ActivityBufferMgr",BattleBufferMgr:"BattleBufferMgr",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],SelectRoleInfo:[function(e,t,a){"use strict";cc._RF.push(t,"aa292b7Aq1DI4DTGaKCwrYH","SelectRoleInfo");var i=["Hà nam", "Hà bắc", "Bắc bình", "Thiên tân", "Sơn đông", "Sơn tây", "Cát lâm", "Liêu trữ", "Chiết giang", "Giang tô", "Thượng hải", "An huy", "Giang tây", "Hồ nam", "Hồ bắc", "Tân cương", "Vân nam", "Quý châu", "Phúc kiến", "Thai loan", "Trữ hạ", "Tứ xuyên", "Trọng khánh", "Nội mông", "Hải nam", "Thanh hải", "Cam túc", "Hồ bắc", "Tân cương", "Thiểm tây", "Nghiễm đông", "Nghiễm tây", "Hương cảng", "Úc môn", "Đông bắc", "Tây nam", "Tây bắc", "Nam phương", "Bắc phương", "Đại mạc", "Đảo quốc", "Thành dương", "Kinh châu", "Bột hải", "Nam dương", "Thuật dương", "Huỳnh dương", "Triệu quận", "Lâm xuyên", "Lâm du", "U châu", "Tín đô", "Tể âm", "Tể nam", "Quế dương", "Thường sơn", "Hạ khẩu", "Sài tang", "Tiêu diêu", "Từ châu", "Giao đông", "Cao dương", "Ích châu", "Châu quận", "Lương châu", "Lang tà", "Tử đồng", "Tà cốc", "Thanh hà", "Trác quận", "Hoài dương", "Hoài nam", "Ngư dương", "Phù lăng", "Lương quốc", "Bác lăng", "Bác vọng", "Gia ấm", "Nhai đình", "Dĩnh xuyên", "Lỗ quận", "Đôn hoàng", "Linh lăng", "Thục quận", "Ung châu", "Bà dương", "Tiếu quận", "Dự chương", "Kí châu", "Tương dương", "Cửu giang", "Hạ bi", "Thượng quận", "Thượng đảng", "Thượng dong", "Sơn dương", "Nghiễm lăng", "Tiểu phái", "Thiên thủy", "Thái nguyên", "Trung sơn", "Trường sa", "Ô lâm", "Ba đông", "Ba quận", "Bình nguyên", "Đông bình", "Đông quận", "Đông hoàn", "Đông hải", "Bắc địa", "Đại quận", "Bạch mã", "Bạch đế", "Hán trung", "Vĩnh xương", "Hoằng nông", "Liêu đông", "Liêu tây", "Tây hà", "Dương châu", "Di lăng", "Hoa dung", "Duyên tân", "Hợp phổ", "Hội kê", "Giao châu", "Tề quận", "Tịnh châu", "Giang hạ", "Giang châu", "Nhữ nam", "An định", "Kì sơn", "Dương quan", "Dương bình", "Âm bình", "Mạch thành", "Thương ngô", "Xích bích", "Nghiệp thành", "Đông ngô", "Lư giang", "Lư lăng", "Phái quốc", "Vấn sơn", "Lũng tây", "Trần thương", "Trần quốc", "Trần lưu", "Chiêu lăng", "Thanh châu", "Thanh khê", "Vũ hương", "Vũ xương", "Vũ uy", "Vũ đô", "Vũ lăng", "Úc lâm", "Xương ấp", "Xương lê", "Kim thành", "Kinh thành", "Duyện châu", "Hà nội", "Hà đông", "Hà gian", "Hà nam", "Lô thủy", "Quan độ", "Phòng lăng", "Kiến nghiệp", "Kiến trữ", "Kiến an", "Thủy hưng", "Thủy an", "Đào thành", "Hoài an", "Thuận bình", "Lộc tuyền", "Thấm thủy", "Phủ viễn", "Thang nguyên", "Giang nguyên", "Lâm khẩu", "Liên thủy", "Đồng hương", "Đan đồ", "Đan dương", "Thuần an", "Kim hồ", "Ôn châu", "Lan khê", "Thượng ngu", "Long thành", "Khai hóa", "Tân xương", "Tiềm sơn", "Lai an", "Định viễn", "Tương sơn", "Liên giang", "Thái hòa", "Vô vi", "Hàm sơn", "Tư minh", "Hạnh lâm", "Tùng khê", "Duyên bình", "Kiến trữ", "Lũng nam", "Kim khê", "Bình ấp", "Lan sơn", "Thượng nhiêu", "Lê xuyên", "Sùng nhân", "Hoành xuyên", "Toại bình", "Thái sơn", "Hoa sơn", "Hành sơn", "Hằng sơn", "Tung sơn", "Hoàng sơn", "Nga mi", "Không động", "Thiểu lâm", "Linh ẩn", "Hổ bào", "Nhạn đãng", "Nam khê", "Vũ đương", "Phổ đà", "Long hoa", "Thiên sơn", "Xà sơn", "Hoàng bộ", "Dương phổ", "Ca đại", "Phục đán", "Định tây", "Tây hồ", "Nhiệt hà", "Vân nham", "Hoa khê", "Bình dương", "Đông dương"],r=[" cô độc "," cuồng ngạo "," ngạo kiều "," tự tin "," nhiệt huyết "," cẩn thận "," hoang đường "," sơ ý "," trượng nghĩa "," hào phóng "," thiện lương "," cố chấp "," phụ lòng "," trung thành "," kiên cường "," chính nghĩa "," nhu nhược "," ngu xuẩn "," cường tráng "," gầy yếu "," nội hướng "," ánh mặt trời "," đáng yêu "," cơ trí "," bình thường "," sang sảng "," mập mạp "," lớn tuổi "," tuổi trẻ "," ngại ngùng "," lắm miệng "," yêu cười "," cao lớn "," thấp bé "," gầy gò "," chất phác "," không biết "," tiêu sái "," không kềm chế được "," kiên nghị "," lần thứ hai nguyên "," vô vị "," lạnh như băng "," nhiệt huyết "," già cả "," tươi mới "," hắc mặt "," hồng mặt "," bạch diện "," ngăm đen "," băng tuyết "," nhân nghĩa ",""],s=[" đạo sĩ "," hòa thượng "," võ sĩ "," thư sinh "," tú tài "," mỹ nhân "," tráng sĩ "," quyền sư "," kiếm sĩ "," kỵ sĩ "," chủ "," đứa ở "," xạ thủ "," trại chủ "," tiểu phiến "," ngục tốt "," nha dịch "," làm việc cực nhọc "," quý tộc "," công tử "," công chúa "," pháp sư "," tát mãn "," đạo tặc "," hiệp khách "," kiếm khách "," lãng tử "," du hiệp "," đao khách "," trưởng lão "," trụ trì "," phán quan "," lấy nhân "," vũ nữ "," ca sĩ nữ "];t.exports=function(){var e=Math.random()*r.length,t=Math.random()*i.length,a=Math.random()*s.length,n=r[parseInt(e)]+i[parseInt(t)]+s[parseInt(a)];return cc.log(n),n},cc._RF.pop()},{}],ServerItemNode:[function(e,t,a){"use strict";cc._RF.push(t,"c715cvw/VBON41WEN7kDYXx","ServerItemNode"),cc.Class({extends:cc.Component,properties:{m_pServername:cc.Label,m_pLevel:cc.Label,m_pBtnSpr:cc.Button,m_pHeroiconNode:cc.Node,_serverInfo:null,m_pcondition:cc.Sprite,m_pcondition_labSpr:cc.Sprite,m_pconditionList:[cc.SpriteFrame],m_pcondition_labSprList:[cc.SpriteFrame]},onLoad:function(){},SetInfo:function(e){this._serverInfo=e,this.Init()},Init:function(){this.m_pServername.string=this._serverInfo.server_name+"("+this._serverInfo.server_id.toString()+" khu )",this.m_pcondition.spriteFrame=this.m_pconditionList[this._serverInfo.server_status],this.m_pcondition_labSpr.spriteFrame=this.m_pcondition_labSprList[this._serverInfo.server_status]}}),cc._RF.pop()},{}],ServerListItem:[function(e,t,a){"use strict";cc._RF.push(t,"ff604FtGbFJRb/eKC5r3+iv","ServerListItem"),cc.Class({extends:cc.Component,properties:{m_pServerListLabel:cc.Label,m_pBtnSpr:cc.Button},onLoad:function(){},SetInfo:function(e){this.m_pServerListLabel.string=e}}),cc._RF.pop()},{}],ServerListPanel:[function(n,e,t){"use strict";cc._RF.push(e,"060d47ZecJEdIRgesdvJ8wy","ServerListPanel");var s=n("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pBack:cc.Node,m_pServerListNode:cc.Node,m_pServerItem:cc.Node,m_pServerlistparent:cc.Node,m_pLastloginparent:cc.Node,m_pRecommendServerParent:cc.Node,m_pServeritemparent:cc.Node,m_pAllServeritemNode:cc.Node,m_pDefaultShowServerNode:cc.Node,m_pTuijianBtn:cc.Button,m_pSpr_Btn1:cc.SpriteFrame,m_pSpr_Btn2:cc.SpriteFrame,m_pSpr_Btn7:cc.SpriteFrame,m_pSpr_Btn7_touch:cc.SpriteFrame,_serverList:[],_serveritemlist:[],_leftserveritemlist:[],_lastSelectserverlistnode:null},onLoad:function(){},setParams:function(e){cc.log(" thiết trí phục vụ khí liệt biểu tham số "),this._serverList=e,this.Init()},GetServerInfo:function(e){for(var t=null,a=0;a<this._serverList.length;++a)
this._serverList[a].server_id==e&&(t=this._serverList[a]);return t},Init:function(){this.ShowLastOrTuijianServer(),this.ShowLeftServerList()},ShowLastOrTuijianServer:function(){this.m_pTuijianBtn.normalSprite=this.m_pSpr_Btn2;var e=cc.sys.localStorage.getItem("lastloginserver");null!=e&&(null!=(t=this.GetServerInfo(parseInt(e)))&&this.CreateServerItem(t,this.m_pLastloginparent,cc.v2(0,0)));var a=-1,n=-1;if(this._serverList.forEach(function(e,t){e.server_id>a&&(n=a,a=e.server_id)}),-1!=a){var t=this.GetServerInfo(a);this.CreateServerItem(t,this.m_pRecommendServerParent,cc.v2(0,0))}
if(-1!=n){t=this.GetServerInfo(n);this.CreateServerItem(t,this.m_pRecommendServerParent,cc.v2(310,0))}},CreateServerItem:function(e,t,a){var n=cc.instantiate(this.m_pServerItem);n.active=!0;var i=n.getComponent("ServerItemNode");i.SetInfo(e);var r=new cc.Component.EventHandler;r.target=this.node,r.component="ServerListPanel",r.handler="Serveritem_ClickHandler",r.customEventData=e,i.m_pBtnSpr.clickEvents[0]=r,t.addChild(n),n.setPosition(a),this._serveritemlist.push(n)},ShowLeftServerList:function(){var e=parseInt(this._serverList.length/10);this._serverList.length%10!=0&&(e+=1);for(var t=e-1;0<=t;--t){var a=(1+10*t).toString()+"-"+(10*(t+1)).toString();t==e-1&&(a=(1+10*t).toString()+"-"+this._serverList.length.toString()),this.CreateLeftServerItem(a,t.toString())}},ClearServerItemList:function(){for(;0<this._serveritemlist.length;)
this._serveritemlist.pop().destroy()},Serveritem_ClickHandler:function(e,t){s.playBtnOpenEffect();var a=t;cc.log(a.server_name),MyUiManager.Back(),n("LoginSceneManager").getInstance().SetServerInfo(a)},ServerListOnClickHandler:function(e,t){s.playBtnOpenEffect();var a=parseInt(t);null!=this._lastSelectserverlistnode&&(this._lastSelectserverlistnode.normalSprite=this.m_pSpr_Btn7),this.m_pTuijianBtn.normalSprite!=this.m_pSpr_Btn1&&(this.m_pTuijianBtn.normalSprite=this.m_pSpr_Btn1);var n=e.currentTarget.getComponent(cc.Button);n.normalSprite=this.m_pSpr_Btn7_touch,this.m_pAllServeritemNode.active=!0,this.m_pDefaultShowServerNode.active=!1;var i=10*a;if(this.ClearServerItemList(),0<this._serverList.length-i&&this._serverList.length-i<10)
for(var r=this._serverList.length-1;i<=r;--r)
this.CreateServerItem(this._serverList[r],this.m_pServeritemparent,cc.v2(310,0));else
for(r=i+9;i<=r;--r)
this.CreateServerItem(this._serverList[r],this.m_pServeritemparent,cc.v2(310,0));this._lastSelectserverlistnode=n},Back_onclickHandler:function(e){s.playBtnCloseEffect(),MyUiManager.Back()},tuijianServerClickHandler:function(e){s.playBtnOpenEffect(),null!=this._lastSelectserverlistnode&&(this._lastSelectserverlistnode.normalSprite=this.m_pSpr_Btn7),this.m_pDefaultShowServerNode.active=!0,this.m_pAllServeritemNode.active=!1,this.ShowLastOrTuijianServer()},CreateLeftServerItem:function(e,t){var a=cc.instantiate(this.m_pServerListNode);a.active=!0;var n=a.getComponent("ServerListItem");n.SetInfo(e);var i=new cc.Component.EventHandler;i.target=this.node,i.component="ServerListPanel",i.handler="ServerListOnClickHandler",i.customEventData=t,n.m_pBtnSpr.clickEvents[0]=i,this.m_pServerlistparent.addChild(a),this._leftserveritemlist.push(a)}}),cc._RF.pop()},{LoginSceneManager:"LoginSceneManager",SoundUtil:"SoundUtil"}],ShaderUtil:[function(e,t,a){"use strict";cc._RF.push(t,"b587bg2+p1DF6pVDjDRO6Ws","ShaderUtil");var n="attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec2 v_texCoord;\nvarying vec4 v_fragmentColor;\nvoid main()\n{\ngl_Position = CC_PMatrix * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}\n",i="#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\n vec4 col = texture2D(CC_Texture0, v_texCoord);\n float grey = dot(col.rgb, vec3(0.299, 0.587, 0.114));\n gl_FragColor = vec4(grey, grey, grey, col.a);\n}",r="#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec2 v_texCoord;\nvoid main()\n{\nvec4 v = texture2D(CC_Texture0, v_texCoord).rgba;\nfloat f = (v.r + v.g + v.b) / 3.0;\ngl_FragColor = vec4(f, f, f, v.a);\n}\n",s="varying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\n gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);\n}";function o(e,t){if(cc.sys.isNative){var a=cc.GLProgramState.getOrCreateWithGLProgram(t);e.setGLProgramState(a)}else
e.setShaderProgram(t);var n=e.children;if(n)
for(var i=0;i<n.length;i++)
o(n[i],t)}
t.exports={setGaryShader:function(e){var t,a=(t=new cc.GLProgram,cc.sys.isNative?t.initWithString(n,r):(t.initWithVertexShaderByteArray(n,i),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS)),t.link(),t.updateUniforms(),t);o(e._sgNode,a)},resetShader:function(e){var t=new cc.GLProgram;cc.sys.isNative?t.initWithString(n,s):(t.initWithVertexShaderByteArray(n,s),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS)),t.link(),t.updateUniforms(),o(e._sgNode,t)}},cc._RF.pop()},{}],Shader:[function(e,t,a){"use strict";cc._RF.push(t,"d4c71/5hn5CVbgxLJLlcPLS","Shader");var c="attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_Position = CC_PMatrix * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}",l="varying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\n gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);\n}",h={GreyShader:e("GreyShader"),DefaultShader:{frag:l,verts:c}};t.exports={setGLProgram:function(e,t){var a=h[t];if(null!=a){var n,i,r,s,o=(i=(n=a).frag,r=n.vert,s=new cc.GLProgram,cc.sys.isNative&&(s.initWithString(null==r?c:r,null==i?l:i),s.link(),s.updateUniforms()),s);(function e(t,a){if(cc.sys.isNative){var n=cc.GLProgramState.getOrCreateWithGLProgram(a);t.setGLProgramState(n)}else
t.setShaderProgram(a);var i=t.children;if(i)
for(var r=0;r<i.length;r++)
e(i[r],a)})(e._sgNode,o)}else
cc.log("%s shader is nil",t)}},cc._RF.pop()},{GreyShader:"GreyShader"}],ShopItemInfo:[function(e,t,a){"use strict";cc._RF.push(t,"1ab57bpsQVLLJLgDHAhaycM","ShopItemInfo");var i=e("SoundUtil"),n=e("MyProtocols"),r=e("i18n"),s=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pItemDes:cc.Label,m_pItemName:[cc.Label],m_pItemNum:cc.Label,m_pItemCost:cc.Label,m_pItemTimes:cc.Label,m_pItemVipNum:cc.Label,m_pItemVipTimes:cc.Label,m_pVipShowNodes:[cc.Node],itemBoxParent:cc.Node,itemBoxPrefab:cc.Prefab,m_pCostSprite:cc.Sprite,btnBuy:cc.Node,m_pCostFrame:[cc.SpriteFrame],_pItemBox:cc.Node,_itemId:0,_itemNum:0,_itemTimes:0,_itemMoney:0,_itemSlotIndex:0,_playerVip:0,_maxNum:0,_numBox:0,_isCostAdd:!1,_cost:0,_costAdd:0,_canBuy:!1,_infoState:0},onLoad:function(){},ChangeData:function(e,t,a,n,i){var r=cc.instantiate(this.itemBoxPrefab);this.itemBoxParent.addChild(r),this._pItemBox=r,this._pItemBox.getComponent("ItemBox").ChangeItemInfo(e,t,!1,null,!0),this._itemId=e,this._itemNum=t,this._itemTimes=a,this._itemMoney=n,this._itemSlotIndex=i,this.m_pItemNum.string=1,this._numBox=1,this._playerVip=MyPersistDataManager._playerData.vip_level,this.ReadInfo(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},ReadInfo:function(){0==this._infoState?this.NormalShopInfo():2==this._infoState&&this.ArenaShopInfo()},ArenaShopInfo:function(){this.m_pCostSprite.spriteFrame=this.m_pCostFrame[1];DonotDestroyManager.GameData.Arena.exchange[this._itemId];this._maxNum=this._itemTimes,this.m_pItemTimes.string=r.t("shopmall_005",{value:this._itemTimes}),this._cost=this._itemMoney,this.m_pItemCost.string="x"+this._cost,MyPersistDataManager._playerData.honor>=this._itemMoney?(this.m_pItemCost.node.color=new cc.Color(6,252,0),this._canBuy=!0):(this.m_pItemCost.node.color=new cc.Color(255,0,0),this._canBuy=!1),this._isCostAdd=!1,this.m_pItemTimes.node.setPosition(cc.v2(-97,175)),this.m_pVipShowNodes[0].active=!1,this.m_pVipShowNodes[1].active=!1},NormalShopInfo:function(){this.m_pCostSprite.spriteFrame=this.m_pCostFrame[0];var e=DonotDestroyManager.GameData.Mall.items[this._itemSlotIndex];if(this._maxNum=this._itemTimes,this.m_pItemTimes.string=r.t("shopmall_005",{value:this._itemTimes}),this._cost=this._itemMoney,this._costAdd=e.money[1],this.m_pItemCost.string="x"+this._cost,MyPersistDataManager._playerData.money>=this._itemMoney?(this.m_pItemCost.node.color=new cc.Color(6,252,0),this._canBuy=!0):(this.m_pItemCost.node.color=new cc.Color(255,0,0),this._canBuy=!1),e.daily_times[0]!=e.daily_times[1]){this._isCostAdd=!0,this.m_pItemTimes.node.setPosition(cc.v2(-97,199)),this.m_pVipShowNodes[0].active=!0,this.m_pVipShowNodes[1].active=!0;var t=this._playerVip+1;13==this._playerVip&&(t=13),this.m_pItemVipNum.string=t,this.m_pItemVipTimes.string=r.t("shopmall_006",{value:e.daily_times[t]})}else
this._isCostAdd=!1,this.m_pItemTimes.node.setPosition(cc.v2(-97,175)),this.m_pVipShowNodes[0].active=!1,this.m_pVipShowNodes[1].active=!1},ItemInfo_offclickHandler:function(e){i.playBtnCloseEffect();var t=cc.scaleTo(.1,.7,.7),a=this,n=cc.sequence(t,cc.callFunc(function(){a.node.removeFromParent(),a.node.destroy()}));this.m_pScaelNode.runAction(n)},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},ChangeNum_onClickHandler:function(e,t){if(i.playBtnOpenEffect(),!(1011<this._itemId&&this._itemId<1017)){var a=this._numBox;"0"==t?(a-=10,this._numBox-10<1&&(a=1)):"1"==t?(a-=1,this._numBox-1<1&&(a=1)):"2"==t?(a+=1,this._numBox+1>this._maxNum&&(a=this._maxNum)):"3"==t&&(a+=10,this._numBox+10>this._maxNum&&(a=this._maxNum)),this._numBox=a,this.m_pItemNum.string=a.toString(),this.m_pItemCost.string="x"+this.CalculateCost(a)}},CalculateCost:function(e){var t=this._cost;if(this._isCostAdd){if(1==e)
t=this._cost;else
for(var a=1;a<e;++a)
t+=this._cost+a*this._costAdd;return t}
return t=e*this._cost},MallBuy_onClickHandler:function(){if(0==this._infoState)
this._canBuy?n.send_C2SMallBuy(DonotDestroyManager._gameSocket,this._itemSlotIndex,this._numBox):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),r.t("shopmall_016"));else if(2==this._infoState){var e=MyPersistDataManager._playerData.formationSlots;if(1011<this._itemId&&this._itemId<1020){if(e<10)
var t=1e4+e-2;var a=DonotDestroyManager.GameData.Arena.exchange[t];if(MyPersistDataManager._playerData.level<a[4])
return MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),r.t("shopmall_020")),this.node.removeFromParent(),void this.node.destroy()}
this._canBuy?n.send_C2SArenaExchange(DonotDestroyManager._gameSocket,this._itemSlotIndex,this._numBox):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),r.t("shopmall_021"))}
this.node.removeFromParent(),this.node.destroy()},showGuide:function(){var t=this;s.showGuide("AreanBuyDialog",function(e){if(1==e)
return t.btnBuy})}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",i18n:"i18n"}],ShopItem:[function(e,t,a){"use strict";cc._RF.push(t,"671e8qg3QBBBITsPsZ/91t5","ShopItem");var n=e("MyProtocols"),c=(e("NetEvent"),e("MyEventDispatcher"),e("ColorUtil")),i=e("SoundUtil"),r=(e("GameUtils"),e("i18n"));cc.Class({extends:cc.Component,properties:{m_pItemName:cc.Label,m_pItemCost:cc.Label,m_pItemCostFrame:cc.Sprite,m_pItemCostImage:[cc.SpriteFrame],m_pItemSellMask:cc.Node,m_pBuyBtn:cc.Button,m_pShopItemPrefab:cc.Prefab,itemBoxParent:cc.Node,itemBoxPrefab:cc.Prefab,yukedouPrefab:cc.Prefab,_pItemBoxNode:cc.Node,_itemId:0,_itemNum:0,_itemTimes:0,_itemMoney:null,_slotIndex:0,_itemState:0,_isShowNum:!0,_isMoney:!0,_itemDes:null,_canBuy:!1},onLoad:function(){},onDestroy:function(){},ChangeData:function(e,t,a,n,i){if(this._itemId=e,this._itemNum=t,this._itemTimes=a,this._itemMoney=n,this._slotIndex=i,this.m_pItemCost.string="x"+n,0==this._itemState)
this._isShowNum=!1,this.NormalJudgeMoney();else if(1==this._itemState)
this._isShowNum=!0,this.JxcJudgeMoney(),0<a&&(this.m_pItemSellMask.active=!0,this.m_pBuyBtn.enabled=!1);else if(2==this._itemState)
this._isShowNum=!0,this.JjcJudgeCost(),0==a&&this._itemId<1012&&1016<this._itemId&&(this.m_pItemSellMask.active=!0,this.m_pBuyBtn.enabled=!1);else if(3==this._itemState)
this._isShowNum=!0,this.GgzjJudgeCost(),0<a&&(this.m_pItemSellMask.active=!0,this.m_pBuyBtn.enabled=!1);else if(4==this._itemState){if(this._isShowNum=!0,null==this.node.getChildByName("yukedou")){var r=cc.instantiate(this.yukedouPrefab);this.node.addChild(r),r.setPosition(this.m_pItemCostFrame.node.getPosition()),this.m_pItemCostFrame.node.active=!1}
this.BlackShopJudge(),a&&(this.m_pItemSellMask.active=!0,this.m_pBuyBtn.enabled=!1)}
if(0==this.itemBoxParent.children.length){var s=cc.instantiate(this.itemBoxPrefab);this.itemBoxParent.addChild(s),this._pItemBoxNode=s}else
this._pItemBoxNode=this.itemBoxParent.children[0];var o=this._pItemBoxNode.getComponent("ItemBox");o.ChangeItemInfo(e,t,this._isShowNum,null,!0),this.m_pItemName.string=o._itemjsoninfo.name,this.m_pItemName.node.color=c.getColorByQuality(o._itemjsoninfo.quality),this._itemDes=o._itemjsoninfo.des},ItemBtn_onClickHandler:function(){i.playBtnOpenEffect(),0==this._itemState?this.ShowShopItemInfo():1==this._itemState?this._canBuy?n.send_C2SArmyShopBuy(DonotDestroyManager._gameSocket,this._slotIndex):this._isMoney?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),r.t("shopmall_016")):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),r.t("shopmall_017")):2==this._itemState?this.ShowShopItemInfo():3==this._itemState?this._canBuy?n.send_C2SOvercomeExchange(DonotDestroyManager._gameSocket,this._slotIndex):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),r.t("shopmall_018")):4==this._itemState&&(this._canBuy?n.send_C2SBlackMarketBuy(DonotDestroyManager._gameSocket,this._slotIndex):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),r.t("shopmall_019")))},ShowShopItemInfo:function(){var e=cc.instantiate(this.m_pShopItemPrefab),t=e.getComponent("ShopItemInfo");t._infoState=this._itemState,t.m_pItemName[0].string=this.m_pItemName.string,t.m_pItemName[1].string=this.m_pItemName.string,t.m_pItemName[0].node.color=this.m_pItemName.node.color,t.m_pItemName[1].node.color=this.m_pItemName.node.color,t.m_pItemDes.string=this._itemDes,t.ChangeData(this._itemId,this._itemNum,this._itemTimes,this._itemMoney,this._slotIndex),cc.Canvas.instance.node.addChild(e)},NormalJudgeMoney:function(){var e=MyPersistDataManager._playerData.money;this.m_pItemCostFrame.spriteFrame=this.m_pItemCostImage[0],e>=this._itemMoney?(this.m_pItemCost.node.color=new cc.Color(6,252,0),this._canBuy=!0):(this.m_pItemCost.node.color=new cc.Color(255,0,0),this._canBuy=!1)},JxcJudgeMoney:function(){var e=MyPersistDataManager._playerData.money,t=MyPersistDataManager._playerData.gameMoney;this._isMoney?(this.m_pItemCostFrame.spriteFrame=this.m_pItemCostImage[0],e>=this._itemMoney?(this.m_pItemCost.node.color=new cc.Color(6,252,0),this._canBuy=!0):(this.m_pItemCost.node.color=new cc.Color(255,0,0),this._canBuy=!1)):(this.m_pItemCostFrame.spriteFrame=this.m_pItemCostImage[1],t>=this._itemMoney?(this.m_pItemCost.node.color=new cc.Color(6,252,0),this._canBuy=!0):(this.m_pItemCost.node.color=new cc.Color(255,0,0),this._canBuy=!1))},JjcJudgeCost:function(){this.m_pItemCostFrame.spriteFrame=this.m_pItemCostImage[this._itemState];var e=0;if(null!=MyPersistDataManager._playerData.honor&&(e=MyPersistDataManager._playerData.honor),e>=this._itemMoney?(this.m_pItemCost.node.color=new cc.Color(6,252,0),this._canBuy=!0):(this.m_pItemCost.node.color=new cc.Color(255,0,0),this._canBuy=!1),0==this._slotIndex){var t=MyPersistDataManager._playerData.formationSlots;if(!(t<10))
return;var a=1e4+t-2,n=DonotDestroyManager.GameData.Arena.exchange[a];MyPersistDataManager._playerData.level<n[4]&&(this.m_pItemCostFrame.node.active=!1,this.m_pItemCost.node.color=new cc.Color(255,0,0),this.m_pItemCost.node.x=0,this.m_pItemCost.string=r.t("shopmall_015",{value:n[4]}))}},GgzjJudgeCost:function(){this.m_pItemCostFrame.spriteFrame=this.m_pItemCostImage[this._itemState];var e=0;null!=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.Common.overcome_exchange_item]&&(e=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.Common.overcome_exchange_item].num),e>=this._itemMoney?(this.m_pItemCost.node.color=new cc.Color(6,252,0),this._canBuy=!0):(this.m_pItemCost.node.color=new cc.Color(255,0,0),this._canBuy=!1)},BlackShopJudge:function(){var e=0;null!=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.BlackMarket.exchange_item]&&(e=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.BlackMarket.exchange_item].num),e<=0&&(e=0),e>=this._itemMoney?(this.m_pItemCost.node.color=new cc.Color(6,252,0),this._canBuy=!0):(this.m_pItemCost.node.color=new cc.Color(255,0,0),this._canBuy=!1)}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GameUtils:"GameUtils",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],ShopMallLayer:[function(e,t,a){"use strict";cc._RF.push(t,"189cdT83MJKw5HTvfCdXDW5","ShopMallLayer");var n=e("SoundUtil"),i=e("MyProtocols"),r=e("NetEvent"),s=e("MyEventDispatcher"),o=e("GameUtils"),c=e("i18n"),l=e("MyUIEvent");cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,selectBtnImage:cc.SpriteFrame,normalBtnImage:cc.SpriteFrame,itemContentNode:cc.Node,playerMoney:cc.Label,playerGameMoney:cc.Label,headNum:cc.Label,honorNum:cc.Label,copperNode:cc.Node,goldNode:cc.Node,pageBtns:[cc.Sprite],pageBtnsName:[cc.Label],pageTitle:cc.Sprite,pageTitleImage:[cc.SpriteFrame],shopItemPrefab:cc.Prefab,itemScrollVeiw:cc.ScrollView,m_pRewardPanel:cc.Prefab,JxcNode:cc.Node,JxcTime:cc.Label,JxcRefleshMoney:cc.Label,JxcDes:cc.Label,JxcGold:cc.Sprite,GgzjNode:cc.Node,GgzjHeadNumNode:cc.Node,JjcNode:cc.Node,overComeTips:cc.Prefab,_BtnIndex:0,_vipLevel:0,_itemList:[],_retItems:[],_jxcList:[],_jjcList:[],_arenaCount:[],_ggzjList:null,_showTime:!1,_counttime:0,_isTimeRunning:!1,_timeCamp:0,_leftTime:0,_freeReTime:0,_overcomeReTime:0,_formatSlot:0},onLoad:function(){this.ShopMallList_auth_cb_func=this.ShopMallList_auth_cb.bind(this),s.addListener(r.S2CMallList,this.ShopMallList_auth_cb_func),this.ArmyShopItemList_auth_cb_func=this.ArmyShopItemList_auth_cb.bind(this),s.addListener(r.S2CArmyShopItemList,this.ArmyShopItemList_auth_cb_func),this.ArmyShopBuy_auth_cb_func=this.ArmyShopBuy_auth_cb.bind(this),s.addListener(r.S2CArmyShopBuy,this.ArmyShopBuy_auth_cb_func),this.ArmyShopRefresh_auth_cb_func=this.ArmyShopRefresh_auth_cb.bind(this),s.addListener(r.S2CArmyShopRefresh,this.ArmyShopRefresh_auth_cb_func),this.MallBuy_auth_cb_func=this.MallBuy_auth_cb.bind(this),s.addListener(r.S2CMallBuy,this.MallBuy_auth_cb_func),this.MoneyChange_auth_cb_func=this.MoneyChange_auth_cb.bind(this),s.addListener(l.onGoldChange,this.MoneyChange_auth_cb_func),this.GameMoneyChange_auth_cb_func=this.GameMoneyChange_auth_cb.bind(this),s.addListener(l.onCooperChange,this.GameMoneyChange_auth_cb_func),this.OvercomeItemList_auth_cb_func=this.OvercomeItemList_auth_cb.bind(this),s.addListener(r.S2COvercomeItemList,this.OvercomeItemList_auth_cb_func),this.OvercomeExchange_auth_cb_func=this.OvercomeExchange_auth_cb.bind(this),s.addListener(r.S2COvercomeExchange,this.OvercomeExchange_auth_cb_func),this.OvercomeExchangeListRefresh_auth_cb_func=this.OvercomeExchangeListRefresh_auth_cb.bind(this),s.addListener(r.S2COvercomeExchangeListRefresh,this.OvercomeExchangeListRefresh_auth_cb_func),this.ArenaExchangeList_auth_cb_func=this.ArenaExchangeList_auth_cb.bind(this),s.addListener(r.S2CArenaExchangeList,this.ArenaExchangeList_auth_cb_func),this.ArenaExchange_auth_cb_func=this.ArenaExchange_auth_cb.bind(this),s.addListener(r.S2CArenaExchange,this.ArenaExchange_auth_cb_func),this.myPool=new cc.NodePool("MyTemplateHandler")},update:function(e){this._isTimeRunning&&(this._counttime+=e,1<=this._counttime&&(this._counttime-=1,this._leftTime--,this._leftTime<=-10?(this._isTimeRunning=!1,i.send_C2SArmyShopRefresh(DonotDestroyManager._gameSocket)):this.CalculateTime()))},onDestroy:function(){s.removeListener(r.S2CMallList,this.ShopMallList_auth_cb_func),s.removeListener(r.S2CArmyShopItemList,this.ArmyShopItemList_auth_cb_func),s.removeListener(r.S2CArmyShopBuy,this.ArmyShopBuy_auth_cb_func),s.removeListener(r.S2CArmyShopRefresh,this.ArmyShopRefresh_auth_cb_func),s.removeListener(r.S2CMallBuy,this.MallBuy_auth_cb_func),s.removeListener(l.onGoldChange,this.MoneyChange_auth_cb_func),s.removeListener(l.onCooperChange,this.GameMoneyChange_auth_cb_func),s.removeListener(r.S2COvercomeItemList,this.OvercomeItemList_auth_cb_func),s.removeListener(r.S2COvercomeExchange,this.OvercomeExchange_auth_cb_func),s.removeListener(r.S2COvercomeExchangeListRefresh,this.OvercomeExchangeListRefresh_auth_cb_func),s.removeListener(r.S2CArenaExchangeList,this.ArenaExchangeList_auth_cb_func),s.removeListener(r.S2CArenaExchange,this.ArenaExchange_auth_cb_func)},MoneyChange_auth_cb:function(e){this.playerMoney.string=e},GameMoneyChange_auth_cb:function(e){this.playerGameMoney.string=e},setParams:function(e){this.closeCb=e.closeCb,this._BtnIndex=0|e.state,this.ScaleToLarge(),this.Init()},Init:function(){this.ChangeToSelectedBtn(this._BtnIndex),this.SetItemsInfo(this._BtnIndex),this.playerGameMoney.string=MyPersistDataManager._playerData.gameMoney,this.playerMoney.string=MyPersistDataManager._playerData.money},SetItemsInfo:function(e){this.itemScrollVeiw.scrollToLeft(),this.JxcNode.active=!1,this.GgzjNode.active=!1,this.JjcNode.active=!1,this.copperNode.active=!0,this.goldNode.active=!0,this.playerGameMoney.node.active=!0,this.playerMoney.node.active=!0;for(var t=this.itemContentNode.children.concat(),a=0;a<t.length;++a)
this.myPool.put(t[a]);this._itemList=[];switch(e){case 0:null==MyPersistDataManager._playerData.shopMallInfo?i.send_C2SMallList(DonotDestroyManager._gameSocket):0==this._retItems.length?this.ReadShopMallInfo(MyPersistDataManager._playerData.shopMallInfo):this.SCBtnItemsShow();break;case 1:null==MyPersistDataManager._playerData.armyShopInfo?i.send_C2SArmyShopItemList(DonotDestroyManager._gameSocket):(0==this._jxcList.length&&(this._jxcList=MyPersistDataManager._playerData.armyShopInfo),this.JxcBtnItemsShow(this._jxcList));break;case 2:null==MyPersistDataManager._playerData.arenaShopInfo?i.send_C2SArenaExchangeList(DonotDestroyManager._gameSocket):0==this._jjcList.length?this.ReadArenaShopInfo(MyPersistDataManager._playerData.arenaShopInfo):this.ArenaItemsShow({items:this._jjcList,buy_count:this._arenaCount});break;case 3:null==MyPersistDataManager._playerData.overComeInfo?i.send_C2SOvercomeItemList(DonotDestroyManager._gameSocket):null==this._ggzjList?(this._ggzjList=MyPersistDataManager._playerData.overComeInfo,this.OverComeItemsShow(MyPersistDataManager._playerData.overComeInfo)):this.OverComeItemsShow(this._ggzjList)}},ArenaItemsShow:function(e){this.JjcNode.active=!0,this.honorNum.string=MyPersistDataManager._playerData.honor;for(var t=e.items,a=0;a<t.length;++a){var n=this.myPool.get();null==n&&(n=cc.instantiate(this.shopItemPrefab));var i=n.getComponent("ShopItem");i.m_pItemSellMask.active=!1,i.m_pBuyBtn.enabled=!0;var r=a;10==this._formatSlot&&r++;var s=t[a][3]-e.buy_count[r];s<0&&(s=0),i._itemState=this._BtnIndex,i.ChangeData(t[a][0],t[a][1],s,t[a][2],r),this._itemList.push(i),this.itemContentNode.addChild(n)}
this.JjcNode.off("touchstart",this._showTouchDesc,this),this.JjcNode.off("touchend",this._closeTouchDesc,this),this.JjcNode.off("touchcancel",this._closeTouchDesc,this),this.JjcNode.on("touchstart",this._showTouchDesc,this),this.JjcNode.on("touchend",this._closeTouchDesc,this),this.JjcNode.on("touchcancel",this._closeTouchDesc,this)},OverComeItemsShow:function(e){this.copperNode.active=!1,this.goldNode.active=!1,this.playerGameMoney.node.active=!1,this.playerMoney.node.active=!1,this.GgzjNode.active=!0,null!=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.Common.overcome_exchange_item]?this.headNum.string=MyPersistDataManager._playerData.bagMap[DonotDestroyManager.GameData.Common.overcome_exchange_item].num:this.headNum.string=0,this._overcomeReTime=e.refreshTimes;for(var t=e.itemsList,a=0;a<t.length;++a){var n=this.myPool.get();null==n&&(n=cc.instantiate(this.shopItemPrefab));var i=n.getComponent("ShopItem");i.m_pItemSellMask.active=!1,i.m_pBuyBtn.enabled=!0,i._itemState=this._BtnIndex,i.ChangeData(t[a].itemId,t[a].num,t[a].times,t[a].cost,t[a].exchangeIndex),this._itemList.push(i),this.itemContentNode.addChild(n)}
this.GgzjHeadNumNode.off("touchstart",this._showTouchDesc,this),this.GgzjHeadNumNode.off("touchend",this._closeTouchDesc,this),this.GgzjHeadNumNode.off("touchcancel",this._closeTouchDesc,this),this.GgzjHeadNumNode.on("touchstart",this._showTouchDesc,this),this.GgzjHeadNumNode.on("touchend",this._closeTouchDesc,this),this.GgzjHeadNumNode.on("touchcancel",this._closeTouchDesc,this)},_showTouchDesc:function(e){null!=this._tipNode&&(this._tipNode.removeFromParent(),this._tipNode.destroy(),this._tipNode=null),this._tipNode=cc.instantiate(DonotDestroyManager.DescribeTip),cc.director.getScene().addChild(this._tipNode),e.target==this.GgzjHeadNumNode?this._tipNode.getComponent("Tips").initTxtData("Vượt ải Trảm Tướng thành công để nhận Xu Trảm Tướng! Lv ải khiêu chiến càng cao,số lượng phần thưởng nhận càng nhiều.","Xu Trảm Tướng"):e.target==this.JjcNode&&this._tipNode.getComponent("Tips").initTxtData("Nhận Danh Vọng khi chiến thắng ở Đấu Trường!Người chơi có xếp hạng khiêu chiến càng cao,Danh Vọng nhận được càng nhiều","Danh Vọng");var t=e.touch.getLocation();t.x<500&&t.y<=500?(t.x+=500,t.y+=50):500<t.y&&500<=t.x?(t.x-=50,t.y-=300):t.x<500&&500<t.y?(t.x+=500,t.y-=300):(t.x-=50,t.y+=50),this._tipNode.setPosition(t)},_closeTouchDesc:function(e){null!=this._tipNode&&(cc.log("close description panel:"+e),this._tipNode.destroy(),this._tipNode=null)},JxcBtnItemsShow:function(e){this.JxcNode.active=!0,this._isTimeRunning=!0,this._timeCamp=1e3*e.refreshTimestamp,0<Math.floor((1e3*e.refreshTimestamp-(new Date).getTime())/1e3)?this._leftTime=Math.floor((1e3*e.refreshTimestamp-(new Date).getTime())/1e3):this._leftTime=0,this._freeReTime=e.freeTimes,this.CalculateTime(),0<e.freeTimes?(this.JxcDes.string=c.t("shopmall_012"),this.JxcRefleshMoney.string=e.freeTimes,this.JxcGold.node.active=!1):(this.JxcRefleshMoney.string="x"+(e.feeRefreshTimes+2)*DonotDestroyManager.GameData.Mall.arms.refresh_costs[1],this.JxcDes.string=c.t("shopmall_013"),this.JxcGold.node.active=!0);for(var t=e.items,a=0;a<t.length;++a){var n=this.myPool.get();null==n&&(n=cc.instantiate(this.shopItemPrefab));var i=null,r=null;0!=t[a].money?(i=t[a].money,r=!0):(i=t[a].gamemoney,r=!1);var s=n.getComponent("ShopItem");s.m_pItemSellMask.active=!1,s.m_pBuyBtn.enabled=!0,s._isMoney=r,s._itemState=this._BtnIndex,s.ChangeData(t[a].itemTemplateId,t[a].num,t[a].times,i,a),this._itemList.push(s),this.itemContentNode.addChild(n)}},SCBtnItemsShow:function(){for(var e=DonotDestroyManager.GameData.Mall.items,t=0;t<e.length;++t){var a=this.myPool.get();null==a&&(a=cc.instantiate(this.shopItemPrefab));var n=a.getComponent("ShopItem");n.m_pItemSellMask.active=!1,n.m_pBuyBtn.enabled=!0;var i=e[t].daily_times[this._vipLevel],r=e[t].money[0];if(0<this._retItems.length)
for(var s=0;s<this._retItems.length;++s)
t==this._retItems[s].slot_index&&(i-=this._retItems[s].buyNum,r=e[t].money[0]+this._retItems[s].buyNum*e[t].money[1],0==i&&(n.m_pItemSellMask.active=!0,n.m_pBuyBtn.enabled=!1),n.NormalJudgeMoney());n._itemState=this._BtnIndex,n.ChangeData(e[t].id,e[t].num,i,r,t),this._itemList.push(n),this.itemContentNode.addChild(a),this.itemContentNode.children}},ShopMallList_auth_cb:function(e){cc.log(" nhận cửa hàng tin tức "),MyPersistDataManager._playerData.shopMallInfo=e,this.ReadShopMallInfo(MyPersistDataManager._playerData.shopMallInfo)},ReadShopMallInfo:function(e){this._retItems=e.items,this.ChangeToSelectedBtn(this._BtnIndex),this._vipLevel=MyPersistDataManager._playerData.vip_level,this.SCBtnItemsShow()},ArenaExchangeList_auth_cb:function(e){cc.log(" Đấu Trường liệt biểu "),MyPersistDataManager._playerData.arenaShopInfo=e,this.ReadArenaShopInfo(MyPersistDataManager._playerData.arenaShopInfo)},ReadArenaShopInfo:function(e){this._arenaCount=e.buy_count;var t=DonotDestroyManager.GameData.Arena.exchange;this._formatSlot=MyPersistDataManager._playerData.formationSlots;var a=1e4+this._formatSlot-2;3<=this._formatSlot&&this._formatSlot<10&&this._jjcList.push(t[a]);for(var n=1;n<e.buy_count.length;++n)
this._jjcList.push(t[n]);this.ArenaItemsShow({items:this._jjcList,buy_count:this._arenaCount})},OvercomeItemList_auth_cb:function(e){MyPersistDataManager._playerData.overComeInfo=e,this._ggzjList=e,this.OverComeItemsShow(e)},ArmyShopItemList_auth_cb:function(e){MyPersistDataManager._playerData.armyShopInfo=e,this._jxcList=e,this.JxcBtnItemsShow(e)},ArenaExchange_auth_cb:function(e){cc.log(" Đấu Trường mua ");var t=[];t.push({itemId:e.rewards.item_template_id,cnt:e.rewards.item_count});var a=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(a),a.getComponent("GetRewardPanel")._itemlist=t;for(var n=0;n<this._itemList.length;++n)
this._itemList[n].JjcJudgeCost();this.honorNum.string=MyPersistDataManager._playerData.honor;var i=e.slot_index;10==this._formatSlot&&i--;var r=DonotDestroyManager.GameData.Arena.exchange;if(0!=e.slot_index)
this._arenaCount[i]+=e.buy_count,MyPersistDataManager._playerData.arenaShopInfo.buy_count[e.slot_index]=this._arenaCount[i];else if(1011<this._jjcList[e.slot_index][0]&&this._jjcList[e.slot_index][0]<1020)
if(3<=this._formatSlot&&this._formatSlot<10){this._formatSlot=MyPersistDataManager._playerData.formationSlots;var s=1e4+this._formatSlot-2;this._jjcList[e.slot_index]=r[s]}else
this._jjcList.splice(e.slot_index,1),this._arenaCount.splice(e.slot_index,1),this._itemList[e.slot_index].node.removeFromParent(),this._itemList[e.slot_index].node.destroy(),this._itemList.splice(e.slot_index,1),i--;var o=this._jjcList[i];if(null!=o){var c=o[3]-this._arenaCount[i];c<0&&(c=0),this._itemList[i].ChangeData(o[0],o[1],c,o[2],e.slot_index)}},MallBuy_auth_cb:function(e){cc.log(" cửa hàng mua ");var t=DonotDestroyManager.GameData.Mall.items,a=[],n=e.gain_items[0];a.push({itemId:n.itemTemplateId,cnt:n.num});var i=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(i),i.getComponent("GetRewardPanel")._itemlist=a;for(var r=0;r<this._itemList.length;++r)
this._itemList[r].NormalJudgeMoney();for(var s=e.slot_index,o=t[s].daily_times[this._vipLevel],c=t[s].money[0],l=0;l<t.length;++l)
if(s==l){for(var h=null,d=0;d<MyPersistDataManager._playerData.shopMallInfo.items.length;d++){var _=MyPersistDataManager._playerData.shopMallInfo.items[d];if(_.slot_index==s){h=_;break}}
null==h&&(h={slot_index:s,buyNum:0},MyPersistDataManager._playerData.shopMallInfo.items.push(h)),h.buyNum=e.item_info.buyNum,this._retItems=MyPersistDataManager._playerData.shopMallInfo.items,o-=h.buyNum,c=t[l].money[0]+h.buyNum*t[l].money[1],0==o&&(this._itemList[l].m_pItemSellMask.active=!0,this._itemList[l].m_pBuyBtn.enabled=!1),this._itemList[l].ChangeData(t[s].id,t[s].num,o,c,s)}},ArmyShopBuy_auth_cb:function(e){for(var t=[],a=e.gain_items,n=0;n<a.length;++n)
t.push({itemId:a[n].itemTemplateId,cnt:a[n].num});var i=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(i),i.getComponent("GetRewardPanel")._itemlist=t;var r=e.slot_index;this._itemList[r].m_pItemSellMask.active=!0,this._itemList[r].m_pBuyBtn.enabled=!1,this._jxcList.items[r].times++,MyPersistDataManager._playerData.armyShopInfo.items[r].times=this._jxcList.items[r].times;for(n=0;n<this._itemList.length;++n)
this._itemList[n].JxcJudgeMoney()},OvercomeExchange_auth_cb:function(e){var t=[],a=e.gain;t.push({itemId:a.item_template_id,cnt:a.item_count});var n=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(n),n.getComponent("GetRewardPanel")._itemlist=t;var i=e.exchange_index;this._itemList[i].m_pItemSellMask.active=!0,this._itemList[i].m_pBuyBtn.enabled=!1,this._ggzjList.itemsList[i].times++,MyPersistDataManager._playerData.armyShopInfo.itemsList[i].times++;for(var r=0;r<this._itemList.length;++r)
this._itemList[r].GgzjJudgeCost()},OvercomeExchangeListRefresh_auth_cb:function(e){for(var t=this.itemContentNode.children.concat(),a=0;a<t.length;++a)
this.myPool.put(t[a]);t=[],this.itemScrollVeiw.scrollToLeft(),0<this._itemList.length&&(this._itemList=[]),this._ggzjList=e,this.OverComeItemsShow(e)},OvercomeRefresh_onClickHandler:function(){var e=cc.instantiate(this.overComeTips);e.getComponent("OverComeTips").changeData(this._overcomeReTime),cc.Canvas.instance.node.addChild(e)},ArmyShopRefresh_auth_cb:function(e){for(var t=this.itemContentNode.children.concat(),a=0;a<t.length;++a)
this.myPool.put(t[a]);t=[],this.itemScrollVeiw.scrollToLeft(),0<this._itemList.length&&(this._itemList=[])},ArmyShopRefresh_onClickHandler:function(){n.playBtnOpenEffect(),i.send_C2SArmyShopRefresh(DonotDestroyManager._gameSocket)},ChangeToSelectedBtn:function(e){this.pageTitle.spriteFrame=this.pageTitleImage[e];var t=this.pageBtns[e],a=this.pageBtnsName[e];t.spriteFrame=this.selectBtnImage,t.node.width=160,t.node.height=64,t.node.x=-476,a.fontSize=26},ChangeToNormalBtn:function(e){var t=this.pageBtns[e],a=this.pageBtnsName[e];t.spriteFrame=this.normalBtnImage,t.node.width=120,t.node.height=60,t.node.x=-489,a.fontSize=24},Btns_onClickHandler:function(e,t){n.playPageEffect(),this._BtnIndex!=t&&(this.ChangeToSelectedBtn(t),this.ChangeToNormalBtn(this._BtnIndex),this._BtnIndex=parseInt(t),this.SetItemsInfo(this._BtnIndex))},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb(),this.myPool.clear(),this._itemList=[]},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},CalculateTime:function(){var e=Math.floor(this._leftTime/3600),t=Math.floor(this._leftTime%3600/60),a=this._leftTime%60;this.JxcTime.string=o.pad(e,2)+":"+o.pad(t,2)+":"+o.pad(a,2)}}),cc._RF.pop()},{GameUtils:"GameUtils",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],ShortLoadingMask:[function(e,t,a){"use strict";cc._RF.push(t,"81ecfEEsi9OoJu9/Hi2HyDt","ShortLoadingMask");var n=e("i18n");cc.Class({extends:cc.Component,properties:{rotatingNode:cc.Node,tip_label:cc.Label,_18n_t:{default:"131"},_doProgress:{default:!1}},onLoad:function(){var e=cc.rotateBy(3,360);e=cc.repeatForever(e),this.rotatingNode.runAction(e),this._doProgress?(this.tip_label.string=n.t(this._18n_t,{progress:""}),null==cc.loader.onProgress&&(this._loadProgressCb=this.loadProgressCbFunc.bind(this),cc.loader.onProgress=this._loadProgressCb)):this.tip_label.string=n.t(this._18n_t)},setText:function(e){this._18n_t=e,this._doProgress=!0},loadProgressCbFunc:function(e,t,a){null!=this.node&&this.node.isValid&&null!=this.tip_label&&(this.tip_label.string=n.t(this._18n_t,{progress:"("+e+"/"+t+")"}))},loadProgressChangeTips:function(e){null!=this.node&&this.node.isValid&&null!=this.tip_label&&(this.tip_label.string=n.t(this._18n_t,{progress:Math.round(100*e)+"%"}))},finishCb:function(){cc.loader.onProgress=null}}),cc._RF.pop()},{i18n:"i18n"}],ShowDialog:[function(e,t,a){"use strict";cc._RF.push(t,"c21051a4RVB2Lnk+2Omxv80","ShowDialog");var n=e("BuyGameMoney"),i=e("BuyEnergy"),r=e("i18n");cc.Class({extends:cc.Component,properties:{goldNum:cc.Label,copperNum:cc.Label,critSprite:cc.Sprite,crit:[cc.SpriteFrame],itemSprite:cc.Sprite,itemSpriteFrame:[cc.SpriteFrame],index:0},onLoad:function(){},changeData:function(){this.Init()},Init:function(){if(null!=n.getInstance()){var e=n.getInstance()._dialogList;this.itemSprite.spriteFrame=this.itemSpriteFrame[0]}else{if(null==i.getInstance())
return;e=i.getInstance()._dialogList;this.itemSprite.spriteFrame=this.itemSpriteFrame[1]}
if(0!=e.length)
switch(this.goldNum.string=r.t("headtabpanel_006",{value:e[this.index].useGold}),this.copperNum.string="x"+e[this.index].getItem,e[this.index].multiple){case 1:this.critSprite.node.active=!1;break;case 3:this.critSprite.node.active=!0,this.critSprite.spriteFrame=this.crit[0];break;case 10:this.critSprite.node.active=!0,this.critSprite.spriteFrame=this.crit[1];break;default:this.critSprite.node.active=!1}}}),cc._RF.pop()},{BuyEnergy:"BuyEnergy",BuyGameMoney:"BuyGameMoney",i18n:"i18n"}],ShowFps:[function(e,t,a){"use strict";cc._RF.push(t,"b6f81wU7wVNP470IqoD5X0f","ShowFps"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.director.setDisplayStats(!0)}}),cc._RF.pop()},{}],SignInItemInfo:[function(e,t,a){"use strict";cc._RF.push(t,"22bc2HLmu5IiY5e8fSdNe6b","SignInItemInfo");var i=e("SoundUtil"),r=e("ColorUtil"),n=e("MyEventDispatcher"),s=e("MyProtocols"),o=e("NetEvent"),c=e("i18n");cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pItemName:cc.Label,m_pItemNum:cc.Label,m_pItemDes:cc.Label,m_pSignBtnNode:cc.Node,m_pVipNode:cc.Node,m_pDaysNode:cc.Node,m_pRewardPanel:cc.Prefab,itemBoxParent:cc.Node,itemBoxPrefab:cc.Prefab,_pItemBoxNode:cc.Node,_signItemInfoID:0,_signitemVipCoef:0,_signitemNum:0,_signitemMoney:0,_signitemGameMoney:0,_itemData:null,_signdays:0,_isTodaySigned:!1,_effectNode:cc.Node,_isVipSigned:!1},onLoad:function(){this.ScaleToLarge(),this.S2CGetSignAward_auth_cb_func=this.S2CGetSignAward_auth_cb.bind(this),n.addListener(o.S2CGetSignAward,this.S2CGetSignAward_auth_cb_func)},onDestroy:function(){null!=this.finishCb&&this.finishCb(),n.removeListener(o.S2CGetSignAward,this.S2CGetSignAward_auth_cb_func)},ChangeData:function(e,t,a,n,i,r,s){this._signItemInfoID=e,this.m_pVipNode.active=0!=t,a||(this.m_pDaysNode.active=!1,s||(this.m_pSignBtnNode.active=!0)),this._signdays=n+1,this._signitemNum=i,this.JudgeVip(t),this._effectNode=r,this._isTodaySigned=s,this.ReadInfo()},JudgeVip:function(e){var t=MyPersistDataManager._playerData.vip_level;0<e&&e<=t&&(this._signitemNum=2*this._signitemNum,this._isVipSigned=!0)},ReadInfo:function(e){var t=cc.instantiate(this.itemBoxPrefab);this.itemBoxParent.addChild(t),this._pItemBoxNode=t,this._pItemBoxNode.getComponent("ItemBox").ChangeItemInfo(this._signItemInfoID,this._signitemNum,!0,null,!1);var a=this._pItemBoxNode.getComponent("ItemBox"),n=a._ishero;this.GetItemCfg(n),this.m_pItemName.string=this._itemData[this._signItemInfoID].name,this.m_pItemName.node.color=r.getColorByQuality(a._itemjsoninfo.quality),this.m_pItemDes.string=this._itemData[this._signItemInfoID].des,this.m_pItemNum.string=c.t("signin_002",{value:this._signdays})},GetItemCfg:function(){null!=DonotDestroyManager.GameData.Consumes[this._signItemInfoID]?this._itemData=DonotDestroyManager.GameData.Consumes:null!=DonotDestroyManager.GameData.Boxes[this._signItemInfoID]?this._itemData=DonotDestroyManager.GameData.Boxes:null!=DonotDestroyManager.GameData.Items[this._signItemInfoID]?this._itemData=DonotDestroyManager.GameData.Items:null!=DonotDestroyManager.GameData.Equips[this._signItemInfoID]?this._itemData=DonotDestroyManager.GameData.Equips:null!=DonotDestroyManager.GameData.EquipFrags[this._signItemInfoID]?this._itemData=DonotDestroyManager.GameData.EquipFrags:null!=DonotDestroyManager.GameData.Treasures[this._signItemInfoID]?this._itemDatag=DonotDestroyManager.GameData.Treasures:null!=DonotDestroyManager.GameData.CardFrags[this._signItemInfoID]?this._itemData=DonotDestroyManager.GameData.CardFrags:null!=DonotDestroyManager.GameData.Cards[this._signItemInfoID]?this._itemData=DonotDestroyManager.GameData.Cards:null!=DonotDestroyManager.GameData.UnitsEquips[this._signItemInfoID]?this._itemData=DonotDestroyManager.GameData.UnitsEquips:null!=DonotDestroyManager.GameData.TreasureFrags[this._signItemInfoID]&&(this._itemData=DonotDestroyManager.GameData.TreasureFrags)},setCloseCb:function(e){this.finishCb=e},ItemInfo_offclickHandler:function(e){i.playBtnCloseEffect();var t=cc.scaleTo(.1,.7,.7),a=this,n=cc.sequence(t,cc.callFunc(function(){a.node.removeFromParent(),a.node.destroy()}));this.m_pScaelNode.runAction(n)},ScaleToLarge:function(e){i.playBtnOpenEffect(),this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var t=cc.scaleTo(.2,1,1);this.m_pScaelNode.runAction(t)},SingIn_onclickHandler:function(e){s.send_C2SGetSignAward(DonotDestroyManager._gameSocket)},S2CGetSignAward_auth_cb:function(e){var t=[];t.push({itemId:this._signItemInfoID,cnt:this._signitemNum});var a=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(a),a.getComponent("GetRewardPanel")._itemlist=t,null!=this._effectNode&&(this._effectNode.removeFromParent(),this._effectNode.destroy(),this._isTodaySigned=!0),this.node.removeFromParent(),this.node.destroy(),this.finishCb(),n.dispatchEvent("SignSuccess",this._isVipSigned)},test_onclick:function(e){var t=[];t.push({itemId:this._signItemInfoID,cnt:this._signitemNum});var a=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(a),a.getComponent("GetRewardPanel")._itemlist=t,null!=this._effectNode&&(this._effectNode.removeFromParent(),this._effectNode.destroy(),this._isTodaySigned=!0),this.node.removeFromParent(),this.node.destroy(),this.finishCb(),n.dispatchEvent("SignSuccess",this._isVipSigned)}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],SignInItem:[function(e,t,a){"use strict";cc._RF.push(t,"6b764VUAHRA3ogCw8zbk+Fk","SignInItem"),cc.Class({extends:cc.Component,properties:{_itemBoxNode:cc.Node,m_itemNumLabel:cc.Label,m_itemVipSprite:cc.Sprite,m_itemSignedMask:cc.Node,m_itemVipCoefList:[cc.SpriteFrame],m_itemInfoPrefab:cc.Prefab,m_itemBG:cc.Sprite,m_itemBGVip:cc.SpriteFrame,index:0,itemBoxParent:cc.Node,itemBoxPrefab:cc.Prefab,itemNum:cc.Label,_itemID:0,_itemVipCoef:0,_itemNum:0,_itemMoney:0,_itemGameMoney:0,_checkinData:null,_loaded_prefab:null,_isVipDaysShow:!0,_effectNode:cc.Node,_isTodaySigned:!1,_signedState:0,_month:0,_year:0},onLoad:function(){this.ReadCheckinInfo()},ReadCheckinInfo:function(){var e=this.JudgeJsonName();this._checkinData=DonotDestroyManager.GameData[e],this._itemID=this._checkinData[this.index].item[0],this._itemNum=this._checkinData[this.index].item[1],this._itemVipCoef=this._checkinData[this.index].vip_coef,this._itemMoney=this._checkinData[this.index].money,this._itemGameMoney=this._checkinData[this.index].gamemoney,this.JudgeID();var t=cc.instantiate(this.itemBoxPrefab);this.itemBoxParent.addChild(t),this._itemBoxNode=t,this._itemBoxNode.getComponent("ItemBox").ChangeItemInfo(this._itemID,0,!1,null,!1),this.itemNum.string="x"+this._itemNum,this.JudgeVip()},JudgeID:function(){var e=this;0==e._itemID&&(0==e._itemMoney&&0!=e._itemGameMoney?(e._itemID=1450,e._itemNum=e._itemGameMoney):0!=e._itemMoney&&(e._itemID=1451,e._itemNum=e._itemMoney))},JudgeVip:function(){0!=this._itemVipCoef?(this.m_itemVipSprite.spriteFrame=this.m_itemVipCoefList[this._itemVipCoef-1],this._signedState=1):(this.m_itemVipSprite.spriteFrame=null,this._signedState=0)},ItemInfo_onclickHandler:function(e){this.NormalItemInfo()},NormalItemInfo:function(){var i=this;cc.loader.loadRes("Prefab/SignInLayer/SignItemInfo",function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a);var n=a.getComponent("SignInItemInfo");n.ChangeData(i._itemBoxNode.getComponent("ItemBox")._itemId,i._itemVipCoef,i._isVipDaysShow,i.index,i._itemNum,i._effectNode,i._isTodaySigned),n.setCloseCb(i._signInItemInfoCloseCb.bind(i)),i._loaded_prefab=t})},_signInItemInfoCloseCb:function(){null!=this._loaded_prefab&&(this._loaded_prefab=null)},GetTime:function(){var e=new Date;this._month=e.getMonth()+1,this._year=e.getFullYear()},JudgeJsonName:function(){this.GetTime();var e="";return e=this._month<10?"Checkin_"+this._year+"0"+this._month:"Checkin_"+this._year+this._month,cc.log("box="+e),e}}),cc._RF.pop()},{}],SignInLayer:[function(e,t,a){"use strict";cc._RF.push(t,"5bd6br1/5lMlJhpOsFHek7E","SignInLayer");var i=e("SoundUtil"),n=e("MyEventDispatcher"),r=e("i18n");cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pSignInItemNode:cc.Node,m_pSignInDaysIndex:cc.RichText,m_pSignInMonth:cc.Label,m_pSignInTipsNode:cc.Node,m_pSignTipsScaleNode:cc.Node,m_pSelfNode:cc.Node,itemPrefab:cc.Prefab,effectPrefab:cc.Prefab,isTodaySigned:!1,_daysIndex:5,_monthNow:0,_monthDays:0,_signinfo:null,_isVipItem:!1,_signItems:[],_isFirstOpen:!0},onLoad:function(){this.SignSuccess_cb_func=this._SignSuccess_cb_func.bind(this),n.addListener("SignSuccess",this.SignSuccess_cb_func)},onDestroy:function(){null!=this.finishCb&&this.finishCb(),n.removeListener("SignSuccess",this.SignSuccess_cb_func)},_SignSuccess_cb_func:function(e){cc.log(" đánh dấu thành công ");this._signItems[this._todaySign-1];var t=this._signItems[this._todaySign-1].getComponent("SignInItem");t.ReadCheckinInfo(),this._daysIndex=this._todaySign,this.m_pSignInDaysIndex.string=r.t("signin_001",{value:this._daysIndex}),t.m_itemSignedMask.active=!0,t._isTodaySigned=!0},setParams:function(e){this.closeCb=e.closeCb,this.ChangeData(e.info)},ChangeData:function(e){this.GetTime(),this._signinfo=e,this._daysIndex=e.signed_day_num,this._todaySign=e.today_day_num,this._myVipNum=MyPersistDataManager._playerData.vip_level,this.ScaleToLarge(),this.SetAllItems(),this.LoadNews()},LoadNews:function(){this.m_pSignInTipsNode.active=!1,this.m_pSignInDaysIndex.string=r.t("signin_001",{value:this._daysIndex}),this.m_pSignInMonth.string=this._monthNow},ShowItem:function(e){var t=cc.instantiate(this.itemPrefab);t.getComponent("SignInItem").index=e,this._signItems.push(t),this.JudgeVip(t),this._daysIndex==this._todaySign&&(this.isTodaySigned=!0),e<this._daysIndex&&(t.getComponent("SignInItem").m_itemSignedMask.active=!0),this.isTodaySigned||e==this._todaySign-1&&this.SetEffevtPrefab(t),this.m_pSignInItemNode.addChild(t)},JudgeVip:function(e){0!=e.getComponent("SignInItem")._itemVipCoef?this._isVipItem=!0:this._isVipItem=!1},SetEffevtPrefab:function(e){var t=cc.instantiate(this.effectPrefab);e.addChild(t),e.getComponent("SignInItem")._isVipDaysShow=!1,e.getComponent("SignInItem")._effectNode=t,e.getComponent("SignInItem")._isTodaySigned=this.isTodaySigned},SetAllItems:function(){for(var e=0;e<this._monthDays;++e)
this.ShowItem(e)},Back_onclickHandler:function(e){i.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},Tips_onclickHandler:function(e){var t=this;i.playBtnOpenEffect();var a=cc.scaleTo(.2,1,1),n=cc.sequence(cc.callFunc(function(){t.m_pSignInTipsNode.active=!0}),a);this.m_pSignTipsScaleNode.runAction(n)},Tips_offclickHandler:function(e){var t=this;i.playBtnCloseEffect();var a=cc.scaleTo(.2,.7,.7),n=cc.sequence(a,cc.callFunc(function(){t.m_pSignInTipsNode.active=!1}));this.m_pSignTipsScaleNode.runAction(n)},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},GetTime:function(){var e=new Date;this._monthNow=e.getMonth()+1,e.setMonth(this._monthNow),e.setDate(0),this._monthDays=e.getDate(),cc.log(this._monthNow+"----"+this._monthDays)}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",SoundUtil:"SoundUtil",i18n:"i18n"}],SignInVipInfo:[function(e,t,a){"use strict";cc._RF.push(t,"2e65bSQjwNLYZMCOsWzR2Za","SignInVipInfo");var i=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pVipNum:cc.Label,m_pScaelNode:cc.Node,_vipNum:0},onLoad:function(){this.ScaleToLarge()},onDestroy:function(){null!=this.finishCb&&this.finishCb()},ChangeData:function(e){this._vipNum=e,this.ReadVipInfo()},ReadVipInfo:function(){this.m_pVipNum.string=this._vipNum},setCloseCb:function(e){this.finishCb=e},back_onclickHandler:function(e){i.playBtnCloseEffect();var t=cc.scaleTo(.1,.7,.7),a=this,n=cc.sequence(t,cc.callFunc(function(){a.node.removeFromParent(),a.node.destroy()}));this.m_pScaelNode.runAction(n)},ScaleToLarge:function(e){i.playBtnOpenEffect(),this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var t=cc.scaleTo(.2,1,1);this.m_pScaelNode.runAction(t)}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],SkillsManager:[function(h,e,t){"use strict";cc._RF.push(e,"cca7f4Fr1hHM40ufJeFcE/w","SkillsManager");var d=h("BattleConstants"),_=function(){this.skillActors=[],this.skillMap=new Map};_.prototype.resetData=function(){this.skillActors=[],this.skillMap.clear()},_._SKILL_TRIGGER={Opening:0,Damage:1,HP_Perc:2,PreDead:6},_._SKILL_TARGET={SelfBody:0,OurRandHero:1,OurRandUnit:2,OurLowestHP:3,OurFrontHero:4,CurAttacking:5,OtrRandHero:6,OtrRandUnit:7,OtrLowestHP:8,OtrRearHero:9,RandTargets:10,OurRemoteHero:11,OtrRemoteHero:12,OurMeleeHero:13,OtrMeleeHero:14,OtrMarkedHero:15},_._SKILL_IMPACT={Mate:0,Enemy:1},_.prototype.getCfgById=function(e){return DonotDestroyManager.GameData.Skills[e]},_.prototype.createSkill=function(e){var t=new(h("Skill"));return this.skillActors.push(t),this.skillMap.set(e,t),cc.log("Current Skills Managed ============= size=%d ",this.skillActors.length),t},_.prototype.cancelSkillAll=function(){for(var e=0;e<this.skillActors.length;e++){var t=this.skillActors[e];t.doEvent("Cancel"),null!=t.origin&&null!=t.origin.cfg&&this.skillMap.delete(t.origin.cfg.id)}
this.skillActors.length=0},_.prototype.removeSkill=function(e){for(var t=0;t<this.skillActors.length;t++){if(this.skillActors[t]==e){this.skillActors.splice(t,1);break}}
null!=e&&null!=e.origin&&null!=e.origin.cfg&&this.skillMap.delete(e.origin.cfg.id)},_.prototype.getSkill=function(e){return this.skillMap.get(e)},_.prototype.getTargetArmies=function(e){var t=h("BattleManager"),a=e.origin.side(),n=e.cfg.target_type,i=[];return a==d._BTL_SIDE.OUR?n==_._SKILL_TARGET.OurRandHero||n==_._SKILL_TARGET.OurRandUnit||n==_._SKILL_TARGET.OurLowestHP||n==_._SKILL_TARGET.OurRemoteHero||n==_._SKILL_TARGET.OurMeleeHero?i=t.ourside.armies:n!=_._SKILL_TARGET.OtrRandHero&&n!=_._SKILL_TARGET.OtrRandUnit&&n!=_._SKILL_TARGET.OtrLowestHP&&n!=_._SKILL_TARGET.OtrRemoteHero&&n!=_._SKILL_TARGET.OtrMeleeHero&&n!=_._SKILL_TARGET.OtrMarkedHero||(i=t.otrside.armies):a==d._BTL_SIDE.OTR&&(n==_._SKILL_TARGET.OurRandHero||n==_._SKILL_TARGET.OurRandUnit||n==_._SKILL_TARGET.OurLowestHP||n==_._SKILL_TARGET.OurRemoteHero||n==_._SKILL_TARGET.OurMeleeHero?i=t.otrside.armies:n!=_._SKILL_TARGET.OtrRandHero&&n!=_._SKILL_TARGET.OtrRandUnit&&n!=_._SKILL_TARGET.OtrLowestHP&&n!=_._SKILL_TARGET.OtrRemoteHero&&n!=_._SKILL_TARGET.OtrMeleeHero&&n!=_._SKILL_TARGET.OtrMarkedHero||(i=t.ourside.armies)),i},_.prototype.searchRandomHeroes=function(e){for(var t=e.cfg.target_num,a=this.getTargetArmies(e),n=[],i=0;i<a.length;i++){(s=a[i]).isSearchAble()&&s.hero&&"Dead"!=s.hero.getState()&&n.push(s.hero)}
if(t<=n.length)
for(;0<t;){var r=parseInt(Math.random()*n.length);r=r>=n.length?n.length-1:r,e.targets.push(n[r]),n.splice(r,1),t-=1}
else
for(i=0;i<n.length;i++){var s=n[i];e.targets.push(s)}},_.prototype.searchMarkedHero=function(e){for(var t=this.getTargetArmies(e),a=e.cfg.target_num,n=0;n<t.length;n++){var i=t[n];if(i.isSearchAble()&&i.hero&&"Dead"!=i.hero.getState())
for(var r=0;r<i.hero.buffs.length;r++){i.hero.buffs[r].cfg.id==a&&e.targets.push(i.hero)}}},_.prototype.searchHPLowestHero=function(e){for(var t,a=this.getTargetArmies(e),n=0;n<a.length;n++){var i=a[n];if(i.hero&&"Dead"!=i.hero.getState())
if(t){var r=t.hp/t.basehp;i.hero.hp/i.hero.basehp<r&&(t=i.hero)}else
t=i.hero}
null!=t&&e.targets.push(t)},_.prototype.searchRemoteHero=function(e){for(var t=e.cfg.target_num,a=this.getTargetArmies(e),n=[],i=[],r=0;r<a.length;r++){(c=a[r]).hero&&"Dead"!=c.hero.getState()&&(c.hero.uCfg.atk_type==d._ARMY_TYPE.Remote&&n.push(c.hero),i.push(c.hero))}
var s=null;if(t<=(s=0<n.length?n:i).length)
for(;0<t;){var o=parseInt(Math.random()*s.length);o=o>=s.length?s.length-1:o,e.targets.push(s[o]),s.splice(o,1),t-=1}
else
for(r=0;r<s.length;r++){var c=s[r];e.targets.push(c)}},_.prototype.searchMeleeHero=function(e){for(var t=e.cfg.target_num,a=this.getTargetArmies(e),n=[],i=[],r=0;r<a.length;r++){(c=a[r]).hero&&"Dead"!=c.hero.getState()&&(c.hero.uCfg.atk_type==d._ARMY_TYPE.Melee&&n.push(c.hero),i.push(c.hero))}
var s=null;if(t<=(s=0<n.length?n:i).length)
for(;0<t;){var o=parseInt(Math.random()*s.length);o=o>=s.length?s.length-1:o,e.targets.push(s[o]),s.splice(o,1),t-=1}
else
for(r=0;r<s.length;r++){var c=s[r];e.targets.push(c)}},_.prototype.searchDistanceHero=function(e){var t,a,n=h("BattleManager"),i=e.origin.side(),r=e.cfg.target_type;i==d._BTL_SIDE.OUR?r==_._SKILL_TARGET.OurFrontHero?t=n.ourside.armies:r==_._SKILL_TARGET.OtrRearHero&&(t=n.otrside.armies):i==d._BTL_SIDE.OTR&&(r==_._SKILL_TARGET.OurFrontHero?t=n.otrside.armies:r==_._SKILL_TARGET.OtrRearHero&&(t=n.ourside.armies));for(var s=0;s<t.length;s++){var o=t[s];if(o.hero&&"Dead"!=o.hero.getState())
if(a){var c=a.getPosition().x,l=o.hero.getPosition().x;(i==d._BTL_SIDE.OUR&&(r==_._SKILL_TARGET.OurFrontHero&&l<c||r==_._SKILL_TARGET.OtrRearHero&&c<l)||i==d._BTL_SIDE.OTR&&(r==_._SKILL_TARGET.OurFrontHero&&c<l||r==_._SKILL_TARGET.OtrRearHero&&l<c))&&(a=o.hero)}else
a=o.hero}
null!=a&&e.targets.push(a)},_.prototype.searchRandomUnits=function(e){for(var t=e.cfg.target_num,a=this.getTargetArmies(e),n=[],i=0;i<a.length;i++){if((c=a[i]).isSearchAble()){c.hero&&"Dead"!=c.hero.getState()&&n.push(c.hero);for(var r=0;r<c.soldiers.length;r++){var s=c.soldiers[r];n.push(s)}}}
if(t<=n.length)
for(;0<t;){var o=parseInt(Math.random()*n.length);o=o>=n.length?n.length-1:o,e.targets.push(n[o]),n.splice(o,1),t-=1}
else
for(i=0;i<n.length;i++){var c=n[i];e.targets.push(c)}},_.prototype.randomTargetInArmy=function(e){var t,a=[];(t=e.origin.target?e.origin.target.army:e.origin.army.target).hero&&"Dead"!=t.hero.getState()&&a.push(t.hero);for(var n=0;n<t.soldiers.length;n++){var i=t.soldiers[n];a.push(i)}
e.targets=[];var r=parseInt(Math.random()*a.length);r=r>=a.length?a.length-1:r,e.targets.push(a[r])},_.prototype.searchTargetsFor=function(e){var t=e.cfg.target_type;t==_._SKILL_TARGET.SelfBody?e.targets.push(e.origin):t==_._SKILL_TARGET.OurRandHero||t==_._SKILL_TARGET.OtrRandHero?this.searchRandomHeroes(e):t==_._SKILL_TARGET.OurRandUnit||t==_._SKILL_TARGET.OtrRandUnit?this.searchRandomUnits(e):t==_._SKILL_TARGET.OurLowestHP||t==_._SKILL_TARGET.OtrLowestHP?this.searchHPLowestHero(e):t==_._SKILL_TARGET.OurFrontHero||t==_._SKILL_TARGET.OtrRearHero?this.searchDistanceHero(e):t==_._SKILL_TARGET.CurAttacking?e.targets.push(null!=e.origin.target?e.origin.target:e.origin.army.target.hero):t==_._SKILL_TARGET.RandTargets?this.randomTargetInArmy(e):t==_._SKILL_TARGET.OurRemoteHero||t==_._SKILL_TARGET.OtrRemoteHero?this.searchRemoteHero(e):t==_._SKILL_TARGET.OurMeleeHero||t==_._SKILL_TARGET.OtrMeleeHero?this.searchMeleeHero(e):t==_._SKILL_TARGET.OtrMarkedHero&&this.searchMarkedHero(e)},_.prototype.getRangeRect=function(e,t,a,n){var i=-1,r=a[0],s=a[1];if(0<r&&0<s){var o=a[2]||0,c=a[3]||0;o*=n,i=cc.rect(e+o-r/2,t+c-s/2,r,s)}
return i},_.prototype.getImpactArmies=function(e){var t=h("BattleManager"),a=[],n=e.cfg.impact_unit,i=e.origin.side();return n==_._SKILL_IMPACT.Mate?i==d._BTL_SIDE.OUR?a=t.ourside.armies:i==d._BTL_SIDE.OTR&&(a=t.otrside.armies):n==_._SKILL_IMPACT.Enemy&&(i==d._BTL_SIDE.OUR?a=t.otrside.armies:i==d._BTL_SIDE.OTR&&(a=t.ourside.armies)),a},_.prototype.getOtherSideArmies=function(e){var t=h("BattleManager"),a=[];return e==d._BTL_SIDE.OUR?a=t.otrside.armies:e==d._BTL_SIDE.OTR&&(a=t.ourside.armies),a},_.prototype.onUpdate=function(e){for(var t=h("BattleManager"),a=0;a<this.skillActors.length;a++){var n=this.skillActors[a];(t.btlState!=d._BTL_STATE.PAUSE||n.origin&&!n.origin.isPauseAble)&&n.onUpdate(e)}},_.prototype.pause=function(){for(var e=0;e<this.skillActors.length;e++){var t=this.skillActors[e];if(t.origin.isPauseAble)
t.pause();else
for(var a in t.effects){t.effects[a].pauseAble=!1}}},_.prototype.resume=function(){for(var e=0;e<this.skillActors.length;e++){var t=this.skillActors[e];if(t.origin.isPauseAble)
t.resume();else
for(var a in t.effects){t.effects[a].pauseAble=!0}}},e.exports=new _,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleManager:"BattleManager",Skill:"Skill"}],Skill:[function(E,e,t){"use strict";cc._RF.push(e,"19a37l/4EFFI5pTY/O8AuM7","Skill");var k=E("BattleConstants"),a=E("state-machine"),h=E("SoundUtil"),n=cc.Class({extends:E("WActor"),properties:{_is_add_buff:!1},ctor:function(){cc.log("Skill create!"),this.id=0,this.origin=null,this.cfg={},this.soundDT=0,this.playTimes=0,this.playDelay=0,this.lastPoint={},this.targets=[],this.effects=[],this.interruptDT=0,this.move2TargetDT=0,this.bigSkillCB=null},setFSM:function(){var i=this;this.fsm=a.create({initial:"Init",events:[{name:"Active",from:"Init",to:"Display"},{name:"End",from:"Display",to:"Complete"},{name:"Cancel",from:"*",to:"Complete"}],callbacks:{onenterstate:function(e,t,a){},onenterActive:function(e,t,a,n){i.onenterActive(e,t,a,n)},onafterEnd:function(){i.onafterEnd()},onafterCancel:function(){i.onafterCancel()},onenterInit:function(){i.onenterInit()},onenterDisplay:function(){i.onenterDisplay()},onenterComplete:function(){i.onenterComplete()}}})},onenterInit:function(){this._is_add_buff=!1,this.soundDT=this.cfg.sound[1]||0,this.interruptDT=null!=this.cfg.interrupt_action?this.cfg.interrupt_action[1]:-1,this.move2TargetDT=null!=this.cfg.move2target_delay?this.cfg.move2target_delay:-1,this.cfg.playTimes&&(this.playTimes=this.cfg.playTimes[0],this.playDelay=this.cfg.playTimes[1]);var n=this;if(this.cfg.effect_1&&Array.isArray(this.cfg.effect_1))
for(var e=E("EffectsManager"),t=0;t<this.cfg.effect_1.length;t++){var a=this.cfg.effect_1[t],i=e.createEffect();i.id=a[0],i.delayTime=a[1],i.direction=this.origin.getOrient(),i.callback=function(e,t,a){return n.damage(e,t,a)},i.target=this.origin,i.setFSM(),this.effects.push(i)}
this.addTargetsEffects(),setTimeout(function(){n.doEvent("Active")},10)},onafterEnd:function(){},onenterDisplay:function(){this.node=new cc.Node("skill#"+this.cfg.id);var e=E("BattleSceneMgr");if(this.cfg.quality<3){var t="battle/imageTitle/small/"+this.cfg.icon,a="battle/imageTitle/small/"+this.cfg.icon,n=e.getInstance()._raw_assets[t],i=e.getInstance()._raw_assets[a];(o=new cc.Node).addComponent(cc.Sprite).spriteFrame=n,o.parent=this.node,(c=new cc.Node).addComponent(cc.Sprite).spriteFrame=i,c.parent=this.node,o.scale=1.2;var r=cc.sequence(cc.scaleTo(.1,.95),cc.scaleTo(.21,1),cc.scaleTo(.42,1.05),cc.scaleTo(.33,1),cc.removeSelf(),cc.callFunc(function(){this.destroy()},o));o.runAction(r),c.scale=2.4,c.opacity=200;var s=cc.sequence(cc.spawn(cc.scaleTo(.1,1.9),cc.fadeTo(.1,255)),cc.spawn(cc.scaleTo(.21,2),cc.fadeTo(.21,180)),cc.fadeOut(.42),cc.removeSelf(),cc.callFunc(function(){this.destroy()},c));c.runAction(s)}else{var o;t="battle/imageTitle/big/"+this.cfg.icon,n=e.getInstance()._raw_assets[t];(o=new cc.Node).addComponent(cc.Sprite).spriteFrame=n,o.parent=this.node;var c;r=cc.sequence(cc.spawn(cc.fadeIn(.1),cc.scaleTo(.15,.95).easing(cc.easeOut(.3))),cc.spawn(cc.scaleTo(.85,1.05),cc.tintTo(.85,255,255,255)),cc.spawn(cc.scaleTo(.35,1),cc.fadeOut(.35)),cc.removeSelf(),cc.callFunc(function(){this.destroy()},o));o.opacity=0,o.scale=4.5,o.runAction(r),(c=new cc.Node).addComponent(cc.Sprite).spriteFrame=n,c.parent=this.node;s=cc.sequence(cc.spawn(cc.scaleTo(.14,.85),cc.tintTo(.14,255,255,255)),cc.spawn(cc.scaleTo(.22,1.45),cc.fadeOut(.22)),cc.removeSelf(),cc.callFunc(function(){this.destroy()},c));c.runAction(s);var l=new cc.Node;l.addComponent(cc.Sprite).spriteFrame=n,l.parent=this.node;var h=cc.sequence(cc.delayTime(.14),cc.spawn(cc.scaleTo(.14,.85),cc.tintTo(.14,255,255,255)),cc.spawn(cc.scaleTo(.22,1.45),cc.fadeOut(.22)),cc.removeSelf(),cc.callFunc(function(){this.destroy()},l));l.runAction(h),this.origin.setLocalZOrder(k._BTL_ZORDER.BF_BIGSK+1);var d=[],_=this,u=E("SkillsManager");if(this.cfg.target_range)
for(var m=0;m<this.targets.length;m++){var p=this.targets[m],f=p.getPosition(),g=f.x,y=f.y;g-=y/2;for(var v=u.getRangeRect(g,y,this.cfg.target_range,p.getOrient()),M=u.getImpactArmies(this),S=0;S<M.length;S++){var C=M[S];if(C.isSearchAble()){var D,I;if(C.hero&&"Dead"!=C.hero.getState()){var b=C.hero.getPosition();D=b.x,D-=(I=b.y)/2,(-1==v||cc.rectContainsPoint(v,cc.p(D,I)))&&(C.hero.setLocalZOrder(k._BTL_ZORDER.BF_BIGSK+1),d.push(C.hero))}
for(var P=0;P<C.soldiers.length;P++){var L=C.soldiers[P];if(L&&"Dead"!=L.getState()){var B=L.getPosition();D=B.x,D-=(I=B.y)/2,(-1==v||cc.rectContainsPoint(v,cc.p(D,I)))&&(L.setLocalZOrder(k._BTL_ZORDER.BF_BIGSK+1),d.push(L))}}}}}
else
for(m=0;m<this.targets.length;m++){this.targets[m].setLocalZOrder(k._BTL_ZORDER.BF_BIGSK+1)}
this.bigSkillCB=function(){var e=_.origin.getPosition().y;_.origin.setLocalZOrder(k._BTL_ZORDER.BF_FIELD-e);for(var t=0;t<d.length;t++){var a=d[t];e=a.getPosition().y;a.setLocalZOrder(k._BTL_ZORDER.BF_FIELD-e)}}}
var w=this.origin.getHeight();this.setPosition(w/2,w),this.setLocalZOrder(k._BTL_ZORDER.U_ABOVE),this.add2Parent(this.origin.node)},onafterCancel:function(){for(var e=0;e<this.effects.length;e++){this.effects[e].doEvent("Cancel")}},onenterComplete:function(){E("SkillsManager").removeSkill(this),null!=this.bigSkillCB&&this.bigSkillCB()},onUpdate:function(e){var t=this.getState(),a=cc.director.getScheduler().getTimeScale();if("Display"==t){if(0<=this.soundDT&&(this.soundDT=this.soundDT-a*e,this.soundDT<0&&h.playBattleSkillEffect(this.cfg.sound[0])),0<=this.interruptDT&&(this.interruptDT-=a*e,this.interruptDT<0&&this.targets[0].interruptAction("hurt2",this.cfg.interrupt_action[0],this.origin)),0<=this.move2TargetDT&&(this.move2TargetDT-=a*e,this.move2TargetDT<0)){var n=this.targets[0];if(null!=n){var i=n.getPosition(),r=i.x,s=i.y;r+=(this.origin.getUnitSize()+n.getUnitSize())*(r>this.origin.getPosition().x?-1:1),this.origin.setPosition(r,s);var o=i.x>r;this.origin.setFace2ByParam(o)}}
this.cfg.playTimes&&0<this.playTimes&&0<=this.playDelay&&(this.playDelay=this.playDelay-a*e,this.playDelay<0&&(this.playDelay=this.cfg.playTimes[1],this.playTimes=this.playTimes-1,this.addTargetsEffects()));for(var c=!1,l=0;l<this.effects.length;l++){if("Complete"!=this.effects[l].getState()){c=!0;break}}
c||this.doEvent("End")}},pause:function(){},resume:function(){},addTargetsEffects:function(){if(this.cfg.effect_2){var i=this,r=E("EffectsManager"),e=function(e){for(var t=0;t<i.cfg.effect_2.length;t++){var a=i.cfg.effect_2[t],n=r.createEffect();n.id=a[0],n.delayTime=a[1],n.direction=i.origin.getOrient(),n.callback=function(e,t,a){return i.damage(e,t,a)},n.target=e,n.setFSM(),i.effects.push(n)}};if(this.cfg.playTimes)
this.targets[0]&&(this.lastPoint=cc.p(this.targets[0].getPosition())),this.targets[0]?e(this.targets[0]):e(this.lastPoint);else
for(var t=0;t<this.targets.length;t++){e(this.targets[t])}}},addTargetsBuff:function(){if(this.cfg.buffId){for(var e=E("BuffsManager"),t=E("SkillsManager"),a=e.getCfgById(this.cfg.buffId),n=[],i=0;i<this.targets.length;i++){var r=this.targets[i];if(this.cfg.buff_with_target)"Dead"!=r.getState()&&e.isTargetAble(this.origin,r,a.unit_type)&&n.push(r);else if(this.cfg.target_range)
for(var s=r.getPosition(),o=s.x,c=s.y,l=t.getRangeRect(o,c,this.cfg.target_range,this.origin.getOrient()),h=t.getImpactArmies(this),d=0;d<h.length;d++){var _=h[d];if(_.isSearchAble()){_.hero&&"Dead"!=_.hero.getState()&&(-1==l||cc.rectContainsPoint(l,cc.p(_.hero.getPosition())))&&e.isTargetAble(this.origin,_.hero,a.unit_type)&&n.push(_.hero);for(var u=0;u<_.soldiers.length;u++){var m=_.soldiers[u];(-1==l||cc.rectContainsPoint(l,cc.p(m.getPosition())))&&e.isTargetAble(this.origin,m,a.unit_type)&&n.push(m)}}}
else
n.push(r)}
0==this.cfg.buff_target&&(n.length=0,n.push(this.origin));for(i=0;i<n.length;i++){for(r=n[i],d=0;d<r.buffs.length;d++){var p=r.buffs[d];if(p.cfg.buff_type==a.buff_type){p.doEvent("Cancel"),r.buffs.splice(d,1);break}}
var f=e.createBuff();f.id=this.cfg.buffId,f.cfg=a,f.origin=this.origin,f.target=r,f.setFSM(),r.buffs.push(f)}
this._is_add_buff=!0}},damage:function(e,t,a){if(!this.origin||this.origin.isPauseAble){if(this._is_add_buff||this.addTargetsBuff(),null!=this.bigSkillCB&&(this.bigSkillCB(),this.bigSkillCB=null),1==this.cfg.remove_bad_buff)
for(var n=0;n<this.targets.length;n++){var i=this.targets[n];this.removeBadEffect(i)}
else if(1==this.cfg.remove_good_buff)
for(n=0;n<this.targets.length;n++){i=this.targets[n];this.removeGoodEffect(i)}
if(this.cfg.move2target){var r=this.targets[0],s=e,o=t;if(null!=r){var c=r.getPosition();s=c.x,o=c.y;var l=(s+=(this.origin.getUnitSize()+r.getUnitSize())*(s>this.origin.getPosition().x?-1:1))-o/2,h=cc.p(l,o),d=cc.pDistance(h,this.origin.getPosition())/2.5;this.origin.node.runAction(cc.sequence(cc.jumpTo(.15,h,d,1),cc.callFunc(function(){this.origin.setPosition(s,o),this.cfg.target_range?this.rangeDamage(s,o,a):this.singleDamage()},this)))}else
this.cfg.target_range?this.rangeDamage(s,o,a):this.singleDamage()}else if(this.cfg.switch_target){var _=this.targets[0];if(null!=_){var u=(c=_.getPosition()).x,m=c.y,p=this.origin.getPosition(),f=p.x,g=p.y;this.origin.setPosition(u,m),_.setPosition(f,g)}
this.cfg.target_range?this.rangeDamage(e,t,a):this.singleDamage()}else if(1==this.cfg.far_attack){var y=E("ArrowsManager").createArrow();y.id=this.origin.cfg.arrow,y.from=this.origin;var v=parseInt(Math.random()*this.targets.length);v=v>=this.targets.length?this.targets.length-1:v,y.to=this.targets[v],y.setFSM()}else
this.cfg.target_range?this.rangeDamage(e,t,a):this.singleDamage()}},rangeDamage:function(e,t,a){var n=E("SkillsManager");e-=t/2;var i=n.getRangeRect(e,t,this.cfg.target_range,null!=a?a:this.origin.getOrient()),r=n.getImpactArmies(this),s=0,o=0,c=0;if(null!=this.cfg.rate&&null!=this.cfg.rate.unit_num_dmg_coef){for(var l=0;l<r.length;l++){if((d=r[l]).isSearchAble()){if(d.hero&&"Dead"!=d.hero.getState())
_=(m=d.hero.getPosition()).x,_-=(u=m.y)/2,(-1==i||cc.rectContainsPoint(i,cc.p(_,u)))&&o++;for(var h=0;h<d.soldiers.length;h++){if((C=d.soldiers[h])&&"Dead"!=C.getState())
_=(v=C.getPosition()).x,_-=(u=v.y)/2,(-1==i||cc.rectContainsPoint(i,cc.p(_,u)))&&o++}}}
o>this.cfg.rate.unit_num_dmg_coef[0]&&(o>this.cfg.rate.unit_num_dmg_coef[1]&&(o=this.cfg.rate.unit_num_dmg_coef[1]),c=(o-this.cfg.rate.unit_num_dmg_coef[0])/(this.cfg.rate.unit_num_dmg_coef[1]-this.cfg.rate.unit_num_dmg_coef[0])*this.cfg.rate.unit_num_dmg_coef[2])}
for(l=0;l<r.length;l++){var d;if((d=r[l]).isSearchAble()){var _,u,m;if(d.hero&&"Dead"!=d.hero.getState())
if(_=(m=d.hero.getPosition()).x,_-=(u=m.y)/2,-1==i||cc.rectContainsPoint(i,cc.p(_,u))){var p=0;if(null!=this.cfg.rate.hp_dmg_coef){var f=d.hero.hp/d.hero.basehp;p+=(1-(f=1<=(f=f<=0?0:f)?1:f))*this.cfg.rate.hp_dmg_coef}
if(null!=this.origin.cfg.hp_perc_dmg){var g=this.origin.hp/this.origin.basehp;p+=(1-(g=1<=(g=g<=0?0:g)?1:g))*this.origin.cfg.hp_perc_dmg}
null!=this.cfg.rate.no_buff_dmg_coef&&(this.hasGoodEffect(d.hero)||(p+=this.cfg.rate.no_buff_dmg_coef)),null!=this.cfg.rate&&null!=this.cfg.rate.unit_num_dmg_coef&&(p+=c),s+=d.hero.skillDamage(this.origin,this.cfg,p),0<this.cfg.is_interrupt&&d.hero.interruptAction("hurt2",this.cfg.is_interrupt,this.origin)}
var y=[];for(h=0;h<d.soldiers.length;h++){var v;if((C=d.soldiers[h])&&"Dead"!=C.getState())
_=(v=C.getPosition()).x,_-=(u=v.y)/2,(-1==i||cc.rectContainsPoint(i,cc.p(_,u)))&&y.push(C)}
var M=null!=this.cfg.rate&&null!=this.cfg.rate.unit_dmg_coef?1+this.cfg.rate.unit_dmg_coef:0;if(null!=this.origin.cfg.hp_perc_dmg){var S=this.origin.hp/this.origin.basehp;M+=(1-(S=1<=(S=S<=0?0:S)?1:S))*this.origin.cfg.hp_perc_dmg}
null!=this.cfg.rate&&null!=this.cfg.rate.unit_num_dmg_coef&&(M+=c);for(h=0;h<y.length;h++){var C;(C=y[h]).skillDamage(this.origin,this.cfg,M),0<this.cfg.is_interrupt&&C.interruptAction("hurt2",this.cfg.is_interrupt,this.origin)}}}
if(null!=this.cfg.rate.blood_get&&0<this.cfg.rate.blood_get&&0<s){var D=this.cfg.rate.blood_get*s;this.origin.increaseHP(D)}},singleDamage:function(){for(var e=0,t=0;t<this.targets.length;t++){var a=this.targets[t];if(a&&"Dead"!=a.getState()){var n=0;if(null!=this.cfg.rate.hp_dmg_coef){var i=a.hp/a.basehp;n+=(1-(i=1<=(i=i<=0?0:i)?1:i))*this.cfg.rate.hp_dmg_coef}
if(null!=this.origin.cfg.hp_perc_dmg){var r=this.origin.hp/this.origin.basehp;n+=(1-(r=1<=(r=r<=0?0:r)?1:r))*this.origin.cfg.hp_perc_dmg}
null!=this.cfg.rate.no_buff_dmg_coef&&(this.hasGoodEffect(a)||(n+=this.cfg.rate.no_buff_dmg_coef));var s=a.skillDamage(this.origin,this.cfg,n);0<this.cfg.is_interrupt&&a.interruptAction("hurt2",this.cfg.is_interrupt,this.origin),"Hero"==a.class&&(e+=s)}}
if(null!=this.cfg.rate.blood_get&&0<this.cfg.rate.blood_get&&0<e){var o=this.cfg.rate.blood_get*e;this.origin.increaseHP(o)}},removeBadEffect:function(e){for(var t=e.buffs.length-1;0<=t;t--){var a=e.buffs[t];(11==a.cfg.buff_type||100==a.cfg.buff_type||101==a.cfg.buff_type||a.cfg.atk<0||a.cfg.def<0||a.cfg.speedup<0||a.cfg.dodge<0||a.cfg.crit<0||a.cfg.critD<0||null!=a.cfg.hp&&a.cfg.hp[0]<0||null!=a.cfg.anger&&a.cfg.anger<0)&&(a.doEvent("Cancel"),e.buffs.splice(t,1))}},removeGoodEffect:function(e){for(var t=e.buffs.length-1;0<=t;t--){var a=e.buffs[t];(0<a.cfg.atk||0<a.cfg.def||0<a.cfg.speedup||0<a.cfg.dodge||0<a.cfg.crit||0<a.cfg.critD||null!=a.cfg.hp&&0<a.cfg.hp[0]||null!=a.cfg.anger&&0<a.cfg.anger)&&(a.doEvent("Cancel"),e.buffs.splice(t,1))}},hasGoodEffect:function(e){for(var t=e.buffs.length-1;0<=t;t--){var a=e.buffs[t];if(0<a.cfg.atk||0<a.cfg.def||0<a.cfg.speedup||0<a.cfg.dodge||0<a.cfg.crit||0<a.cfg.critD||null!=a.cfg.hp&&0<a.cfg.hp[0]||null!=a.cfg.anger&&0<a.cfg.anger){!0;break}}}});e.exports=n,cc._RF.pop()},{ArrowsManager:"ArrowsManager",BattleConstants:"BattleConstants",BattleSceneMgr:"BattleSceneMgr",BuffsManager:"BuffsManager",EffectsManager:"EffectsManager",SkillsManager:"SkillsManager",SoundUtil:"SoundUtil",WActor:"WActor","state-machine":"state-machine"}],SmallTipsWidget:[function(e,t,a){"use strict";cc._RF.push(t,"9f6dc1sWH1Fe6NpSDtLPtf5","SmallTipsWidget");cc.Class({extends:cc.Component,properties:{m_pValue:cc.Label},SetInfo:function(e,t){switch(this.m_pValue.string=t,e){case 1:this.m_pValue.node.color=cc.Color.GREEN;break;case 2:this.m_pValue.node.color=cc.Color.WHITE}
this.node.runAction(cc.sequence(cc.moveBy(.3,cc.p(410,0)).easing(cc.easeCubicActionOut()),cc.delayTime(1),cc.moveBy(.3,cc.p(0,70)),cc.spawn(cc.scaleTo(.2,.7),cc.fadeTo(.2,150)),cc.callFunc(function(e){e.destroy()})))},onLoad:function(){}});cc._RF.pop()},{}],SmelterMain:[function(e,t,a){"use strict";cc._RF.push(t,"91943hmJVtHqZ1GZ5iP4ytp","SmelterMain");var l=e("SoundUtil"),i=e("ColorUtil"),r=e("MyProtocols"),n=e("NetEvent"),s=e("MyEventDispatcher"),o=e("i18n"),c=e("EquipBufferMgr"),h=e("TreasureBufferMgr"),d=cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pRightItemPrefab:cc.Prefab,m_pRightContent:cc.Node,m_pItemBoxPrefab:cc.Prefab,m_pLeftContent:cc.Node,m_pItemLight:cc.SpriteFrame,m_pTipsSprFrame:cc.SpriteFrame,m_pTipsFont:cc.Font,m_pRewardPanel:cc.Prefab,m_pDescribe:cc.Label,m_pEffectPrefab:cc.Prefab,m_pDragonSprite:cc.Sprite,m_pDragon2:cc.SpriteFrame,m_pDragon3Sprite:cc.Sprite,m_pSwitchBtn:[cc.Button],m_pBtnSpriteFrame:[cc.SpriteFrame],m_pTipPrefab:cc.Prefab,_leftItemPos:[],_leftItemList:[],_heroList:[],_treList:[],_rightItemScript:[],_idSet:null,_pageState:0},statics:{instance:null,getInstance:function(){return d.instance}},onLoad:function(){(d.instance=this)._leftItemPos=[cc.v2(-244,200),cc.v2(-54,16),cc.v2(-132,-187),cc.v2(-367,-187),cc.v2(-440,16)],this.S2CForge_auth_cb_func=this.Forge_auth_cb.bind(this),s.addListener(n.S2CForge,this.S2CForge_auth_cb_func),this._idSet=new Set,this.myPool=new cc.NodePool("MyTemplateHandler")},onDestroy:function(){s.removeListener(n.S2CForge,this.S2CForge_auth_cb_func),this._idSet.clear(),this.myPool.clear(),this._leftItemPos=[],this._leftItemList=[],this._heroList=[],this._treList=[],this._rightItemScript=[],d.instance=null},setParams:function(e){this.closeCb=e.closeCb,this.ScaleToLarge(),this.Init()},Init:function(){this.m_pDragon3Sprite.node.runAction(cc.repeatForever(cc.sequence(cc.fadeTo(1,255),cc.fadeTo(1,153)))),this.m_pSwitchBtn[this._pageState].normalSprite=this.m_pBtnSpriteFrame[1],this.m_pSwitchBtn[this._pageState].enabled=!1,this.m_pDescribe.string=o.t("smelterlayer_001"),this.SetHeroList(),this.SetWrapItem(this._heroList),this.SetHeroLeftItem()},Forge_auth_cb:function(e){for(var t=[],a=0;a<e.gain.length;++a)
t.push({itemId:e.gain[a].item_template_id,cnt:e.gain[a].item_count});var n=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(n),n.getComponent("GetRewardPanel")._itemlist=t,this._idSet.clear(),0==this._pageState?(this.SetHeroList(),this.SetWrapItem(this._heroList),this.SetHeroLeftItem()):1==this._pageState?(this.SetTreList(),this.SetWrapItem(this._treList),this.SetTreLeftItem()):2==this._pageState&&(this.SetEquipList(),this.SetWrapItem(this._equipList),this.SetTreLeftItem())},SetHeroList:function(){this._heroList=MyPersistDataManager._playerData.cardslist.concat();var e=MyPersistDataManager._playerData.formation;if(null!=e)
for(var t=this._heroList.length-1;0<=t;t--)
0<e.a&&this._heroList[t].template_id==e.a?this._heroList.splice(t,1):0<e.b&&this._heroList[t].template_id==e.b?this._heroList.splice(t,1):0<e.c&&this._heroList[t].template_id==e.c?this._heroList.splice(t,1):0<e.d&&this._heroList[t].template_id==e.d?this._heroList.splice(t,1):0<e.e&&this._heroList[t].template_id==e.e?this._heroList.splice(t,1):0<e.f&&this._heroList[t].template_id==e.f?this._heroList.splice(t,1):0<e.g&&this._heroList[t].template_id==e.g?this._heroList.splice(t,1):0<e.h&&this._heroList[t].template_id==e.h?this._heroList.splice(t,1):0<e.i&&this._heroList[t].template_id==e.i?this._heroList.splice(t,1):0<e.j&&this._heroList[t].template_id==e.j&&this._heroList.splice(t,1);var a=MyPersistDataManager._playerData.pvpformation;if(null!=a)
for(t=this._heroList.length-1;0<=t;t--)
0<a.a&&this._heroList[t].template_id==a.a?this._heroList.splice(t,1):0<a.b&&this._heroList[t].template_id==a.b?this._heroList.splice(t,1):0<a.c&&this._heroList[t].template_id==a.c?this._heroList.splice(t,1):0<a.d&&this._heroList[t].template_id==a.d?this._heroList.splice(t,1):0<a.e&&this._heroList[t].template_id==a.e?this._heroList.splice(t,1):0<a.f&&this._heroList[t].template_id==a.f?this._heroList.splice(t,1):0<a.g&&this._heroList[t].template_id==a.g?this._heroList.splice(t,1):0<a.h&&this._heroList[t].template_id==a.h?this._heroList.splice(t,1):0<a.i&&this._heroList[t].template_id==a.i?this._heroList.splice(t,1):0<a.j&&this._heroList[t].template_id==a.j&&this._heroList.splice(t,1);this._heroList.sort(function(e,t){var a=e.template_id,n=t.template_id,i=DonotDestroyManager.GameData.Cards[a].quality,r=DonotDestroyManager.GameData.Cards[n].quality;return i!=r?r-i:e.level!=t.level?t.level-e.level:e.num!=t.num?t.num-e.num:void 0})},SetTreList:function(){this._treList=[];for(var e=h.getInstance().getList(),t=0;t<e.length;++t)
null!=DonotDestroyManager.GameData.Treasures[e[t].template_id]&&2<=DonotDestroyManager.GameData.Treasures[e[t].template_id].quality&&null==e[t].heroid&&3099!=e[t].template_id&&3199!=e[t].template_id&&3098!=e[t].template_id&&3198!=e[t].template_id&&this._treList.push(e[t]);this._treList.sort(function(e,t){var a=e.template_id,n=t.template_id,i=e.enhance_level,r=t.enhance_level,s=e.stars,o=t.stars;return DonotDestroyManager.GameData.Treasures[a].quality!=DonotDestroyManager.GameData.Treasures[n].quality?DonotDestroyManager.GameData.Treasures[n].quality-DonotDestroyManager.GameData.Treasures[a].quality:i!=r?r-i:s!=o?o-s:n-a})},SetEquipList:function(){this._equipList=[];for(var e=c.getInstance().getEquipAll(),t=0;t<e.length;++t){var a=e[t];null==a.heroid&&this._equipList.push(a)}
this._equipList.sort(function(e,t){var a=e.template_id,n=t.template_id,i=e.enhance_level,r=t.enhance_level;return DonotDestroyManager.GameData.Equips[a].quality!=DonotDestroyManager.GameData.Equips[n].quality?DonotDestroyManager.GameData.Equips[n].quality-DonotDestroyManager.GameData.Equips[a].quality:i!=r?r-i:n-a})},SetWrapItem:function(e){var t=e.length%4==0?e.length/4:Math.floor(e.length/4+1);this.m_pRightContent.getComponent("UIWarp").initContent(t)},SetHeroLeftItem:function(){if(0==this._leftItemList.length)
for(var e=0;e<5;++e){var t=this.myPool.get();null==t&&(t=cc.instantiate(this.m_pItemBoxPrefab));var a=t.getComponent("ItemBox");this._leftItemList.push(a),a.SetEmptyItem(),this.m_pLeftContent.addChild(t),t.setPosition(this._leftItemPos[e])}
else
for(e=0;e<5;++e){var n=this._leftItemList[e].node.getChildByName("Name");null!=n&&(n.removeFromParent(),n.destroy()),this._leftItemList[e].SetEmptyItem()}},SetTreLeftItem:function(){if(0==this._leftItemList.length){var e=this.myPool.get();null==e&&(e=cc.instantiate(this.m_pItemBoxPrefab));var t=e.getComponent("ItemBox");this._leftItemList.push(t),t.SetEmptyItem(),this.m_pLeftContent.addChild(e),e.setPosition(-246,25)}else{var a=this._leftItemList[0].node.getChildByName("Name");null!=a&&(a.removeFromParent(),a.destroy()),this._leftItemList[0].SetEmptyItem()}},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Back_onClickHandler:function(){l.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},BlackShop_OnClickHandler:function(e,t){l.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.BlackShop,"")},StartSmelt_OnClickHandler:function(e,t){if(this.JudgeLeftHave()){for(var a=[],n=this.Judgenlength(),i=[],r=[],s=0;s<n;s++)
if(0<this._leftItemList[s]._itemId)
if(0==this._pageState)
a.push({cardTemplateId:this._leftItemList[s]._itemId,treasure_uuid:"",count:1}),3==this._leftItemList[s]._itemjsoninfo.quality?i.push(this._leftItemList[s]._itemjsoninfo):2==this._leftItemList[s]._itemjsoninfo.quality&&r.push(this._leftItemList[s]._itemjsoninfo);else if(1==this._pageState||2==this._pageState){l.playBtnOpenEffect(),a.push({cardTemplateId:0,treasure_uuid:this._leftItemList[s]._uuid,count:1}),3==this._leftItemList[s]._itemjsoninfo.quality&&i.push(this._leftItemList[s]._itemjsoninfo);var o=(c=cc.instantiate(this.m_pTipPrefab)).getComponent("SmelterTips");cc.Canvas.instance.node.addChild(c),o.changeData(i,r,a)}
if(0==this._pageState)
if(0<i.length||0<r.length){l.playBtnOpenEffect();var c;o=(c=cc.instantiate(this.m_pTipPrefab)).getComponent("SmelterTips");cc.Canvas.instance.node.addChild(c),o.changeData(i,r,a)}else
l.playSmelterHeroEffect(),this.RunSmelterItemAction(),this.RunSmeltingAction(a)}else
this.CreatTips(this._pageState+2)},RunSmelterItemAction:function(){for(var e=0;e<this._leftItemList.length;++e)
if(0<this._leftItemList[e]._itemId){var t=this._leftItemList[e].node;if(null==t.getComponent("SmelterBoom")){var a=cc.instantiate(this.m_pEffectPrefab);t.addChild(a),t.runAction(cc.sequence(cc.delayTime(.3),cc.callFunc(function(){var e=this.node.getChildByName("Name");null!=e&&(e.removeFromParent(),e.destroy()),this.SetEmptyItem()},this._leftItemList[e])))}}},RunSmeltingAction:function(e){var t=this,a=new cc.Node,n=a.addComponent(cc.Sprite);this.m_pDragonSprite.node.addChild(a),a.setScale(2,2),a.setContentSize(264,297),a.setPosition(-13,33),n.spriteFrame=this.m_pDragon2,a.runAction(cc.speed(cc.sequence(cc.fadeTo(.15,255),cc.delayTime(.3),cc.fadeTo(.65,153),cc.fadeTo(.05,255),cc.fadeTo(.65,204),cc.fadeTo(.35,0),cc.delayTime(.5),cc.callFunc(function(){a.destroy(),0==t._pageState?r.send_C2SForge(DonotDestroyManager._gameSocket,e,null,null):1==t._pageState?r.send_C2SForge(DonotDestroyManager._gameSocket,null,e,null):2==t._pageState&&r.send_C2SForge(DonotDestroyManager._gameSocket,null,null,e)})),2))},RightItemClickHandler:function(e,t){var a=e.getComponent("ItemBox");this.JudgeLeftEmpty()||a._isselect||0==this._pageState&&this.CreatTips(this._pageState);for(var n=this.Judgenlength(),i=0;i<n;++i){if(!a._isselect&&0==this._leftItemList[i]._itemId||1==this._pageState||2==this._pageState){if(0==this._pageState)
this._rightItemScript.length<5&&i>=this._rightItemScript.length?this._rightItemScript.push(a):i<this._rightItemScript.length&&(this._rightItemScript[i]=a);else if(1==this._pageState||2==this._pageState)
if(0==this._rightItemScript.length)
this._rightItemScript.push(a);else if(null==this._rightItemScript[i])
this._rightItemScript[i]=a;else if(0<this._rightItemScript[i]._itemId){if(null!=(s=this._leftItemList[i].node.getChildByName("Name"))&&(s.removeFromParent(),s.destroy()),this._leftItemList[i].SetEmptyItem(),this._idSet.delete(this._rightItemScript[i]._itemId),this._rightItemScript[0]._isselect&&null!=this._rightItemScript[0].m_pSelect&&this._rightItemScript[0].SetSelect(!1,2),this._rightItemScript[i]==a)
return void(this._rightItemScript[i]=null);this._rightItemScript[i]=a}
var r=this.LeftItemCancelHandler.bind(this);this._leftItemList[i].ChangeItemInfo(t.id,t.num,!1,r,!1),this._leftItemList[i]._uuid=a._uuid,this.SetLeftItemName(this._leftItemList[i]),this.ItemClickEffect(a.node),this._idSet.add(a._itemId),a.SetSelect(!0,2);break}
if(a._isselect&&this._leftItemList[i]._itemId==t.id){var s;null!=(s=this._leftItemList[i].node.getChildByName("Name"))&&(s.removeFromParent(),s.destroy()),this._idSet.delete(this._leftItemList[i]._itemId),a.SetSelect(!1,2),this._rightItemScript[i]=null,this._leftItemList[i].SetEmptyItem();break}}},LeftItemCancelHandler:function(e,t){if(null!=this._rightItemScript)
for(var a=this.Judgenlength()-1;0<=a;a--)
if(null!=this._rightItemScript[a]&&this._leftItemList[a]._itemId==t[0]){var n=this._leftItemList[a].node.getChildByName("Name");null!=n&&(n.removeFromParent(),n.destroy()),this._idSet.delete(this._leftItemList[a]._itemId),this._rightItemScript[a]._itemId==this._leftItemList[a]._itemId&&(this._rightItemScript[a].SetSelect(!1,2),this._rightItemScript[a]=null),this._leftItemList[a].SetEmptyItem();break}},SwitchPage:function(e,t){l.playPageEffect();var a=parseInt(t);this.m_pRightContent.getComponent("UIWarp").initContent(0);for(var n=this.m_pLeftContent.children,i=n.length-1;0<=i;i--){var r=this._leftItemList[i].node.getChildByName("Name");null!=r&&(r.removeFromParent(),r.destroy()),this.myPool.put(n[i])}
switch(this._leftItemList=[],this._rightItemScript=[],this._idSet.clear(),this.m_pSwitchBtn[this._pageState].normalSprite=this.m_pBtnSpriteFrame[0],this.m_pSwitchBtn[this._pageState].enabled=!0,this._pageState=a,this.m_pSwitchBtn[this._pageState].normalSprite=this.m_pBtnSpriteFrame[1],this.m_pSwitchBtn[this._pageState].enabled=!1,a){case 0:this.m_pDescribe.string=o.t("smelterlayer_001"),this.SetHeroList(),this.SetWrapItem(this._heroList),this.SetHeroLeftItem();break;case 1:this.m_pDescribe.string=o.t("smelterlayer_002"),this.SetTreList(),this.SetWrapItem(this._treList),this.SetTreLeftItem();break;case 2:this.m_pDescribe.string=o.t("smelterlayer_010"),this.SetEquipList(),this.SetWrapItem(this._equipList),this.SetTreLeftItem()}},JudgeLeftEmpty:function(){for(var e=this.Judgenlength(),t=0;t<e;++t)
if(0==this._leftItemList[t]._itemId)
return!0;return!1},JudgeLeftHave:function(){for(var e=this.Judgenlength(),t=0;t<e;++t)
if(0<this._leftItemList[t]._itemId)
return!0;return!1},Judgenlength:function(){return 0==this._pageState?5:1==this._pageState||2==this._pageState?1:void 0},SetLeftItemName:function(e){var t=new cc.Node("Name");t.addComponent(cc.Sprite).spriteFrame=this.m_pTipsSprFrame,e.node.addChild(t),t.setContentSize(112,46),t.setPosition(0,-74);var a=new cc.Node,n=a.addComponent(cc.Label);t.addChild(a),a.color=i.getColorByQuality(e._itemjsoninfo.quality),n.string=e._itemjsoninfo.name,n.font=this.m_pTipsFont,n.fontSize=24,n.lineHeight=30},CreatTips:function(e){switch(e){case 0:MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),o.t("smelterlayer_006"));break;case 2:MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),o.t("smelterlayer_007"));break;case 3:MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),o.t("smelterlayer_008"))}},ItemClickEffect:function(e){var t=new cc.Node("Light");t.addComponent(cc.Sprite).spriteFrame=this.m_pItemLight,e.addChild(t),t.opacity=0,t.runAction(cc.sequence(cc.fadeIn(.1),cc.fadeOut(.2),cc.callFunc(function(e){e.destroy()})))}});cc._RF.pop()},{ColorUtil:"ColorUtil",EquipBufferMgr:"EquipBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",SoundUtil:"SoundUtil",TreasureBufferMgr:"TreasureBufferMgr",i18n:"i18n"}],SmelterTips:[function(e,t,a){"use strict";cc._RF.push(t,"6408eGqrwNBbLc0/AEE2A1b","SmelterTips");var s=e("SmelterMain"),o=e("EsMain"),n=e("SoundUtil"),c=e("i18n"),i=e("MyProtocols");cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,tipsText:cc.RichText,_blueStr:"<color=#0fffff>",_purpleStr:"<color=#e800e8>",_colorEnd:"</color>",_smelterlist:null,_pInstanceState:0,_esuuidList:null},onLoad:function(){},changeData:function(e,t,a,n){this.ScaleToLarge(),this._smelterlist=a,this._esuuidList=n,null!=s.getInstance()?this._pInstanceState=0:null!=o.getInstance()&&(this._pInstanceState=1);var i=c.t("smeltertip_001");if(0==this._pInstanceState){if(0==s.getInstance()._pageState){if(0<e.length){i+=c.t("smeltertip_002",{color:this._purpleStr});for(var r=0;r<e.length;++r)
i+="【"+e[r].name+"】";i+=this._colorEnd}
if(0<t.length){0<e.length&&(i+="，"),i+=c.t("smeltertip_003",{color:this._blueStr});for(r=0;r<t.length;++r)
i+="【"+t[r].name+"】";i+=this._colorEnd}
i+=c.t("smeltertip_004")}else if(1==s.getInstance()._pageState){if(0<e.length){i+=c.t("smeltertip_005",{color:this._purpleStr});for(r=0;r<e.length;++r)
i+="【"+e[r].name+"】";i+=this._colorEnd}
i+=c.t("smeltertip_006")}else if(2==s.getInstance()._pageState){if(0<e.length){i+=c.t("smeltertip_010",{color:this._purpleStr});for(r=0;r<e.length;++r)
i+="【"+e[r].name+"】";i+=this._colorEnd}
i+=c.t("smeltertip_011")}}else
1==this._pInstanceState&&(0<e.length&&(i+=this._purpleStr,i+=c.t("smeltertip_008"),i+=this._colorEnd),i+=c.t("smeltertip_009"));this.tipsText.string=i},Smelting_onClickHandler:function(){0==this._pInstanceState&&(s.getInstance().RunSmelterItemAction(),s.getInstance().RunSmeltingAction(this._smelterlist),n.playSmelterHeroEffect()),1==this._pInstanceState&&null!=this._esuuidList&&(n.playSmelterEquipEffect(),i.send_C2SEquipCompose(DonotDestroyManager._gameSocket,this._esuuidList)),this.node.removeFromParent(),this.node.destroy()},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Back_onClickHandler:function(){n.playBtnCloseEffect(),this.node.removeFromParent(),this.node.destroy()}}),cc._RF.pop()},{EsMain:"EsMain",MyProtocols:"MyProtocols",SmelterMain:"SmelterMain",SoundUtil:"SoundUtil",i18n:"i18n"}],SmelterWrapItem:[function(e,t,a){"use strict";cc._RF.push(t,"8dfd1svVSdJLYolX5MzuVPi","SmelterWrapItem");var c=e("SmelterMain");cc.Class({extends:cc.Component,properties:{m_pItemBoxPrefab:cc.Prefab,index:0,_itemScriptList:[]},onLoad:function(){},onDestroy:function(){this._itemScriptList=[]},changeData:function(){var e=-1,t=[];0==c.getInstance()._pageState?t=c.getInstance()._heroList:1==c.getInstance()._pageState?t=c.getInstance()._treList:2==c.getInstance()._pageState&&(t=c.getInstance()._equipList);for(var a=0;a<4;a++){var n=t[e=4*this.index+a],i=c.getInstance()._idSet;if(a<this._itemScriptList.length)
if(e<t.length){this._itemScriptList[a].node.active=!0;var r=c.getInstance(),s=r.RightItemClickHandler.bind(r);if(0==r._pageState)
this._itemScriptList[a].ChangeHeroInfo(n.template_id,n.num,n.level,!0,s,!0);else if(1==r._pageState){var o={template_id:n.template_id,level:n.enhance_level,uuid:n.uuid,pos:5,cb:s,showlv:!0,showlvbg:!0};this._itemScriptList[a].ChangeEquipInfo(o)}
i.has(n.template_id)&&this._itemScriptList[a].SetSelect(!0,2)}else
this._itemScriptList[a].node.active=!1;else
e<t.length&&this.SetItemBox(n)}},SetItemBox:function(e){var t=c.getInstance(),a=cc.instantiate(this.m_pItemBoxPrefab),n=a.getComponent("ItemBox");this._itemScriptList.push(n);var i=t.RightItemClickHandler.bind(t);if(0==t._pageState)
n.ChangeHeroInfo(e.template_id,e.num,e.level,!0,i,!0);else if(1==t._pageState||2==t._pageState){var r={template_id:e.template_id,level:e.enhance_level,uuid:e.uuid,pos:5,cb:i,showlv:!0,showlvbg:!0};n.ChangeEquipInfo(r)}
this.node.addChild(a)}}),cc._RF.pop()},{SmelterMain:"SmelterMain"}],SnatchAutoCell:[function(e,t,a){"use strict";cc._RF.push(t,"4a4854UyvBLpKcT6CwjJ874","SnatchAutoCell");var n=e("ColorUtil"),i=e("ItemBufferMgr"),s=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_protatelight:cc.Prefab,m_prolllight:cc.Prefab,m_pNum:cc.Label,m_pExp:cc.Label,m_pStamina:cc.Label,m_pMoney:cc.Label,m_preward:cc.Label,m_pFragName:cc.Label,m_pHasContent:cc.Node,m_pNoContent:cc.Node,m_pHasfrag:cc.Node,m_pNofrag:cc.Node,_buffer:null,_status:-1,_index:-1},onLoad:function(){},ChangeData:function(e){this._buffer=e.info,this._status=e.status,this._fragid=e.fragid,this._cb=e.cb,this._index=e.index,this.Init()},Init:function(){if(null!=this._buffer){this.m_pHasContent.active=!1,this.m_pNoContent.active=!0;var e=DonotDestroyManager.GameData.TreasureRob,t=i.GetItemCfgById(this._buffer.item_template_id);this.m_pStamina.string="-"+e.stamina_cost,this.m_pExp.string=e.drops[0].slot[0].exp,this.m_pMoney.string=e.drops[0].slot[0].gamemoney_coef*MyPersistDataManager._playerData.level,this.m_preward.string=t.name+"x"+this._buffer.item_count,this.m_preward.node.color=n.getColorByQuality(t.quality),this.m_pNum.string=this._index+1}else{if(this.m_pHasContent.active=!0,this.m_pNoContent.active=!1,0==this._status)
this.m_pNofrag.active=!0,this.m_pHasfrag.active=!1;else{this.m_pNofrag.active=!1,this.m_pHasfrag.active=!0;var a=DonotDestroyManager.GameData.TreasureFrags[this._fragid];this.m_pFragName.string=a.name,this.m_pFragName.node.color=n.getColorByQuality(a.quality)}
this.RunAction()}},RunAction:function(){var e=this,t=cc.callFunc(function(){null!=e._cb&&e._cb()});if(1==this._status){var a=cc.instantiate(this.m_prolllight);this.m_pHasfrag.addChild(a),a.setPosition(0,0),(n=a.getComponent(dragonBones.ArmatureDisplay)).armature().animation.fadeIn("action1",-1,1,0,"normal"),n.addEventListener(dragonBones.EventObject.COMPLETE,function(){a.destroy()},this);var n,i=cc.instantiate(this.m_protatelight);this.m_pHasfrag.addChild(i),i.setPosition(0,0),(n=i.getComponent(dragonBones.ArmatureDisplay)).armature().animation.fadeIn("action1",-1,1,0,"normal"),n.addEventListener(dragonBones.EventObject.COMPLETE,function(){i.destroy()},this);var r=cc.sequence(cc.scaleTo(0,.8),cc.scaleTo(.1,1.2),cc.scaleTo(.1,.95),cc.scaleTo(.2,1),t);this.m_pHasfrag.runAction(r),s.playGainGoodsEffectNew()}else{r=cc.sequence(cc.scaleTo(0,.8),cc.scaleTo(.1,1.2),cc.scaleTo(.1,.95),cc.scaleTo(.2,1),t);this.m_pNofrag.runAction(r)}}}),cc._RF.pop()},{ColorUtil:"ColorUtil",ItemBufferMgr:"ItemBufferMgr",SoundUtil:"SoundUtil"}],SnatchAutoLayer:[function(e,t,a){"use strict";cc._RF.push(t,"bde96EEXTJI+JTOEh1FQ4eM","SnatchAutoLayer");var n=e("MyProtocols"),i=e("NetEvent"),r=e("MyEventDispatcher"),s=e("SnatchBufferMgr"),o=(e("ShaderUtil"),e("MyUIEvent")),c=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pStamina:cc.Label,m_pNeedStamina:cc.Label,m_pNormalContent:cc.Node,m_pQdContent:cc.Node,m_pAutoCell:cc.Node,m_pCellParent:cc.Node,m_pScrollView:cc.ScrollView,m_pOneBtn:cc.Button,m_pMoreBtn:cc.Button,_isCompelte:!0,_canrefresh:!1,_fragid:-1,_itemlist:[]},onLoad:function(){this.S2CTreasureAutoRob_cb_func=this.S2CTreasureAutoRob_cb.bind(this),r.addListener(i.S2CTreasureAutoRob,this.S2CTreasureAutoRob_cb_func)},onDestroy:function(){r.removeListener(i.S2CTreasureAutoRob,this.S2CTreasureAutoRob_cb_func)},ChangeData:function(){this._fragid=s.getTreafragTid(),this.Init()},Init:function(){this.InitData()},InitData:function(){this._isCompelte=!0,this.m_pQdContent.active=!1,this.m_pNormalContent.active=!0;var e=DonotDestroyManager.GameData.Common;this.m_pStamina.string=MyPersistDataManager._playerData.stamina+"/"+e.max_stamina,this.m_pOneBtn.interactable=!0,this.m_pMoreBtn.interactable=!0,this._canrefresh=!1},S2CTreasureAutoRob_cb:function(e){cc.log(" tự động cướp đoạt tin tức tiếp thu "),this.m_pQdContent.active=!0;var t=DonotDestroyManager.GameData.Common;this.m_pStamina.string=MyPersistDataManager._playerData.stamina+"/"+t.max_stamina,this.m_pNormalContent.setPosition(0,190),this.m_pQdContent.setPosition(0,-113),this.RefreshQdContent(e),1==e.status&&(this.m_pOneBtn.interactable=!1,this.m_pMoreBtn.interactable=!1,this._canrefresh=!0)},RefreshCompelte:function(){this._isCompelte=!0},RefreshQdContent:function(e){for(var t=e.items.length+1,a=this.RefreshCompelte.bind(this),n=0;n<t;++n){var i={info:null,status:e.status,fragid:this._fragid,cb:a,index:n};n!=e.items.length&&(i={info:e.items[n],status:e.status,fragid:this._fragid,cb:a,index:n}),this.AddAutoCell(n,i)}
for(n=t;n<this._itemlist.length;++n)
this._itemlist[n].node.active=!1},AddAutoCell:function(a,n){var i=this,e=cc.delayTime(.6*a),t=cc.sequence(e,cc.callFunc(function(){var e=null;if(a<i._itemlist.length)
e=i._itemlist[a];else{var t=cc.instantiate(i.m_pAutoCell);i.m_pCellParent.addChild(t),e=t.getComponent("SnatchAutoCell"),i._itemlist.push(e)}
e.node.active=!0,e.ChangeData(n),2<=a&&i.m_pScrollView.scrollToBottom(.1)}));this.node.runAction(t)},One_OnClickHandler:function(e){if(c.playBtnOpenEffect(),this._isCompelte){var t=DonotDestroyManager.GameData.TreasureRob;MyPersistDataManager._playerData.stamina<t.stamina_cost?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không đủ nại lực!Xin đến Tiệm mua Nhân Sâm"):(this._isCompelte=!1,n.send_C2STreasureAutoRob(DonotDestroyManager._gameSocket,this._fragid,1))}},More_OnClickHandler:function(e){if(c.playBtnOpenEffect(),this._isCompelte){var t=DonotDestroyManager.GameData.TreasureRob;if(MyPersistDataManager._playerData.stamina<t.stamina_cost)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không đủ nại lực!Xin đến Tiệm mua Nhân Sâm");else{this._isCompelte=!1;for(var a=0;a<this._itemlist.length;++a)
this._itemlist[a].node.active=!1;n.send_C2STreasureAutoRob(DonotDestroyManager._gameSocket,this._fragid,0)}}},Mask_OnClickHandler:function(e){c.playBtnCloseEffect(),this._canrefresh&&r.dispatchEvent(o.SnatchRefreshView,{}),this.node.destroy()}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",ShaderUtil:"ShaderUtil",SnatchBufferMgr:"SnatchBufferMgr",SoundUtil:"SoundUtil"}],SnatchBattleManager:[function(r,e,t){"use strict";cc._RF.push(e,"a2e38Mwg4ZCEIWc5x3wN+QE","SnatchBattleManager");var s=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=r("TeamDataUtil"),o=r("BattleUtil"),_=r("BattleDataManager"),u=r("HeroConfigMgr"),n=r("MyProtocols"),c=r("ItemCfgUtilMgr"),a=r("EnermyBufferMgr"),l=r("SnatchBufferMgr"),h=r("ArenaCfgMgr"),d=r("GuideBufferMgr"),m=r("BattleManager"),p=function(){this.mEmenyData=null};p.prototype.init=function(e,t,a){var n=DonotDestroyManager.GameData.StageMobs;this.leftData=i.getLeftData(),this.rightData=this.getRightData(e),this.leftData.fightVal=t,this.rightData.fightVal=a,this.background=n[101].battleground,this.mEmenyData=e},p.prototype.enterBattlefield=function(){var e=c.getItemInfoCfgById(this.mTreaTid),t=s(e,2),a=(t[0],t[1]),n=DonotDestroyManager.GameData.TeamSkillsAI,i={background:this.background,teamAiCfg:n[3][this.isRobeter][a.quality-1],type:6},r=this;o.createBattlefield(this.leftData,this.rightData,i,function(){r.onSuccess()},function(){r.onFailure()}),o.enterRealScene()},p.prototype.resetBattlefield=function(){var e=c.getItemInfoCfgById(this.mTreaTid),t=s(e,2),a=(t[0],t[1]),n=DonotDestroyManager.GameData.TeamSkillsAI,i={background:this.background,teamAiCfg:n[3][this.isRobeter][a.quality-1],type:6},r=this;o.createBattlefield(this.leftData,this.rightData,i,function(){r.onSuccess()},function(){r.onFailure()})},p.prototype.setRequestFragId=function(e,t,a){this.mTreaTid=e,this.mHardLevel=t,this.isRobeter=1,a&&(this.isRobeter=0)},p.prototype.onSuccess=function(){var e=l.getbattleindex(),t=d.isFirstSnatch(),a=this.rand_key-MyPersistDataManager._playerData.id;n.send_C2STreasureRobCalculate(DonotDestroyManager._gameSocket,e,1,t,a)},p.prototype.onFailure=function(){var e=l.getbattleindex(),t=this.rand_key-MyPersistDataManager._playerData.id;n.send_C2STreasureRobCalculate(DonotDestroyManager._gameSocket,e,0,0,t)},p.prototype.calculateS2cCb=function(e){if(this.rand_key=e.rand_key,0!=e.result){var t=r("BattleSceneMgr"),a=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/SnatchWinPanel"]);cc.Canvas.instance.node.addChild(a);var n={info:e,leftinfo:this.leftData,rightinfo:this.rightData,staticData:m.statistics};a.getComponent("SnatchWinPanel").ChangeData(n)}else{t=r("BattleSceneMgr");var i=cc.instantiate(t.getInstance()._raw_assets["Prefab/ui/battle/battleFailPanel"]);cc.Canvas.instance.node.addChild(i),i.getComponent("BattleFailMgr").initUi(3,{exp:"+0",gmoney:"+0",stamina:"-"+h.getStaminaCostUnit(),staticData:m.statistics})}},p.prototype.startFightEvent=function(){a.getInstance().initEnermyData(this.mEmenyData)},p.prototype.getRightData=function(n){var e={side:"right"};e.name=n.nickname,e.level=n.level,e.fightVal=n.fight,e.formation=n.formation.formationId,e.forward=n.formation.forward,e.flip=n.formation.flip;for(var t=_.create(e),a=n.formation,i=[a.a,a.b,a.c,a.d,a.e,a.f,a.g,a.h,a.i,a.j],r=function(e){for(var t=Object.keys(n.formation),a=0;a<t.length;++a){if("fid"!=t[a]&&"formationId"!=t[a]&&"forward"!=t[a]&&"flip"!=t[a])
if(e==n.formation[t[a]])
return t[a]}},s=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a]},o=DonotDestroyManager.GameData.Common,c=0;c<i.length;++c){var l=i[c];if(!o.FIGHT_CONTROL_ENEMY[1]&&0!=l){var h=s(n.cards,l);if(null!=h){var d={hero:{}};d.hero.id=h.template_id,d.hero.heroId=h.template_id,d.hero.level=h.level,d.hero.grade=h.grade,d.unit_level=h.unitLevel,d.unit_grade=h.unitGrade,d.unit_num=u.getHeroUnitNum(d.hero.grade,d.hero.id),t.addHeroWithPosition(d,r(d.hero.id))}}}
return t},e.exports=new p,cc._RF.pop()},{ArenaCfgMgr:"ArenaCfgMgr",BattleDataManager:"BattleDataManager",BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",BattleUtil:"BattleUtil",EnermyBufferMgr:"EnermyBufferMgr",GuideBufferMgr:"GuideBufferMgr",HeroConfigMgr:"HeroConfigMgr",ItemCfgUtilMgr:"ItemCfgUtilMgr",MyProtocols:"MyProtocols",SnatchBufferMgr:"SnatchBufferMgr",TeamDataUtil:"TeamDataUtil"}],SnatchBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"f82d6z2AmhJ34GNSEG05KhU","SnatchBufferMgr");var c=e("TreaFragBufferMgr"),l=e("TreasureFragsCfgMgr"),h=e("TreasuresCfgMgr"),n=function(){this.DEFAULT_DISPLAY_TREATURES={5:[3100,3101],6:[3e3,3001]},this.mCurTabIndex=0};n.prototype.getTreaType=function(e){return 0==e?6:5},n.prototype.isContained=function(e,t){for(var a=0;a<e.length;++a)
if(e[a]==t)
return!0;return!1},n.prototype.getTreaInfoList=function(e){var t=this.getTreaType(e),a=[];this.mTreaInfoList=[];var n=c.getTreasureFragIdList(),i=l.getTreasureList(n)||[];i=this.loadDefTreaInfoList(i,t);for(var r=0;r<i.length;++r){var s=i[r],o=h.getTreasureById(s);!this.isContained(a,s)&&o&&o.position==t&&(o.template_id=s,this.mTreaInfoList.push(o),a.push(s))}
return this.mTreaInfoList.sort(this.sortFunc),this.mTreaInfoList},n.prototype.sortFunc=function(e,t){if(e.quality!=t.quality)
return e.quality-t.quality},n.prototype.loadDefTreaInfoList=function(a,e){for(var t=function(e){for(var t=0;t<a.length;++t)
if(a[t]==e)
return!0;return!1},n=this.DEFAULT_DISPLAY_TREATURES[e],i=0;i<n.length;++i)
t(n[i])||a.push(n[i]);return a},n.prototype.getTreaFragInfoList=function(e){for(var t=[],a=null,n=0;n<this.mTreaInfoList.length;++n){if((i=this.mTreaInfoList[n]).template_id==e){a=i;break}}
for(n=0;n<a.frags.length;++n){var i=a.frags[n],r=l.getTreasureFragById(i);r.template_id=i,t.push(r)}
return t},n.prototype.savebattleindex=function(e){this._index=e},n.prototype.getbattleindex=function(){return this._index},n.prototype.setTreafragTid=function(e){this._TreaTid=e},n.prototype.getTreafragTid=function(){return this._TreaTid},n.prototype.getCurTabIndex=function(){return this.mCurTabIndex},n.prototype.setCurTabIndex=function(e){this.mCurTabIndex=e},t.exports=new n,cc._RF.pop()},{TreaFragBufferMgr:"TreaFragBufferMgr",TreasureFragsCfgMgr:"TreasureFragsCfgMgr",TreasuresCfgMgr:"TreasuresCfgMgr"}],SnatchFragLayer:[function(e,t,a){"use strict";cc._RF.push(t,"195cf0Nde9HDaOOHAi+1zVD","SnatchFragLayer");var n=e("MyProtocols"),i=e("SnatchBufferMgr"),r=e("ColorUtil"),s=e("SoundUtil"),o=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pItemBox:cc.Prefab,m_pItemParent:cc.Node,m_pName:cc.Label,m_pDes:cc.Label,m_pBtnQd:cc.Node,_iteminfo:null,_itembox:null},onLoad:function(){},ChangeData:function(e){this._iteminfo=e,this.Init()},Init:function(){null==this._itembox&&(this._itembox=cc.instantiate(this.m_pItemBox),this.m_pItemParent.addChild(this._itembox)),this._itembox.getComponent("ItemBox").ChangeItemInfo(this._iteminfo[0],0),this.m_pBtnQd.active=!1,this._iteminfo[1]<=0&&(this.m_pBtnQd.active=!0),this.m_pName.string=this._iteminfo[2].name,this.m_pName.node.color=r.getColorByQuality(this._iteminfo[2].quality),this.m_pDes.string=this._iteminfo[2].des,this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide(this.m_pBtnQd)},this)))},Qd_OnClickHandler:function(e){s.playBtnOpenEffect(),i.setTreafragTid(this._iteminfo[0]);var t=o.isFirstSnatch();n.send_C2STreasureRobList(DonotDestroyManager._gameSocket,this._iteminfo[0],t,0)},Mask_OnClickHandler:function(e){s.playBtnCloseEffect(),this.node.active=!1},showGuide:function(t){o.showGuide("SnatchFragLayer",function(e){if(1==e)
return t})}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GuideBufferMgr:"GuideBufferMgr",MyProtocols:"MyProtocols",SnatchBufferMgr:"SnatchBufferMgr",SoundUtil:"SoundUtil"}],SnatchListLayer:[function(e,t,a){"use strict";cc._RF.push(t,"0776ckayxtCBZveEdnalEej","SnatchListLayer");var n=e("NetEvent"),i=e("MyEventDispatcher"),r=e("SnatchBattleManager"),s=e("SnatchBufferMgr"),o=e("SoundUtil"),c=e("GuideBufferMgr"),l=e("MyUIEvent");cc.Class({extends:cc.Component,properties:{m_pItemCell:cc.Node,m_pItemParent:cc.Node,_enemyinfo:null,_itemlist:[]},onLoad:function(){this.S2CTreasureRobEnemyDetail_cb_func=this.S2CTreasureRobEnemyDetail_cb.bind(this),i.addListener(n.S2CTreasureRobEnemyDetail,this.S2CTreasureRobEnemyDetail_cb_func)},onDestroy:function(){i.removeListener(n.S2CTreasureRobEnemyDetail,this.S2CTreasureRobEnemyDetail_cb_func)},setParams:function(e){this._enemyinfo=e,this.Init()},Init:function(){this.CreateEnemyItems()},S2CTreasureRobEnemyDetail_cb:function(e){cc.log(" địch quân tình hình cụ thể tin tức tiếp thu "),i.dispatchEvent(l.onJumpBattleFormation),this.OpenFormationLayer(e)},OpenFormationLayer:function(e){var t={name:e.nickname+"LV."+e.level,fight:e.fight,formation:e.formation.formationId,flip:e.formation.flip,forward:e.formation.forward,Teams:this.GetEnemyTeams(e),id:0},a=s.getbattleindex(),n=s.getTreafragTid();r.setRequestFragId(n,a),r.init(e),r.startFightEvent(),MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:t,panelinfo:{fid:1},battletype:6})},GetEnemyTeams:function(e){var t=[],a=function(e,t){for(var a=0;a<e.length;++a)
if(e[a].template_id==t)
return e[a].level;return 0};if(0<e.formation.a){var n=a(e.cards,e.formation.a);t.push({id:e.formation.a,level:n,position:"a"})}
if(0<e.formation.b){n=a(e.cards,e.formation.b);t.push({id:e.formation.b,level:n,position:"b"})}
if(0<e.formation.c){n=a(e.cards,e.formation.c);t.push({id:e.formation.c,level:n,position:"c"})}
if(0<e.formation.d){n=a(e.cards,e.formation.d);t.push({id:e.formation.d,level:n,position:"d"})}
if(0<e.formation.e){n=a(e.cards,e.formation.e);t.push({id:e.formation.e,level:n,position:"e"})}
if(0<e.formation.f){n=a(e.cards,e.formation.f);t.push({id:e.formation.f,level:n,position:"f"})}
if(0<e.formation.g){n=a(e.cards,e.formation.g);t.push({id:e.formation.g,level:n,position:"g"})}
if(0<e.formation.h){n=a(e.cards,e.formation.h);t.push({id:e.formation.h,level:n,position:"h"})}
if(0<e.formation.i){n=a(e.cards,e.formation.i);t.push({id:e.formation.i,level:n,position:"i"})}
if(0<e.formation.j){n=a(e.cards,e.formation.j);t.push({id:e.formation.j,level:n,position:"j"})}
return t},CreateEnemyItems:function(){var e=4;1==this._enemyinfo.enemys.length&&(e=this._enemyinfo.enemys.length);for(var t=0;t<e;++t){var a=cc.instantiate(this.m_pItemCell);this.m_pItemParent.addChild(a),a.active=!0;var n=a.getComponent("SnatchQdItemCell");3!=t?n.ChangeData({info:this._enemyinfo.enemys[t],index:t}):n.ChangeData(null),this._itemlist.push(a),0==t&&this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide(a.getComponent("SnatchQdItemCell").m_pNormalBtn)},this)))}},Mask_OnClickHandler:function(e){o.playBtnCloseEffect(),MyUiManager.Back()},showGuide:function(t){c.showGuide("SnatchListLayer",function(e){if(1==e)
return t})}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SnatchBattleManager:"SnatchBattleManager",SnatchBufferMgr:"SnatchBufferMgr",SoundUtil:"SoundUtil"}],SnatchMainLayer:[function(e,t,a){"use strict";cc._RF.push(t,"34adeJ/NNxI17wdqPXN0/ep","SnatchMainLayer");var l=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},d=e("SnatchBufferMgr"),_=(e("TreasureFragsCfgMgr"),e("ShaderUtil")),n=e("TimeUtil"),i=e("NetEvent"),r=e("MyEventDispatcher"),s=e("MyProtocols"),o=e("ResLoaderManager"),h=e("SoundUtil"),c=e("MyUIEvent"),u=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pSnatch:cc.Prefab,m_pItemBox:cc.Prefab,m_pReportLayer:cc.Prefab,m_pBigIcon:cc.Sprite,m_pNameSpr:cc.Sprite,m_pQuality:cc.Sprite,m_pStamina:cc.Label,m_pFragParent:cc.Node,m_pScrollView:cc.ScrollView,m_pRightItemParent:cc.Node,m_pFragsLayer:cc.Node,m_pAvoidDialog:cc.Node,m_pTimeContent:cc.Node,m_pTimeValue:cc.Label,m_pTopArrow:cc.Node,m_pBottomArrow:cc.Node,mBtnCompose:cc.Node,m_pTabMenuNormalList:[cc.Sprite],m_pMenuSprList:[cc.SpriteFrame],m_pQualitySpr:[cc.SpriteFrame],_curSelectTabMenuIndex:-1,_lastSelectTabMunuIndex:-1,_curSelectItemID:-1,_curSelectItemIndex:-1,_lastSelectItemID:-1,_lastSelectItemIndex:-1,_curSelectItemQuality:-1,_defaultitemindex:-1,_mTreaInfoList:[],_rightitemlist:[],_leftitemlist:[],_TargetTimesec:-1,_TimeSec:-1,_counttime:0,_raw_assets:{default:{},type:Object},_canSynthesis:!1,_isCompelte:!0,_guideFragItem:null,_is_init:!1},onLoad:function(){this._is_init=!1,this.LoadRes(),this.FRAG_POSTION={1:[[0,195],[195,0],[0,-195],[-195,0]],2:[[0,195],[195,47],[140,-160],[-140,-160],[-195,47]],3:[[0,195],[190,71],[190,-68],[0,-195],[-190,-68],[-190,71]]},this.FRAG_ANI_POSTION={1:[[0,20],[20,0],[0,-20],[-20,0]],2:[[0,18],[18,18],[18,-18],[-18,-18],[-18,18]],3:[[0,18],[18,18],[18,-18],[0,-18],[-18,-18],[-18,18]]},this.S2CTreasureRobList_cb_func=this.S2CTreasureRobList_cb.bind(this),r.addListener(i.S2CTreasureRobList,this.S2CTreasureRobList_cb_func),this.S2CTreasureFragCompose_cb_func=this.S2CTreasureFragCompose_cb.bind(this),r.addListener(i.S2CTreasureFragCompose,this.S2CTreasureFragCompose_cb_func),this.S2CTreasureRobReport_cb_func=this.S2CTreasureRobReport_cb.bind(this),r.addListener(i.S2CTreasureRobReport,this.S2CTreasureRobReport_cb_func),this.SnatchRefreshView_cb_func=this.refreshleftitemcb.bind(this),r.addListener(c.SnatchRefreshView,this.SnatchRefreshView_cb_func),this.onJumpBattleFormation_cb_func=this.onJumpBattleFormation_cb.bind(this),r.addListener(c.onJumpBattleFormation,this.onJumpBattleFormation_cb_func)},onDestroy:function(){r.removeListener(i.S2CTreasureRobList,this.S2CTreasureRobList_cb_func),r.removeListener(i.S2CTreasureFragCompose,this.S2CTreasureFragCompose_cb_func),r.removeListener(i.S2CTreasureRobReport,this.S2CTreasureRobReport_cb_func),r.removeListener(c.SnatchRefreshView,this.SnatchRefreshView_cb_func),r.removeListener(c.onJumpBattleFormation,this.onJumpBattleFormation_cb_func),this._params=null,this._raw_assets={},this._mTreaInfoList=[],this._rightitemlist=[],this._leftitemlist=[]},LoadRes:function(){this.toLoadResList=[],this.toLoadResList.push(["Prefab/ItemBox/ItemBox",cc.Prefab]),this.toLoadResList.push(["Prefab/HeroDetailsPanel/HeroEquipInfo",cc.Prefab]);var e=this._loadProgressCb.bind(this),t=this._loadFinishCb.bind(this);o.asyncLoadAll(this.toLoadResList,e,t)},_loadProgressCb:function(e){},_loadFinishCb:function(e,t){cc.log("load teamskill resources finish!"),t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this)},setParams:function(e){this._params=e,this._defaultindex=e.defaultindex||d.getCurTabIndex(),this._selectedItemId=e.selectedItemId,this._scrollOffset=e.scrollOffset,this._TargetTimesec=e.timeStamp,this.Init()},Init:function(){this._is_init=!1,this.SetSelectTabMenu(this._defaultindex),this.TabMenuRegisterClickEvent(),this.RefreshTime(this._TargetTimesec),this.RefreshArrow(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this))),this._is_init=!0},onJumpBattleFormation_cb:function(){this._params.scrollOffset=this.m_pScrollView.getScrollOffset()},S2CTreasureRobReport_cb:function(e){if(cc.log(" chiến báo tin tức tiếp thu "),null==e.reports||e.reports.length<=0)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Tạm không có thông báo");else{var t=cc.instantiate(this.m_pReportLayer);cc.Canvas.instance.node.addChild(t),t.getComponent("SnatchReportLayer").ChangeData(e)}},S2CTreasureFragCompose_cb:function(n){cc.log(" hợp thành tin tức tiếp thu ");var i=this;h.playRobTreaEffect(),this.playCompAnimation(function(){h.playRobTreaEffect();var e=MyPersistDataManager._playerData.bagMap[n.treasure_uuid],t=cc.instantiate(i._raw_assets["Prefab/HeroDetailsPanel/HeroEquipInfo"]);cc.Canvas.instance.node.addChild(t);var a={buffer:e,map:i._raw_assets,showbtn:!1,cb:i.refreshleftitemcb.bind(i)};t.getComponent("HeroEquipInfo").ChangeData(a),i._isPlaying=null})},S2CTreasureRobList_cb:function(e){cc.log(" cướp đoạt liệt biểu tin tức tiếp thu "),this.m_pFragsLayer.active=!1,MyUiManager.Open(MyUiManager.PanelInfo.SnatchListLayer,e)},RefreshArrow:function(){this.m_pTopArrow.active=!0,this.m_pBottomArrow.active=!0,0==this._curSelectItemIndex&&(this.m_pTopArrow.active=!1),this._curSelectItemIndex==this._mTreaInfoList.length-1&&(this.m_pBottomArrow.active=!1)},refreshleftitemcb:function(){var e=DonotDestroyManager.GameData.Common;this.m_pStamina.string=MyPersistDataManager._playerData.stamina+"/"+e.max_stamina,this._isCompelte=!0;var t=this.GetRightItemForid(this._curSelectItemID),a=l(t,2),n=a[0],i=(a[1],n._itemjsoninfo);i.template_id=n._itemId,this.UpdateLeftInfo(i);var r=this.GetRightItemCount(i),s=i.frags.length;n.m_pNum.string=r+"/"+s,n.m_pNum.node.color=s<=r?cc.Color.GREEN:cc.Color.WHITE},RefreshTime:function(e){if(e<=0)
this.m_pTimeContent.active=!1;else{this._isTimeRunning=!0,this.m_pTimeContent.active=!0,e*=1e3;var t=(new Date).getTime();this._TimeSec=Math.floor((e-t)/1e3),this.m_pTimeValue.string=n.secondToTime(this._TimeSec)}},updatePage:function(){var e=DonotDestroyManager.GameData.Common;this._mTreaInfoList=d.getTreaInfoList(this._curSelectTabMenuIndex),this.m_pStamina.string=MyPersistDataManager._playerData.stamina+"/"+e.max_stamina,this.UpdateRightItem();var t=0;if(!this._is_init&&null!=this._selectedItemId)
for(var a=0;a<this._rightitemlist.length;++a){var n=this._rightitemlist[a];if(this._selectedItemId==n._itemId){t=a;break}}
var i=this._rightitemlist[t]._itemjsoninfo;i.template_id=this._rightitemlist[t]._itemId,this.UpdateLeftInfo(i),this._rightitemlist[t].SetSelect(!0),this._curSelectItemID=i.template_id,this._curSelectItemIndex=t,this._lastSelectItemIndex=this._curSelectItemIndex,this._lastSelectItemID=this._curSelectItemID,this._is_init||null==this._scrollOffset||this.node.runAction(cc.sequence(cc.delayTime(.02),cc.callFunc(function(){this.m_pScrollView.scrollToOffset(this._scrollOffset)},this)))},UpdateRightItem:function(){for(var e=0;e<this._mTreaInfoList.length;++e){var t=null;if(e<this._rightitemlist.length)
t=this._rightitemlist[e];else{var a=cc.instantiate(this.m_pItemBox);this.m_pRightItemParent.addChild(a),t=a.getComponent("ItemBox"),this._rightitemlist.push(t)}
var n=this.Item_OnClickHandler.bind(this);t.node.active=!0;var i=this.GetRightItemCount(this._mTreaInfoList[e]),r=this._mTreaInfoList[e].frags.length;t.ChangeItemInfo(this._mTreaInfoList[e].template_id,i+"/"+r,!0,n),t.m_pNum.node.color=r<=i?cc.Color.GREEN:cc.Color.WHITE}
for(e=this._mTreaInfoList.length;e<this._rightitemlist.length;++e)
this._rightitemlist[e].node.active=!1},GetRightItemCount:function(e){for(var t=0,a=e.frags,n=0;n<a.length;++n)
null!=MyPersistDataManager._playerData.bagMap[a[n]]&&0<MyPersistDataManager._playerData.bagMap[a[n]].num&&++t;return t},UpdateLeftInfo:function(e){var t="UI/BigTreasures/big_"+e.icon,a="UI/TreasuresTitle/title_"+e.template_id;this.LoadBigIcon(t.replace(".png","")),this.LoadNameIcon(a),this.UpdateLeftFragItem(e),this.m_pQuality.spriteFrame=this.m_pQualitySpr[this._curSelectItemQuality-1],this.runRoationAction(this.m_pQuality.node)},UpdateLeftFragItem:function(e){this._canSynthesis=!0;var t=d.getTreaFragInfoList(e.template_id),a=t.length;this._curFragCount=a;var n=e.quality,i=this.FRAG_POSTION[n];this._curSelectItemQuality=n;for(var r=0;r<a;++r){var s=t[r],o=null;if(r<this._leftitemlist.length)
o=this._leftitemlist[r];else{var c=cc.instantiate(this.m_pItemBox);this.m_pFragParent.addChild(c),o=c.getComponent("ItemBox"),this._leftitemlist.push(o)}
var l=this.LeftItem_OnClickHandler.bind(this);o.node.active=!0,o.node.opacity=255,o.node.setPosition(i[r][0],i[r][1]);var h=this.GetItemCntInBag(s.template_id);o.ChangeItemInfo(s.template_id,h,!0,l,!1),h<=0?(_.setGaryShader(o.node),this._canSynthesis=!1,null==this._guideFragItem&&(this._guideFragItem=o.node)):_.resetShader(o.node)}
for(r=a;r<this._leftitemlist.length;++r)
this._leftitemlist[r].node.active=!1},GetItemCntInBag:function(e){var t=0;return null!=MyPersistDataManager._playerData.bagMap[e]&&(t=MyPersistDataManager._playerData.bagMap[e].num),t},LoadBigIcon:function(e){var a=this;cc.loader.loadRes(e,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),a.m_pBigIcon.spriteFrame=t})},LoadNameIcon:function(e){var a=this;cc.loader.loadRes(e,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),a.m_pNameSpr.spriteFrame=t})},GetRightItemForid:function(e){for(var t=0;t<this._rightitemlist.length;++t)
if(this._rightitemlist[t]._itemId==e)
return[this._rightitemlist[t],t];return null},LeftItem_OnClickHandler:function(e,t){h.playBtnOpenEffect(),this.m_pFragsLayer.active=!0,this.m_pFragsLayer.getComponent("SnatchFragLayer").ChangeData(t)},MianZhan_OnClickHandler:function(e){h.playBtnOpenEffect(),this.m_pAvoidDialog.active=!0,this.m_pAvoidDialog.getComponent("AvoidWarDialog").ChangeData({cb:this.RefreshTime.bind(this)})},Item_OnClickHandler:function(e,t){h.playBtnOpenEffect(),cc.log(" điểm đánh bảo vật "+t[2].name);var a=parseInt(t[0]),n=t[2];if(n.template_id=a,this._curSelectItemID!=a){if(-1!=this._lastSelectItemID){var i=this.GetRightItemForid(this._lastSelectItemID),r=l(i,2),s=r[0];r[1];null!=s&&s.SetSelect(!1)}
this._curSelectItemID=a;var o=this.GetRightItemForid(this._curSelectItemID),c=l(o,2);c[0],this._curSelectItemIndex=c[1],e.getComponent("ItemBox").SetSelect(!0),this._lastSelectItemID=this._curSelectItemID,this._lastSelectItemIndex=this._curSelectItemIndex,this.UpdateLeftInfo(n),this.RefreshArrow(),this._params.selectedItemId=a}},TabMenuRegisterClickEvent:function(){for(var e=0;e<this.m_pTabMenuNormalList.length;++e){var t=new cc.Component.EventHandler;t.target=this.node,t.component="SnatchMainLayer",t.handler="BtnClickHandler",t.customEventData=e.toString(),this.m_pTabMenuNormalList[e].getComponent(cc.Button).clickEvents[0]=t}},Synthesis_OnClickHandler:function(e){h.playBtnOpenEffect(),this._isCompelte&&(this._canSynthesis?(this._isCompelte=!1,s.send_C2STreasureFragCompose(DonotDestroyManager._gameSocket,this._curSelectItemID,1)):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Không đủ mảnh..."))},BtnClickHandler:function(e,t){cc.log(" điểm đánh nhãn :"+t),h.playBtnOpenEffect();var a=parseInt(t);this.SetSelectTabMenu(a),this._curSelectTabMenuIndex=a,this.RefreshArrow()},SetSelectTabMenu:function(e){if(this._curSelectTabMenuIndex!=e){d.setCurTabIndex(e);-1!=this._lastSelectTabMunuIndex&&(this.m_pTabMenuNormalList[this._lastSelectTabMunuIndex].spriteFrame=this.m_pMenuSprList[0]),this._curSelectTabMenuIndex=e,this.m_pTabMenuNormalList[this._curSelectTabMenuIndex].spriteFrame=this.m_pMenuSprList[1],this._lastSelectTabMunuIndex=this._curSelectTabMenuIndex,this.updatePage(),this._is_init&&this.m_pScrollView.scrollToTop(.3)}},runRoationAction:function(e){var t=cc.rotateTo(8,90),a=cc.rotateTo(8,180),n=cc.rotateTo(8,270),i=cc.rotateTo(8,360);e.stopAllActions(),e.rotation=0,e.runAction(cc.repeatForever(cc.sequence(t,a,n,i)))},playCompAnimation:function(a){if(!this._isPlaying){this._isPlaying=!0;for(var n=this,e=this._curFragCount,t=cc.p(0,0),i=this.FRAG_ANI_POSTION[this._curSelectItemQuality],r=!1,s=function(){if(!r){r=!0;var e=cc.instantiate(n.m_pSnatch);n.node.addChild(e);var t=e.getComponent(dragonBones.ArmatureDisplay);t.armature().animation.fadeIn("snatch",-1,1,0,"normal"),t.addEventListener(dragonBones.EventObject.COMPLETE,function(){e.destroy(),a&&a()},n)}},o=0;o<e;++o){var c=cc.p(i[o][0],i[o][1]),l=cc.moveBy(.5,c).easing(cc.easeExponentialOut()),h=cc.moveTo(.25,t).easing(cc.easeExponentialIn()),d=cc.fadeOut(1).easing(cc.easeExponentialOut());this._leftitemlist[o].node.runAction(cc.sequence(l,h,cc.callFunc(s),d)),this._leftitemlist[o].node.setCascadeOpacityEnabled(!0)}}},Arrow_OnClickHandler:function(e,t){if(cc.log(" điểm đánh mũi tên "),0==parseInt(t)){if(0==this._curSelectItemIndex)
return;var a=this._curSelectItemIndex-1;(n=this._rightitemlist[a]._itemjsoninfo).template_id=this._rightitemlist[a]._itemId,this.UpdateLeftInfo(n),this._rightitemlist[this._curSelectItemIndex].SetSelect(!1),this._rightitemlist[a].SetSelect(!0),this._curSelectItemID=n.template_id,this._curSelectItemIndex=a,this._lastSelectItemIndex=this._curSelectItemIndex,this._lastSelectItemID=this._curSelectItemID}else{if(this._curSelectItemIndex==this._mTreaInfoList.length-1)
return;var n;a=this._curSelectItemIndex+1;(n=this._rightitemlist[a]._itemjsoninfo).template_id=this._rightitemlist[a]._itemId,this.UpdateLeftInfo(n),this._rightitemlist[this._curSelectItemIndex].SetSelect(!1),this._rightitemlist[a].SetSelect(!0),this._curSelectItemID=n.template_id,this._curSelectItemIndex=a,this._lastSelectItemIndex=this._curSelectItemIndex,this._lastSelectItemID=this._curSelectItemID}
var i=0,r=this.m_pRightItemParent.height-270;r<(i=this._curSelectItemIndex>this._mTreaInfoList.length-2?this.m_pRightItemParent.height-270:270+120*this._curSelectItemIndex)&&(i=r),i<270&&(i=270),this.m_pScrollView.stopAutoScroll(),this.m_pRightItemParent.stopAllActions(),this.m_pRightItemParent.runAction(cc.moveTo(.2,cc.p(0,i))),this.RefreshArrow()},Report_OnClickHandler:function(e){h.playBtnOpenEffect(),s.send_C2STreasureRobReport(DonotDestroyManager._gameSocket)},Back_OnClickHandler:function(e){h.playBtnCloseEffect(),MyUiManager.Back()},update:function(e){this._isTimeRunning&&(this._counttime+=e,1<=this._counttime&&(this._counttime-=1,this._TimeSec--,this._TimeSec<=-10?(this._isTimeRunning=!1,this.m_pTimeContent.active=!1):this.m_pTimeValue.string=n.secondToTime(this._TimeSec)))},showGuide:function(){var t=this;u.showGuide("SnatchMainLayer",function(e){return 1==e?t._guideFragItem:2==e?t.mBtnCompose:3==e?t.mBtnClose:void 0})}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",ResLoaderManager:"ResLoaderManager",ShaderUtil:"ShaderUtil",SnatchBufferMgr:"SnatchBufferMgr",SoundUtil:"SoundUtil",TimeUtil:"TimeUtil",TreasureFragsCfgMgr:"TreasureFragsCfgMgr"}],SnatchQdItemCell:[function(e,t,a){"use strict";cc._RF.push(t,"d279676VxtBnKE7uO7rJLt5","SnatchQdItemCell");var n=e("ColorUtil"),i=e("MyProtocols"),r=e("SnatchBufferMgr"),s=e("SoundUtil"),o=e("PlayerBufferMgr");cc.Class({extends:cc.Component,properties:{m_pAutoLayer:cc.Prefab,m_pName:cc.Label,m_pIcon:cc.Sprite,m_pFihgt:cc.Label,m_pGailv:cc.Label,m_pBg:cc.Sprite,m_pBottomContent:cc.Node,m_pNameBg:cc.Sprite,m_pNormalBtn:cc.Node,m_pAutoBtn:cc.Node,m_pIconList:[cc.SpriteFrame],m_pBglist:[cc.SpriteFrame],m_pNameBglist:[cc.SpriteFrame],_enemyinfo:null,_gailvstr:[],_index:-1},onLoad:function(){},ChangeData:function(e){e&&(this._enemyinfo=e.info,this._index=e.index),this._gailvstr=["","Xác suất thấp","Xác suất thường","Xác suất cao"],this.Init()},Init:function(){null!=this._enemyinfo?this.InitData():this.InitOtherData()},InitData:function(){this.m_pBottomContent.active=!0,this.m_pName.string=this._enemyinfo.nickname,this.m_pIcon.spriteFrame=this.m_pIconList[this._enemyinfo.sexId-1],this.m_pFihgt.string=this._enemyinfo.fight,this.m_pGailv.string=this._gailvstr[this._enemyinfo.prob],this.m_pBg.spriteFrame=this.m_pBglist[this._enemyinfo.prob],this.m_pNameBg.spriteFrame=this.m_pNameBglist[this._enemyinfo.prob],this.m_pNormalBtn.active=!0,this.m_pAutoBtn.active=!1,this.m_pGailv.node.color=n.getColorByQuality(this._enemyinfo.prob)},InitOtherData:function(){this.m_pBottomContent.active=!1,this.m_pNormalBtn.active=!1,this.m_pAutoBtn.active=!0,this.m_pIcon.spriteFrame=this.m_pIconList[2];var e=DonotDestroyManager.GameData.RobotNames,t=Math.random()*e.length;this.m_pName.string=e[parseInt(t)]},Qd_OnClickHandler:function(e){s.playBtnOpenEffect(),o.getUserStamina()<DonotDestroyManager.GameData.TreasureRob.stamina_cost?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Không đủ nại lực,nhỏ hơn "+DonotDestroyManager.GameData.TreasureRob.stamina_cost+" xin đến Tiệm mua Nhân Sâm!"):(r.savebattleindex(this._index),i.send_C2STreasureRobEnemyDetail(DonotDestroyManager._gameSocket,this._index,0))},AutoQd_OnClickHandler:function(e){s.playBtnOpenEffect(),MyUiManager.Back();var t=cc.instantiate(this.m_pAutoLayer);cc.Canvas.instance.node.addChild(t),t.getComponent("SnatchAutoLayer").ChangeData()}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyProtocols:"MyProtocols",PlayerBufferMgr:"PlayerBufferMgr",SnatchBufferMgr:"SnatchBufferMgr",SoundUtil:"SoundUtil"}],SnatchReportCell:[function(e,t,a){"use strict";cc._RF.push(t,"53c53z8L5dFe4bi3iHurhLg","SnatchReportCell");var o=e("GameUtils");cc.Class({extends:cc.Component,properties:{m_pName:cc.Label,m_pFight:cc.Label,m_pFragname:cc.Label,m_pTimeDay:cc.Label,m_pTime2:cc.Label,_buffer:null},onLoad:function(){},ChangeData:function(e){this._buffer=e,this.Init()},Init:function(){this.m_pName.string=this._buffer.nickname,this.m_pFight.string=this._buffer.fight;var e=DonotDestroyManager.GameData.TreasureFrags[this._buffer.templateId];this.m_pFragname.string="【"+e.name+"】";var t=new Date;t.setTime(1e3*this._buffer.time);var a=t.getMonth()+1,n=t.getDate(),i=t.getHours(),r=t.getMinutes(),s=t.getSeconds();this.m_pTimeDay.string=o.pad(a,2)+"/"+o.pad(n,2),this.m_pTime2.string=o.pad(i,2)+":"+o.pad(r,2)+":"+o.pad(s,2)}}),cc._RF.pop()},{GameUtils:"GameUtils"}],SnatchReportLayer:[function(e,t,a){"use strict";cc._RF.push(t,"daa4ajTdxlOr4thZ7Qkpl2B","SnatchReportLayer"),cc.Class({extends:cc.Component,properties:{m_pItemParent:cc.Node,m_pReportCell:cc.Node,_buffer:null,_itemlist:[]},onLoad:function(){},ChangeData:function(e){this._buffer=e,this.Init()},Init:function(){this.CreateReportCell()},CreateReportCell:function(){for(var e=0;e<this._buffer.reports.length;++e){var t=null;if(e<this._itemlist.length)
t=this._itemlist[e];else{var a=cc.instantiate(this.m_pReportCell);this.m_pItemParent.addChild(a),t=a.getComponent("SnatchReportCell"),this._itemlist.push(t)}
t.node.active=!0,t.ChangeData(this._buffer.reports[e])}}}),cc._RF.pop()},{}],SnatchWinPanel:[function(e,t,a){"use strict";function _(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
cc._RF.push(t,"be8bef8JqNMBa1QGS/BC35z","SnatchWinPanel");var n=e("GameUtils"),i=e("ColorUtil"),r=e("SoundUtil"),s=e("GuideBufferMgr"),o=e("BattleSceneMgr"),c=e("BattleManager"),l=e("SnatchBattleManager"),h=e("PlayerBufferMgr"),d=e("MarqueeBufferMgr");cc.Class({extends:cc.Component,properties:{m_pwinpre:cc.Prefab,m_pItemBox:cc.Prefab,m_povallight:cc.Prefab,m_pHasFragContent:cc.Node,m_pNoFragContent:cc.Node,m_pFragParent:cc.Node,m_pFragName:cc.Label,m_pExp:cc.Label,m_pMoney:cc.Label,m_pStamina:cc.Label,m_pcardicon2:cc.SpriteFrame,m_pLight:cc.Sprite,m_pmGainBox:cc.Node,m_pmResultBox:cc.Node,m_pmGoldLine:cc.Node,m_pmLigthTab:[cc.Sprite],m_pmRewardTab:[cc.Node],m_pmRewardIcon:[cc.Sprite],m_pmLigthIconTab:[cc.Sprite],m_pmLigthSelectTab:[cc.Sprite],_recvdata:null,_rewardinfo:null,_mGetCardFinish:!1,_iscanclick:!1},onLoad:function(){},ChangeData:function(e){this._recvdata=e.info,this.setStatistics(e.leftinfo,e.rightinfo,e.staticData),this.Init()},Init:function(){this.InitData(),this.CreateWinarmature()},InitData:function(){if(this._iscanclick=!1,this._mGetCardFinish=!1,this._mIsTranCardIng=!1,this._mRewardOpenState=[!1,!1,!1],this.m_pStamina.string="-"+DonotDestroyManager.GameData.Arena.stamina_cost,this.m_pMoney.string="+"+this._recvdata.achieveGameMoney,this.m_pExp.string="+"+this._recvdata.achieveExp,this._rewardinfo=this._recvdata.items[0],null!=this._recvdata.frags&&0<this._recvdata.frags.length){this.m_pHasFragContent.active=!0,this.m_pNoFragContent.active=!1;var e=this._recvdata.frags[0],t=DonotDestroyManager.GameData.TreasureFrags[e.item_template_id];this.m_pFragName.string=t.name,this.m_pFragName.node.color=i.getColorByQuality(t.quality);var a=cc.instantiate(this.m_pItemBox);this.m_pFragParent.addChild(a),a.getComponent("ItemBox").ChangeItemInfo(e.item_template_id,0,!1)}else
this.m_pHasFragContent.active=!1,this.m_pNoFragContent.active=!0},CreateWinarmature:function(){var t=this,e=cc.instantiate(this.m_pwinpre);this.node.addChild(e),e.setPosition(0,-50);var a=e.getComponent(sp.Skeleton);a.setAnimation(0,"action3",!1),a.setCompleteListener(function(e){t.playUIAni()})},playUIAni:function(){cc.log(" truyền phát tin thưởng cho động họa ");var n=this,e=cc.callFunc(function(){n.m_pmResultBox.active=!0,n.m_pmResultBox.opacity=0,n.m_pmResultBox.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){n.m_pmGainBox.active=!0,n.m_pmGainBox.opacity=0,n.m_pmGainBox.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){n.m_pmGoldLine.active=!0,n.m_pmGoldLine.opacity=0,n.m_pmGoldLine.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){for(var e=0;e<n.m_pmRewardTab.length;++e){n.m_pmRewardTab[e].active=!0,n.m_pmRewardTab[e].opacity=0,n.m_pmRewardTab[e].setScale(.95);var t=cc.spawn(cc.delayTime(.15*e),cc.scaleTo(.15,1.1),cc.fadeIn(.15),cc.delayTime(.15)),a=cc.spawn(cc.delayTime(.15*e),cc.scaleTo(.15,1));n.m_pmRewardTab[e].runAction(cc.sequence(t,a))}
n.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide(this.m_pmRewardTab[1])},n)))}))),n.setCloseListener()})))})))});this.node.runAction(cc.sequence(cc.delayTime(.35),e))},setCloseListener:function(){for(var e=0;e<3;++e)
this.m_pmRewardTab[e].active=!1;this._iscanclick=!0,this.playUnOpenCardsAni(1)},playUnOpenCardsAni:function(e){var t=this;this.runLigthAction(this.m_pmLigthTab[e].node,1,function(){2==e?e=0:e+=1,t.playUnOpenCardsAni(e)})},runLigthAction:function(e,t,a){e.active=!0;var n=this,i=cc.spawn(cc.fadeIn(.2),cc.scaleTo(.2,1.2)),r=cc.spawn(cc.fadeOut(.2),cc.scaleTo(.2,1.2)),s=cc.spawn(cc.fadeIn(.1),cc.scaleTo(.1,1.1)),o=cc.spawn(cc.fadeOut(.4),cc.scaleTo(.4,1.6)),c=cc.delayTime(.1);if(1==t&&e.runAction(cc.sequence(i,c,r,cc.callFunc(a))),2==t){var l=cc.callFunc(function(){var e=cc.sequence(cc.fadeOut(.3),cc.callFunc(function(e){e.destroy()}));n.m_pmLigthIconTab[n._mSelectId].node.runAction(e),n.m_pmLigthSelectTab[n._mSelectId].node.runAction(cc.fadeIn(.1))});e.runAction(cc.sequence(l,s,o,cc.callFunc(a)))}},runTurnCardAction:function(e,t,a,n,i,r){var s=cc.rotateBy(.4,0,-90*e),o=cc.rotateBy(.3,0,-90*e),c=cc.callFunc(function(){n.active=!0,i&&i()}),l=null;null!=r?(l=cc.callFunc(r),a.runAction(cc.sequence(cc.delayTime(.4),s,c,o,l))):a.runAction(cc.sequence(cc.delayTime(.4),s,c,o))},loadRewardData:function(e){for(var t,a,n,i,r,s,o,c=this,l=(_(a={},(t=0==e?[0,1,2]:1==e?[1,0,2]:2==e?[2,1,0]:void 0)[0],{0:c._rewardinfo.item_template_id,1:c._rewardinfo.item_count}),_(a,t[1],{0:1005,1:1}),_(a,t[2],{0:1006,1:1}),a),h=Object.keys(l),d=0;d<h.length;++d)
n=h[d],i=l[h[d]],o=s=void 0,r={id:i[0],num:i[1],tips:!0,size:cc.size(100,100)},s=cc.instantiate(c.m_pItemBox),(o=s.getComponent("ItemBox")).ChangeItemInfo(r.id,r.num,!0,null,!0),o.m_pQuality.spriteFrame=c.m_pcardicon2,c.m_pmRewardIcon[n].node.addChild(s),c.m_pmRewardIcon[n].node.setScale(1.2)},playOpenCardsAni:function(e){var t=this;this.m_pmLigthTab[e].node.active=!0,this.runLigthAction(this.m_pmLigthTab[e].node,2,function(){t.m_pmLigthTab[e].node.stopAllActions(),t.m_pmLigthTab[e].node.active=!1})},closeBeforeAction:function(){for(var e=0;e<this.m_pmLigthTab.length;++e)
this.m_pmLigthTab[e].node.stopAllActions(),this.m_pmLigthTab[e].node.active=!1},getOpenCardIndex:function(e){if(null!=e&&0==this._mRewardOpenState[e])
return this._mRewardOpenState[e]=!0,e;for(var t=0;t<3;++t)
if(0==this._mRewardOpenState[t])
return this._mRewardOpenState[t]=!0,t;return-1},showOpenCardAction:function(t){var a=this;this.closeBeforeAction();var n=this.getOpenCardIndex(t);this._mSelectId=t,this.runTurnCardAction(3,n,this.m_pmRewardTab[n],this.m_pmRewardIcon[n].node,function(){var e;e=n,a.playOpenCardsAni(e),a.playOvalLight(a.m_pmRewardTab[e],cc.p(50,50))},function(){(function(){var e=a.getOpenCardIndex(t);a.runTurnCardAction(1,e,a.m_pmRewardTab[e],a.m_pmRewardIcon[e].node,null,null);e=a.getOpenCardIndex(e);a.runTurnCardAction(1,e,a.m_pmRewardTab[e],a.m_pmRewardIcon[e].node,null,null),a._mGetCardFinish=!0})()})},performWithDelay:function(e,t,a){a=cc.delayTime(a);var n=cc.sequence(a,cc.callFunc(t));return e.runAction(n),n},playOvalLight:function(e,t){var a=cc.instantiate(this.m_povallight);e.addChild(a),a.setPosition(0,0);var n=a.getComponent(dragonBones.ArmatureDisplay);n.armature().animation.fadeIn("start",-1,1,0,"normal"),n.addEventListener(dragonBones.EventObject.COMPLETE,function(){a.destroy()},this)},Again_OnClickHandler:function(e){r.playBtnOpenEffect()},Reward_OnClickHandler:function(e,t){var a=parseInt(t);this._mRewardOpenState[a]||(r.playBtnOpenEffect(),this.playCardAction(a))},playCardAction:function(e){this._mIsTranCardIng||(this._mIsTranCardIng=!0,this.loadRewardData(e),this.showOpenCardAction(e))},Mask_OnClickHandler:function(e){this._iscanclick&&(this._mGetCardFinish?(r.playBtnCloseEffect(),MyUiManager.RemoveTowPanel(),MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),d.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"):this.playCardAction(1))},showGuide:function(t){s.showGuide("SnatchWinPanel",function(e){if(1==e)
return t})},robAgainBtnHandler:function(e){h.getUserStamina()<DonotDestroyManager.GameData.TreasureRob.stamina_cost?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80)," Nại lực không đủ, nhỏ "+DonotDestroyManager.GameData.TreasureRob.stamina_cost+" xin đến Tiệm mua Nhân Sâm!"):(r.playBtnOpenEffect(),cc.Canvas.instance.node.destroyAllChildren(),c.resetData(),l.resetBattlefield(),n.callInNextTick(function(){o.getInstance().restart(!1)}))},setStatistics:function(e,t,a){this.statistics={left:e,right:t,data:a};var n={damage:-1};a.teams.forEach(function(e,t){e.damage>n.damage&&"left"==e.data.hero.side&&(n=e)})},BattleDetail_onClickHandler:function(){var n=this;null==this._shortMask_node&&(this._shortMask_node=cc.instantiate(DonotDestroyManager.ShortLoadingLayer),this._shortMask_node.setPosition(0,0),cc.Canvas.instance.node.addChild(this._shortMask_node)),cc.loader.loadRes("Prefab/BattleDetailLayer/BattleDetailLayer",cc.Prefab,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),null!=n&&cc.isValid(n.node)){null!=n._shortMask_node&&(n._shortMask_node.destroy(),n._shortMask_node=null);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("BattleDetailLayer").ChangeData(n.statistics.data)}})}}),cc._RF.pop()},{BattleManager:"BattleManager",BattleSceneMgr:"BattleSceneMgr",ColorUtil:"ColorUtil",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",MarqueeBufferMgr:"MarqueeBufferMgr",PlayerBufferMgr:"PlayerBufferMgr",SnatchBattleManager:"SnatchBattleManager",SoundUtil:"SoundUtil"}],SoldiersManager:[function(e,t,a){"use strict";cc._RF.push(t,"827611QR3pKYYolCqkVA+7P","SoldiersManager");var n=e("MeleeSoldier"),i=e("RemoteSoldier"),r=e("BattleConstants"),s=function(){this.soldierActors=[]};s.prototype.resetData=function(){this.soldierActors=[]},s.prototype.createSoldier=function(e){var t;return e==r._ARMY_TYPE.Melee?t=new n:e==r._ARMY_TYPE.Remote&&(t=new i),cc.assert(t,"can not create Soldier atk type = %d",e),this.soldierActors.push(t),t},s.prototype.removeSoldier=function(e){for(var t=0;t<this.soldierActors.length;t++){if(this.soldierActors[t]==e){this.soldierActors.splice(t,1);break}}},s.prototype.onUpdate=function(e){for(var t=0;t<this.soldierActors.length;t++){this.soldierActors[t].onUpdate(e)}},s.prototype.pause=function(){for(var e=0;e<this.soldierActors.length;e++){var t=this.soldierActors[e];"Dead"!=t.getState()&&t.pause()}},s.prototype.resume=function(){for(var e=0;e<this.soldierActors.length;e++){var t=this.soldierActors[e];"Dead"!=t.getState()&&t.resume()}},t.exports=new s,cc._RF.pop()},{BattleConstants:"BattleConstants",MeleeSoldier:"MeleeSoldier",RemoteSoldier:"RemoteSoldier"}],Soldier:[function(s,e,t){"use strict";cc._RF.push(e,"9cd315dzNNIQLkIpDwdDh98","Soldier");var o=s("BattleConstants"),a=(s("state-machine"),s("GameUtils"),cc.Class({extends:s("Unit"),properties:{},ctor:function(){cc.log("Soldier create!"),this.class="Soldier",this.cfg={},this.uType=0,this.level=1,this.grade=1,this.co=0,this.str=0,this.int=0,this.slot4V1=null,this.side4V1="",this.lifeTime=null},initial:function(e,t){if(this.basehp=this.hp,this.baseatk=this.atk,this.basedef=this.def,null!=t)
return this.node=cc.instantiate(t),this.node.name="Soldier#"+e,this.amt=this.node.children[0],void((this.amt.getComponent("FrameAnimationCallback").baseModel=this).bloodBar=this.node.children[1]);var a;this.node=new cc.Node("Soldier#"+e),this.node.setCascadeOpacityEnabled(!0),this.side()==o._BTL_SIDE.OUR?a="blue":this.side()==o._BTL_SIDE.OTR&&(a="red");var n=s("BattleSceneMgr"),i=cc.js.formatStr("Prefab/battle/soldier/%s_%s",this.cfg.icon,a);this.amt=cc.instantiate(n.getInstance()._raw_assets[i]),this.amt.setScaleX(-this.side()),(this.amt.getComponent("FrameAnimationCallback").baseModel=this).node.addChild(this.amt,o._BTL_ZORDER.U_ARMATURE);var r=this.side()==o._BTL_SIDE.OUR?"Green":"Red";this.bloodBar=cc.instantiate(n.getInstance()._raw_assets["Prefab/battle/widget/unitLifeBar"+r]),this.bloodBar.active=!1,this.bloodBar.setPositionY(this.getHeight()),this.bloodBar.getComponent("BattleLifeBarMgr")._uClass="Soldier",this.node.addChild(this.bloodBar,o._BTL_ZORDER.U_BLOOD)},playAnimation:function(e){cc.log("Soldier playAnimation=%s",e);this.amt.getComponent(cc.Animation).play(e)},getUnitSize:function(){return this.cfg.unit_size},getHeight:function(){return 2==this.uType?50:35},getAtkType:function(){return this.cfg.atk_type},playAttackAnimation:function(){this.playAnimation("attack"),this.amt.getComponent(cc.Animation).on("finished",this.onAttackFinished,this)},onAttackFinished:function(){this.amt.getComponent(cc.Animation).off("finished",this.onAttackFinished,this);this.nextEv?(this.doEvent(this.nextEv),"Idle"==this.nextEv&&(this.move2Pos?this.doEvent("Move"):this.meet2Pos&&this.doEvent("Meet")),this.nextEv=null):"Attack"==this.getState()&&this.playAnimation("stand")},pauseAnimation:function(){this.amt.getComponent(cc.Animation).pause()},resumeAnimation:function(){"Frozen"!=this.getState()&&this.amt.getComponent(cc.Animation).resume()},onenterDead:function(){(this.playAnimation("die"),this.amt.getComponent(cc.Animation).on("finished",this.onDieFinished,this),this.army.removeDeadSoldier(this),0==this.army.soldiers.length)&&s("StagesEventManager").dispatchTrigger2(this.army.hero)},onDieFinished:function(){this.playAnimation("dead"),this.node.opacity=150,this.node.runAction(cc.sequence(cc.delayTime(5),cc.fadeOut(2),cc.callFunc(function(){this.node.removeFromParent(),this.node.destroy(),this.node=null,s("SoldiersManager").removeSoldier(this)},this))),this.amt.getComponent(cc.Animation).off("finished",this.onDieFinished,this)},onUpdate:function(e){this._super(e),this.lifeTime&&0<this.lifeTime&&(this.lifeTime=this.lifeTime-e,this.lifeTime<=0&&this.autoDie())},interruptAction:function(e,t,a){var n=this._super(e,t,a);if(null==n)
return null;var i=this;(e=this.amt.getComponent(cc.Animation)).on("finished",function e(){i.amt.getComponent(cc.Animation).off("finished",e,this),n()},this)}}));e.exports=a,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleSceneMgr:"BattleSceneMgr",GameUtils:"GameUtils",SoldiersManager:"SoldiersManager",StagesEventManager:"StagesEventManager",Unit:"Unit","state-machine":"state-machine"}],SoundUtil:[function(e,t,a){"use strict";cc._RF.push(t,"cf765QUeKFEl6w8ngVQnBVz","SoundUtil");var l=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=function(){},i=null;n.playMusic=function(e,t){i!=e&&(i=e,MyPersistDataManager._playerData.musicVolume?audio.playMusic(i,t):i=null)},n.playEffect=function(e){if(MyPersistDataManager._playerData.musicVolume){var t="resources/sound/"+e,a=cc.url.raw(t);return cc.log("SoundUtil playEffect,url="+a),cc.audioEngine.play(a,!1,MyBgMusicManager._soundVolumn)}},n.playEffectRaw=function(e){var t="resources/sound/"+e,a=cc.url.raw(t);return cc.log("SoundUtil playEffect,url="+a),cc.audioEngine.play(a,!1,1)},n.uncacheAll=function(){cc.audioEngine.uncacheAll()},n.playMusic=function(e,t,a){MyPersistDataManager._playerData.musicVolume&&audio.playMusic("sound/"+e,t)},n.setMusicVolume=function(e){audio.setBackgroundMusicVolume(e),MyPersistDataManager._playerData.musicVolumeVal=e},n.getMusicVolume=function(){return audio.getBackgroundMusicVolume()},n.setEffectsVolume=function(e){audio.setEffectsVolume(e),MyPersistDataManager._playerData.effectVolumeVal=e},n.getEffectsVolume=function(){return audio.getEffectsVolume()},n.stopMusic=function(){MyBgMusicManager.stop()},n.isMusicPlaying=function(){return 1==audio.isMusicPlaying()},n.stopAllEffects=function(){cc.audioEngine.stopAll()},n.openMusic=function(){},n.closeMusic=function(){},n.proloadMusic=function(e){},n.proloadEffect=function(e){},n.unloadEffect=function(e){audio.unloadEffect(e)},n.pauseEffect=function(e){e&&cc.audioEngine.pause(e)},n.stopEffect=function(e){e&&cc.audioEngine.stop(e)},n.resumeEffect=function(e){e&&cc.audioEngine.resume(e)},n.playHomeMusic=function(){n.playMusic(DonotDestroyManager.GameData.Sounds.zjm,!0)},n.playEmbattleMusic=function(){n.playMusic(DonotDestroyManager.GameData.Sounds.jzbz,!0)},n.playBattleStartMusic=function(){n.playMusic(DonotDestroyManager.GameData.Sounds.UI_zdyb,!1)},n.playFightMusic=function(){n.playMusic(DonotDestroyManager.GameData.Sounds.zdgc,!0)},n.playRecruitMusic=function(){n.playMusic(DonotDestroyManager.GameData.Sounds.UI_jg,!0)},n.playBtnOpenEffect=function(){n.playEffect("UI_ankq.mp3")},n.playBtnOpenEffectRaw=function(){n.playEffectRaw("UI_ankq.mp3")},n.playBtnCloseEffect=function(){n.playEffect("UI_qh.mp3")},n.playDragUpEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_tiqi)},n.playDragDownEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_tdfx)},n.playGainGoodsEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_hdjl)},n.playGainGoodsEffectNew=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_getitem)},n.playTreasureBoxEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_bxdk)},n.playUnlockLevelEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_js)},n.playHeroStrEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_yxqh)},n.playUpgradeEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_yxsj)},n.playSuccessEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.zdsl)},n.playFailureEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.zdsb)},n.playSuccessMusic=function(){n.playMusic(DonotDestroyManager.GameData.Sounds.UI_sl,!1)},n.playFailureMusic=function(){n.playMusic(DonotDestroyManager.GameData.Sounds.UI_sb,!1)},n.playTaskEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_rw)},n.playPageEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_fy)},n.playStarShowupEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_xx1)},n.playStarShowDownEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_xx2)},n.playBtnUpgradeEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_qh)},n.playTabSelectEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_yqbt)},n.playMenuOpenEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_ycdk)},n.playMenuCloseEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_ycgb)},n.playBeginFightEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_kszd)},n.playSoldUpgrade1Effect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_xbsj)},n.playSoldStageEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_xbsji)},n.playSoldFlyEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_feiru)},n.playDetailedDataEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_xxsj)},n.playChallangeEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_zctz)},n.playChangeFormationEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_bz)},n.playEquipStrEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_zbqh)},n.playTreaRefineEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_bwjl)},n.playSmelterHeroEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_kslh)},n.playSmelterEquipEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_tjp)},n.playRobTreaEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_dbhc)},n.playBeginBattleEffect1=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_zdzbks)},n.playBeginBattleEffect2=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_zdzbjs)},n.playLevelUpEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_yssj)},n.playGetGoodsEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_hdwp)},n.playSkillEffect=function(e){},n.playRecruitCommonEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_ptck)},n.playRecruitEffect=function(){n.playEffect(DonotDestroyManager.GameData.Sounds.UI_ck)},n.playHeroSound=function(e){n.playEffect("hero/"+e+".mp3")},n.playBattleSkillEffect=function(e){n.playEffect(e)},n.getBattleSound=function(e,t){var a=DonotDestroyManager.GameData.SoundConfig,n=DonotDestroyManager.GameData.Sounds[e][t-1],i=n[parseInt(Math.random()*n.length)],r=a[i].split(":"),s=l(r,2),o=s[0],c=s[1];return[i,Math.floor(60*parseInt(o)+1*parseInt(c))]},t.exports=n,cc._RF.pop()},{}],StageBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"dc328VjRrRJc55L2sQP0728","StageBufferMgr");var n=e("StagesConfigMgr"),i=e("MyProtocols"),r=function(){this.mStageList=[],this.mStarRewards={},this.mStageIdPass=0,this.mGroupUnlock=0,this.mCrawlTagState=0,this.mLastChapterid=0};r.prototype.initCrawlState=function(e){this.mCrawlTagState=e},r.prototype.isStageIdPassed=function(e){var t=Math.floor(e/100),a=e%100-1;return null!=MyPersistDataManager._playerData.chaptersMaplist&&null!=MyPersistDataManager._playerData.chaptersMaplist[t]&&null!=MyPersistDataManager._playerData.chaptersMaplist[t].stages[a]},r.prototype.getCurChapGroupStageId=function(){return null==MyPersistDataManager._playerData.chapterslist||MyPersistDataManager._playerData.chapterslist.length<=0?[1,1,101]:(this.mGroupId=MyPersistDataManager._playerData.chapterslist.length,this.mChapterId=Math.ceil(this.mGroupId/5),this.mStageId=MyPersistDataManager._playerData.chapterslist[this.mGroupId-1].stages.length+100*this.mGroupId,[this.mChapterId,this.mGroupId,this.mStageId])},r.prototype.getStageIdUnLock=function(){return this.mStageIdPass||0},r.prototype.setStageIdUnLock=function(e){this.mStageIdPass=e},r.prototype.setGroupUnlock=function(e){this.mGroupUnlock=e},r.prototype.getGroupUnlock=function(){return this.mGroupUnlock||0},r.prototype.setLastChapterId=function(e){this.mLastChapterid=e},r.prototype.getLastChapterId=function(){return this.mLastChapterid},r.prototype.getCrawlInfoState=function(){return[Math.floor(this.mCrawlTagState/10),this.mCrawlTagState%10]},r.prototype.setCrawlStateInfo=function(e,t,a){var n;"op"==t?n=10*e:"ed"==t&&(n=10*e+1),this.mCrawlTagState=n,null!=a&&a()},r.prototype.sendCrawlStateInfo=function(e,t,a){var n;"op"==t?n=10*e:"ed"==t&&(n=10*e+1),this.mCrawlTagState=n,i.send_C2SSaveCrawl(DonotDestroyManager._gameSocket,n)},r.prototype.isGroupIsPass=function(e){var t=n.getLastStageIdGroup(e);return this.isStageIdPassed(t)},t.exports=new r,cc._RF.pop()},{MyProtocols:"MyProtocols",StagesConfigMgr:"StagesConfigMgr"}],StageEliteItem:[function(e,t,a){"use strict";cc._RF.push(t,"d531ffUh6JCPYOXJ1ADk2t4","StageEliteItem");var n=e("StageMapPanel"),i=e("GameUtils"),r=e("EliteStagesConfigMgr"),s=e("i18n"),o=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pBoxeffectPre:cc.Prefab,m_pStarRewardPre:cc.Prefab,m_pStageName:cc.Label,m_pStarNum:cc.RichText,m_pBox:cc.Sprite,m_pStarInfoNode:cc.Node,m_pStageSpr:cc.Sprite,m_pStageyy:cc.Sprite,m_pUnlock:cc.Node,m_pBoxNormalSpr:[cc.SpriteFrame],m_pBoxOpenSpr:[cc.SpriteFrame],m_pBoxdisableSpr:[cc.SpriteFrame],_stageinfo:null,_index:-1,_stagejson:null,_rewardindex:-1,_iscanopen:!1,_curStar:0,_AllStar:0,_boxeffect:null,_stagenormalspr:null,_stagePressSpr:null,_stageyinying:null},onLoad:function(){},ChangeData:function(e,t){this._stageinfo=e,this._index=t,this.Init()},Init:function(){var a=this;this._stagejson=DonotDestroyManager.GameData.EliteStages[this._index],this.SetStarRewardInfo(),this.m_pStageName.string=this._stagejson.name;var e="Chapter"+n.getInstance()._curChapterId;cc.log(" quan tạp đường nhỏ ==="+e),cc.loader.loadRes("UI/StageMap/"+e+"/"+this._stagejson.icon[0].replace(".png",""),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load icon success!"),a._stagenormalspr=t,a.m_pStageSpr.spriteFrame=t,a.m_pStageSpr.getComponent(cc.Button).normalSprite=t}),cc.loader.loadRes("UI/StageMap/"+e+"/"+this._stagejson.icon[1].replace(".png",""),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load icon success!"),a._stagePressSpr=t,a.m_pStageSpr.getComponent(cc.Button).pressedSprite=t}),cc.loader.loadRes("UI/StageMap/"+e+"/"+this._stagejson.icon[2].replace("4.png","3"),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),cc.log("load icon success!"),a._stageyinying=t,a.m_pStageyy.spriteFrame=t});var t=r.getGroupRequireLevel(this._index+1);return n.getInstance()._curGroup<this._index+1||MyPersistDataManager._playerData.level<t?(this.m_pUnlock.active=!0,this.m_pStageSpr.node.color=cc.Color.GRAY,this.m_pStarInfoNode.active=!1,void(this.m_pStageName.node.color=cc.Color.GRAY)):null==MyPersistDataManager._playerData.chapterslist[this._index]||MyPersistDataManager._playerData.chapterslist[this._index].stages.length<r.getStageCount(this._stagejson)?(this.m_pUnlock.active=!0,this.m_pStageSpr.node.color=cc.Color.GRAY,this.m_pStarInfoNode.active=!1,void(this.m_pStageName.node.color=cc.Color.GRAY)):(this.m_pUnlock.active=!1,this.m_pStageSpr.node.color=cc.Color.WHITE,this.m_pStarInfoNode.active=!0,void(this.m_pStageName.node.color=cc.Color.WHITE))},SetStarRewardInfo:function(){this._curStar=this.GetCurStar(),this._rewardindex=this.GetCurCanReceiveIndex(),-1==this._rewardindex?this._AllStar=this._stagejson.rewards[this._stageinfo.star_award.length-1].star:this._AllStar=this._stagejson.rewards[this._rewardindex].star,this._curStar<this._AllStar?this.m_pStarNum.string="<color=#ff0000>"+this._curStar+"</c><color=#ffffff>/"+this._AllStar+"</color>":this.m_pStarNum.string="<color=#00ff00>"+this._curStar+"</c><color=#ffffff>/"+this._AllStar+"</color>",this.SetBoxState(this._rewardindex)},SetBoxState:function(e){null!=this._boxeffect&&(this._boxeffect.removeFromParent(),this._boxeffect.destroy(),this._boxeffect=null),this.m_pBox.node.active=!0;-1!=e?this._curStar>=this._AllStar?(this.m_pBox.node.active=!1,this.CreateBoxEffect()):this.m_pBox.spriteFrame=this.m_pBoxdisableSpr[e]:this.m_pBox.spriteFrame=this.m_pBoxOpenSpr[this._stageinfo.star_award.length-2]},CreateBoxEffect:function(){var e=["mu","blue","gold"];this._boxeffect=cc.instantiate(this.m_pBoxeffectPre),this.m_pBox.node.parent.addChild(this._boxeffect),this._boxeffect.setScale(.65),this.node.runAction(cc.sequence(cc.delayTime(.04),cc.callFunc(function(){this._boxeffect.getComponent(sp.Skeleton).setAnimation(0,"Action1_"+e[this._rewardindex],!0)},this))),this._boxeffect.setPosition(this.m_pBox.node.getPosition())},UpdateStarRewardInfo:function(){this.SetStarRewardInfo()},StageOnClickHandler:function(e){o.playBtnOpenEffect();var t=r.getGroupRequireLevel(this._index+1);MyPersistDataManager._playerData.level<t?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),s.t("stage_003",{value:t})):null==MyPersistDataManager._playerData.chapterslist[this._index]||MyPersistDataManager._playerData.chapterslist[this._index].stages.length<r.getStageCount(this._stagejson)?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin vượt ải thường tương ứng"):this._index+1>n.getInstance()._curGroup?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Xin vượt ải trước đó"):i.callInNextTick(function(e){MyUiManager.Open(MyUiManager.PanelInfo.StageEliteSelectPanel,{stageinfo:MyPersistDataManager._playerData.chapterselitelist,group:e._stagejson.prev_elitestage_group,chapterid:n.getInstance()._curChapterId})},this)},RewardInfo_OnClickHandler:function(e){o.playBtnOpenEffect();var t=cc.instantiate(this.m_pStarRewardPre);n.getInstance().node.addChild(t),t.active=!0;var a={rewardinfo:null==this._stageinfo?null:this._stageinfo.star_award,rewards:this._stagejson.rewards,star:this._curStar,group:this._stagejson.prev_elitestage_group+1,cb:this.UpdateStarRewardInfo.bind(this),type:1};t.getComponent("StageRewardInfo").ChangeData(a)},GetCurCanReceiveIndex:function(){var e=-1;if(null==this._stageinfo)
return 0;if(null==this._stageinfo.star_award||this._stageinfo.star_award.length<=0)
return 0;for(var t=0;t<this._stageinfo.star_award.length;++t)
if(0==this._stageinfo.star_award[t]){e=t;break}
return e},GetCurStar:function(){if(null==this._stageinfo)
return 0;for(var e=0,t=0;t<this._stageinfo.stages.length;++t)
e+=this._stageinfo.stages[t].star;return e},RemoveAssets:function(){this.m_pStageSpr.getComponent(cc.Button).normalSprite=null,this.m_pStageSpr.getComponent(cc.Button).pressedSprite=null,this._stagenormalspr=null,this._stagePressSpr=null,this._stageyinying=null},onDestroy:function(){}}),cc._RF.pop()},{EliteStagesConfigMgr:"EliteStagesConfigMgr",GameUtils:"GameUtils",SoundUtil:"SoundUtil",StageMapPanel:"StageMapPanel",i18n:"i18n"}],StageEliteSelectPanel:[function(e,t,a){"use strict";cc._RF.push(t,"84c5938c1dF95jnEM3oPisE","StageEliteSelectPanel");var o=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},c=e("ItemCfgUtilMgr"),n=e("MyEventDispatcher"),i=e("NetEvent"),l=e("EliteStagesConfigMgr"),r=e("SoundUtil"),s=e("GuideBufferMgr"),h=e("EliteStageBufferMgr"),d=cc.Class({extends:cc.Component,properties:{m_pRewardPanel:cc.Prefab,m_pStarRewardPre:cc.Prefab,m_pEliteRewardItem:cc.Node,m_pRewardparent:cc.Node,m_pEnergy:cc.Label,m_pGameMoney:cc.Label,m_pExp:cc.Label,m_pName:cc.Label,m_pRoute:cc.Sprite,m_pElitestageitem:cc.Node,m_pStageparent:cc.Node,m_pStarNum:cc.RichText,m_pBox:cc.Sprite,m_pBoxeffectPre:cc.Prefab,m_pBoxNormalSpr:[cc.SpriteFrame],m_pBoxOpenSpr:[cc.SpriteFrame],m_pBoxdisableSpr:[cc.SpriteFrame],m_pRoutelist:[cc.SpriteFrame],_curGroup:-1,_stagejson:null,_subStageId:-1,_rewardinfolist:[],_stageitemlist:[],_bossStagecfg:null,_curStar:0,_AllStar:0,_boxeffect:null,_stageinfo:null,_curStageID:-1,_curchapterid:-1},statics:{instance:null,getInstance:function(){return d.instance}},onLoad:function(){(d.instance=this).S2CElitePointAwardGet_cb_func=this.S2CElitePointAwardGet_cb.bind(this),n.addListener(i.S2CElitePointAwardGet,this.S2CElitePointAwardGet_cb_func)},setParams:function(e){this._curGroup=e.group+1,this._stageinfo=e.stageinfo[e.group],this._curchapterid=e.chapterid,this.Init()},S2CElitePointAwardGet_cb:function(e){this.ShowReward(e),MyPersistDataManager._playerData.chapterselitelist[e.group_index].stages[e.stage_index].is_get_award=!0,this._stageinfo.stages[e.stage_index].is_get_award=!0,this._stageitemlist[e.stage_index].getComponent("EliteStageSelectItem").RefreshRewardinfo(this._stageinfo.stages[e.stage_index])},ShowReward:function(e){for(var t=l.getStageIdByIndex(e.group_index+1,e.stage_index),a=this._stagejson.stage[t].first_drops,n=[],i=0;i<a.length;++i)
for(var r=0;r<a[i].items.length;++r)
n.push({itemId:a[i].items[r][0],cnt:a[i].items[r][1]});var s=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(s),s.getComponent("GetRewardPanel")._itemlist=n},Init:function(){this._stagejson=DonotDestroyManager.GameData.EliteStages[this._curGroup-1],null==this._stageinfo?this._curStageID=1:this._curStageID=this._stageinfo.stages.length+1,this.SetisBossStageIndex(),this._rewardinfolist=this.GetRewardItemList(),this.CreateRewardItem(),this.m_pName.string=this._stagejson.name,this.m_pGameMoney.string=this._bossStagecfg.gamemoney,this.m_pExp.string=this._bossStagecfg.exp,this.m_pEnergy.string=this._bossStagecfg.energy_cost;var e=Object.keys(this._stagejson.stage),t=e.indexOf("_iN$t");-1<t&&e.splice(t,1),5<e.length?(this.m_pRoute.spriteFrame=this.m_pRoutelist[1],this.roadPos=[[-465,-16],[-345,124],[-221,210],[-71,192],[91,226],[252,173],[422,129],[337,16],[213,-28],[-3,3]]):(this.m_pRoute.spriteFrame=this.m_pRoutelist[0],this.roadPos=[[-340,65],[-150,190],[179,183],[280,15],[-3,3]]),this.CreateStageItem(),this.SetStarRewardInfo(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},SetStarRewardInfo:function(){this._curStar=this.GetCurStar();var e=this.GetCurCanReceiveIndex();this._AllStar=-1==e?this._stagejson.rewards[this._stageinfo.star_award.length-1].star:this._stagejson.rewards[e].star,this._curStar<this._AllStar?this.m_pStarNum.string="<color=#ff0000>"+this._curStar+"</c><color=#ffffff>/"+this._AllStar+"</color>":this.m_pStarNum.string="<color=#00ff00>"+this._curStar+"</c><color=#ffffff>/"+this._AllStar+"</color>",this.SetBoxState(e)},SetBoxState:function(e){null!=this._boxeffect&&(this._boxeffect.removeFromParent(),this._boxeffect.destroy(),this._boxeffect=null),this.m_pBox.node.active=!0;-1!=e?this._curStar>=this._AllStar?(this.m_pBox.node.active=!1,this.CreateBoxEffect(e)):this.m_pBox.spriteFrame=this.m_pBoxdisableSpr[e]:this.m_pBox.spriteFrame=this.m_pBoxOpenSpr[this._stageinfo.star_award.length-2]},CreateBoxEffect:function(e){this._boxeffect=cc.instantiate(this.m_pBoxeffectPre),this.m_pBox.node.parent.addChild(this._boxeffect),this._boxeffect.setScale(.65),this._boxeffect.getComponent(sp.Skeleton).setAnimation(0,"Action1_"+["mu","blue","gold"][e],!0),this._boxeffect.setPosition(this.m_pBox.node.getPosition())},GetCurCanReceiveIndex:function(){var e=-1;if(null==this._stageinfo)
return 0;if(null==this._stageinfo.star_award||this._stageinfo.star_award.length<=0)
return 0;for(var t=0;t<this._stageinfo.star_award.length;++t)
if(0==this._stageinfo.star_award[t]){e=t;break}
return e},GetCurStar:function(){if(null==this._stageinfo)
return 0;for(var e=0,t=0;t<this._stageinfo.stages.length;++t)
e+=this._stageinfo.stages[t].star;return e},CreateStageItem:function(){var e=Object.keys(this._stagejson.stage),t=e.indexOf("_iN$t");-1<t&&e.splice(t,1);for(var a=0;a<e.length;++a){var n=null;a<this._stageitemlist.length?n=this._stageitemlist[a]:(n=cc.instantiate(this.m_pElitestageitem),this.m_pStageparent.addChild(n),this._stageitemlist.push(n)),n.active=!0,n.setPosition(this.roadPos[a][0],this.roadPos[a][1]);var i={};i=null==this._stageinfo||null==this._stageinfo.stages||null==this._stageinfo.stages[a]?{info:null,json:this._stagejson.stage[e[a]],stageindex:a,curstage:this._curStageID,group:this._curGroup,stageid:100*this._curGroup+a+1}:{info:this._stageinfo.stages[a],json:this._stagejson.stage[e[a]],stageindex:a,curstage:this._curStageID,group:this._curGroup,stageid:100*this._curGroup+a+1},n.getComponent("EliteStageSelectItem").ChangeData(i),h.getStageIdUnLock()==100*this._curGroup+a+1&&n.getComponent("EliteStageSelectItem").playUnlock()}},SetisBossStageIndex:function(){for(var e=Object.keys(this._stagejson.stage),t=0;t<e.length;++t)
null!=this._stagejson.stage[e[t]]&&this._stagejson.stage[e[t]].isboss&&(this._subStageId=parseInt(e[t]))},CreateRewardItem:function(){null==this._rewardinfolist||this._rewardinfolist.length<=0||this.m_pRewardparent.getComponent("UIWarp").initContent(this._rewardinfolist.length)},GetRewardItemList:function(){if(null!=this._subStageId&&-1!=this._subStageId){this._bossStagecfg=this._stagejson.stage[this._subStageId];for(var a=[],e=function(e){for(var t=0;t<a.length;++t)
if(a[t]==e)
return!0;return!1},t=0;t<this._bossStagecfg.drops.length;++t)
for(var n=0;n<this._bossStagecfg.drops[t].items.length;++n)
e(this._bossStagecfg.drops[t].items[n][0])||a.push(this._bossStagecfg.drops[t].items[n][0]);return a=this.SortItemList(a)}},SortItemList:function(e){for(var t=[],a=0;a<e.length;++a){var n=[],i=c.getItemInfoCfgById(e[a]),r=o(i,2);n[0]=r[0],n[1]=r[1],n[1].id=e[a],t.push(n)}
t.sort(function(e,t){return e[1].quality!=t[1].quality?t[1].quality-e[1].quality:e[0]!=t[0]?t[0]-e[0]:void 0});var s=[];for(a=0;a<t.length;++a)
s.push(t[a][1].id);return s},RemoveAssetsByChildren:function(){for(var e=this.node.getComponentsInChildren("EliteStageSelectItem"),t=0;t<e.length;++t)
e[t].RemoveAssets()},UpdateStarRewardInfo:function(){this.SetStarRewardInfo()},RewardInfo_OnClickHandler:function(e){var t=cc.instantiate(this.m_pStarRewardPre);this.node.addChild(t),t.active=!0;var a={rewardinfo:null==this._stageinfo?null:this._stageinfo.star_award,rewards:this._stagejson.rewards,star:this._curStar,group:this._curGroup,cb:this.UpdateStarRewardInfo.bind(this),type:1};t.getComponent("StageRewardInfo").ChangeData(a)},Back_onclickHandler:function(e){MyUiManager.Back(),r.playBtnCloseEffect()},onDestroy:function(){d.instance=null,n.removeListener(i.S2CElitePointAwardGet,this.S2CElitePointAwardGet_cb_func)},showGuide:function(){var t=this;function e(e){return 1==e?t._stageitemlist[0].getComponent("EliteStageSelectItem").getGuideNode():2==e?t._stageitemlist[4].getComponent("EliteStageSelectItem").getGuideNode():void 0}
s.isFirstEcsGuided()?s.isCanFightBoss()&&s.showGuide("EliteStageLayer",e):s.showGuide("EliteStageLayer",e)}});cc._RF.pop()},{EliteStageBufferMgr:"EliteStageBufferMgr",EliteStagesConfigMgr:"EliteStagesConfigMgr",GuideBufferMgr:"GuideBufferMgr",ItemCfgUtilMgr:"ItemCfgUtilMgr",MyEventDispatcher:"MyEventDispatcher",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],StageEventCfgMgr:[function(c,e,t){"use strict";cc._RF.push(e,"3b8eaB3N01M/4+Y854cwuV6","StageEventCfgMgr");var l=function(){};l.getStageEvtCfg=function(e){var t=DonotDestroyManager.GameData.StageEvents[e];if(t)
return t},l.getStageEvtTri=function(e){var t=l.getStageEvtCfg(e);if(t)
return t.tri},l.getStageEvtList=function(e){var t=l.getStageEvtCfg(e);if(t)
return t.events},l.getTypeEvtCfgList=function(e,t){for(var a=l.getStageEvtList(e),n=[],i=0;i<a.length;i++){var r=a[i];r[0]==t&&n.push(r)}
return n},l.getEvtTeam=function(e){for(var t=l.getTypeEvtCfgList(e,2),a=[],n=c("ReinForceCfgMgr"),i=0;i<t.length;i++){var r=t[i],s=n.getTeamCfgList(r[2]),o=0==r[1]||3==r[1]?"left":"right";a.push({list:s,side:o})}
return a},l.getEvtTeamList=function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a],i=l.getEvtTeam(n);t.push(i)}
return t},l.getEvtBuff=function(e){for(var t=l.getTypeEvtCfgList(e,4),a=[],n=0;n<t.length;n++){var i=t[n];a.push(i[2])}
return a},l.getEvtBuffList=function(e){for(var a=[],t=function(e){for(var t=0;t<a.length;t++){if(e==a[t])
return!0}
return!1},n=0;n<e.length;n++)
for(var i=e[n],r=l.getEvtBuff(i),s=0;s<r.length;s++){var o=r[s];t(o)||a.push(o)}
return a},e.exports=l,cc._RF.pop()},{ReinForceCfgMgr:"ReinForceCfgMgr"}],StageFallItem:[function(e,t,a){"use strict";cc._RF.push(t,"e4a3d1SV8JPdJ/BIzu4SGCK","StageFallItem");var i=e("StagesConfigMgr"),n=e("ShaderUtil"),r=e("SoundUtil"),s=e("EliteStagesConfigMgr"),o=e("ArmyPanel");cc.Class({extends:cc.Component,properties:{m_pStagename:cc.Label,m_pStageType:cc.Label,m_pQXspr:cc.Sprite,m_pWKFspr:cc.Sprite,m_pBg:cc.Node,_stageid:-1,_stagejson:null,_stageinfo:null,_isunlock:!1},onLoad:function(){},ChangeData:function(e){this._stageinfo=e,this.Init()},Init:function(){if(this.m_pStagename.string=this._stageinfo.name,1==this._stageinfo.stageType)
this.m_pStageType.string="Thường",null!=MyPersistDataManager._playerData.chapterslist[this._stageinfo.group-1]&&(this._isunlock=!0);else{var e=s.getGroupIdByStage(this._stageinfo.stageId);null!=MyPersistDataManager._playerData.chapterselitelist[e-1]&&(this._isunlock=!0),this.m_pStageType.string="Tinh Anh"}
this.m_pQXspr.node.active=this._isunlock,this.m_pWKFspr.node.active=!this._isunlock,this._isunlock||n.setGaryShader(this.m_pBg)},OnClickHandler:function(e){if(r.playBtnOpenEffect(),this._isunlock){var t=!1;if(1!=this._stageinfo.stageType&&(t=!0),null!=o.getInstance()&&o.getInstance().markScrollOffset(),t)
MyUiManager.Open(MyUiManager.PanelInfo.StageEliteSelectPanel,{stageinfo:MyPersistDataManager._playerData.chapterselitelist,group:this._stageinfo.prev_elitestage_group,chapterid:this._stageinfo.chapter_id});else{var a=this._stageinfo.stageId,n=i.getStageIndex(a);null!=MyPersistDataManager._playerData.chapterslist[this._stageinfo.group-1]&&MyPersistDataManager._playerData.chapterslist[this._stageinfo.group-1].stages.length<=n&&(a=null),MyUiManager.Open(MyUiManager.PanelInfo.StageSelectPanel,{stageinfo:MyPersistDataManager._playerData.chapterslist,group:this._stageinfo.group,battletype:1,stageId:a})}}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Chưa mở ải này")}}),cc._RF.pop()},{ArmyPanel:"ArmyPanel",EliteStagesConfigMgr:"EliteStagesConfigMgr",ShaderUtil:"ShaderUtil",SoundUtil:"SoundUtil",StagesConfigMgr:"StagesConfigMgr"}],StageFallPanel:[function(e,t,a){"use strict";cc._RF.push(t,"90a50lhZZ9PbI8pmrFJTguD","StageFallPanel");var i=e("StagesConfigMgr"),r=e("EliteStagesConfigMgr"),n=e("ColorUtil"),s=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pFallitem:cc.Node,m_pFallparent:cc.Node,m_pItemparent:cc.Node,m_pNostagelab:cc.Node,m_pName:cc.Label,m_pNum:cc.Label,_itemid:-1,_itemjson:null,_itemtype:-1},onLoad:function(){},setParams:function(e){this._itemid=e.id,this._itemtype=e.itemtype,this._iteminfo=e,this.Init()},Init:function(){this.m_pNostagelab.active=!1;var i=this;cc.loader.loadRes("Prefab/ItemBox/ItemBox",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);i.m_pItemparent.addChild(a);var n=a.getComponent("ItemBox");n.ChangeItemInfo(i._itemid,0),i.m_pName.string=n._itemjsoninfo.name,i.InitContent(n)}),this.CreateFallItem()},InitContent:function(e){var t=0;0==this._itemtype?(this._itemjson=DonotDestroyManager.GameData.CardFrags[this._itemid],t=e._itemjsoninfo.craft_num):1==this._itemtype?(this._itemjson=DonotDestroyManager.GameData.UnitsEquips[this._itemid],t=this._iteminfo.num):2==this._itemtype&&(this._itemjson=DonotDestroyManager.GameData.EquipFrags[this._itemid],t=this._itemjson.craft_num),this.m_pName.node.color=n.getColorByQuality(this._itemjson.quality);var a=null==MyPersistDataManager._playerData.bagMap[this._itemid]?0:MyPersistDataManager._playerData.bagMap[this._itemid].num;this.m_pNum.string=a+"/"+t,this.m_pNum.node.color=t<=a?cc.Color.GREEN:cc.Color.RED},CreateFallItem:function(){for(var e=i.getStageFallList(this._itemid),t=r.getStageFallList(this._itemid),a=0;a<e.length;++a){var n=cc.instantiate(this.m_pFallitem);this.m_pFallparent.addChild(n),n.active=!0,n.getComponent("StageFallItem").ChangeData(e[a])}
for(a=0;a<t.length;++a){n=cc.instantiate(this.m_pFallitem);this.m_pFallparent.addChild(n),n.active=!0,n.getComponent("StageFallItem").ChangeData(t[a])}
e.length<=0&&t.length<=0&&(this.m_pNostagelab.active=!0)},Mask_OnClickHandler:function(e){MyUiManager.Back(),s.playBtnCloseEffect()}}),cc._RF.pop()},{ColorUtil:"ColorUtil",EliteStagesConfigMgr:"EliteStagesConfigMgr",SoundUtil:"SoundUtil",StagesConfigMgr:"StagesConfigMgr"}],StageMapPanel:[function(e,t,a){"use strict";cc._RF.push(t,"9ef03YD6G1AzbXqPFvROFx4","StageMapPanel");var _=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=e("UnLockCfgMgr"),u=e("StageBufferMgr"),r=e("EliteStageBufferMgr"),c=e("SoundUtil"),i=e("GuideBufferMgr"),m=e("CrawlCfgMgr"),p=e("StagesConfigMgr"),s=e("EliteStagesConfigMgr"),o=["UI/Stage/bg_xgdt","UI/Stage/bg_xgdt_1","UI/Stage/bg_xgdt_2","UI/Stage/bg_xgdt_3","UI/Stage/bg_xgdt_4"],l=["UI/Stage/bg_xgdt_01","UI/Stage/bg_xgdt_02","UI/Stage/bg_xgdt_03","UI/Stage/bg_xgdt_04","UI/Stage/bg_xgdt_05"],h=e("i18n"),d=cc.Class({extends:cc.Component,properties:{m_pContent:cc.Node,m_pContentparent:cc.Node,m_pLeftArrow:cc.Node,m_pRightArrow:cc.Node,m_pTopStageName:cc.Sprite,m_pStageNormalParent:cc.Node,m_pNormalLabel:cc.Label,m_pEliteLabel:cc.Label,m_pEnergyLabel:cc.Label,m_pBg:cc.Sprite,m_pNormalBtn:cc.Node,m_pEliteBtn:cc.Node,m_pEliteRedPoint:cc.Node,m_pUnLockFuncLayer:cc.Node,m_pStageNormalItem:cc.Prefab,m_pStageEliteItem:cc.Prefab,m_pChallengeContent:cc.Node,m_pUnlockContent:cc.Node,m_pUnlockIcon:cc.Sprite,m_pChallengenum:cc.RichText,UI_parent_node:cc.Node,FunctionBtnBar:cc.Prefab,m_pStageNormalName:[cc.SpriteFrame],m_pStageEliteName:[cc.SpriteFrame],_stageNormalList:[],_stageEliteList:[],_stagejson:null,_functionBarNode:cc.Node,_curChapterId:-1,_curGroup:-1,_isElite:!1,_mapinfo:null,_nextstagecontent:null,_lastclickarrow:"",_lckItemList:[]},statics:{instance:null,getInstance:function(){return d.instance}},onLoad:function(){d.instance=this;var e=cc.instantiate(this.FunctionBtnBar);this.UI_parent_node.addChild(e),e.setPosition(cc.p(0,0)),(this._functionBarNode=e).getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").changeStatus(0)},setParams:function(e){this._mapinfo=e,this.InitChapterdata(),this.Init()},InitChapterdata:function(){if(this._mapinfo.iselite){if(this._curChapterId=this._mapinfo.chapter_id||r.mLastChapterid,0==this._curChapterId){var e=r.getCurChapStageSubId(),t=_(e,3),a=t[0];t[1],t[2];this._curChapterId=a}}else if(this._curChapterId=this._mapinfo.chapter_id||u.mLastChapterid,0==this._curChapterId){var n=u.getCurChapGroupStageId(),i=_(n,3);a=i[0],i[1],i[2];this._curChapterId=a}},Init:function(){if(this.GetStageJson(),this.ClearStageItem(),this.UpdateArrow(),this.m_pEnergyLabel.string=MyPersistDataManager._playerData.energy+"/"+DonotDestroyManager.GameData.Levels[MyPersistDataManager._playerData.level-1].max_energy,this._mapinfo.iselite){var e=l[this._curChapterId-1],a=this;cc.loader.loadRes(e,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=a&&cc.isValid(a.node)&&(a.m_pBg.spriteFrame=t)}),this.m_pTopStageName.spriteFrame=this.m_pStageEliteName[this._curChapterId-1],this.m_pChallengeContent.active=!0,this.m_pUnlockContent.active=!1,this.m_pNormalBtn.active=!0,this.m_pEliteBtn.active=!1,this.m_pNormalLabel.node.color=cc.Color.WHITE,this.m_pEliteLabel.node.color=new cc.color(180,143,47),this._curGroup=this.GetCurGroup(MyPersistDataManager._playerData.chapterselitelist,!0);for(var t=0;t<5;++t){(r=5*(this._curChapterId-1)+t)<MyPersistDataManager._playerData.chapterselitelist.length?this.CreateStageEliteItem(MyPersistDataManager._playerData.chapterselitelist[r],r,t):this.CreateStageEliteItem(null,r,t)}
var n=DonotDestroyManager.GameData.Common.elite_dailylimit;0<MyPersistDataManager._playerData.elite_count?this.m_pChallengenum.string=h.t("stage_002",{value:"<color=#00ff00>"+MyPersistDataManager._playerData.elite_count+"/"+n+"</c>"}):this.m_pChallengenum.string=h.t("stage_002",{value:"<color=#ff0000>"+MyPersistDataManager._playerData.elite_count+"/"+n+"</c>"})}else{a=this;this.GetUnLockList(),null==this._lckItemList||this._lckItemList.length<=0?this.m_pUnlockContent.active=!1:(this.m_pUnlockContent.active=!0,cc.loader.loadRes("UI/Unlock/"+this._lckItemList[0].icon.replace(".png",""),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),a.m_pUnlockIcon.spriteFrame=t}));var i=o[this._curChapterId-1];a=this;cc.loader.loadRes(i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=a&&cc.isValid(a.node)&&(a.m_pBg.spriteFrame=t)}),this.m_pTopStageName.spriteFrame=this.m_pStageNormalName[this._curChapterId-1],this.m_pChallengeContent.active=!1,this.m_pNormalBtn.active=!1,this.m_pEliteBtn.active=!0,this.m_pNormalLabel.node.color=new cc.color(180,143,47),this.m_pEliteLabel.node.color=cc.Color.WHITE,this._curGroup=this.GetCurGroup(MyPersistDataManager._playerData.chapterslist,!1),cc.log(" trước mặt quan tạp tiến độ ==="+this._curGroup);for(t=0;t<5;++t){var r;(r=5*(this._curChapterId-1)+t)<MyPersistDataManager._playerData.chapterslist.length?this.CreateStageNormalItem(MyPersistDataManager._playerData.chapterslist[r],r,t):this.CreateStageNormalItem(null,r,t)}
this.UnlockInfo()}
-1<MyPersistDataManager._playerData.RedPoint.indexOf(7)?this.m_pEliteRedPoint.active=!0:this.m_pEliteRedPoint.active=!1},GetStageJson:function(){this._mapinfo.iselite?this._stagejson=DonotDestroyManager.GameData.EliteStages:this._stagejson=DonotDestroyManager.GameData.Stages},AddUnlockHint:function(){this.m_pUnLockFuncLayer.active=!0,this.m_pUnLockFuncLayer.getComponent("StageUnLockFuncLayer").ChangeData(this._lckItemList)},GetUnLockList:function(){this._lckItemList=[];for(var e=n.getLockIdsByGroup(this._curGroup),t=0,a=0;a<e.length&&!(4<=t);++a)
u.isStageIdPassed(e[a].stage)||(this._lckItemList.push(e[a]),++t)},UnlockInfo:function(){var e=u.getCurChapGroupStageId(),t=_(e,3),a=(t[0],t[1]),n=t[2],i=p.getNextStage(n),r=p.getGroupIdByStage(i),s=u.getCrawlInfoState(),o=_(s,2),c=o[0],l=o[1],h=u.getGroupUnlock(),d=this;1<r&&a<r&&m.isHaveCrawl(c,"ed")&&c+1==r&&0==l?this.node.runAction(cc.sequence(cc.delayTime(.3),cc.callFunc(function(){MyUiManager.Open(MyUiManager.PanelInfo.StageStoryLayer,{groupId:c,eventType:"ed",cb:function(){d.node.runAction(cc.sequence(cc.delayTime(.4),cc.callFunc(function(){this.showGuide(this._stageNormalList)},d))),u.sendCrawlStateInfo(c,"ed"),d._stageNormalList[r-1].getComponent("StageNormalItem").unLockGroup()}})},this))):(0<h&&this.node.runAction(cc.sequence(cc.delayTime(.6),cc.callFunc(function(){d._stageNormalList[(h-1)%5].getComponent("StageNormalItem").unLockGroup()}))),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide(this._stageNormalList)},this))))},GetCurGroup:function(e,t){var a=-1;if(null==e||e.length<=0)
return 1;a=e.length;var n=0;if(t){var i=Object.keys(this._stagejson[a-1].stage),r=i.indexOf("_iN$t");-1<r&&i.splice(r,1),n=i.length}else
n=this._stagejson[a-1].stage.length;return e[a-1].stages.length==n&&(a+=1),a},CreateStageNormalItem:function(e,t,a){var n=null;a<this._stageNormalList.length?n=this._stageNormalList[a]:(n=cc.instantiate(this.m_pStageNormalItem),this.m_pStageNormalParent.addChild(n),this._stageNormalList.push(n)),n.active=!0,n.getComponent("StageNormalItem").ChangeData(e,t);var i=750/1334/(cc.director.getVisibleSize().height/cc.director.getVisibleSize().width),r=667-(667-this._stagejson[t].pos[0])*i;n.setPosition(r,this._stagejson[t].pos[1])},CreateStageEliteItem:function(e,t,a){var n=null;a<this._stageEliteList.length?n=this._stageEliteList[a]:(n=cc.instantiate(this.m_pStageEliteItem),this.m_pStageNormalParent.addChild(n),this._stageEliteList.push(n)),n.active=!0,n.getComponent("StageEliteItem").ChangeData(e,t);var i=750/1334/(cc.director.getVisibleSize().height/cc.director.getVisibleSize().width),r=667-(667-this._stagejson[t].pos[0])*i;n.setPosition(r,this._stagejson[t].pos[1])},ClearStageItem:function(){if(null!=this._stageEliteList&&0<this._stageEliteList.length)
for(var e=0;e<this._stageEliteList.length;++e)
this._stageEliteList[e].active=!1;if(null!=this._stageNormalList&&0<this._stageNormalList.length)
for(e=0;e<this._stageNormalList.length;++e)
this._stageNormalList[e].active=!1},Arrow_OnClickHandler:function(e,t){if(c.playBtnOpenEffect(),null!=this._nextstagecontent){if(this._lastclickarrow==t)
return;this._nextstagecontent.stopAllActions(),this.m_pContent.stopAllActions()}else{var a="0"==t?-this.node.width:this.node.width;this._nextstagecontent=cc.instantiate(this.m_pContent),this.m_pContent.setPosition(a,0),this.m_pContentparent.addChild(this._nextstagecontent),this._curChapterId="0"==t?this._curChapterId-1:this._curChapterId+1,this.Init()}
this.UpdateArrow();var n=0,i=0;"0"==t?(n=-this.m_pContent.getPosition().x,i=this.node.width-this._nextstagecontent.getPosition().x):(n=-this.m_pContent.getPosition().x,i=this._nextstagecontent.getPosition().x-this.node.width);var r=this,s=cc.moveBy(.2,cc.p(n,0)),o=cc.sequence(cc.moveBy(.2,cc.p(i,0)),cc.callFunc(function(){null!=r._nextstagecontent&&(r._nextstagecontent.removeFromParent(),r._nextstagecontent.destroy(),r._nextstagecontent=null)}));this._nextstagecontent.runAction(o),this.m_pContent.runAction(s),this._lastclickarrow=t},UpdateArrow:function(){var e=0;if(this._mapinfo.iselite){if(null==MyPersistDataManager._playerData.chapterselitelist||MyPersistDataManager._playerData.chapterselitelist.length<=0)
e=1;else if(MyPersistDataManager._playerData.chapterselitelist.length%5==0){var t=MyPersistDataManager._playerData.chapterselitelist.length-1;e=s.getStageCount(this._stagejson[t])==MyPersistDataManager._playerData.chapterselitelist[t].stages.length&&MyPersistDataManager._playerData.chapterselitelist.length<this._stagejson.length?parseInt(MyPersistDataManager._playerData.chapterselitelist.length/5)+1:parseInt(MyPersistDataManager._playerData.chapterselitelist.length/5)}else
e=parseInt(MyPersistDataManager._playerData.chapterselitelist.length/5)+1;r.mLastChapterid=this._curChapterId}else{if(null==MyPersistDataManager._playerData.chapterslist||MyPersistDataManager._playerData.chapterslist.length<=0)
e=1;else if(MyPersistDataManager._playerData.chapterslist.length%5==0){t=MyPersistDataManager._playerData.chapterslist.length-1;e=this._stagejson[t].stage.length==MyPersistDataManager._playerData.chapterslist[t].stages.length&&MyPersistDataManager._playerData.chapterslist.length<this._stagejson.length?parseInt(MyPersistDataManager._playerData.chapterslist.length/5)+1:parseInt(MyPersistDataManager._playerData.chapterslist.length/5)}else
e=parseInt(MyPersistDataManager._playerData.chapterslist.length/5)+1;u.mLastChapterid=this._curChapterId}
if(this._curChapterId==e){if(1==e)
return this.m_pLeftArrow.active=!1,void(this.m_pRightArrow.active=!1);this.m_pLeftArrow.active=!0,this.m_pRightArrow.active=!1}else if(this._curChapterId<e){if(1==this._curChapterId)
return this.m_pLeftArrow.active=!1,void(this.m_pRightArrow.active=!0);this.m_pLeftArrow.active=!0,this.m_pRightArrow.active=!0}},RemoveAssetsByChildren:function(){for(var e=this.node.getComponentsInChildren("StageEliteItem"),t=0;t<e.length;++t)
e[t].RemoveAssets()},BuyEnergy_OnClickHandler:function(){c.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.BuyEnergy,{})},Unlock_OnClickHandler:function(e){cc.log(" điểm đánh giải khóa cái nút "),this.AddUnlockHint()},Btn_OnClickHandler:function(e,t){if(c.playBtnOpenEffect(),this._mapinfo.iselite)
this._mapinfo.iselite=!this._mapinfo.iselite,this.InitChapterdata(),this.Init();else{var a=this;n.isUnlockCallBack(24,function(){a._mapinfo.iselite=!a._mapinfo.iselite,a.InitChapterdata(),a.Init(),a.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide(this._stageEliteList)},a)))})}},Back_onclickHandler:function(e){MyUiManager.Back(),c.playBtnCloseEffect(),this._mapinfo.closeCb&&this._mapinfo.closeCb()},onDestroy:function(){d.instance=null},showGuide:function(a){var n=this;i.showGuide("SectionMainLayer",function(e){var t=n._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar");switch(e){case 1:return t._openCallback=function(){n.showGuide()},t.mControlBtn;case 2:return t.mMenuItemTable[0];case 3:return t.mMenuItemTable[1];case 4:return t.mMenuItemTable[2];case 5:return t.mMenuItemTable[3];case 6:return t.mMenuItemTable[4];case 7:return a[0].getChildByName("stage_1");case 8:return a[1].getChildByName("stage_1");case 9:return a[0].getChildByName("item_bg");case 10:return n.m_pEliteBtn;case 11:return a[2].getChildByName("stage_1");case 12:return a[0].getChildByName("stage_1")}})}});cc._RF.pop()},{CrawlCfgMgr:"CrawlCfgMgr",EliteStageBufferMgr:"EliteStageBufferMgr",EliteStagesConfigMgr:"EliteStagesConfigMgr",GuideBufferMgr:"GuideBufferMgr",SoundUtil:"SoundUtil",StageBufferMgr:"StageBufferMgr",StagesConfigMgr:"StagesConfigMgr",UnLockCfgMgr:"UnLockCfgMgr",i18n:"i18n"}],StageNormalItem:[function(e,t,a){"use strict";cc._RF.push(t,"e507bYlwUlDvYQb8ef2pp00","StageNormalItem");var s=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=e("StageMapPanel"),c=(e("GameUtils"),e("i18n")),l=e("StageBufferMgr"),h=e("SoundUtil"),n=e("StagesConfigMgr"),d=e("CrawlCfgMgr");cc.Class({extends:cc.Component,properties:{m_pBoxeffectPre:cc.Prefab,m_pStarRewardPre:cc.Prefab,m_pStageName:cc.Label,m_pStarNum:cc.RichText,m_pBox:cc.Sprite,m_pStarInfoNode:cc.Node,m_pLockIcon:cc.Node,m_pStageSpr:cc.Sprite,m_pStageyy:cc.Sprite,m_pUnlock:cc.Node,m_pUnlockdes:cc.Label,m_pBoxNormalSpr:[cc.SpriteFrame],m_pBoxOpenSpr:[cc.SpriteFrame],m_pBoxdisableSpr:[cc.SpriteFrame],_stageinfo:null,_index:-1,_stagejson:null,_rewardindex:-1,_iscanopen:!1,_curStar:0,_AllStar:0,_boxeffect:null,_stagenormalspr:null,_stagePressSpr:null,_stageyinying:null},onLoad:function(){},ChangeData:function(e,t){this._stageinfo=e,this._index=t,this.Init()},Init:function(){var a=this;this._stagejson=DonotDestroyManager.GameData.Stages[this._index],this.SetStarRewardInfo(),this.m_pStageName.string=this._stagejson.name;var e="Chapter"+o.getInstance()._curChapterId;if(cc.log(" quan tạp đường nhỏ ==="+e),cc.loader.loadRes("UI/StageMap/"+e+"/"+this._stagejson.icon[0].replace(".png",""),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=a._stagenormalspr&&a._stagenormalspr!=t&&(a._stagenormalspr=null),a._stagenormalspr=t,a.m_pStageSpr.spriteFrame=t,a.m_pStageSpr.getComponent(cc.Button).normalSprite=t}),cc.loader.loadRes("UI/StageMap/"+e+"/"+this._stagejson.icon[1].replace(".png",""),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=a._stagePressSpr&&a._stagePressSpr!=t&&(a._stagePressSpr=null),a._stagePressSpr=t,a.m_pStageSpr.getComponent(cc.Button).pressedSprite=t}),cc.loader.loadRes("UI/StageMap/"+e+"/"+this._stagejson.icon[2].replace(".png",""),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=a._stageyinying&&a._stageyinying!=t&&(a._stageyinying=null),a._stageyinying=t,a.m_pStageyy.spriteFrame=t}),this.mGroupOpenLv=n.getSectionGroupReqLv(this._index+1),this.mGroupState=MyPersistDataManager._playerData.level>=this.mGroupOpenLv,this.mGroupUnlock=this.mGroupState&&this._index+1<=o.getInstance()._curGroup,!this.mGroupUnlock)
return this.m_pUnlock.active=!0,this.m_pUnlockdes.string="Cấp Bang đạt "+this._stagejson.require_level+" mở",this.m_pStageSpr.node.color=cc.Color.GRAY,this.m_pStarInfoNode.active=!1,void(this.m_pStageName.node.color=cc.Color.GRAY);var t=l.getGroupUnlock();if(0<t&&t==this._index+1){a=this;this.m_pUnlock.active=!0,this.m_pUnlockdes.string="Cấp Bang đạt "+this._stagejson.require_level+" mở",this.m_pStageSpr.node.color=cc.Color.GRAY,this.m_pStarInfoNode.active=!1,this.m_pStageName.node.color=cc.Color.GRAY}else
this.m_pUnlock.active=!1,this.m_pStageSpr.node.color=cc.Color.WHITE,this.m_pStarInfoNode.active=!0,this.m_pStageName.node.color=cc.Color.WHITE},unLockGroup:function(){if(this.mGroupOpenLv=n.getSectionGroupReqLv(this._index+1),this.mGroupState=MyPersistDataManager._playerData.level>=this.mGroupOpenLv,this.mGroupState){l.setGroupUnlock(0),this.m_pUnlock.active=!0,this.m_pStageSpr.node.color=cc.Color.GRAY,this.m_pStarInfoNode.active=!1,this.m_pStageName.node.color=cc.Color.GRAY,h.playUnlockLevelEffect();var e=this,t=this.m_pLockIcon.getComponent(dragonBones.ArmatureDisplay);t.armature().animation.fadeIn("action1",-1,1,0,"normal"),t.addEventListener(dragonBones.EventObject.COMPLETE,function(){e.m_pUnlock.active=!1,e.m_pStageSpr.node.color=cc.Color.WHITE,e.m_pStarInfoNode.active=!0,e.m_pStageName.node.color=cc.Color.WHITE},this)}},SetStarRewardInfo:function(){this._curStar=this.GetCurStar(),this._rewardindex=this.GetCurCanReceiveIndex(),-1==this._rewardindex?this._AllStar=this._stagejson.rewards[this._stageinfo.star_award.length-1].star:this._AllStar=this._stagejson.rewards[this._rewardindex].star,this._curStar<this._AllStar?this.m_pStarNum.string="<color=#ff0000>"+this._curStar+"</c><color=#ffffff>/"+this._AllStar+"</color>":this.m_pStarNum.string="<color=#00ff00>"+this._curStar+"</c><color=#ffffff>/"+this._AllStar+"</color>",this.SetBoxState(this._rewardindex)},SetBoxState:function(e){null!=this._boxeffect&&(this._boxeffect.removeFromParent(),this._boxeffect.destroy(),this._boxeffect=null),this.m_pBox.node.active=!0;-1!=e?this._curStar>=this._AllStar?(this.m_pBox.node.active=!1,this.CreateBoxEffect()):this.m_pBox.spriteFrame=this.m_pBoxdisableSpr[e]:this.m_pBox.spriteFrame=this.m_pBoxOpenSpr[this._stageinfo.star_award.length-2]},CreateBoxEffect:function(){var e=["mu","blue","gold"];this._boxeffect=cc.instantiate(this.m_pBoxeffectPre),this.m_pBox.node.parent.addChild(this._boxeffect),this._boxeffect.setScale(.65),this.node.runAction(cc.sequence(cc.delayTime(.04),cc.callFunc(function(){this._boxeffect.getComponent(sp.Skeleton).setAnimation(0,"Action1_"+e[this._rewardindex],!0)},this))),this._boxeffect.setPosition(this.m_pBox.node.getPosition())},UpdateStarRewardInfo:function(){this.SetStarRewardInfo()},StageOnClickHandler:function(e){if(h.playBtnOpenEffect(),cc.log(o.getInstance()._curGroup),this._index+1>o.getInstance()._curGroup)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),c.t("stage_001"));else if(MyPersistDataManager._playerData.level<this.mGroupOpenLv)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),c.t("stage_003",{value:this.mGroupOpenLv}));else{var t=l.getCrawlInfoState(),a=s(t,2),n=a[0],i=a[1];if(this.mGroupId=this._index+1,d.isHaveCrawl(this.mGroupId,"op"))
if(n+1==this.mGroupId&&0<i){var r=this;MyUiManager.Open(MyUiManager.PanelInfo.StageStoryLayer,{groupId:this.mGroupId,eventType:"op",cb:function(){l.sendCrawlStateInfo(r.mGroupId,"op"),MyUiManager.Open(MyUiManager.PanelInfo.StageSelectPanel,{stageinfo:MyPersistDataManager._playerData.chapterslist,group:r._stagejson.group,battletype:1})}})}else
MyUiManager.Open(MyUiManager.PanelInfo.StageSelectPanel,{stageinfo:MyPersistDataManager._playerData.chapterslist,group:this._stagejson.group,battletype:1});else
n+1==this.mGroupId&&l.sendCrawlStateInfo(this.mGroupId,"op"),MyUiManager.Open(MyUiManager.PanelInfo.StageSelectPanel,{stageinfo:MyPersistDataManager._playerData.chapterslist,group:this._stagejson.group,battletype:1})}},RewardInfo_OnClickHandler:function(e){h.playBtnOpenEffect();var t=cc.instantiate(this.m_pStarRewardPre);o.getInstance().node.addChild(t),t.active=!0;var a={rewardinfo:null==this._stageinfo?null:this._stageinfo.star_award,rewards:this._stagejson.rewards,star:this._curStar,group:this._stagejson.group,cb:this.UpdateStarRewardInfo.bind(this),type:0};t.getComponent("StageRewardInfo").ChangeData(a)},GetCurCanReceiveIndex:function(){var e=-1;if(null==this._stageinfo)
return 0;if(null==this._stageinfo.star_award||this._stageinfo.star_award.length<=0)
return 0;for(var t=0;t<this._stageinfo.star_award.length;++t)
if(0==this._stageinfo.star_award[t]){e=t;break}
return e},GetCurStar:function(){if(null==this._stageinfo)
return 0;for(var e=0,t=0;t<this._stageinfo.stages.length;++t)
e+=this._stageinfo.stages[t].star;return e},onDestroy:function(){this._stagenormalspr,this._stagenormalspr=null,this._stagePressSpr,this._stagePressSpr=null,this._stageyinying,this._stageyinying=null}}),cc._RF.pop()},{CrawlCfgMgr:"CrawlCfgMgr",GameUtils:"GameUtils",SoundUtil:"SoundUtil",StageBufferMgr:"StageBufferMgr",StageMapPanel:"StageMapPanel",StagesConfigMgr:"StagesConfigMgr",i18n:"i18n"}],StageRewardInfo:[function(e,t,a){"use strict";cc._RF.push(t,"36336o3zNND6ZjripP/6Lkn","StageRewardInfo");var n=e("MyEventDispatcher"),i=e("NetEvent"),r=e("SoundUtil"),s=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pStagerewarditem:cc.Node,m_pRewardParent:cc.Node,m_pRewardPanel:cc.Prefab,_rewardlist:null,_rewarditemlist:[],_rewarditem:null,_starreward:null,_curstar:-1,_group:-1,_cb:null,_type:-1},onLoad:function(){this.S2CBoxAwardGet_cb_func=this.S2CBoxAwardGet_cb.bind(this),n.addListener(i.S2CBoxAwardGet,this.S2CBoxAwardGet_cb_func),this.S2CEliteBoxAwardGet_cb_func=this.S2CEliteBoxAwardGet_cb.bind(this),n.addListener(i.S2CEliteBoxAwardGet,this.S2CEliteBoxAwardGet_cb_func)},ChangeData:function(e){this._curstar=e.star,this._rewardlist=e.rewards,this._starreward=e.rewardinfo,this._group=e.group,this._cb=e.cb,this._type=e.type,this.Init()},Init:function(){this.DisRewardItem(),this._rewarditemlist=new Array;for(var e=0;e<this._rewardlist.length;++e){var t=!1;null!=this._starreward&&e<this._starreward.length&&(t=this._starreward[e]),null!=this._rewarditemlist&&e<this._rewarditemlist.length?(this._rewarditemlist[e].active=!0,this._rewarditemlist[e].getComponent("StageRewardItem").ChangeData({info:this._rewardlist[e],receive:t,index:e,star:this._curstar,group:this._group,type:this._type})):this.CreateRewardItem(this._rewardlist[e],e,t)}
this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},S2CBoxAwardGet_cb:function(e){if(cc.log(" tiếp thu được lĩnh thưởng cho tin tức "),this.ShowReward(e),null==MyPersistDataManager._playerData.chapterslist[e.group_index].star_award||MyPersistDataManager._playerData.chapterslist[e.group_index].star_award.length<=0)
for(var t=0;t<this._rewardlist.length;++t)
MyPersistDataManager._playerData.chapterslist[e.group_index].star_award.push(!1);MyPersistDataManager._playerData.chapterslist[e.group_index].star_award[e.box_index]=!0;var a={info:this._rewardlist[e.box_index],receive:!0,index:e.box_index,star:this._curstar,group:this._group,type:this._type};this._rewarditemlist[e.box_index].getComponent("StageRewardItem").ChangeData(a),null!=this._cb&&this._cb()},S2CEliteBoxAwardGet_cb:function(e){if(cc.log(" tiếp thu được tinh anh quan tạp lĩnh thưởng cho tin tức "),this.ShowReward(e),null==MyPersistDataManager._playerData.chapterselitelist[e.group_index].star_award||MyPersistDataManager._playerData.chapterselitelist[e.group_index].star_award.length<=0)
for(var t=0;t<this._rewardlist.length;++t)
MyPersistDataManager._playerData.chapterselitelist[e.group_index].star_award.push(!1);MyPersistDataManager._playerData.chapterselitelist[e.group_index].star_award[e.box_index]=!0;var a={info:this._rewardlist[e.box_index],receive:!0,index:e.box_index,star:this._curstar,group:this._group,type:this._type};this._rewarditemlist[e.box_index].getComponent("StageRewardItem").ChangeData(a),null!=this._cb&&this._cb()},ShowReward:function(e){cc.log(" nhận sử dụng đạo cụ ");var a=[];this._rewardlist[e.box_index].items.forEach(function(e,t){a.push({itemId:e[0],cnt:e[1]})}),0<this._rewardlist[e.box_index].money&&a.push({itemId:1451,cnt:this._rewardlist[e.box_index].money}),0<this._rewardlist[e.box_index].gamemoney&&a.push({itemId:1450,cnt:this._rewardlist[e.box_index].gamemoney});var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=a},CreateRewardItem:function(e,t,a){var n=cc.instantiate(this.m_pStagerewarditem);n.active=!0,this.m_pRewardParent.addChild(n),n.setPosition(0,-98*t),this._rewarditemlist.push(n),n.getComponent("StageRewardItem").ChangeData({info:e,receive:a,index:t,star:this._curstar,group:this._group,type:this._type})},DisRewardItem:function(){if(null!=this._rewarditemlist)
for(var e=0;e<this._rewarditemlist.length;++e)
this._rewarditemlist[e].active=!1},Mask_OnClickHandler:function(e){r.playBtnCloseEffect(),this.node.removeFromParent(),this.node.destroy(),s.isRecruitHero()&&MyUiManager.backAll()},onDestroy:function(){n.removeListener(i.S2CBoxAwardGet,this.S2CBoxAwardGet_cb_func),n.removeListener(i.S2CEliteBoxAwardGet,this.S2CEliteBoxAwardGet_cb_func)},showGuide:function(){var t=this;s.showGuide("StageStarReward",function(e){if(1==e)
return t._rewarditemlist[0].getComponent("StageRewardItem").m_pBtnReceive.node})}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",NetEvent:"NetEvent",SoundUtil:"SoundUtil"}],StageRewardItem:[function(e,t,a){"use strict";cc._RF.push(t,"8294e3rXeJNmKFfzK3TWLmD","StageRewardItem");var n=e("MyProtocols");cc.Class({extends:cc.Component,properties:{m_pStarNum:cc.Label,m_pBtnReceive:cc.Button,m_pBtnylq:cc.Node,m_pItemBox:cc.Prefab,m_pItemParent:cc.Node,_rewardinfo:null,_itembox:null,_rewardindex:-1,_itemindex:0,_isreceive:!1,_itemlist:[],_curStar:-1,_group:-1,_type:-1},onLoad:function(){},ChangeData:function(e){this._curStar=e.star,this._rewardindex=e.index,this._rewardinfo=e.info,this._isreceive=e.receive,this._group=e.group,this._type=e.type,this.Init()},Init:function(){for(var e=this._itemindex=0;e<this._rewardinfo.items.length;++e)
this.CreateItemBox(this._rewardinfo.items[e][0],this._rewardinfo.items[e][1]);if(0<this._rewardinfo.money&&this.CreateItemBox(1451,this._rewardinfo.money,!1),0<this._rewardinfo.gamemoney&&this.CreateItemBox(1450,this._rewardinfo.gamemoney,!1),this.m_pStarNum.string=this._rewardinfo.star,this.m_pBtnReceive.node.active=!this._isreceive,this.m_pBtnylq.active=this._isreceive,this._isreceive||(this._curStar<this._rewardinfo.star?this.m_pBtnReceive.interactable=!1:this.m_pBtnReceive.interactable=!0),this._itemindex<this._itemlist.length)
for(e=this._itemindex;e<this._itemlist.length;++e)
this._itemlist[e].active=!1},CreateItemBox:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=null;if(this._itemindex<this._itemlist.length)
this._itemlist[this._itemindex].active=!0,n=this._itemlist[this._itemindex].getComponent("ItemBox");else{var i=cc.instantiate(this.m_pItemBox);this.m_pItemParent.addChild(i),n=i.getComponent("ItemBox"),this._itemlist.push(i)}
n.ChangeItemInfo(e,t,!0,null,a),n.node.setPosition(150*this._itemindex,0),++this._itemindex},OnClickHandler:function(e){0==this._type?n.send_C2SBoxAwardGet(DonotDestroyManager._gameSocket,this._group-1,this._rewardindex):n.send_C2SEliteBoxAwardGet(DonotDestroyManager._gameSocket,this._group-1,this._rewardindex)}}),cc._RF.pop()},{MyProtocols:"MyProtocols"}],StageSelectItem:[function(e,t,a){"use strict";cc._RF.push(t,"9e680POwsJE75z0UB4s5Hb+","StageSelectItem");var s=e("StageSelectPanel"),o=e("StageBufferMgr"),c="normal",l=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pStageIndex:cc.Label,m_pChallengeNum:cc.Label,m_pStageIcon:cc.Sprite,m_pStageSelect:cc.Sprite,m_pStarList:[cc.Sprite],m_pUnlock:cc.Node,m_pSprDisable:cc.Sprite,m_pUnlockContent:cc.Node,m_pUnlockfunc:cc.Node,m_pUnlockName:cc.Label,m_punlockDes:cc.Label,m_pStarFramsList:[cc.SpriteFrame],m_pStageiconFramsList:[cc.SpriteFrame],m_pStageSelectFramsList:[cc.SpriteFrame],m_pStageDisFramsList:[cc.SpriteFrame],_stageinfo:null,_index:0,_stagejsoninfo:null,_cb:null,_curstar:0,_lckitem:null,_CanBattleNum:-1},onLoad:function(){},ChangeData:function(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=arguments[4];this._stageinfo=e,this._index=a,this._stagejsoninfo=t,this._cb=n,this._lckitem=i,this.Init()},Init:function(){this.m_pStageIndex.string=this._index+1;var e=this._stagejsoninfo.isboss?1:0;if(this.m_pStageIcon.spriteFrame=this.m_pStageiconFramsList[e],this.m_pStageSelect.spriteFrame=this.m_pStageSelectFramsList[e],this.m_pSprDisable.spriteFrame=this.m_pStageDisFramsList[e],null==this._stageinfo){this._CanBattleNum=this._stagejsoninfo.daily_limit;for(var t=this._curstar=0;t<this.m_pStarList.length;++t)
this.m_pStarList[t].spriteFrame=this.m_pStarFramsList[1]}else{this._CanBattleNum=this._stageinfo.times,this._curstar=this._stageinfo.star;for(t=0;t<this.m_pStarList.length;++t)
t<this._stageinfo.star?this.m_pStarList[t].spriteFrame=this.m_pStarFramsList[0]:this.m_pStarList[t].spriteFrame=this.m_pStarFramsList[1]}
if(this.m_pChallengeNum.string=this._CanBattleNum+"/"+this._stagejsoninfo.daily_limit,cc.log("StageSelectPanel.getInstance()._curselectstage==="+s.getInstance()._curselectstage),cc.log("this._index==="+this._index),o.getStageIdUnLock()==this._stagejsoninfo.id){this.m_pUnlock.active=!0,this.m_pUnlockfunc.active=!1;var a=this,n=this.m_pUnlock.getComponent(dragonBones.ArmatureDisplay);(i=n.armature()).animation.fadeIn("action2",-1,1,0,c),this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){l.playUnlockLevelEffect(),i.animation.fadeIn("action1",-1,1,0,c),o.setStageIdUnLock(0),n.addEventListener(dragonBones.EventObject.COMPLETE,function(){a.m_pUnlockContent.active=!1},a)})))}else if(this._index<=s.getInstance()._curStageID-1)
this.m_pUnlockContent.active=!1;else if(this._lckitem)
this.m_pUnlockContent.active=!0,this.m_pUnlock.active=!1,this.m_pUnlockfunc.active=!0,this.m_pUnlockName.string="["+this._lckitem.des+"]",this.m_punlockDes.string=this._lckitem.des2;else{this.m_pUnlockContent.active=!0,this.m_pUnlock.active=!0,this.m_pUnlockfunc.active=!1;var i;n=this.m_pUnlock.getComponent(dragonBones.ArmatureDisplay);(i=n.armature()).animation.fadeIn("action2",-1,1,0,c)}
var r=new cc.Component.EventHandler;r.target=this.node,r.component="StageSelectItem",r.handler="OnClickHandler",this.node.getComponent(cc.Button).clickEvents[0]=r},OnClickHandler:function(e){this._index>s.getInstance()._curStageID-1?cc.log(" quan tạp còn không có giải khóa "):null!=this._cb&&this._cb(e,this._index)},SetSelect:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.m_pStageSelect.node.active=e}}),cc._RF.pop()},{SoundUtil:"SoundUtil",StageBufferMgr:"StageBufferMgr",StageSelectPanel:"StageSelectPanel"}],StageSelectPanel:[function(r,e,t){"use strict";cc._RF.push(e,"61bc13KqsZDTru5olCoLy3s","StageSelectPanel");var l=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},h=r("UnLockCfgMgr"),a=r("MyEventDispatcher"),n=r("MyProtocols"),i=r("NetEvent"),d=r("StageBufferMgr"),s=r("SoundUtil"),o=r("GuideBufferMgr"),_=(r("GameUtils"),r("CrawlCfgMgr")),c=r("PlayerBufferMgr"),u=cc.Class({extends:cc.Component,properties:{m_pBoxeffectPre:cc.Prefab,m_pStarRewardPre:cc.Prefab,m_pStageItemParent:cc.Node,m_pItemboxParent:cc.Node,m_pItembox:cc.Prefab,m_pStageItem:cc.Prefab,m_pBtnSweeplab:cc.Label,m_pEnergy:cc.Label,m_pExp:cc.Label,m_pMoney:cc.Label,m_pSaodangquan:cc.Label,m_pStageName:cc.Label,m_pStarNum:cc.RichText,m_pBox:cc.Sprite,m_pSaodangcontent:cc.Node,m_pSweepTips:cc.Node,m_pScrollView:cc.ScrollView,startBtn:cc.Node,ivStarReward:cc.Node,m_pBoxNormalSpr:[cc.SpriteFrame],m_pBoxOpenSpr:[cc.SpriteFrame],m_pBoxdisableSpr:[cc.SpriteFrame],FunctionBtnBar:cc.Prefab,_curgroup:-1,_stageinfo:null,_stagejsoninfo:null,_curStageID:0,_defaultStageId:null,_stageitem:null,_itembox:null,_stageitemlist:[],_itemboxlist:[],_functionBarNode:cc.Node,_lastselectstage:-1,_curselectstage:-1,_curStar:0,_AllStar:0,_boxeffect:null,_battleType:-1,_sweepitemNum:-1,_exp:-1,_money:-1},statics:{instance:null,getInstance:function(){return u.instance}},onLoad:function(){(u.instance=this)._lastselectstage=-1,this.S2CSweepStage_cb_func=this.S2CSweepStage_cb.bind(this),a.addListener(i.S2CSweepStage,this.S2CSweepStage_cb_func);var e=cc.instantiate(this.FunctionBtnBar);this.node.addChild(e),e.setPosition(cc.p(0,0)),(this._functionBarNode=e).getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").changeStatus(0)},setParams:function(e){this._stageinfo=e.stageinfo[e.group-1],this._curgroup=e.group,this._battleType=e.battletype,this._defaultStageId=e.stageId,this.Init()},Init:function(){this._stagejsoninfo=DonotDestroyManager.GameData.Stages[this._curgroup-1],null==this._stageinfo?this._curStageID=1:this._curStageID=this._stageinfo.stages.length+1,this.SetStarRewardInfo(),this.m_pStageName.string=this._stagejsoninfo.name;for(var e=h.getLockIdsByGroup(this._curgroup,!0),t={},a=0;a<e.length;++a){t[e[a].stage-100*this._curgroup]=e[a]}
this.CreateAllStageItem(t),null!=this._defaultStageId?this.Stage_OnClickHandler(null,this._defaultStageId%100-1):null==this._stageinfo||this._stageinfo.stages.length==this._stagejsoninfo.stage.length?this.Stage_OnClickHandler(null,0):this.Stage_OnClickHandler(null,this._curStageID-1),this.RefreshSweepInfo(this._curselectstage);var n=d.getCrawlInfoState(),i=l(n,2),r=i[0],s=i[1],o=d.getGroupUnlock(),c=this;0<o?_.isHaveCrawl(this._curgroup,"ed")&&r==this._curgroup&&0==s?this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){MyUiManager.Open(MyUiManager.PanelInfo.StageStoryLayer,{groupId:this._curgroup,eventType:"ed",cb:function(){c.showGuide()}})},this))):this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this))):(0==_.isHaveCrawl(this._curgroup,"ed")&&r==this._curgroup&&0==s&&d.sendCrawlStateInfo(this._curgroup,"ed"),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this))))},RefreshSweepItemNum:function(){this._sweepitemNum=0,null!=MyPersistDataManager._playerData.bagMap[1010]&&(this._sweepitemNum=MyPersistDataManager._playerData.bagMap[1010].num),this.m_pSaodangquan.string="x"+this._sweepitemNum},RefreshSweepInfo:function(e){this.RefreshSweepItemNum(),this._CanSweepNum=0,null!=this._stageinfo&&null!=this._stageinfo.stages[e]?this._CanSweepNum=this._stageinfo.stages[e].times:this._CanSweepNum=this._stagejsoninfo.stage[e].daily_limit,10<this._CanSweepNum&&(this._CanSweepNum=10),this.m_pBtnSweeplab.string="Quét "+this._CanSweepNum+" lần"},S2CSweepStage_cb:function(e){cc.log("Received a sweep message"),MyPersistDataManager._playerData.chaptersMaplist[e.group_index+1].stages[e.stage_index].times=e.times,this._stageinfo=MyPersistDataManager._playerData.chaptersMaplist[e.group_index+1],this._stageitemlist[e.stage_index].getComponent("StageSelectItem").m_pChallengeNum.string=this._stageinfo.stages[e.stage_index].times+"/"+this._stagejsoninfo.stage[e.stage_index].daily_limit,this.RefreshSweepInfo(e.stage_index),MyUiManager.Open(MyUiManager.PanelInfo.SweepLayer,{rewardinfo:e,exp:this._exp,gamemoney:this._money,closeCb:this.sweepLayerCloseHanlder.bind(this)})},sweepLayerCloseHanlder:function(){s.playBtnCloseEffect(),c.isLevelUpAble()&&cc.loader.loadRes("Prefab/ui/mainhome/LevelUpLayer",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);c.showLevelUpLayer(a,function(){})})},SetStarRewardInfo:function(){this._curStar=this.GetCurStar();var e=this.GetCurCanReceiveIndex();this._AllStar=-1==e?this._stagejsoninfo.rewards[this._stageinfo.star_award.length-1].star:this._stagejsoninfo.rewards[e].star,this._curStar<this._AllStar?this.m_pStarNum.string="<color=#ff0000>"+this._curStar+"</c><color=#ffffff>/"+this._AllStar+"</color>":this.m_pStarNum.string="<color=#00ff00>"+this._curStar+"</c><color=#ffffff>/"+this._AllStar+"</color>",this.SetBoxState(e)},SetBoxState:function(e){null!=this._boxeffect&&(this._boxeffect.removeFromParent(),this._boxeffect.destroy(),this._boxeffect=null),this.m_pBox.node.active=!0;-1!=e?this._curStar>=this._AllStar?(this.m_pBox.node.active=!1,this.CreateBoxEffect(e)):this.m_pBox.spriteFrame=this.m_pBoxdisableSpr[e]:this.m_pBox.spriteFrame=this.m_pBoxOpenSpr[this._stageinfo.star_award.length-2]},CreateBoxEffect:function(e){this._boxeffect=cc.instantiate(this.m_pBoxeffectPre),this.m_pBox.node.parent.addChild(this._boxeffect),this._boxeffect.setScale(.65),this._boxeffect.getComponent(sp.Skeleton).setAnimation(0,"Action1_"+["mu","blue","gold"][e],!0),this._boxeffect.setPosition(this.m_pBox.node.getPosition())},GetCurCanReceiveIndex:function(){var e=-1;if(null==this._stageinfo)
return 0;if(null==this._stageinfo.star_award||this._stageinfo.star_award.length<=0)
return 0;for(var t=0;t<this._stageinfo.star_award.length;++t)
if(0==this._stageinfo.star_award[t]){e=t;break}
return e},GetCurStar:function(){if(null==this._stageinfo)
return 0;for(var e=0,t=0;t<this._stageinfo.stages.length;++t)
e+=this._stageinfo.stages[t].star;return e},CreateAllStageItem:function(e){for(var t=0;t<this._stagejsoninfo.stage.length;++t)
null!=this._stageinfo&&t<this._stageinfo.stages.length?this.CreateAStageItem(this._stageinfo.stages[t],this._stagejsoninfo.stage[t],t,e[t+1]):this.CreateAStageItem(null,this._stagejsoninfo.stage[t],t,e[t+1])},CreateAStageItem:function(e,t,a,n){var i=null,r=this.Stage_OnClickHandler.bind(this),s=cc.instantiate(this.m_pStageItem);i=s.getComponent("StageSelectItem"),this.m_pStageItemParent.addChild(s),i.ChangeData(e,t,a,r,n),this._stageitemlist.push(i.node)},SetStageInfo:function(e){this.DisableRewardlist(),this._exp=this._stagejsoninfo.stage[e].exp,this._money=this._stagejsoninfo.stage[e].gamemoney,this.m_pEnergy.string="x"+this._stagejsoninfo.stage[e].energy_cost,this.m_pExp.string="x"+this._exp,this.m_pMoney.string="x"+this._money;for(var a=[],t=function(e){for(var t=0;t<a.length;++t)
if(e==a[t])
return!0;return!1},n=0;n<this._stagejsoninfo.stage[e].drops.length;++n)
t(this._stagejsoninfo.stage[e].drops[n].items[0][0])||a.push(this._stagejsoninfo.stage[e].drops[n].items[0][0]);for(n=0;n<a.length;++n)
n<this._itemboxlist.length?(this._itemboxlist[n].active=!0,this._itemboxlist[n].getComponent("ItemBox").ChangeItemInfo(a[n],0,!1,null,!0),this._itemboxlist[n].setPosition(110*n,0)):this.CreateRewardBox(a[n],n);this._stageitemlist[e].getComponent("StageSelectItem")._curstar<=0?this.m_pSaodangcontent.active=!1:this.m_pSaodangcontent.active=!0},CreateRewardBox:function(e,t){var a=null;if(null==this._itembox)
this._itembox=cc.instantiate(this.m_pItembox),a=this._itembox.getComponent("ItemBox"),this.m_pItemboxParent.addChild(this._itembox),this._itembox.setPosition(110*t,0);else{var n=cc.instantiate(this._itembox);a=n.getComponent("ItemBox"),this.m_pItemboxParent.addChild(n),n.setPosition(110*t,0)}
a.ChangeItemInfo(e,0,!1,null,!0),this._itemboxlist.push(a.node)},DisableRewardlist:function(){for(var e=0;e<this._itemboxlist.length;++e)
this._itemboxlist[e].active=!1},UpdateStarRewardInfo:function(){this.SetStarRewardInfo()},RewardInfo_OnClickHandler:function(e){s.playBtnOpenEffect();var t=cc.instantiate(this.m_pStarRewardPre);this.node.addChild(t),t.active=!0;var a={rewardinfo:null==this._stageinfo?null:this._stageinfo.star_award,rewards:this._stagejsoninfo.rewards,star:this._curStar,group:this._stagejsoninfo.group,cb:this.UpdateStarRewardInfo.bind(this),type:0};t.getComponent("StageRewardInfo").ChangeData(a)},FightBtn_OnClickHandler:function(e){if(s.playBtnOpenEffect(),this._CanSweepNum<=0)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Số lần tấn công vào ngày hôm nay đã được sử dụng,xin vui lòng trở lại vào ngày mai!");else{var t=DonotDestroyManager.GameData.StageMobs[this._stagejsoninfo.stage[this._curselectstage].id],a={name:" đệ "+(this._curselectstage+1)+" quan LV"+this._stagejsoninfo.require_level,fight:0,formation:t.formation,Teams:this.GetEnemyTeams(),id:this._stagejsoninfo.stage[this._curselectstage].id,forward:t.forward,flip:t.flip},n={energy_cost:this._stagejsoninfo.stage[this._curselectstage].energy_cost,require_level:this._stagejsoninfo.stage[this._curselectstage].require_level,fid:1},i=r("PVEBattleManager");i.init(a.id),a.teams=i.rightData.teams,MyUiManager.Open(MyUiManager.PanelInfo.BattleFormationPanel,{leftinfo:{},rightinfo:a,panelinfo:n,battletype:this._battleType})}},GetEnemyTeams:function(){for(var e=DonotDestroyManager.GameData.StageMobs[this._stagejsoninfo.stage[this._curselectstage].id],t=1,a=[];null!=e[t];){var n={};n.id=e[t].mob_id,n.level=this._stagejsoninfo.stage[this._curselectstage].attrs[e[t].mob_type-1].level,n.position=e[t].position,a.push(n),++t}
return a},Sweep_OnClickHandler:function(e){if(s.playBtnOpenEffect(),this._CanSweepNum<=0)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Kiểm tra số lượng đã được sử dụng vào ngày hôm nay,xin vui lòng trở lại vào ngày mai!");else{if(this._sweepitemNum<=0){var t=this,a=DonotDestroyManager.GameData.Common.sweep_cost_money;return MyPersistDataManager._playerData.money<a?(this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),void this._alert_layer.getComponent("AlertLayerManager").initContent("Không đủ vàng,Nạp tiền?",function(){MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1}),null!=t._alert_layer&&(t._alert_layer.removeFromParent(),t._alert_layer.destroy(),t._alert_layer=null)})):(this.m_pSweepTips.active=!0,void this.m_pSweepTips.getComponent("SweepTips").ChangeData(a,function(){n.send_C2SSweepStage(DonotDestroyManager._gameSocket,t._curgroup-1,t._curselectstage,1,2),t.m_pSweepTips.active=!1}))}
n.send_C2SSweepStage(DonotDestroyManager._gameSocket,this._curgroup-1,this._curselectstage,1,1)}},SweepTen_OnClickHandler:function(e){if(s.playBtnOpenEffect(),this._CanSweepNum<=0)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),"Kiểm tra số lượng đã được sử dụng vào ngày hôm nay,xin vui lòng trở lại vào ngày mai!");else{if(this._sweepitemNum<this._CanSweepNum){var t=this,a=DonotDestroyManager.GameData.Common.sweep_cost_money*this._CanSweepNum;return MyPersistDataManager._playerData.money<a?(this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),void this._alert_layer.getComponent("AlertLayerManager").initContent("Không đủ vàng,Nạp tiền?",function(){MyUiManager.Open(MyUiManager.PanelInfo.VipPayMgn,{closeCb:null,state:-1}),null!=t._alert_layer&&(t._alert_layer.removeFromParent(),t._alert_layer.destroy(),t._alert_layer=null)})):(this.m_pSweepTips.active=!0,void this.m_pSweepTips.getComponent("SweepTips").ChangeData(a,function(){n.send_C2SSweepStage(DonotDestroyManager._gameSocket,t._curgroup-1,t._curselectstage,t._CanSweepNum,2),t.m_pSweepTips.active=!1}))}
n.send_C2SSweepStage(DonotDestroyManager._gameSocket,this._curgroup-1,this._curselectstage,this._CanSweepNum,1)}},Stage_OnClickHandler:function(e,t){var a=parseInt(t),n=0;n=a<3?0:a>this._stagejsoninfo.stage.length-3?1:(2*(a-4.5)+5)/this._stagejsoninfo.stage.length,this.m_pScrollView.scrollToPercentHorizontal(n,.4,!0),this._lastselectstage!=a&&(-1!=this._lastselectstage&&this._stageitemlist[this._lastselectstage].getComponent("StageSelectItem").SetSelect(!1),this._curselectstage=a,this._stageitemlist[this._curselectstage].getComponent("StageSelectItem").SetSelect(),this.SetStageInfo(a),this.RefreshSweepInfo(a),this._lastselectstage=this._curselectstage)},Back_onclickHandler:function(e){MyUiManager.Back(),s.playBtnCloseEffect()},onDestroy:function(){u.instance=null,a.removeListener(i.S2CSweepStage,this.S2CSweepStage_cb_func)},showGuide:function(){var a=this;o.showGuide("StageSelectorLayer",function(e){var t=a._functionBarNode.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar");return 1==e?(t._openCallback=function(){a.showGuide()},t.mControlBtn):2==e?t.mMenuItemTable[0]:3==e?t.mMenuItemTable[1]:4==e?t.mMenuItemTable[2]:5==e?t.mMenuItemTable[3]:6==e?t.mMenuItemTable[4]:7==e?a.startBtn:8==e?a.ivStarReward:void 0},function(){})}});cc._RF.pop()},{CrawlCfgMgr:"CrawlCfgMgr",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",PVEBattleManager:"PVEBattleManager",PlayerBufferMgr:"PlayerBufferMgr",SoundUtil:"SoundUtil",StageBufferMgr:"StageBufferMgr",UnLockCfgMgr:"UnLockCfgMgr"}],StageStoryLayer:[function(e,t,a){"use strict";cc._RF.push(t,"30fc5SJYIpBprrC+Zrpumue","StageStoryLayer");e("SoundUtil");cc.Class({extends:cc.Component,properties:{layout1:cc.Node,layout2:cc.Node,myFontFamily:cc.Font,_isFinish:!1},setParams:function(e){var t=e.groupId,a=e.eventType;this._cb=e.cb,this.initUi(t,a),this._isFinish=!1},initUi:function(e,t){this.speed=80,this.story=DonotDestroyManager.GameData.Crawl[e-1][t];for(var a=0;a<this.story.length;a++){var n=this.story[a];this.layout1.addChild(this.createParagraph(n,!0)),this.layout2.addChild(this.createParagraph(n,!0))}},createParagraph:function(e,t){var a=new cc.Node,n=a.addComponent(cc.RichText);n.fontSize=32,n.maxWidth=730,n.handleTouchEvent=!1,n.lineHeight=46,n.font=this.myFontFamily;for(var i=" ",r=0;r<e.length;r++)"red"==e[r]&&t?i+="<color=#ff6600>"+e[++r]+"</color>":"green"==e[r]&&t?i+="<color=#00ff00>"+e[++r]+"</color>":("red"!=e[r]&&"green"!=e[r]||r++,i+=t?"<color=#ffffcc>"+e[r]+"</color>":"<color=#ffcc00>"+e[r]+"</color>");return n.string=i,a},bgClickHanlder:function(e){2==this.state?(this.node.stopAllActions(),MyUiManager.Back(),null!=this._cb&&this._cb()):80==this.speed&&(this.speed=400)},update:function(e){this.layout1.getPositionY()<460?(this.layout1.setPositionY(this.layout1.getPositionY()+e*this.speed),this.layout2.setPositionY(this.layout2.getPositionY()+e*this.speed),this.state=1):(this.state=2,this._isFinish||(this._isFinish=!0,this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){MyUiManager.Back(),null!=this._cb&&this._cb()},this)))))}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],StageUnLockFuncLayer:[function(e,t,a){"use strict";cc._RF.push(t,"fa7c4SRz+JFBKr0iHITEyiV","StageUnLockFuncLayer"),cc.Class({extends:cc.Component,properties:{m_pUnlockFuncItem:cc.Node,m_pParent:cc.Node,_lockinfolist:null,_unlockitemList:[]},onLoad:function(){},ChangeData:function(e){this._lockinfolist=e,this.Init()},Init:function(){this.CreateUnlockFuncItem()},CreateUnlockFuncItem:function(){for(var e=0;e<this._lockinfolist.length;++e){var t=null;e<this._unlockitemList.length?t=this._unlockitemList[e]:(t=cc.instantiate(this.m_pUnlockFuncItem),this.m_pParent.addChild(t)),t.active=!0,this._unlockitemList.push(t),t.getComponent("UnLockFuncItem").ChangeData(this._lockinfolist[e])}},Mask_OnClickHandler:function(e){this.node.active=!1}}),cc._RF.pop()},{}],StagesConfigMgr:[function(e,t,a){"use strict";cc._RF.push(t,"832adeeAuFCXq7rg9iIg0oH","StagesConfigMgr");var o=function(){};o.getGroupIdByStage=function(e){return Math.floor(e/100)},o.getStageIndex=function(e){return e%100-1},o.getStageBackground=function(e){return DonotDestroyManager.GameData.StageMobs[e].battleground},o.getStageGroup=function(e){return DonotDestroyManager.GameData.Stages[e-1]},o.getNextGroupId=function(e){var t=DonotDestroyManager.GameData.Stages.length;return t<(e+=1)?t:e},o.getStageGroupNameById=function(e){return this.getStageGroup(e).name},o.getStageGroupNameId=function(e){var t=this.getStageGroupNameById(this.getGroupIdByStage(e)),a=0;return a=1e3<e?e.toString().substr(2):e.toString().substr(1),cc.js.formatStr("%s· đệ %s quan ",t,parseInt(a))},o.getStage=function(e,t){for(var a=o.getStageGroup(e),n=0;n<a.stage.length;n++){var i=a.stage[n];if(i.id==t)
return i}},o.getStageFallList=function(e){for(var t=[],a=DonotDestroyManager.GameData.Stages,n=0;n<a.length;++n)
for(var i=0;i<a[n].stage.length;++i)
for(var r={},s=!1,o=0;o<a[n].stage[i].drops.length;++o){for(var c=0;c<a[n].stage[i].drops[o].items.length;++c)
if(a[n].stage[i].drops[o].items[c][0]==e){r.chapter_id=a[n].chapter_id,r.group=a[n].group,r.stageId=a[n].stage[i].id,r.name=a[n].name,r.stageType=1,t.push(r),s=!0;break}
if(s)
break}
return t},o.getStageByStageId=function(e){return o.getStage(o.getGroupIdByStage(e),e)},o.getLastStageIdGroup=function(e){var t=o.getStageGroup(e);return t.stage[t.stage.length-1].id},o.isLastStageIdInGroup=function(e){var t=o.getGroupIdByStage(e);return e==o.getLastStageIdGroup(t)},o.getStageUnLockInfo=function(e){for(var t=o.getGroupIdByStage(e),a="",n=DonotDestroyManager.GameData.Stages,i=0;i<n.length;++i){var r=n[i];if(r.group==t){a=r.name;break}}
return[a,e%100]},o.getSectionGroupReqLv=function(e){return o.getStageGroup(e).require_level},o.getNextStage=function(e){var t=0,a=o.getGroupIdByStage(e),n=o.getLastStageIdGroup(a);e<n?t=e+1:e==n&&(t=100*(a+1)+1);var i=DonotDestroyManager.GameData.Stages,r=i[i.length-1].stage,s=r[r.length-1].id;return s<t&&(t=s),t},t.exports=o,cc._RF.pop()},{}],StagesEventManager:[function(h,e,t){"use strict";cc._RF.push(e,"a5944LbzmVHlrmolAziHCc1","StagesEventManager");h("MeleeSoldier"),h("RemoteSoldier");var c=h("BattleConstants"),d=h("MyEventDispatcher"),_=h("StageBufferMgr"),u=h("EliteStageBufferMgr"),a=function(){this.triggers={},this.eventDelay=0,this.eventCallBack=null};a.prototype.resetData=function(){this.triggers={},this.eventDelay=0,this.eventCallBack=null},a.prototype.initTriggers=function(e){for(var t=0;t<e.tri.length;t++){var a=e.tri[t],n=a[0];this.triggers[n]=this.triggers[n]||[],this.triggers[n].push([a,e.events])}},a.prototype.doStageEvents=function(c,i){var r=0,l=this;(function s(){i&&i();var t,a,n,o,e=c[r];e&&(1==e[0]?(l.eventDelay=e[3],o=r,l.eventCallBack=function(){var e=h("BattleManager"),t=e.otrside.stageId,a=!1;if(1===e.type?a=_.isStageIdPassed(t):2===e.type&&(a=u.isStageIdPassed(t)),a)
s();else{var n=DonotDestroyManager.GameData.BattleTalk,i=c[o],r=n.Message[i[1]][i[2]-1];r&&d.dispatchEvent("onBattleTalk",[r,s])}}):2==e[0]?(l.eventDelay=e[3],n=r,l.eventCallBack=function(){var e=c[n],t=e[1],a=e[2];d.dispatchEvent("onCreateEventArmies",[t,a]),s()}):3==e[0]?(l.eventDelay=e[3],a=r,l.eventCallBack=function(){var e=c[a];d.dispatchEvent("onEventCastSkill",[e[1],e[2]]),s()}):7==e[0]&&(l.eventDelay=e[3],t=r,l.eventCallBack=function(){var e=c[t];d.dispatchEvent("onGuideTeamSkill",[e[1],s])}),r+=1)})()},a.prototype.dispatchTrigger1=function(e){for(var t=this.triggers[1]||[],a=0;a<t.length;a++){var n,i=t[a],r=i[0];e.side()==c._BTL_SIDE.OUR?n=0:e.side()==c._BTL_SIDE.OTR&&(n=1);var s=e.tid,o=e.hp/e.basehp;if(r[1]==n&&(0==r[2]||r[2]==s)&&r[3]>=o){this.doStageEvents(i[1]),this.triggers[1].splice(a,1);break}}},a.prototype.dispatchTrigger2=function(e){for(var t=this.triggers[2]||[],a=0;a<t.length;a++){var n,i=t[a],r=i[0];e.side()==c._BTL_SIDE.OUR?n=0:e.side()==c._BTL_SIDE.OTR&&(n=1);var s=e.tid;if(r[1]==n&&(0==r[2]||r[2]==s)){this.doStageEvents(i[1]),this.triggers[2].splice(a,1);break}}},a.prototype.dispatchTrigger3=function(e){for(var t=this.triggers[3]||[],a=0;a<t.length;a++){var n,i=t[a],r=i[0];e.side()==c._BTL_SIDE.OUR?n=0:e.side()==c._BTL_SIDE.OTR&&(n=1);var s=e.tid;if(r[1]==n&&(0==r[2]||r[2]==s)){this.doStageEvents(i[1]),this.triggers[3].splice(a,1);break}}},a.prototype.dispatchTrigger4=function(e){var t=h("BattleUiMgr");null!=t.getInstance()&&0<t.getInstance().gBtlSpeed&&(e*=t.getInstance().gBtlSpeed);for(var a=this.triggers[4]||[],n=0;n<a.length;n++){var i=a[n];if(i[0][1]<e){this.doStageEvents(i[1]),this.triggers[4].splice(n,1);break}}},a.prototype.dispatchTrigger5=function(e,t){for(var a=this.triggers[5]||[],n=0;n<a.length;n++){var i=a[n],r=i[0];if(r[1]==e&&r[2]>t){this.doStageEvents(i[1]),this.triggers[5].splice(n,1);break}}},a.prototype.dispatchTrigger10=function(e,t){for(var a=this.triggers[10]||[],n=0;n<a.length;n++){var i=a[n];if(i[0][1]==e)
return this.doStageEvents(i[1],t),void this.triggers[10].splice(n,1)}
t&&t()},a.prototype.onUpdate=function(e){0<=this.eventDelay&&this.eventCallBack&&(this.eventDelay=this.eventDelay-e,this.eventDelay<0&&h("BattleManager").btlState==c._BTL_STATE.ING&&this.eventCallBack())},e.exports=new a,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleManager:"BattleManager",BattleUiMgr:"BattleUiMgr",EliteStageBufferMgr:"EliteStageBufferMgr",MeleeSoldier:"MeleeSoldier",MyEventDispatcher:"MyEventDispatcher",RemoteSoldier:"RemoteSoldier",StageBufferMgr:"StageBufferMgr"}],StoreHouseEquipsInfo:[function(t,e,a){"use strict";cc._RF.push(e,"d784aT/5xZOwJ2j00ngmKP6","StoreHouseEquipsInfo");var c=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},l=t("ColorUtil"),h=t("StoreHousePanel"),d=t("i18n"),n=t("MyProtocols"),_=t("EquipBufferMgr"),r=t("SoundUtil"),s=t("UnLockCfgMgr");cc.Class({extends:cc.Component,properties:{m_pEquipName:cc.Label,m_pEquipHeroLab:cc.Label,m_pEquipLevel:cc.Label,m_pAttr1:cc.Label,m_pAttr2:cc.Label,m_pJianjievalue:cc.Label,m_pUnitlab:cc.Label,m_pEquipItemParent:cc.Node,m_pTierItem:cc.Node,m_pTiersParent:cc.Node,m_pEquipBtn:cc.Button,m_pBottomContent:cc.Node,m_pTaozhuangContent:cc.Node,m_pAttrList:[cc.Label],m_pTierAttrList:[cc.Label],m_pItemBox:cc.Prefab,_simpleinfo:null,_attrindex:0,_tierscfg:null,_tiersitemlist:[],_equipbox:null,_tiercount:-1},onLoad:function(){},ChangeData:function(e){null!=e&&(this._simpleinfo=e,this.Init())},Init:function(){this._attrindex=0,null==this._equipbox&&(this._equipbox=cc.instantiate(this.m_pItemBox),this.m_pEquipItemParent.addChild(this._equipbox));var e=this._equipbox.getComponent("ItemBox"),t={template_id:this._simpleinfo.template_id,uuid:this._simpleinfo.uuid};if(e.ChangeEquipInfo(t),null!=e._itemjsoninfo.tier&&0<e._itemjsoninfo.tier&&(null==e._tiereffect?(e._tiereffect=cc.instantiate(h.getInstance()._tierseffect),this._equipbox.addChild(e._tiereffect)):e._tiereffect.active=!0),null!=this._simpleinfo.heroid?(this.m_pEquipHeroLab.node.active=!0,this.m_pEquipHeroLab.string=d.t("sh_043",{value:DonotDestroyManager.GameData.Cards[this._simpleinfo.heroid].name})):this.m_pEquipHeroLab.node.active=!1,this.m_pEquipName.string=e._itemjsoninfo.name,this.m_pEquipName.node.color=l.getColorByQuality(e._itemjsoninfo.quality),this.RefreshEquipAttr(),this.m_pJianjievalue.string=e._itemjsoninfo.des,null!=this._simpleinfo.unitAttr&&0!=this._simpleinfo.unitAttr.id){this.m_pUnitlab.node.active=!0,this.m_pEquipHeroLab.node.active&&this.m_pEquipHeroLab.node.setPosition(-115,-15),this.m_pUnitlab.string=this.getAddUnitAttr(e._itemjsoninfo.unit_type,this._simpleinfo.unitAttr);var a=MyPersistDataManager._playerData.bagMap[this._simpleinfo.uuid].heroid,n=cc.Color.GRAY;if(null!=a){var i=DonotDestroyManager.GameData.Cards[a];e._itemjsoninfo.unit_type==i.unit_type&&(n=cc.color(253,142,0))}
this.m_pUnitlab.node.color=n}else
this.m_pUnitlab.node.active=!1,this.m_pEquipHeroLab.node.active&&this.m_pEquipHeroLab.node.setPosition(-115,-25);if(0!=e._itemjsoninfo.tier){this.m_pTaozhuangContent.active=!0,this._tierscfg=DonotDestroyManager.GameData.Tiers[e._itemjsoninfo.tier];for(var r=this.GetHeroTiersData(),s=0;s<this._tierscfg.equips.length;++s)
if(s<this._tiersitemlist.length){this._tiersitemlist[s].active=!0,this._tiersitemlist[s].getComponent("StoreHouseTiersItem").ChangeData(this._tierscfg.equips[s],"StoreHousePanel",r[this._tierscfg.equips[s]]),this._tiersitemlist[s].setPosition(120*s,0)}else{var o=cc.instantiate(this.m_pTierItem);this.m_pTiersParent.addChild(o),o.active=!0,o.getComponent("StoreHouseTiersItem").ChangeData(this._tierscfg.equips[s],"StoreHousePanel",r[this._tierscfg.equips[s]]),o.setPosition(120*s,0),this._tiersitemlist.push(o)}
this.m_pTierAttrList[0].string=this.SetTierAttributeLab(0,this._tierscfg),this.m_pTierAttrList[1].string=this.SetTierAttributeLab(1,this._tierscfg),this.m_pTierAttrList[2].string=this.SetTierAttributeLab(2,this._tierscfg),this.SetTierAttributeJihuo()}else
this.m_pTaozhuangContent.active=!1},getAddUnitAttr:function(e,t){if(0==t.id)
return"";var a={1:d.t("detail_028"),2:d.t("detail_029"),3:d.t("detail_030"),4:d.t("detail_031"),5:d.t("detail_032")},n={1:d.t("detail_033",{value:t.num}),2:d.t("detail_034",{value:t.num}),3:d.t("detail_035",{value:t.num}),4:d.t("detail_036",{value:t.num})};return t[t.id],d.t("detail_037")+a[e]+n[t.id]},SetTierAttributeJihuo:function(){var e=this._tiercount-1;e<=0&&(e=0);for(var t=0;t<e;++t)
this.m_pTierAttrList[t].node.color=cc.Color.GREEN;for(t=e;t<this.m_pTierAttrList.length;++t)
this.m_pTierAttrList[t].node.color=cc.Color.GRAY},GetHeroTiersData:function(){this._tiercount=0;var e={},t=MyPersistDataManager._playerData.bagMap[this._simpleinfo.uuid].heroid;if(null==t)
return e;var a=MyPersistDataManager._playerData.cardsMaplist[t],n=_.getEquipTierId(this._simpleinfo.uuid);cc.log(" sáo trang id");for(var i=DonotDestroyManager.GameData.Tiers[n],r=0;r<i.equips.length;++r)
e[i.equips[r]]=!1;for(r=0;r<a.equips.length;++r){var s=MyPersistDataManager._playerData.bagMap[a.equips[r]];null!=s&&(null!=e[s.template_id]&&(e[s.template_id]=!0,++this._tiercount))}
return e},SetTierAttributeLab:function(e,t){var a="";switch(e){case 0:a=d.t("sh_013",{value:t.attrs[1].def});break;case 1:a=d.t("sh_014",{value1:t.attrs[2].maxhp,value2:t.attrs[2].atk});break;case 2:a=d.t("sh_015",{value1:t.attrs[2].maxhp,value2:t.attrs[2].atk,value3:t.attrs[3].def})}
return a},RefreshEquipAttr:function(){this.m_pEquipLevel.string="LV."+this._simpleinfo.enhance_level;var e=_.getEquipPropAttr(this._simpleinfo.uuid),t=c(e,3),a=t[0],n=t[1],i=t[2],r=[];if(0!=a&&r.push({attrtype:1,value:a}),0!=n&&r.push({attrtype:2,value:n}),0!=i&&r.push({attrtype:3,value:i}),null!=this._simpleinfo.attrEx&&0<this._simpleinfo.attrEx.length)
for(var s=0;s<this._simpleinfo.attrEx.length;++s)
0!=this._simpleinfo.attrEx[s].id&&0!=this._simpleinfo.attrEx[s].num&&r.push({attrtype:this._simpleinfo.attrEx[s].id,value:this._simpleinfo.attrEx[s].num});for(s=0;s<r.length;++s){this.m_pAttrList[s].node.active=!0;var o=_.getEquipAttrDes(r[s].attrtype);this.m_pAttrList[s].string=o+r[s].value}
if(r.length<this.m_pAttrList.length)
for(s=r.length;s<this.m_pAttrList.length;++s)
this.m_pAttrList[s].node.active=!1},onDestroy:function(){this._tiersitemlist=[],this._equipbox=null},Strengthen_OnClickHandler:function(e){r.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.EquipStrengthLayer,{equipbuffer:this._simpleinfo,cb:this.RefreshEquipAttr.bind(this),map:h.getInstance()._raw_assets})},Refine_OnClickHandler:function(e){r.playBtnOpenEffect();var t=s.getFuncUnLockInfo(40),a=c(t,2),n=a[0],i=a[1];n?MyUiManager.Open(MyUiManager.PanelInfo.EquipRefineLayer,{buffer:this._simpleinfo,cb:this.RefreshEquipAttr.bind(this),map:h.getInstance()._raw_assets}):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),i)},Equip_OnClickHandler:function(e){r.playBtnOpenEffect(),n.send_C2SCardTakeOnItem(DonotDestroyManager._gameSocket,h.getInstance()._additionalParams,this._simpleinfo.uuid),t("HeroDetailsPanel").getInstance().node.active=!0,h.getInstance().node.destroy()}}),cc._RF.pop()},{ColorUtil:"ColorUtil",EquipBufferMgr:"EquipBufferMgr",HeroDetailsPanel:"HeroDetailsPanel",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",StoreHousePanel:"StoreHousePanel",UnLockCfgMgr:"UnLockCfgMgr",i18n:"i18n"}],StoreHouseFragmentInfo:[function(e,t,a){"use strict";cc._RF.push(t,"a4366ymG/1FyIloU96Yrj1C","StoreHouseFragmentInfo");var n=e("ColorUtil"),i=e("i18n"),r=e("MyProtocols"),s=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pItemBox:cc.Prefab,m_pHeChengEffect:cc.Prefab,m_pItemParent:cc.Node,m_pName:cc.Label,m_pNum:cc.Label,m_pDes:cc.Label,m_pXuqiunum:cc.Label,m_pXuqiuType:cc.Label,_simpleinfo:null,_topitembox:null,_params:null,_raw_assets:null,_curnum:-1,_neednum:-1},onLoad:function(){},ChangeData:function(e){this._simpleinfo=e.buffer,this._raw_assets=e.map,this.Init()},Init:function(){null==this._topitembox&&(this._topitembox=cc.instantiate(this.m_pItemBox),this.m_pItemParent.addChild(this._topitembox));var e=this._topitembox.getComponent("ItemBox");e.ChangeItemData(this._simpleinfo,null,!1),this.m_pName.string=e._itemjsoninfo.name,this.m_pName.node.color=n.getColorByQuality(e._itemjsoninfo.quality),this.m_pNum.string=i.t("sh_001",{num:this._simpleinfo.num}),this.m_pDes.string=e._itemjsoninfo.des,this._neednum=e._itemjsoninfo.craft_num,this.m_pXuqiunum.string=i.t("sh_016",{value1:this._simpleinfo.num,value2:e._itemjsoninfo.craft_num}),this._simpleinfo.num<e._itemjsoninfo.craft_num?(this.m_pXuqiuType.string=i.t("sh_017"),this.m_pXuqiuType.node.color=cc.color(253,142,0)):(this.m_pXuqiuType.string=i.t("sh_018"),this.m_pXuqiuType.node.color=cc.Color.GREEN)},showHeChengEffect:function(e){var t=cc.instantiate(this.m_pHeChengEffect);this.m_pItemParent.addChild(t),t.setScale(2),t.setPosition(10,-462);var a=t.getComponent(dragonBones.ArmatureDisplay);a.armature().animation.fadeIn("Animation1",-1,1,0,"normal"),a.addEventListener(dragonBones.EventObject.COMPLETE,function(){t.removeFromParent(),t.destroy(),null!=e&&e()},this)},HeCheng_OnClickHandler:function(e){s.playBtnOpenEffect(),this._simpleinfo.num<this._neednum?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("detail_059")):r.send_C2SEquipFragCompose(DonotDestroyManager._gameSocket,this._simpleinfo.template_id)},Satgefall_OnClickHandler:function(e){s.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.StageFallPanel,{id:this._simpleinfo.template_id,itemtype:2})},onDestroy:function(){this._topitembox=null}}),cc._RF.pop()},{ColorUtil:"ColorUtil",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",i18n:"i18n"}],StoreHouseItemInfo:[function(e,t,a){"use strict";cc._RF.push(t,"30dcfQdgeJPG6IwbPPKYIvE","StoreHouseItemInfo");var r=e("StoreHousePanel"),i=e("TreasuresCfgMgr");cc.Class({extends:cc.Component,properties:{m_pItemBox:cc.Prefab,index:0,_itemboxList:[],_itemmap:null,_itemID:0},onLoad:function(){this._itemmap={}},updateItem:function(e){this._itemID=e;for(var t=-1,a=0;a<4;++a)
if(t=4*e+a,a<this._itemboxList.length)
if(t<r.getInstance()._curitemlist.length){var n=r.getInstance().Itembox_OnClickHandler.bind(r.getInstance());this.ChangeItemBox(a,r.getInstance()._curitemlist[t],n)}else
this.ChangeItemBox(a);else if(t<r.getInstance()._curitemlist.length){n=r.getInstance().Itembox_OnClickHandler.bind(r.getInstance());this.CreateItemBox(a,r.getInstance()._curitemlist[t],n)}else
this.CreateItemBox(a);var i=null;null!=(i=""!=r.getInstance()._curSelectItemuuid?this._itemmap[r.getInstance()._curSelectItemuuid]:this._itemmap[r.getInstance()._curSelectItemID])&&i.getComponent("ItemBox")._itemId==r.getInstance()._curSelectItemID&&i.getComponent("ItemBox")._uuid==r.getInstance()._curSelectItemuuid&&i.getComponent("ItemBox").SetSelect(!0)},CreateItemBox:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=cc.instantiate(this.m_pItemBox),i=n.getComponent("ItemBox");null==t?i.SetEmptyItem():(1==t.bagId||3==t.bagId?i.ChangeItemData(t,a,!1):i.ChangeItemData(t,a,!0),null!=i._itemjsoninfo.tier&&0<i._itemjsoninfo.tier&&(null==i._tiereffect?(i._tiereffect=cc.instantiate(r.getInstance()._tierseffect),n.addChild(i._tiereffect)):i._tiereffect.active=!0)),this.node.addChild(n),n.setPosition(110*e+55,0),this._itemboxList.push(n),0!=i._itemId&&(""!=i._uuid?this._itemmap[i._uuid]=n:this._itemmap[i._itemId]=n)},ChangeItemBox:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this._itemboxList[e].active=!0;var n=this._itemboxList[e].getComponent("ItemBox");null==t?n.SetEmptyItem():(1==t.bagId||3==t.bagId?n.ChangeItemData(t,a,!1):n.ChangeItemData(t,a,!0),null!=n._itemjsoninfo.tier&&0<n._itemjsoninfo.tier&&(null==n._tiereffect?(n._tiereffect=cc.instantiate(r.getInstance()._tierseffect),this._itemboxList[e].addChild(n._tiereffect)):n._tiereffect.active=!0)),this._itemboxList[e].setPosition(110*e+55,0),0!=n._itemId&&(""!=n._uuid?this._itemmap[n._uuid]=this._itemboxList[e]:this._itemmap[n._itemId]=this._itemboxList[e])},getGuideTreaCell:function(){if(null!=this._itemboxList)
for(var e=0;e<this._itemboxList.length;e++){var t=this._itemboxList[e],a=t.getComponent("ItemBox")._itemId,n=i.getTreasureById(a);if(null!=n&&5==n.position&&3198!=a&&3199!=a)
return t}
return null},onDestroy:function(){}}),cc._RF.pop()},{StoreHousePanel:"StoreHousePanel",TreasuresCfgMgr:"TreasuresCfgMgr"}],StoreHouseItempanel:[function(e,t,a){"use strict";cc._RF.push(t,"605d74hxbhOXYfsgVAXazxs","StoreHouseItempanel");var n=e("ColorUtil"),i=e("i18n");cc.Class({extends:cc.Component,properties:{m_pItemBox:cc.Prefab,m_pItemParent:cc.Node,m_pName:cc.Label,m_pNum:cc.Label,m_pDes:cc.Label,_simpleinfo:null,_topitembox:null},onLoad:function(){},ChangeData:function(e){this._simpleinfo=e,this.Init()},Init:function(){null==this._topitembox&&(this._topitembox=cc.instantiate(this.m_pItemBox),this.m_pItemParent.addChild(this._topitembox));var e=this._topitembox.getComponent("ItemBox");e.ChangeItemData(this._simpleinfo,null,!1),this.m_pName.string=e._itemjsoninfo.name,this.m_pName.node.color=n.getColorByQuality(e._itemjsoninfo.quality),this.m_pNum.string=i.t("sh_001",{num:this._simpleinfo.num}),this.m_pDes.string=e._itemjsoninfo.des},onDestroy:function(){this._topitembox=null}}),cc._RF.pop()},{ColorUtil:"ColorUtil",i18n:"i18n"}],StoreHousePanel:[function(e,t,a){"use strict";cc._RF.push(t,"22b68+1SZlG35KTDp/WfKjI","StoreHousePanel");var i=e("SoundUtil"),n=e("ResLoaderManager"),r=e("NetEvent"),s=e("MyEventDispatcher"),o=e("i18n"),c=e("ItemBufferMgr"),l=(e("GameUtils"),e("GuideBufferMgr")),h=e("BagBufferMgr"),d=e("MyUIEvent"),_=e("EquipBufferMgr"),u=e("EquipFragBufferMgr"),m=e("TreasureBufferMgr"),p=e("ConsumeBufferMgr"),f=cc.Class({extends:cc.Component,properties:{m_pConsumAbleInfo:cc.Node,m_pEquipInfo:cc.Node,m_pFragmentInfo:cc.Node,m_pTreasureInfo:cc.Node,m_pItemInfo:cc.Node,m_pRongqi:cc.Label,m_pItemParent:cc.Node,m_pExpandTipPanel:cc.Node,m_pItemBox:cc.Prefab,m_pRewardPanel:cc.Prefab,m_pTiereffectPrefab:cc.Prefab,m_pConsumeMultiuse:cc.Prefab,node_redPoints:[cc.Node],mScrollView:cc.ScrollView,itemTemplate:cc.Prefab,itemTemplateHeight:110,spawnCount:12,spacing:0,bufferZone:600,m_pTabMenuList:[cc.Button],m_pMenuSprList:[cc.SpriteFrame],FunctionBtnBar:cc.Prefab,_baginfoList:[],_itemList:[],_curSelectTabMenuIndex:-1,_lastSelectTabMunuIndex:-1,_itemcfg:null,_tierseffect:null,_curitemlist:[],_curbagExpand:0,_curSelectItemID:-1,_lastSelectItemID:-1,_curSelectItemuuid:"",_lastSelectItemuuid:"",_additionalParams:-1,_equippos:-1,_additionalcb:null,_raw_assets:{default:{},type:Object}},statics:{instance:null,getInstance:function(){return f.instance}},LoadRes:function(){this.toLoadResList=[],this.toLoadResList.push(["UI/PropHints/number_1",cc.LabelAtlas]),this.toLoadResList.push(["UI/PropHints/number_2",cc.LabelAtlas]),this.toLoadResList.push(["UI/PropHints/number_3",cc.LabelAtlas]),this.toLoadResList.push(["UI/PropHints/numberSub_1",cc.LabelAtlas]),this.toLoadResList.push(["Prefab/effect/propHints",cc.Prefab]),this.toLoadResList.push(["Prefab/ItemBox/ItemBox",cc.Prefab]),this.toLoadResList.push(["Prefab/HeroDetailsPanel/HeroEquipInfo",cc.Prefab]),this.toLoadResList.push(["Prefab/ItemBox/itemBorder",cc.Prefab]);var e=this._loadProgressCb.bind(this),t=this._loadFinishCb.bind(this);n.asyncLoadAll(this.toLoadResList,e,t)},_loadProgressCb:function(e){},_loadFinishCb:function(e,t){cc.log("load teamskill resources finish!"),t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this),l.hasPageGuide("StoreHouseLayer")||this.isHasConsumeForSell()},onLoad:function(){this.LoadRes(),this._itemcfg=DonotDestroyManager.GameData.Items,(f.instance=this)._S2CExpandBag_auth_cb_func=this._S2CExpandBag_auth_cb.bind(this),s.addListener(r.S2CExpandBag,this._S2CExpandBag_auth_cb_func),this.UseItem_auth_cb_func=this.UseItem_auth_cb.bind(this),s.addListener(r.S2CUseItem,this.UseItem_auth_cb_func),this.S2CEquipFragCompose_cb_func=this.S2CEquipFragCompose_cb.bind(this),s.addListener(r.S2CEquipFragCompose,this.S2CEquipFragCompose_cb_func),this.S2CTreasureEnhance_cb_func=this.S2CTreasureEnhance_cb.bind(this),s.addListener(d.S2CTreasureEnhance,this.S2CTreasureEnhance_cb_func),this.InitEffectFX();var e=cc.instantiate(this.FunctionBtnBar);this.node.addChild(e),e.setPosition(cc.p(0,0)),e.getChildByName("FunctionBtns").getComponent("MainMenuFuncBtnBar").changeStatus(0)},InitEffectFX:function(){null==this._tierseffect&&(this._tierseffect=cc.instantiate(this.m_pTiereffectPrefab))},setParams:function(e){this._additionalParams=-1,this.Init(e),this.closeCb=e.closeCb,this._additionalcb=e.additionalcb},Init:function(e){if(null!=e.additional){this._additionalParams=e.additional;var t=1;4<this._equippos&&(t=3),this.TabMenuRegisterClickForID(t),this.SetSelectTabMenu(t),this.SetTabMenuGray(t)}else
this.TabMenuRegisterClickEvent(),this.SetSelectTabMenu(null==e.index||-1==e.index?0:e.index);this.refreshRedPoints()},refreshRedPoints:function(){for(var e=h.hasRedPoints(),t=0;t<this.node_redPoints.length;t++){this.node_redPoints[t].active=e[t]}},S2CEquipFragCompose_cb:function(e){var a=this,n=MyPersistDataManager._playerData.bagMap[e.item.uuid],t=this.m_pFragmentInfo.getComponent("StoreHouseFragmentInfo");i.playGainGoodsEffectNew(),t.showHeChengEffect(function(){var e=cc.instantiate(a._raw_assets["Prefab/HeroDetailsPanel/HeroEquipInfo"]);cc.Canvas.instance.node.addChild(e);var t={buffer:n,map:a._raw_assets,showbtn:!1,scriptname:"StoreHousePanel"};e.getComponent("HeroEquipInfo").ChangeData(t)}),null==MyPersistDataManager._playerData.bagMap[this._curSelectItemID]?this.CreateItemForType(this._curSelectTabMenuIndex):(this.CreateItemForType(this._curSelectTabMenuIndex,!1),this.Itembox_OnClickHandler(null,MyPersistDataManager._playerData.bagMap[this._curSelectItemID])),this.refreshRedPoints()},UseItem_auth_cb:function(e){cc.log(" nhận sử dụng đạo cụ ");var a=[];e.reward_item.forEach(function(e,t){a.push({itemId:e.template_id,cnt:e.num})});var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=a,null==MyPersistDataManager._playerData.bagMap[this._curSelectItemID]?this.CreateItemForType(this._curSelectTabMenuIndex):(this.CreateItemForType(this._curSelectTabMenuIndex,!1),this.Itembox_OnClickHandler(null,MyPersistDataManager._playerData.bagMap[this._curSelectItemID])),this.refreshRedPoints()},S2CTreasureEnhance_cb:function(){null==MyPersistDataManager._playerData.bagMap[this._curSelectItemuuid]?this.CreateItemForType(this._curSelectTabMenuIndex):(this.CreateItemForType(this._curSelectTabMenuIndex,!1),this.Itembox_OnClickHandler(null,MyPersistDataManager._playerData.bagMap[this._curSelectItemuuid]))},_S2CExpandBag_auth_cb:function(a){if(cc.log(" thu được mở rộng ba lô tin tức "),null==MyPersistDataManager._playerData.expand_info||MyPersistDataManager._playerData.expand_info.length<=0)
MyPersistDataManager._playerData.expand_info=new Array,MyPersistDataManager._playerData.expand_info.push(a);else{var n=!1;MyPersistDataManager._playerData.expand_info.forEach(function(e,t){e.bag_id==a.bag_id&&(n=!0,e.expand_count=a.expand_count),n||MyPersistDataManager._playerData.expand_info.push(a)})}
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),o.t("sh_042")),this.CreateItemForType(a.bag_id)},isHasConsumeForSell:function(){var e=[1202,1203,1204,1205],t=[];if(0==this._curSelectTabMenuIndex)
for(var a=0;a<this._curitemlist.length;++a)
for(var n=this._curitemlist[a],i=0;i<e.length;++i)
n.template_id==e[i]&&t.push({id:n.template_id,num:n.num});if(!(t.length<=0)){var r=cc.instantiate(this.m_pConsumeMultiuse);this.node.addChild(r),r.getComponent("ConsumeMultiUse").ChangeData(t,this._raw_assets)}},GetItemTypeList:function(e){for(var t=[],a=this.GetItemList(e),n=0;n<a.length;++n){var i=a[n];if(-1==this._additionalParams||3199!=i.template_id&&3198!=i.template_id&&3099!=i.template_id&&3098!=i.template_id)
if(-1!=this._equippos){(1==e?DonotDestroyManager.GameData.Equips[i.template_id]:DonotDestroyManager.GameData.Treasures[i.template_id]).position==this._equippos&&null==i.heroid&&t.push(i)}else
t.push(i)}
return this.SortItemList(e,t),t},SortItemList:function(e,t){var i=this;t.sort(function(e,t){var a=i.GetItemCfg(e.template_id),n=i.GetItemCfg(t.template_id);return null!=e.heroid&&null!=t.heroid?a.quality!=n.quality?n.quality-a.quality:e.enhance_level!=t.enhance_level?t.enhance_level-e.enhance_level:e.stars!=t.stars?t.stars-e.stars:t.template_id-e.template_id:null!=e.heroid&&null==t.heroid?-1:null==e.heroid&&null!=t.heroid?1:a.quality!=n.quality?n.quality-a.quality:e.enhance_level!=t.enhance_level?t.enhance_level-e.enhance_level:e.stars!=t.stars?t.stars-e.stars:t.template_id-e.template_id})},GetItemCfg:function(e){var t=null;return null!=DonotDestroyManager.GameData.Consumes[e]?t=DonotDestroyManager.GameData.Consumes[e]:null!=DonotDestroyManager.GameData.Boxes[e]?t=DonotDestroyManager.GameData.Boxes[e]:null!=DonotDestroyManager.GameData.Items[e]?t=DonotDestroyManager.GameData.Items[e]:null!=DonotDestroyManager.GameData.Equips[e]?t=DonotDestroyManager.GameData.Equips[e]:null!=DonotDestroyManager.GameData.EquipFrags[e]?t=DonotDestroyManager.GameData.EquipFrags[e]:null!=DonotDestroyManager.GameData.Treasures[e]?t=DonotDestroyManager.GameData.Treasures[e]:null!=DonotDestroyManager.GameData.CardFrags[e]?t=DonotDestroyManager.GameData.CardFrags[e]:null!=DonotDestroyManager.GameData.UnitsEquips[e]?t=DonotDestroyManager.GameData.UnitsEquips[e]:null!=DonotDestroyManager.GameData.TreasureFrags[e]&&(t=DonotDestroyManager.GameData.TreasureFrags[e]),t},GetItemList:function(e){var t=[];switch(e){case 0:t=p.getList();break;case 1:t=_.getInstance().getEquipAll();break;case 2:t=u.getList();break;case 3:t=m.getInstance().getList();break;case 4:t=c.getList()}
return t},GetBagTypeExpand:function(e){for(var t=0,a=0;a<MyPersistDataManager._playerData.expand_info.length;++a)
MyPersistDataManager._playerData.expand_info[a].bag_id==e&&(t=MyPersistDataManager._playerData.expand_info[a].expand_count);return t},CreateItemForType:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._curitemlist=this.GetItemTypeList(e),this._curbagExpand=this.GetBagTypeExpand(e);var a=15+this._curbagExpand;if(this.totalCount=a,this.m_pRongqi.string=this._curitemlist.length+"/"+(60+4*this._curbagExpand),cc.log(" ba lô ô vuông số lượng ===="+a+" ba lô số liệu ==="+this._curitemlist.length),this.content=this.mScrollView.content,this.content.height=this.totalCount*(this.itemTemplateHeight+this.spacing)+this.spacing,0==this.content.children.length){this._spawnItems=[],this.updateTimer=0,this.updateInterval=.2;for(var n=this.lastContentPosY=0;n<this.spawnCount;++n){var i=cc.instantiate(this.itemTemplate);this.content.addChild(i),i.setPosition(0,-i.height*(.5+n)-this.spacing*(n+1)),i.getComponent("StoreHouseItemInfo").updateItem(n),this._spawnItems.push(i)}}else
for(var r=this.updateTimer=0;r<this.spawnCount;++r){var s=this._spawnItems[r];s.setPosition(0,-s.height*(.5+r)-this.spacing*(r+1)),s.getComponent("StoreHouseItemInfo").updateItem(r)}
t&&(null!=this._curitemlist?this.Itembox_OnClickHandler(this._spawnItems[0].getComponent("StoreHouseItemInfo")._itemboxList[0],this._curitemlist[0]):this.Itembox_OnClickHandler())},SetTabMenuGray:function(e){for(var t=0;t<this.m_pTabMenuList.length;++t)
e!=t&&(this.m_pTabMenuList[t].node.getChildByName("btn_tab_normal").color=cc.color(179,179,179))},TabMenuRegisterClickEvent:function(){for(var e=0;e<this.m_pTabMenuList.length;++e){var t=new cc.Component.EventHandler;t.target=this.node,t.component="StoreHousePanel",t.handler="Menu_OnClickHandler",t.customEventData=e.toString(),this.m_pTabMenuList[e].clickEvents[0]=t}},TabMenuRegisterClickForID:function(e){var t=new cc.Component.EventHandler;t.target=this.node,t.component="StoreHousePanel",t.handler="Menu_OnClickHandler",t.customEventData=e.toString(),this.m_pTabMenuList[e].clickEvents[0]=t},Menu_OnClickHandler:function(e,t){cc.log(" điểm đánh nhãn :"+t),i.playBtnOpenEffect();var a=parseInt(t);this.SetSelectTabMenu(a),this._curSelectTabMenuIndex=a;var n=MyUiManager.getUiParams(13);null!=n&&(n.index=a)},SetSelectTabMenu:function(e){if(this._curSelectTabMenuIndex!=e){this._lastSelectItemID=this._curSelectItemID=-1,this._curSelectItemuuid=this._lastSelectItemuuid="";cc.log(" bắt đầu thiết trí lựa chọn nhãn "),-1!=this._lastSelectTabMunuIndex&&(this.m_pTabMenuList[this._lastSelectTabMunuIndex].node.getChildByName("btn_tab_normal").getComponent(cc.Sprite).spriteFrame=this.m_pMenuSprList[0]),this._curSelectTabMenuIndex=e,this.m_pTabMenuList[this._curSelectTabMenuIndex].node.getChildByName("btn_tab_normal").getComponent(cc.Sprite).spriteFrame=this.m_pMenuSprList[1],this._lastSelectTabMunuIndex=this._curSelectTabMenuIndex,this.CreateItemForType(e),this.mScrollView.stopAutoScroll(),this.mScrollView.scrollToTop()}},Itembox_OnClickHandler:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(cc.log(" điểm đánh đạo cụ lâu "),this.m_pConsumAbleInfo.active&&(this.m_pConsumAbleInfo.active=!1),this.m_pEquipInfo.active&&(this.m_pEquipInfo.active=!1),this.m_pFragmentInfo.active&&(this.m_pFragmentInfo.active=!1),this.m_pTreasureInfo.active&&(this.m_pTreasureInfo.active=!1),this.m_pItemInfo.active&&(this.m_pItemInfo.active=!1),null!=t){if(-1!=this._lastSelectItemID){var a=this.GetItemBoxForID(this._lastSelectItemID,this._lastSelectItemuuid);null!=a&&a.getComponent("ItemBox").SetSelect(!1)}
switch(this._curSelectItemID=t.template_id,this._curSelectItemuuid=t.uuid,null!=e?e.getComponent("ItemBox").SetSelect(!0):this.GetItemBoxForID(this._curSelectItemID,this._curSelectItemuuid).getComponent("ItemBox").SetSelect(!0),t.bagId){case 0:this.m_pConsumAbleInfo.active=!0,(n=this.m_pConsumAbleInfo.getComponent("ConsumablesInfo")).ChangeData(t);break;case 1:this.m_pEquipInfo.active=!0,(n=this.m_pEquipInfo.getComponent("StoreHouseEquipsInfo")).ChangeData(t),-1!=this._additionalParams&&(n.m_pBottomContent.active=!1,n.m_pEquipBtn.node.active=!0);break;case 2:this.m_pFragmentInfo.active=!0,(n=this.m_pFragmentInfo.getComponent("StoreHouseFragmentInfo")).ChangeData({buffer:t,map:this._raw_assets});break;case 3:this.m_pTreasureInfo.active=!0,(n=this.m_pTreasureInfo.getComponent("StoreHouseTreasureInfo")).ChangeData(t),-1!=this._additionalParams&&(n.m_pBottomContent.active=!1,n.m_pEquipBtn.node.active=!0);break;case 4:var n;this.m_pItemInfo.active=!0,(n=this.m_pItemInfo.getComponent("StoreHouseItempanel")).ChangeData(t)}
this._lastSelectItemID=this._curSelectItemID,this._lastSelectItemuuid=this._curSelectItemuuid,this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))}},Expand_OnClickHandler:function(e){this.m_pExpandTipPanel.active=!0,this.m_pExpandTipPanel.getComponent("ExpandTipsPanel").ChangeData(this._curSelectTabMenuIndex)},GetItemBoxForID:function(e,t){for(var a=null,n=0;n<this._spawnItems.length;++n)""!=t?null!=this._spawnItems[n].getComponent("StoreHouseItemInfo")._itemmap[t]&&(a=this._spawnItems[n].getComponent("StoreHouseItemInfo")._itemmap[t],cc.log(" tìm được uid đối tượng ")):null!=this._spawnItems[n].getComponent("StoreHouseItemInfo")._itemmap[e]&&(a=this._spawnItems[n].getComponent("StoreHouseItemInfo")._itemmap[e],cc.log(" tìm được đối tượng "));return a},onDestroy:function(){f.instance=null,s.removeListener(r.S2CExpandBag,this._S2CExpandBag_auth_cb_func),s.removeListener(r.S2CUseItem,this.UseItem_auth_cb_func),s.removeListener(r.S2CEquipFragCompose,this.S2CEquipFragCompose_cb_func),s.removeListener(d.S2CTreasureEnhance,this.S2CTreasureEnhance_cb_func),null!=this._tierseffect&&this._tierseffect.destroy(),this._tierseffect=null},Back_onclickHandler:function(e){if(i.playBtnCloseEffect(),null!=this._additionalcb)
return this._additionalcb(),void this.node.destroy();MyUiManager.Back(),this.closeCb&&this.closeCb()},showGuide:function(){var n=this;l.showGuide("StoreHouseLayer",function(e){if(1==e)
return n.m_pTabMenuList[3].node;if(2==e)
return n.m_pTreasureInfo.getComponent("StoreHouseTreasureInfo").btnTreaRefine;if(3==e)
return n.m_pTreasureInfo.getComponent("StoreHouseTreasureInfo").btnTreaStrength;if(4==e){for(var t=0;t<n.content.children.length;t++){var a=n.content.children[t].getComponent("StoreHouseItemInfo").getGuideTreaCell();if(null!=a)
return a}
return null}
return 5==e?n.m_pEquipInfo.getComponent("StoreHouseEquipsInfo").m_pEquipBtn.node:6==e?n.m_pTreasureInfo.getComponent("StoreHouseTreasureInfo").btnEquip:void 0})},getPositionInView:function(e){var t=e.parent.convertToWorldSpaceAR(e.position);return this.mScrollView.node.convertToNodeSpaceAR(t)},update:function(e){if(this.updateTimer+=e,!(this.updateTimer<this.updateInterval)){this.updateTimer=0;for(var t=this._spawnItems,a=this.bufferZone,n=this.mScrollView.content.y<this.lastContentPosY,i=(this.itemTemplateHeight+this.spacing)*t.length,r=0;r<t.length;++r){var s=this.getPositionInView(t[r]);if(n){if(s.y<-a&&t[r].y+i<0){t[r].setPositionY(t[r].y+i);var o=t[r].getComponent("StoreHouseItemInfo"),c=o._itemID-t.length;o.updateItem(c)}}else if(s.y>a&&t[r].y-i>-this.content.height){t[r].setPositionY(t[r].y-i);var l=t[r].getComponent("StoreHouseItemInfo"),h=l._itemID+t.length;l.updateItem(h)}}
this.lastContentPosY=this.mScrollView.content.y}}});cc._RF.pop()},{BagBufferMgr:"BagBufferMgr",ConsumeBufferMgr:"ConsumeBufferMgr",EquipBufferMgr:"EquipBufferMgr",EquipFragBufferMgr:"EquipFragBufferMgr",GameUtils:"GameUtils",GuideBufferMgr:"GuideBufferMgr",ItemBufferMgr:"ItemBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil",TreasureBufferMgr:"TreasureBufferMgr",i18n:"i18n"}],StoreHouseTiersItem:[function(r,e,t){"use strict";cc._RF.push(e,"73436HI2w5E06UEp1hPr8zr","StoreHouseTiersItem");var s=r("StoreHousePanel"),o=r("ColorUtil"),c=r("ShaderUtil");cc.Class({extends:cc.Component,properties:{m_pItemBox:cc.Prefab,m_pName:cc.Label,_itembox:null},onLoad:function(){},ChangeData:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",a=2<arguments.length&&void 0!==arguments[2]&&arguments[2];null==this._itembox&&(this._itembox=cc.instantiate(this.m_pItemBox),this.node.addChild(this._itembox));var n=this._itembox.getComponent("ItemBox");if(""==t)
n.ChangeItemInfo(e,0,!1,null,!0);else{var i=r(t);n.ChangeItemInfo(e,0,!1,null,!0)}
if(null!=n._itemjsoninfo.tier&&0<n._itemjsoninfo.tier)
if(null==n._tiereffect){if(""==t)
n._tiereffect=cc.instantiate(s.getInstance()._tierseffect);else{i=r(t);n._tiereffect=cc.instantiate(i.getInstance()._tierseffect)}
this._itembox.addChild(n._tiereffect)}else
n._tiereffect.active=!0;cc.log(e),this.m_pName.string=n._itemjsoninfo.name,a?(c.resetShader(n.node),this.m_pName.node.color=o.getColorByQuality(n._itemjsoninfo.quality)):(c.setGaryShader(n.node),this.m_pName.node.color=cc.Color.GRAY)},onDestroy:function(){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",ShaderUtil:"ShaderUtil",StoreHousePanel:"StoreHousePanel"}],StoreHouseTreasureInfo:[function(t,e,a){"use strict";cc._RF.push(e,"41f80Z91RRHQIH58Clhh5yK","StoreHouseTreasureInfo");var b=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},P=t("ColorUtil"),L=t("i18n"),s=t("StoreHousePanel"),n=t("MyProtocols"),B=t("TreasureBufferMgr"),w=t("EquipBufferMgr"),o=t("SoundUtil"),c=t("UnLockCfgMgr");cc.Class({extends:cc.Component,properties:{m_pItemBox:cc.Prefab,m_pTopitemParent:cc.Node,m_pJiesuoAttr:cc.Node,m_pName:cc.RichText,m_pEquiphero:cc.Label,m_pDes:cc.Label,m_pEquipBtn:cc.Button,m_pBottomContent:cc.Node,m_pRefineAttr:cc.Label,m_pStarList:[cc.Sprite],m_pStarSprFrame:[cc.SpriteFrame],m_pAtrList:[cc.Label],m_pJsAtrList:[cc.Label],btnTreaRefine:cc.Node,btnTreaStrength:cc.Node,btnEquip:cc.Node,_simpleinfo:null,_topitembox:null,_attrcount:0,_position:-1},onLoad:function(){},ChangeData:function(e){null!=e&&(this._simpleinfo=e,this.Init())},Init:function(){null==this._topitembox&&(this._topitembox=cc.instantiate(this.m_pItemBox),this.m_pTopitemParent.addChild(this._topitembox));var e=this._topitembox.getComponent("ItemBox");e.ChangeItemData(this._simpleinfo,null,!1),this._position=e._itemjsoninfo.position,this.m_pDes.string=e._itemjsoninfo.des,this.m_pName.string="<color=#"+P.getRichtextColorByQuality(e._itemjsoninfo.quality)+">"+e._itemjsoninfo.name+"</c><color=#ffffff>+"+this._simpleinfo.enhance_level+"</color>",null!=this._simpleinfo.heroid?(this.m_pEquiphero.node.active=!0,this.m_pEquiphero.string=L.t("sh_043",{value:DonotDestroyManager.GameData.Cards[this._simpleinfo.heroid].name})):this.m_pEquiphero.node.active=!1,this.RefreshTreasureAttr()},InitStarContent:function(){for(var e=0;e<this.m_pStarList.length;++e)
e<this._simpleinfo.stars?this.m_pStarList[e].spriteFrame=this.m_pStarSprFrame[1]:this.m_pStarList[e].spriteFrame=this.m_pStarSprFrame[0],this.m_pStarList[e].node.setPosition(40*e,0)},RefreshTreasureAttr:function(){var e=B.getStrengthPropAttr(this._simpleinfo.uuid),t=b(e,6),a=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],c=[r/100,s/100,o/100];s=c[1],o=c[2];var l=[];0!=(r=c[0])&&l.push(L.t("detail_027",{value:r})),0!=s&&l.push(L.t("detail_025",{value:s})),0!=o&&l.push(L.t("detail_026",{value:o})),0!=a&&l.push(L.t("detail_004",{value:a})),0!=n&&l.push(L.t("detail_005",{value:n})),0!=i&&l.push(L.t("detail_006",{value:i}));for(var h=B.getExtraPropAttr(this._simpleinfo.uuid),d=Object.keys(h),_=0;_<d.length;++_){var u=h[d[_]];if(null!=u&&0!=u){var m=w.getEquipAttrDes(w.getEquipAttrName(d[_]));l.push(m+u)}}
var p=0;cc.log(l.length);for(_=0;_<l.length;++_)
this.m_pAtrList[_].node.active=!0,this.m_pAtrList[_].string=l[_],++p;if(p<this.m_pAtrList.length)
for(_=p;_<this.m_pAtrList.length;++_)
this.m_pAtrList[_].node.active=!1;var f=DonotDestroyManager.GameData.Treasures[this._simpleinfo.template_id].unlocks,g=Object.keys(f),y=[];for(_=0;_<g.length;++_){var v=f[g[_]],M=parseInt(g[_]);if(v&&v.rate&&!(v.rate instanceof Array))
for(var S in v.rate){var C=v.rate[S]/100,D=w.getEquipAttrDes(w.getEquipAttrName(S));y.push([M,D+C+"%",this._simpleinfo.enhance_level>=M])}
if(v&&v.statics&&!(v.statics instanceof Array))
for(var S in v.statics){D=w.getEquipAttrDes(w.getEquipAttrName(S)),C=v.statics[S];y.push([M,D+C,this._simpleinfo.enhance_level>=M])}}
for(_=p=0;_<y.length;++_){var I=y[_][2];this.m_pJsAtrList[_].node.active=!0,this.m_pJsAtrList[_].node.color=I?P.getColorByIndex(7):P.getColorByIndex(5),this.m_pJsAtrList[_].string=y[_][1]+(I?"":L.t("sh_021",{value:y[_][0]})),++p}
if(p<this.m_pJsAtrList.length)
for(_=p;_<this.m_pJsAtrList.length;++_)
this.m_pJsAtrList[_].node.active=!1;this.InitStarContent(),this.RefreshAttr()},RefreshAttr:function(){var e=B.getTemperPropAttr(this._simpleinfo.uuid,!0,this._simpleinfo.stars),t=b(e,6),a=t[0],n=t[1],i=t[2];t[3],t[4],t[5];0!=a?(this.m_pRefineAttr.node.active=!0,this.m_pRefineAttr.string=L.t("detail_004",{value:a})):0!=n?(this.m_pRefineAttr.node.active=!0,this.m_pRefineAttr.string=L.t("detail_005",{value:n})):0!=i?(this.m_pRefineAttr.node.active=!0,this.m_pRefineAttr.string=L.t("detail_006",{value:i})):this.m_pRefineAttr.node.active=!1},Strength_OnClickHandler:function(e){o.playBtnOpenEffect();var t=c.getFuncUnLockInfo(39),a=b(t,2),n=a[0],i=a[1];if(n)
if(3199!=this._simpleinfo.template_id&&3198!=this._simpleinfo.template_id&&3099!=this._simpleinfo.template_id&&3098!=this._simpleinfo.template_id)
MyUiManager.Open(MyUiManager.PanelInfo.TreasureStrengthen,{buffer:this._simpleinfo,cb:this.RefreshTreasureAttr.bind(this),map:s.getInstance()._raw_assets,type:this._position-1});else{var r=DonotDestroyManager.GameData.Treasures[this._simpleinfo.template_id];MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),L.t("detail_060",{value:r.name}))}
else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),i)},Refine_OnClickHandler:function(e){if(o.playBtnOpenEffect(),3199!=this._simpleinfo.template_id&&3198!=this._simpleinfo.template_id&&3099!=this._simpleinfo.template_id&&3098!=this._simpleinfo.template_id){var t=c.getFuncUnLockInfo(41),a=b(t,2),n=a[0],i=a[1];n?MyUiManager.Open(MyUiManager.PanelInfo.TreaRefineLayer,{buffer:this._simpleinfo,cb:this.RefreshTreasureAttr.bind(this),map:s.getInstance()._raw_assets}):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),i)}else{var r=DonotDestroyManager.GameData.Treasures[this._simpleinfo.template_id];MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),L.t("detail_060",{value:r.name}))}},Equip_OnClickHandler:function(e){o.playBtnOpenEffect(),n.send_C2SCardTakeOnItem(DonotDestroyManager._gameSocket,s.getInstance()._additionalParams,this._simpleinfo.uuid),t("HeroDetailsPanel").getInstance().node.active=!0,s.getInstance().node.destroy()},onDestroy:function(){this._topitembox=null}}),cc._RF.pop()},{ColorUtil:"ColorUtil",EquipBufferMgr:"EquipBufferMgr",HeroDetailsPanel:"HeroDetailsPanel",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",StoreHousePanel:"StoreHousePanel",TreasureBufferMgr:"TreasureBufferMgr",UnLockCfgMgr:"UnLockCfgMgr",i18n:"i18n"}],StrategyLine:[function(f,e,t){"use strict";cc._RF.push(e,"0a586iWPyRMLISUO1nJqA7O","StrategyLine");var a=f("state-machine"),n=cc.Class({extends:f("WActor"),properties:{},ctor:function(){cc.log("StrategyLine create!")},setFSM:function(){var e=this;this.fsm=a.create({initial:"None",events:[{name:"Pointto",from:"None",to:"Visible"},{name:"Marquee",from:"Visible",to:"Display"},{name:"Cancel",from:"*",to:"None"}],callbacks:{onenterstate:function(e,t,a){},onafterCancel:function(){e.onafterCancel()},onenterVisible:function(){e.onenterVisible()},onenterDisplay:function(){e.onenterDisplay()}}})},add2Layer:function(e){this.parentLayer=e},setTeamFrom:function(e){this.isOwn=e},setPath:function(e){this.path=[];for(var t=0;t<e.length;t++){var a=e[t];this.path.push(cc.p(a[0],a[1]))}},onenterVisible:function(){this.points=[];for(var e,t,a,n,i,r,s,o=this.path[0].x,c=this.path[0].y,l=0,h=this;void 0,n=cc.pSub(h.path[l+1],h.path[l]),i=cc.pToAngle(n),r=o+50*Math.cos(i),s=c+50*Math.sin(i),cc.pDistance(h.path[l],cc.p(r,s))>cc.pLength(n)&&(l+=1)==h.path.length-1?(e=r,t=s,a=i,0):(o=r,c=s,1);){var d;d=this.isOwn?"March_route_blue":"March_route_red";var _=f("BattleSceneMgr");(p=cc.instantiate(_.getInstance()._raw_assets["Prefab/battle/effects/"+d])).setScale(.5),p.setPosition(o,c),p.active=!1,this.parentLayer.addChild(p),this.points.push(p)}
for(var u=this.points.length-1,m=0;m<this.points.length;m++){var p;(p=this.points[m]).idx=m,this.parentLayer.runAction(cc.sequence(cc.delayTime(.05*(m+1)),cc.callFunc(function(){cc.isValid(this)&&(this.active=!0,this.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("out",-1,-1,0,"normal"),this.idx==u&&h.addArrow(e,t,a))},p)))}},addArrow:function(e,t,a){var n;n=this.isOwn?"blue":"red",this.sprArrow=new cc.Node;var i=this.sprArrow.addComponent(cc.Sprite),r=f("BattleSceneMgr");i.spriteFrame=r.getInstance()._raw_assets["battle/effect/march_"+n],this.sprArrow.setPosition(e,t);var s=180/Math.PI*a;this.sprArrow.rotation=-s,this.sprArrow.opacity=100,this.parentLayer.addChild(this.sprArrow);var o=cc.moveBy(.5,cc.p(10*Math.cos(a),10*Math.sin(a))),c=cc.spawn(cc.sequence(o,o.reverse()),cc.sequence(cc.fadeTo(.5,255),cc.fadeTo(.2,100)));this.sprArrow.runAction(cc.repeatForever(c))},onenterDisplay:function(){this.points.length;for(var e=0;e<this.points.length;e++){var t=this.points[e];this.parentLayer.runAction(cc.sequence(cc.delayTime(.1*(e+1)),cc.callFunc(function(){cc.isValid(this)&&this.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("out",-1,100,0,"normal")},t)))}},updatePoints:function(e,t){if(!(this.points.length<1)){var a=this.points[0].getPosition().x,n=this.points[0].getPosition().y;a+=n/2,cc.pDistance(cc.p(a,n),cc.p(e,t))<30&&(this.points[0].destroy(),this.points.splice(0,1))}},onafterCancel:function(){for(var e=0;e<this.points.length;e++){this.points[e].destroy()}
this.points=[],this.sprArrow.destroy()}});e.exports=n,cc._RF.pop()},{BattleSceneMgr:"BattleSceneMgr",WActor:"WActor","state-machine":"state-machine"}],SweepItem:[function(e,t,a){"use strict";cc._RF.push(t,"47d2bXkkw5JfL14KWAVOO9y","SweepItem");var r=e("StageSelectPanel"),c=e("ItemBufferMgr");cc.Class({extends:cc.Component,properties:{m_pRewardContent:cc.Node,m_pNoRewardContent:cc.Node,m_pNum:cc.Label,m_pExp:cc.Label,m_pGameMoney:cc.Label,m_pItemParent:cc.Node,m_pframeIconBg:cc.SpriteFrame,m_punitEquipMask:cc.SpriteFrame,_rewardinfo:null,_itemlist:[],_createcb:null,_timeoutnum:-1},onLoad:function(){},ChangeData:function(e){this._showreward=null==e.showreward||e.showreward,this._rewardinfo=e.info,this._exp=e.exp,this._money=e.gamemoney,this._createcb=e.createcb,this._index=e.index,this._stageindex=e.stageindex,this.Init()},Init:function(){if(!this._showreward)
return this.m_pRewardContent.active=!1,void(this.m_pNoRewardContent.active=!0);this.m_pRewardContent.active=!0,this.m_pNoRewardContent.active=!1,this.m_pExp.string="x"+this._exp,this.m_pNum.string=this._index+1,this.m_pGameMoney.string="x"+this._money,this.playListViewAni()},playListViewAni:function(){for(var o=this,t=function(t,e,a,n){var i=null,r=cc.sequence(cc.callFunc(function(){var e=new cc.Node;i=e.addComponent(cc.Sprite),t.addChild(e,10),c.isArmyEquitEntity(a)?i.spriteFrame=o.m_punitEquipMask:i.spriteFrame=o.m_pframeIconBg,i.node.setPosition(0,0)}),cc.spawn(cc.scaleTo(.1,1.1),cc.scaleTo(.1,1),cc.fadeIn(.1)),cc.delayTime(.1),cc.callFunc(function(){i.node.runAction(cc.fadeOut(.3))}),cc.delayTime(1),cc.callFunc(function(){e==o._itemlist.length-1&&(++o._index,n&&n(o._index))})),s=.3*e;o.node.runAction(cc.sequence(cc.delayTime(s),cc.callFunc(function(e){this.active=!0,this.runAction(r)},t)))},e=0;e<this._rewardinfo.sweep1.length;++e){var a=this._rewardinfo.sweep1[e],n=cc.instantiate(r.getInstance().m_pItembox);this.m_pItemParent.addChild(n),n.active=!1;var i=n.getComponent("ItemBox");i.ChangeItemInfo(a.template_id,a.num,!0,null,!0),this._itemlist.push(i)}
(function(){for(var e=0;e<o._itemlist.length;++e)
t(o._itemlist[e].node,e,o._itemlist[e]._itemId,o._createcb)})()},onDestroy:function(){}}),cc._RF.pop()},{ItemBufferMgr:"ItemBufferMgr",StageSelectPanel:"StageSelectPanel"}],SweepLayer:[function(e,t,a){"use strict";cc._RF.push(t,"994c6HIbHdMHZyx624mbjW/","SweepLayer");var n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pSweepItem:cc.Node,m_pItemParent:cc.Node,m_pScrollview:cc.ScrollView,_rewardinfo:null,_exp:-1,_gamemoney:-1},onLoad:function(){},setParams:function(e){this._exp=e.exp,this._gamemoney=e.gamemoney,this._rewardinfo=e.rewardinfo,this._closeCb=e.closeCb,this.Init()},Init:function(){this.CreateSweepItem(0)},CreateSweepItem:function(e){var t=cc.instantiate(this.m_pSweepItem);this.m_pItemParent.addChild(t),t.active=!0;var a=t.getComponent("SweepItem");3<=e&&this.m_pScrollview.scrollToBottom(.1),e<this._rewardinfo.result.length?a.ChangeData({info:this._rewardinfo.result[e],exp:this._exp,gamemoney:this._gamemoney,createcb:this.CreateSweepItem.bind(this),index:e,stageindex:this._rewardinfo.stage_index}):a.ChangeData({showreward:!1})},Mask_OnClickHandler:function(e){MyUiManager.Back(),n.playBtnCloseEffect(),null!=this._closeCb&&this._closeCb()}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],SweepTips:[function(e,t,a){"use strict";cc._RF.push(t,"787c7WAVe5LUKVBZ4ReooFW","SweepTips");var n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pMoney:cc.Label,_cb:null},onLoad:function(){},ChangeData:function(e,t){this._cb=t,this.m_pMoney.string="x"+e},OnClickHandler:function(e){null!=this._cb&&this._cb()},Mask_OnClickHandler:function(e){n.playBtnCloseEffect(),this.node.active=!1}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],SystemSettingLayer:[function(e,t,a){"use strict";cc._RF.push(t,"0c8309rqntE3q0CxhRBaztL","SystemSettingLayer");var i=e("SoundUtil");e("i18n");cc.Class({extends:cc.Component,properties:{spr_sound:cc.Sprite,lbl_sound:cc.Label,res_sound_open:[cc.SpriteFrame],soundVolumnSpr:cc.Node},onLoad:function(){this.ReadInfo()},onDestroy:function(){null!=this.finishCb&&this.finishCb()},setParams:function(e){},ReadInfo:function(){var e=!0;null!=cc.sys.localStorage.getItem("isSoundOpen")&&(e=cc.sys.localStorage.getItem("isSoundOpen")),this.showSoundStatus(e);var t=1;null!=cc.sys.localStorage.getItem("soundVolumn")&&(t=parseFloat(cc.sys.localStorage.getItem("soundVolumn"))),this.showSoundVolumn(t)},switchSoundStatus:function(){var e=1;null!=cc.sys.localStorage.getItem("isSoundOpen")&&(e=cc.sys.localStorage.getItem("isSoundOpen")),e=1==e?0:1,cc.sys.localStorage.setItem("isSoundOpen",e),MyPersistDataManager._playerData.musicVolume=1==e,0==e?MyBgMusicManager.stop():MyBgMusicManager.resumePlay(),i.playBtnOpenEffect(),this.showSoundStatus(e)},showSoundStatus:function(e){1==e?(this.lbl_sound.string="Âm thanh:Mở",this.spr_sound.spriteFrame=this.res_sound_open[0]):(this.lbl_sound.string="Âm thanh:Đóng ",this.spr_sound.spriteFrame=this.res_sound_open[1])},doClosePanel:function(){MyUiManager.Back(),i.playBtnCloseEffect()},setCloseCb:function(e){this.finishCb=e},DestroySelf_onClickOtherEvent:function(e){var t=cc.scaleTo(.1,.7,.7),a=this;i.playBtnCloseEffect();var n=cc.sequence(t,cc.callFunc(function(){a.node.removeFromParent(),a.node.destroy()}));this.m_pScaelNode.runAction(n)},ScaleToLarge:function(){i.playBtnOpenEffect(),this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.2,1,1);this.m_pScaelNode.runAction(e)},BtnSoundVolumnClick:function(e,t){var a=parseFloat(t);this.showSoundVolumn(a),cc.sys.localStorage.setItem("soundVolumn",a),MyBgMusicManager.setSoundVolumn(a)},showSoundVolumn:function(e){this.soundVolumnSpr.width=414*e}}),cc._RF.pop()},{SoundUtil:"SoundUtil",i18n:"i18n"}],TalentsCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"2d7d5gOweVMv7Eo+SU6Rmy9","TalentsCfgMgr"),t.exports={getTalentCfg:function(e){return DonotDestroyManager.GameData.Talents[e-1]},getEffectVal:function(e,t,a){for(var n=[],i=1;i<=e.length;i++){var r=e[i-1];if(i<=t&&0!=r){var s=this.getTalentCfg(r);if(s.talent_type==a){var o=this.getTalentEffectVal(s);o.push(i),n.push(o)}}}
return n},getTalentEffectVal:function(e){var t=e.talent_type,a=[];return 1==t||2==t||3==t||5==t||6==t||10==t?a.push(2):4!=t&&7!=t||a.push(1),a.push(e.coefs[0]),a.push(e.coefs[1]),a},processUnitNumVal:function(e){for(var t=0,a=0;a<e.length;a++){t+=e[a][2]}
return t+=10}},cc._RF.pop()},{}],TeamDataUtil:[function(e,t,a){"use strict";cc._RF.push(t,"7c5519oaThMaYVoxQJwkIeU","TeamDataUtil");var d=e("BattleBufferMgr"),_=e("HeroBufferMgr"),u=e("BattleDataManager"),n=function(){};n.getLeftData=function(){var e={side:"left"};e.name=MyPersistDataManager._playerData.name,e.level=MyPersistDataManager._playerData.level;var t=d.getFormationData(1);e.formation=t.formationId,e.forward=t.forward,e.flip=t.flip;for(var a=u.create(e),n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];if("fid"!=r&&"formationId"!=r&&"forward"!=r&&"flip"!=r){var s=t[r];if("0"!=r){var o=_.getHeroByUid(s);o&&(delete o.hpPerc,delete o.atkPerc,a.addCardWithPosition(o,r))}}}
for(var c=0;c<a.teams.length;c++){var l=a.teams[c],h=_.getExtraPropAttr(l.hero.heroId);l.hero.extraAttr=cc.clone(h)}
return a},t.exports=n,cc._RF.pop()},{BattleBufferMgr:"BattleBufferMgr",BattleDataManager:"BattleDataManager",HeroBufferMgr:"HeroBufferMgr"}],TeamSkillAttritem:[function(e,t,a){"use strict";cc._RF.push(t,"c2056HNjU1HPodO6lps8gib","TeamSkillAttritem");cc.Class({extends:cc.Component,properties:{m_pLeftvalue:cc.Label,m_pRightvalue:cc.Label,m_pSecondStreamer:cc.Prefab,_streamereffect:null,_armatureDisplay:null,_armature:null,_isPlayEffect:!1},ChangeData:function(e,t,a){this.m_pLeftvalue.string=e,this.m_pRightvalue.string=t,a&&this.CreateEffect()},onLoad:function(){},CreateEffect:function(){this._streamereffect=cc.instantiate(this.m_pSecondStreamer),this.m_pLeftvalue.node.addChild(this._streamereffect),this._streamereffect.setPosition(120,0),this._armatureDisplay=this._streamereffect.getComponent(dragonBones.ArmatureDisplay),this._armature=this._armatureDisplay.armature(),this._armature.animation.fadeIn("Action1",-1,-1,0,"normal"),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this.onAnimCompleted,this)},onAnimCompleted:function(e){cc.log(" ta truyền phát tin xong rồi bắt đầu cắt bỏ "),e.type===dragonBones.EventObject.COMPLETE&&(this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onAnimCompleted,this),null!=this._streamereffect&&(this._streamereffect.removeFromParent(),this._streamereffect.destroy(),this._streamereffect=null))},onDestroy:function(){null!=this._armatureDisplay&&this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onAnimCompleted,this)}}),cc._RF.pop()},{}],TeamSkillBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"07550urF/NOxYub9gWAGSQ7","TeamSkillBufferMgr");var n=e("TeamSkillCfgMgr"),i=function(){this.tmpSkillIndex=-1,this.teamSkillEx=[]};i.prototype.initWithTeamSkillList=function(e){this.teamSkillList=e,this.resetLevelEx()},i.prototype.removeTmpTeamSkill=function(){-1<this.tmpSkillIndex&&(this.teamSkillList[this.tmpSkillIndex]=0,this.tmpSkillIndex=-1)},i.prototype.unlockTeamSkill=function(e){this.teamSkillList[e]=1},i.prototype.upgradeTeamSkill=function(e){null==this.teamSkillList[e]?this.teamSkillList[e]=2:this.teamSkillList[e]++},i.prototype.resetLevelEx=function(){if(null!=this.teamSkillList){this.teamSkillEx=[];for(var e=1;e<=4;e++)
this.teamSkillEx.push(0)}},i.prototype.getOpenSkillCount=function(){for(var e=0,t=0;t<this.teamSkillList.length;t++)
0<this.teamSkillList[t]&&e++;return e},i.prototype.getBattleLevel=function(e){return this.getLevel(e)+this.getLevelEx(e)},i.prototype.getLevel=function(e){if(!(4<e||e<1)){var t=n.getTeamSkillIndex(e);return this.teamSkillList[t]}},i.prototype.getLevelEx=function(e){var t=n.getTeamSkillIndex(e);return this.teamSkillEx[t]},t.exports=new i,cc._RF.pop()},{TeamSkillCfgMgr:"TeamSkillCfgMgr"}],TeamSkillCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"0bb63FYtgxCMq/SyxYYPUEP","TeamSkillCfgMgr"),t.exports={getTmSkLvs:function(e){for(var t=[0,0,0,0],a=0;a<t.length;a++)
t[a]=this.getTmSkillLv(a+1);return t},getTmSkillLv:function(e,t){for(var a=this.getTeamSkillCfg(e).levels,n=a.length-1;0<=n;n--){if(a[n].upgrade[0]<=t)
return n}},getTeamSkillCfg:function(e){for(var t=DonotDestroyManager.GameData.TeamSkills.items,a=0;a<t.length;a++){var n=t[a];if(n.id==e)
return n}},getTeamSkillIndex:function(e){for(var t=DonotDestroyManager.GameData.TeamSkills.items,a=0;a<t.length;a++){if(t[a].id==e)
return a}}},cc._RF.pop()},{}],TeamSkillItem:[function(e,t,a){"use strict";cc._RF.push(t,"5a24dlFBdFBQoG+zmMzY6z0","TeamSkillItem");var n=e("TeamSkillPanel"),i=e("StagesConfigMgr"),r=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pNameSpr:cc.Sprite,m_pIcon:cc.Sprite,m_pLevel:cc.Label,m_pDes:cc.Label,m_pNeedLevel:cc.Label,m_pNeedStar:cc.Label,m_pUnlockContent:cc.Node,m_plocklab:cc.Label,m_btnUpgrade:cc.Node,m_pNameSprFrame:[cc.SpriteFrame],m_pIconSprFrame:[cc.SpriteFrame],_index:-1,_curlevel:-1,_teamskillitemjson:null,_curpoint:-1},onLoad:function(){},ChangeData:function(e,t,a){this._index=t,this._curlevel=e,this._curpoint=a,this.Init()},Init:function(){this._teamskillitemjson=DonotDestroyManager.GameData.TeamSkills.items[this._index],this.m_pNameSpr.spriteFrame=this.m_pNameSprFrame[this._index],this.m_pIcon.spriteFrame=this.m_pIconSprFrame[this._index],this.m_pDes.string=this._teamskillitemjson.des,this._curlevel<=0?(this._curlevel=1,this.m_pUnlockContent.active=!0,this.InitUnLockContent()):this.m_pUnlockContent.active=!1,this.m_pLevel.string="LV."+this._curlevel,this.m_pNeedLevel.string=" Điều kiện: Bang đạt lv "+this._teamskillitemjson.levels[this._curlevel].upgrade[0]+" cấp",this.m_pNeedStar.string="x"+this._teamskillitemjson.levels[this._curlevel].upgrade[1],this._curpoint<this._teamskillitemjson.levels[this._curlevel].upgrade[1]?this.m_pNeedStar.node.color=cc.Color.RED:this.m_pNeedStar.node.color=cc.Color.WHITE,MyPersistDataManager._playerData.level<this._teamskillitemjson.levels[this._curlevel].upgrade[0]?this.m_pNeedLevel.node.color=cc.Color.RED:this.m_pNeedLevel.node.color=cc.Color.WHITE},InitUnLockContent:function(){if(0<this._teamskillitemjson.unlock){var e=i.getStageGroup(i.getGroupIdByStage(this._teamskillitemjson.unlock));this.m_plocklab.string="Vượt ải "+e.name+"* Mở khóa ải "+this._teamskillitemjson.unlock%100+""}},Upgrade_OnClickHandler:function(){r.playBtnOpenEffect(),n.getInstance().m_pTeamSkillUpgrade.active=!0,n.getInstance().m_pTeamSkillUpgrade.getComponent("TeamSkillUpgrade").ChangeData(this._teamskillitemjson,this._curlevel,this._index,this._curpoint)}}),cc._RF.pop()},{SoundUtil:"SoundUtil",StagesConfigMgr:"StagesConfigMgr",TeamSkillPanel:"TeamSkillPanel"}],TeamSkillPanel:[function(e,t,a){"use strict";cc._RF.push(t,"445c33WMYZBsb8BQpZiekxJ","TeamSkillPanel");var n=e("ResLoaderManager"),i=e("SoundUtil"),r=e("GuideBufferMgr"),s=cc.Class({extends:cc.Component,properties:{m_pTeamSkillItem:cc.Node,m_pTeamparent:cc.Node,m_pStarNum:cc.Label,m_pTeamSkillUpgrade:cc.Node,_S2CTeamSkillList:null,_raw_assets:{default:{},type:Object},_teamskillitemlist:[]},statics:{instance:null,getInstance:function(){return s.instance}},onLoad:function(){s.instance=this},setParams:function(e){this._S2CTeamSkillList=e,this.closeCb=e.closeCb,this.LoadRes(),this.Init()},Init:function(){this.m_pStarNum.string="x"+this._S2CTeamSkillList.points,this.CreateTeamSkillItem(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},LoadRes:function(){this.toLoadResList=[],this.toLoadResList.push(["UI/PropHints/number_1",cc.LabelAtlas]),this.toLoadResList.push(["UI/PropHints/number_2",cc.LabelAtlas]),this.toLoadResList.push(["UI/PropHints/number_3",cc.LabelAtlas]),this.toLoadResList.push(["Prefab/effect/propHints",cc.Prefab]);var e=this._loadProgressCb.bind(this),t=this._loadFinishCb.bind(this);n.asyncLoadAll(this.toLoadResList,e,t)},_loadProgressCb:function(e){},_loadFinishCb:function(e,t){cc.log("load teamskill resources finish!"),t.forEach(function(e){var t=e[0],a=e[1];this._raw_assets[t]=a},this)},CreateTeamSkillItem:function(){for(var e=0;e<4;++e){var t=null;e<this._teamskillitemlist.length?t=this._teamskillitemlist[e]:(t=cc.instantiate(this.m_pTeamSkillItem),this.m_pTeamparent.addChild(t),this._teamskillitemlist.push(t)),t.active=!0,t.getComponent("TeamSkillItem").ChangeData(this._S2CTeamSkillList.skill_level[e],e,this._S2CTeamSkillList.points)}},UpdateTeamSkill:function(e,t){this._S2CTeamSkillList.points=e,this._S2CTeamSkillList.skill_level=t,this.Init()},Back_onclickHandler:function(e){MyUiManager.Back(),i.playBtnCloseEffect(),this.CheckHasRedPoint("labground",!1),null!=this.closeCb&&this.closeCb()},CheckHasRedPoint:function(e,t){if(!(null==MyPersistDataManager._playerData.RedPoint&&MyPersistDataManager._playerData.RedPoint.length<=0))
for(var a=MyPersistDataManager._playerData.RedPoint.length-1;0<=a;--a)
MyPersistDataManager._playerData.RedPoint[a].name==e&&(MyPersistDataManager._playerData.RedPoint[a].state=t)},onDestroy:function(){(s.instance=null)!=this._raw_assets&&(this._raw_assets=null)},showGuide:function(){var t=this;r.showGuide("TeamSkillLayer",function(e){if(1==e)
return t.m_pTeamparent.children[0].getComponent("TeamSkillItem").m_btnUpgrade})}});cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",ResLoaderManager:"ResLoaderManager",SoundUtil:"SoundUtil"}],TeamSkillUiManager:[function(e,t,a){"use strict";cc._RF.push(t,"ced3b5CvIxC97YFJjGu2gNy","TeamSkillUiManager");var i=e("BattleSceneMgr");cc.Class({extends:cc.Component,properties:{skillIconList:[cc.SpriteFrame],sprSkillIcon:cc.Sprite,sprMask:cc.Node,labMoralCost:cc.Label,_tsCfg:null,_castTimes:0,_gskill_flare_play:!1,_isMoraleEnough:!1,nodeMoralFrame:cc.Node},onLoad:function(){this.nodeMoralFrame.setLocalZOrder(2)},initUi:function(e,t){this._tsCfg=e,this.sprSkillIcon.spriteFrame=this.skillIconList[t],this._isMoraleEnough=e.morale_cost[this._castTimes]<DonotDestroyManager.GameData.TeamSkills.init_morale,this.sprMask.active=!this._isMoraleEnough,this.labMoralCost.string=e.morale_cost[this._castTimes]},cast1:function(){this._castTimes++;var e=this._tsCfg.morale_cost.length,t=this._tsCfg.morale_cost[Math.min(this._castTimes,e-1)];this.labMoralCost.string=t},moralChange:function(e){var t=this._tsCfg.morale_cost.length,a=this._tsCfg.morale_cost[Math.min(this._castTimes,t-1)];if(this._isMoraleEnough)
e<a&&(this._isMoraleEnough=!1);else if(a<=e){this._isMoraleEnough=!0;var n=cc.instantiate(i.getInstance()._raw_assets["Prefab/battle/effects/gskill/gskill_flare"]);this.node.addChild(n,2),n.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("Skill",-1,1,0,"normal"),n.getComponent("dragonBones.ArmatureDisplay").addEventListener(dragonBones.EventObject.COMPLETE,function(){this.removeFromParent(),this.destroy()},n)}
this.sprMask.active=!this._isMoraleEnough,null!=this.node.getChildByName("tmSkillBorder")&&(this.node.getChildByName("tmSkillBorder").active=this._isMoraleEnough)},isMoralEnough:function(){return this._isMoraleEnough}}),cc._RF.pop()},{BattleSceneMgr:"BattleSceneMgr"}],TeamSkillUpgrade:[function(e,t,a){"use strict";cc._RF.push(t,"c8d05UolR1HaaVr2IDalLfY","TeamSkillUpgrade");var v=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},M=e("UnitConfigMgr"),n=e("MyEventDispatcher"),i=e("MyProtocols"),r=e("NetEvent"),S=e("PropHintsEffect"),C=e("TeamSkillPanel"),s=e("TeamSkillBufferMgr"),o=e("GuideBufferMgr"),c=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pTeamSkillAttrItem:cc.Node,m_pAttritemParent:cc.Node,m_pIcon:cc.Sprite,m_pName:cc.Label,m_pLevel:cc.Label,m_pNeedLevel:cc.Label,m_pNeedStar:cc.Label,m_btnUpgrade:cc.Node,m_ptmSkStreffect:cc.Prefab,m_pIconSprFrame:[cc.SpriteFrame],_index:-1,_curlevel:-1,_teamskillitemjson:null,_attritemlist:[],_createindex:-1,_tmskstreffect:null,_effanim:null,_isPlayEffect:!1},onLoad:function(){this.S2CTeamSkillUpgrade_cb_func=this.S2CTeamSkillUpgrade_cb.bind(this),n.addListener(r.S2CTeamSkillUpgrade,this.S2CTeamSkillUpgrade_cb_func)},ChangeData:function(e,t,a,n){this._teamskillitemjson=e,this._curlevel=t,this._index=a,this._curpoint=n,this.Init()},Init:function(){this.m_pIcon.spriteFrame=this.m_pIconSprFrame[this._teamskillitemjson.id-1],this.m_pName.string=this._teamskillitemjson.name,this.m_pLevel.string=this._curlevel+"/"+this._teamskillitemjson.levels.length,this.m_pNeedLevel.string="Yêu cầu Bang đạt lv"+this._teamskillitemjson.levels[this._curlevel].upgrade[0]+"",this.m_pNeedStar.string="x"+this._teamskillitemjson.levels[this._curlevel].upgrade[1],this._curpoint<this._teamskillitemjson.levels[this._curlevel].upgrade[1]?this.m_pNeedStar.node.color=cc.Color.RED:this.m_pNeedStar.node.color=cc.Color.WHITE,MyPersistDataManager._playerData.level<this._teamskillitemjson.levels[this._curlevel].upgrade[0]?this.m_pNeedLevel.node.color=cc.Color.RED:this.m_pNeedLevel.node.color=cc.Color.WHITE,this.CreateAttr(),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},S2CTeamSkillUpgrade_cb:function(e){c.playGainGoodsEffectNew(),cc.log(" thăng cấp kỹ năng tin tức tiếp thu "),this._curlevel=e.skill_level[this._index],this.UpdateAttr(),C.getInstance().UpdateTeamSkill(e.points,e.skill_level),s.upgradeTeamSkill(e.skill_index)},DisableAttr:function(){for(var e=this._createindex;e<this._attritemlist.length;++e)
this._attritemlist[e].active=!1},CreateAttr:function(){if(this._createindex=0,this.AddAttr("Cấp: "+this._curlevel,this._curlevel+1),1==this._teamskillitemjson.id||4==this._teamskillitemjson.id){var e={1:"ST: ",4:"Hồi HP: "},t=this._teamskillitemjson.levels[this._curlevel-1].dmg_static[0]*this._teamskillitemjson.levels[this._curlevel-1].hits,a=this._teamskillitemjson.levels[this._curlevel].dmg_static[0]*this._teamskillitemjson.levels[this._curlevel].hits,n=e[this._teamskillitemjson.id]+" "+t;if(this.AddAttr(n,a),this._isPlayEffect){var i=667,r=750;S.runEquipPropEffect(C.getInstance().node,{elemIdx:7,upgradeLv:1,tipPos:cc.p(i-70,r-130),propPos:cc.p(i-70,r-280)},[[{1:7,4:8}
[this._teamskillitemjson.id],a-t]],null,C.getInstance()._raw_assets)}}else if(2==this._teamskillitemjson.id||3==this._teamskillitemjson.id){e=["HP:","Công:","Phòng:"];var s=this._teamskillitemjson.levels[this._curlevel-1].creatures,o=this._teamskillitemjson.levels[this._curlevel].creatures,c={},l={},h=M.getUnitPropAttr(s.unit_type,s.unit_grade,s.unit_level),d=v(h,3);c[0]=d[0],c[1]=d[1],c[2]=d[2];var _=M.getUnitPropAttr(o.unit_type,o.unit_grade,o.unit_level),u=v(_,3);l[0]=u[0],l[1]=u[1],l[2]=u[2];for(var m=0;m<e.length;++m)
this.AddAttr(e[m]+" "+c[m],l[m]);if(this._isPlayEffect){var p=(i=667)-70,f=(r=750)-130,g=i-70,y=r-280;S.runEquipPropEffect(C.getInstance().node,{elemIdx:7,upgradeLv:1,tipPos:cc.p(p,f),propPos:cc.p(g,y)},[[1,l[0]-c[0]],[2,l[1]-c[1]],[3,l[2]-c[2]]],null,C.getInstance()._raw_assets)}}
this.DisableAttr()},AddAttr:function(e,t){var a=null;this._createindex<this._attritemlist.length?a=this._attritemlist[this._createindex]:(a=cc.instantiate(this.m_pTeamSkillAttrItem),this.m_pAttritemParent.addChild(a),this._attritemlist.push(a)),a.active=!0,a.getComponent("TeamSkillAttritem").ChangeData(e,t,this._isPlayEffect),++this._createindex},CreateEffect:function(){null!=this._tmskstreffect&&(this._tmskstreffect.removeFromParent(),this._tmskstreffect.destroy(),(this._tmskstreffect=null)!=this._effanim&&this._effanim.off("finished",this.onAnimCompleted,this)),this._tmskstreffect=cc.instantiate(this.m_ptmSkStreffect),this.m_pIcon.node.addChild(this._tmskstreffect),this._tmskstreffect.setScale(2),this._effanim=this._tmskstreffect.getComponent(cc.Animation),this._effanim.on("finished",this.onAnimCompleted,this),this._effanim.play()},onAnimCompleted:function(){cc.log(" ta truyền phát tin xong rồi bắt đầu cắt bỏ "),null!=this._effanim&&this._effanim.off("finished",this.onAnimCompleted,this),null!=this._tmskstreffect&&(this._tmskstreffect.removeFromParent(),this._tmskstreffect.destroy(),this._tmskstreffect=null),this._effanim=null,this.Init(),this._isPlayEffect=!1},SendC2STeamSkillUpgrade:function(){i.send_C2STeamSkillUpgrade(DonotDestroyManager._gameSocket,this._index)},Upgrade_OnClickHandler:function(){if(c.playBtnOpenEffect(),this._curpoint<this._teamskillitemjson.levels[this._curlevel].upgrade[1])
return this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").InitTwoBtnContent("Nguyên Soái,bạn không đủ Sao Tăng Lv,có thể nhận sao bằng cách bên dưới",this.TipGoStage.bind(this),this.TipGoEliteStage.bind(this),!0,"Phó Bản","Phó Bản Tinh Anh"),void(this.node.active=!1);if(MyPersistDataManager._playerData.level<this._teamskillitemjson.levels[this._curlevel].upgrade[0]){var e=this;return this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer),this._alert_layer.getComponent("AlertLayerManager").initContent("Nguyên Soái,Lv Quân Đoàn của bạn không đủ.",function(){null!=e._alert_layer&&(e._alert_layer.removeFromParent(),e._alert_layer.destroy(),e._alert_layer=null)}),void(this.node.active=!1)}
this.SendC2STeamSkillUpgrade()},TipGoStage:function(){MyUiManager.Open(MyUiManager.PanelInfo.StageMapPanel,{iselite:!1}),null!=this._alert_layer&&(this._alert_layer.removeFromParent(),this._alert_layer.destroy(),this._alert_layer=null)},TipGoEliteStage:function(){MyUiManager.Open(MyUiManager.PanelInfo.StageMapPanel,{iselite:!0}),null!=this._alert_layer&&(this._alert_layer.removeFromParent(),this._alert_layer.destroy(),this._alert_layer=null)},UpdateAttr:function(){this._isPlayEffect=!0,this.CreateEffect()},PlayUpgradeEffect:function(){1==this._teamskillitemjson.id||4==this._teamskillitemjson.id||2==this._teamskillitemjson.id||this._teamskillitemjson.id},Mack_OnClickHandler:function(){c.playBtnCloseEffect(),this.node.active=!1},onDestroy:function(){n.removeListener(r.S2CTeamSkillUpgrade,this.S2CTeamSkillUpgrade_cb_func)},showGuide:function(){var t=this;o.showGuide("TeamSkillUpgrade",function(e){if(1==e)
return t.m_btnUpgrade})}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",PropHintsEffect:"PropHintsEffect",SoundUtil:"SoundUtil",TeamSkillBufferMgr:"TeamSkillBufferMgr",TeamSkillPanel:"TeamSkillPanel",UnitConfigMgr:"UnitConfigMgr"}],TestActLeftItem:[function(e,t,a){"use strict";cc._RF.push(t,"132b76UPW1PMKP6+jCNTrAk","TestActLeftItem"),cc.Class({extends:cc.Component,properties:{m_pItemSprite:cc.Sprite,node_selected:cc.Node,node_redPoint:cc.Node,_spritBtn:null,_actState:-1,_actId:-1},onLoad:function(){},ChangeData:function(e){if(this._actId=e,this.node.color=new cc.Color(150,150,150),-1!=this._actState){var t="UI/ActTitle/"+(0==this._actState?DonotDestroyManager.GameData.TestActivities[e]:DonotDestroyManager.GameData.ActivityDynamic[e]).icon,a=this;cc.loader.loadRes(t,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),a.m_pItemSprite.spriteFrame=t}),this._spritBtn=this.node.getComponent(cc.Button),this.refreshRedPoints()}},refreshRedPoints:function(){-1<MyPersistDataManager._playerData.RedPointActivity.indexOf(this._actId+(0==this._actState?1001:1e3))?this.node_redPoint.active=!0:this.node_redPoint.active=!1},setSelected:function(e){e?(this.node.color=new cc.Color(255,255,255),this.node_selected.active=!0):(this.node.color=new cc.Color(150,150,150),this.node_selected.active=!1)}}),cc._RF.pop()},{}],TestActivityLayer:[function(e,t,a){"use strict";cc._RF.push(t,"85336Cuf3pKzaVibNzNZi6g","TestActivityLayer");var n=e("SoundUtil"),r=e("MyProtocols"),i=e("NetEvent"),s=e("MyEventDispatcher"),o=e("StageBufferMgr"),c=e("EliteStageBufferMgr"),l=e("GuideBufferMgr"),h=e("MyUIEvent"),d=cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pLeftItem:cc.Prefab,m_pLeftContent:cc.Node,m_pRightContent:cc.Node,lab_activityDesc:cc.Label,m_pRightAwardItem:cc.Prefab,prefab_czjjNode:cc.Prefab,prefab_zpcjNode:cc.Prefab,pre_award_double:cc.Prefab,m_pRewardPanel:cc.Prefab,m_pLeftScrollView:cc.ScrollView,m_pRightScrollView:cc.ScrollView,tog_today_no_show:cc.Toggle,lab_start_time:cc.Label,lab_end_time:cc.Label,lab_left_time:cc.RichText,node_time_forever:cc.Node,node_time_arrow:cc.Node,_activityState:0,_activityList:null,_LeftItemScript:[],_selectId:0,_initActId:-1,_prevSelectId:0,_rightItemScript:[],_czjjNode:cc.Node,_sbjlNode:cc.Node,_zpcjNode:cc.Node},statics:{instance:null,getInstance:function(){return d.instance}},onLoad:function(){(d.instance=this).ActivityList_auth_cb_func=this.ActivityList_auth_cb.bind(this),s.addListener(i.S2CActivityList,this.ActivityList_auth_cb_func),this.ActivitiesGetAward_auth_cb_func=this.ActivitiesGetAward_auth_cb.bind(this),s.addListener(i.S2CActivitiesGetAward,this.ActivitiesGetAward_auth_cb_func),this.redPointsRefresh_cb_func=this.redPointsRefresh_cb.bind(this),s.addListener(h.redPointsRefresh,this.redPointsRefresh_cb_func),this.PushActivityProgressUpdate_cb_func=this.PushActivityProgressUpdate_cb.bind(this),s.addListener(i.PushActivityProgressUpdate,this.PushActivityProgressUpdate_cb_func),this.myPool=new cc.NodePool("MyTemplateHandler"),this.activityItemPool=new cc.NodePool("activityItem");var e=cc.sys.localStorage.getItem("ActivityTodayNoShow");this.tog_today_no_show.isChecked=parseInt(e)},start:function(){this.showGuide()},redPointsRefresh_cb:function(){for(var e=0;e<this._LeftItemScript.length;e++)
this._LeftItemScript[e].refreshRedPoints()},onDestroy:function(){s.removeListener(i.S2CActivityList,this.ActivityList_auth_cb_func),s.removeListener(i.S2CActivitiesGetAward,this.ActivitiesGetAward_auth_cb_func),s.removeListener(i.PushActivityProgressUpdate,this.PushActivityProgressUpdate_cb_func),s.removeListener(h.redPointsRefresh,this.redPointsRefresh_cb_func),this.myPool.clear(),this.activityItemPool.clear(),(d.instance=null)!=this._LeftItemScript&&(this._LeftItemScript.length=0),null!=this._rightItemScript&&(this._rightItemScript.length=0),this._activityList=null},markScrollOffset:function(){var e=this.m_pLeftScrollView.getScrollOffset(),t=this.m_pRightScrollView.getScrollOffset();null!=this._params&&this._params instanceof Object&&(this._params.leftScrollOffset=e,this._params.rightScrollOffset=t)},PushActivityProgressUpdate_cb:function(e){for(var t=0;t<this._activityList.dynamic_activities.length;t++){var a=this._activityList.dynamic_activities[t];if(a.activeBigID==e.activeIdType){a.nComplete=e.progress;break}}
s.dispatchEvent(h.ActivityProgressUpdate,e)},ActivityList_auth_cb:function(e){cc.log(" thu hoạch hoạt động liệt biểu "),this._activityList=e,this.CreateLeftItem(e)},ActivitiesGetAward_auth_cb:function(e){if(cc.log(" thu hoạch thưởng cho liệt biểu "),117!=e.activeIdType){for(var t=[],a=e.gain,n=0;n<a.length;++n)
t.push({itemId:a[n].nID,cnt:a[n].nNum});var i=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(i),i.getComponent("GetRewardPanel")._itemlist=t}
0==this._activityState?this.ChangeNormalRight(e):this.ChangeDynamicRight(e),r.send_C2SListRedPoints(DonotDestroyManager._gameSocket)},ChangeDynamicRight:function(e){if(121==e.activeIdType){var t=this._activityList.dynamic_activities[this._selectId].sub_activities[e.item_index];t.nComplete--,this._rightItemScript[e.item_index].GetRewardDynamicChange(t)}else if(116==e.activeIdType){var a=this._activityList.dynamic_activities[this._selectId].hero_libao_config[e.item_index];a.buy_count--,this._rightItemScript[e.item_index].GetRewardDynamicChange(a)}else if(128==e.activeIdType){this._activityList.dynamic_activities[this._selectId].hero_libao_config[e.item_index].buy_count=0;var n=this._activityList.dynamic_activities[this._selectId];this._rightItemScript[e.item_index].GetRewardDynamicChange(n.hero_libao_config[e.item_index])}else if(117==e.activeIdType){e.lottery_is_pay?this._activityList.dynamic_activities[this._selectId].lottery_wheel_config.my_pay_count--:this._activityList.dynamic_activities[this._selectId].lottery_wheel_config.my_free_count--;var i=this.m_pRightContent.getChildByName("ActivityZPCJDetailNode");null!=i&&i.getComponent("ActivityZPCJDetail").GetRewardDynamicChange(e.item_index,e.gain)}else{this._activityList.dynamic_activities[this._selectId].sub_activities[e.item_index].nState=2;n=this._activityList.dynamic_activities[this._selectId];if(111==e.activeIdType){var r=this.m_pRightContent.getChildByName("ActivityCZJJDetailNode");null!=r&&r.getComponent("ActivityCZJJDetail").GetRewardDynamicChange(e.item_index)}else
this._rightItemScript[e.item_index].GetRewardDynamicChange(n.sub_activities[e.item_index])}},ChangeNormalRight:function(e){var t=this._activityList.dynamic_activities.length,a=this._activityList.fixed_activities[this._selectId-t],n=a.id-1,i=DonotDestroyManager.GameData.TestActivities[n];a.level_index++;var r={rewards:i.rewards[e.item_index-1],levelindex:a.level_index,progress:a.progress,canget:a.can_get_award};if(this._rightItemScript[e.item_index-1].GetRewardChange(r.rewards,r.levelindex,r.progress,r.canget),!(e.item_index>=this._rightItemScript.length)){if(1==a.id)
a.can_get_award=!1;else if(2==a.id||7==a.id){MyPersistDataManager._playerData.level>=i.rewards[e.item_index].limit[0]?a.can_get_award=!0:a.can_get_award=!1}else
4==a.id?o.isStageIdPassed(i.rewards[e.item_index].limit[0])?a.can_get_award=!0:a.can_get_award=!1:5==a.id?c.isStageIdPassed(i.rewards[e.item_index].limit[0])?a.can_get_award=!0:a.can_get_award=!1:6==a.id&&(a.progress>=i.rewards[e.item_index].limit[0]?a.can_get_award=!0:a.can_get_award=!1);var s={rewards:i.rewards[e.item_index],levelindex:a.level_index,progress:a.progress,canget:a.can_get_award};this._rightItemScript[e.item_index].GetRewardChange(s.rewards,s.levelindex,s.progress,s.canget)}},setParams:function(e){this._params=e,this.closeCb=e.closeCb,this._initActId=e.targetActId,this.ScaleToLarge(),r.send_C2SActivityList(DonotDestroyManager._gameSocket)},CreateLeftItem:function(e){for(var t=e.fixed_activities,a=e.dynamic_activities,n=0,i=0;i<a.length;++i)
if(this._initActId==a[i].activeBigID){n=i;break}
for(var r=0;r<a.length;++r){var s=cc.instantiate(this.m_pLeftItem);this.m_pLeftContent.addChild(s),(c=s.getComponent("TestActLeftItem"))._actState=1,c.ChangeData(a[r].activeBigID),this._LeftItemScript.push(c),(l=new cc.Component.EventHandler).target=this.node,l.component="TestActivityLayer",l.handler="LeftItem_onClickHandler",l.customEventData=r,c._spritBtn.clickEvents.push(l),r==n?(c.setSelected(!0),this._selectId=r,this._prevSelectId=r,this._activityState=c._actState,this.CreateRightItem(this._activityList)):c.setSelected(!1)}
for(var o=0;o<t.length;++o){var c,l;s=cc.instantiate(this.m_pLeftItem);this.m_pLeftContent.addChild(s),(c=s.getComponent("TestActLeftItem"))._actState=0,c.ChangeData(t[o].id-1),this._LeftItemScript.push(c),(l=new cc.Component.EventHandler).target=this.node,l.component="TestActivityLayer",l.handler="LeftItem_onClickHandler",l.customEventData=a.length+o,c._spritBtn.clickEvents.push(l)}
null!=this._params.leftScrollOffset&&this.node.runAction(cc.sequence(cc.delayTime(.02),cc.callFunc(function(){this.m_pLeftScrollView.scrollToOffset(this._params.leftScrollOffset)},this)))},CreateRightItem:function(e){if(0==this._activityState){var t=e.dynamic_activities.length,a=e.fixed_activities[this._selectId-t],n=e.fixed_activities[this._selectId-t].id-1,i=(s=DonotDestroyManager.GameData.TestActivities[n]).rewards,r={levelindex:a.level_index,progress:a.progress,canget:a.can_get_award};this.node_time_forever.active=!0,this.lab_start_time.node.active=!1,this.lab_end_time.node.active=!1,this.lab_left_time.node.active=!1,this.node_time_arrow.active=!1}else if(1==this._activityState){var s;n=e.dynamic_activities[this._selectId].activeBigID,i=(s=e.dynamic_activities[this._selectId]).sub_activities,r={progress:s.nComplete};if(this.node_time_forever.active=!1,this.lab_start_time.node.active=!0,this.lab_end_time.node.active=!0,this.lab_left_time.node.active=!0,this.node_time_arrow.active=!0,0==s.EndTime)
this.node_time_forever.active=!0,this.lab_start_time.node.active=!1,this.lab_end_time.node.active=!1,this.lab_left_time.node.active=!1,this.node_time_arrow.active=!1;else{var o=new Date(1e3*s.StartTime);this.lab_start_time.string=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate();var c=new Date(1e3*s.EndTime);this.lab_end_time.string=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate();var l=new Date,h=s.EndTime-l.getTime()/1e3,d=parseInt(h/3600);if(24<=d){var _=parseInt(d/24),u="00ff00";d<=60&&(u="ff0000"),this.lab_left_time.string="( còn thừa <color=#"+u+">"+_+"</c> thiên )"}else
this.lab_left_time.string="( còn thừa <color=#ff0000>"+d+"</c> giờ )"}}
if(this.lab_activityDesc.string=s.des,this.clearActivityDetailItems(),106==n){var m=cc.instantiate(this.pre_award_double);this.m_pRightContent.addChild(m),(g=(this._sbjlNode=m).getComponent("ActivityAwardDoubleContent")).changeData(this._activityList.dynamic_activities[this._selectId],n)}else if(111==n){(m=cc.instantiate(this.prefab_czjjNode)).name="ActivityCZJJDetailNode",this.m_pRightContent.addChild(m),(g=(this._czjjNode=m).getComponent("ActivityCZJJDetail")).changeData(this._activityList.dynamic_activities[this._selectId],n)}else if(117==n){(m=cc.instantiate(this.prefab_zpcjNode)).name="ActivityZPCJDetailNode",this.m_pRightContent.addChild(m),(g=(this._zpcjNode=m).getComponent("ActivityZPCJDetail")).changeData(this._activityList.dynamic_activities[this._selectId],n)}else if(116==n)
for(var p=this._activityList.dynamic_activities[this._selectId],f=0;f<p.hero_libao_config.length;++f){r.rewards=p.hero_libao_config[f],null==(m=this.activityItemPool.get())&&(m=cc.instantiate(this.m_pRightAwardItem)),this.m_pRightContent.addChild(m),(g=m.getComponent("ActivityHeroLiBaoItem")).enabled=!0,m.getComponent("ActivityDBCZItem").enabled=!1,m.getComponent("TestRightAwardItem").enabled=!1,m.getComponent("ActivityQCJJItem").enabled=!1,g.changeData(r.rewards,f,n),this._rightItemScript.push(g)}
else if(121==n)
for(f=0;f<i.length;++f){r.rewards=i[f],null==(m=this.activityItemPool.get())&&(m=cc.instantiate(this.m_pRightAwardItem)),this.m_pRightContent.addChild(m),(g=m.getComponent("ActivityDBCZItem")).enabled=!0,m.getComponent("TestRightAwardItem").enabled=!1,m.getComponent("ActivityQCJJItem").enabled=!1,m.getComponent("ActivityHeroLiBaoItem").enabled=!1,g.changeData(r.rewards,f,n),this._rightItemScript.push(g)}
else if(128==n)
for(p=this._activityList.dynamic_activities[this._selectId],f=0;f<p.hero_libao_config.length;++f){r.rewards=p.hero_libao_config[f],null==(m=this.activityItemPool.get())&&(m=cc.instantiate(this.m_pRightAwardItem)),this.m_pRightContent.addChild(m),(g=m.getComponent("ActivityQCJJItem")).enabled=!0,m.getComponent("ActivityDBCZItem").enabled=!1,m.getComponent("TestRightAwardItem").enabled=!1,m.getComponent("ActivityHeroLiBaoItem").enabled=!1,g.changeData(r.rewards,f,n),this._rightItemScript.push(g)}
else
for(f=0;f<i.length;++f){var g;r.rewards=i[f],null==(m=this.activityItemPool.get())&&(m=cc.instantiate(this.m_pRightAwardItem)),this.m_pRightContent.addChild(m),(g=m.getComponent("TestRightAwardItem")).enabled=!0,m.getComponent("ActivityQCJJItem").enabled=!1,m.getComponent("ActivityDBCZItem").enabled=!1,m.getComponent("ActivityHeroLiBaoItem").enabled=!1,g._actId=n,g._index=f,0==this._activityState?g.ChangeData(r.rewards,r.levelindex,r.progress,r.canget):g.DynamicChangeData(i,r.rewards,r.progress,f),this._rightItemScript.push(g)}
null!=this._params.rightScrollOffset&&this.node.runAction(cc.sequence(cc.delayTime(.02),cc.callFunc(function(){this.m_pRightScrollView.scrollToOffset(this._params.rightScrollOffset),this._params.rightScrollOffset=null},this)))},clearActivityDetailItems:function(){if(0<this._rightItemScript.length)
for(var e=0;e<this._rightItemScript.length;e++)
this.activityItemPool.put(this._rightItemScript[e].node);this._rightItemScript=[],null!=this._sbjlNode&&(this._sbjlNode.destroy(),this._sbjlNode=null),null!=this._czjjNode&&(this._czjjNode.getComponent("ActivityCZJJDetail").reuseItemBox(),this._czjjNode.destroy(),this._czjjNode=null),null!=this._zpcjNode&&(this._zpcjNode.destroy(),this._zpcjNode=null)},LeftItem_onClickHandler:function(e,t){n.playBtnOpenEffect(),this.m_pRightScrollView.stopAutoScroll(),this.m_pRightScrollView.scrollToTop(),this._selectId=parseInt(t),this._selectId!=this._prevSelectId&&(-1<this._prevSelectId&&this._LeftItemScript[this._prevSelectId].setSelected(!1),this._LeftItemScript[this._selectId].setSelected(!0),this._activityState=this._LeftItemScript[this._selectId]._actState,this.CreateRightItem(this._activityList),this._prevSelectId=this._selectId,this._params.targetActId=this._LeftItemScript[this._selectId]._actId)},ScaleToLarge:function(){this.m_pScaelNode.scale=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},showGuide:function(){l.showGuide("TestActivityLayer",null)},OnToggleClick:function(e){n.playBtnOpenEffect(),e.isChecked&&cc.sys.localStorage.setItem("ActivityTodayNoShow-day",(new Date).getDate()),cc.sys.localStorage.setItem("ActivityTodayNoShow",e.isChecked?1:0)}});cc._RF.pop()},{EliteStageBufferMgr:"EliteStageBufferMgr",GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",StageBufferMgr:"StageBufferMgr"}],TestRightAwardItem:[function(e,t,a){"use strict";cc._RF.push(t,"ab996lVEkFKArumX47Rra9o","TestRightAwardItem");var i=e("StagesConfigMgr"),r=e("EliteStagesConfigMgr"),s=e("TestActivityLayer"),n=e("MyProtocols"),o=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pName:cc.Label,m_pProgress:cc.Label,lab_extraMsg:cc.RichText,m_pItemContent:cc.Node,lab_btnName:cc.Label,m_pItemBoxPrefab:cc.Prefab,m_pItemEffect:cc.Prefab,m_pGetMask:cc.Node,m_pGetBtn:cc.Button,_activityState:0,_actId:-1,_itemScript:[],_pjson:null,_levelIndex:0,_progress:0,_canGet:!1,_index:0,_retInfo:null,_subConfigAll:null},onLoad:function(){},ChangeData:function(e,t,a,n){this.lab_btnName.string=" lĩnh thủ ",this.lab_extraMsg.string="",this._activityState=0,this._pjson=e,this._levelIndex=t,this._progress=a,this._canGet=n,this.CreateName(e),this.ClearItemBox(),this.CreateRewardItems(e),this.SetProgress();var i=new cc.Component.EventHandler;i.target=this.node,i.component="TestRightAwardItem",i.handler="GetReward_OnClick",i.customEventData="",this.m_pGetBtn.clickEvents[0]=i},DynamicChangeData:function(e,t,a,n){this._subConfigAll=e,this.lab_btnName.string=" lĩnh thủ ",this._activityState=1,this._levelIndex=n,this._pjson=DonotDestroyManager.GameData.ActivityDynamic[this._actId],this._retInfo=t,this._progress=a,this.lab_extraMsg.string="",24==this._actId&&(this.lab_extraMsg.string="<color=#0fff00>"+this._retInfo.szSubDes+"</c>"),this.CreateName(t),this.ClearItemBox(),this.CreateRewardItems(t),this.SetProgress();var i=new cc.Component.EventHandler;i.target=this.node,i.component="TestRightAwardItem",i.handler="GetReward_OnClick",i.customEventData="",this.m_pGetBtn.clickEvents[0]=i},GetRewardDynamicChange:function(e){this._retInfo=e,this.SetProgress()},GetRewardChange:function(e,t,a,n){this._pjson=e,this._levelIndex=t,this._progress=a,this._canGet=n,this.SetProgress()},CreateName:function(e){if(0==this._activityState){if(null==e.limit[0]||null==e.limit[1])
return;var t=e.limit[0];3==this._actId?t=i.getStageGroupNameId(e.limit[0]):4==this._actId&&(t=r.getStageGroupNameId(e.limit[0])),this.m_pName.string=cc.js.formatStr(e.limit[1],t)}else{var a=e.nSubCount;if(11!=this._pjson.id&&14!=this._pjson.id||(a/=10),this.m_pName.string=cc.js.formatStr(this._pjson.level_des,a),24==this._actId)
if(0==this._levelIndex)
this.m_pName.string=cc.js.formatStr(this._pjson.level_des,a+"");else{var n=this._levelIndex-1;this._subConfigAll[n].nSubCount==a-1?this.m_pName.string=cc.js.formatStr(this._pjson.level_des,a+""):this.m_pName.string=cc.js.formatStr(this._pjson.level_des,this._subConfigAll[n].nSubCount+1+"-"+a)}
else
112==this._actId&&(this.m_pName.string=cc.js.formatStr(this._pjson.level_des,e.nComplete,a))}},SetProgress:function(){this.m_pGetMask.active=!1,this.m_pProgress.node.active=!0,this.m_pGetBtn.node.active=!1,0==s.getInstance()._activityState?this.JudgeNormal():this.JudgeDynamic()},JudgeDynamic:function(){if(2==this._retInfo.nState)
return this.m_pProgress.node.active=!1,void(this.m_pGetMask.active=!0);if(this._progress<this._retInfo.nSubCount){var e=this._progress,t=this._retInfo.nSubCount;11!=this._actId&&14!=this._actId||(e/=10,t/=10),this.m_pProgress.string="Tiến độ: "+e+"/"+t}else
this.m_pProgress.node.active=!1,this.m_pGetBtn.node.active=!0;24==this._actId&&(this.m_pProgress.string="")},JudgeNormal:function(){var e=s.getInstance();if(1==e._selectId||5==e._selectId){var t=MyPersistDataManager._playerData.level;this._levelIndex>this._index?(this.m_pProgress.node.active=!1,this.m_pGetMask.active=!0):this._levelIndex==this._index&&this._canGet?(this.m_pProgress.node.active=!1,this.m_pGetBtn.node.active=!0):t>=this._pjson.limit[0]?this.m_pProgress.string="Tiến độ: "+this._pjson.limit[0]+"/"+this._pjson.limit[0]:this.m_pProgress.string="Tiến độ: "+t+"/"+this._pjson.limit[0]}else
4==e._selectId?this._levelIndex>this._index?(this.m_pProgress.node.active=!1,this.m_pGetMask.active=!0):this._levelIndex==this._index&&this._canGet?(this.m_pProgress.node.active=!1,this.m_pGetBtn.node.active=!0):this.m_pProgress.string="Tiến độ: "+this._progress+"/"+this._pjson.limit[0]:this._levelIndex>this._index?(this.m_pProgress.node.active=!1,this.m_pGetMask.active=!0):this._levelIndex==this._index&&this._canGet?(this.m_pProgress.node.active=!1,this.m_pGetBtn.node.active=!0):this.m_pProgress.string="Tiến độ: 0/1"},CreateRewardItems:function(e){var t;if(this._itemScript=[],0==this._itemScript.length)
if(0==this._activityState){0!=e.money&&this.CreateItemBox(1451,e.money),0!=e.gamemoney&&this.CreateItemBox(1450,e.gamemoney),t=e.items.length;for(var a=0;a<t;++a)
this.CreateItemBox(e.items[a][0],e.items[a][1])}else{t=e.reward.length;for(a=0;a<t;++a)
this.CreateItemBox(e.reward[a].nID,e.reward[a].nNum)}},CreateItemBox:function(e,t){var a=s.getInstance().myPool.get();null==a&&(a=cc.instantiate(this.m_pItemBoxPrefab)),this.m_pItemContent.addChild(a);var n=a.getComponent("ItemBox");n.ChangeItemInfo(e,t,!0,null,!0),null!=n._itemjsoninfo.tier&&0<n._itemjsoninfo.tier&&(n._tiereffect=cc.instantiate(this.m_pItemEffect),a.addChild(n._tiereffect)),this._itemScript.push(n)},ClearItemBox:function(){for(var e=this.m_pItemContent.children.concat(),t=0;t<e.length;++t)
s.getInstance().myPool.put(e[t]);e=[]},GetReward_OnClick:function(e,t){o.playBtnOpenEffect(),0==this._activityState?n.send_C2SActivitiesGetAward(DonotDestroyManager._gameSocket,this._actId+1,this._index):n.send_C2SActivitiesGetAward(DonotDestroyManager._gameSocket,this._actId,this._index)}}),cc._RF.pop()},{EliteStagesConfigMgr:"EliteStagesConfigMgr",MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",StagesConfigMgr:"StagesConfigMgr",TestActivityLayer:"TestActivityLayer"}],TiersCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"c456bs1natIlIbhIaxR44Ak","TiersCfgMgr");var d=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.exports={getTiersInfo:function(e){return null==DonotDestroyManager.GameData.Tiers[e]&&cc.error(" kiểm tra sáo trang không tồn tại ；tiersTid=%s",e),DonotDestroyManager.GameData.Tiers[equipId]},getTierAttr:function(e,t){var a=0,n=0,i=0,r=DonotDestroyManager.GameData.Tiers[e].attrs[t-1];return r.maxhp&&(a+=r.maxhp),r.atk&&(n+=r.atk),r.def&&(i+=r.def),[a,n,i]},getTiersAddtion:function(e,t,a){var n=0,i=0,r=0;if(a){var s=this.getTierAttr(e,t),o=d(s,3);n+=o[0],i+=o[1],r+=o[2]}else
for(var c=2;c<=t;c++){var l=this.getTierAttr(e,c),h=d(l,3);n+=h[0],i+=h[1],r+=h[2]}
return{maxhp:n,atk:i,def:r}}},cc._RF.pop()},{}],TimeClock:[function(e,t,a){"use strict";cc._RF.push(t,"a78b4xNQTVN4LCRuMVSKoQL","TimeClock");var i=e("GameUtils");cc.Class({extends:cc.Component,properties:{time_label:cc.Label,_isRunning:!1,_remainSeconds:0,_counttime:0,_cb:null},onLoad:function(){},update:function(e){this._isRunning&&(this._counttime+=e,1<=this._counttime&&(this._counttime-=1,this._remainSeconds--,this._remainSeconds<=0?(this._isRunning=!1,null!=this._cb&&this._cb()):this.time_label.string=this.formartTime(this._remainSeconds)))},startCheckTime:function(e,t){this._isRunning=!0,this._remainSeconds=e,null!=t&&(this._cb=t),this.time_label.string=this.formartTime(this._remainSeconds)},formartTime:function(e){var t=parseInt(e/3600),a=parseInt(e%3600/60),n=e%60;return i.pad(t,2)+":"+i.pad(a,2)+":"+i.pad(n,2)}}),cc._RF.pop()},{GameUtils:"GameUtils"}],TimeUtil:[function(e,t,a){"use strict";cc._RF.push(t,"2a511RQsjpFqJmj0qVSy7yr","TimeUtil");var i=e("GameUtils"),n=function(){};n.secondToTime=function(e){var t=Math.floor(e/3600),a=Math.floor(e/60)%60,n=e%60;return i.pad(t,2)+":"+i.pad(a,2)+":"+i.pad(n,2)},t.exports=n,cc._RF.pop()},{GameUtils:"GameUtils"}],Tips:[function(i,e,t){"use strict";cc._RF.push(e,"23789HppidHsZjUmNDGX7lm","Tips");var r=i("ColorUtil"),s=i("RuneUtil");cc.Class({extends:cc.Component,properties:{objName_label:cc.Label,itemparent:cc.Node,describe_label:cc.Label,_itembox:null,_itemId:0,_heroDetailNode:cc.Node,_is_show_hero_detail:!1},onLoad:function(){this._is_show_hero_detail=!1},initItemData:function(a,n){if(this._itemId=a,null==this._itembox){var i=this,r="Prefab/ItemBox/ItemBox";cc.loader.loadRes(r,cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null==DonotDestroyManager._iconSpriteFrameMap[r]&&(DonotDestroyManager._iconSpriteFrameMap[r]=t),i._itembox=cc.instantiate(t),i.itemparent.addChild(i._itembox),i.init(a,n)})}else
init(a,n)},initTxtData:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.describe_label.string=e,null!=t&&(this.objName_label.string=t,this.objName_label.node.color=r.getColorByQuality(1))},init:function(e,t){this._itembox.getComponent("ItemBox").ChangeItemInfo(e,0);var a=t.des;null!=DonotDestroyManager.GameData.Runes[e]&&(a=s.getRuneDesc(DonotDestroyManager.GameData.Runes[e])),this.describe_label.string=a,this.objName_label.string=t.name,this.objName_label.node.color=r.getColorByQuality(t.quality);var n=this;null==DonotDestroyManager.GameData.Cards[e]&&null==DonotDestroyManager.GameData.CardFrags[e]||cc.loader.loadRes("Prefab/ui/common/TipHeroIcon",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);n._heroDetailNode=a,n.node.addChild(a)})},onTouchMove:function(e){if(null!=this._heroDetailNode&&1!=this._is_show_hero_detail){var t=this._heroDetailNode.convertTouchToNodeSpaceAR(e.touch);if(Math.abs(t.x)<=this._heroDetailNode.width/2&&Math.abs(t.y)<=this._heroDetailNode.height/2){cc.log("touch in!");var a=this._itemId;null!=DonotDestroyManager.GameData.CardFrags[this._itemId]&&(a=DonotDestroyManager.GameData.CardFrags[this._itemId].card_id);var n=i("TestActivityLayer");null!=n.getInstance()&&n.getInstance().markScrollOffset(),MyUiManager.Open(MyUiManager.PanelInfo.HeroShowPanel,{card_tpl_id:a}),this.node.destroy()}}},onDestroy:function(){this._itembox=null}}),cc._RF.pop()},{ColorUtil:"ColorUtil",RuneUtil:"RuneUtil",TestActivityLayer:"TestActivityLayer"}],TreaFragBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"cd7b1Wdl/xH4JGvNbyHvWO/","TreaFragBufferMgr");var n=function(){};n.prototype.initTreasureFragList=function(e){if(e.length<=0)
this.mTreaFragList=[];else{this.mTreaFragList=[];for(var t=DonotDestroyManager.GameData.TreasureFrags,a=0;a<e.length;++a){var n=e[a];n.treaFragCfg=t[n.template_id],this.mTreaFragList.push(n)}}},n.prototype.AddTreaFragEntity=function(e){for(var t=null,a=0;a<this.mTreaFragList.length;++a){var n=this.mTreaFragList[a];n.template_id==e.template_id&&(t=n)}
if(null!=t)
t.num=e.num;else{var i=DonotDestroyManager.GameData.TreasureFrags;e.treaFragCfg=i[e.template_id],this.mTreaFragList.push(e)}},n.prototype.AddTreaFragNum=function(e,t){for(var a=null,n=0,i=0;i<this.mTreaFragList.length;++i){var r=this.mTreaFragList[i];r.template_id==e&&(a=r,n=i)}
null!=a&&t<=0&&this.mTreaFragList.splice(n,1)},n.prototype.getTreasureFragIdList=function(){for(var e=[],t=0;t<this.mTreaFragList.length;++t){var a=this.mTreaFragList[t];0<a.num&&e.push(a.template_id)}
return e},t.exports=new n,cc._RF.pop()},{}],TreaRefineItem:[function(e,t,a){"use strict";cc._RF.push(t,"244be1k5RtGloBTGTt1Apj5","TreaRefineItem");e("ItemBufferMgr");cc.Class({extends:cc.Component,properties:{m_pNum:cc.Label,m_pItemParent:cc.Node,_hasnum:-1,_neednum:-1},onLoad:function(){},ChangeData:function(e,t,a){this._hasnum=t,this._neednum=e[1],this.m_pNum.string=this._hasnum+"/"+e[1],this._hasnum<e[1]?this.m_pNum.node.color=cc.Color.RED:this.m_pNum.node.color=cc.Color.GREEN;var n=cc.instantiate(a["Prefab/ItemBox/ItemBox"]);this.m_pItemParent.addChild(n),n.getComponent("ItemBox").ChangeItemInfo(e[0],e[1],!1,null,!0)}}),cc._RF.pop()},{ItemBufferMgr:"ItemBufferMgr"}],TreaRefineLayer:[function(e,t,a){"use strict";cc._RF.push(t,"13a5bAvgjtA6a0OF61QTBO3","TreaRefineLayer");var v=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=e("TreasureRefreshCfgMgr"),i=e("ColorUtil"),M=e("TreasureBufferMgr"),S=e("PropHintsEffect"),r=e("MyEventDispatcher"),o=e("MyProtocols"),s=e("NetEvent"),c=e("ItemBufferMgr"),l=e("SoundUtil"),h=e("GuideBufferMgr"),C=e("i18n");cc.Class({extends:cc.Component,properties:{m_pIconParent:cc.Node,m_pNeedItemParent:cc.Node,m_pAttrParent:cc.Node,m_pAttrItem:cc.Prefab,m_pTreaRefine1:cc.Prefab,m_pTreaRefine2:cc.Prefab,m_pTreaRefineitem:cc.Node,m_pName:cc.Label,m_pLevel:cc.Label,m_pMoney:cc.Label,m_pframeIconBg:cc.SpriteFrame,m_pStarList:[cc.Sprite],m_pStarSprFrame:[cc.SpriteFrame],btnXiLian:cc.Node,_treabuffer:null,_treacfg:null,_curstar:-1,_raw_assets:null,_cb:null,_createindex:-1,_attritemlist:[],_needitemlist:[],_isPlayEffect:!1,_gamemoney:-1,_needitems:[],_treamatlist:[]},setParams:function(e){this._treabuffer=e.buffer,this._treacfg=DonotDestroyManager.GameData.Treasures[this._treabuffer.template_id],this._cb=e.cb,this._raw_assets=e.map,this._curstar=this._treabuffer.stars,this.Init()},onLoad:function(){this.S2CTreasureRefresh_cb_func=this.S2CTreasureRefresh_cb.bind(this),r.addListener(s.S2CTreasureRefresh,this.S2CTreasureRefresh_cb_func)},Init:function(){this.InitContent(),this.InitStarContent(),this.CreateTopItemBox(),this.RefreshLeftLayout()},InitStarContent:function(){for(var e=0;e<this.m_pStarList.length;++e)
e<this._curstar?this.m_pStarList[e].spriteFrame=this.m_pStarSprFrame[1]:this.m_pStarList[e].spriteFrame=this.m_pStarSprFrame[0]},InitContent:function(){this.m_pName.string=this._treacfg.name,this.m_pName.node.color=i.getColorByQuality(this._treacfg.quality),this.m_pLevel.string="+"+this._treabuffer.enhance_level},RefreshLeftLayout:function(){var e=this.getMatConsumes(),t=v(e,2);this._gamemoney=t[0],this._needitems=t[1],this.m_pMoney.string="x"+this._gamemoney,this._gamemoney>MyPersistDataManager._playerData.gameMoney?this.m_pMoney.node.color=cc.Color.RED:this.m_pMoney.node.color=cc.Color.GREEN,this.CreateRefineItem(this._needitems),this.RefreshAttr()},S2CTreasureRefresh_cb:function(e){cc.log(" bảo vật tinh luyện tin tức tiếp thu "),0<e.card_id&&(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight),l.playTreaRefineEffect(),MyPersistDataManager._playerData.bagMap[e.treasure_uuid].stars=e.stars,this._curstar=e.stars,this._isPlayEffect=!0;var t=this;this.PlayStarEffect(e.stars-1,function(){t.showTreaRefineAnim(function(){t.RefreshLeftLayout()})})},RefreshAttr:function(){var e=this._curstar+1,t=0==this._curstar?0:this._curstar-1;10<e&&(e=10);var a=M.getTemperPropAttr(this._treabuffer.uuid,!0,t),n=v(a,6),i=n[0],r=n[1],s=n[2],o=(n[3],n[4],n[5],M.getTemperPropAttr(this._treabuffer.uuid,!0,this._curstar)),c=v(o,6),l=c[0],h=c[1],d=c[2],_=(c[3],c[4],c[5],M.getTemperPropAttr(this._treabuffer.uuid,!0,e)),u=v(_,6),m=u[0],p=u[1],f=u[2],g=(u[3],u[4],u[5],[]),y=[];0!=m?(g.push([C.t("detail_004",{value:l}),m]),y.push([1,l-i])):0!=p?(g.push([C.t("detail_005",{value:h}),p]),y.push([2,h-r])):0!=f&&(g.push([C.t("detail_006",{value:d}),f]),y.push([3,d-s])),this._createindex=0,this._createindex<g.length&&this.AddAttr(g[this._createindex][0],g[this._createindex][1]),this._isPlayEffect&&(S.runHeroPropEffect(this.node,{elemIdx:5,stateIdx:1,upgradeLv:1},y,null,this._raw_assets),this._isPlayEffect=!1)},PlayStarEffect:function(a,n){var i=this,e=cc.sequence(cc.delayTime(.2),cc.callFunc(function(){var e=cc.instantiate(i.m_pTreaRefine2);i.m_pStarList[a].node.addChild(e),e.setScale(.6);var t=e.getComponent(dragonBones.ArmatureDisplay);t.armature().animation.fadeIn("treaRefine2",-1,-1,0,"normal"),t.addEventListener(dragonBones.EventObject.COMPLETE,function(){e.removeFromParent(),e.destroy(),i.InitStarContent(),null!=n&&n()},i)})),t=cc.spawn(e,cc.callFunc(function(){var e=new cc.Node;cc.sequence(cc.callFunc(function(){e.addComponent(cc.Sprite).spriteFrame=i.m_pframeIconBg,i.m_pStarList[a].node.addChild(e,10),e.setPosition(20,20),e.setScale(.35)}),cc.delayTime(.05),cc.callFunc(function(){e.runAction(cc.fadeOut(.05))}))}));this.m_pStarList[a].node.runAction(t)},showTreaRefineAnim:function(e){var t=cc.instantiate(this.m_pTreaRefine1);this.m_pIconParent.addChild(t);var a=t.getComponent(dragonBones.ArmatureDisplay);a.armature().animation.fadeIn("treaRefine1",-1,-1,0,"normal"),a.addEventListener(dragonBones.EventObject.COMPLETE,function(){t.removeFromParent(),t.destroy(),null!=e&&e()},this)},AddAttr:function(e,t){var a=null;this._createindex<this._attritemlist.length?a=this._attritemlist[this._createindex]:(a=cc.instantiate(this.m_pAttrItem),this.m_pAttrParent.addChild(a),this._attritemlist.push(a)),a.active=!0,a.setPosition(0,0),a.getComponent("AttributeChangeItem").ChangeData(e,t,this._isPlayEffect),++this._createindex},getMatConsumes:function(){var e=n.getTreasureRefreshCfg(this._treabuffer.template_id,10==this._curstar?10:this._curstar+1);return[e.cost.gamemoney,e.cost.items]},CreateRefineItem:function(e){this.ClearRefineItem();for(var t=0;t<e.length;++t){var a=0;c.isTreasureEntity(e[t][0])?(this._treamatlist=this.getTreaSameTmpIdList(this._treabuffer.uuid,e[t][0]),a=this._treamatlist.length):a=null==MyPersistDataManager._playerData.bagMap[e[t][0]]?0:MyPersistDataManager._playerData.bagMap[e[t][0]].num;var n=null;if(t<this._needitemlist.length)
this._needitemlist[t].active=!0,n=this._needitemlist[t].getComponent("TreaRefineItem");else{var i=cc.instantiate(this.m_pTreaRefineitem);this.m_pNeedItemParent.addChild(i),n=i.getComponent("TreaRefineItem"),this._needitemlist.push(i)}
n.node.active=!0,n.ChangeData(e[t],a,this._raw_assets)}},ClearRefineItem:function(){if(!(null==this._needitemlist||this._needitemlist.length<=0))
for(var e=0;e<this._needitemlist.length;++e)
this._needitemlist[e].active=!1},CreateTopItemBox:function(){var e=cc.instantiate(this._raw_assets["Prefab/ItemBox/ItemBox"]);this.m_pIconParent.addChild(e),e.getComponent("ItemBox").ChangeItemInfo(this._treabuffer.template_id,0),e.setScale(.8)},getTreaSameTmpIdList:function(e,t){for(var a=[],n=0;n<MyPersistDataManager._playerData.baglist.length;++n){var i=MyPersistDataManager._playerData.baglist[n];c.isTreasureEntity(i.template_id)&&i.template_id==t&&i.uuid!=e&&null==i.heroid&&a.push(i)}
return a.sort(function(e,t){return e.enhance_level!=t.enhance_level?e.enhance_level-t.enhance_level:e.stars-t.stars}),a},OnClickHandler:function(e){if(this._isPlayEffect)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),C.t("detail_053"));else if(10!=this._treabuffer.stars)
if(this._gamemoney>MyPersistDataManager._playerData.gameMoney)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),C.t("129"));else{for(var t=0;t<this._needitemlist.length;++t){var a=this._needitemlist[t].getComponent("TreaRefineItem"),n=[a._hasnum,a._neednum];if(n[0]<n[1])
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),C.t("detail_055"))}
var i=[];for(t=0;t<this._needitems.length;++t){var r=this._needitems[t];if(c.isTreasureEntity(r[0]))
for(var s=0;s<r[1];++s)
i.push(this._treamatlist[s].uuid)}
o.send_C2STreasureRefresh(DonotDestroyManager._gameSocket,this._treabuffer.uuid,i)}
else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),C.t("detail_054"))},Mask_OnClickHandler:function(e){MyUiManager.Back(),l.playBtnCloseEffect(),null!=this._cb&&this._cb()},onDestroy:function(){r.removeListener(s.S2CTreasureRefresh,this.S2CTreasureRefresh_cb_func)},start:function(){this.showGuide()},showGuide:function(){var t=this;h.showGuide("TreaRefineLayer",function(e){if(1==e)
return t.btnXiLian},function(){t.showGuide()})}}),cc._RF.pop()},{ColorUtil:"ColorUtil",GuideBufferMgr:"GuideBufferMgr",ItemBufferMgr:"ItemBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",NetEvent:"NetEvent",PropHintsEffect:"PropHintsEffect",SoundUtil:"SoundUtil",TreasureBufferMgr:"TreasureBufferMgr",TreasureRefreshCfgMgr:"TreasureRefreshCfgMgr",i18n:"i18n"}],TreasureBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"467173LF8dNf5z5J7tpakTk","TreasureBufferMgr");var C=e("TreasuresCfgMgr"),D=e("TreasureRefreshCfgMgr"),I=function(){this.mTreaList=[]};I.resetData=function(){I.is_init=!1};var n=null;I.getInstance=function(){return null==n&&(n=new I),n},I.prototype.initTreasureList=function(e){if(!I.is_init){I.is_init=!0,this.mTreaList=[];for(var t=0;t<e.length;t++){var a=e[t];this.addTreaEntity(a)}}},I.prototype.getList=function(){return this.mTreaList},I.prototype.addTreaEntity=function(e){this.mTreaList.push(e)},I.prototype.removeTreasure=function(e){for(var t=-1,a=0;a<this.mTreaList.length;++a){if(this.mTreaList[a].uuid==e){t=a;break}}
-1<t&&this.mTreaList.splice(t,1)},I.prototype.getFreeTreaByPos=function(e){for(var t=null,a=DonotDestroyManager.GameData.Common.treasure_levelup_items[e-1],n=Object.keys(a),i=0;i<this.mTreaList.length;++i){var r=this.mTreaList[i];if(null==r.heroid)
if(!(-1<n.indexOf(""+r.template_id)))
if(DonotDestroyManager.GameData.Treasures[r.template_id].position==e){t=r;break}}
return t},I.prototype.getFreeTreaCount=function(e){for(var t=0,a=0;a<this.mTreaList.length;++a){var n=this.mTreaList[a];null==n.heroid&&(n.template_id==e&&t++)}
return t},I.getTreasureByUid=function(e){return MyPersistDataManager._playerData.bagMap[e]},I.getTreaPropAttr=function(e,t,a,n){var i=I.getTreasureByUid(e);cc.assert(i,"Treasure[%d] is not find.",e),a=null==a?i.enhance_level:a;var r=i.template_id,s=C.getTreasureById(r),o=s.ori_attrs,c=s.add_attrs,l=s.unlocks,h={rate:{},statics:{}};if(o&&o.rate)
for(var d in o.rate){var _=o.rate[d];h.rate[d]=_}
if(c&&c.rate)
for(var d in c.rate){_=c.rate[d];h.rate[d]=h.rate[d]+_*a}
if(l)
for(var u in l){var m=l[u];if(u<=a&&m&&m.rate)
for(var d in m.rate){_=m.rate[d];h.rate[d]=(h.rate[d]||0)+m.rate[d]}}
if(o&&o.statics)
for(var d in o.statics){_=o.statics[d];h.statics[d]=_}
if(c&&c.statics)
for(var d in c.statics){_=c.statics[d];h.statics[d]=h.statics[d]+_*a}
if(l)
for(var u in l){m=l[u];if(u<=a&&m&&m.statics)
for(var d in m.statics){_=m.statics[d];h.statics[d]=(h.statics[d]||0)+m.statics[d]}}
var p=h.statics.maxhp||0,f=h.statics.atk||0,g=h.statics.def||0,y=h.rate.maxhp||0,v=h.rate.atk||0,M=h.rate.def||0,S=D.getAttrCoef(i.template_id,i.stars);return S&&S.statics&&(p+=S.statics.maxhp||0,f+=S.statics.atk||0,g+=S.statics.def||0),S&&S.rate&&(y+=S.rate.maxhp||0,v+=S.rate.atk||0,M+=S.rate.def||0),[p,f,g,y,v,M]},I.getExtraPropAttr=function(e,t){var a=I.getTreasureByUid(e),n={},i=a.template_id,r=C.getTreasureById(i),s=r.ori_attrs,o=r.add_attrs;if(t=null==t?a.enhance_level:t,s&&s.statics&&!(s.statics instanceof Array))
for(var c in s.statics){var l=s.statics[c];n[c]=l}
if(o&&o.statics&&!(o.statics instanceof Array))
for(var c in o.statics){l=o.statics[c];n[c]=n[c]+l*t}
return n.maxhp=null,n.atk=null,n.def=null,n},I.getStrengthPropAttr=function(e,t){var a=I.getTreasureByUid(e),n=0,i=0,r=0,s=0,o=0,c=0;if(null==a)
return[n,i,r,s,o,c];var l=DonotDestroyManager.GameData.Treasures[a.template_id],h=l.ori_attrs,d=l.add_attrs;t=null==t?a.enhance_level:t;var _={};if(h&&h.rate){_.rate={};for(var u=Object.keys(h.rate),m=0;m<u.length;++m)
_.rate[u[m]]=h.rate[u[m]]}
if(d&&d.rate)
for(u=Object.keys(d.rate),m=0;m<u.length;++m)
_.rate[u[m]]+=d.rate[u[m]]*t;if(h&&h.statics){_.statics=[];var p=Object.keys(h.statics);for(m=0;m<p.length;++m)
_.statics[p[m]]=h.statics[p[m]]}
if(d&&d.statics)
for(p=Object.keys(d.statics),m=0;m<p.length;++m)
_.statics[p[m]]+=d.statics[p[m]]*t;return[n=_.statics.maxhp||0,i=_.statics.atk||0,r=_.statics.def||0,s=_.rate.maxhp||0,o=_.rate.atk||0,c=_.rate.def||0]},I.getTemperPropAttr=function(e,t,a){var n=I.getTreasureByUid(e),i=0,r=0,s=0,o=0,c=0,l=0;if(null==n)
return[i,r,s,o,c,l];var h=null==a?n.stars:a,d=D.getAttrCoef(n.template_id,h);return d&&d.statics&&(i+=d.statics.maxhp||0,r+=d.statics.atk||0,s+=d.statics.def||0),d&&d.rate&&(o+=d.rate.maxhp||0,c+=d.rate.atk||0,l+=d.rate.def||0),[i,r,s,o,c,l]},t.exports=I,cc._RF.pop()},{TreasureRefreshCfgMgr:"TreasureRefreshCfgMgr",TreasuresCfgMgr:"TreasuresCfgMgr"}],TreasureFragsCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"ce9ccfdewVD2LKjHyuqelfd","TreasureFragsCfgMgr");var n=function(){};n.getTreasureFragByIdx=function(e){var t=DonotDestroyManager.GameData.TreasureFrags;return null!=t[e+3500]?t[e+3500]:null},n.getTreasureFragById=function(e){var t=DonotDestroyManager.GameData.TreasureFrags;return null!=t[e]?t[e]:null},n.getTreasureFragCnt=function(){var e=DonotDestroyManager.GameData.TreasureFrags;return Object.keys(e).length},n.getTreasureList=function(e){if(!(null==e||e.length<=0)){for(var t=DonotDestroyManager.GameData.TreasureFrags,a=[],n=0;n<e.length;++n){var i=e[n];null!=t[i]&&a.push(t[i].treasure)}
return a}},t.exports=n,cc._RF.pop()},{}],TreasureLevelsMgr:[function(e,t,a){"use strict";cc._RF.push(t,"90e12JP/LBEKoiY/v9gq9+J","TreasureLevelsMgr");var n=function(){};n.getTreasureLevelTotalExp=function(e,t){var a=0,n=DonotDestroyManager.GameData.TreasureLevels.levels[e-1],i=n.length-1;t<i&&(i=t);for(var r=0;r<i;++r)
a+=n[r][0];return a},n.getTreasureLevelExpMax=function(e){for(var t=0,a=DonotDestroyManager.GameData.TreasureLevels.levels[e-1],n=a.length-1,i=1;i<n;++i)
t+=a[i][0];return t},n.getTreasureLevelExp=function(e,t){var a=DonotDestroyManager.GameData.TreasureLevels.levels[e-1],n=a.length-1;return t<n&&(n=t),a[n][0]},n.getLevelCost=function(e,t){var a=DonotDestroyManager.GameData.TreasureLevels.levels[e-1],n=a.length-1;t<n&&(n=t);for(var i=0;i<n;++i)
a[i][0],levelCost+=a[i][1]*a[i][0];return levelCost},n.getTreasureLevelCost=function(e,t){var a=DonotDestroyManager.GameData.TreasureLevels.levels[e-1],n=a.length-1;return t<n&&(n=t),a[n][1]*a[n][0]},n.getTreasureLevelCfg=function(e,t){var a=DonotDestroyManager.GameData.TreasureLevels.levels[e-1],n=a.length-1;return t<n&&(n=t),a[n]},n.getTreasureLevelMax=function(e){return DonotDestroyManager.GameData.TreasureLevels.levels[e-1].length-1},n.getTreasureLvByExp=function(e,t){if(0==t)
return 0;for(var a=DonotDestroyManager.GameData.TreasureLevels.levels[e-1],n=a.length-1,i=0,r=0;r<n;++r)
if(t<=(i+=a[r][0]))
return r+=1;return n},n.getCostByExp=function(e,t,a){for(var n=DonotDestroyManager.GameData.TreasureLevels.levels[e-1],i=n.length-1,r=0,s=0,o=0;o<i;++o)
if(o<=a){if(t<=(r+=n[o][0]))
return s;s+=n[o][0]*n[o][1]}
return 0},t.exports=n,cc._RF.pop()},{}],TreasureRefreshCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"1c426cDqEVOB6tGx29p6tbZ","TreasureRefreshCfgMgr"),t.exports={getAttrCoef:function(e,t){var a=DonotDestroyManager.GameData.TreasureRefine[e];return null==a?(cc.warn("trea:getAttrCoef not exist: %d",e),null):a[t].attrs},getTreasureRefreshCfg:function(e,t){return DonotDestroyManager.GameData.TreasureRefine[e][t]}},cc._RF.pop()},{}],TreasureStrengthen:[function(e,t,a){"use strict";cc._RF.push(t,"c43b2WMoBpOTYCIe/TbKOXH","TreasureStrengthen");var P=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},l=e("ColorUtil"),L=e("EquipBufferMgr"),n=e("ItemBufferMgr"),_=e("TreasureLevelsMgr"),B=e("TreasureBufferMgr"),i="normal",w=e("PropHintsEffect"),r=e("MyEventDispatcher"),s=e("MyProtocols"),o=e("NetEvent"),c=e("SoundUtil"),h=e("i18n"),d=e("GuideBufferMgr"),u=e("MyUIEvent");cc.Class({extends:cc.Component,properties:{m_pAttrItem:cc.Prefab,m_pherolvup:cc.Prefab,m_pheroTreaStr1:cc.Prefab,m_pheroTreaStr2:cc.Prefab,m_pItemParent:cc.Node,m_pAttrParent:cc.Node,m_pRightItemParent:cc.Node,m_pLeftItemParent:cc.Node,m_pName:cc.Label,m_pLevel:cc.Label,m_pExp:cc.Label,m_pNeedMoney:cc.Label,m_pCurbar:cc.Sprite,m_pNextbar:cc.Sprite,m_pNoLab:cc.Node,btnOneKeyAdd:cc.Node,btnStrength:cc.Node,_cb:null,_equipbuffer:null,_index:-1,_equipcfg:null,_raw_assets:null,_selectitemlist:[],_selectitemmap:{default:{},type:Object},_iteminfolist:[],_leftitemlist:[],_rightitemlist:[],_attritemlist:[],_oldpre:null,_curlevel:-1,_createindex:-1,_isPlayEffect:!1,_type:-1,_commonjson:null,_treaSelectCells:[],_mPropList:[]},onLoad:function(){this.S2CTreasureEnhance_cb_func=this.S2CTreasureEnhance_cb.bind(this),r.addListener(o.S2CTreasureEnhance,this.S2CTreasureEnhance_cb_func)},setParams:function(e){this._equipbuffer=e.buffer,this._index=e.index,this._equipcfg=DonotDestroyManager.GameData.Treasures[this._equipbuffer.template_id],this._cb=e.cb,this._raw_assets=e.map,this._oldpre=e.pre,this._type=e.type,this._curlevel=this._equipbuffer.enhance_level,this.Init()},Init:function(){this._commonjson=DonotDestroyManager.GameData.Common,this.CreateLeftItem(),this.GetItemInfoList(),this.InitContent(),this.RefreshAttr(),this.CreateRightItem()},S2CTreasureEnhance_cb:function(e){cc.log(" bảo vật cường hóa tin tức nhận "),0<e.card_id&&(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight!=e.fight&&MyUiManager.OpenFightChangeTipsWidget(MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight,e.fight),MyPersistDataManager._playerData.cardsMaplist[e.card_id].fight=e.fight),c.playEquipStrEffect(),MyPersistDataManager._playerData.bagMap[e.treasure_uuid].enhance_level=e.enhance_level,MyPersistDataManager._playerData.bagMap[e.treasure_uuid].exp=e.exp;var t=this;this.RemoveLeftItem(),e.enhance_level!=this._curlevel&&(this.showHeroAnim(.5,function(){t.ShowProp({curLv:t._curlevel,nextLv:e.enhance_level})}),this.showHeroLevelAnim(1)),this.RefreshLeftLayout(),this.GetItemInfoList(),this.CreateRightItem(),r.dispatchEvent(u.S2CTreasureEnhance)},InitContent:function(){var e=cc.instantiate(this._raw_assets["Prefab/ItemBox/ItemBox"]);this.m_pItemParent.addChild(e),e.getComponent("ItemBox").ChangeItemInfo(this._equipbuffer.template_id,0),this.m_pName.string=this._equipcfg.name,this.m_pName.node.color=l.getColorByQuality(this._equipcfg.quality),this._costCoin=0,this.RefreshLeftLayout()},RefreshAttr:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=[],a=Object.keys(this._equipcfg.ori_attrs.rate),n=0;n<a.length;++n){var i=L.getEquipAttrName(a[n]),r=L.getEquipAttrDes(i),s=(this._equipcfg.ori_attrs.rate[a[n]]+this._equipbuffer.enhance_level*(this._equipcfg.add_attrs.rate[a[n]]||0))/100,o=0;if(0!=e)
o=(e-this._equipbuffer.enhance_level)*(this._equipcfg.add_attrs.rate[a[n]]||0)/100+s;s=r+s+"%",o=0==o?0:o+"%",t.push([s,o])}
var c=Object.keys(this._equipcfg.ori_attrs.statics);for(n=0;n<c.length;++n){i=L.getEquipAttrName(c[n]),r=L.getEquipAttrDes(i),s=this._equipcfg.ori_attrs.statics[c[n]]+this._equipbuffer.enhance_level*(this._equipcfg.add_attrs.statics[c[n]]||0),o=0;if(0!=e)
o=(e-this._equipbuffer.enhance_level)*(this._equipcfg.add_attrs.statics[c[n]]||0)+s;s=r+s,t.push([s,o])}
for(n=this._createindex=0;n<t.length;++n)
this.AddAttr(t[n][0],t[n][1])},RefreshLeftLayout:function(){this.levelMax=_.getTreasureLevelMax(this._equipcfg.quality);var e=this.getTreasureSrcSupplyExp(this._treaSelectCells),t=this.getTreasureUpgradeLV(this._equipbuffer.uuid,e),a=P(t,3),n=a[0],i=a[1],r=a[2];if(this._costCoin=this.getTreasureStrengthReqCoin(this._equipbuffer.uuid,n,i,e),this.m_pNeedMoney.string="x"+this._costCoin,this.m_pExp.string=e,this._costCoin<=MyPersistDataManager._playerData.gameMoney?this.m_pNeedMoney.node.color=cc.Color.GREEN:this.m_pNeedMoney.node.color=cc.Color.RED,this._equipbuffer.enhance_level!=n){if(n<this.levelMax){this.m_pLevel.string="+"+n;var s=e+this._equipbuffer.exp-i,o=DonotDestroyManager.GameData.TreasureLevels.levels[this._equipcfg.quality-1][n+1];this.m_pCurbar.node.scaleX=s/o[0],this.m_pNextbar.node.scaleX=1}else
this.m_pLevel.string="+"+this.levelMax,this.m_pExp.string=0,this.m_pCurbar.node.scaleX=1,this.m_pNextbar.node.scaleX=0;this.m_pLevel.node.color=l.getColorByIndex(3)}else{this.m_pLevel.string="+"+this._equipbuffer.enhance_level,this.m_pLevel.node.color=l.getColorByIndex(0);var c=0==i?0:this._equipbuffer.exp/i;this.m_pCurbar.node.scaleX=c,this.m_pNextbar.node.scaleX=0==i?0:r/i}
this.RefreshAttr(n==this._equipbuffer.enhance_level?0:n)},getTreasureStrengthReqCoin:function(e,t,a,n){if(0==n)
return 0;var i=B.getTreasureByUid(e),r=DonotDestroyManager.GameData.Treasures[i.template_id],s=n+i.exp-a,o=0,c=r.quality,l=DonotDestroyManager.GameData.TreasureLevels.levels[c-1].length-1,h=null;if(h=i.enhance_level<l?_.getTreasureLevelCfg(r.quality,i.enhance_level+1):_.getTreasureLevelCfg(r.quality,l),t==i.enhance_level||0==s)
return o+=n*h[1];o+=(h[0]-i.exp)*h[1];for(var d=i.enhance_level+1;d<t;++d)
o+=_.getTreasureLevelCost(r.quality,d+1);return 0<s&&(o+=s*(h=_.getTreasureLevelCfg(r.quality,t))[1]),o},getTreasureUpgradeLV:function(e,t){var a=B.getTreasureByUid(e),n=DonotDestroyManager.GameData.Treasures[a.template_id],i=t+a.exp;if(0==i)
return[a.enhance_level,0,0];var r=0,s=a.enhance_level,o=n.quality,c=DonotDestroyManager.GameData.TreasureLevels.levels[o-1].length-1;if(s+1<=c){for(;r<i;)
s+=1,r+=_.getTreasureLevelExp(n.quality,s);var l=_.getTreasureLevelExp(n.quality,a.enhance_level+1),h=r-_.getTreasureLevelExp(n.quality,s);return s-=1,l<i&&i<r?0!=r&&0==h?[s,l,i]:[s,h,i]:(i==r&&(s+=1),[s,r,i])}
return[s=c,r=0,i]},getTreasureSrcSupplyExp:function(e){for(var t=0,a=0;a<e.length;++a){var n=e[a];if("0"!=n.uuid){var i=B.getTreasureByUid(n.uuid),r=DonotDestroyManager.GameData.Treasures[i.template_id];t=t+(3198==i.template_id||3199==i.template_id?this._commonjson.treasure_levelup_items[4][i.template_id]:3098==i.template_id||3099==i.template_id?this._commonjson.treasure_levelup_items[5][i.template_id]:_.getTreasureLevelTotalExp(r.quality,i.enhance_level+1))+i.exp}}
return t},ShowProp:function(e){var t=e.curLv,a=e.nextLv,n=B.getStrengthPropAttr(this._equipbuffer.uuid,t),i=P(n,6),r=i[0],s=i[1],o=i[2],c=i[3],l=i[4],h=i[5],d=B.getStrengthPropAttr(this._equipbuffer.uuid,a),_=P(d,6),u=_[0],m=_[1],p=_[2],f=_[3],g=_[4],y=_[5],v=[c/100,l/100,h/100];c=v[0],l=v[1],h=v[2];var M=[f/100,g/100,y/100];f=M[0],g=M[1],y=M[2],this._mPropList=[],0!=c&&0!=f&&f-c!=0&&this._mPropList.push([1,(f-c)/100]),0!=l&&0!=g&&g-l!=0&&this._mPropList.push([2,(g-l)/100]),0!=h&&0!=y&&y-h!=0&&this._mPropList.push([3,(y-h)/100]),0!=r&&0!=u&&u-r!=0&&this._mPropList.push([1,u-r]),0!=s&&0!=m&&m-s!=0&&this._mPropList.push([2,m-s]),0!=o&&0!=p&&p-o!=0&&this._mPropList.push([3,p-o]);for(var S=B.getExtraPropAttr(this._equipbuffer.uuid,t),C=B.getExtraPropAttr(this._equipbuffer.uuid,a),D=Object.keys(S),I=0;I<D.length;++I){var b=S[D[I]];C[D[I]]-b!=0&&this._mPropList.push([L.getEquipAttrName(D[I])+10,C[D[I]]-b])}
w.runHeroPropEffect(this.node,{elemIdx:1,stateIdx:1,upgradeLv:a-t},this._mPropList,null,this._raw_assets),this._curlevel=this._equipbuffer.enhance_level},showHeroLevelAnim:function(e){var t=cc.instantiate(this.m_pherolvup);this.m_pCurbar.node.parent.addChild(t),t.setPosition(120,0);var a=t.getComponent(dragonBones.ArmatureDisplay);a.armature().animation.fadeIn("action1",-1,-1,0,i),a.addEventListener(dragonBones.EventObject.COMPLETE,function(){t.removeFromParent(),t.destroy()},this)},showCellAnim:function(e,t){var a=cc.instantiate(this.m_pheroTreaStr1);e.addChild(a);var n=a.getComponent(dragonBones.ArmatureDisplay);n.armature().animation.fadeIn("heroTreaStr1",-1,-1,0,i),n.addEventListener(dragonBones.EventObject.COMPLETE,function(){a.removeFromParent(),a.destroy(),null!=t&&t()},this)},showHeroAnim:function(e,a){var n=this;setTimeout(function(){var e=cc.instantiate(n.m_pheroTreaStr2);n.m_pItemParent.addChild(e);var t=e.getComponent(dragonBones.ArmatureDisplay);t.armature().animation.fadeIn("heroTreaStr2",-1,-1,0,i),t.addEventListener(dragonBones.EventObject.COMPLETE,function(){e.removeFromParent(),e.destroy(),null!=a&&a()},n)},e)},RemoveLeftItem:function(){for(var t=this,e=0;e<this._leftitemlist.length;++e)
this._leftitemlist[e]._isEmpty||(function(e){t.showCellAnim(t._leftitemlist[e].node,function(){t._leftitemlist[e].SetEmptyItem()})}
(e),this._treaSelectCells[e].uuid="0")},AddAttr:function(e,t){var a=null;this._createindex<this._attritemlist.length?a=this._attritemlist[this._createindex]:(a=cc.instantiate(this.m_pAttrItem),this.m_pAttrParent.addChild(a),this._attritemlist.push(a)),a.active=!0,a.getComponent("AttributeChangeItem").ChangeData(e,t,this._isPlayEffect),++this._createindex},CreateLeftItem:function(){this._treaSelectCells=[];for(var e=0;e<5;++e){var t=null;if(e<this._leftitemlist.length)
t=this._leftitemlist[e];else{var a=cc.instantiate(this._raw_assets["Prefab/ItemBox/ItemBox"]);this.m_pLeftItemParent.addChild(a),t=a.getComponent("ItemBox"),this._leftitemlist.push(t),this._treaSelectCells.push({uuid:"0"})}
t.node.active=!0,t.SetEmptyItem()}},GetItemInfoList:function(){this._iteminfolist=[];for(var e=0;e<MyPersistDataManager._playerData.baglist.length;++e){var t=MyPersistDataManager._playerData.baglist[e];if(n.isTreasureEntity(t.template_id)&&t.uuid!=this._equipbuffer.uuid&&null==t.heroid){var a=DonotDestroyManager.GameData.Treasures[t.template_id];this._equipcfg.position==a.position&&(3==a.quality&&3099!=t.template_id&&3199!=t.template_id||this._iteminfolist.push({template_id:t.template_id,level:t.enhance_level,type:a.position,uuid:t.uuid}))}}},CreateRightItem:function(){if(null==this._iteminfolist||this._iteminfolist.length<=0){this.m_pNoLab.active=!0;for(var e=0;e<this._rightitemlist.length;++e)
this._rightitemlist[e].node.active=!1}else{this.m_pNoLab.active=!1;for(e=0;e<this._iteminfolist.length;++e){var t=null;if(e<this._rightitemlist.length)
t=this._rightitemlist[e];else{var a=cc.instantiate(this._raw_assets["Prefab/ItemBox/ItemBox"]);this.m_pRightItemParent.addChild(a),t=a.getComponent("ItemBox"),this._rightitemlist.push(t),a.setScale(.8)}
t.node.active=!0;var n={template_id:this._iteminfolist[e].template_id,level:this._iteminfolist[e].level,uuid:this._iteminfolist[e].uuid,pos:this._type+1,cb:this.Rightitem_OnClickHandler.bind(this),showlv:!0,showlvbg:!0};t.ChangeEquipInfo(n)}
if(this._iteminfolist.length<this._rightitemlist.length)
for(e=this._iteminfolist.length;e<this._rightitemlist.length;++e)
this._rightitemlist[e].node.active=!1}},GetItemForUid:function(e,t){if(null==e||e.length<=0)
return null;for(var a=0;a<e.length;++a)
if(t==e[a]._uuid)
return e[a];return null},RefreshLeftItemInfo:function(e,t){if(!(2<arguments.length&&void 0!==arguments[2])||arguments[2]){for(var a=0;a<this._leftitemlist.length;++a)
if(this._leftitemlist[a]._isEmpty){var n=MyPersistDataManager._playerData.bagMap[e].template_id;return this._leftitemlist[a].ChangeItemInfo(n,a,!1,this.Leftitem_OnClickHandler.bind(this)),this._leftitemlist[a]._uuid=e,this._treaSelectCells[a].uuid=e,1}}else
for(a=0;a<this._leftitemlist.length;++a)
if(e==this._leftitemlist[a]._uuid)
return this._leftitemlist[a].SetEmptyItem(),this._treaSelectCells[a].uuid="0",1;return 0},Rightitem_OnClickHandler:function(e,t){var a=DonotDestroyManager.GameData.TreasureLevels.levels[this._equipcfg.quality-1].length-1;if(this._equipbuffer.enhance_level>=a)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),h.t("detail_056"));else{t.id;var n=e.getComponent("ItemBox");if(n._isselect){this.RefreshLeftItemInfo(n._uuid,n._itemType,!1);n.SetSelect(!n._isselect,2)}else{if(0==this.RefreshLeftItemInfo(n._uuid,n._itemType,!0))
return void MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),h.t("detail_040"));n.SetSelect(!n._isselect,2)}
this.RefreshLeftLayout()}},Leftitem_OnClickHandler:function(e,t){parseInt(t[0]);var a=parseInt(t[1]),n=this._leftitemlist[a];this._treaSelectCells[a].uuid="0",this.GetItemForUid(this._rightitemlist,n._uuid).SetSelect(!1,2),n.SetEmptyItem(),this.RefreshLeftLayout()},UpLv_OnClickHandler:function(){c.playBtnOpenEffect();for(var e=[],t=Object.keys(this._treaSelectCells),a=0;a<t.length;++a)"0"!=this._treaSelectCells[t[a]].uuid&&e.push(this._treaSelectCells[t[a]].uuid);if(e.length<=0)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),h.t("detail_057"));else{var n=DonotDestroyManager.GameData.TreasureLevels.levels[this._equipcfg.quality-1].length-1;this._equipbuffer.enhance_level>=n?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),h.t("detail_056")):MyPersistDataManager._playerData.gameMoney<this._costCoin?MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),h.t("129")):s.send_C2STreasureEnhance(DonotDestroyManager._gameSocket,this._equipbuffer.uuid,e)}},GetEmptyItemCnt:function(){for(var e=0,t=0;t<this._leftitemlist.length;++t)
this._leftitemlist[t]._isEmpty&&++e;return e},Additem_OnClickHandler:function(e){c.playBtnOpenEffect();var t=DonotDestroyManager.GameData.TreasureLevels.levels[this._equipcfg.quality-1].length-1;if(this._equipbuffer.enhance_level>=t)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),h.t("detail_056"));else{if(null==this._iteminfolist||this._iteminfolist.length<=0)
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),h.t("detail_042"));else{var a=this.GetEmptyItemCnt();if(!(a<=0)){var n=!1;d.hasPageGuide("TreasureStrengthen")&&(n=!0);var i=[],r=a;n&&(r=1);for(var s=0;s<this._rightitemlist.length&&(this._rightitemlist[s]._isEmpty||((!n&&!this._rightitemlist[s]._isselect||n&&(3098==this._rightitemlist[s]._itemId||3198==this._rightitemlist[s]._itemId))&&(i.push([this._rightitemlist[s]._uuid,this._rightitemlist[s]._itemType]),r-=1,this._rightitemlist[s].SetSelect(!0,2)),!(r<=0)));++s);if(!(null==i||i.length<=0)){var o=0;for(s=0;s<this._leftitemlist.length;++s)
if(this._leftitemlist[s]._isEmpty){if(o>=i.length)
break;this.RefreshLeftItemInfo(i[o][0],i[o][1],!0),o++}
this.RefreshLeftLayout()}}}}},Mask_OnClickHandler:function(e){MyUiManager.Back(),c.playBtnCloseEffect(),null!=this._cb&&this._cb(this._equipbuffer.uuid)},start:function(){this.showGuide()},showGuide:function(){var t=this;d.showGuide("TreasureStrengthen",function(e){return 1==e?t.btnOneKeyAdd:2==e?t.btnStrength:void 0},function(){t.showGuide()})},onDestroy:function(){r.removeListener(o.S2CTreasureEnhance,this.S2CTreasureEnhance_cb_func)}}),cc._RF.pop()},{ColorUtil:"ColorUtil",EquipBufferMgr:"EquipBufferMgr",GuideBufferMgr:"GuideBufferMgr",ItemBufferMgr:"ItemBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",PropHintsEffect:"PropHintsEffect",SoundUtil:"SoundUtil",TreasureBufferMgr:"TreasureBufferMgr",TreasureLevelsMgr:"TreasureLevelsMgr",i18n:"i18n"}],TreasuresCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"11ddcLVj5pNOaK/1Jy7i8y9","TreasuresCfgMgr"),t.exports={getTreasureById:function(e){return DonotDestroyManager.GameData.Treasures[e]}},cc._RF.pop()},{}],TuJianPanel:[function(e,t,a){"use strict";cc._RF.push(t,"2ed74cPZvNBj4KXAHtkmXZH","TuJianPanel");var n=e("SoundUtil"),i=e("MyUIEvent"),r=e("MyEventDispatcher");cc.Class({extends:cc.Component,properties:{pre_hero_box:cc.Prefab,node_hero_parent:cc.Node,mScrollView:cc.ScrollView,_params:null},onLoad:function(){this.onJumpHeroShow_cb_func=this.onJumpHeroShow_cb.bind(this),r.addListener(i.onJumpHeroShow,this.onJumpHeroShow_cb_func)},onDestroy:function(){r.removeListener(i.onJumpHeroShow,this.onJumpHeroShow_cb_func),this._params=null},onJumpHeroShow_cb:function(){var e=this.mScrollView.getScrollOffset();null!=this._params&&this._params instanceof Object&&(this._params.scrollOffset=e)},start:function(){for(var e=DonotDestroyManager.GameData.Common.tujian_cards,t=0;t<e.length;t++){var a=e[t],n=cc.instantiate(this.pre_hero_box);n.parent=this.node_hero_parent,n.getComponent("HeroBoxSimple").ChangeHeroInfo(a)}
null!=this._params.scrollOffset&&this.node.runAction(cc.sequence(cc.delayTime(.02),cc.callFunc(function(){this.mScrollView.scrollToOffset(this._params.scrollOffset)},this)))},goBack:function(){n.playBtnCloseEffect(),MyUiManager.Back(),null!=this.closeCb&&this.closeCb()},setParams:function(e){this._params=e}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil"}],UIWarp:[function(e,t,a){"use strict";cc._RF.push(t,"14a42/WqjdJI7/CG6GzIU5x","UIWarp");var s=e("GameUtils");cc.Class({extends:cc.Component,properties:{scrollview:cc.ScrollView,warpItem:cc.Prefab,maxItemNum:0,itemComponent:"",scrollBar:cc.Node,AutoHide:!1,_itemList:[],_maxLength:0,_currentIndex:cc.v2(0,0),_rangeOfIndex:cc.v2(0,0),_doNotUpdateScrollBar:!1},onLoad:function(){cc.log("warp"),this.scrollview.node.on("touchstart",this._startScroll,this),this.scrollview.node.on("touch-up",this._scrollEnded,this),this.node.on("position-changed",this._updateScrollBar,this);var e=this.node.getComponent(cc.Layout);switch(e.type){case cc.Layout.Type.HORIZONTAL:case cc.Layout.Type.VERTICAL:this.scrollview.node.on("scrolling",this.scrollevent,this)}},_startScroll:function(){this.scrollBar&&(this.scrollBar.stopAllActions(),this.scrollBar.opacity=255)},_updateScrollBar:function(){if(this.scrollBar&&this._itemList[0]){this.scrollBar.children[0];if(this.scrollBar.stopAllActions(),!this._doNotUpdateScrollBar){var e=this.node.getComponent(cc.Layout);switch(e.type){case cc.Layout.Type.HORIZONTAL:var t=this.node.x-this.node.anchorX*this.node.width;t-=this._currentIndex.x*(e.spacingX+this._itemList[0].width);var a=0-this.node.parent.anchorX*this.node.parent.width,n=Math.max((a-t)/this._maxLength,0),i=(this._maxLength-this.node.parent.width)/this._maxLength;n=Math.min(n,i);var r=Math.min(this.node.parent.width/this._maxLength,1);this._setScrollbar(n,r);break;case cc.Layout.Type.VERTICAL:var s=this.node.y+(1-this.node.anchorY)*this.node.height;s+=this._currentIndex.x*(e.spacingY+this._itemList[0].height);var o=(1-this.node.parent.anchorY)*this.node.parent.height;n=Math.max((s-o)/this._maxLength,0),i=(this._maxLength-this.node.parent.height)/this._maxLength;n=Math.min(n,i);r=Math.min(this.node.parent.height/this._maxLength,1);this._setScrollbar(n,r)}}}},_scrollEnded:function(){this.AutoHide&&this._setScrollbarFadeOut()},_setScrollbarFadeOut:function(){if(this.scrollBar){this.scrollBar.stopAllActions();var e=cc.fadeOut(1);this.scrollBar.runAction(e)}},_setScrollbar:function(e,t){if(this.scrollBar){var a=this.scrollBar.children[0];switch(this.node.getComponent(cc.Layout).type){case cc.Layout.Type.HORIZONTAL:null!=t&&(a.width=t*this.scrollBar.width),null!=e&&(a.x=e*this.scrollBar.width-this.scrollBar.anchorX*this.scrollBar.width+a.anchorX*a.width);break;case cc.Layout.Type.VERTICAL:null!=t&&(a.height=t*this.scrollBar.height),null!=e&&(a.y=0-e*this.scrollBar.height+(1-this.scrollBar.anchorY)*this.scrollBar.height-(1-a.anchorY)*a.height)}}},initContent:function(e){s.destroyAllChildren(this.node);for(var t=e>this.maxItemNum?this.maxItemNum:e,a=0;a<t;a++){var n=cc.instantiate(this.warpItem);this.node.addChild(n),n.setLocalZOrder(a),n.getComponent(this.itemComponent).index=a,n.getComponent(this.itemComponent).changeData()}
this._headIndex=0,this._endIndex=t-1;var i=this.node.getComponent(cc.Layout);switch(i.type){case cc.Layout.Type.HORIZONTAL:this.scrollview.scrollToLeft();var r=0;if(null==this.node.children[0])
break;r=this.node.children[0].width,this._maxLength=i.paddingLeft+i.paddingRight+r*e+i.spacingX*(e-1);break;case cc.Layout.Type.VERTICAL:this.scrollview.scrollToTop();r=0;if(null==this.node.children[0])
break;r=this.node.children[0].height,this._maxLength=i.paddingTop+i.paddingBottom+r*e+i.spacingY*(e-1)}
if(0==e)
return this._currentIndex=cc.v2(0,0),this._rangeOfIndex=cc.v2(0,0),void this._setScrollbar(0,1);this._itemList=this.node.children,this._currentIndex=cc.v2(0,this.maxItemNum-1),this._rangeOfIndex=cc.v2(0,e-1),e<this.maxItemNum?this._setScrollbar(0,1):(this._updateScrollBar(),this._setScrollbar(0)),this._minx=this.scrollview.content.getPositionX()-100,this._maxx=50+this.scrollview.content.getPositionX(),this._minY=this.scrollview.content.getPositionY(),this._maxY=this.scrollview.content.height-this._minY},_updateIndex:function(){var e=this._getMinZorder().getLocalZOrder(),t=this._getMaxZorder().getLocalZOrder();this._currentIndex=cc.v2(e,t)},s2t:function(e){this._currentIndex.x<=this._rangeOfIndex.x||this.MoveNegative()},s2b:function(e){this._currentIndex.y>=this._rangeOfIndex.y||this.MovePositive()},scrollevent:function(e){switch(this.node.getComponent(cc.Layout).type){case cc.Layout.Type.HORIZONTAL:if(this.scrollview.content.getPositionX()<this._minx-20){if(this._currentIndex.y>=this._rangeOfIndex.y)
return;this.MovePositive()}else if(this.scrollview.content.getPositionX()>this._maxx+20){if(this._currentIndex.x<=this._rangeOfIndex.x)
return;this.MoveNegative()}
break;case cc.Layout.Type.VERTICAL:if(this.scrollview.content.getPositionY()<this._minY-20){if(this._currentIndex.x<=this._rangeOfIndex.x)
return;this.MoveNegative()}else if(this.scrollview.content.getPositionY()>this._maxY+20){if(this._currentIndex.y>=this._rangeOfIndex.y)
return;this.MovePositive()}
break;default:if(this.scrollview.content.getPositionX()<this._minx-20){if(this._currentIndex.x<=this._rangeOfIndex.x)
return;this.MoveNegative()}else if(this.scrollview.content.getPositionX()>this._maxx+20){if(this._currentIndex.y>=this._rangeOfIndex.y)
return;this.MovePositive()}}},MovePositive:function(){this._doNotUpdateScrollBar=!0;var e=this._getMinZorder();e.setLocalZOrder(e.getLocalZOrder()+this.maxItemNum);var t=e.getComponent(this.itemComponent);t.index=t.node.getLocalZOrder(),t.changeData(),this._moveOffset(1),this._updateIndex(),this._doNotUpdateScrollBar=!1},MoveNegative:function(){this._doNotUpdateScrollBar=!0;var e=this._getMaxZorder();e.setLocalZOrder(e.getLocalZOrder()-this.maxItemNum);var t=e.getComponent(this.itemComponent);t.index=t.node.getLocalZOrder(),t.changeData(),this._moveOffset(-1),this._updateIndex(),this._doNotUpdateScrollBar=!1},_getMinZorder:function(){for(var e=this.node.children,t=null,a=0;a<e.length;a++){var n=e[a];(null==t||n.getLocalZOrder()<t.getLocalZOrder())&&(t=n)}
return t},_getMaxZorder:function(){for(var e=this.node.children,t=null,a=0;a<e.length;a++){var n=e[a];(null==t||n.getLocalZOrder()>t.getLocalZOrder())&&(t=n)}
return t},_moveOffset:function(e){var t=this.node.getComponent(cc.Layout),a=0;switch(t.type){case cc.Layout.Type.HORIZONTAL:a=t.spacingX+this._itemList[0].width,this.node.x+=e*a;break;case cc.Layout.Type.VERTICAL:a=t.spacingY+this._itemList[0].height,this.node.y-=e*a}}}),cc._RF.pop()},{GameUtils:"GameUtils"}],UiAudioConfig:[function(e,t,a){"use strict";cc._RF.push(t,"28bacCNbUZKoY6n1LwdDuUj","UiAudioConfig");for(var n=[{id:0,name:"Btn_Back",url:"sound/UI_qh.mp3"},{id:1,name:"Btn_Click",url:"sound/UI_ankq.mp3"},{id:2,name:"UI_GetReward",url:"sound/UI_hdwp.mp3"}],i=new Map,r=0;r<n.length;r++){var s=n[r];i.set(s.name,s)}
t.exports={list:n,map:i},cc._RF.pop()},{}],UiControllBack:[function(e,t,a){"use strict";cc._RF.push(t,"fcb1ccLRHRB7oycoTohdjbm","UiControllBack");var n=e("SoundUtil");e("ColorUtil");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},goBack:function(){n.playBtnCloseEffect(),MyUiManager.Back()},onDestroy:function(){},update:function(e){}}),cc._RF.pop()},{ColorUtil:"ColorUtil",SoundUtil:"SoundUtil"}],UiManager:[function(s,e,t){"use strict";cc._RF.push(e,"42528OhgTRFXL6WY3srAbpo","UiManager");var a=s("GameUtils"),r=(s("MarqueeBufferMgr"),s("MyEventDispatcher")),o=s("MyUIEvent");cc.Class({extends:cc.Component,properties:{OpenList:[],BackList:[],_Twopanelmap:{default:Object,visible:!1},currentSceneName:{default:cc.String,visible:!1},currentpaneltype:{default:null,visible:!1},_curTwopaneltype:-1,PanelInfo:{default:null,type:Object}},onLoad:function(){this.PanelInfo={None:{url:"None",scriptname:"None",type:0,lvtype:1},StageSelectPanel:{url:"Prefab/StageMapPanel/StageSelectPanel",scriptname:"StageSelectPanel",type:1,lvtype:1},PvePanel:{url:"",scriptname:"",type:2,lvtype:1},ArmyPanel:{url:"Prefab/ArmyPanel/ArmyPanel",scriptname:"ArmyPanel",type:3,lvtype:1},HeroDetailsPanel:{url:"Prefab/HeroDetailsPanel/HeroDetailsPanel",scriptname:"HeroDetailsPanel",type:4,lvtype:1},SelectHeroPanel:{url:"",scriptname:"",type:5,lvtype:1},SearchingPanel:{url:"",scriptname:"",type:6,lvtype:1},BattleInfoPage:{url:"",scriptname:"",type:7,lvtype:1},SearchFriendPanel:{url:"",scriptname:"",type:8,lvtype:1},LoginNamePwdPanel:{url:"Prefab/ui/login/login_name_pwd_input",scriptname:"",type:9,lvtype:1},ServerListPanel:{url:"Prefab/ui/login/select_server",scriptname:"ServerListPanel",type:10,lvtype:1},HeroAttributePanel:{url:"Prefab/HeroDetailsPanel/HeroAttributePanel",scriptname:"HeroAttributePanel",type:11,lvtype:1},RegisterCharacterPanel:{url:"Prefab/RegisterCharacterPanel/RegisterCharacterPanel",scriptname:"RegisterCharacterPanel",type:12,lvtype:1},StoreHousePanel:{url:"Prefab/StoreHousePanel/StoreHousePanel",scriptname:"StoreHousePanel",type:13,lvtype:1},GmPanel:{url:"Prefab/GmPanel/GmPanel",scriptname:"",type:14,lvtype:1},StrengthenInfo:{url:"Prefab/StoreHousePanel/StrengthenInfo",scriptname:"StrengthenInfo",type:15,lvtype:1},StageMapPanel:{url:"Prefab/StageMapPanel/StageMapPanel",scriptname:"StageMapPanel",type:16,lvtype:1},BattleFormationPanel:{url:"Prefab/BattleFormationPanel/BattleFormationPanel",scriptname:"BattleFormationPanel",type:17,lvtype:1},TeamSkillPanel:{url:"Prefab/TeamSkillPanel/TeamSkillPanel",scriptname:"TeamSkillPanel",type:18,lvtype:1},VipPayMgn:{url:"Prefab/VipPay/VipPayPanel",scriptname:"VipPayMgn",type:19,lvtype:1},FirstPayPanel:{url:"Prefab/FirstPay/FirstPay",scriptname:"FirstPayMgn",type:20,lvtype:1},SignInLayer:{url:"Prefab/SignInLayer/SignInLayer",scriptname:"SignInLayer",type:21,lvtype:1},ShopMallLayer:{url:"Prefab/ShopMallLayer/ShopMallLayer",scriptname:"ShopMallLayer",type:22,lvtype:1},StageEliteSelectPanel:{url:"Prefab/StageMapPanel/StageEliteSelectPanel",scriptname:"StageEliteSelectPanel",type:23,lvtype:1},StageFallPanel:{url:"Prefab/StageMapPanel/StageFallPanel",scriptname:"StageFallPanel",type:24,lvtype:2},ArmyEquipDialog:{url:"Prefab/HeroDetailsPanel/ArmyEquipDialog",scriptname:"ArmyEquipDialog",type:25,lvtype:2},MissionLayer:{url:"Prefab/MissionLayer/MissionLayer",scriptname:"MissionLayer",type:26,lvtype:1},MailPanel:{url:"Prefab/MailPanel/MailPanel",scriptname:"MailPanelManager",type:27,lvtype:1},RecruitPanel:{url:"Prefab/RecruitPanel/RecruitPanel",scriptname:"RecruitAnimCtrl",type:28,lvtype:1},ArmyUplevelDialog:{url:"Prefab/HeroDetailsPanel/ArmyUplevelDialog",scriptname:"ArmyUplevelDialog",type:29,lvtype:2},DayActivityLayer:{url:"Prefab/DayActivityLayer/DayActivityLayer",scriptname:"DayActivityLayer",type:30,lvtype:1},HeroLvUpLayer:{url:"Prefab/HeroDetailsPanel/HeroLvUpLayer",scriptname:"HeroLvUpLayer",type:31,lvtype:2},BuyGameMoney:{url:"Prefab/HeadTabPanel/BuyGameMoney",scriptname:"BuyGameMoney",type:32,lvtype:2},BuyEnergy:{url:"Prefab/HeadTabPanel/BuyEnergy",scriptname:"BuyEnergy",type:33,lvtype:2},ArmyUpgradeDialog:{url:"Prefab/HeroDetailsPanel/ArmyUpgradeDialog",scriptname:"ArmyUpgradeDialog",type:34,lvtype:2},SmelterMain:{url:"Prefab/SmelterMain/SmelterMain",scriptname:"SmelterMain",type:35,lvtype:1},HeroUpgradeDialog:{url:"Prefab/HeroDetailsPanel/HeroUpgradeDialog",scriptname:"HeroUpgradeDialog",type:36,lvtype:2},GameStoryLayer:{url:"Prefab/gamestory/GameStoryLayer",scriptname:"GameStoryLayer",type:37,lvtype:1},EquipStrengthLayer:{url:"Prefab/StoreHousePanel/EquipStrengthLayer",scriptname:"EquipStrengthLayer",type:38,lvtype:2},TreasureStrengthen:{url:"Prefab/Treasure/TreasureStrengthen",scriptname:"TreasureStrengthen",type:39,lvtype:2},TreaRefineLayer:{url:"Prefab/Treasure/TreaRefineLayer",scriptname:"TreaRefineLayer",type:40,lvtype:2},BlackShop:{url:"Prefab/BlackShop/BlackShop",scriptname:"BlackShop",type:41,lvtype:1},EquipRefineLayer:{url:"Prefab/EquipRefineLayer/EquipRefineLayer",scriptname:"EquipRefineLayer",type:42,lvtype:2},EsRoot:{url:"Prefab/EsMain/EsRoot",scriptname:"EsRoot",type:43,lvtype:1},SweepLayer:{url:"Prefab/StageMapPanel/SweepLayer",scriptname:"SweepLayer",type:44,lvtype:2},UnlockFuncLayer:{url:"Prefab/UnlockFuncLayer/UnlockFuncLayer",scriptname:"UnlockFuncLayer",type:45,lvtype:2},FightThroughLayer:{url:"Prefab/FightThroughLayer/FightThroughLayer",scriptname:"FightThroughLayer",type:46,lvtype:1},ActivityLayer:{url:"Prefab/ActivityLayer/ActivityLayer",scriptname:"ActivityLayer",type:47,lvtype:1},EpicBattleLayer:{url:"Prefab/WeekBattleLayer/EpicBattleLayer",scriptname:"EpicBattleLayer",type:48,lvtype:1},AreanMainLayer:{url:"Prefab/AreanMainLayer/AreanMainLayer",scriptname:"AreanMainLayer",type:49,lvtype:1},WeeklyBattleLayer:{url:"Prefab/WeekBattleLayer/WeeklyBattleLayer",scriptname:"WeeklyBattleLayer",type:50,lvtype:1},SnatchMainLayer:{url:"Prefab/SnatchMainLayer/SnatchMainLayer",scriptname:"SnatchMainLayer",type:51,lvtype:1},SelectMissionLayer:{url:"Prefab/WeekBattleLayer/SelectMissionLayer",scriptname:"SelectMissionLayer",type:52,lvtype:1},SnatchListLayer:{url:"Prefab/SnatchMainLayer/SnatchListLayer",scriptname:"SnatchListLayer",type:53,lvtype:2},TestActivityLayer:{url:"Prefab/TestActivityLayer/TestActivityLayer",scriptname:"TestActivityLayer",type:54,lvtype:1},SystemSettingLayer:{url:"Prefab/UserDetailInfo/SystemSetting",scriptname:"SystemSettingLayer",type:55,lvtype:2},UserDetailInfoLayer:{url:"Prefab/UserDetailInfo/UserDetailInfo",scriptname:"UserDetailInfoManager",type:56,lvtype:2},StageStoryLayer:{url:"Prefab/StageMapPanel/StageStoryLayer",scriptname:"StageStoryLayer",type:57,lvtype:2},RankLayer:{url:"Prefab/RankLayer/RankLayer",scriptname:"RankLayer",type:58,lvtype:1},WanbaFuliLayer:{url:"Prefab/UserDetailInfo/WanbaFuliWidget",scriptname:"WanbaFuliWidget",type:59,lvtype:2},WanbaLibaoGetLayer:{url:"Prefab/UserDetailInfo/WanbaLiBaoGetWidget",scriptname:"WanbaLibaoGetWidget",type:60,lvtype:2},ChangeNameLayer:{url:"Prefab/UserDetailInfo/ChangeNameLayer",scriptname:"ChangeNameLayer",type:61,lvtype:2},ChangeIconLayer:{url:"Prefab/UserDetailInfo/ChangeIconLayer",scriptname:"ChangeIconLayer",type:62,lvtype:2},ChangeHeadFrameLayer:{url:"Prefab/UserDetailInfo/ChangeHeadFrameLayer",scriptname:"ChangeHeadFrameLayer",type:63,lvtype:2},HeroRuneLayer:{url:"Prefab/HeroDetailsPanel/RunePanel",scriptname:"HeroRuneLayer",type:64,lvtype:1},RuneHelpLayer:{url:"Prefab/HeroDetailsPanel/RuneHelpPanel",scriptname:null,type:65,lvtype:2},RuneUnlockPanel:{url:"Prefab/HeroDetailsPanel/RuneUnlockPanel",scriptname:"RuneUnlockWidget",type:66,lvtype:2},RuneBackPanel:{url:"Prefab/HeroDetailsPanel/RuneBackPanel",scriptname:"RuneBackPanel",type:67,lvtype:2},RuneOilBuyPanel:{url:"Prefab/EsMain/RuneOilBuyPanel",scriptname:"RuneOilBuyPanel",type:68,lvtype:2},RuneLevelupPanel:{url:"Prefab/HeroDetailsPanel/RuneLevelupPanel",scriptname:"RuneLevelupLayer",type:69,lvtype:2},MineMainPanel:{url:"Prefab/MinePanel/MineMainPanel",scriptname:"MineMainPanel",type:70,lvtype:1},MinePointDetail:{url:"Prefab/MinePanel/MinePointDetail",scriptname:"MinePointDetail",type:71,lvtype:2},MineHistoryRecrod:{url:"Prefab/MinePanel/MineHistoryRecrod",scriptname:"MineHistoryRecrod",type:72,lvtype:2},DailySharePanel:{url:"Prefab/MainHome/ShareRewardPanel",scriptname:"DailySharePanel",type:73,lvtype:2},SecretMainPanel:{url:"Prefab/Secret/SecretMainPanel",scriptname:"SecretMainPanel",type:74,lvtype:1},SecretHelpPanel:{url:"Prefab/Secret/SecretHelpPanel",scriptname:null,type:75,lvtype:2},SecretPointPanel:{url:"Prefab/Secret/SecretPointPanel",scriptname:"SecretPointPanel",type:76,lvtype:2},SecretRewardPanel:{url:"Prefab/Secret/SecretRewardPanel",scriptname:"SecretRewardPanel",type:77,lvtype:2},HeroShowPanel:{url:"Prefab/RecruitPanel/HeroShowPanel",scriptname:"HeroShowPanel",type:78,lvtype:1},BossMainPanel:{url:"Prefab/Boss/BossMainPanel",scriptname:"BossMainPanel",type:79,lvtype:1},BossRewardPanel:{url:"Prefab/Boss/BossRewardPanel",scriptname:"BossRewardPanel",type:80,lvtype:2},GuoZhanMainPanel:{url:"Prefab/GuoZhan/GuoZhanMainPanel",scriptname:"GuoZhanMainPanel",type:81,lvtype:1},TuJianPanel:{url:"Prefab/TuJian/TuJianPanel",scriptname:"TuJianPanel",type:82,lvtype:2},CreateRolePanel:{url:"Prefab/RegisterCharacterPanel/CreateRolePanel",scriptname:"CreateRolePanel",type:83,lvtype:1},QedjFuliPanel:{url:"Prefab/UserDetailInfo/QieDjWidget",scriptname:"QieDjWidget",type:84,lvtype:2},GuoZhanChangeNation:{url:"Prefab/GuoZhan/GuoZhanChangeNation",scriptname:"GuoZhanChangeNation",type:85,lvtype:2},GuoZhanOffice:{url:"Prefab/GuoZhan/GuoZhanOffice",scriptname:"GuoZhanOffice",type:86,lvtype:2},CommonHelpPanel:{url:"Prefab/GuoZhan/CommonHelpPanel",scriptname:"CommonHelpPanel",type:87,lvtype:2},GuoZhanFightPanel:{url:"Prefab/GuoZhan/GuoZhanFightPanel",scriptname:"GuoZhanFightPanel",type:88,lvtype:1},GuoZhanCityPanel:{url:"Prefab/GuoZhan/GuoZhanCityPanel",scriptname:"GuoZhanCityPanel",type:89,lvtype:1},HeroAddonWidget:{url:"Prefab/RecruitPanel/HeroAddonWidget",scriptname:"HeroAddonWidget",type:90,lvtype:2},ActivityQiZhenYiBaoPanel:{url:"Prefab/UserDetailInfo/ActivityQiZhenYiBaoPanel",scriptname:"ActivityQiZhenYiBaoPanel",type:91,lvtype:2}}},Create:function(e,n){cc.loader.loadRes(e,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),e)
cc.error(e.message||e);else{var a=cc.instantiate(t);n.addChild(a)}})},OpenFloatTipPanel:function(e,t,a){var n=cc.instantiate(DonotDestroyManager.FloattipPanel);cc.Canvas.instance.node.addChild(n),n.setPosition(e),null!=a&&n.setLocalZOrder(a),n.getComponent("FloatTipPanel").SetInfo(t)},OpenTextTipsWidget:function(i,r){cc.loader.loadRes("Prefab/ui/common/TextTip",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);a.name="TextTip",cc.Canvas.instance.node.addChild(a);var n=cc.Canvas.instance.node.convertToNodeSpaceAR(i);a.setPosition(n),a.getChildByName("describe").getComponent(cc.Label).string=r})},CloseTextTipsWidget:function(){var e=cc.Canvas.instance.node.getChildByName("TextTip");null!=e&&(e.destroy(),e=null)},OpenRuneTipsWidget:function(i,r,s){var e=cc.Canvas.instance.node.getChildByName("RuneTips");if(null!=e){var t=cc.Canvas.instance.node.convertToNodeSpaceAR(i);e.setPosition(t),e.getComponent("NameDescTipWidget").SetInfo(r,s)}else
cc.loader.loadRes("Prefab/ui/common/RuneTips",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);a.name="RuneTips",cc.Canvas.instance.node.addChild(a);var n=cc.Canvas.instance.node.convertToNodeSpaceAR(i);a.setPosition(n),a.getComponent("NameDescTipWidget").SetInfo(r,s)})},CloseRuneTipsWidget:function(){var e=cc.Canvas.instance.node.getChildByName("RuneTips");null!=e&&(e.destroy(),e=null)},OpenSmallTipsWidget:function(n,i){cc.loader.loadRes("Prefab/ui/common/smallTips",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.getComponent("SmallTipsWidget").SetInfo(n,i)})},OpenFightChangeTipsWidget:function(n,i){cc.loader.loadRes("Prefab/ui/common/FightChangeTips",cc.Prefab,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a,1e3),a.getComponent("FightChangeTips").setParams(n,i)})},Open:function(a,n){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(this.currentpaneltype!=a.type){var i=this;if(1==a.lvtype&&(this.currentpaneltype=a.type),null==e){if(!cc.sys.isNative)
if(null==cc.Canvas.instance.node.getChildByName("ShortLoadingLayer")){var t=cc.instantiate(DonotDestroyManager.ShortLoadingLayer);t.name="ShortLoadingLayer",t.getComponent("ShortLoadingMask").setText("133"),cc.Canvas.instance.node.addChild(t)}
cc.loader.loadRes(a.url,function(e,t){if(cc.loader.setAutoReleaseRecursively(t,!0),e)
return cc.error(e.message||e),void r.dispatchEvent(o.onUiInstancePrefab,!1);i.instancePrefab(t,n,a),r.dispatchEvent(o.onUiInstancePrefab,!0)})}else
i.instancePrefab(e,n,a),r.dispatchEvent(o.onUiInstancePrefab,!0)}},instancePrefab:function(e,t,a){var n=new c;1==a.lvtype?(this._curTwopaneltype=0,this.RemoveAllOpen(e),this.AddBack(t,a)):(n.m_pparams=t,0<=this.currentpaneltype&&(null==this._Twopanelmap[this.currentpaneltype]&&(this._Twopanelmap[this.currentpaneltype]=new Array),this._Twopanelmap[this.currentpaneltype].push(n)),this._curTwopaneltype=a.type),cc.log(a.scriptname);var i=cc.instantiate(e);(cc.Canvas.instance.node.addChild(i),i.setPosition(cc.p(0,0)),null!=a.scriptname&&0<a.scriptname.length)&&i.getComponent(a.scriptname).setParams(t);n.m_pitem=i,n.m_prefab=e,n.m_pPanelInfo=a,this.OpenList.push(n);var r=cc.Canvas.instance.node.getChildByName("ShortLoadingLayer");null!=r&&(r.getComponent("ShortLoadingMask").finishCb(),r.destroy(),r=null)},Remove:function(e){!(1<arguments.length&&void 0!==arguments[1])||arguments[1];for(var t=0;t<this.OpenList.length;++t)
if(this.OpenList[t].m_pPanelInfo.type==e){var a=this.OpenList[t];this.currentpaneltype==e&&(this.currentpaneltype=0),this.OpenList.splice(t,1),a.m_pitem.destroy(),a.m_pitem=null}},GetItem:function(e){for(var t=0;t<this.OpenList.length;++t)
if(this.OpenList[t].m_pPanelInfo.type==e)
return this.OpenList[t];return null},Getdic:function(e){for(var t=0;t<this.BackList.length;++t)
if(this.BackList[t].m_pPanelInfo.type==e)
return this.BackList[t];return null},RemoveAllOpen:function(e){for(;0<this.OpenList.length;){var t=this.OpenList.pop();null!=t.m_pitem&&(t.m_pitem.destroy(),t.m_pitem=null)}},ClearOpenList:function(){for(;0<this.OpenList.length;){var e=this.OpenList.pop();e.m_pitem=null,e.m_prefab=null}},RemoveTowPanel:function(){for(var e=Object.keys(this._Twopanelmap),t=0;t<e.length;++t)
for(;0<this._Twopanelmap[e[t]].length;){var a=this._Twopanelmap[e[t]].pop();null!=a&&null!=a.m_pitem&&a.m_pitem.destroy()}},AddBack:function(e,t){var a=new c;a.m_pscenename=this.currentSceneName,a.m_pparams=e,a.m_pPanelInfo=t,a.m_prefab=null,this.BackList.push(a)},RemoveTwoFramePanel:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=0;a<this._Twopanelmap[this.currentpaneltype].length;++a)
if(e==this._Twopanelmap[this.currentpaneltype][a].m_pPanelInfo.type){if(t){var n=this._Twopanelmap[this.currentpaneltype][a];null!=n.m_pitem&&(n.m_pitem.destroy(),n.m_pitem=null)}
this._Twopanelmap[this.currentpaneltype].splice(a,1)}
var i=-1;for(a=0;a<this.OpenList.length;++a)
if(this.OpenList[a].m_pPanelInfo.type==e){i=a;break}
-1!=i&&this.OpenList.splice(i,1)},Back:function(){if(0<this._curTwopaneltype){if(this.RemoveTwoFramePanel(this._curTwopaneltype,!0),null!=(n=this._Twopanelmap[this.currentpaneltype])&&0<n.length){if(null!=this.GetItem(n[n.length-1].m_pPanelInfo.type))
return void(this._curTwopaneltype=n[n.length-1].m_pPanelInfo.type);if((t=n.pop()).m_pPanelInfo.type!=this._curTwopaneltype)
return void this.Open(t.m_pPanelInfo,t.m_pparams)}
this._curTwopaneltype=0}else if(this.RemoveBackList(this.currentpaneltype),this.BackList.length<=0||this.BackList[this.BackList.length-1].m_pscenename!=this.currentSceneName){if(this.Remove(this.currentpaneltype),this.currentpaneltype=0,this._curTwopaneltype=0,null!=(n=this._Twopanelmap[0])&&0<n.length){var e=[],t=n.pop();e.push(t),this.LoadPrefab(e)}"mainhome"==this.currentSceneName&&this.node.runAction(cc.sequence(cc.delayTime(.4),cc.callFunc(function(){var e=s("MainHomeManager");null==e.getInstance()?s("MainHomeSceneManager").getInstance().instanceSceneNode():e.getInstance().node.activeInHierarchy||e.getInstance().BlackMaskFadeOut()})))}else{var a=this.BackList.pop();if(cc.log(" kịch bản gốc tên ===》"+a.m_pPanelInfo.scriptname+" chiều dài ===》"+this.BackList.length.toString()),a.m_pscenename==this.currentSceneName){var n;if((e=[]).push(a),null!=(n=this._Twopanelmap[a.m_pPanelInfo.type])&&0<n.length){t=n.pop();e.push(t)}
this.LoadPrefab(e)}else
this.BackList.push(a)}},backAll:function(){for(;0<this._curTwopaneltype;){this.RemoveTwoFramePanel(this._curTwopaneltype,!0);var e=this._Twopanelmap[this.currentpaneltype];if(null!=e&&0<e.length)
if(null!=this.GetItem(e[e.length-1].m_pPanelInfo.type)){this._curTwopaneltype=e[e.length-1].m_pPanelInfo.type;continue}
this._curTwopaneltype=0}
for(this.clearBackList();0<this.OpenList.length;){var t=this.OpenList.pop();null!=t.m_pitem&&(t.m_pitem.destroy(),t.m_pitem=null)}
this.currentpaneltype=0,this._curTwopaneltype=0,"mainhome"==this.currentSceneName&&a.back2Hall()},isAllClosed:function(){return!(null!=this.BackList&&0!=this.BackList.length||null!=this.OpenList&&0!=this.OpenList.length)},LoadPrefab:function(i){if(!cc.sys.isNative&&null==cc.Canvas.instance.node.getChildByName("ShortLoadingLayer")){var e=cc.instantiate(DonotDestroyManager.ShortLoadingLayer);e.name="ShortLoadingLayer",e.getComponent("ShortLoadingMask").setText("133"),cc.Canvas.instance.node.addChild(e)}
var t=s("ResLoaderManager"),r=this;this.toLoadResList=[];for(var a=0;a<i.length;++a)
this.toLoadResList.push([i[a].m_pPanelInfo.url,cc.Prefab]);var n=this._loadProgressCb.bind(this);t.asyncLoadAll(this.toLoadResList,n,function(e,t){for(var a=0;a<i.length;++a)
for(var n=0;n<t.length;++n)
i[a].m_pPanelInfo.url==t[n][0]&&r.Open(i[a].m_pPanelInfo,i[a].m_pparams,t[n][1])})},_loadProgressCb:function(e){},RemoveBackList:function(e){for(var t=this.BackList.length-1;0<=t;--t){this.BackList[t].m_pPanelInfo.type==e&&this.BackList.splice(t,1)}},clearBackList:function(){for(var e=0;e<this.BackList.length;e++)
delete this.BackList[e];this.BackList=[]},updateUiParams:function(e,t){for(var a=this.BackList.length-1;0<=a;--a){(r=this.BackList[a]).m_pPanelInfo.type==e&&(r.m_pparams=t)}
var n=Object.keys(this._Twopanelmap);for(a=0;a<n.length;++a)
if(0<this._Twopanelmap[n[a]].length)
for(var i=0;i<this._Twopanelmap[n[a]].length;++i){var r;if(e==this._Twopanelmap[n[a]][i].m_pPanelInfo.type)
(r=this._Twopanelmap[n[a]][i]).m_pparams=t}},getUiParams:function(e){for(var t=this.BackList.length-1;0<=t;--t){if((i=this.BackList[t]).m_pPanelInfo.type==e)
return i.m_pparams}
var a=Object.keys(this._Twopanelmap);for(t=0;t<a.length;++t)
if(0<this._Twopanelmap[a[t]].length)
for(var n=0;n<this._Twopanelmap[a[t]].length;++n){var i;if(e==this._Twopanelmap[a[t]][n].m_pPanelInfo.type)
return(i=this._Twopanelmap[a[t]][n]).m_pparams}},Remove2Panel:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=Object.keys(this._Twopanelmap),n=0;n<a.length;++n)
if(0<this._Twopanelmap[a[n]].length)
for(var i=0;i<this._Twopanelmap[a[n]].length;++i)
if(e==this._Twopanelmap[a[n]][i].m_pPanelInfo.type){if(t){var r=this._Twopanelmap[a[n]][i];null!=r.m_pitem&&(r.m_pitem.destroy(),r.m_pitem=null)}
this._Twopanelmap[a[n]].splice(i,1);break}
var s=-1;for(n=0;n<this.OpenList.length;++n)
if(this.OpenList[n].m_pPanelInfo.type==e){s=n;break}
-1!=s&&this.OpenList.splice(s,1)}});var c=cc.Class({m_pitem:null,m_pscenename:null,m_pparams:null,m_pPanelInfo:null});cc._RF.pop()},{GameUtils:"GameUtils",MainHomeManager:"MainHomeManager",MainHomeSceneManager:"MainHomeSceneManager",MarqueeBufferMgr:"MarqueeBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",ResLoaderManager:"ResLoaderManager"}],UnLockCfgMgr:[function(e,t,a){"use strict";cc._RF.push(t,"db3c9bDDNxI0JZw49pPt4tb","UnLockCfgMgr");var h=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=e("StagesConfigMgr"),_=e("StageBufferMgr"),i=e("GuideBufferMgr"),u=e("PlayerBufferMgr"),n=function(){this.UnLockFuncIds={snatch:6,arean:7,herostren:9,equipsmelter:16,teamskill:14,weekly:18,epic:19,trearefine:22}};n.prototype.getOpenLuckInfoByLevel=function(e){for(var t=[],a=DonotDestroyManager.GameData.UnLock,n=0;n<a.length;++n){var i=a[n];"object"==(void 0===i?"undefined":r(i))&&i.level==e&&(null!=i.stage?_.isStageIdPassed(i.stage)&&t.push(i.des):t.push(i.des))}
return 0==t.length?"Không có nội dung mở khóa":"Mở khóa "+t.join(",")},n.prototype.getFuncUnLockInfo=function(e){var t,a=[],n=!0,i=u.getUserLevel(),r=this.getUnLockData(e-1);if((t=i>=r.level)||a.push(cc.js.formatStr("Mở kháo khi Bang đạt lv%d",r.level)),r.stage&&!_.isStageIdPassed(r.stage)){var s=d.getStageUnLockInfo(r.stage),o=h(s,2),c=o[0],l=o[1];a.push(cc.js.formatStr("Vượt ải %s*Ải %d Mở",c,l)),n=!1}
return[t&&n,a.join(",")]},n.prototype.getLockIdsByGroup=function(e,t){for(var a=[],n=DonotDestroyManager.GameData.UnLock,i=0;i<n.length;++i)
if(null!=n[i]&&null!=n[i].stage){var r=d.getGroupIdByStage(n[i].stage);t&&r==e?(n[i].id=i,a.push(n[i])):e<=r&&(n[i].id=i,a.push(n[i]))}
return a.sort(function(e,t){return e.stage!=t.stage?e.stage-t.stage:e.level-t.level}),a},n.prototype.checkNewUnLockFunc=function(){for(var e=function(e){var t=DonotDestroyManager.GameData.Guide.guidelist[e-1][0],a=!0;null!=t.lv&&(a=MyPersistDataManager._playerData.level>=t.lv);var n=!0;return null!=t.stage&&(n=_.isStageIdPassed(t.stage)),a&&n},t=Object.keys(this.UnLockFuncIds),a=0;a<t.length;++a){var n=this.UnLockFuncIds[t[a]];if(!i.isStarted(n-1)&&e(n))
return MyUiManager.Open(MyUiManager.PanelInfo.UnlockFuncLayer,{lookid:t[a]}),!0}
return!1},n.prototype.getUnLockData=function(e){var t=DonotDestroyManager.GameData.UnLock;return t[e]||cc.log("no find unlockId;unlockId="+e),t[e]},n.prototype.isUnlockCallBack=function(e,t){this.isUnLock(e)?t&&t():MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,80),this.getUnLockDes(e))},n.prototype.unlockTipsCb=function(n,e){this.isUnLock(n)?e&&e():cc.loader.loadRes("Prefab/UnlockFuncLayer/UnlockTips",function(e,t){cc.loader.setAutoReleaseRecursively(t,!0);var a=cc.instantiate(t);cc.Canvas.instance.node.addChild(a),a.setPosition(0,0),a.getComponent("UnlockTips").ChangeData(n)})},n.prototype.getUnLockDes=function(e){var t=this.getUnLockData(e-1),a=[];if(1<t.level&&a.push("Cấp Bang đạt "+t.level+" cấp "),null!=t.stage){var n=d.getStageUnLockInfo(t.stage),i=h(n,2),r=i[0],s=i[1];a.push("Vượt ải "+r+"*Mở khóa ải "+s+"")}
for(var o="",c=0;c<a.length;++c)
c<a.length-1?o+=a[c]+",":o+=a[c]+"Mở khóa ";return o},n.prototype.isUnLock=function(e){var t=MyPersistDataManager._playerData.level,a=this.getUnLockData(e-1);if(a.level<=t){var n=a.stage;return null==n||_.isStageIdPassed(n)}
return!1},n.prototype.getFTUnLockLevel=function(){return DonotDestroyManager.GameData.UnLock[15].level},t.exports=new n,cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",PlayerBufferMgr:"PlayerBufferMgr",StageBufferMgr:"StageBufferMgr",StagesConfigMgr:"StagesConfigMgr"}],UnLockFuncItem:[function(e,t,a){"use strict";cc._RF.push(t,"401ebbLSftAjIlTrWSKQ3ey","UnLockFuncItem"),cc.Class({extends:cc.Component,properties:{m_pDes:cc.Label,m_pUnlockName:cc.Label,m_pIcon:cc.Sprite,m_pContent:cc.Node,m_pNoInfo:cc.Node,_lckinfo:null,_iconpre:null},onLoad:function(){},ChangeData:function(e){this._lckinfo=e,this.Init()},Init:function(){if(null==this._lckinfo)
return this.m_pContent.active=!1,void(this.m_pNoInfo.active=!0);this.m_pContent.active=!0,this.m_pNoInfo.active=!1,this.m_pDes.string=this._lckinfo.des2;var e=Math.floor(this._lckinfo.stage/100),t=DonotDestroyManager.GameData.Stages[e-1].name;this.m_pUnlockName.string="Vượt ải "+t+"*Mở khóa ải "+this._lckinfo.stage%100+"",this.LoadIcon(this._lckinfo.icon)},LoadIcon:function(e){var a=this;cc.loader.loadRes("UI/Unlock/"+e.replace(".png",""),cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),a.m_pIcon.spriteFrame=t,null!=a._iconpre&&(a._iconpre=null),a._iconpre=t})},onDestroy:function(){null!=this._iconpre&&(this._iconpre=null)}}),cc._RF.pop()},{}],UnLockViewInfo:[function(t,e,a){"use strict";cc._RF.push(e,"b5e66abQ65IDJssjJwEVeS1","UnLockViewInfo");var n=t("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pLevel:cc.RichText,m_pHerolab:cc.RichText,m_pHasSW:cc.RichText,m_pNeedSW:cc.Label,_exchange:null},onLoad:function(){},ChangeData:function(e){this._exchange=e,this.Init()},Init:function(){this.m_pLevel.string="Bang đã đạt lv <color=#ffff00>"+this._exchange[4]+"</c>,",this.m_pHerolab.string="Có thể dùng Điểm Danh Vọng đổi lấy <color=#ffff00>"+this._exchange[1]+"</c> vị trí Tướng",this.m_pNeedSW.string="Điểm Danh Vọng yêu cầu:            "+this._exchange[2],MyPersistDataManager._playerData.honor>=this._exchange[2]?this.m_pHasSW.string="Điểm Danh Vọng hiện tại:            <color=#00ff00>"+MyPersistDataManager._playerData.honor+"</c>":this.m_pHasSW.string="Điểm Danh Vọng hiện tại:            <color=#ff0000>"+MyPersistDataManager._playerData.honor+"</c>"},Mask_OnClickHandler:function(e){n.playBtnCloseEffect(),this.node.active=!1},BtnOk_OnClickHandler:function(e){t("SelectHeroPanel").getInstance().node.destroy(),MyUiManager.Open(MyUiManager.PanelInfo.ShopMallLayer,{state:2})},onDestroy:function(){}}),cc._RF.pop()},{SelectHeroPanel:"SelectHeroPanel",SoundUtil:"SoundUtil"}],UnitBufferMgr:[function(e,t,a){"use strict";cc._RF.push(t,"e98b8Gp+lZJZYKsg7mNIn5G","UnitBufferMgr");var f=e("EquipBufferMgr"),g=e("UnitConfigMgr"),n=function(){};n.getUnitPropAttr=function(e,t){var a=e.heroCfg.unit_type,n=e.unit_level,i=e.unitGrade;t=t||{maxhp_rate:0,atk_rate:0,def_rate:0};var r=g.find(a,i),s=r.ori_attrs.maxhp,o=r.ori_attrs.atk,c=r.ori_attrs.def;s+=(n-1)*r.add_attrs.maxhp,o+=(n-1)*r.add_attrs.atk,c+=(n-1)*r.add_attrs.def;for(var l=0;l<4;l++)
if("0"!=e.equips[l]){var h=f.getEquipByUid(e.equips[l]),d=h.unitAttr.id,_=h.unitAttr.num;3==h.unitAddState&&(1==d?o*=1+_/100+t.atk_rate/100:2==d?s*=1+_/100+t.maxhp_rate/100:3==d&&(c*=1+_/100+t.def_rate/100))}
if(e.unitEquips)
for(var u=DonotDestroyManager.GameData.Units.cost[a-1][i-1].upgrade_item,m=0;m<e.unitEquips.length;m++){if(0<e.unitEquips[m]){var p=DonotDestroyManager.GameData.UnitsEquips[u[m][0]];s+=p.attrs.maxhp||0,o+=p.attrs.atk||0,c+=p.attrs.def||0}}
return[Math.round(s),Math.round(o),Math.round(c)]},n.getArmyInfo=function(e){var t={},a=e.heroCfg.unit_type,n=DonotDestroyManager.GameData.Units.unit_types[a-1][e.unitGrade-1];t.heroId=e.template_id,t._type=a,t.grade=e.unitGrade,t.level=e.unit_level,t.equips=e.unitEquips,t.name=n.name;var i=DonotDestroyManager.GameData.Units.cost[a-1][n.grade-1];t.maxLv=i.max_level,t.icon=n.icon,t.quality=n.quality,t.gmUpLv=i.gamemoney,t.upLvId=i.levelup_item_id,t.tallyLv=i.levelup_item_num,t.gmUpGrade=i.upgrade_gamemoney,t.itemsUpgrade=i.upgrade_item,t.baseHp=n.ori_attrs.maxhp,t.baseAtk=n.ori_attrs.atk,t.baseDef=n.ori_attrs.def,t.addHp=n.add_attrs.maxhp,t.addAtk=n.add_attrs.atk,t.addDef=n.add_attrs.def,t.mvSpeed=n.mv_speed,t.des=n.des,t.des2=n.des2;var r=DonotDestroyManager.GameData.Units.unit_types[a-1][e.unitGrade];return r&&(t.impHp=r.ori_attrs.maxhp,t.impAtk=r.ori_attrs.atk,t.impDef=r.ori_attrs.def,t.impAddHp=r.add_attrs.maxhp,t.impAddAtk=r.add_attrs.atk,t.impAddDef=r.add_attrs.def,t.impIcon=r.icon,t.impName=r.name,t.impQuality=r.quality,t.impdes2=r.des2),t},n.getUnitEquipHADPlus=function(e,t){return DonotDestroyManager.GameData.UnitsEquips[e].attrs[t]||0},t.exports=n,cc._RF.pop()},{EquipBufferMgr:"EquipBufferMgr",UnitConfigMgr:"UnitConfigMgr"}],UnitConfigMgr:[function(e,t,a){"use strict";cc._RF.push(t,"7723dKIat9HSJ6jUYTGdqJp","UnitConfigMgr");var p=function(){};p.find=function(e,t){for(var a=DonotDestroyManager.GameData.Units.unit_types[e-1],n=0;n<a.length;n++){var i=a[n];if(i.grade==t)
return i}
return null},p.getUnitEquips=function(e,t){var a=[],n=DonotDestroyManager.GameData.Units.cost[e-1][t-1];for(var i in n.upgrade_item){var r=n.upgrade_item[i];a.push(r[0])}
return a},p.getUnitEquipCfg=function(e){return DonotDestroyManager.GameData.UnitsEquips[e]},p.getUnitPropAttr=function(e,t,a,n){for(var i=p.find(e,t),r=[],s=Object.keys(i.ori_attrs),o=0;o<s.length;o++){var c=s[o],l=i.ori_attrs[c];r[c]=l}
var h=Object.keys(i.add_attrs);for(o=0;o<h.length;o++){c=h[o],l=i.add_attrs[c];r[c]=r[c]+l*(a-1)}
if(n&&0<n.length){var d=p.getUnitEquips(e,t);for(var _ in n){var u=n[_];if(u&&1==u){var m=p.getUnitEquipCfg(d[_]);for(var c in m.attrs){l=m.attrs[c];r[c]=r[c]+l}}}}
return[r.maxhp,r.atk,r.def]},t.exports=p,cc._RF.pop()},{}],UnitCounterInfo:[function(e,t,a){"use strict";cc._RF.push(t,"3197fyxgLdKU57kvjTT+NxM","UnitCounterInfo");var n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},Mask_OnClickHandler:function(e){n.playBtnCloseEffect(),this.node.active=!1}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],UnitEquipsItem:[function(e,t,a){"use strict";cc._RF.push(t,"096f2ZLiExE3JojVrz4cO8m","UnitEquipsItem");var s=e("ShaderUtil");cc.Class({extends:cc.Component,properties:{m_pEquipname:cc.Label,m_pEquipNum:cc.Label,m_pItembox:cc.Prefab,m_pItemparent:cc.Node,_itembox:cc.Node,_index:-1,_equipid:-1,_level:-1,_equipinfo:[],_unitequipjson:null,_heroid:-1},onLoad:function(){},ChangeData:function(e){this._index=e.index,this._equipinfo=e.equipinfo,this._level=e.level,this._equipid=e.equipinfo[0],this._heroid=e.heroid,this._unitequipjson=DonotDestroyManager.GameData.UnitsEquips[this._equipid],this.Init()},Init:function(){if(0<MyPersistDataManager._playerData.cardsMaplist[this._heroid].unitEquips[this._index])
this.CreateItembox(this._equipid),this.m_pEquipname.node.active=!0,this.m_pEquipNum.node.active=!1,this.m_pEquipname.string=this._unitequipjson.name,this.m_pEquipname.node.color=cc.Color.GREEN;else{var e=0;(e=null==MyPersistDataManager._playerData.bagMap[this._equipid]?0:MyPersistDataManager._playerData.bagMap[this._equipid].num)<this._equipinfo[1]?(this.m_pEquipNum.string=e+"/"+this._equipinfo[1],this.m_pEquipname.string=this._unitequipjson.name,this.m_pEquipname.node.active=!0,this.m_pEquipNum.node.active=!0,this.m_pEquipname.node.color=cc.Color.ORANGE,this.CreateItembox(this._equipid,0,!0)):(this.m_pEquipname.node.active=!1,this.m_pEquipNum.node.active=!1,this._level<this._equipinfo[2]?this.CreateItembox(-1,2):this.CreateItembox(-1,1))}},checkCanEquip:function(){if(0<MyPersistDataManager._playerData.cardsMaplist[this._heroid].unitEquips[this._index])
return!1;return!((null==MyPersistDataManager._playerData.bagMap[this._equipid]?0:MyPersistDataManager._playerData.bagMap[this._equipid].num)<this._equipinfo[1])&&!(this._level<this._equipinfo[2])},CreateItembox:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=null;if(null==this._itembox){var i=cc.instantiate(this.m_pItembox);this.m_pItemparent.addChild(i),this._itembox=i}
(n=this._itembox.getComponent("ItemBox")).node.active=!0;var r=this.OnClickHandler.bind(this);-1!=e?n.ChangeItemInfo(e,0,!1,r):n.SetCanEquipEmptyItem(this._index,2,t,r),a?s.setGaryShader(n.node):s.resetShader(n.node)},OnClickHandler:function(e){MyUiManager.Open(MyUiManager.PanelInfo.ArmyEquipDialog,{equipinfo:this._equipinfo,equipjson:this._unitequipjson,level:this._level,index:this._index,heroid:this._heroid})}}),cc._RF.pop()},{ShaderUtil:"ShaderUtil"}],Unit:[function(o,e,t){"use strict";cc._RF.push(e,"b4878Q0T5xAQ6igVopDg+B1","Unit");var c=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=o("BattleConstants"),l=o("SoundUtil"),h=o("MyEventDispatcher"),r=o("BattleWidgets"),a=(o("SkillsManager"),cc.Class({extends:o("WActor"),properties:{},ctor:function(){cc.log("BUnit create!"),this.army=null,this.class="",this.amt=null,this.hp=0,this.atk=0,this.def=0,this.bloodBar=null,this.basehp=this.hp,this.baseatk=this.atk,this.basedef=this.def,this.lSlot=null,this.rSlot=null,this.slot3V1=null,this.side3V1="",this.target=null,this.disVector=cc.v2(0,0),this.moveRandom=0,this.move2Pos=null,this.meet2Pos=null,this.atkDelay=0,this.remoteAtkedNum=0,this.buffs=[],this.stunPreEv=null,this.frozenPreEv=null,this.bSight=null},getUnitSize:function(){},getHeight:function(){},setTarget:function(e,t){},playAnimation:function(e){},pauseAnimation:function(){},resumeAnimation:function(){},getAtkType:function(){},side:function(){return this.army.side},setPosition:function(e,t){void 0!==t?(this._super(e,t),this.node.setLocalZOrder(s._BTL_ZORDER.BF_FIELD-t)):(this._super(e,null),this.node.setLocalZOrder(s._BTL_ZORDER.BF_FIELD-e.y))},setFaceTowards:function(){var e=Math.abs(this.amt.scaleX);1==this.cfg.is_spine&&(e*=-1),this.disVector.x<0?this.amt.scaleX=e:this.amt.scaleX=-e},setFace2Slot:function(){var e=Math.abs(this.amt.scaleX);1==this.cfg.is_spine&&(e*=-1),this.target==this.lSlot?this.amt.scaleX=e:this.target==this.rSlot&&(this.amt.scaleX=-e)},setFace2Target:function(){var e=Math.abs(this.amt.scaleX);if(1==this.cfg.is_spine&&(e*=-1),this.isTargetAble()){var t=this.target.getPosition().x,a=this.getPosition().x;this.amt.scaleX=t<a?e:-e}},setFace2ByParam:function(e){var t=Math.abs(this.amt.scaleX);1==this.cfg.is_spine&&(t*=-1),this.amt.scaleX=e?-t:t},setFace2Side:function(e){var t=Math.abs(this.amt.scaleX);1==this.cfg.is_spine&&(t*=-1),this.amt.scaleX=-e*t},getOrient:function(){var e=1;return e=this.amt.scaleX<0?1:-1,1==this.cfg.is_spine&&(e*=-1),e},isTargetAble:function(){return this.target&&"Dead"!=this.target.getState()},move:function(e,t,a){if(0<=this.moveRandom)
return this.moveRandom=this.moveRandom-t,void(this.moveRandom<0&&this.playAnimation(a||"move"));cc.assert(this.disVector,"Army state[%s], last event[%s], next event[%s]",this.army.getState(),this.lastEv,this.nextEv);var n=e*t,i=cc.pMult(cc.pNormalize(this.disVector),n);n>cc.pLength(this.disVector)&&(i=this.disVector);var r=cc.pAdd(cc.p(this.getPosition()),i);this.setPosition(r.x,r.y),this.setFaceTowards()},stun:function(e){if("Frozen"==this.getState()||"Dead"==this.getState())
return null;if(1==this.buff_dmg_free||1==this.skill_dmg_free)
return null;this.openSkilled=!1,this.playAnimation(e),this.stunPreEv=this.stunPreEv||this.lastEv,this.doEvent("Stun");var a=this;return function(){var e=a.stunPreEv,t=a.army.getState();a.doEvent("Idle"),a.getAtkType()==s._ARMY_TYPE.Remote&&"Meet"==t?"Attack"==e?a.doEvent("Attack"):a.doEvent("Meet"):"Move"==e||"Move"==t||"Arrange"==t?a.doEvent("Move"):"Skill"==e&&a.onSkillCastEnd()}},interruptAction:function(e,t,a){if("Frozen"==this.getState()||"Dead"==this.getState())
return null;if(1==this.buff_dmg_free||1==this.skill_dmg_free)
return null;this.openSkilled=!1,this.playAnimation(e),this.stunPreEv=this.stunPreEv||this.lastEv,this.doEvent("Stun");var n=this;if(2==t)
this.node.runAction(cc.sequence(cc.moveBy(.25,cc.p(0,70)).easing(cc.easeCubicActionOut()),cc.moveBy(.25,cc.p(0,-70)).easing(cc.easeCubicActionIn())));else if(3==t)
this.node.runAction(cc.sequence(cc.moveBy(.3,cc.p(0,200)).easing(cc.easeCubicActionOut()),cc.moveBy(.3,cc.p(0,-200)).easing(cc.easeCubicActionIn())));else if(4==t){var i=this.getPosition().x,r=a.getPosition().x<i?250:-250;this.node.runAction(cc.moveBy(.25,cc.p(r,0)).easing(cc.easeCubicActionOut()))}
return function(){var e=n.stunPreEv,t=n.army.getState();n.doEvent("Idle"),n.getAtkType()==s._ARMY_TYPE.Remote&&"Meet"==t?"Attack"==e?n.doEvent("Attack"):n.doEvent("Meet"):"Move"==e||"Move"==t||"Arrange"==t?n.doEvent("Move"):"Skill"==e&&n.onSkillCastEnd()}},frozen:function(){if("Dead"==this.getState())
return null;if(1==this.buff_dmg_free||1==this.skill_dmg_free)
return null;this.openSkilled=!1,this.pauseAnimation(),this.frozenPreEv=this.frozenPreEv||this.lastEv,this.doEvent("Frozen");var n=this;return function(){n.resumeAnimation();var e=n.frozenPreEv,t=n.army.getState();n.doEvent("Idle");var a=function(){for(var e=0;e<n.buffs.length;e++){var t=n.buffs[e];if(t.cfg.buff_type==s._BUFF_TYPE.Stun)
return t}
return null}
();a?(n.stun(a.cfg.targetanim),"Stun"!=e&&a.addEffects()):n.getAtkType()==s._ARMY_TYPE.Remote&&"Meet"==t?"Attack"==e?n.doEvent("Attack"):n.doEvent("Meet"):"Move"==e||"Move"==t||"Arrange"==t?n.doEvent("Move"):"Skill"==e&&n.onSkillCastEnd()}},switchSlot:function(e){e==this.lSlot?(this.lSlot=null,e.rSlot=null,this.target=this.rSlot,this.slot3V1&&"left"==this.side3V1&&(this.lSlot=this.slot3V1,this.slot4V1?(this.slot3V1=this.slot4V1,this.side3V1=this.side4V1,this.slot4V1=null,this.side4V1=""):(this.slot3V1=null,this.side3V1=""),this.lSlot.rSlot=this)):e==this.rSlot&&(this.rSlot=null,e.lSlot=null,this.target=this.lSlot,this.slot3V1&&"right"==this.side3V1&&(this.rSlot=this.slot3V1,this.slot4V1?(this.slot3V1=this.slot4V1,this.side3V1=this.side4V1,this.slot4V1=null,this.side4V1=""):(this.slot3V1=null,this.side3V1=""),this.rSlot.lSlot=this))},switchCheckTarget:function(){if(!this.isTargetAble()){var e=this.getState();"Skill"==e?this.skillPreEv="Idle":"Attack"==e?this.nextEv="Idle":"Frozen"!=e&&"Stun"!=e&&this.doEvent("Idle")}},releaseSlot:function(){this.lSlot&&(this.lSlot.rSlot=null,this.lSlot.target==this&&(this.lSlot.target=this.lSlot.lSlot,this.lSlot.switchCheckTarget())),this.rSlot&&(this.rSlot.lSlot=null,this.rSlot.target==this&&(this.rSlot.target=this.rSlot.rSlot,this.rSlot.switchCheckTarget())),this.slot3V1&&this.slot3V1.switchCheckTarget(),this.slot4V1&&this.slot4V1.switchCheckTarget()},isHitBy:function(e){return!0},showDeal:function(){var e,t=o("EffectsManager").createEffect();e=1==this.getOrient()?"action1":"action2",t.id=16040003,t.cfg={file:"dmgarmor",action:e,x:0,y:0,layer:2},t.target=this,t.setFSM()},showBlood:function(e){var t,a=o("EffectsManager").createEffect();t=e?"action2":"action1",a.id=16040005,a.cfg={file:"blood",action:t,offsetx:0,offsety:0,x:0,y:0,layer:2,scale:1},a.target=this,a.setFSM()},showReduceWords:function(e,t){var a,n,i=t?1.4:null;this.army.side==s._BTL_SIDE.OUR?a=r.createFloatWords(e,"red_number_%s",i):this.army.side==s._BTL_SIDE.OTR&&(a=r.createFloatWords(e,"white_number_%s",i)),t?(a.setScale(.5),n=cc.sequence(cc.spawn(cc.moveBy(.06,cc.p(0,10)),cc.scaleTo(.06,3*i)),cc.spawn(cc.moveBy(.06,cc.p(0,-5)),cc.scaleTo(.06,.95*i)),cc.spawn(cc.moveBy(.1,cc.p(0,5)),cc.scaleTo(.1,1.2*i)),cc.spawn(cc.moveBy(.13,cc.p(0,5)),cc.scaleTo(.13,.95*i)),cc.spawn(cc.moveBy(.16,cc.p(0,5)),cc.scaleTo(.16,1*i)),cc.spawn(cc.moveBy(.13,cc.p(0,5)),cc.fadeTo(.13,180)),cc.spawn(cc.moveBy(.33,cc.p(0,5)),cc.fadeOut(.33)),cc.removeSelf(),cc.callFunc(function(){r.reuseWord(this),this.destroy()},a))):n=cc.sequence(cc.spawn(cc.moveBy(.1,cc.p(0,20)),cc.scaleTo(.1,1.2)),cc.spawn(cc.moveBy(.43,cc.p(0,7)),cc.scaleTo(.43,1)),cc.spawn(cc.moveBy(.33,cc.p(0,5)),cc.fadeOut(.33)),cc.removeSelf(),cc.callFunc(function(){r.reuseWord(this),this.destroy()},a)),this.node.addChild(a),a.setPositionY(this.getHeight()-30),a.setLocalZOrder(s._BTL_ZORDER.U_ABOVE),a.runAction(n)},showIncreaseWords:function(e){var t=r.createFloatWords(e,"green_number_%s"),a=cc.sequence(cc.scaleTo(.1,1.3),cc.spawn(cc.moveBy(.5,cc.p(0,36)),cc.scaleTo(.5,1.4),cc.fadeOut(.5)),cc.removeSelf(),cc.callFunc(function(){r.reuseWord(this),this.destroy()},t));this.node.addChild(t),t.setScale(1.5),t.setPositionY(this.getHeight()),t.setLocalZOrder(s._BTL_ZORDER.U_ABOVE),t.runAction(a)},showBallistaFocus:function(){if(!this.bSight){var e=o("EffectsManager");this.bSight=e.createEffect();var t=1;"Hero"==this.class&&(t=1.2),this.bSight.id=16040004,this.bSight.cfg={file:"ballista_sight",action:"focus",offsetx:12,offsety:0,x:12,y:.5*this.getHeight(),layer:2,scale:t},(this.bSight.target=this).bSight.autoEnd=!1;var a=this;this.bSight.complete=function(){a.bSight&&a.bSight.node.getComponent("dragonBones.ArmatureDisplay").armature().animation.fadeIn("attack",-1,-1,0,"normal")},this.bSight.setFSM()}},autoDie:function(){var e=o("BattleManager");(!this.uType||this.uType<10)&&(this.army.side==s._BTL_SIDE.OUR?e.ourside.hps[0]=e.ourside.hps[0]-this.hp:this.army.side==s._BTL_SIDE.OTR&&(e.otrside.hps[0]=e.otrside.hps[0]-this.hp),h.dispatchEvent("onHPChanged")),this.doEvent("Dead"),this.lSlot&&(this.lSlot.rSlot=null),this.rSlot&&(this.rSlot.lSlot=null),this.releaseSlot()},reduceHP:function(e,t,a,n){var i,r=o("BattleManager");(e=Math.floor(e),this.hp=this.hp-e,null==this.bloodBar&&cc.log("bloodbar null!"+this.name),12==r.type&&this.army.side==s._BTL_SIDE.OTR)&&o("BossBattleManager").onBossHurt(e);this.bloodBar.getComponent("BattleLifeBarMgr").setPercent(this.hp/this.basehp),this.showBlood(n),i=(i=this.hp<0?this.hp+e:e)<0?0:i,!t||"Soldier"==t.class&&11!=t.uType?"Soldier"==this.class&&(this.bloodBar.active=!1):this.showReduceWords(e,a),null!=t.bloodGet&&0<t.bloodGet&&"Hero"==this.class&&t.increaseHP(t.bloodGet*i),"TeamSkill"==t.class&&(t=null),(!this.uType||this.uType<10)&&(this.army.side==s._BTL_SIDE.OUR?r.ourside.hps[0]=r.ourside.hps[0]-i:this.army.side==s._BTL_SIDE.OTR&&(r.otrside.hps[0]=r.otrside.hps[0]-i),h.dispatchEvent("onHPChanged")),t&&r.statistics.addDamage(t.army,e),this.hp<=0&&("Skill"==this.getState()?this.skillPreEv="Dead":this.preDeadSkill?this.preDeadSkill():this.doEvent("Dead"),t&&t.switchSlot(this),this.releaseSlot(),t&&("Hero"==this.class&&r.statistics.addKillHero(t.army),r.statistics.addKillUnit(t.army)))},increaseHP:function(e){var t=o("BattleManager");e=Math.ceil(e);var a=Math.min(this.hp+e,this.basehp),n=a-this.hp;n=n<0?0:n,this.showIncreaseWords(e),(!this.uType||this.uType<10)&&(this.army.side==s._BTL_SIDE.OUR?t.ourside.hps[0]=t.ourside.hps[0]+n:this.army.side==s._BTL_SIDE.OTR&&(t.otrside.hps[0]=t.otrside.hps[0]+n),h.dispatchEvent("onHPChanged")),this.hp=a,null!=this.bloodBar&&this.bloodBar.getComponent("BattleLifeBarMgr").setPercent(this.hp/this.basehp)},damage:function(e,t,a){if(1==this.buff_dmg_free||1==this.skill_dmg_free)
return this.showGet(),0;if(this.isHitBy(e)){var n,i=null!=this.get?this.get:0,r=null!=e.deal?e.deal:0,s=null!=e.crit?e.crit:0,o=i/(30+2*e.level),c=r/(30+2*this.level),l=s/(30+2*this.level),h=e.critD||0;100-o<0?(o=100,l=c=0):100-o-c<0?(c=100-o,l=0):100-o-c-l<0&&(l=100-o-c);var d=null!=t?t:0,_=0,u=0,m=0,p=99*Math.random();p<o?(this.showGet(),d-=.5):p<o+c?(this.showDeal(),u-=.5):p<o+c+l&&(m=Math.min(300,25+l+h/15));var f=null!=e.cfg.counter?e.cfg.counter:e.uCfg.counter,g=null!=this.uType?this.uType:this.cfg.unit_type,y=!1;if(f&&f.counter_type==g&&(_+=f.dmg_deal,y=!0),null!=this.cfg.dmg_coef)
for(var v=0;v<this.cfg.dmg_coef.length;v++){var M=this.cfg.dmg_coef[v];if(M[0]==e.cfg.unit_type){d=(d=(d+1)*M[1]-1)<-1?-.99:d;break}}
if(null!=this.cfg.hp_perc_def){var S=this.hp/this.basehp;u+=(1-(S=1<=(S=S<=0?0:S)?1:S))*this.cfg.hp_perc_def}
var C,D=null!=e.cfg.dmg_type?e.cfg.dmg_type:e.uCfg.dmg_type,I=null!=a?a:D;if(0==I)
C=0;else if(1==I){C=((null!=e.str?e.str:e.cfg.str)-(null!=this.str?this.str:this.cfg.str))/200}else if(2==I){C=((null!=e.int?e.int:e.cfg.int)-(null!=this.int?this.int:this.cfg.int))/200}
var b=null!=e.co?e.co:e.cfg.co,P=null!=this.co?this.co:this.cfg.co;n=(e.atk*(1+_)-this.def*(1+u))*(1+C+(b-P)/300)*(1+d)*(1+m/100);var L=null!=e.minD?e.minD:0,B=null!=e.maxD?e.maxD:0,w=Math.min(.8*n+L,1.2*n+B),E=Math.max(.8*n+L,1.2*n+B);return n=Math.random()*(E-w)+w,n=Math.max(.1*e.atk,n),this.reduceHP(n,e,0<m,y),n}
return this.showDodge(),0},commonDamage:function(e,t){if(e.damageSkill&&"Dead"!=e.getState())
for(var a=0;a<e.damageSkill.length;a++){(0,e.damageSkill[a])()}"Dead"!=this.getState()&&this.damage(e,t)},skillDamage:function(e,t,a){if("Dead"!=this.getState()){var n=t.dmg_type;if(null!=t.rate.dmg_coef){var i=t.rate.dmg_coef+a;return this.damage(e,i,n)}
if(null!=t.rate.curHp&&0<t.rate.curHp){var r=t.rate.curHp||0,s=null!=this.treatment&&1<this.treatment?this.treatment:1,o=this.basehp*r/100*s;return this.increaseHP(o),o}}},buffDamage:function(e,t){if("Dead"!=this.getState())
if(0<t){var a=null!=this.treatment&&1<this.treatment?this.treatment:1;this.increaseHP(this.basehp*t/100*a)}else if(t<0){var n=-1-t/100;this.damage(e,n,2)}},onenterIdle:function(){this.playAnimation("stand")},onenterMove:function(){this.move2Pos?this.disVector=cc.pSub(this.move2Pos,cc.p(this.getPosition())):this.moveRandom=(29*Math.random()+1)/100},onenterCheer:function(){this.playAnimation("victory")},onbeforeAttack:function(){var e=o("BattleManager");if(!e.fightSE){l.stopEffect(e.unFightSE),e.unFightSE=null;var t=l.getBattleSound("battle",2),a=c(t,2),n=a[0],i=a[1];e.fightSET=i,e.fightSE=l.playEffect(n)}},onbeforeDead:function(){this.bloodBar.removeFromParent(),this.bloodBar.destroy(),this.bloodBar=null;for(var e=0;e<this.buffs.length;e++){this.buffs[e].doEvent("Cancel")}
this.buffs=[],this.bSight&&(this.bSight.doEvent("End"),this.bSight=null);var t=o("BattleManager");if(!t.deadSE){var a=this.uType||this.cfg.unit_type;if(10!=a&&11!=a){var n=l.getBattleSound("dead",a),i=c(n,2),r=i[0],s=i[1];t.deadSE=l.playEffect(r),t.deadSET=s}}},onafterDead:function(){this.setLocalZOrder(s._BTL_ZORDER.BF_BEHIND);var e=!0;this.army.hero&&(e="Dead"==this.army.hero.getState()),e&&0==this.army.soldiers.length&&this.army.doEvent("Destory")},onleaveStun:function(){for(var e=this.buffs.length-1;0<=e;e--){var t=this.buffs[e];t.cfg.buff_type==s._BUFF_TYPE.Stun&&(t.doEvent("Cancel"),this.buffs.splice(e,1))}
this.stunPreEv=null},onleaveFrozen:function(){for(var e=this.buffs.length-1;0<=e;e--){var t=this.buffs[e];t.cfg.buff_type==s._BUFF_TYPE.Frozen&&(t.doEvent("Cancel"),this.buffs.splice(e,1))}
this.frozenPreEv=null},pause:function(){this.pauseAnimation()},resume:function(){this.resumeAnimation()},onUpdate:function(e){},updateMove:function(e,t){(e=cc.director.getScheduler().getTimeScale()*e,this.move2Pos)?(cc.director.getTotalFrames()%128==0&&(this.disVector=cc.pSub(this.move2Pos,cc.p(this.getPosition()))),cc.pDistance(this.move2Pos,cc.p(this.getPosition()))<3*t*e?(this.move2Pos=null,this.setFace2Side(this.side()),this.doEvent("Idle")):this.move(3*t,e)):this.move(t,e)}}));e.exports=a,cc._RF.pop()},{BattleConstants:"BattleConstants",BattleManager:"BattleManager",BattleWidgets:"BattleWidgets",BossBattleManager:"BossBattleManager",EffectsManager:"EffectsManager",MyEventDispatcher:"MyEventDispatcher",SkillsManager:"SkillsManager",SoundUtil:"SoundUtil",WActor:"WActor"}],UnlockFuncLayer:[function(e,t,a){"use strict";cc._RF.push(t,"00b7cZcwJ1O2oEiA/0jaaAV","UnlockFuncLayer");var n=e("SoundUtil"),i=(e("GameUtils"),e("MarqueeBufferMgr"));cc.Class({extends:cc.Component,properties:{m_pIcon:cc.Sprite,m_pDesSpr:cc.Sprite,mFlareNode:cc.Node,_cfg:null,_lookid:"",_loadCount:0},onLoad:function(){this._cfg={snatch:["snatch_pic","snatch_desc"],arean:["arean_pic","arean_desc"],equipsmelter:["es_pic","es_desc"],teamskill:["teamskill_pic","teamskill_desc"],weekly:["weeky_pic","weeky_battle_des"],epic:["battle_pic","epic_battle_desc"],herostren:["heroStr_pic","heroStr_desc"],trearefine:["treasure_refining_pic","treasure_refining_desc"]},this._loadCount=0},setParams:function(e){this._lookid=e.lookid,this.Init()},Init:function(){var a=this;cc.log(" truyền tới được ID === "+this._lookid),cc.loader.loadRes("UI/UnlockFuncLayer/"+this._cfg[this._lookid][0],cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),a.m_pIcon.spriteFrame=t,a._loadCount++,a.playFlareAnimation()}),cc.loader.loadRes("UI/UnlockFuncLayer/"+this._cfg[this._lookid][1],cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),a.m_pDesSpr.spriteFrame=t,a._loadCount++,a.playFlareAnimation()})},OnClickHandler:function(e){n.playBtnOpenEffect(),MyUiManager.Back(),"mainhome"!=MyUiManager.currentSceneName?(MyBgMusicManager.stopAll(),MyBgMusicManager.uncacheAll(),i.setMarqueeCanPlay(!1),cc.director.loadScene("mainhome"),MyUiManager.currentSceneName="mainhome"):MyUiManager.backAll()},Mask_OnClickHandler:function(e){n.playBtnCloseEffect(),MyUiManager.Back()},playFlareAnimation:function(){if(2<=this._loadCount){this.mFlareNode.active=!0;this.mFlareNode.getComponent(cc.Animation).play("flare")}}}),cc._RF.pop()},{GameUtils:"GameUtils",MarqueeBufferMgr:"MarqueeBufferMgr",SoundUtil:"SoundUtil"}],UnlockTips:[function(e,t,a){"use strict";cc._RF.push(t,"2e086kxgoFBUq1pWjWtDftg","UnlockTips");var s=function(e,t){if(Array.isArray(e))
return e;if(Symbol.iterator in Object(e))
return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}
finally{try{!n&&o.return&&o.return()}
finally{if(i)
throw r}}
return a}
(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=e("UnLockCfgMgr"),c=e("StagesConfigMgr"),n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{m_pName:cc.Label,m_pDes:cc.Label,m_pUnlock:cc.Label,spr_unlock:cc.Sprite,_lockid:-1},onLoad:function(){},ChangeData:function(e){this._lockid=e-1,this.Init()},Init:function(){var e=o.getUnLockData(this._lockid),t="";if(e.stage){var a=c.getStageUnLockInfo(e.stage),n=s(a,2);t="Vượt ải "+n[0]+"*Ải "+n[1]+""}else
t="Cấp Bang đạt đạt tới "+e.level+" cấp";if(this.m_pDes.string=e.des2,this.m_pUnlock.string=t,this.m_pName.string=e.des,null!=e.icon&&""!=e.icon){var i="UI/Unlock/"+e.icon.replace(".png",""),r=this;cc.loader.loadRes(i,cc.SpriteFrame,function(e,t){cc.loader.setAutoReleaseRecursively(t,!0),null!=r&&cc.isValid(r.node)&&(r.spr_unlock.spriteFrame=t)})}},Mask_OnClickHandler:function(e){n.playBtnCloseEffect(),this.node.destroy()}}),cc._RF.pop()},{SoundUtil:"SoundUtil",StagesConfigMgr:"StagesConfigMgr",UnLockCfgMgr:"UnLockCfgMgr"}],UserDetailInfoManager:[function(e,t,a){"use strict";cc._RF.push(t,"8c3ce3ai2VIdKySvuoJgqF8","UserDetailInfoManager");var n=e("SoundUtil"),i=e("i18n"),r=e("MyProtocols"),s=e("NetEvent"),o=e("MyEventDispatcher"),c=e("MyUIEvent");cc.Class({extends:cc.Component,properties:{m_pSex:cc.Sprite,m_pVIP:cc.Label,m_pName:cc.Label,m_pFight:cc.Label,m_pLevel:cc.Label,m_pExp:cc.Label,m_pHp:cc.Label,m_pCp:cc.Label,m_pId:cc.Label,m_pId2:cc.Label,m_pHeadImageList:[cc.SpriteFrame],m_pScaelNode:cc.Node,mLibaoInput:cc.EditBox,m_pRewardPanel:cc.Prefab,node_cdk:cc.Node},onLoad:function(){this.ScaleToLarge(),this.ReadInfo(),this.S2CKeyConvert_cb_func=this.S2CKeyConvert_cb.bind(this),o.addListener(s.S2CKeyConvert,this.S2CKeyConvert_cb_func),this.S2CListHeadFrame_cb_func=this.S2CListHeadFrame_cb.bind(this),o.addListener(s.S2CListHeadFrame,this.S2CListHeadFrame_cb_func),this.onNameChange_cb_func=this.onNameChange_cb.bind(this),o.addListener(c.onNameChange,this.onNameChange_cb_func),3==DonotDestroyManager.jsbChannel&&(this.node_cdk.active=!1)},onDestroy:function(){null!=this.finishCb&&this.finishCb(),o.removeListener(s.S2CKeyConvert,this.S2CKeyConvert_cb_func),o.removeListener(s.S2CListHeadFrame,this.S2CListHeadFrame_cb_func),o.removeListener(c.onNameChange,this.onNameChange_cb_func)},S2CListHeadFrame_cb:function(e){MyUiManager.Open(MyUiManager.PanelInfo.ChangeHeadFrameLayer,{netData:e})},onNameChange_cb:function(e){this.m_pName.string=e},S2CKeyConvert_cb:function(e){if(null!=e.reward_item&&0<e.reward_item.length){var t=cc.instantiate(this.m_pRewardPanel);cc.Canvas.instance.node.addChild(t),t.getComponent("GetRewardPanel")._itemlist=e.reward_item}else
MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Đổi thành công!")},ReadInfo:function(){this.m_pVIP.string=MyPersistDataManager._playerData.vip_level,this.m_pName.string=MyPersistDataManager._playerData.name,this.m_pFight.string=MyPersistDataManager._playerData.fight,this.m_pLevel.string=i.t("userdetailinfo_002",{value:MyPersistDataManager._playerData.level}),this.m_pExp.string=i.t("userdetailinfo_003",{exp1:MyPersistDataManager._playerData.level_exp,exp2:DonotDestroyManager.GameData.Levels[MyPersistDataManager._playerData.level-1].exp}),this.m_pHp.string=i.t("userdetailinfo_004",{hp1:MyPersistDataManager._playerData.energy,hp2:DonotDestroyManager.GameData.Levels[MyPersistDataManager._playerData.level-1].max_energy}),this.m_pCp.string=i.t("userdetailinfo_005",{sp1:MyPersistDataManager._playerData.stamina,sp2:DonotDestroyManager.GameData.Common.max_stamina});var e=MyPersistDataManager._playerData.account_id;12<e.length&&(e=e.substring(0,10)+"..."),this.m_pId.string=i.t("userdetailinfo_006",{value:e}),this.m_pId2.string=i.t("userdetailinfo_007",{value:MyPersistDataManager._playerData.id}),this.JudgeSex()},setParams:function(e){this.closeCb=e.closeCb},JudgeSex:function(){var e=MyPersistDataManager._playerData.sex;this.ChangeImage(this.m_pHeadImageList[e-1])},ChangeImage:function(e){this.m_pSex.spriteFrame=e},setCloseCb:function(e){this.finishCb=e},DestroySelf_onClickOtherEvent:function(e){var t=cc.scaleTo(.1,.7,.7);n.playBtnCloseEffect();var a=cc.sequence(t,cc.callFunc(function(){MyUiManager.Back()}));this.m_pScaelNode.runAction(a)},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.2,1,1);this.m_pScaelNode.runAction(e)},jump2SystemSetting:function(e){n.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.SystemSettingLayer)},jump2ChangeName:function(e){n.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.ChangeNameLayer)},jump2ChangeIcon:function(e){n.playBtnOpenEffect(),MyUiManager.Open(MyUiManager.PanelInfo.ChangeIconLayer)},jump2ChangeHeadFrame:function(e){n.playBtnOpenEffect(),r.send_C2SListHeadFrame(DonotDestroyManager._gameSocket)},giftCdkHanlder:function(e){n.playBtnOpenEffect();var t=this.mLibaoInput.string;null!=t&&""!=t?(r.send_C2SKeyConvert(DonotDestroyManager._gameSocket,t),this.mLibaoInput.string=""):MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("userdetailinfo_009"))}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],VipLabel:[function(e,t,a){"use strict";cc._RF.push(t,"af2e4KTBkRLLot2uZhhMfyx","VipLabel"),cc.Class({extends:cc.Component,properties:{labelPrefab:cc.Prefab},onLoad:function(){},ChangeData:function(e,t){for(var a=0;a<3;++a){var n=cc.instantiate(this.labelPrefab);1==a&&(n.color=new cc.color(255,210,0)),n.getComponent(cc.Label).string=e[t][a],this.node.addChild(n)}}}),cc._RF.pop()},{}],VipPayCell1:[function(e,t,a){"use strict";cc._RF.push(t,"76ae89hdNpGFIkUbPakRGVk","VipPayCell1");var ee=e("MyProtocols"),n=e("MyEventDispatcher"),i=e("MyUIEvent"),te=e("SoundUtil"),ae=e("i18n");cc.Class({extends:cc.Component,properties:{m_pCellName:cc.Label,m_pCellRmb:cc.Label,m_pCell:cc.Sprite,m_pCellImage:[cc.SpriteFrame],m_pCellBottomDes:cc.Label,lab_daySend:cc.Label,_index:0,_cellState:0},onLoad:function(){this.ReadInfoGreen(),this.onChargeInfo_cb_func=this.onChargeInfo_cb.bind(this),n.addListener(i.onChargeInfo,this.onChargeInfo_cb_func)},ChangeData:function(e){this._index=e},onChargeInfo_cb:function(e){this.ReadInfoGreen()},onDestroy:function(){n.removeListener(i.onChargeInfo,this.onChargeInfo_cb_func)},ReadInfoGreen:function(){if(this.m_pCellName.string=DonotDestroyManager.GameData.Charge.payment[this._index].name,this.m_pCellRmb.string=ae.t("vippay_009",{value:DonotDestroyManager.GameData.Charge.payment[this._index].rmb}),null!=window.open_platform&&2==window.open_platform&&cc.sys.os==cc.sys.OS_IOS&&(this.m_pCellRmb.string=ae.t("vippay_012",{value:10*DonotDestroyManager.GameData.Charge.payment[this._index].rmb})),this.lab_daySend.string="x"+DonotDestroyManager.GameData.Charge.payment[this._index].times[1][0],this.m_pCell.spriteFrame=this.m_pCellImage[this._index],0==this._index){var e=MyPersistDataManager._playerData.chargeInfo.yueka_left_day;this.m_pCellBottomDes.string=ae.t("vippay_004",{v:e}),0<e&&(this.m_pCellBottomDes.node.color=cc.Color.GREEN)}else
1==this._index&&(1==MyPersistDataManager._playerData.chargeInfo.is_long_yueka&&(this.m_pCellBottomDes.node.color=cc.Color.GREEN),this.m_pCellBottomDes.string=ae.t("vippay_005"))},clickHanlder:function(e){if(te.playBtnOpenEffect(),cc.log(" gửi đi dự tiền trả tin tức ,index=%d",this._index),null!=window.open_platform){var t=DonotDestroyManager.GameData.Charge.payment[this._index].name;switch(window.open_platform){case 1:ee.send_C2SQunheiPayPre(DonotDestroyManager._gameSocket,this._index,t);break;case 2:ee.send_C2SWanBaGetBalance(DonotDestroyManager._gameSocket,window.OPEN_DATA.appid,window.OPEN_DATA.openid,window.OPEN_DATA.openkey,window.OPEN_DATA.pf,window.OPEN_DATA.platform,this._index,t);break;case 3:ee.send_C2SZMPayCheck(DonotDestroyManager._gameSocket,this._index,t);break;case 4:var a=window.THREE33.gameId;window.THREE33.uid;ee.send_C2S333PayPre(DonotDestroyManager._gameSocket,a,t,this._index);break;case 5:ee.send_C2SChongChongPayPre(DonotDestroyManager._gameSocket,this._index,t);break;case 6:ee.send_C2S4399PayPre(DonotDestroyManager._gameSocket,this._index,t)}}
if(2==DonotDestroyManager.jsbChannel){var n=DonotDestroyManager.GameData.Charge.payment[this._index],i=100*n.rmb,r=n.name,s=this._index+"_"+MyPersistDataManager._playerData.server_id,o=ae.t("pay_yijie_callback_url");window.webkit.messageHandlers.pay.postMessage({unitPrice:i,itemName:r,count:1,callBackInfo:s,callBackUrl:o})}else{if(3==DonotDestroyManager.jsbChannel){var c=DonotDestroyManager.GameData.Charge.payment[this._index].product_id;this._index;return void(cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("LejiIAPApi","BuyProduct:",c))}
if(4==DonotDestroyManager.jsbChannel){var l=DonotDestroyManager.GameData.Charge.payment[this._index],h=100*l.rmb,d=l.name,_=l.product_id,u=this._index+"_"+MyPersistDataManager._playerData.server_id+"_"+MyPersistDataManager._playerData.account_id;return void(cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("ShYunbeeOpenApi","neigou:and1:and2:and3:",h,d,_,u))}
if(5==DonotDestroyManager.jsbChannel){var m=DonotDestroyManager.GameData.Charge.payment[this._index],p=m.rmb,f=m.name,g=m.product_id;if(cc.sys.os===cc.sys.OS_IOS){var y=Math.random().toString(36).substr(2),v=MyPersistDataManager._playerData.server_id+"",M="S#"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(M=DonotDestroyManager._gameServerInfo.server_name);var S=MyPersistDataManager._playerData.server_id+"_"+this._index,C=MyPersistDataManager._playerData.id+"",D=MyPersistDataManager._playerData.name+"";jsb.reflection.callStaticMethod("BjLiuyeOpenApi","neigou:and1:and2:and3:and4:and5:and6:and7:and8:",y,v,M,g,S,p+"",C,D,f)}
return}
if(6==DonotDestroyManager.jsbChannel||7==DonotDestroyManager.jsbChannel){var I=DonotDestroyManager.GameData.Charge.payment[this._index],b=100*I.rmb,P=I.name,L=I.product_id,B=this._index+"_"+MyPersistDataManager._playerData.server_id,w=ae.t("pay_xingteng_callback_url");jsb.reflection.callStaticMethod("CfXingTengOpenApi","zfu:and1:and2:and3:and4:and5:",b,P,1,B,w,L)}else if(8==DonotDestroyManager.jsbChannel){var E=DonotDestroyManager.GameData.Charge.payment[this._index],k=MyPersistDataManager._playerData.account_id.substr(3),T=E.product_id,A=this._index,R=MyPersistDataManager._playerData.id+"",F=MyPersistDataManager._playerData.name,x=MyPersistDataManager._playerData.level+"",U=MyPersistDataManager._playerData.server_id+"",N="S"+MyPersistDataManager._playerData.server_id,G=MyPersistDataManager._playerData.gameMoney+"",H=MyPersistDataManager._playerData.vip_level+"",O=MyPersistDataManager._playerData.money+"",q=MyPersistDataManager._playerData.fight+"";jsb.reflection.callStaticMethod("GzPingPingOpenApi","zfu:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:and11:",k,T,A,R,F,x,U,N,G,H,O,q)}else if(9==DonotDestroyManager.jsbChannel){var j=DonotDestroyManager.GameData.Charge.payment[this._index],V=j.rmb,z=j.name,W=j.product_id,J=this._index+"_"+MyPersistDataManager._playerData.server_id;jsb.reflection.callStaticMethod("MxsgDouWanOpenApi","fufee:and1:and2:and3:",V,z,W,J)}else if(11==DonotDestroyManager.jsbChannel){var Z=DonotDestroyManager.GameData.Charge.payment[this._index],Y="S"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(Y=DonotDestroyManager._gameServerInfo.server_name);var K=this._index.toString();0==this._index&&(K="20"),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","pay","(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V",MyPersistDataManager._playerData.money,Z.rmb,K,Z.name,Z.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),Y,MyPersistDataManager._playerData.vip_level.toString()):jsb.reflection.callStaticMethod("SDKHandler","pay:and1:and2:and3:and4:and5:and6:and7:and8:",MyPersistDataManager._playerData.server_id.toString(),Y,K,Z.name,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),Z.rmb.toString(),K)}else if(12==DonotDestroyManager.jsbChannel){var Q=DonotDestroyManager.GameData.Charge.payment[this._index],X="S"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(X=DonotDestroyManager._gameServerInfo.server_name);var $=this._index.toString();0==this._index&&($="20"),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","pay","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;IILjava/lang/String;Ljava/lang/String;)V",MyPersistDataManager._playerData.server_id.toString(),X,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.money.toString(),Q.name,1,Q.rmb,$.toString(),$+"_"+MyPersistDataManager._playerData.server_id):jsb.reflection.callStaticMethod("QuickSDKHandler","charge:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:and11:",$.toString(),Q.rmb,$+"_"+MyPersistDataManager._playerData.server_id,X,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.money.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.level.toString(),Q.name,1)}}}}),cc._RF.pop()},{MyEventDispatcher:"MyEventDispatcher",MyProtocols:"MyProtocols",MyUIEvent:"MyUIEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],VipPayCell2:[function(e,t,a){"use strict";cc._RF.push(t,"9fea0WDwqhNLYMf9YmnKy5j","VipPayCell2");var X=e("MyProtocols"),$=e("SoundUtil"),ee=e("i18n"),n={"charge1.png":6,"charge2.png":5,"charge3.png":4,"charge4.png":3,"charge5.png":2,"charge6.png":1,"charge7.png":0};cc.Class({extends:cc.Component,properties:{m_pCellName:cc.Label,m_pCellRmb:cc.Label,m_pCell:cc.Sprite,m_pCellImage:[cc.SpriteFrame],m_pCellBottomDes:cc.Label,m_pCellPerPay:cc.Label,m_pDisGold:cc.Sprite,_index:2,_cellState:0},onLoad:function(){this.ReadInfoBrown()},ChangeData:function(e){this._index=e},ReadInfoBrown:function(){if(!(this._index<0)){var e=DonotDestroyManager.GameData.Charge.payment[this._index];this.m_pCellName.string="x"+e.name,this.m_pCellRmb.string=ee.t("vippay_009",{value:e.rmb}),null!=window.open_platform&&2==window.open_platform&&cc.sys.os==cc.sys.OS_IOS&&(this.m_pCellRmb.string=ee.t("vippay_012",{value:10*e.rmb}));var t=n[e.icon];this.m_pCell.spriteFrame=this.m_pCellImage[t],this.JudgeExtReward()?(this.m_pCellBottomDes.node.active=!1,this.m_pCellPerPay.node.active=!1,this.m_pDisGold.node.active=!1):(this.m_pCellBottomDes.string=ee.t("vippay_006",{value:e.times[0][1]}),this.m_pCellPerPay.string="")}},JudgeExtReward:function(){for(var e=MyPersistDataManager._playerData.chargeInfo.payment_level,t=0;t<e.length;++t)
if(e[t]==this._index)
return!0;return!1},clickHanlder:function(e){if(cc.log(" gửi đi dự tiền trả tin tức ,index=%d",this._index),$.playBtnOpenEffect(),null!=window.open_platform){var t=DonotDestroyManager.GameData.Charge.payment[this._index].name;switch(window.open_platform){case 1:X.send_C2SQunheiPayPre(DonotDestroyManager._gameSocket,this._index,t);break;case 2:X.send_C2SWanBaGetBalance(DonotDestroyManager._gameSocket,window.OPEN_DATA.appid,window.OPEN_DATA.openid,window.OPEN_DATA.openkey,window.OPEN_DATA.pf,window.OPEN_DATA.platform,this._index,t);break;case 3:X.send_C2SZMPayCheck(DonotDestroyManager._gameSocket,this._index,t);break;case 4:var a=window.THREE33.gameId;window.THREE33.uid;X.send_C2S333PayPre(DonotDestroyManager._gameSocket,a,t,this._index);break;case 5:X.send_C2SChongChongPayPre(DonotDestroyManager._gameSocket,this._index,t);case 6:X.send_C2S4399PayPre(DonotDestroyManager._gameSocket,this._index,t)}}
if(2==DonotDestroyManager.jsbChannel){var n=DonotDestroyManager.GameData.Charge.payment[this._index],i=100*n.rmb,r=n.name,s=this._index+"_"+MyPersistDataManager._playerData.server_id,o=ee.t("pay_yijie_callback_url");window.webkit.messageHandlers.pay.postMessage({unitPrice:i,itemName:r,count:1,callBackInfo:s,callBackUrl:o})}else{if(3==DonotDestroyManager.jsbChannel){var c=DonotDestroyManager.GameData.Charge.payment[this._index].product_id;this._index;return void(cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("LejiIAPApi","BuyProduct:",c))}
if(4==DonotDestroyManager.jsbChannel){var l=DonotDestroyManager.GameData.Charge.payment[this._index],h=100*l.rmb,d=l.name,_=l.product_id,u=this._index+"_"+MyPersistDataManager._playerData.server_id+"_"+MyPersistDataManager._playerData.account_id;return void(cc.sys.os===cc.sys.OS_IOS&&jsb.reflection.callStaticMethod("ShYunbeeOpenApi","neigou:and1:and2:and3:",h,d,_,u))}
if(5==DonotDestroyManager.jsbChannel){var m=DonotDestroyManager.GameData.Charge.payment[this._index],p=m.rmb,f=m.name,g=m.product_id;if(cc.sys.os===cc.sys.OS_IOS){var y=Math.random().toString(36).substr(2),v=MyPersistDataManager._playerData.server_id+"",M="S#"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(M=DonotDestroyManager._gameServerInfo.server_name);var S=MyPersistDataManager._playerData.server_id+"_"+this._index,C=MyPersistDataManager._playerData.id+"",D=MyPersistDataManager._playerData.name+"";jsb.reflection.callStaticMethod("BjLiuyeOpenApi","neigou:and1:and2:and3:and4:and5:and6:and7:and8:",y,v,M,g,S,p+"",C,D,f)}
return}
if(6==DonotDestroyManager.jsbChannel||7==DonotDestroyManager.jsbChannel){var I=DonotDestroyManager.GameData.Charge.payment[this._index],b=100*I.rmb,P=I.name,L=I.product_id,B=this._index+"_"+MyPersistDataManager._playerData.server_id,w=ee.t("pay_xingteng_callback_url");jsb.reflection.callStaticMethod("CfXingTengOpenApi","zfu:and1:and2:and3:and4:and5:",b,P,1,B,w,L)}else if(8==DonotDestroyManager.jsbChannel){var E=DonotDestroyManager.GameData.Charge.payment[this._index],k=MyPersistDataManager._playerData.account_id.substr(3),T=E.product_id,A=this._index,R=MyPersistDataManager._playerData.id+"",F=MyPersistDataManager._playerData.name,x=MyPersistDataManager._playerData.level+"",U=MyPersistDataManager._playerData.server_id+"",N="S"+MyPersistDataManager._playerData.server_id,G=MyPersistDataManager._playerData.gameMoney+"",H=MyPersistDataManager._playerData.vip_level+"",O=MyPersistDataManager._playerData.money+"",q=MyPersistDataManager._playerData.fight+"";jsb.reflection.callStaticMethod("GzPingPingOpenApi","zfu:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:and11:",k,T,A,R,F,x,U,N,G,H,O,q)}else if(9==DonotDestroyManager.jsbChannel){var j=DonotDestroyManager.GameData.Charge.payment[this._index],V=j.rmb,z=j.name,W=j.product_id,J=this._index+"_"+MyPersistDataManager._playerData.server_id;jsb.reflection.callStaticMethod("MxsgDouWanOpenApi","fufee:and1:and2:and3:",V,z,W,J)}else if(11==DonotDestroyManager.jsbChannel){var Z=DonotDestroyManager.GameData.Charge.payment[this._index],Y="S"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(Y=DonotDestroyManager._gameServerInfo.server_name),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("leji/sango/Sy185Methods","pay","(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V",MyPersistDataManager._playerData.money,Z.rmb,this._index.toString(),Z.name,Z.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),Y,MyPersistDataManager._playerData.vip_level.toString()):jsb.reflection.callStaticMethod("SDKHandler","pay:and1:and2:and3:and4:and5:and6:and7:and8:",MyPersistDataManager._playerData.server_id.toString(),Y,this._index.toString(),Z.name,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),Z.rmb.toString(),this._index.toString())}else if(12==DonotDestroyManager.jsbChannel){var K=DonotDestroyManager.GameData.Charge.payment[this._index],Q="S"+MyPersistDataManager._playerData.server_id;null!=DonotDestroyManager._gameServerInfo&&(Q=DonotDestroyManager._gameServerInfo.server_name),cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("cn/lejigames/sangomav/QuickSDKMethods","pay","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;IILjava/lang/String;Ljava/lang/String;)V",MyPersistDataManager._playerData.server_id.toString(),Q,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.level.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.money.toString()," vàng ",K.rmb,K.rmb,this._index.toString(),this._index+"_"+MyPersistDataManager._playerData.server_id):jsb.reflection.callStaticMethod("QuickSDKHandler","charge:and1:and2:and3:and4:and5:and6:and7:and8:and9:and10:and11:",this._index.toString(),K.rmb,this._index+"_"+MyPersistDataManager._playerData.server_id,Q,MyPersistDataManager._playerData.name,MyPersistDataManager._playerData.server_id.toString(),MyPersistDataManager._playerData.id.toString(),MyPersistDataManager._playerData.money.toString(),MyPersistDataManager._playerData.vip_level.toString(),MyPersistDataManager._playerData.level.toString()," vàng ",K.rmb)}}}}),cc._RF.pop()},{MyProtocols:"MyProtocols",SoundUtil:"SoundUtil",i18n:"i18n"}],VipPayMgn:[function(e,t,a){"use strict";cc._RF.push(t,"2aea4TRsO1Ej6bIyncuXG4X","VipPayMgn");var n=e("SoundUtil"),r=e("i18n"),i=e("MyEventDispatcher"),s=e("NetEvent"),o=e("MyUIEvent"),c=e("GuideBufferMgr"),l=cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pPayMore:cc.Label,m_pVipLevelNow:cc.Label,m_pVipLevelNext:cc.Label,m_pVipExpLabel:cc.Label,m_pVipExp:cc.Sprite,m_pGold:cc.Sprite,m_pDes:cc.Label,m_pDes2:cc.Label,m_pVipNext:cc.Sprite,m_pTitle:cc.Sprite,m_pTitleFrame:[cc.SpriteFrame],m_pChangeBtnLabel:cc.Label,btn_change:cc.Node,m_pChangePrefabNode:cc.Node,m_pChangePrefab:[cc.Prefab],_myVipLevel:0,_btnState:-1,_reloaded_prefab:null,_params:null,_target_vip:0},statics:{Instance:null},onLoad:function(){(l.Instance=this).onVipLevelChange_cb_func=this.onVipLevelChange_cb.bind(this),i.addListener(o.onVipLevelChange,this.onVipLevelChange_cb_func),this.onVipExpChange_cb_func=this.onVipExpChange_cb.bind(this),i.addListener(o.onVipExpChange,this.onVipExpChange_cb_func),this.S2CGetYuekaAward_cb_func=this.S2CGetYuekaAward_cb.bind(this),i.addListener(s.S2CGetYuekaAward,this.S2CGetYuekaAward_cb_func)},S2CGetYuekaAward_cb:function(e){null!=this._alert_layer&&cc.isValid(this._alert_layer)||(this._alert_layer=cc.instantiate(DonotDestroyManager.AlertLayer),cc.Canvas.instance.node.addChild(this._alert_layer)),n.playGainGoodsEffectNew();var t=this,a=1==e.type?r.t("vippay_014"):r.t("vippay_015");this._alert_layer.getComponent("AlertLayerManager").initContent(a+" lĩnh thành công, đạt được 【"+e.yuanbao+"】 vàng ！",function(){t._alert_layer.destroy(),t._alert_layer=null})},onVipLevelChange_cb:function(e){this.ReadVipInfo()},onVipExpChange_cb:function(e){this.ReadVipInfo()},onDestroy:function(){(l.Instance=null)!=this.finishCb&&this.finishCb(),i.removeListener(o.onVipLevelChange,this.onVipLevelChange_cb_func),i.removeListener(o.onVipExpChange,this.onVipExpChange_cb_func),i.removeListener(s.S2CGetYuekaAward,this.S2CGetYuekaAward_cb_func)},setParams:function(e){this._params=e,this._target_vip=e.targetVip||MyPersistDataManager._playerData.vip_level,this.closeCb=e.closeCb,this._btnState=e.state||-1,this.ChangeData()},ChangeData:function(){this.ScaleToLarge(),this.ReadVipInfo(),this.ReloadPrefab(this._btnState)},ReadVipInfo:function(){if(this._myVipLevel=MyPersistDataManager._playerData.vip_level,13<this._myVipLevel&&(this._myVipLevel=13),this.m_pVipLevelNow.string=MyPersistDataManager._playerData.vip_level,this._myVipLevel<13){this.m_pDes.string=r.t("vippay_001"),this.m_pDes2.string=r.t("vippay_013"),this.m_pVipLevelNext.string=MyPersistDataManager._playerData.vip_level+1,this.m_pVipExpLabel.string=MyPersistDataManager._playerData.vip_exp+"/"+DonotDestroyManager.GameData.Charge.vip_levels[this._myVipLevel+1].num,this.m_pPayMore.string="x"+(DonotDestroyManager.GameData.Charge.vip_levels[this._myVipLevel+1].num-MyPersistDataManager._playerData.vip_exp);var e=188*MyPersistDataManager._playerData.vip_exp/DonotDestroyManager.GameData.Charge.vip_levels[this._myVipLevel+1].num;this.m_pVipExp.node.width=188<e?188:e}else
this.m_pVipExp.node.width=188,this.m_pGold.node.active=!1,this.m_pPayMore.node.active=!1,this.m_pVipLevelNext.node.active=!1,this.m_pVipNext.node.active=!1,this.m_pDes.string=r.t("vippay_008"),this.m_pDes2.node.active=!1,this.m_pVipExpLabel.string=DonotDestroyManager.GameData.Charge.vip_levels[this._myVipLevel].num},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},setCloseCb:function(e){this.finishCb=e},Change_onClickHandler:function(e,t){this._btnState*=-1,this._params.state=this._btnState,n.playBtnOpenEffect(),this.ReloadPrefab(this._btnState),this.node.runAction(cc.sequence(cc.delayTime(.05),cc.callFunc(function(){this.showGuide()},this)))},ReloadPrefab:function(e){null!=this._reloaded_prefab&&(this._reloaded_prefab.removeFromParent(),this._reloaded_prefab.destroy(),this._reloaded_prefab=null);var t=0,a="",n="";-1==e?(t=0,a="ChargeScrollView",n=r.t("vippay_002")):1==e&&(t=1,a="ChargePageView",n=r.t("vippay_003")),this.m_pTitle.spriteFrame=this.m_pTitleFrame[t],this.m_pChangeBtnLabel.string=n;var i=cc.instantiate(this.m_pChangePrefab[t]);i.getComponent(a).ChangeData(this._target_vip),this.m_pChangePrefabNode.addChild(i),this._reloaded_prefab=i},start:function(){this.node.runAction(cc.sequence(cc.delayTime(.32),cc.callFunc(function(){this.showGuide()},this)))},showGuide:function(){var n=this;c.showGuide("VipPayPanel",function(e){if(1==e)
return n.btn_change;if(2==e){var t=n._reloaded_prefab.getComponent("ChargePageView");if(null!=t){var a=t._nowPage.getComponent("MovePage").getVipPacksBtn.node;return a.active=!0,a}}})}});cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent",NetEvent:"NetEvent",SoundUtil:"SoundUtil",i18n:"i18n"}],WActor:[function(a,e,t){"use strict";cc._RF.push(e,"3b0ddUzv3dF8Ya5UuFwRqFv","WActor");var n=cc.Class({properties:{is_show:{set:function(e){null!=this.node&&(this.node.active=e)},get:function(){if(null!=this.node)
return this.node.active}}},ctor:function(){cc.log("WActor create!"),this.name=null,this.node=null,this.parentNode=null,this.fsm=null,this.lastEv=null,this.nextEv=null},setFSM:function(){},setAnchorPoint:function(e,t){this.node.setAnchorPoint(e,t)},setScale:function(e,t){this.node.setScale(e,t)},setPosition:function(e,t){null!=this.node&&(void 0!==t?(e-=t/2,this.node.setPosition(e,t)):(e.x=e.x-e.y/2,this.node.setPosition(e)))},setLocalZOrder:function(e){this.node.setLocalZOrder(e)},getLocalZOrder:function(){return this.node.getLocalZOrder()},getPosition:function(){var e=this.node.getPosition().clone();return e.x+=e.y/2,e},getDistance2Target:function(e){var t=e.getPosition(),a=this.getPosition();return cc.pDistance(t,a)},add2Parent:function(e){if(!this.parentNode)
if(e)
this.parentNode=e;else{var t=a("BattleUiMgr");this.parentNode=t.getInstance().bf_node}
this.parentNode.addChild(this.node)},doEvent:function(e,t){this.fsm.current!=e&&(this.fsm.can(e)?(this.lastEv=e,null!=t?this.fsm[e](t):this.fsm[e]()):cc.log("[%s] current state is %s, can not switch to %s.",this.name,this.fsm.current,e))},getState:function(){return null!=this.fsm?this.fsm.current:""},onUpdate:function(e){}});e.exports=n,cc._RF.pop()},{BattleUiMgr:"BattleUiMgr"}],WanbaFuliWidget:[function(e,t,a){"use strict";cc._RF.push(t,"20fb8IIM2pM243/FS8CkqEl","WanbaFuliWidget");var n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},onDestroy:function(){},setParams:function(e){this.closeCb=e.closeCb},start:function(){this.node.scale=.7,this.node.runAction(cc.sequence(cc.scaleTo(.15,1.2).easing(cc.easeOut(3)),cc.scaleTo(.08,1).easing(cc.easeIn(3))))},update:function(e){},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back()}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],WanbaLibaoGetWidget:[function(e,t,a){"use strict";cc._RF.push(t,"ea794IwFVxNvIuKNnvamXJh","WanbaLibaoGetWidget");var n=e("SoundUtil");cc.Class({extends:cc.Component,properties:{pre_itembox:cc.Prefab,node_itemContainer:cc.Node,lab_tip1:cc.Label,lab_tip2:cc.Label},onLoad:function(){},onDestroy:function(){},setParams:function(e){this.closeCb=e.closeCb,this.netData=e.netData},start:function(){var e=this.netData.wanba_gift_id,t=DonotDestroyManager.GameData.WanbaLibao[e];1==this.netData.status?(this.lab_tip1.node.color=cc.Color.RED,this.lab_tip2.node.color=cc.Color.WHITE,this.lab_tip1.string="Mỗi ngày chỉ được nhận 1 lần!",this.lab_tip2.string="Hôm nay bạn đã nhận 【"+t.name+"】："):2==this.netData.status?(this.lab_tip1.node.color=cc.Color.RED,this.lab_tip2.node.color=cc.Color.WHITE,this.lab_tip1.string="Nhận thất bại!",this.lab_tip2.string="Hệ thống đang bận,xin thử lại sau hoặc liên hệ CSKH.【"+t.name+"】："):3==this.netData.status?(this.lab_tip1.node.color=cc.Color.RED,this.lab_tip2.node.color=cc.Color.WHITE,this.lab_tip1.string="Nhận thất bại!",this.lab_tip2.string="Lv VIP không phù hợp, không thể nhận 【"+t.name+"】："):4==this.netData.status?(this.lab_tip1.node.color=cc.Color.RED,this.lab_tip2.node.color=cc.Color.WHITE,this.lab_tip1.string="Nhận thất bại!",this.lab_tip2.string=" VIP của bạn đã hết hiệu lực,nhận lại sau khi kích hoạt VIP  【"+t.name+"】："):5==this.netData.status?(this.lab_tip1.node.color=cc.Color.RED,this.lab_tip2.node.color=cc.Color.WHITE,this.lab_tip1.string="Nhận thất bại!",this.lab_tip2.string="Lỗi không xác định,xin thử nhận lại sau 【"+t.name+"】："):this.lab_tip2.string="Chúc mừng bạn nhận được 【"+t.name+"】：";for(var a=0;a<t.reward.length;a++){var n=t.reward[a];this.CreateItemBox(n[0],n[1])}
this.node.scale=.7,this.node.runAction(cc.sequence(cc.scaleTo(.15,1.2).easing(cc.easeOut(3)),cc.scaleTo(.08,1).easing(cc.easeIn(3))))},CreateItemBox:function(e,t){var a=cc.instantiate(this.pre_itembox);this.node_itemContainer.addChild(a),a.getComponent("ItemBox").ChangeItemInfo(e,t,!0,null,!0)},update:function(e){},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),(MyPersistDataManager._wanba_gift=null)!=this.closeCb&&this.closeCb()}}),cc._RF.pop()},{SoundUtil:"SoundUtil"}],WeeklyBattleLayer:[function(e,t,a){"use strict";cc._RF.push(t,"53f02tFGSxMg7iN1/865Ru0","WeeklyBattleLayer");var n=e("SoundUtil"),i=e("i18n"),r=e("GuideBufferMgr");cc.Class({extends:cc.Component,properties:{m_pScaelNode:cc.Node,m_pWeekly:[cc.Sprite],m_pWeeklyBtn:[cc.Button],m_pWeekly0Frame:[cc.SpriteFrame],m_pWeekly1Frame:[cc.SpriteFrame],m_pWeekly2Frame:[cc.SpriteFrame],m_pWeekly3Frame:[cc.SpriteFrame],m_pWeekly4Frame:[cc.SpriteFrame],m_pWeekly5Frame:[cc.SpriteFrame],m_pWeeklyDes:[cc.Label],_spriteFrame:[],_guideBtn:cc.Node},onLoad:function(){this._spriteFrame.push(this.m_pWeekly0Frame),this._spriteFrame.push(this.m_pWeekly1Frame),this._spriteFrame.push(this.m_pWeekly2Frame),this._spriteFrame.push(this.m_pWeekly3Frame),this._spriteFrame.push(this.m_pWeekly4Frame),this._spriteFrame.push(this.m_pWeekly5Frame)},setParams:function(e){this.closeCb=e.closeCb,this.JudgeDate(),this.ScaleToLarge()},JudgeDate:function(){this.ClearWeekly();var e=(new Date).getDay();if(1==e||4==e)
this.ChangeWeekly(0),this.ChangeWeekly(3);else if(2==e||5==e)
this.ChangeWeekly(1),this.ChangeWeekly(4);else if(3==e||6==e)
this.ChangeWeekly(2),this.ChangeWeekly(5);else
for(var t=0;t<6;++t)
this.ChangeWeekly(t)},ClearWeekly:function(){for(var e=0;e<this.m_pWeekly.length;++e){this.m_pWeekly[e].spriteFrame=this._spriteFrame[e][0],this.m_pWeeklyBtn[e].transition=cc.Button.Transition.NONE,this.m_pWeeklyDes[e].node.color=new cc.Color(252,253,140),this.m_pWeeklyBtn[e].clickEvents[0].handler="NoOpen_onClickHandler"}},ChangeWeekly:function(e){null==this._guideBtn&&(this._guideBtn=this.m_pWeeklyBtn[e].node),this.m_pWeekly[e].spriteFrame=this._spriteFrame[e][1],this.m_pWeeklyBtn[e].transition=cc.Button.Transition.SPRITE,this.m_pWeeklyBtn[e].normalSprite=this._spriteFrame[e][1],this.m_pWeeklyBtn[e].pressedSprite=this._spriteFrame[e][2],this.m_pWeeklyDes[e].node.color=new cc.Color(102,255,0),this.m_pWeeklyBtn[e].clickEvents[0].handler="OpenLayer_onClickHandler"},OpenLayer_onClickHandler:function(e,t){n.playBtnOpenEffect();var a=parseInt(t);MyUiManager.Open(MyUiManager.PanelInfo.SelectMissionLayer,{index:a,state:0})},NoOpen_onClickHandler:function(e,t){MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),i.t("week_001"))},ScaleToLarge:function(){this.m_pScaelNode.scaleX=.7,this.m_pScaelNode.scaleY=.7;var e=cc.scaleTo(.3,1,1);this.m_pScaelNode.runAction(e)},Back_onClickHandler:function(){n.playBtnCloseEffect(),MyUiManager.Back(),this.closeCb&&this.closeCb()},start:function(){this.showGuide()},showGuide:function(){var t=this;r.showGuide("WeeklyBattleLayer",function(e){if(1==e)
return t._guideBtn})}}),cc._RF.pop()},{GuideBufferMgr:"GuideBufferMgr",SoundUtil:"SoundUtil",i18n:"i18n"}],WsDecoder:[function(e,t,a){"use strict";cc._RF.push(t,"b95fe/dtA5BE57aGldphb/h","WsDecoder");var n=e("WsUtil"),i=function(e,t,a){this.bytes_=null,this.start_=0,this.end_=0,this.cursor_=0,this.tempLow_=0,this.tempHigh_=0,e&&this.setBlock(e,t,a)};i.instanceCache_=[],i.alloc=function(e,t,a){if(i.instanceCache_.length){var n=i.instanceCache_.pop();return e&&n.setBlock(e,t,a),n}
return new i(e,t,a)},i.prototype.free=function(){this.clear(),i.instanceCache_.length<100&&i.instanceCache_.push(this)},i.prototype.clone=function(){return i.alloc(this.bytes_,this.start_,this.end_-this.start_)},i.prototype.clear=function(){this.bytes_=null,this.start_=0,this.end_=0,this.cursor_=0,this.error_=!1},i.prototype.getBuffer=function(){return this.bytes_},i.prototype.setBlock=function(e,t,a){this.bytes_=n.utils.byteSourceToUint8Array(e),this.start_=0|t,this.end_=a?this.start_+a:this.bytes_.length,this.cursor_=this.start_},i.prototype.readInt=function(){return this.readUnsignedVarint32()},i.prototype.readString=function(){return this.readStringWithLength()},i.prototype.readLong=function(){return this.readUnsignedVarint64()},i.prototype.readUnsignedVarint32=function(){var e,t=this.bytes_,a=127&(e=t[this.cursor_+0]);return e<128?(this.cursor_+=1,a):(a|=(127&(e=t[this.cursor_+1]))<<7,e<128?(this.cursor_+=2,a):(a|=(127&(e=t[this.cursor_+2]))<<14,e<128?(this.cursor_+=3,a):(a|=(127&(e=t[this.cursor_+3]))<<21,e<128?(this.cursor_+=4,a):(a|=(15&(e=t[this.cursor_+4]))<<28,e<128?(cc.assert(0==(240&e),"readUnsignedVarint32 error!"),this.cursor_+=5,a>>>0):(this.cursor_+=10,a)))))},i.prototype.readUint32=function(){var e=this.bytes_[this.cursor_+0],t=this.bytes_[this.cursor_+1],a=this.bytes_[this.cursor_+2],n=this.bytes_[this.cursor_+3];return this.cursor_+=4,(e<<0|t<<8|a<<16|n<<24)>>>0},i.prototype.readFloat=function(){var e=this.readUint32();return n.utils.joinFloat32(e,0)},i.prototype.readBool=function(){return!!this.bytes_[this.cursor_++]},i.prototype.readStringPure=function(e){for(var t=this.bytes_,a=this.cursor_,n=a+e,i=[];a<n;){var r=t[a++];if(r<128)
i.push(r);else{if(r<192)
continue;if(r<224){var s=t[a++];i.push((31&r)<<6|63&s)}else if(r<240){s=t[a++];var o=t[a++];i.push((15&r)<<12|(63&s)<<6|63&o)}else if(r<248){var c=(7&r)<<18|(63&(s=t[a++]))<<12|(63&(o=t[a++]))<<6|63&t[a++],l=56320+(1023&(c-=65536)),h=55296+(c>>10&1023);i.push(h,l)}}}
var d=String.fromCharCode.apply(null,i);return this.cursor_=a,d},i.prototype.readStringWithLength=function(){var e=this.readUnsignedVarint32();return this.readStringPure(e)},i.prototype.readUnsignedVarint64=function(){return this.readSplitVarint64_(),n.utils.joinUint64(this.tempLow_,this.tempHigh_)},i.prototype.readSplitVarint64_=function(){for(var e,t=0,a=0,n=0;n<4;n++)
if(t|=(127&(e=this.bytes_[this.cursor_++]))<<7*n,e<128)
return this.tempLow_=t>>>0,void(this.tempHigh_=0);if(t|=(127&(e=this.bytes_[this.cursor_++]))<<28,a|=(127&e)>>4,e<128)
return this.tempLow_=t>>>0,void(this.tempHigh_=a>>>0);for(n=0;n<5;n++)
if(a|=(127&(e=this.bytes_[this.cursor_++]))<<7*n+3,e<128)
return this.tempLow_=t>>>0,void(this.tempHigh_=a>>>0);cc.error("Failed to read varint, encoding is invalid."),this.error_=!0},t.exports=i,cc._RF.pop()},{WsUtil:"WsUtil"}],WsEncoder:[function(e,t,a){"use strict";cc._RF.push(t,"693f1EOMXBEM6oRDXWHXlem","WsEncoder");var n=e("WsUtil"),i=function(){this.buffer_=[]};i.instanceCache_=[],i.alloc=function(){return i.instanceCache_.length?i.instanceCache_.pop():new i},i.prototype.free=function(){this.buffer_=[],i.instanceCache_.length<100&&i.instanceCache_.push(this)},i.prototype.end=function(){var e=this.buffer_;return this.buffer_=[],e},i.prototype.writeUnsignedVarint32=function(e){for(;127<e;)
this.buffer_.push(127&e|128),e>>>=7;this.buffer_.push(e)},i.prototype.writeUnsignedVarint64=function(e){cc.assert(e==Math.floor(e)),cc.assert(0<=e&&e<n.BinaryConstants.TWO_TO_64),n.utils.splitInt64(e),this.writeSplitVarint64(n.utils.split64Low,n.utils.split64High)},i.prototype.writeSplitVarint64=function(e,t){for(;0<t||127<e;)
this.buffer_.push(127&e|128),e=(e>>>7|t<<25)>>>0,t>>>=7;this.buffer_.push(e)},i.prototype.writeInt=function(e){this.writeSignedVarint32(e)},i.prototype.writeLong=function(e){this.writeUnsignedVarint64(e)},i.prototype.writeSignedVarint32=function(e){if(0<=e)
this.writeUnsignedVarint32(e);else{for(var t=0;t<9;t++)
this.buffer_.push(127&e|128),e>>=7;this.buffer_.push(1)}},i.prototype.writeSignedVarint64=function(e){cc.assert(e==Math.floor(e)),cc.assert(e>=-n.BinaryConstants.TWO_TO_63&&e<n.BinaryConstants.TWO_TO_63),n.utils.splitInt64(e),this.writeSplitVarint64(n.utils.split64Low,n.utils.split64High)},i.prototype.writeFloat=function(e){cc.assert(e>=-n.BinaryConstants.FLOAT32_MAX&&e<=n.BinaryConstants.FLOAT32_MAX),n.utils.splitFloat32(e),this.writeUint32(n.utils.split64Low)},i.prototype.writeUint32=function(e){this.buffer_.push(e>>>0&255),this.buffer_.push(e>>>8&255),this.buffer_.push(e>>>16&255),this.buffer_.push(e>>>24&255)},i.prototype.writeBool=function(e){this.buffer_.push(e?1:0)},i.prototype.writeString=function(e){for(var t=[],a=0;a<e.length;a++){var n=e.charCodeAt(a);if(n<128)
t.push(n);else if(n<2048)
t.push(n>>6|192),t.push(63&n|128);else if(n<65536)
if(55296<=n&&n<=56319&&a+1<e.length){var i=e.charCodeAt(a+1);56320<=i&&i<=57343&&(n=1024*(n-55296)+i-56320+65536,t.push(n>>18|240),t.push(n>>12&63|128),t.push(n>>6&63|128),t.push(63&n|128),a++)}else
t.push(n>>12|224),t.push(n>>6&63|128),t.push(63&n|128)}
var r=t.length;this.writeSignedVarint32(r),this.writeBytes(t),t=null},i.prototype.writeBytes=function(e){this.buffer_.push.apply(this.buffer_,e)},t.exports=i,cc._RF.pop()},{WsUtil:"WsUtil"}],WsUtil:[function(e,t,a){"use strict";cc._RF.push(t,"02d40OZkxFKgbRNkBcK+FxM","WsUtil");var d=function(){};d.ConstBinaryMessage=function(){},d.BinaryMessage=function(){},(d.BinaryConstants=function(){}).FieldType={INVALID:-1,DOUBLE:1,FLOAT:2,INT64:3,UINT64:4,INT32:5,FIXED64:6,FIXED32:7,BOOL:8,STRING:9,GROUP:10,MESSAGE:11,BYTES:12,UINT32:13,ENUM:14,SFIXED32:15,SFIXED64:16,SINT32:17,SINT64:18,FHASH64:30,VHASH64:31},(d.BinaryConstants=function(){}).WireType={INVALID:-1,VARINT:0,FIXED64:1,DELIMITED:2,START_GROUP:3,END_GROUP:4,FIXED32:5},d.BinaryConstants.FieldTypeToWireType=function(e){var t=d.BinaryConstants.FieldType,a=d.BinaryConstants.WireType;switch(e){case t.INT32:case t.INT64:case t.UINT32:case t.UINT64:case t.SINT32:case t.SINT64:case t.BOOL:case t.ENUM:case t.VHASH64:return a.VARINT;case t.DOUBLE:case t.FIXED64:case t.SFIXED64:case t.FHASH64:return a.FIXED64;case t.STRING:case t.MESSAGE:case t.BYTES:return a.DELIMITED;case t.FLOAT:case t.FIXED32:case t.SFIXED32:return a.FIXED32;case t.INVALID:case t.GROUP:default:return a.INVALID}},d.BinaryConstants.INVALID_FIELD_NUMBER=-1,d.BinaryConstants.FLOAT32_EPS=1401298464324817e-60,d.BinaryConstants.FLOAT32_MIN=11754943508222875e-54,d.BinaryConstants.FLOAT32_MAX=34028234663852886e22,d.BinaryConstants.FLOAT64_EPS=5e-324,d.BinaryConstants.FLOAT64_MIN=22250738585072014e-324,d.BinaryConstants.FLOAT64_MAX=17976931348623157e292,d.BinaryConstants.TWO_TO_20=1048576,d.BinaryConstants.TWO_TO_23=8388608,d.BinaryConstants.TWO_TO_31=2147483648,d.BinaryConstants.TWO_TO_32=4294967296,d.BinaryConstants.TWO_TO_52=4503599627370496,d.BinaryConstants.TWO_TO_63=0x8000000000000000,d.BinaryConstants.TWO_TO_64=0x10000000000000000,d.BinaryConstants.ZERO_HASH="\0\0\0\0\0\0\0\0",(d.utils=function(){}).split64Low=0,d.utils.split64High=0,d.utils.splitUint64=function(e){var t=e>>>0,a=Math.floor((e-t)/d.BinaryConstants.TWO_TO_32)>>>0;d.utils.split64Low=t,d.utils.split64High=a},d.utils.splitInt64=function(e){var t=e<0,a=(e=Math.abs(e))>>>0,n=Math.floor((e-a)/d.BinaryConstants.TWO_TO_32);n>>>=0,t&&(n=~n>>>0,a=~a>>>0,4294967295<(a+=1)&&(a=0,4294967295<++n&&(n=0))),d.utils.split64Low=a,d.utils.split64High=n},d.utils.splitZigzag64=function(e){var t=e<0;e=2*Math.abs(e),d.utils.splitUint64(e);var a=d.utils.split64Low,n=d.utils.split64High;t&&(0==a?0==n?n=a=4294967295:(n--,a=4294967295):a--),d.utils.split64Low=a,d.utils.split64High=n},d.utils.splitFloat32=function(e){var t,a,n=e<0?1:0;if(0!==(e=n?-e:e)){if(isNaN(e))
return d.utils.split64High=0,void(d.utils.split64Low=2147483647);if(e>d.BinaryConstants.FLOAT32_MAX)
return d.utils.split64High=0,void(d.utils.split64Low=(n<<31|2139095040)>>>0);if(e<d.BinaryConstants.FLOAT32_MIN)
return a=Math.round(e/Math.pow(2,-149)),d.utils.split64High=0,void(d.utils.split64Low=(n<<31|a)>>>0);t=Math.floor(Math.log(e)/Math.LN2),a=e*Math.pow(2,-t),a=8388607&Math.round(a*d.BinaryConstants.TWO_TO_23),d.utils.split64High=0,d.utils.split64Low=(n<<31|t+127<<23|a)>>>0}else
0<1/e?(d.utils.split64High=0,d.utils.split64Low=0):(d.utils.split64High=0,d.utils.split64Low=2147483648)},d.utils.splitFloat64=function(e){var t=e<0?1:0;if(0===(e=t?-e:e))
return d.utils.split64High=0<1/e?0:2147483648,void(d.utils.split64Low=0);if(isNaN(e))
return d.utils.split64High=2147483647,void(d.utils.split64Low=4294967295);if(e>d.BinaryConstants.FLOAT64_MAX)
return d.utils.split64High=(t<<31|2146435072)>>>0,void(d.utils.split64Low=0);if(e<d.BinaryConstants.FLOAT64_MIN){var a=(i=e/Math.pow(2,-1074))/d.BinaryConstants.TWO_TO_32;return d.utils.split64High=(t<<31|a)>>>0,void(d.utils.split64Low=i>>>0)}
var n=Math.floor(Math.log(e)/Math.LN2);1024==n&&(n=1023);a=(i=e*Math.pow(2,-n))*d.BinaryConstants.TWO_TO_20&1048575;var i,r=i*d.BinaryConstants.TWO_TO_52>>>0;d.utils.split64High=(t<<31|n+1023<<20|a)>>>0,d.utils.split64Low=r},d.utils.splitHash64=function(e){var t=e.charCodeAt(0),a=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),r=e.charCodeAt(4),s=e.charCodeAt(5),o=e.charCodeAt(6),c=e.charCodeAt(7);d.utils.split64Low=t+(a<<8)+(n<<16)+(i<<24)>>>0,d.utils.split64High=r+(s<<8)+(o<<16)+(c<<24)>>>0},d.utils.joinUint64=function(e,t){return t*d.BinaryConstants.TWO_TO_32+e},d.utils.joinInt64=function(e,t){var a=2147483648&t;a&&(t=~t>>>0,0==(e=1+~e>>>0)&&(t=t+1>>>0));var n=d.utils.joinUint64(e,t);return a?-n:n},d.utils.joinZigzag64=function(e,t){var a=1&e;e=(e>>>1|t<<31)>>>0,t>>>=1,a&&0==(e=e+1>>>0)&&(t=t+1>>>0);var n=d.utils.joinUint64(e,t);return a?-n:n},d.utils.joinFloat32=function(e,t){var a=2*(e>>31)+1,n=e>>>23&255,i=8388607&e;return 255==n?i?NaN:a*(1/0):0==n?a*Math.pow(2,-149)*i:a*Math.pow(2,n-150)*(i+Math.pow(2,23))},d.utils.joinFloat64=function(e,t){var a=2*(t>>31)+1,n=t>>>20&2047,i=d.BinaryConstants.TWO_TO_32*(1048575&t)+e;return 2047==n?i?NaN:a*(1/0):0==n?a*Math.pow(2,-1074)*i:a*Math.pow(2,n-1075)*(i+d.BinaryConstants.TWO_TO_52)},d.utils.joinHash64=function(e,t){var a=e>>>0&255,n=e>>>8&255,i=e>>>16&255,r=e>>>24&255,s=t>>>0&255,o=t>>>8&255,c=t>>>16&255,l=t>>>24&255;return String.fromCharCode(a,n,i,r,s,o,c,l)},d.utils.DIGITS=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],d.utils.joinUnsignedDecimalString=function(e,t){if(t<=2097151)
return""+(d.BinaryConstants.TWO_TO_32*t+e);var a=(e>>>24|t<<8)>>>0&16777215,n=t>>16&65535,i=(16777215&e)+6777216*a+6710656*n,r=a+8147497*n,s=2*n;1e7<=i&&(r+=Math.floor(i/1e7),i%=1e7),1e7<=r&&(s+=Math.floor(r/1e7),r%=1e7);var o=d.utils.DIGITS,c=!1,l="";function h(e){for(var t=1e7,a=0;a<7;a++){var n=e/(t/=10)%10>>>0;(0!=n||c)&&(c=!0,l+=o[n])}}
return(s||c)&&h(s),(r||c)&&h(r),(i||c)&&h(i),l},d.utils.joinSignedDecimalString=function(e,t){var a=2147483648&t;a&&(t=~t+(0==(e=1+~e>>>0)?1:0)>>>0);var n=d.utils.joinUnsignedDecimalString(e,t);return a?"-"+n:n},d.utils.hash64ToDecimalString=function(e,t){d.utils.splitHash64(e);var a=d.utils.split64Low,n=d.utils.split64High;return t?d.utils.joinSignedDecimalString(a,n):d.utils.joinUnsignedDecimalString(a,n)},d.utils.hash64ArrayToDecimalStrings=function(e,t){for(var a=new Array(e.length),n=0;n<e.length;n++)
a[n]=d.utils.hash64ToDecimalString(e[n],t);return a},d.utils.decimalStringToHash64=function(e){cc.assert(0<e.length);var t=!1;"-"===e[0]&&(t=!0,e=e.slice(1));var i=[0,0,0,0,0,0,0,0];function a(e,t){for(var a=0;a<8&&(1!==e||0<t);a++){var n=e*i[a]+t;i[a]=255&n,t=n>>>8}}
for(var n=0;n<e.length;n++)
a(10,d.utils.DIGITS.indexOf(e[n]));return t&&(function(){for(var e=0;e<8;e++)
i[e]=255&~i[e]}
(),a(1,1)),String.fromCharCode.apply(null,i)},d.utils.splitDecimalString=function(e){d.utils.splitHash64(d.utils.decimalStringToHash64(e))},d.utils.hash64ToHexString=function(e){var t=new Array(18);t[0]="0",t[1]="x";for(var a=0;a<8;a++){var n=e.charCodeAt(7-a);t[2*a+2]=d.utils.DIGITS[n>>4],t[2*a+3]=d.utils.DIGITS[15&n]}
return t.join("")},d.utils.hexStringToHash64=function(e){e=e.toLowerCase(),cc.assert(18==e.length),cc.assert("0"==e[0]),cc.assert("x"==e[1]);for(var t="",a=0;a<8;a++){var n=d.utils.DIGITS.indexOf(e[2*a+2]),i=d.utils.DIGITS.indexOf(e[2*a+3]);t=String.fromCharCode(16*n+i)+t}
return t},d.utils.hash64ToNumber=function(e,t){d.utils.splitHash64(e);var a=d.utils.split64Low,n=d.utils.split64High;return t?d.utils.joinInt64(a,n):d.utils.joinUint64(a,n)},d.utils.numberToHash64=function(e){return d.utils.splitInt64(e),d.utils.joinHash64(d.utils.split64Low,d.utils.split64High)},d.utils.countVarints=function(e,t,a){for(var n=0,i=t;i<a;i++)
n+=e[i]>>7;return a-t-n},d.utils.countVarintFields=function(e,t,a,n){var i=0,r=t,s=8*n+d.BinaryConstants.WireType.VARINT;if(s<128)
for(;r<a;){if(e[r++]!=s)
return i;for(i++;;){if(0==(128&e[r++]))
break}}
else
for(;r<a;){for(var o=s;128<o;){if(e[r]!=(127&o|128))
return i;r++,o>>=7}
if(e[r++]!=o)
return i;for(i++;;){if(0==(128&e[r++]))
break}}
return i},d.utils.countFixedFields_=function(e,t,a,n,i){var r=0,s=t;if(n<128)
for(;s<a;){if(e[s++]!=n)
return r;r++,s+=i}
else
for(;s<a;){for(var o=n;128<o;){if(e[s++]!=(127&o|128))
return r;o>>=7}
if(e[s++]!=o)
return r;r++,s+=i}
return r},d.utils.countFixed32Fields=function(e,t,a,n){var i=8*n+d.BinaryConstants.WireType.FIXED32;return d.utils.countFixedFields_(e,t,a,i,4)},d.utils.countFixed64Fields=function(e,t,a,n){var i=8*n+d.BinaryConstants.WireType.FIXED64;return d.utils.countFixedFields_(e,t,a,i,8)},d.utils.countDelimitedFields=function(e,t,a,n){for(var i=0,r=t,s=8*n+d.BinaryConstants.WireType.DELIMITED;r<a;){for(var o=s;128<o;){if(e[r++]!=(127&o|128))
return i;o>>=7}
if(e[r++]!=o)
return i;i++;for(var c=0,l=1;c+=(127&(o=e[r++]))*l,l*=128,0!=(128&o););r+=c}
return i},d.utils.debugBytesToTextFormat=function(e){var t='"';if(e)
for(var a=d.utils.byteSourceToUint8Array(e),n=0;n<a.length;n++)
t+="\\x",a[n]<16&&(t+="0"),t+=a[n].toString(16);return t+'"'},d.utils.debugScalarToTextFormat=function(e){return goog.isString(e)?goog.string.quote(e):e.toString()},d.utils.stringToByteArray=function(e){for(var t=new Uint8Array(e.length),a=0;a<e.length;a++){var n=e.charCodeAt(a);if(255<n)
throw new Error("Conversion error: string contains codepoint outside of byte range");t[a]=n}
return t},d.utils.byteSourceToUint8Array=function(e){return e.constructor===Uint8Array?e:e.constructor===ArrayBuffer?(e=e,new Uint8Array(e)):e.constructor===Array?(e=e,new Uint8Array(e)):e.constructor===String?(e=e,goog.crypt.base64.decodeStringToUint8Array(e)):(cc.fail("Type not convertible to Uint8Array."),new Uint8Array(0))},t.exports=d,cc._RF.pop()},{}],YiJieManager:[function(e,t,a){"use strict";cc._RF.push(t,"bf604Iu8a1NxYRjXRO9n7Zs","YiJieManager");var i=e("MyEventDispatcher"),r=e("MyUIEvent"),n=e("GameUtils");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},loginSuccess:function(e,t,a,n){cc.log(" dịch tiếp đăng ký thành công ！"),i.dispatchEvent(r.YiJieLoginSuccessJsbCallback,{appId:e,channelId:t,userId:a,token:n})},loginFail:function(){cc.log(" dịch tiếp đăng ký thất bại ！"),MyUiManager.OpenFloatTipPanel(new cc.Vec2(0,130),"Đăng nhập thất bại,xin thử lại!")},doExit:function(){cc.director.end()},onLogout:function(){n.restartGame()}}),cc._RF.pop()},{GameUtils:"GameUtils",MyEventDispatcher:"MyEventDispatcher",MyUIEvent:"MyUIEvent"}],birdAnimationCtrl:[function(e,t,a){"use strict";cc._RF.push(t,"11c193UmKVD9r6QbHE7jJuG","birdAnimationCtrl");cc.Class({extends:cc.Component,properties:{ArenaAnim:sp.Skeleton},onLoad:function(){this.ArenaAnim.setMix("action1","action2",.1),this.ArenaAnim.setMix("action2","action1",.1),this.ArenaAnim.setCompleteListener(this._animationEventHandler.bind(this)),this.ArenaAnim.setAnimation(0,"action1",!1)},_animationEventHandler:function(e){if(cc.isValid(this)&&cc.isValid(this.node)){e.animation&&e.animation.name;.5<Math.random()?this.ArenaAnim.setAnimation(0,"action1",!1):this.ArenaAnim.setAnimation(0,"action2",!1)}else
cc.log("i'am onDestroy--birdAnimationCtrl!")}}),cc._RF.pop()},{}],i18n:[function(e,t,a){"use strict";cc._RF.push(t,"2a8d4NrglVEopWwBK5ilzTf","i18n");var s=new(e("polyglot"))({allowMissing:!0});t.exports={init:function(e){s.replace(e)},t:function(e,t){var a=s.t(e,t);if(cc.sys.isBrowser){var n=1,i="\t";cc.sys.os!=cc.sys.OS_WINDOWS&&(n=2,i="\t\t");for(var r=0;-1<r;)
r++,-1<(r=a.indexOf("\t",r))&&(a=a.substring(0,r)+i+a.substring(r,a.length),r+=n)}
return a}},cc._RF.pop()},{polyglot:"polyglot"}],loginManager:[function(e,t,a){"use strict";cc._RF.push(t,"0b5cd3WOWJHfIAuPHc75kmP","loginManager");var i=e("i18n");e("GameUtils");cc.Class({extends:cc.Component,properties:{loginPrefab:cc.Prefab},onLoad:function(){var n=this;cc.loader.loadRes("i18n/zh",cc.TestAsset,function(e,t){cc.log("init i18n!"),i.init(t),cc.log("enter login scene!");var a=cc.instantiate(n.loginPrefab);cc.Canvas.instance.node.addChild(a)})},onDestroy:function(){cc.log("login tiêu hủy ")}}),cc._RF.pop()},{GameUtils:"GameUtils",i18n:"i18n"}],md5:[function(require,module,exports){(function(process,global){"use strict";cc._RF.push(module,"41ae98HcvtNNK47OLYvTvcn","md5");var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var ERROR="input is invalid type",WINDOW="object"===("undefined"==typeof window?"undefined":_typeof(window)),root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"===("undefined"==typeof self?"undefined":_typeof(self)),NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"===(void 0===process?"undefined":_typeof(process))&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&"object"===(void 0===module?"undefined":_typeof(module))&&module.exports,AMD="function"==typeof define&&define.amd,ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}
!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(t){return function(e){return new Md5(!0).update(e)[t]()}},createMethod=function(){var t=createOutputMethod("hex");NODE_JS&&(t=nodeWrap(t)),t.create=function(){return new Md5},t.update=function(e){return t.create().update(e)};for(var e=0;e<OUTPUT_TYPES.length;++e){var a=OUTPUT_TYPES[e];t[a]=createOutputMethod(a)}
return t},nodeWrap=function nodeWrap(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)
return crypto.createHash("md5").update(e,"utf8").digest("hex");if(null==e)
throw ERROR;return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash("md5").update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod};function Md5(e){if(e)
blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else
this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}
Md5.prototype.update=function(e){if(!this.finalized){var t,a=void 0===e?"undefined":_typeof(e);if("string"!==a){if("object"!==a)
throw ERROR;if(null===e)
throw ERROR;if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)
e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))
throw ERROR;t=!0}
for(var n,i,r=0,s=e.length,o=this.blocks,c=this.buffer8;r<s;){if(this.hashed&&(this.hashed=!1,o[0]=o[16],o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),t)
if(ARRAY_BUFFER)
for(i=this.start;r<s&&i<64;++r)
c[i++]=e[r];else
for(i=this.start;r<s&&i<64;++r)
o[i>>2]|=e[r]<<SHIFT[3&i++];else if(ARRAY_BUFFER)
for(i=this.start;r<s&&i<64;++r)
(n=e.charCodeAt(r))<128?c[i++]=n:(n<2048?c[i++]=192|n>>6:(n<55296||57344<=n?c[i++]=224|n>>12:(n=65536+((1023&n)<<10|1023&e.charCodeAt(++r)),c[i++]=240|n>>18,c[i++]=128|n>>12&63),c[i++]=128|n>>6&63),c[i++]=128|63&n);else
for(i=this.start;r<s&&i<64;++r)
(n=e.charCodeAt(r))<128?o[i>>2]|=n<<SHIFT[3&i++]:(n<2048?o[i>>2]|=(192|n>>6)<<SHIFT[3&i++]:(n<55296||57344<=n?o[i>>2]|=(224|n>>12)<<SHIFT[3&i++]:(n=65536+((1023&n)<<10|1023&e.charCodeAt(++r)),o[i>>2]|=(240|n>>18)<<SHIFT[3&i++],o[i>>2]|=(128|n>>12&63)<<SHIFT[3&i++]),o[i>>2]|=(128|n>>6&63)<<SHIFT[3&i++]),o[i>>2]|=(128|63&n)<<SHIFT[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,64<=i?(this.start=i-64,this.hash(),this.hashed=!0):this.start=i}
return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>2]|=EXTRA[3&t],56<=t&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var e,t,a,n,i,r,s=this.blocks;this.first?t=((t=((e=((e=s[0]-680876937)<<7|e>>>25)-271733879<<0)^(a=((a=(-271733879^(n=((n=(-1732584194^2004318071&e)+s[1]-117830708)<<12|n>>>20)+e<<0)&(-271733879^e))+s[2]-1126478375)<<17|a>>>15)+n<<0)&(n^e))+s[3]-1316259209)<<22|t>>>10)+a<<0:(e=this.h0,t=this.h1,a=this.h2,t=((t+=((e=((e+=((n=this.h3)^t&(a^n))+s[0]-680876936)<<7|e>>>25)+t<<0)^(a=((a+=(t^(n=((n+=(a^e&(t^a))+s[1]-389564586)<<12|n>>>20)+e<<0)&(e^t))+s[2]+606105819)<<17|a>>>15)+n<<0)&(n^e))+s[3]-1044525330)<<22|t>>>10)+a<<0),t=((t+=((e=((e+=(n^t&(a^n))+s[4]-176418897)<<7|e>>>25)+t<<0)^(a=((a+=(t^(n=((n+=(a^e&(t^a))+s[5]+1200080426)<<12|n>>>20)+e<<0)&(e^t))+s[6]-1473231341)<<17|a>>>15)+n<<0)&(n^e))+s[7]-45705983)<<22|t>>>10)+a<<0,t=((t+=((e=((e+=(n^t&(a^n))+s[8]+1770035416)<<7|e>>>25)+t<<0)^(a=((a+=(t^(n=((n+=(a^e&(t^a))+s[9]-1958414417)<<12|n>>>20)+e<<0)&(e^t))+s[10]-42063)<<17|a>>>15)+n<<0)&(n^e))+s[11]-1990404162)<<22|t>>>10)+a<<0,t=((t+=((e=((e+=(n^t&(a^n))+s[12]+1804603682)<<7|e>>>25)+t<<0)^(a=((a+=(t^(n=((n+=(a^e&(t^a))+s[13]-40341101)<<12|n>>>20)+e<<0)&(e^t))+s[14]-1502002290)<<17|a>>>15)+n<<0)&(n^e))+s[15]+1236535329)<<22|t>>>10)+a<<0,t=((t+=((n=((n+=(t^a&((e=((e+=(a^n&(t^a))+s[1]-165796510)<<5|e>>>27)+t<<0)^t))+s[6]-1069501632)<<9|n>>>23)+e<<0)^e&((a=((a+=(e^t&(n^e))+s[11]+643717713)<<14|a>>>18)+n<<0)^n))+s[0]-373897302)<<20|t>>>12)+a<<0,t=((t+=((n=((n+=(t^a&((e=((e+=(a^n&(t^a))+s[5]-701558691)<<5|e>>>27)+t<<0)^t))+s[10]+38016083)<<9|n>>>23)+e<<0)^e&((a=((a+=(e^t&(n^e))+s[15]-660478335)<<14|a>>>18)+n<<0)^n))+s[4]-405537848)<<20|t>>>12)+a<<0,t=((t+=((n=((n+=(t^a&((e=((e+=(a^n&(t^a))+s[9]+568446438)<<5|e>>>27)+t<<0)^t))+s[14]-1019803690)<<9|n>>>23)+e<<0)^e&((a=((a+=(e^t&(n^e))+s[3]-187363961)<<14|a>>>18)+n<<0)^n))+s[8]+1163531501)<<20|t>>>12)+a<<0,t=((t+=((n=((n+=(t^a&((e=((e+=(a^n&(t^a))+s[13]-1444681467)<<5|e>>>27)+t<<0)^t))+s[2]-51403784)<<9|n>>>23)+e<<0)^e&((a=((a+=(e^t&(n^e))+s[7]+1735328473)<<14|a>>>18)+n<<0)^n))+s[12]-1926607734)<<20|t>>>12)+a<<0,t=((t+=((r=(n=((n+=((i=t^a)^(e=((e+=(i^n)+s[5]-378558)<<4|e>>>28)+t<<0))+s[8]-2022574463)<<11|n>>>21)+e<<0)^e)^(a=((a+=(r^t)+s[11]+1839030562)<<16|a>>>16)+n<<0))+s[14]-35309556)<<23|t>>>9)+a<<0,t=((t+=((r=(n=((n+=((i=t^a)^(e=((e+=(i^n)+s[1]-1530992060)<<4|e>>>28)+t<<0))+s[4]+1272893353)<<11|n>>>21)+e<<0)^e)^(a=((a+=(r^t)+s[7]-155497632)<<16|a>>>16)+n<<0))+s[10]-1094730640)<<23|t>>>9)+a<<0,t=((t+=((r=(n=((n+=((i=t^a)^(e=((e+=(i^n)+s[13]+681279174)<<4|e>>>28)+t<<0))+s[0]-358537222)<<11|n>>>21)+e<<0)^e)^(a=((a+=(r^t)+s[3]-722521979)<<16|a>>>16)+n<<0))+s[6]+76029189)<<23|t>>>9)+a<<0,t=((t+=((r=(n=((n+=((i=t^a)^(e=((e+=(i^n)+s[9]-640364487)<<4|e>>>28)+t<<0))+s[12]-421815835)<<11|n>>>21)+e<<0)^e)^(a=((a+=(r^t)+s[15]+530742520)<<16|a>>>16)+n<<0))+s[2]-995338651)<<23|t>>>9)+a<<0,t=((t+=((n=((n+=(t^((e=((e+=(a^(t|~n))+s[0]-198630844)<<6|e>>>26)+t<<0)|~a))+s[7]+1126891415)<<10|n>>>22)+e<<0)^((a=((a+=(e^(n|~t))+s[14]-1416354905)<<15|a>>>17)+n<<0)|~e))+s[5]-57434055)<<21|t>>>11)+a<<0,t=((t+=((n=((n+=(t^((e=((e+=(a^(t|~n))+s[12]+1700485571)<<6|e>>>26)+t<<0)|~a))+s[3]-1894986606)<<10|n>>>22)+e<<0)^((a=((a+=(e^(n|~t))+s[10]-1051523)<<15|a>>>17)+n<<0)|~e))+s[1]-2054922799)<<21|t>>>11)+a<<0,t=((t+=((n=((n+=(t^((e=((e+=(a^(t|~n))+s[8]+1873313359)<<6|e>>>26)+t<<0)|~a))+s[15]-30611744)<<10|n>>>22)+e<<0)^((a=((a+=(e^(n|~t))+s[6]-1560198380)<<15|a>>>17)+n<<0)|~e))+s[13]+1309151649)<<21|t>>>11)+a<<0,t=((t+=((n=((n+=(t^((e=((e+=(a^(t|~n))+s[4]-145523070)<<6|e>>>26)+t<<0)|~a))+s[11]-1120210379)<<10|n>>>22)+e<<0)^((a=((a+=(e^(n|~t))+s[2]+718787259)<<15|a>>>17)+n<<0)|~e))+s[9]-343485551)<<21|t>>>11)+a<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=a-1732584194<<0,this.h3=n+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+a<<0,this.h3=this.h3+n<<0)},Md5.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,a=this.h2,n=this.h3;return HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,a=this.h2,n=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&a,a>>8&255,a>>16&255,a>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var e,t,a,n="",i=this.array(),r=0;r<15;)
e=i[r++],t=i[r++],a=i[r++],n+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[63&(e<<4|t>>>4)]+BASE64_ENCODE_CHAR[63&(t<<2|a>>>6)]+BASE64_ENCODE_CHAR[63&a];return e=i[r],n+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[e<<4&63]+"=="};var exports=createMethod();COMMON_JS?module.exports=exports:(root.md5=exports,AMD&&define(function(){return exports}))})(),cc._RF.pop()}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:1}],polyglot:[function(e,n,i){(function(e){"use strict";cc._RF.push(n,"f73bb6+GehJ/5f5ygOA3vxS","polyglot");var t,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t=void 0!==e?e:void 0,a=function(t){var d=String.prototype.replace;function e(e){e=e||{},this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en",this.allowMissing=!!e.allowMissing,this.warn=e.warn||a}
e.VERSION="1.0.0",e.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},e.prototype.extend=function(e,t){var a;for(var n in e)
e.hasOwnProperty(n)&&(a=e[n],t&&(n=t+"."+n),"object"===(void 0===a?"undefined":s(a))?this.extend(a,n):this.phrases[n]=a)},e.prototype.unset=function(e,t){var a;if("string"==typeof e)
delete this.phrases[e];else
for(var n in e)
e.hasOwnProperty(n)&&(a=e[n],t&&(n=t+"."+n),"object"===(void 0===a?"undefined":s(a))?this.unset(a,n):delete this.phrases[n])},e.prototype.clear=function(){this.phrases={}},e.prototype.replace=function(e){this.clear(),this.extend(e)},e.prototype.t=function(e,t){var a,n;return"number"==typeof(t=null==t?{}:t)&&(t={smart_count:t}),"string"==typeof this.phrases[e]?a=this.phrases[e]:"string"==typeof t._?a=t._:this.allowMissing?a=e:(this.warn('Missing translation for key: "'+e+'"'),n=e),"string"==typeof a&&(t=function(e){var t={};for(var a in e)
t[a]=e[a];return t}
(t),n=function(e,t){for(var a in t)
if("_"!==a&&t.hasOwnProperty(a)){var n=t[a];"string"==typeof n&&(n=d.call(t[a],i,r)),e=d.call(e,new RegExp("%\\{"+a+"\\}","g"),n)}
return e}
(n=function(e,t,a){var n,i,r;null!=a&&e?(i=e.split(_),r=i[(o=t,c=a,u[(l=o,h=function(e){var t,a,n,i={};for(t in e)
if(e.hasOwnProperty(t))
for(n in a=e[t])
i[a[n]]=t;return i}
(m),h[l]||h.en)](c))]||i[0],s=r,n=d.call(s,p,"")):n=e;var s;var o,c,l,h;return n}
(a,this.currentLocale,t.smart_count),t)),n},e.prototype.has=function(e){return e in this.phrases};var _="||||",u={chinese:function(e){return 0},german:function(e){return 1!==e?1:0},french:function(e){return 1<e?1:0},russian:function(e){return e%10==1&&e%100!=11?0:2<=e%10&&e%10<=4&&(e%100<10||20<=e%100)?1:2},czech:function(e){return 1===e?0:2<=e&&e<=4?1:2},polish:function(e){return 1===e?0:2<=e%10&&e%10<=4&&(e%100<10||20<=e%100)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0}},m={chinese:["fa","id","ja","ko","lo","ms","th","tr","zh"],german:["da","de","en","es","fi","el","he","hu","it","nl","no","pt","sv"],french:["fr","tl","pt-br"],russian:["hr","ru"],czech:["cs","sk"],polish:["pl"],icelandic:["is"]};var p=/^\s+|\s+$/g;var i=/\$/g,r="$$$$";function a(e){t.console&&t.console.warn&&t.console.warn("WARNING: "+e)}
return e},"function"==typeof define&&define.amd?define([],function(){return a(t)}):"object"===(void 0===i?"undefined":s(i))?n.exports=a(t):t.Polyglot=a(t),cc._RF.pop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],"state-machine":[function(e,t,a){"use strict";var _;cc._RF.push(t,"843f7gUpoxFnY76K4rUmmTs","state-machine"),_={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,t){var a="string"==typeof e.initial?{state:e.initial}:e.initial,n=e.terminal||e.final,i=t||e.target||{},r=e.events||[],s=e.callbacks||{},o={},c={},l=function(e){var t=Array.isArray(e.from)?e.from:e.from?[e.from]:[_.WILDCARD];o[e.name]=o[e.name]||{};for(var a=0;a<t.length;a++)
c[t[a]]=c[t[a]]||[],c[t[a]].push(e.name),o[e.name][t[a]]=e.to||t[a];e.to&&(c[e.to]=c[e.to]||[])};a&&(a.event=a.event||"startup",l({name:a.event,from:"none",to:a.state}));for(var h=0;h<r.length;h++)
l(r[h]);for(var d in o)
o.hasOwnProperty(d)&&(i[d]=_.buildEvent(d,o[d]));for(var d in s)
s.hasOwnProperty(d)&&(i[d]=s[d]);return i.current="none",i.is=function(e){return Array.isArray(e)?0<=e.indexOf(this.current):this.current===e},i.can=function(e){return!this.transition&&void 0!==o[e]&&(o[e].hasOwnProperty(this.current)||o[e].hasOwnProperty(_.WILDCARD))},i.cannot=function(e){return!this.can(e)},i.transitions=function(){return(c[this.current]||[]).concat(c[_.WILDCARD]||[])},i.isFinished=function(){return this.is(n)},i.error=e.error||function(e,t,a,n,i,r,s){throw s||r},i.states=function(){return Object.keys(c).sort()},a&&!a.defer&&i[a.event](),i},doCallback:function(t,e,a,n,i,r){if(e)
try{return e.apply(t,[a,n,i].concat(r))}catch(e){return t.error(a,n,i,r,_.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",e)}},beforeAnyEvent:function(e,t,a,n,i){return _.doCallback(e,e.onbeforeevent,t,a,n,i)},afterAnyEvent:function(e,t,a,n,i){return _.doCallback(e,e.onafterevent||e.onevent,t,a,n,i)},leaveAnyState:function(e,t,a,n,i){return _.doCallback(e,e.onleavestate,t,a,n,i)},enterAnyState:function(e,t,a,n,i){return _.doCallback(e,e.onenterstate||e.onstate,t,a,n,i)},changeState:function(e,t,a,n,i){return _.doCallback(e,e.onchangestate,t,a,n,i)},beforeThisEvent:function(e,t,a,n,i){return _.doCallback(e,e["onbefore"+t],t,a,n,i)},afterThisEvent:function(e,t,a,n,i){return _.doCallback(e,e["onafter"+t]||e["on"+t],t,a,n,i)},leaveThisState:function(e,t,a,n,i){return _.doCallback(e,e["onleave"+a],t,a,n,i)},enterThisState:function(e,t,a,n,i){return _.doCallback(e,e["onenter"+n]||e["on"+n],t,a,n,i)},beforeEvent:function(e,t,a,n,i){if(!1===_.beforeThisEvent(e,t,a,n,i)||!1===_.beforeAnyEvent(e,t,a,n,i))
return!1},afterEvent:function(e,t,a,n,i){_.afterThisEvent(e,t,a,n,i),_.afterAnyEvent(e,t,a,n,i)},leaveState:function(e,t,a,n,i){var r=_.leaveThisState(e,t,a,n,i),s=_.leaveAnyState(e,t,a,n,i);return!1!==r&&!1!==s&&(_.ASYNC===r||_.ASYNC===s?_.ASYNC:void 0)},enterState:function(e,t,a,n,i){_.enterThisState(e,t,a,n,i),_.enterAnyState(e,t,a,n,i)},buildEvent:function(r,s){return function(){var e=this.current,t=s[e]||(s[_.WILDCARD]!=_.WILDCARD?s[_.WILDCARD]:e)||e,a=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(r,e,t,a,_.Error.PENDING_TRANSITION,"event "+r+" inappropriate because previous transition did not complete");if(this.cannot(r))
return this.error(r,e,t,a,_.Error.INVALID_TRANSITION,"event "+r+" inappropriate in current state "+this.current);if(!1===_.beforeEvent(this,r,e,t,a))
return _.Result.CANCELLED;if(e===t)
return _.afterEvent(this,r,e,t,a),_.Result.NOTRANSITION;var n=this;this.transition=function(){return n.transition=null,n.current=t,_.enterState(n,r,e,t,a),_.changeState(n,r,e,t,a),_.afterEvent(n,r,e,t,a),_.Result.SUCCEEDED},this.transition.cancel=function(){n.transition=null,_.afterEvent(n,r,e,t,a)};var i=_.leaveState(this,r,e,t,a);return!1===i?(this.transition=null,_.Result.CANCELLED):_.ASYNC===i?_.Result.PENDING:this.transition?this.transition():void 0}}},void 0!==a?(void 0!==t&&t.exports&&(a=t.exports=_),a.StateMachine=_):"function"==typeof define&&define.amd?define(function(e){return _}):"undefined"!=typeof window?window.StateMachine=_:"undefined"!=typeof self&&(self.StateMachine=_),cc._RF.pop()},{}]},{},["DoNotDestroyMng","GmPanel","HelloWorld","MyProtocols","BattleConstants","BattleDataManager","BattleStatistics","ArmiesManager","ArrowsManager","BattleManager","BuffsManager","DamageLogic","EffectsManager","HeroDieManager","HeroesManager","SkillsManager","SoldiersManager","StagesEventManager","Army","Arrow","Buff","Effect","Hero","MeleeArmy","MeleeHero","MeleeSoldier","RemoteArmy","RemoteHero","RemoteSoldier","Skill","Soldier","StrategyLine","Unit","WActor","BattleFailMgr","BattleLifeBarMgr","BattleLoadingLayerMng","BattlePauseMgr","BattleSceneMgr","BattleTalkLayer","BattleUiMgr","BattleWidgets","BattleWinMgr","GuozhanPveWinPanel","MineWinPanel","PkWinPanel","PropHitsRes","SecretWinPanel","TeamSkillUiManager","AdditionCfgMgr","ArenaCfgMgr","CardLevelsMgr","CardUpgradesMgr","CrawlCfgMgr","EliteStagesConfigMgr","EquipCfgMgr","EquipEnhanceCfgMgr","FormationCfgMgr","HeroConfigMgr","ItemCfgUtilMgr","ItemsConfigMgr","LevelsCfgMgr","NPCFightCfgMgr","OverComeCfgMgr","PropHintsEffect","ReinForceCfgMgr","StageEventCfgMgr","StagesConfigMgr","TalentsCfgMgr","TeamSkillCfgMgr","TiersCfgMgr","TreasureFragsCfgMgr","TreasureLevelsMgr","TreasureRefreshCfgMgr","TreasuresCfgMgr","UnLockCfgMgr","UnitConfigMgr","EnableTouch","GameUtils","MyEventDispatcher","ResLoaderManager","ShowFps","md5","state-machine","ActivityBattleManager","AreanBattleManager","BgMusicManager","BossBattleManager","ElitePVEBattleManager","FTBattleManager","GuozhanBattleManager","GuozhanCityBattleManager","GuozhanOfficeBattleManager","IosOpenManager","MineBattleManager","PVEBattleManager","PkBattleManager","SecretBattleManager","SnatchBattleManager","UiControllBack","UiManager","YiJieManager","ActivityItemCell","ActivityLayer","AreanBreakUp","AreanMainLayer","AreanRankUp","AreanWinPanel","ArenaRankItem","ArenaReportCell","ArenaReportLayer","ArmyFormationLayer","LuckRankItem","LuckRankLayer","ArmyHeroWarpInfo","ArmyItem","ArmyPanel","AttrChangeLabel","AttributeChangeItem","BattleDetailLayer","DamageItem","BattleFormationPanel","EmBattleDataManager","FormationHero","FormationSquare","ReplaceFormationInfo","ReplaceFormationItem","UnitCounterInfo","BlackShop","BossMainPanel","BossRankItem","BossRewardItem1","BossRewardPanel","BossRewardRankItem","ChatItem","ChatPanel","ChatPlayerInfo","DayActivityLayer","DayMissionItem","DayMissionItemAward1","EquipRefineAttrItem","EquipRefineLayer","EsFailed","EsMain","EsRoot","EsWrapItem","RuneCombinePanel","RuneCombineTab","RuneItemBagCombine","RuneLeftItem","RuneOilBuyPanel","RuneOilCtrl","FightThroughArmy","FightThroughArmyItem","FightThroughLayer","FightThroughtTip","FirstPayAwardItem","FirstPayMgn","FloatTipPanel","GameStoryLayer","GuideFight","GuideLayer","GuideSearch","CommonHelpPanel","GuoZhanChangeNation","GuoZhanCityNode","GuoZhanCityPanel","GuoZhanCityPlayer","GuoZhanConstants","GuoZhanFightCity","GuoZhanFightPanel","GuoZhanMainPanel","GuoZhanOffice","GuoZhanOfficeIcon","GuoZhanOfficeWrapItem","GuoZhanTips","BuyEnergy","BuyGameMoney","ShowDialog","HeroBox","HeroBoxSelect","HeroBoxSimple","ArmyEquipDialog","ArmyUpgradeDialog","ArmyUplevelDialog","HeroAttributePanel","HeroDetailsPanel","HeroEquipInfo","HeroEquipView","HeroLvUpLayer","HeroUnitsView","HeroUpgradeDialog","HeroUpgradeItem","UnitEquipsItem","HotUpdate","ItemBox","GetRewardPanel","MailDetail","MailItem","MailPanelManager","MailRewardItem","DailySharePanel","MineCoinOutput","MineConstants","MineHistoryRecrod","MineMainPanel","MinePoint","MinePointDetail","MineScene","MoveSlow","MissionItem","MissionItemAward1","MissionLayer","RankHeroItem","RankItem","RankLayer","RankPlayerDetail","GetHeroPanel","GetTenHeroPanel","HeroAddonWidget","HeroBaseNode","HeroShowPanel","RecruitAnimCtrl","RecruitManager","HammerAnimationCtrl","HeroRuneLayer","RuneBackPanel","RuneItem","RuneItemBag","RuneLevelupLayer","RuneSmallTip","RuneTab","RuneUnlockItem","RuneUnlockWidget","RuneUtil","SecretMainPanel","SecretPointPanel","SecretRewardPanel","SelectHeroPanel","SelectHeroWrapInfo","SelectInFormationItem","UnLockViewInfo","ServerItemNode","ServerListItem","ServerListPanel","OverComeTips","ShopItem","ShopItemInfo","ShopMallLayer","SignInItem","SignInItemInfo","SignInLayer","SignInVipInfo","SmelterMain","SmelterTips","SmelterWrapItem","AvoidWarDialog","SnatchAutoCell","SnatchAutoLayer","SnatchFragLayer","SnatchListLayer","SnatchMainLayer","SnatchQdItemCell","SnatchReportCell","SnatchReportLayer","SnatchWinPanel","EliteRewardItem","EliteStageSelectItem","StageEliteItem","StageEliteSelectPanel","StageFallItem","StageFallPanel","StageMapPanel","StageNormalItem","StageRewardInfo","StageRewardItem","StageSelectItem","StageSelectPanel","StageUnLockFuncLayer","SweepItem","SweepLayer","SweepTips","UnLockFuncItem","ConsumablesInfo","ConsumeMultiUse","EquipStrengthLayer","ExpandTipsPanel","StoreHouseEquipsInfo","StoreHouseFragmentInfo","StoreHouseItemInfo","StoreHouseItempanel","StoreHousePanel","StoreHouseTiersItem","StoreHouseTreasureInfo","TeamSkillAttritem","TeamSkillItem","TeamSkillPanel","TeamSkillUpgrade","ActivityAwardDoubleContent","ActivityCZJJDetail","ActivityDBCZItem","ActivityHeroLiBaoItem","ActivityQCJJItem","ActivityZPCJDetail","TestActLeftItem","TestActivityLayer","TestRightAwardItem","TreaRefineItem","TreaRefineLayer","TreasureStrengthen","TuJianPanel","UnlockFuncLayer","UnlockTips","ActivityQiZhenYiBaoPanel","ChangeHeadFrameLayer","ChangeIconLayer","ChangeNameLayer","HeadFrameColumnWidget","HeadRowContainer","HeroIconNameWidget","LevelUpLayer","MarqueeWidget","OfflineRewardsWidget","QieDjWidget","StageStoryLayer","SystemSettingLayer","UserDetailInfoManager","WanbaFuliWidget","WanbaLibaoGetWidget","ChargePageView","ChargeScrollView","MovePage","VipLabel","VipPayCell1","VipPayCell2","VipPayMgn","EpicBattleLayer","MissionDifficult","SelectMissionLayer","WeeklyBattleLayer","AnnounceLayer","CreateRolePanel","LoginEnterNamePwd","LoginSceneManager","RegisterCharacterPanel","LejiSocket","NetEvent","WsDecoder","WsEncoder","WsUtil","ActivityBufferMgr","ArenaBufferMgr","BagBufferMgr","BattleBufferMgr","BossBufferMgr","ConsumeBufferMgr","EliteStageBufferMgr","EnermyBufferMgr","EquipBufferMgr","EquipFragBufferMgr","GuideBufferMgr","GuozhanBufferMgr","GuozhanFightBufferMgr","HeroBufferMgr","HeroFragBufferMgr","ItemBufferMgr","MarqueeBufferMgr","MineBufferMgr","OverComeBufferMgr","PkBufferMgr","PlayerBufferMgr","RunesBufferMgr","SecretBufferMgr","SnatchBufferMgr","StageBufferMgr","TeamSkillBufferMgr","TreaFragBufferMgr","TreasureBufferMgr","UnitBufferMgr","SelectRoleInfo","GreyShader","Shader","AlertLayerManager","BGAutoMove","FightChangeTips","LoadingLayerCtrl","MainMenuFuncBtnBar","MyUIEvent","NameDescTipWidget","ShortLoadingMask","SmallTipsWidget","TimeClock","Tips","UIWarp","loginManager","MainButtonManager","MainHomeManager","MainHomeSceneManager","PlayerDataManager","birdAnimationCtrl","BattleUtil","ColorUtil","FrameAnimationCallback","NetMessageManager","PersistDataManager","ShaderUtil","SoundUtil","TeamDataUtil","TimeUtil","NewScript","BgMusicConfig","UiAudioConfig","LabelLocalized","i18n","polyglot"]);